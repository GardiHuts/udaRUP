<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"rup_table_rup.table.multiselection.js.html":{"id":"rup_table_rup.table.multiselection.js.html","title":"Source: rup_table/rup.table.multiselection.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.multiselection.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * preConfiguration: Método que se ejecuta antes de la invocación del componente jqGrid. * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;multiselection&quot;,{ loadOrder:8, preConfiguration: function(settings){ var $self = this; $self.rup_table(&quot;preConfigureMultiselection&quot;,settings); }, postConfiguration: function(settings){ var $self = this; if (settings.multiselect===true){ $self.rup_table(&quot;postConfigureMultiselection&quot;,settings); } } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Extensión del componente rup_table para permitir la gestión de la multiselección. * * Los métodos implementados son: * * preConfigureMultiselection(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * postConfigureMultiselection(settings): Método que define la postconfiguración necesaria para el correcto funcionamiento del componente. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ preConfigureMultiselection: function(settings){ var $self = this; // Añadimos la columna por defecto para mostrar la información del registro en edición // settings.colNames = jQuery.merge([&quot;&quot;], settings.colNames); // settings.colModel = jQuery.merge([settings.multiselection.defaultEditableInfoCol], settings.colModel); // Se configura la propiedad multiselecta true para que el plugin subyacente se configure en modo multiseleccion settings.multiselect = true; settings.multiselectWidth = 40; // // settings.ondblClickRow=function(){ // return false; // }; settings.core.operations.clone.enabled = function(){ return settings.multiselection.numSelected === 1; }; settings.getActiveLineId = function (){ var $self = this, settings = $self.data(&quot;settings&quot;), npos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(); return jQuery.inArray(settings.multiselection.rowForEditing, npos[1]); }; settings.getActiveRowId = function (){ var $self = this, settings = $self.data(&quot;settings&quot;); return settings.multiselection.rowForEditing; }; settings.getSelectedRows = function (){ var $self = this, settings = $self.data(&quot;settings&quot;); if (settings.multiselection.selectedAll!==true){ return settings.multiselection.selectedIds; }else{ return settings.multiselection.deselectedIds; } }; settings.getSelectedLines = function (){ var $self = this, settings = $self.data(&quot;settings&quot;), page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10); if (settings.multiselection.selectedAll!==true){ return settings.multiselection.selectedLinesPerPage[page]; }else{ return settings.multiselection.deselectedLinesPerPage[page]; } }; /* * Definición del método serializeGridData para que añada al postData la información relativa a la multiseleccion. */ $self.on({ &quot;rupTable_serializeGridData.multiselection&quot;: function(events, postData){ var multiselectionObj={}, tmpLastSearch; function getLastSearchStr(postData){ return postData.rows+postData.sidx+postData.sord+postData.filter!==undefined?jQuery.param(jQuery.extend({}, postData.filter, {rows:postData.rows, sidx: postData.sidx, sord: postData.sord})):&quot;&quot;; } tmpLastSearch = $self.data(&quot;tmp.lastSearch&quot;); if (tmpLastSearch !== undefined &amp;&amp; tmpLastSearch !== getLastSearchStr(postData)){ if (settings &amp;&amp; settings.multiselection &amp;&amp; settings.multiselection.numSelected&gt;0){ multiselectionObj = $self.rup_table(&quot;getSelectedIds&quot;); jQuery.extend(true, postData, {&quot;multiselection&quot;:multiselectionObj}); } } $self.data(&quot;tmp.lastSearch&quot;, getLastSearchStr(postData)); }, &quot;rupTable_setSelection.multiselection&quot;: function(events, selectedRows, status, reorderSelection){ var page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10); if (jQuery.isArray(selectedRows)){ for (var i=0;i&lt;selectedRows.length;i++){ $self._processSelectedRow(settings, selectedRows[i], status); } }else{ $self._processSelectedRow(settings, selectedRows, status); } // En caso de que se solicite la reordenación de los identificadores seleccionados if (reorderSelection===true){ $self.on(&quot;rupTable_serializeGridData.multiselection.reorderSelection&quot;, function(events, postData){ $self.off(&quot;rupTable_serializeGridData.multiselection.reorderSelection&quot;); jQuery.extend(true, postData, {&quot;multiselection&quot;: $self.rup_table(&quot;getSelectedIds&quot;)}); }); } $self.triggerHandler(&quot;rupTable_multiselectionUpdated&quot;); $self.triggerHandler(&quot;jqGridSelectRow.rupTable.multiselection&quot;, [selectedRows,status]); return false; } }); }, postConfigureMultiselection: function(settings){ var $self = this; // Inicialización de las propiedades asociadas a la gestión de los registros seleccionados $self._initializeMultiselectionProps(settings); // Se almacena la referencia del check de (de)seleccionar todos los registros settings.$selectAllCheck = jQuery(&quot;#cb_&quot;+settings.id); settings.fncHasSelectedElements = function(){ return settings.multiselection.numSelected&gt;0; }; settings.getRowForEditing = function(){ var $self = this, settings = $self.data(&quot;settings&quot;), page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10), nPos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(), index, retNavParams; if ($self._hasPageSelectedElements(page)){ if (settings.multiselection.rowForEditing!==undefined){ return settings.multiselection.rowForEditing; } index = $self._getSelectedLinesOfPage(page)[0]; return nPos[1][index-1]; }else{ retNavParams = jQuery.proxy(settings.fncGetNavigationParams,$self)('first'); execute = retNavParams[1]; newPage = retNavParams[5]; newPageIndex = retNavParams[6]; if (execute){ $self.trigger(&quot;reloadGrid&quot;,[{page: newPage}]); $self.on(&quot;jqGridAfterLoadComplete.multiselection.editRow&quot;,function(event,data){ var nextPagePos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(), //newIndexPos = nextPagePos[1][$self._getSelectedLinesOfPage(newPage)[0]-1]; newIndexPos = $self.getActiveRowId(); $self.jqGrid('editGridRow', newIndexPos, settings.editOptions); $self.off(&quot;jqGridAfterLoadComplete.multiselection.editRow&quot;); }); } return false; } }; settings.getDetailTotalRowCount = function(){ var $self = this, settings = $self.data(&quot;settings&quot;); return settings.multiselection.numSelected; }; settings.getDetailCurrentRowCount = function(){ var $self = this, settings = $self.data(&quot;settings&quot;), page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10), currentRow = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(), rowsPerPage = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;),10), selectedPagesArrayIndex, tmpSelectedPage, cont=0; // Comprobamos si se han seleccionado todos los registros de la tabla if (!settings.multiselection.selectedAll){ // En caso de que no se hayan seleccionado // Se obtiene el indice de la página actual dentro del array de páginas deseleccionadas para selectedPagesArrayIndex = jQuery.inArray(page, settings.multiselection.selectedPages); tmpSelectedPage = settings.multiselection.selectedPages[selectedPagesArrayIndex]; for (var i=1;i&lt;tmpSelectedPage;i++){ if (settings.multiselection.selectedLinesPerPage[i]!==undefined){ cont+=settings.multiselection.selectedLinesPerPage[i].length; } } cont+=jQuery.inArray(currentRow[0]+1, settings.multiselection.selectedLinesPerPage[tmpSelectedPage])+1; }else{ cont = (page&gt;1?((page-1)-settings.multiselection.deselectedPages.length)*rowsPerPage:0); for (var i=0;i&lt;settings.multiselection.deselectedPages.length &amp;&amp; settings.multiselection.deselectedPages[i]!==page;i++){ cont+=rowsPerPage-settings.multiselection.deselectedLinesPerPage[settings.multiselection.deselectedPages[i]].length; } cont+=jQuery.inArray(currentRow[0]+1, $self._getSelectedLinesOfPage(page))+1; } return cont; }; settings.fncGetNavigationParams = function getNavigationParams_multiselection(linkType ){ var $self = this, settings = $self.data(&quot;settings&quot;), execute = false, changePage = false, index=0, newPageIndex=0, npos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(), page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10), newPage=page, lastPage = parseInt(Math.ceil($self.rup_table(&quot;getGridParam&quot;, &quot;records&quot;)/$self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;)),10), currentArrayIndex, selectedLines; npos[0] = parseInt(npos[0],10); $(&quot;#&quot;+settings.formEdit.feedbackId, settings.formEdit.$detailForm).hide(); switch (linkType){ case 'first': // Navegar al primer elemento seleccionado execute = true; // Si no se han seleccionado todos los elementos if (!settings.multiselection.selectedAll){ // Se comprueba si la página en la que nos encontramos es la primera en la que se han seleccionado registros if (settings.multiselection.selectedPages[0]!==page){ // Marcamos el flag changePage para indicar que se debe de realizar una paginación changePage = true; // La nueva página será la primera página en la que se ha realizado una selección de registros newPage = settings.multiselection.selectedPages[0]; } }else{ // En el caso de que se hayan seleccionado todos los elementos de la tabla // Recorremos las páginas buscando la primera en la que existan elementos seleccionados for (var pageAux=1;pageAux&lt;=lastPage;pageAux++){ if ($self._hasPageSelectedElements(pageAux)){ if (pageAux!==page){ newPage = pageAux; changePage = true; } break; } } } // Recuperamos el primer registro seleccionado del la página index = $self._getFirstSelectedElementOfPage(newPage); newPageIndex = index; break; case 'prev': // Navegar al anterior elemento seleccionado execute = true; // Obtenemos un array con los index de los registros seleccionados en la página actual selectedLines = $self._getSelectedLinesOfPage(page); // Obtenemos la posición que ocupa el elemento actual en el array de seleccionados currentArrayIndex = jQuery.inArray(npos[0]+1,selectedLines); // Se comprueba si ocupa el lugar del primer elemento seleccionado if (currentArrayIndex===0){ // En caso de tratarse del primer elemento seleccionado de la página, se deberá de realizar una navegación a la página anterior que disponga de elementos seleccionados changePage = true; // Recorremos las páginas anteriores for (var pageAux = page-1;pageAux&gt;=0;pageAux--){ // En caso de que la página disponga de elementos selecciondados. if ($self._hasPageSelectedElements(pageAux)){ newPage = pageAux; // Obtenemos los identificadores de los registros seleccionados de la nueva página selectedLines = $self._getSelectedLinesOfPage(pageAux); // Obtenemos el último registro seleccionado index = selectedLines[selectedLines.length-1]; break; } } }else{ // En caso de no tratarse del último elemento de la página, recuperamos el elemento anterior que haya sido seleccionado también index = selectedLines[currentArrayIndex-1]; } newPageIndex = index; break; case 'next': // Navegar al siguiente elemento seleccionado execute = true; // Obtenemos un array con los index de los registros seleccionados en la página actual selectedLines = $self._getSelectedLinesOfPage(page); // Obtenemos la posición que ocupa el elemento actual en el array de seleccionados currentArrayIndex = jQuery.inArray(npos[0]+1,selectedLines); // Se comprueba si ocupa el lugar del último elemento seleccionado if (currentArrayIndex===selectedLines.length-1){ // En caso de tratarse del último elemento seleccionado de la página, se deberá de realizar una navegación a la página siguiente que disponga de elementos seleccionados changePage = true; // Recorremos las páginas siguientes for (var pageAux = page+1;pageAux&lt;=lastPage;pageAux++){ // En caso de que la página disponga de elementos selecciondados. if ($self._hasPageSelectedElements(pageAux)){ newPage = pageAux; // Obtenemos los identificadores de los registros seleccionados de la nueva página selectedLines = $self._getSelectedLinesOfPage(pageAux); // Obtenemos el primer registro seleccionado index = selectedLines[0]; break; } } }else{ // En caso de no tratarse del último elemento de la página, recuperamos el elemento anterior que haya sido seleccionado también index = selectedLines[currentArrayIndex+1]; } newPageIndex = index; break; case 'last': // Navegar al ultimo elemento seleccionado execute = true; // Si no se han seleccionado todos los elementos if (!settings.multiselection.selectedAll){ // Se comprueba si la página en la que nos encontramos es la primera en la que se han seleccionado registros if (settings.multiselection.selectedPages[settings.multiselection.selectedPages.length-1]!==page){ // Marcamos el flag changePage para indicar que se debe de realizar una paginación changePage = true; // La nueva página será la primera página en la que se ha realizado una selección de registros newPage = settings.multiselection.selectedPages[settings.multiselection.selectedPages.length-1]; } }else{ // En el caso de que se hayan seleccionado todos los elementos de la tabla // Recorremos las páginas buscando la primera en la que existan elementos seleccionados for (var pageAux=lastPage;pageAux&gt;0;pageAux--){ if ($self._hasPageSelectedElements(pageAux)){ if (pageAux!==page){ newPage = pageAux; changePage = true; } break; } } } selectedLines = $self._getSelectedLinesOfPage(newPage); // Recuperamos el último registro seleccionado del la página index = selectedLines[selectedLines.length-1]; newPageIndex = index; } return [linkType, execute, changePage, index-1, npos, newPage, newPageIndex-1]; }; settings.doNavigation = function(arrParams, execute, changePage, index, npos, newPage, newPageIndex ){ var $self = this, settings = $self.data(&quot;settings&quot;), props = rp_ge[$self.attr(&quot;id&quot;)], linkType, execute, changePage, index, npos, newPage, newPageIndex, fncAfterclickPgButtons; if (jQuery.isArray(arrParams)){ linkType = arrParams[0]; execute = arrParams[1]; changePage = arrParams[2]; index = arrParams[3]; npos = arrParams[4]; newPage = arrParams[5]; newPageIndex = arrParams[6]; if (execute){ $self.rup_table(&quot;hideFormErrors&quot;, settings.formEdit.$detailForm); $self.triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, [linkType, settings.formEdit.$detailForm, npos[1][npos[index]]]); if (changePage){ $self.trigger(&quot;reloadGrid&quot;,[{page: newPage}]); $self.on(&quot;jqGridAfterLoadComplete.pagination&quot;,function(event,data){ var nextPagePos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(), newIndexPos = nextPagePos[1][newPageIndex]; // $self.jqGrid(&quot;setSelection&quot;, nextPagePos[1][newIndexPos]); jQuery.proxy(jQuery.jgrid.fillData, $self[0])(newIndexPos, $self[0], settings.formEdit.$detailForm.attr(&quot;id&quot;), settings.opermode); jQuery.proxy(jQuery.jgrid.updateNav, $self[0])(); // $self.find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_infoEditable'] img.ui-icon.ui-icon-pencil&quot;).remove(); settings.multiselection.rowForEditing=newIndexPos; $self.rup_table(&quot;clearHighlightedEditableRows&quot;); $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,newIndexPos, true)); // $($self.jqGrid(&quot;getInd&quot;,newIndexPos, true)).find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_infoEditable']&quot;).html($(&quot;&lt;img/&gt;&quot;).addClass(&quot;ui-icon ui-icon-pencil&quot;)[0]); $self.off(&quot;jqGridAfterLoadComplete.pagination&quot;); }); }else{ jQuery.proxy(jQuery.jgrid.fillData, $self[0])(npos[1][index], $self[0], settings.formEdit.$detailForm.attr(&quot;id&quot;), settings.opermode); // $self.jqGrid(&quot;setSelection&quot;, npos[1][index]); jQuery.proxy(jQuery.jgrid.updateNav, $self[0])(); // $self.find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_infoEditable'] img.ui-icon.ui-icon-pencil&quot;).remove(); settings.multiselection.rowForEditing=npos[1][index]; $self.rup_table(&quot;clearHighlightedEditableRows&quot;); $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,npos[1][index], true)); // $($self.jqGrid(&quot;getInd&quot;,npos[1][index], true)).find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_infoEditable']&quot;).html($(&quot;&lt;img/&gt;&quot;).addClass(&quot;ui-icon ui-icon-pencil&quot;)[0]); } $self.triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, [linkType,settings.formEdit.$detailForm,npos[1][npos[index]]]); fncAfterclickPgButtons = (props!==undefined?props.afterclickPgButtons:settings.afterclickPgButtons); if(jQuery.isFunction(fncAfterclickPgButtons)) { props.fncAfterclickPgButtons.call($self, linkType, settings.formEdit.$detailForm,npos[1][npos[index]]); } } } }; // Configuracion de los handler de los eventos $self.on({ /* * Capturador del evento jqGridSelectRow. * Se ejecuta cuando se selecciona una fila. * Realiza la gestión interna sobre la acción de (de)selección del usuario. * * event: Objeto event. * id: Identificador de la línea. * status: true en caso de selección, false en caso de deselección. * obj: Objeto interno del jqGrid. */ &quot;jqGridSelectRow.rupTable.multiselection&quot;: function(event, id, status, obj){ var page, firstSelectedId, firstSelectedLine, activeLineId, selectedLineId, toLine, fromLine, idsArr; if (obj!==false){ if (obj!==undefined &amp;&amp; jQuery(obj.target).hasClass(&quot;treeclick&quot;)){ return false;} if(jQuery.rup.isCtrlPressed()===true || jQuery.rup.isShiftPressed()===true){ window.getSelection().removeAllRanges(); } if(!(jQuery.rup.isCtrlPressed() || jQuery.rup.isShiftPressed()) &amp;&amp; (settings.multiboxonly === true &amp;&amp; obj !== undefined &amp;&amp; !(obj.originalEvent !== undefined &amp;&amp; jQuery(obj.originalEvent.target).is(&quot;:checkbox&quot;) &amp;&amp; jQuery(obj.originalEvent.target).attr(&quot;id&quot;).indexOf(&quot;jqg_&quot;)!==-1))){ $self.rup_table(&quot;deselectRemainingRows&quot;); } // Shift presed if(jQuery.rup.isShiftPressed()===true){ selectedLineId = $self.jqGrid(&quot;getInd&quot;,id, false); activeLineId = $self.rup_table(&quot;getActiveLineId&quot;); if (activeLineId&lt;selectedLineId){ toLine = selectedLineId-1; fromLine = activeLineId+1; }else{ toLine = activeLineId; fromLine = selectedLineId; } idsArr = $self.jqGrid(&quot;getDataIDs&quot;); for (var i=fromLine;i&lt;toLine;i++){ $self._processSelectedRow(settings, idsArr[i], status); $self.rup_table(&quot;highlightRowAsSelected&quot;, jQuery($self.jqGrid(&quot;getInd&quot;,idsArr[i], true))); } } // Se gestiona la selección o deselección del registro indicado $self._processSelectedRow(settings, id, status); // Actualización del número de registros seleccionados $self.rup_table(&quot;updateSelectedRowNumber&quot;); // Se cierra el feedback para (de)seleccionar el resto de registros settings.$internalFeedback.rup_feedback(&quot;close&quot;); // Se gestiona el icono de linea editable $self.rup_table(&quot;clearHighlightedEditableRows&quot;); // $self.find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_infoEditable'] img.ui-icon.ui-icon-pencil&quot;).remove(); if (status){ settings.multiselection.rowForEditing=id; $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,id, true)); // $($self.jqGrid(&quot;getInd&quot;,id, true)).find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_infoEditable']&quot;).html($(&quot;&lt;img/&gt;&quot;).addClass(&quot;ui-icon ui-icon-pencil&quot;)[0]); }else{ page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10); if ($self._hasPageSelectedElements(page)){ $self.rup_table(&quot;highlightFirstEditableRow&quot;); // firstSelectedLine = $self._getFirstSelectedElementOfPage(page); // firstSelectedId = $self.jqGrid(&quot;getDataIDs&quot;)[firstSelectedLine-1]; // settings.multiselection.rowForEditing=firstSelectedId; // $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,firstSelectedId, true)); } } } }, &quot;jqGridDblClickRow.rupTable.multiselection&quot;: function (event, rowid, iRow, iCol, e){ $self.rup_table(&quot;setSelection&quot;, rowid, true); $self.rup_table(&quot;clearHighlightedEditableRows&quot;); $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,rowid, true)); }, &quot;jqGridGridComplete.rup_table.multiselection&quot;: function(event){ var $self = $(this), settings = $self.data(&quot;settings&quot;); if ($self.rup_table(&quot;getGridParam&quot;,&quot;records&quot;)===0){ jQuery(jQuery(&quot;#cb_&quot;+$self.attr(&quot;id&quot;),settings.core.$tableDiv)[0]).attr(&quot;disabled&quot;, &quot;disabled&quot;); }else{ jQuery(jQuery(&quot;#cb_&quot;+$self.attr(&quot;id&quot;),settings.core.$tableDiv)[0]).removeAttr(&quot;disabled&quot;); } }, /* * Capturador del evento jqGridLoadComplete. * Se ejecuta una vez se haya completado la carga de la tabla. * * data: Objeto que contiene la carga de la tabla. * */ &quot;jqGridLoadComplete.rupTable.multiselection&quot;: function(data, xhr){ var self = $self[0], internalProps = self.p, page = $self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;), rowNum = $self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;), rows, selectedRows = settings.multiselection.selectedRowsPerPage[page], deselectedRows = settings.multiselection.deselectedRowsPerPage[page] || [], reorderedRow, reorderedRowPage, reorderedRowLine, reorderedRowId, arrayAuxRowsPerPage, arrayAuxLinesPerPage, arrayAuxIds, arrayAuxRows, arrayAuxPages, firstSelectedLine, firstSelectedId, indexAux, idAux; /* * REORDENAR LA SELECCION */ if (xhr.reorderedSelection !== undefined &amp;&amp; xhr.reorderedSelection !== null){ $self._initializeMultiselectionProps(settings); settings.multiselection.selectedAll=xhr.selectedAll; if (settings.multiselection.selectedAll===true){ arrayAuxRowsPerPage=settings.multiselection.deselectedRowsPerPage; arrayAuxLinesPerPage=settings.multiselection.deselectedLinesPerPage; arrayAuxIds=settings.multiselection.deselectedIds; arrayAuxRows=settings.multiselection.deselectedRows; arrayAuxPages=settings.multiselection.deselectedPages; settings.multiselection.numSelected=xhr.records-xhr.reorderedSelection.length; }else{ arrayAuxRowsPerPage=settings.multiselection.selectedRowsPerPage; arrayAuxLinesPerPage=settings.multiselection.selectedLinesPerPage; arrayAuxIds=settings.multiselection.selectedIds; arrayAuxRows=settings.multiselection.selectedRows; arrayAuxPages=settings.multiselection.selectedPages; settings.multiselection.numSelected=xhr.reorderedSelection.length; } for (var i=0;i&lt;xhr.reorderedSelection.length;i++){ reorderedRow = xhr.reorderedSelection[i]; reorderedRowPage = reorderedRow.page; reorderedRowLine = reorderedRow.pageLine; var retValue=&quot;&quot;; for (var j=0;j&lt;settings.primaryKey.length;j++){ retValue+=reorderedRow.pk[settings.primaryKey[j]]+settings.multiplePkToken; } reorderedRowId = retValue.substr(0, retValue.length-1); if (arrayAuxRowsPerPage[reorderedRowPage]===undefined){ arrayAuxRowsPerPage[reorderedRowPage]=[]; arrayAuxLinesPerPage[reorderedRowPage]=[]; } // Se almacena el Id del registro seleccionado if (jQuery.inArray(reorderedRowId, arrayAuxIds)===-1){ arrayAuxIds.push(reorderedRowId); arrayAuxRows.push({id:reorderedRowId, page:reorderedRowPage}); // arrayAuxRowsPerPage[reorderedRowPage].splice(reorderedRowLine,0,reorderedRowId); arrayAuxRowsPerPage[reorderedRowPage].push(reorderedRowId); arrayAuxLinesPerPage[reorderedRowPage].push(reorderedRowLine); if (arrayAuxRowsPerPage[reorderedRowPage].length&gt;0 &amp;&amp; jQuery.inArray(reorderedRowPage, arrayAuxPages)===-1){ jQuery.rup_utils.insertSorted(arrayAuxPages, reorderedRowPage); } } } // $self.rup_table(&quot;updateSelectedRowNumber&quot;); } // Se genera el evento que indica la modificación de los elementos seleccionados. $self.triggerHandler(&quot;rupTable_multiselectionUpdated&quot;); // Se cierra el feedback para seleccionar/deseleccionar el resto de registros settings.$internalFeedback.rup_feedback(&quot;close&quot;); // Se gestiona el icono de linea editable if ($self._hasPageSelectedElements(page)){ if (settings.multiselection.rowForEditing !==undefined &amp;&amp; jQuery.inArray(settings.multiselection.rowForEditing, $self.jqGrid(&quot;getDataIDs&quot;))!==-1){ $self.rup_table(&quot;highlightEditableRow&quot;, jQuery($self.jqGrid(&quot;getInd&quot;,settings.multiselection.rowForEditing,true)), true); }else{ $self.rup_table(&quot;highlightFirstEditableRow&quot;); } // firstSelectedLine = $self._getFirstSelectedElementOfPage(page); // firstSelectedId = $self.jqGrid(&quot;getDataIDs&quot;)[firstSelectedLine-1]; // settings.multiselection.rowForEditing=firstSelectedId; // $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,firstSelectedId, true)); } /** * ARROW */ //Cabecera var $checkAllTH = jQuery(&quot;[id='&quot;+settings.id+&quot;_cb']&quot;); if(settings.multiselection.headerContextMenu_enabled &amp;&amp; $checkAllTH.find(&quot;a&quot;).length === 0){ //Añadir solo una vez $checkAllTH.find('input').css(&quot;margin-right&quot;, &quot;1em&quot;); $self._addArrow($checkAllTH.find('input')); } //Fila $self.find(&quot;.cbox&quot;).css(&quot;margin-right&quot;, &quot;1em&quot;); if (settings.multiselection.rowContextMenu_enabled){ var isJerarquia = settings.jerarquia!==undefined?true:false, defaultOptions = jQuery.isEmptyObject(settings.multiselection.rowContextMenu.items); //Recorrer todas las filas $.each($self.find(&quot;.cbox&quot;), function(index, value) { //Añadir flecha $self._addArrow(jQuery(value)); //Deshabilitar flecha: Jerarquía + solo opciones por defecto + no tiene hijos if (isJerarquia &amp;&amp; defaultOptions &amp;&amp; $(value).parents(&quot;tr&quot;).find(&quot;.treeclick&quot;).hasClass(&quot;tree-leaf&quot;)){ jQuery(this).next(&quot;a&quot;).addClass(&quot;ui-state-disabled&quot;).off(&quot;click&quot;); } }); } }, /* * Capturador del evento jqGridSelectAll. * Se ejecuta cuando se realice una selección de todos los elementos de la página. * * event: Objeto event de jQuery * selectedRows: Array con los identificadores de los registros seleccionados en la página * status: true en caso de selección, false en caso de deselección. */ &quot;jqGridSelectAll.rupTable.multiselection&quot;: function(event, selectedRows, status){ var page = $self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;), selectMsg, deselectMsg, elementosRestantes, selectRestMsg, remainingSelectButton, remainingDeselectButton, cont; // Se oculta el posible mensaje de feedback que se muestre $self.triggerHandler(&quot;rupTable_internalFeedbackClose&quot;); // Se gestiona la selección de todos los registros de la página cont=0; for (var i=0;i&lt;selectedRows.length;i++){ if (selectedRows[i].indexOf(settings.id+&quot;ghead_&quot;) === -1){ $self._processSelectedRow(settings, selectedRows[i], status); cont++; } } selectMsg = jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,&quot;rup_grid.selectMsg&quot;, &quot;&lt;b&gt;&quot; + cont + &quot;&lt;/b&gt;&quot;, &quot;&lt;b&gt;&quot; + page + &quot;&lt;/b&gt;&quot;); deselectMsg = jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,&quot;rup_grid.deselectMsg&quot;, &quot;&lt;b&gt;&quot; + cont + &quot;&lt;/b&gt;&quot;, &quot;&lt;b&gt;&quot; + page + &quot;&lt;/b&gt;&quot;); // Se comprueba el valor de status para determinar si se está seleccionando (true) o deseleccionando (false) todos los registos de la página if (status){ // Se obtienen el número de registros restantes que quedan por seleccionar elementosRestantes = $self._getRemainingRecordNum(settings, selectedRows); if (elementosRestantes!==0){ // En caso de existir registros sin seleccionar se muestra el mensaje junto con un botón para permitir la selecón de dichos elementos selectRestMsg = jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,&quot;rup_table.selectRestMsg&quot;, elementosRestantes); remainingSelectButton = jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,&quot;rup_table.templates.multiselection.selectRemainingRecords&quot;, $self[0].id, selectRestMsg, jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.selectAll&quot;)); $self.rup_table(&quot;showFeedback&quot;, settings.$internalFeedback, selectMsg + remainingSelectButton, &quot;alert&quot;); } else { // Si no hay elementos restantes por seleccionar se muestra solo un mensaje informativo $self.rup_table(&quot;showFeedback&quot;, settings.$internalFeedback, selectMsg, &quot;alert&quot;); } // Se asocia el handler al evento click del botón de seleccionar el resto de registros $(&quot;#rup_grid_&quot;+$self[0].id+&quot;_selectAll&quot;).on(&quot;click&quot;, function(event){ $self.rup_table(&quot;selectRemainingRows&quot;); }); $self.rup_table(&quot;highlightFirstEditableRow&quot;); }else{ $self.rup_table(&quot;clearHighlightedEditableRows&quot;); // En caso de existir elementos seleccionados se muestra un mensaje que incluye un botón para permitir la deselección del todos los elementos seleccionados if (settings.multiselection.numSelected&gt;0){ selectRestMsg = jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,&quot;rup_table.deselectRestMsg&quot;, settings.multiselection.numSelected); remainingDeselectButton = jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,&quot;rup_table.templates.multiselection.deselectRemainingRecords&quot;, $self[0].id, selectRestMsg, jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.deSelectAll&quot;)); $self.rup_table(&quot;showFeedback&quot;, settings.$internalFeedback, deselectMsg + remainingDeselectButton, &quot;alert&quot;); } else { // Si no hay elementos restantes por deseleccionar se muestra solo un mensaje informativo $self.rup_table(&quot;showFeedback&quot;, settings.$internalFeedback, deselectMsg, &quot;alert&quot;); } // Se asocia el handler al evento click del botón de deseleccionar el resto de registros $(&quot;#rup_grid_&quot;+$self[0].id+&quot;_deselectAll&quot;).on(&quot;click&quot;, function(event){ $self.rup_table(&quot;deselectRemainingRows&quot;); }); } // Se actualiza el contador de elementos seleccionados $self.rup_table(&quot;updateSelectedRowNumber&quot;); }, &quot;rupTableAfterSearchNav.rupTable.multiselection rupTableSearchSuccess.rupTable.multiselection rupTableAfterDelete.rupTable.multiselection&quot;: function(){ var $self = $(this); $self.rup_table(&quot;resetSelection&quot;); }, &quot;rupTable_multiselectionUpdated.multiselection&quot;:function(){ var $self = $(this), self = $self[0], page = $self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;), settings = $self.data(&quot;settings&quot;), internalProps = self.p, rowNum = $self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;), rows, selectedRows = settings.multiselection.selectedRowsPerPage[page], deselectedRows = settings.multiselection.deselectedRowsPerPage[page] || []; // Se oculta el posible mensaje de feedback que se muestre $self.triggerHandler(&quot;rupTable_internalFeedbackClose&quot;); /* * Gestión de la persistencia de la multiselección entre páginas. * * El siguiente algoritmo permite mantener la selección de registros mientras se pagina. * Los registros seleccionados se mantienen almacenando sus identificadores. * En caso de seleccionar todos los elementos de la tabla se trabaja mediante lógica inversa, de modo que se almacenan los registros deseleccionados. */ // Se comprueba si se han seleccionado todos los registros de la tabla. if (settings.multiselection.selectedAll){ internalProps.selarrrow = []; rows = self.rows; // Para cada línea que muestra la tabla: for(var i=0;i&lt;rows.length;i++){ // Se comprueba si el registro se encuentra en el array de deseleccionados. if (jQuery.inArray(rows[i].id,deselectedRows)===-1){ // En caso de no ser un elemento deseleccionado se marca como seleccionado. $self.rup_table(&quot;highlightRowAsSelected&quot;, $(rows[i])); }else{ // En caso de ser un elemento deseleccionado se desmarca. $self.rup_table(&quot;clearHighlightedRowAsSelected&quot;, $(rows[i])); } }; // En caso de estar todos los elementos de la página seleccionados marcamos el check general if (deselectedRows.length===0){ settings.$selectAllCheck[internalProps.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); } }else{ // No se han seleccionado todos los resgistros de la página. if (selectedRows){ rows = self.rows; internalProps.selarrrow = []; // Para cada línea que muestra la tabla: for(var i=0;i&lt;rows.length;i++){ // Se comprueba si el registro se encuentra en el array de seleccionados if (jQuery.inArray(rows[i].id,selectedRows)!==-1){ // En caso de ser un elemento seleccionado, se marca como tal. $self.rup_table(&quot;highlightRowAsSelected&quot;, $(rows[i])); }else{ // En caso de no ser un elemento seleccionado se desmarca. $self.rup_table(&quot;clearHighlightedRowAsSelected&quot;, $(rows[i])); } }; // En caso de estar todos los elementos de la página seleccionados marcamos el check general if (selectedRows.length===rowNum){ settings.$selectAllCheck[internalProps.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); } } } $self.rup_table(&quot;updateSelectedRowNumber&quot;); }, &quot;rupTable_beforeAddRow.multiselection&quot;: function(event, addCloneOptions){ $self._checkSelectedElements(function(){ $self.jqGrid('editGridRow', &quot;new&quot;, addCloneOptions); $self.rup_table(&quot;resetSelection&quot;); $self.rup_table(&quot;clearHighlightedEditableRows&quot;); }); return false; }, &quot;jqGridAddEditAfterSubmit.rupTable.formEditing&quot;: function(event, res, postData, oper){ if (oper!=='edit'){ $self.rup_table(&quot;resetSelection&quot;); $self.rup_table(&quot;clearHighlightedEditableRows&quot;); } } }); if (settings.multiboxonly===true){ settings.multiselection.multiboxonly = true; } // Control del uso de Ctrl y Shift jQuery(&quot;body&quot;).on({ &quot;rup_ctrlKeyDown rup_shiftKeyDown&quot;: function(){ if (settings.multiselection.multiboxonly === true){ $self[0].p.multiboxonly = false; } return false; }, &quot;rup_ctrlKeyUp rup_shiftKeyUp&quot;: function(){ if (settings.multiselection.multiboxonly === true){ $self[0].p.multiboxonly = true; } return false; } }); /** * MENUS CONTEXTUALES */ jQuery.contextMenu('destroy', &quot;[id='&quot;+settings.id+&quot;_cb']&quot;); jQuery(&quot;[id='&quot;+settings.id+&quot;_cb']&quot;).rup_contextMenu({ trigger: &quot;none&quot;, callback: settings.multiselection.headerContextMenu.callback, items: $self._headerContextMenuItems(settings.multiselection.headerContextMenu, settings), position: function(contextMenu, x, y){ var offset = this.offset(); contextMenu.$menu.css({top : offset.top + this.height(), left : offset.left}); } }); if (settings.multiselection.rowContextMenu_enabled){ jQuery.contextMenu('destroy', &quot;td[aria-describedby='&quot;+settings.id+&quot;_cb']&quot;); jQuery(&quot;td[aria-describedby='&quot;+settings.id+&quot;_cb']&quot;).rup_contextMenu({ trigger: &quot;none&quot;, callback: settings.multiselection.rowContextMenu.callback, items: $self._rowContextMenuItems(settings.multiselection.rowContextMenu, settings), position: function(contextMenu, x, y){ var offset = this.offset(); contextMenu.$menu.css({top : offset.top + this.height(), left : offset.left}); } }); } } }); /** * Métodos públicos del plugin multiselection. * * Los métodos implementados son: * * resetSelection(): Limpia a selección realizada por el usuario. * updateSelectedRowNumber(): Refresca el identificador de resgistros seleccionados */ jQuery.fn.rup_table(&quot;extend&quot;,{ getSelectedIds: function(){ var $self = this, settings = $self.data(&quot;settings&quot;), multiselectionObj={}; if (!settings.multiselection.selectedAll){ if(settings.multiselection.selectedIds!=undefined){ if (settings.multiselection.selectedIds.length&gt;0){ jQuery.extend(true, multiselectionObj,{&quot;selectedIds&quot;:settings.multiselection.selectedIds}); } } jQuery.extend(true, multiselectionObj,{ &quot;selectedAll&quot;:false }); }else{ if (settings.multiselection.deselectedIds.length&gt;0){ jQuery.extend(true, multiselectionObj,{&quot;selectedIds&quot;:settings.multiselection.deselectedIds}); } jQuery.extend(true, multiselectionObj,{ &quot;selectedAll&quot;:true }); } return multiselectionObj; }, clearHighlightedEditableRows: function(){ var $self = this, settings = $self.data(&quot;settings&quot;); $self.find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_rupInfoCol'] span.ui-icon.ui-icon-pencil&quot;).removeClass(&quot;ui-icon-pencil&quot;); }, highlightFirstEditableRow: function(){ var $self = this, settings = $self.data(&quot;settings&quot;), page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10), firstSelectedLine, firstSelectedId; $self.rup_table(&quot;clearHighlightedEditableRows&quot;); if ($self._hasPageSelectedElements(page)){ firstSelectedLine = $self._getFirstSelectedElementOfPage(page); firstSelectedId = $self.jqGrid(&quot;getDataIDs&quot;)[firstSelectedLine-1]; settings.multiselection.rowForEditing=firstSelectedId; $self.rup_table(&quot;highlightEditableRow&quot;, $self.jqGrid(&quot;getInd&quot;,firstSelectedId, true)); } }, highlightEditableRow: function($row){ var $self = this, settings = $self.data(&quot;settings&quot;); $row = jQuery($row); $row.find(&quot;td[aria-describedby='&quot;+settings.id+&quot;_rupInfoCol'] span&quot;).addClass(&quot;ui-icon ui-icon-rupInfoCol ui-icon-pencil&quot;); }, refreshSelection: function(){ var $self = this; $self.triggerHandler(&quot;rupTable_multiselectionUpdated&quot;); }, resetSelection: function(){ var $self = this, settings = $self.data(&quot;settings&quot;); $self.jqGrid(&quot;resetSelection&quot;); $self._initializeMultiselectionProps(settings); $self.triggerHandler(&quot;rupTable_multiselectionUpdated&quot;); }, selectAllRows: function(event){ var $self = this, settings = $self.data(&quot;settings&quot;), arr, $row; $self.rup_table(&quot;selectRemainingRows&quot;); jQuery(&quot;#cb_&quot;+settings.id).attr(&quot;checked&quot;,&quot;checked&quot;); // Se marcan los registros de la tabla como marcados arr =$self.jqGrid(&quot;getDataIDs&quot;); for (var i=0;i&lt;arr.length;i++){ $row = jQuery($self.jqGrid(&quot;getInd&quot;,arr[i],true)); $self.rup_table(&quot;highlightRowAsSelected&quot;, $row); } $self.rup_table(&quot;highlightFirstEditableRow&quot;); }, selectRemainingRows: function(event){ var $self = this, settings = $self.data(&quot;settings&quot;); $self._initializeMultiselectionProps(settings); // Se marca el flag de todos seleccionados a true settings.multiselection.selectedAll=true; // Numero de registros seleccionados settings.multiselection.numSelected=$self.rup_table(&quot;getGridParam&quot;, &quot;records&quot;); // Se cierra el feedback para seleccionar/deseleccionar el resto de registros $self.rup_table(&quot;updateSelectedRowNumber&quot;); settings.$internalFeedback.rup_feedback(&quot;close&quot;); }, deselectAllRows: function(event){ var $self = this, settings = $self.data(&quot;settings&quot;), arr, $row, internalProps = $self[0].p; $self.rup_table(&quot;deselectRemainingRows&quot;); $self.rup_table(&quot;clearHighlightedEditableRows&quot;); jQuery(&quot;#cb_&quot;+settings.id).removeAttr(&quot;checked&quot;); // Se marcan los registros de la tabla como marcados arr =$self.jqGrid(&quot;getDataIDs&quot;); internalProps.selarrrow=[]; for (var i=0;i&lt;arr.length;i++){ $row = jQuery($self.jqGrid(&quot;getInd&quot;,arr[i],true)); $self.rup_table(&quot;clearHighlightedRowAsSelected&quot;, $row); } }, deselectRemainingRows: function(event){ var $self = this, settings = $self.data(&quot;settings&quot;); $self._initializeMultiselectionProps(settings); // Se cierra el feedback para seleccionar/deseleccionar el resto de registros $self.rup_table(&quot;updateSelectedRowNumber&quot;); settings.$internalFeedback.rup_feedback(&quot;close&quot;); }, /* * Actualiza el contador de la tabla que indica los registros seleccionados. */ updateSelectedRowNumber: function(){ var $self = $(this), settings = $self.data(&quot;settings&quot;); $(&quot;div .ui-paging-selected&quot;,settings.$pager).html(settings.multiselection.numSelected+&quot; &quot;+jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.selected&quot;)); $self.triggerHandler(&quot;rupTableSelectedRowNumberUpdated&quot;); } }); //******************************************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************************************* /** * Métodos privados del plugin multiselection. * * Los métodos implementados son: * * _addArrow (object): Añade flecha para desplegar menú contextual. * _headerContextMenuItems(options, settings): Configura el menú contextual del check de la cabecera. * _rowContextMenuItems(options, settings): Configura el menú contextual del check de cada línea (contiene configuración para Jerarquía). * _hasPageSelectedElements(paramPage): Determina (true/false) si la página indicada contiene registros seleccionados. * _initializeMultiselectionProps(settings): Inicializa los parámetros internos de control para la multiselección. * _getFirstSelectedElementOfPage(paramPage): Devuelve el primer registro seleccionado de la página indicada. * _getRemainingRecordNum(settings, selectedRows): Devuelve el número de elementos restantes que pueden ser seleccionados. * _getSelectedLinesOfPage(page): Devuelve el número de registros seleccionados de que dispone la página indicada por parámetro. * _processSelectedRow(settings, rowId, status): Gestióna la acción de seleción/deselección del registro indicado. */ jQuery.fn.rup_table(&quot;extend&quot;,{ //Añade flecha contextMenu _addArrow : function (object) { jQuery(object).after( jQuery(&quot;&lt;a /&gt;&quot;) .attr(&quot;href&quot;, &quot;javascript:void(0)&quot;) .addClass(&quot;ui-icon rup-jerarquia_checkmenu_arrow&quot;) .on('click', function(e) { $(this).parents(&quot;th, td&quot;).contextMenu(); }) ); }, _checkSelectedElements: function (okCallback){ var $self = $(this), self = $self[0], page = $self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;), settings = $self.data(&quot;settings&quot;); //if(prop.showMultiselectAlerts &amp;&amp; selectedRows &amp;&amp; selectedRows.length&gt;0){ if(settings.multiselection.numSelected &gt; 0){ $.rup_messages(&quot;msgConfirm&quot;, { message: $.rup.i18nParse($.rup.i18n.base,&quot;rup_maint.checkSelectedElems&quot;), title: $.rup.i18nParse($.rup.i18n.base,&quot;rup_maint.changes&quot;), OKFunction : function () { okCallback.call(); } }); }else{ okCallback.call(); } }, //Crear contextMenu cabecera _headerContextMenuItems : function (options, settings){ var $self = this, items = {}; if (options.selectAllPage){ jQuery.extend(items,{ &quot;selectAllPage&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.multiselection.selectAllPage&quot;) , icon: &quot;check&quot;, disabled: function(key, opt){ return $self._getSelectedLinesOfPage(parseInt($self.rup_table('getGridParam', 'page'))).length === $self.jqGrid('getGridParam', 'reccount'); }, callback: function(key, options) { $(&quot;[id='cb_&quot;+settings.id+&quot;']&quot;).attr(&quot;checked&quot;, &quot;checked&quot;).click().attr(&quot;checked&quot;, &quot;checked&quot;); } } }); } if (options.deselectAllPage){ jQuery.extend(items,{ &quot;deselectAllPage&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.multiselection.deselectAllPage&quot;), icon: &quot;uncheck&quot;, disabled: function(key, opt){ return $self._getSelectedLinesOfPage(parseInt($self.rup_table('getGridParam', 'page'))).length === 0; }, callback: function(key, options) { $(&quot;[id='cb_&quot;+settings.id+&quot;']&quot;).removeAttr(&quot;checked&quot;).click().removeAttr(&quot;checked&quot;); } } }); } if (options.separator){ jQuery.extend(items,{ &quot;separator&quot; : &quot;&quot; }); } if (options.selectAll){ jQuery.extend(items,{ &quot;selectAll&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.multiselection.selectAll&quot;), icon: &quot;check_all&quot;, disabled: function(key, opt){ return settings.multiselection.numSelected === $self.rup_table('getGridParam', 'records'); }, callback: function(key, options) { $self.rup_table(&quot;selectAllRows&quot;); } } }); } if (options.deselectAll){ jQuery.extend(items,{ &quot;deselectAll&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.multiselection.deselectAll&quot;), icon: &quot;uncheck_all&quot;, disabled: function(key, opt){ return settings.multiselection.numSelected === 0; }, callback: function(key, options) { $self.rup_table(&quot;deselectAllRows&quot;); } } }); } if (!jQuery.isEmptyObject(options.items)){ jQuery.extend(items, options.items); } return items; }, _rowContextMenuItems : function (options, settings){ var $self = this, items = {}; if (settings.jerarquia!==undefined &amp;&amp; settings.jerarquia.contextMenu){ if (options.selectChild){ jQuery.extend(items,{ &quot;selectChild&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.jerarquia.selectChild&quot;), icon: &quot;child&quot;, callback: function(key, options){ $self._getJerarquiaChildren(this, key, options); } } }); } if (options.selectDescendent){ jQuery.extend(items,{ &quot;selectDescendent&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.jerarquia.selectDescendent&quot;), icon: &quot;descendent&quot;, callback: function(key, options){ $self._getJerarquiaChildren(this, key, options); } } }); } if (options.separator){ jQuery.extend(items,{ &quot;separator&quot; : &quot;&quot; }); } if (options.deselectChild){ jQuery.extend(items,{ &quot;deselectChild&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.jerarquia.deselectChild&quot;), icon: &quot;uncheck&quot;, callback: function(key, options){ $self._getJerarquiaChildren(this, key, options); } } }); } if (options.deselectDescendent){ jQuery.extend(items,{ &quot;deselectDescendent&quot; : {name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.plugins.jerarquia.deselectDescendent&quot;), icon: &quot;uncheck&quot;, callback: function(key, options){ $self._getJerarquiaChildren(this, key, options); } } }); } } if (!jQuery.isEmptyObject(options.items)){ jQuery.extend(items, options.items); } return items; }, _refreshSelectedElements: function(settings, status, rowPK, tableRow){ //Variables para referenciar selección normal o inversa var rowsPerPage, linesPerPage, ids, rows, pages; if (settings.multiselection.selectedAll!==true){ rowsPerPage=settings.multiselection.selectedRowsPerPage; linesPerPage=settings.multiselection.selectedLinesPerPage; ids=settings.multiselection.selectedIds; rows=settings.multiselection.selectedRows; pages=settings.multiselection.selectedPages; }else{ rowsPerPage=settings.multiselection.deselectedRowsPerPage; linesPerPage=settings.multiselection.deselectedLinesPerPage; ids=settings.multiselection.deselectedIds; rows=settings.multiselection.deselectedRows; pages=settings.multiselection.deselectedPages; status=!status; } //Si no estaba seleccionado if (status){ if (jQuery.inArray(rowPK, ids)===-1){ //Añadir el elemento a los seleccionados if (settings.multiselection.selectedAll!==true){ settings.multiselection.numSelected++; } else { //Quitar el elemento de los no seleccionados (inversa) settings.multiselection.numSelected--; } //Controlar si no existe array para la página if (rowsPerPage[tableRow.page]===undefined){ rowsPerPage[tableRow.page]=[]; linesPerPage[tableRow.page]=[]; } //id ids.push(rowPK); //PAGINA [líneas] jQuery.rup_utils.insertSorted(linesPerPage[tableRow.page], tableRow.pageLine); //{ id : PK, page : PAGINA } rows.push({id:rowPK, page:tableRow.page}); //PAGINA [ids] rowsPerPage[tableRow.page].splice(tableRow.pageLine,0,rowPK); //PAGINA if (rowsPerPage[tableRow.page].length&gt;0 &amp;&amp; jQuery.inArray(tableRow.page, pages)===-1){ jQuery.rup_utils.insertSorted(pages, tableRow.page); } } } else { if (jQuery.inArray(rowPK, ids)!==-1){ //Quitar el elemento a los seleccionados if (settings.multiselection.selectedAll!==true){ settings.multiselection.numSelected--; } else { //añadir el elemento de los no seleccionados (inversa) settings.multiselection.numSelected++; } //id ids.splice(jQuery.inArray(rowPK, ids), 1); //PAGINA [líneas] linesPerPage[tableRow.page].splice(jQuery.inArray(tableRow.pageLine, linesPerPage[tableRow.page]), 1); //{ id : PK, page : PAGINA } var selectedRowObjStr = JSON.stringify({id: rowPK, page: tableRow.page}), indexInArray = null; jQuery.grep(rows, function(element, index){ if (JSON.stringify(element) === selectedRowObjStr){ indexInArray = index; }; }); rows.splice(indexInArray, 1); //PAGINA [ids] rowsPerPage[tableRow.page].splice(jQuery.inArray(rowPK, rowsPerPage[tableRow.page]),1); //PAGINA if (rowsPerPage[tableRow.page].length==0 &amp;&amp; jQuery.inArray(tableRow.page, pages)!==-1){ pages.splice(jQuery.inArray(tableRow.page,pages),1); } } } }, _hasPageSelectedElements: function(paramPage){ var $self = this, settings = $self.data(&quot;settings&quot;), rowsPerPage, page = (typeof paramPage ===&quot;string&quot;?parseInt(paramPage,10):paramPage); // Se comprueba si se han seleccionado todos los registros de la tabla if (!settings.multiselection.selectedAll){ // En caso de no haberse seleccionado todos los registros de la tabla // Comprobamos si en la página indicada se ha seleccionado un elemento return (jQuery.inArray(page, settings.multiselection.selectedPages)!== -1); }else{ // En caso de haberse seleccionado todos los registros de la tabla // Generamos un array inicializado con los index de las lineas de las tablas rowsPerPage = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;),10); // Obtenemos el número de registro por página que se visualizan // Se comprueba si el número de registros deseleccionados es igual al número de registros por página, en cuyo caso significará que no hay elementos seleccionados if (jQuery.inArray(page, settings.multiselection.deselectedPages) !==-1 &amp;&amp; settings.multiselection.deselectedLinesPerPage[page].length===rowsPerPage){ return false; } return true; } }, _initializeMultiselectionProps: function(settings){ // Se almacenan en los settings internos las estructuras de control de los registros seleccionados if (settings.multiselection===undefined){ settings.multiselection={}; } // Flag indicador de selección de todos los registros settings.multiselection.selectedAll=false; // Numero de registros seleccionados settings.multiselection.numSelected=0; // Propiedades de selección de registros settings.multiselection.selectedRowsPerPage=[]; settings.multiselection.selectedLinesPerPage=[]; settings.multiselection.selectedRows=[]; settings.multiselection.selectedIds=[]; settings.multiselection.selectedPages=[]; // Propiedades de deselección de registros settings.multiselection.deselectedRowsPerPage=[]; settings.multiselection.deselectedLinesPerPage=[]; settings.multiselection.deselectedRows=[]; settings.multiselection.deselectedIds=[]; settings.multiselection.deselectedPages=[]; }, _getFirstSelectedElementOfPage: function(paramPage){ var $self = this, settings = $self.data(&quot;settings&quot;), rowsPerPage, page = (typeof paramPage ===&quot;string&quot;?parseInt(paramPage,10):paramPage); // Se comprueba si se han seleccionado todos los registros de la tabla if (!settings.multiselection.selectedAll){ // En caso de no haberse seleccionado todos los registros de la tabla // Comprobamos si en la página indicada se ha seleccionado un elemento if (jQuery.inArray(page, settings.multiselection.selectedPages)=== -1){ return false; } // En caso de que se haya seleccionado un elemento en la página indicada se devuelve el primero return settings.multiselection.selectedLinesPerPage[page][0]; }else{ // En caso de haberse seleccionado todos los registros de la tabla // Si no se han deseleccionado registros en la página se devuelve el primer indice if (jQuery.inArray(page, settings.multiselection.deselectedPages)=== -1){ return 1; } // Obtenemos el número de registro por página que se visualizan rowsPerPage = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;),10); // Se comprueba si el número de registros deseleccionados es igual al número de registros por página, en cuyo caso significará que no hay eleme if (settings.multiselection.deselectedLinesPerPage[page].length===rowsPerPage){ return false; } // Obtenemos el primer elemento de la página que no ha sido deseleccionado for (var i=1;i&lt;=rowsPerPage;i++){ if (jQuery.inArray(i, settings.multiselection.deselectedLinesPerPage[page])=== -1){ return i; } } } }, _getRemainingRecordNum: function(settings, selectedRows){ var $self = this, totalRegistros = $self.rup_table(&quot;getGridParam&quot;, &quot;records&quot;), registrosPagina = $self.rup_table(&quot;getGridParam&quot;, &quot;reccount&quot;), registrosSelPagina = selectedRows.length, registrosSelTotal = settings.multiselection.numSelected, elementosRestantes = ((totalRegistros - registrosPagina) !== 0 )? totalRegistros - registrosPagina - (registrosSelTotal - registrosSelPagina) : 0 ; return elementosRestantes; }, _getSelectedLinesOfPage: function(page){ var $self = this, settings = $self.data(&quot;settings&quot;), rowsPerPage, records, lastPage, inverseArray=[]; // Se comprueba si se han seleccionado todos los registros de la tabla if (!settings.multiselection.selectedAll){ // En caso de no haberse seleccionado todos los registros de la tabla // Comprobamos si en la página indicada se ha seleccionado un elemento if (jQuery.inArray(page, settings.multiselection.selectedPages)=== -1){ return []; } // En caso de que se haya seleccionado un elemento en la página indicada se devuelve el array de seleccionados return settings.multiselection.selectedLinesPerPage[page]; }else{ // En caso de haberse seleccionado todos los registros de la tabla // Generamos un array inicializado con los index de las lineas de las tablas rowsPerPage = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;),10); records = $self.rup_table(&quot;getGridParam&quot;, &quot;records&quot;); lastPage = parseInt(Math.ceil(records/rowsPerPage,10)); // En caso de ser la última página se recalcula el número de elementos que se muestran en ella if (page===lastPage){ rowsPerPage = records - ((lastPage-1)*rowsPerPage); } for(var i=1;i&lt;=rowsPerPage;i++){ inverseArray[i-1]=i; } // Si no se han deseleccionado registros en la página se devuelve el array al completo if (jQuery.inArray(page, settings.multiselection.deselectedPages)=== -1){ return inverseArray; } // Obtenemos el número de registro por página que se visualizan // Se comprueba si el número de registros deseleccionados es igual al número de registros por página, en cuyo caso significará que no hay elementos seleccionados if (settings.multiselection.deselectedLinesPerPage[page].length===rowsPerPage){ return []; } // Se eliminan del array inicializado con todos los identificadores de las lineas, las que han sido deseleccionadas return jQuery.grep(inverseArray, function(elem){ return (jQuery.inArray(elem, settings.multiselection.deselectedLinesPerPage[page])===-1); }); } }, _processSelectedRow: function(settings, rowId, status){ var $self = this, page = $self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;), pageInt = parseInt(page), lineIndex, indexInArray, indexAtPage, indexPage; // Se selecciona o deselecciona el elemento en los arrays que almacenan los registros seleccionados. if (status){ if (settings.multiselection.selectedAll){ // Se ha deseleccionado un elemento // Se almacena el Id del registro seleccionado indexInArray = jQuery.inArray(rowId, settings.multiselection.deselectedIds); if (indexInArray!=-1){ settings.multiselection.deselectedIds.splice(indexInArray,1); settings.multiselection.deselectedRows.splice(indexInArray,1); indexAtPage = jQuery.inArray(rowId, settings.multiselection.deselectedRowsPerPage[page]); settings.multiselection.deselectedRowsPerPage[page].splice(indexAtPage,1); settings.multiselection.deselectedLinesPerPage[page].splice(indexAtPage,1); if (settings.multiselection.deselectedRowsPerPage[page].length===0){ indexPage = jQuery.inArray(pageInt, settings.multiselection.deselectedPages); if (indexPage!==-1){ settings.multiselection.deselectedPages.splice(indexPage, 1); } } settings.multiselection.numSelected++; } }else{ // Se ha seleccionado un elemento // Se comprueba si está creado el array correspondiente para la página actual if (settings.multiselection.selectedRowsPerPage[page]===undefined){ settings.multiselection.selectedRowsPerPage[page]=[]; settings.multiselection.selectedLinesPerPage[page]=[]; } // Se almacena el Id del registro seleccionado if (jQuery.inArray(rowId, settings.multiselection.selectedIds)===-1){ settings.multiselection.selectedIds.push(rowId); settings.multiselection.selectedRows.push({id:rowId, page:page}); // lineIndex = jQuery.rup_utils.insertSorted(settings.multiselection.selectedLinesPerPage[page], $self.jqGrid(&quot;getInd&quot;,rowId)); lineIndex = jQuery.rup_utils.insertSorted(settings.multiselection.selectedLinesPerPage[page], $self._getLineIndex(rowId)); settings.multiselection.selectedRowsPerPage[page].splice(lineIndex,0,rowId); if (settings.multiselection.selectedRowsPerPage[page].length&gt;0 &amp;&amp; jQuery.inArray(pageInt, settings.multiselection.selectedPages)===-1){ jQuery.rup_utils.insertSorted(settings.multiselection.selectedPages, pageInt); } settings.multiselection.numSelected++; } } }else{ if (settings.multiselection.selectedAll){ // Se ha seleccionado un elemento // Se comprueba si está creado el array correspondiente para la página actual if (settings.multiselection.deselectedRowsPerPage[page]===undefined){ settings.multiselection.deselectedRowsPerPage[page]=[]; settings.multiselection.deselectedLinesPerPage[page]=[]; } // Se almacena el Id del registro seleccionado if (jQuery.inArray(rowId, settings.multiselection.deselectedIds)===-1){ settings.multiselection.deselectedIds.push(rowId); settings.multiselection.deselectedRows.push({id:rowId, page:page}); // lineIndex = jQuery.rup_utils.insertSorted(settings.multiselection.deselectedLinesPerPage[page], $self.jqGrid(&quot;getInd&quot;,rowId)); lineIndex = jQuery.rup_utils.insertSorted(settings.multiselection.deselectedLinesPerPage[page], $self._getLineIndex(rowId)); settings.multiselection.deselectedRowsPerPage[page].splice(lineIndex,0,rowId); if (settings.multiselection.deselectedRowsPerPage[page].length&gt;0 &amp;&amp; jQuery.inArray(pageInt, settings.multiselection.deselectedPages)===-1){ jQuery.rup_utils.insertSorted(settings.multiselection.deselectedPages, pageInt); } settings.multiselection.numSelected--; } }else{ // Se ha deseleccionado un elemento // Se almacena el Id del registro seleccionado index = jQuery.inArray(rowId, settings.multiselection.selectedIds); if (index!=-1){ settings.multiselection.selectedIds.splice(index,1); settings.multiselection.selectedRows.splice(index,1); indexAtPage = jQuery.inArray(rowId, settings.multiselection.selectedRowsPerPage[page]); settings.multiselection.selectedRowsPerPage[page].splice(indexAtPage,1); settings.multiselection.selectedLinesPerPage[page].splice(indexAtPage,1); if (settings.multiselection.selectedRowsPerPage[page].length===0){ indexPage = jQuery.inArray(pageInt, settings.multiselection.selectedPages); if (indexPage!==-1){ settings.multiselection.selectedPages.splice(indexPage, 1); } } settings.multiselection.numSelected--; } } } $self.rup_table(&quot;updateSelectedRowNumber&quot;); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* jQuery.fn.rup_table.plugins.multiselection = jQuery.fn.rup_table.plugins.multiselection || {}; jQuery.fn.rup_table.plugins.multiselection.defaults = { showGridInfoCol:true, formEdit:{ autoselectFirstRecord: false }, inlineEdit:{ autoselectFirstRecord: false }, multiselection:{ defaultEditableInfoCol:{ name: &quot;infoEditable&quot;, index: &quot;infoEditable&quot;, editable:false, width:&quot;15em&quot;, search:false }, headerContextMenu_enabled : true, headerContextMenu: { selectAllPage : true, deselectAllPage : true, separator : true, selectAll : true, deselectAll : true, items : {} }, rowContextMenu_enabled : false, rowContextMenu: { selectChild : true, selectDescendent : true, separator : true, deselectChild : true, deselectDescendent : true, items : {} } } }; jQuery.fn.rup_table.defaults.multiselection = { loadBeforeSend: function rup_table_defaults_loadBeforeSend(xhr, settings){ // Se modifica la request para incluir las siguientes cabeceras: // Se añade la cabecera JQGridModel para indicar que la petición ha sido realizada por el componente rup_table xhr.setRequestHeader(&quot;JQGridModel&quot;, &quot;true&quot;); // Se indica que el tipo de contenido enviado en la cabecera es application/jsons xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/json&quot;); } }; })(jQuery); × Search results Close "},"core_utils_jquery.json-2.2.js.html":{"id":"core_utils_jquery.json-2.2.js.html","title":"Source: core/utils/jquery.json-2.2.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: core/utils/jquery.json-2.2.js /* * jQuery JSON Plugin * version: 2.1 (2009-08-14) * * This document is licensed as free software under the terms of the * MIT License: http://www.opensource.org/licenses/mit-license.php * * Brantley Harris wrote this plugin. It is based somewhat on the JSON.org * website's http://www.json.org/json2.js, which proclaims: * &quot;NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.&quot;, a sentiment that * I uphold. * * It is also influenced heavily by MochiKit's serializeJSON, which is * copyrighted 2005 by Bob Ippolito. */ (function($) { /** jQuery.toJSON( json-serializble ) Converts the given argument into a JSON respresentation. If an object has a &quot;toJSON&quot; function, that will be used to get the representation. Non-integer/string keys are skipped in the object, as are keys that point to a function. json-serializble: The *thing* to be converted. **/ $.toJSON = function(o) { if (typeof(JSON) == 'object' &amp;&amp; JSON.stringify) return JSON.stringify(o); var type = typeof(o); if (o === null) return &quot;null&quot;; if (type == &quot;undefined&quot;) return undefined; if (type == &quot;number&quot; || type == &quot;boolean&quot;) return o + &quot;&quot;; if (type == &quot;string&quot;) return $.quoteString(o); if (type == 'object') { if (typeof o.toJSON == &quot;function&quot;) return $.toJSON( o.toJSON() ); if (o.constructor === Date) { var month = o.getUTCMonth() + 1; if (month &lt; 10) month = '0' + month; var day = o.getUTCDate(); if (day &lt; 10) day = '0' + day; var year = o.getUTCFullYear(); var hours = o.getUTCHours(); if (hours &lt; 10) hours = '0' + hours; var minutes = o.getUTCMinutes(); if (minutes &lt; 10) minutes = '0' + minutes; var seconds = o.getUTCSeconds(); if (seconds &lt; 10) seconds = '0' + seconds; var milli = o.getUTCMilliseconds(); if (milli &lt; 100) milli = '0' + milli; if (milli &lt; 10) milli = '0' + milli; return '&quot;' + year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds + '.' + milli + 'Z&quot;'; } if (o.constructor === Array) { var ret = []; for (var i = 0; i &lt; o.length; i++) ret.push( $.toJSON(o[i]) || &quot;null&quot; ); return &quot;[&quot; + ret.join(&quot;,&quot;) + &quot;]&quot;; } var pairs = []; for (var k in o) { var name; var type = typeof k; if (type == &quot;number&quot;) name = '&quot;' + k + '&quot;'; else if (type == &quot;string&quot;) name = $.quoteString(k); else continue; //skip non-string or number keys if (typeof o[k] == &quot;function&quot;) continue; //skip pairs where the value is a function. var val = $.toJSON(o[k]); pairs.push(name + &quot;:&quot; + val); } return &quot;{&quot; + pairs.join(&quot;, &quot;) + &quot;}&quot;; } }; /** jQuery.evalJSON(src) Evaluates a given piece of json source. **/ $.evalJSON = function(src) { if (typeof(JSON) == 'object' &amp;&amp; JSON.parse) return JSON.parse(src); return eval(&quot;(&quot; + src + &quot;)&quot;); }; /** jQuery.secureEvalJSON(src) Evals JSON in a way that is *more* secure. **/ $.secureEvalJSON = function(src) { if (typeof(JSON) == 'object' &amp;&amp; JSON.parse) return JSON.parse(src); var filtered = src; filtered = filtered.replace(/\\\\[&quot;\\\\\\/bfnrtu]/g, '@'); filtered = filtered.replace(/&quot;[^&quot;\\\\\\n\\r]*&quot;|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']'); filtered = filtered.replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''); if (/^[\\],:{}\\s]*$/.test(filtered)) return eval(&quot;(&quot; + src + &quot;)&quot;); else throw new SyntaxError(&quot;Error parsing JSON, source is not valid.&quot;); }; /** jQuery.quoteString(string) Returns a string-repr of a string, escaping quotes intelligently. Mostly a support function for toJSON. Examples: &gt;&gt;&gt; jQuery.quoteString(&quot;apple&quot;) &quot;apple&quot; &gt;&gt;&gt; jQuery.quoteString('&quot;Where are we going?&quot;, she asked.') &quot;\\&quot;Where are we going?\\&quot;, she asked.&quot; **/ $.quoteString = function(string) { if (string.match(_escapeable)) { return '&quot;' + string.replace(_escapeable, function (a) { var c = _meta[a]; if (typeof c === 'string') return c; c = a.charCodeAt(); return '\\\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16); }) + '&quot;'; } return '&quot;' + string + '&quot;'; }; var _escapeable = /[&quot;\\\\\\x00-\\x1f\\x7f-\\x9f]/g; var _meta = { '\\b': '\\\\b', '\\t': '\\\\t', '\\n': '\\\\n', '\\f': '\\\\f', '\\r': '\\\\r', '&quot;' : '\\\\&quot;', '\\\\': '\\\\\\\\' }; })(jQuery); × Search results Close "},"core_utils_jquery.form.js.html":{"id":"core_utils_jquery.form.js.html","title":"Source: core/utils/jquery.form.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: core/utils/jquery.form.js /*! * jQuery Form Plugin * version: 2.93 (30-NOV-2011) * @requires jQuery v1.3.2 or later * * Examples and documentation at: http://malsup.com/jquery/form/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl.html */ ;(function($) { /* Usage Note: ----------- Do not use both ajaxSubmit and ajaxForm on the same form. These functions are intended to be exclusive. Use ajaxSubmit if you want to bind your own submit handler to the form. For example, $(document).ready(function() { $('#myForm').bind('submit', function(e) { e.preventDefault(); // &lt;-- important $(this).ajaxSubmit({ target: '#output' }); }); }); Use ajaxForm when you want the plugin to manage all the event binding for you. For example, $(document).ready(function() { $('#myForm').ajaxForm({ target: '#output' }); }); When using ajaxForm, the ajaxSubmit function will be invoked for you at the appropriate time. */ /** * ajaxSubmit() provides a mechanism for immediately submitting * an HTML form using AJAX. */ $.fn.ajaxSubmit = function(options) { // fast fail if nothing selected (http://dev.jquery.com/ticket/2752) if (!this.length) { log('ajaxSubmit: skipping submit process - no element selected'); return this; } var method, action, url, $form = this; if (typeof options == 'function') { options = { success: options }; } method = this.attr('method'); action = this.attr('action'); url = (typeof action === 'string') ? $.trim(action) : ''; url = url || window.location.href || ''; if (url) { // clean url (don't include hash vaue) url = (url.match(/^([^#]+)/)||[])[1]; } options = $.extend(true, { url: url, success: $.ajaxSettings.success, type: method || 'GET', iframeSrc: /^https/i.test(window.location.href || '') ? 'javascript:false' : 'about:blank' }, options); // hook for manipulating the form data before it is extracted; // convenient for use with rich editors like tinyMCE or FCKEditor var veto = {}; this.trigger('form-pre-serialize', [this, options, veto]); if (veto.veto) { log('ajaxSubmit: submit vetoed via form-pre-serialize trigger'); return this; } // provide opportunity to alter form data before it is serialized if (options.beforeSerialize &amp;&amp; options.beforeSerialize(this, options) === false) { log('ajaxSubmit: submit aborted via beforeSerialize callback'); return this; } var traditional = options.traditional; if ( traditional === undefined ) { traditional = $.ajaxSettings.traditional; } var qx,n,v,a = options.propperFormSerialization !== false?this.formToArray(options.semantic):[]; if (options.data) { options.extraData = options.data; qx = $.param(options.data, traditional); } // give pre-submit callback an opportunity to abort the submit if (options.beforeSubmit &amp;&amp; options.beforeSubmit(a, this, options) === false) { log('ajaxSubmit: submit aborted via beforeSubmit callback'); return this; } // fire vetoable 'validate' event this.trigger('form-submit-validate', [a, this, options, veto]); if (veto.veto) { log('ajaxSubmit: submit vetoed via form-submit-validate trigger'); return this; } var q = $.param(a, traditional); if (qx) { q = ( q ? (q + '&amp;' + qx) : qx ); } if (options.type.toUpperCase() == 'GET') { options.url += (options.url.indexOf('?') &gt;= 0 ? '&amp;' : '?') + q; options.data = null; // data is null for 'get' } else { options.data = q; // data is the query string for 'post' } var callbacks = []; if (options.resetForm) { callbacks.push(function() { $form.resetForm(); }); } if (options.clearForm) { callbacks.push(function() { $form.clearForm(options.includeHidden); }); } // perform a load on the target only if dataType is not provided if (!options.dataType &amp;&amp; options.target) { var oldSuccess = options.success || function(){}; callbacks.push(function(data) { var fn = options.replaceTarget ? 'replaceWith' : 'html'; $(options.target)[fn](data).each(oldSuccess, arguments); }); } else if (options.success) { callbacks.push(options.success); } options.success = function(data, status, xhr) { // jQuery 1.4+ passes xhr as 3rd arg var context = options.context || options; // jQuery 1.4+ supports scope context for (var i=0, max=callbacks.length; i &lt; max; i++) { callbacks[i].apply(context, [data, status, xhr || $form, $form]); } }; // are there files to upload? var fileInputs = $('input:file:enabled[value]', this); // [value] (issue #113) var hasFileInputs = fileInputs.length &gt; 0; var mp = 'multipart/form-data'; var multipart = ($form.attr('enctype') == mp || $form.attr('encoding') == mp); var fileAPI = !!(hasFileInputs &amp;&amp; fileInputs.get(0).files &amp;&amp; window.FormData); log(&quot;fileAPI :&quot; + fileAPI); var shouldUseFrame = (hasFileInputs || multipart) &amp;&amp; !fileAPI; // options.iframe allows user to force iframe mode // 06-NOV-09: now defaulting to iframe mode if file input is detected if (options.iframe !== false &amp;&amp; (options.iframe || shouldUseFrame)) { // hack to fix Safari hang (thanks to Tim Molendijk for this) // see: http://groups.google.com/group/jquery-dev/browse_thread/thread/36395b7ab510dd5d if (options.closeKeepAlive) { $.get(options.closeKeepAlive, function() { fileUploadIframe(a); }); } else { fileUploadIframe(a); } } else if ((hasFileInputs || multipart) &amp;&amp; fileAPI) { options.progress = options.progress || $.noop; fileUploadXhr(a); } else { $.ajax(options); } // fire 'notify' event this.trigger('form-submit-notify', [this, options]); return this; // XMLHttpRequest Level 2 file uploads (big hat tip to francois2metz) function fileUploadXhr(a) { var formdata = new FormData(); for (var i=0; i &lt; a.length; i++) { if (a[i].type == 'file') continue; formdata.append(a[i].name, a[i].value); } $form.find('input:file:enabled').each(function(){ var name = $(this).attr('name'), files = this.files; if (name) { for (var i=0; i &lt; files.length; i++) formdata.append(name, files[i]); } }); if (options.extraData) { for (var k in options.extraData) formdata.append(k, options.extraData[k]) } options.data = null; var _beforeSend = options.beforeSend; options.beforeSend = function(xhr, options) { options.data = formdata; if (xhr.upload) { // unfortunately, jQuery doesn't expose this prop (http://bugs.jquery.com/ticket/10190) xhr.upload.onprogress = function(event) { options.progress(event.position, event.total); } } if (_beforeSend) _beforeSend.call(options, xhr, options); } $.ajax(options); } // private function for handling file uploads (hat tip to YAHOO!) function fileUploadIframe(a) { var form = $form[0], el, i, s, g, id, $io, io, xhr, sub, n, timedOut, timeoutHandle; var useProp = !!$.fn.prop; if (a) { if ( useProp ) { // ensure that every serialized input is still enabled for (i=0; i &lt; a.length; i++) { el = $(form[a[i].name]); el.prop('disabled', false); } } else { for (i=0; i &lt; a.length; i++) { el = $(form[a[i].name]); el.removeAttr('disabled'); } }; } if ($(':input[name=submit],:input[id=submit]', form).length) { // if there is an input with a name or id of 'submit' then we won't be // able to invoke the submit fn on the form (at least not x-browser) alert('Error: Form elements must not have name or id of &quot;submit&quot;.'); return; } s = $.extend(true, {}, $.ajaxSettings, options); s.context = s.context || s; id = 'jqFormIO' + (new Date().getTime()); if (s.iframeTarget) { $io = $(s.iframeTarget); n = $io.attr('name'); if (n == null) $io.attr('name', id); else id = n; } else { $io = $('&lt;iframe name=&quot;' + id + '&quot; src=&quot;'+ s.iframeSrc +'&quot; /&gt;'); $io.css({ position: 'absolute', top: '-1000px', left: '-1000px' }); } io = $io[0]; xhr = { // mock object aborted: 0, responseText: null, responseXML: null, status: 0, statusText: 'n/a', getAllResponseHeaders: function() {}, getResponseHeader: function() {}, setRequestHeader: function() {}, abort: function(status) { var e = (status === 'timeout' ? 'timeout' : 'aborted'); log('aborting upload... ' + e); this.aborted = 1; $io.attr('src', s.iframeSrc); // abort op in progress xhr.error = e; s.error &amp;&amp; s.error.call(s.context, xhr, e, status); g &amp;&amp; $.event.trigger(&quot;ajaxError&quot;, [xhr, s, e]); s.complete &amp;&amp; s.complete.call(s.context, xhr, e); } }; g = s.global; // trigger ajax global events so that activity/block indicators work like normal if (g &amp;&amp; ! $.active++) { $.event.trigger(&quot;ajaxStart&quot;); } if (g) { $.event.trigger(&quot;ajaxSend&quot;, [xhr, s]); } if (s.beforeSend &amp;&amp; s.beforeSend.call(s.context, xhr, s) === false) { if (s.global) { $.active--; } return; } if (xhr.aborted) { return; } // add submitting element to data if we know it sub = form.clk; if (sub) { n = sub.name; if (n &amp;&amp; !sub.disabled) { s.extraData = s.extraData || {}; s.extraData[n] = sub.value; if (sub.type == &quot;image&quot;) { s.extraData[n+'.x'] = form.clk_x; s.extraData[n+'.y'] = form.clk_y; } } } var CLIENT_TIMEOUT_ABORT = 1; var SERVER_ABORT = 2; function getDoc(frame) { var doc = frame.contentWindow ? frame.contentWindow.document : frame.contentDocument ? frame.contentDocument : frame.document; return doc; } // Rails CSRF hack (thanks to Yvan BARTHƒLEMY) var csrf_token = $('meta[name=csrf-token]').attr('content'); var csrf_param = $('meta[name=csrf-param]').attr('content'); if (csrf_param &amp;&amp; csrf_token) { s.extraData = s.extraData || {}; s.extraData[csrf_param] = csrf_token; } // take a breath so that pending repaints get some cpu time before the upload starts function doSubmit() { // make sure form attrs are set var t = $form.attr('target'), a = $form.attr('action'); // update form attrs in IE friendly way form.setAttribute('target',id); if (!method) { form.setAttribute('method', 'POST'); } if (a != s.url) { form.setAttribute('action', s.url); } // ie borks in some cases when setting encoding if (! s.skipEncodingOverride &amp;&amp; (!method || /post/i.test(method))) { $form.attr({ encoding: 'multipart/form-data', enctype: 'multipart/form-data' }); } // support timout if (s.timeout) { timeoutHandle = setTimeout(function() { timedOut = true; cb(CLIENT_TIMEOUT_ABORT); }, s.timeout); } // look for server aborts function checkState() { try { var state = getDoc(io).readyState; log('state = ' + state); if (state.toLowerCase() == 'uninitialized') setTimeout(checkState,50); } catch(e) { log('Server abort: ' , e, ' (', e.name, ')'); cb(SERVER_ABORT); timeoutHandle &amp;&amp; clearTimeout(timeoutHandle); timeoutHandle = undefined; } } // add &quot;extra&quot; data to form if provided in options var extraInputs = []; try { if (s.extraData) { for (var n in s.extraData) { extraInputs.push( $('&lt;input type=&quot;hidden&quot; name=&quot;'+n+'&quot;&gt;').attr('value',s.extraData[n]) .appendTo(form)[0]); } } if (!s.iframeTarget) { // add iframe to doc and submit the form $io.appendTo('body'); io.attachEvent ? io.attachEvent('onload', cb) : io.addEventListener('load', cb, false); } setTimeout(checkState,15); form.submit(); } finally { // reset attrs and remove &quot;extra&quot; input elements form.setAttribute('action',a); if(t) { form.setAttribute('target', t); } else { $form.removeAttr('target'); } $(extraInputs).remove(); } } if (s.forceSync) { doSubmit(); } else { setTimeout(doSubmit, 10); // this lets dom updates render } var data, doc, domCheckCount = 50, callbackProcessed; function cb(e) { if (xhr.aborted || callbackProcessed) { return; } try { doc = getDoc(io); } catch(ex) { log('cannot access response document: ', ex); e = SERVER_ABORT; } if (e === CLIENT_TIMEOUT_ABORT &amp;&amp; xhr) { xhr.abort('timeout'); return; } else if (e == SERVER_ABORT &amp;&amp; xhr) { xhr.abort('server abort'); return; } if (!doc || doc.location.href == s.iframeSrc) { // response not received yet if (!timedOut) return; } io.detachEvent ? io.detachEvent('onload', cb) : io.removeEventListener('load', cb, false); var status = 'success', errMsg; try { if (timedOut) { throw 'timeout'; } var isXml = s.dataType == 'xml' || doc.XMLDocument || $.isXMLDoc(doc); log('isXml='+isXml); if (!isXml &amp;&amp; window.opera &amp;&amp; (doc.body == null || doc.body.innerHTML == '')) { if (--domCheckCount) { // in some browsers (Opera) the iframe DOM is not always traversable when // the onload callback fires, so we loop a bit to accommodate log('requeing onLoad callback, DOM not available'); setTimeout(cb, 250); return; } // let this fall through because server response could be an empty document //log('Could not access iframe DOM after mutiple tries.'); //throw 'DOMException: not available'; } //log('response detected'); var docRoot = doc.body ? doc.body : doc.documentElement; xhr.responseText = docRoot ? docRoot.innerHTML : null; xhr.responseXML = doc.XMLDocument ? doc.XMLDocument : doc; if (isXml) s.dataType = 'xml'; xhr.getResponseHeader = function(header){ var headers = {'content-type': s.dataType}; return headers[header]; }; // support for XHR 'status' &amp; 'statusText' emulation : if (docRoot) { xhr.status = Number( docRoot.getAttribute('status') ) || xhr.status; xhr.statusText = docRoot.getAttribute('statusText') || xhr.statusText; } var dt = (s.dataType || '').toLowerCase(); var scr = /(json|script|text)/.test(dt); if (scr || s.textarea) { var documentContent, isTextArea; // see if user embedded response in textarea try { documentContent = $($(doc).text()); isTextArea = documentContent.is(&quot;textarea&quot;); }catch(e){ isTextArea = false; } // var ta = doc.getElementsByTagName('textarea')[0]; if (isTextArea) { xhr.responseText = documentContent.text(); // support for XHR 'status' &amp; 'statusText' emulation : xhr.status = Number( documentContent.attr('status') ) || xhr.status; xhr.statusText = documentContent.attr('statusText') || xhr.statusText; } else if (scr) { // account for browsers injecting pre around json response var pre = doc.getElementsByTagName('pre')[0]; var b = doc.getElementsByTagName('body')[0]; if (pre) { xhr.responseText = pre.textContent ? pre.textContent : pre.innerText; } else if (b) { xhr.responseText = b.textContent ? b.textContent : b.innerText; } } } else if (dt == 'xml' &amp;&amp; !xhr.responseXML &amp;&amp; xhr.responseText != null) { xhr.responseXML = toXml(xhr.responseText); } try { data = httpData(xhr, dt, s); } catch (e) { status = 'parsererror'; xhr.error = errMsg = (e || status); } } catch (e) { log('error caught: ',e); status = 'error'; xhr.error = errMsg = (e || status); } if (xhr.aborted) { log('upload aborted'); status = null; } if (xhr.status) { // we've set xhr.status status = (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300 || xhr.status === 304) ? 'success' : 'error'; } // ordering of these callbacks/triggers is odd, but that's how $.ajax does it if (status === 'success') { s.success &amp;&amp; s.success.call(s.context, data, 'success', xhr); g &amp;&amp; $.event.trigger(&quot;ajaxSuccess&quot;, [xhr, s]); } else if (status) { if (errMsg == undefined) errMsg = xhr.statusText; s.error &amp;&amp; s.error.call(s.context, xhr, status, errMsg); g &amp;&amp; $.event.trigger(&quot;ajaxError&quot;, [xhr, s, errMsg]); } g &amp;&amp; $.event.trigger(&quot;ajaxComplete&quot;, [xhr, s]); if (g &amp;&amp; ! --$.active) { $.event.trigger(&quot;ajaxStop&quot;); } s.complete &amp;&amp; s.complete.call(s.context, xhr, status); callbackProcessed = true; if (s.timeout) clearTimeout(timeoutHandle); // clean up setTimeout(function() { if (!s.iframeTarget) $io.remove(); xhr.responseXML = null; }, 100); } var toXml = $.parseXML || function(s, doc) { // use parseXML if available (jQuery 1.5+) if (window.ActiveXObject) { doc = new ActiveXObject('Microsoft.XMLDOM'); doc.async = 'false'; doc.loadXML(s); } else { doc = (new DOMParser()).parseFromString(s, 'text/xml'); } return (doc &amp;&amp; doc.documentElement &amp;&amp; doc.documentElement.nodeName != 'parsererror') ? doc : null; }; var parseJSON = $.parseJSON || function(s) { return window['eval']('(' + s + ')'); }; var httpData = function( xhr, type, s ) { // mostly lifted from jq1.4.4 var ct = xhr.getResponseHeader('content-type') || '', xml = type === 'xml' || !type &amp;&amp; ct.indexOf('xml') &gt;= 0, data = xml ? xhr.responseXML : xhr.responseText; if (xml &amp;&amp; data.documentElement.nodeName === 'parsererror') { $.error &amp;&amp; $.error('parsererror'); } if (s &amp;&amp; s.dataFilter) { data = s.dataFilter(data, type); } if (typeof data === 'string') { if (type === 'json' || !type &amp;&amp; ct.indexOf('json') &gt;= 0) { data = parseJSON(data); } else if (type === &quot;script&quot; || !type &amp;&amp; ct.indexOf(&quot;javascript&quot;) &gt;= 0) { $.globalEval(data); } } return data; }; } }; /** * ajaxForm() provides a mechanism for fully automating form submission. * * The advantages of using this method instead of ajaxSubmit() are: * * 1: This method will include coordinates for &lt;input type=&quot;image&quot; /&gt; elements (if the element * is used to submit the form). * 2. This method will include the submit element's name/value data (for the element that was * used to submit the form). * 3. This method binds the submit() method to the form for you. * * The options argument for ajaxForm works exactly as it does for ajaxSubmit. ajaxForm merely * passes the options argument along after properly binding events for submit elements and * the form itself. */ $.fn.ajaxForm = function(options) { // in jQuery 1.3+ we can fix mistakes with the ready state if (this.length === 0) { var o = { s: this.selector, c: this.context }; if (!$.isReady &amp;&amp; o.s) { log('DOM not ready, queuing ajaxForm'); $(function() { $(o.s,o.c).ajaxForm(options); }); return this; } // is your DOM ready? http://docs.jquery.com/Tutorials:Introducing_$(document).ready() log('terminating; zero elements found by selector' + ($.isReady ? '' : ' (DOM not ready)')); return this; } return this.ajaxFormUnbind().bind('submit.form-plugin', function(e) { if (!e.isDefaultPrevented()) { // if event has been canceled, don't proceed e.preventDefault(); $(this).ajaxSubmit(options); } }).bind('click.form-plugin', function(e) { var target = e.target; var $el = $(target); if (!($el.is(&quot;:submit,input:image&quot;))) { // is this a child element of the submit el? (ex: a span within a button) var t = $el.closest(':submit'); if (t.length == 0) { return; } target = t[0]; } var form = this; form.clk = target; if (target.type == 'image') { if (e.offsetX != undefined) { form.clk_x = e.offsetX; form.clk_y = e.offsetY; } else if (typeof $.fn.offset == 'function') { // try to use dimensions plugin var offset = $el.offset(); form.clk_x = e.pageX - offset.left; form.clk_y = e.pageY - offset.top; } else { form.clk_x = e.pageX - target.offsetLeft; form.clk_y = e.pageY - target.offsetTop; } } // clear form vars setTimeout(function() { form.clk = form.clk_x = form.clk_y = null; }, 100); }); }; // ajaxFormUnbind unbinds the event handlers that were bound by ajaxForm $.fn.ajaxFormUnbind = function() { return this.unbind('submit.form-plugin click.form-plugin'); }; /** * formToArray() gathers form element data into an array of objects that can * be passed to any of the following ajax functions: $.get, $.post, or load. * Each object in the array has both a 'name' and 'value' property. An example of * an array for a simple login form might be: * * [ { name: 'username', value: 'jresig' }, { name: 'password', value: 'secret' } ] * * It is this array that is passed to pre-submit callback functions provided to the * ajaxSubmit() and ajaxForm() methods. */ $.fn.formToArray = function(semantic) { var a = []; if (this.length === 0) { return a; } var form = this[0]; var els = semantic ? form.getElementsByTagName('*') : form.elements; if (!els) { return a; } var i,j,n,v,el,max,jmax; for(i=0, max=els.length; i &lt; max; i++) { el = els[i]; n = el.name; if (!n) { continue; } if (semantic &amp;&amp; form.clk &amp;&amp; el.type == &quot;image&quot;) { // handle image inputs on the fly when semantic == true if(!el.disabled &amp;&amp; form.clk == el) { a.push({name: n, value: $(el).val(), type: el.type }); a.push({name: n+'.x', value: form.clk_x}, {name: n+'.y', value: form.clk_y}); } continue; } v = $.fieldValue(el, true); if (v &amp;&amp; v.constructor == Array) { for(j=0, jmax=v.length; j &lt; jmax; j++) { a.push({name: n, value: v[j]}); } } else if (v !== null &amp;&amp; typeof v != 'undefined') { a.push({name: n, value: v, type: el.type}); } } if (!semantic &amp;&amp; form.clk) { // input type=='image' are not found in elements array! handle it here var $input = $(form.clk), input = $input[0]; n = input.name; if (n &amp;&amp; !input.disabled &amp;&amp; input.type == 'image') { a.push({name: n, value: $input.val()}); a.push({name: n+'.x', value: form.clk_x}, {name: n+'.y', value: form.clk_y}); } } return a; }; /** * Serializes form data into a 'submittable' string. This method will return a string * in the format: name1=value1&amp;amp;name2=value2 */ $.fn.formSerialize = function(semantic) { //hand off to jQuery.param for proper encoding return $.param(this.formToArray(semantic)); }; /** * Serializes all field elements in the jQuery object into a query string. * This method will return a string in the format: name1=value1&amp;amp;name2=value2 */ $.fn.fieldSerialize = function(successful) { var a = []; this.each(function() { var n = this.name; if (!n) { return; } var v = $.fieldValue(this, successful); if (v &amp;&amp; v.constructor == Array) { for (var i=0,max=v.length; i &lt; max; i++) { a.push({name: n, value: v[i]}); } } else if (v !== null &amp;&amp; typeof v != 'undefined') { a.push({name: this.name, value: v}); } }); //hand off to jQuery.param for proper encoding return $.param(a); }; /** * Returns the value(s) of the element in the matched set. For example, consider the following form: * * &lt;form&gt;&lt;fieldset&gt; * &lt;input name=&quot;A&quot; type=&quot;text&quot; /&gt; * &lt;input name=&quot;A&quot; type=&quot;text&quot; /&gt; * &lt;input name=&quot;B&quot; type=&quot;checkbox&quot; value=&quot;B1&quot; /&gt; * &lt;input name=&quot;B&quot; type=&quot;checkbox&quot; value=&quot;B2&quot;/&gt; * &lt;input name=&quot;C&quot; type=&quot;radio&quot; value=&quot;C1&quot; /&gt; * &lt;input name=&quot;C&quot; type=&quot;radio&quot; value=&quot;C2&quot; /&gt; * &lt;/fieldset&gt;&lt;/form&gt; * * var v = $(':text').fieldValue(); * // if no values are entered into the text inputs * v == ['',''] * // if values entered into the text inputs are 'foo' and 'bar' * v == ['foo','bar'] * * var v = $(':checkbox').fieldValue(); * // if neither checkbox is checked * v === undefined * // if both checkboxes are checked * v == ['B1', 'B2'] * * var v = $(':radio').fieldValue(); * // if neither radio is checked * v === undefined * // if first radio is checked * v == ['C1'] * * The successful argument controls whether or not the field element must be 'successful' * (per http://www.w3.org/TR/html4/interact/forms.html#successful-controls). * The default value of the successful argument is true. If this value is false the value(s) * for each element is returned. * * Note: This method *always* returns an array. If no valid value can be determined the * array will be empty, otherwise it will contain one or more values. */ $.fn.fieldValue = function(successful) { for (var val=[], i=0, max=this.length; i &lt; max; i++) { var el = this[i]; var v = $.fieldValue(el, successful); if (v === null || typeof v == 'undefined' || (v.constructor == Array &amp;&amp; !v.length)) { continue; } v.constructor == Array ? $.merge(val, v) : val.push(v); } return val; }; /** * Returns the value of the field element. */ $.fieldValue = function(el, successful) { var n = el.name, t = el.type, tag = el.tagName.toLowerCase(); if (successful === undefined) { successful = true; } if (successful &amp;&amp; (!n || el.disabled || t == 'reset' || t == 'button' || (t == 'checkbox' || t == 'radio') &amp;&amp; !el.checked || (t == 'submit' || t == 'image') &amp;&amp; el.form &amp;&amp; el.form.clk != el || tag == 'select' &amp;&amp; el.selectedIndex == -1)) { return null; } if (tag == 'select') { var index = el.selectedIndex; if (index &lt; 0) { return null; } var a = [], ops = el.options; var one = (t == 'select-one'); var max = (one ? index+1 : ops.length); for(var i=(one ? index : 0); i &lt; max; i++) { var op = ops[i]; if (op.selected) { var v = op.value; if (!v) { // extra pain for IE... v = (op.attributes &amp;&amp; op.attributes['value'] &amp;&amp; !(op.attributes['value'].specified)) ? op.text : op.value; } if (one) { return v; } a.push(v); } } return a; } return $(el).val(); }; /** * Clears the form data. Takes the following actions on the form's input fields: * - input text fields will have their 'value' property set to the empty string * - select elements will have their 'selectedIndex' property set to -1 * - checkbox and radio inputs will have their 'checked' property set to false * - inputs of type submit, button, reset, and hidden will *not* be effected * - button elements will *not* be effected */ $.fn.clearForm = function(includeHidden) { return this.each(function() { $('input,select,textarea', this).clearFields(includeHidden); }); }; /** * Clears the selected form elements. */ $.fn.clearFields = $.fn.clearInputs = function(includeHidden) { var re = /^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i; // 'hidden' is not in this list return this.each(function() { var t = this.type, tag = this.tagName.toLowerCase(); if (re.test(t) || tag == 'textarea' || (includeHidden &amp;&amp; /hidden/.test(t)) ) { this.value = ''; } else if (t == 'checkbox' || t == 'radio') { this.checked = false; } else if (tag == 'select') { this.selectedIndex = -1; } }); }; /** * Resets the form data. Causes all form elements to be reset to their original value. */ $.fn.resetForm = function() { return this.each(function() { // guard against an input with the name of 'reset' // note that IE reports the reset function as an 'object' if (typeof this.reset == 'function' || (typeof this.reset == 'object' &amp;&amp; !this.reset.nodeType)) { this.reset(); } }); }; /** * Enables or disables any matching elements. */ $.fn.enable = function(b) { if (b === undefined) { b = true; } return this.each(function() { this.disabled = !b; }); }; /** * Checks/unchecks any matching checkboxes or radio buttons and * selects/deselects and matching option elements. */ $.fn.selected = function(select) { if (select === undefined) { select = true; } return this.each(function() { var t = this.type; if (t == 'checkbox' || t == 'radio') { this.checked = select; } else if (this.tagName.toLowerCase() == 'option') { var $sel = $(this).parent('select'); if (select &amp;&amp; $sel[0] &amp;&amp; $sel[0].type == 'select-one') { // deselect all other options $sel.find('option').selected(false); } this.selected = select; } }); }; // expose debug var $.fn.ajaxSubmit.debug = false; // helper fn for console logging function log() { if (!$.fn.ajaxSubmit.debug) return; var msg = '[jquery.form] ' + Array.prototype.join.call(arguments,''); if (window.console &amp;&amp; window.console.log) { window.console.log(msg); } else if (window.opera &amp;&amp; window.opera.postError) { window.opera.postError(msg); } }; })(jQuery); × Search results Close "},"rup.dialog.js.html":{"id":"rup.dialog.js.html","title":"Source: rup.dialog.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.dialog.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ ///* Evento del evento de antes de la carga de los datos */ // var loadBeforeSendUserEvent = settings.loadBeforeSend; // settings.loadBeforeSend = function(xhr){ // if(loadBeforeSendUserEvent !== null){ // if(loadBeforeSendUserEvent(xhr) === false){ // return false; // } // } // //console.log(&quot;loadBeforeSend&quot;); // //Comportamiento por defecto del evento // loadBeforeSend_default(xhr); // }; /** * @fileOverview Implementa el patrón RUP Dialog. * @author EJIE * @version 2.4.10 */ (function ($) { //********************************************* // ESPECIFICACÍON DE LOS TIPOS BASE DEL PATRÓN //********************************************* $.extend($.rup, { /** * Determina los tipos de diálogos. * * @typedef {Object} jQuery.rup~dialog * @property {string} DIV - Dialogo creado a partir de un diálogo existente. * @property {string} TEXT - Dialogo creado a partir de un texto. * @property {string} AJAX - Dialogo creado a partir de la respuesta de una petición AJAX. * @property {string} LINK - Dialogo creado a partir del contenido de un enlace estático. * @example * // Diálogo de tipo DIV * $.rup.dialog.DIV * // Diálogo de tipo TEXT * $.rup.dialog.TEXT * // Diálogo de tipo AJAX * $.rup.dialog.AJAX * // Diálogo de tipo LINK * $.rup.dialog.LINK */ dialog : { DIV : &quot;dialogDIV&quot;, TEXT : &quot;textDialog&quot;, AJAX : &quot;ajaxDialog&quot;, LINK : &quot;linkButton&quot; } }); //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Permite lanzar un subproceso o un mensaje de confirmación dentro de un proceso principal sin salirse de este. &lt;br/&gt;&lt;br/&gt;Es una evolución del patrón mensaje. * * @summary Componente RUP Dialog. * @namespace jQuery.rup_dialog * @memberOf jQuery * @tutorial rup_dialog * @example * var properties = { * type: $.rup.dialog.TEXT, * autoOpen: true, * modal: true, * resizable: true, * title: &quot;Título del dialog (text) &quot;, * message: &quot;Se esta creando un div con el mensaje puesto por parametro.&quot; * }; * * $(&quot;#selector&quot;).rup_dialog(properties); */ var rup_dialog = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_dialog&quot;, rup_dialog)); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** $.fn.rup_dialog(&quot;extend&quot;,{ /** * Abre el diálogo y estable el foco en el primer botón. * * @name jQuery.rup_dialog#open * @function * * @example * $(&quot;#selector&quot;).rup_dialog(&quot;open&quot;); */ open : function () {//abre el dialogo y estable el foco en el primer botón. var settings = $.extend({}, $(this).dialog(&quot;option&quot;)), $overlayEl; //Guardar el elemento que tenía el foco antes de abrir el diálogo $(this).data(&quot;focus&quot;,$(document.activeElement)); var docHeight = $(document).height(), docWidth = $(document).width(); if ($(this).dialog(&quot;option&quot;, &quot;ajaxCache&quot;) === false){ settings.id = $(this).attr('id'); settings.autoOpen = true; this._ajaxLoad(settings); } else { $(this).dialog(&quot;open&quot;); } //Ajuste para portales if($.rup_utils.aplicatioInPortal()){ if ($(this).data(&quot;dialog&quot;).overlay !== null){ $overlayEl = $(this).data(&quot;dialog&quot;).overlay.$el; $(&quot;.r01gContainer&quot;).append($overlayEl); $overlayEl.css(&quot;height&quot;,docHeight).css(&quot;width&quot;,docWidth); } if (settings.position === undefined || settings.position === null){ $(this).data(&quot;dialog&quot;).uiDialog.css(&quot;position&quot;,&quot;absolute&quot;).css(&quot;top&quot;,(docHeight/2)-($('div[aria-labelledby=ui-dialog-title-' + this[0].id + ']').height()/2)); } } $('div[aria-labelledby=ui-dialog-title-' + this[0].id + '] .ui-dialog-buttonpane button:first').focus(); }, /** * Borra el dialogo si este estubiera oculto o visible. * * @name jQuery.rup_dialog#destroy * @function * * @example * $(&quot;#selector&quot;).rup_dialog(&quot;destroy&quot;); */ destroy : function (){ $(this).dialog(&quot;destroy&quot;); }, /** * Función que deshabilita el dialogo sobre el que se aplica. * * @name jQuery.rup_dialog#disable * @function * * @example * $(&quot;#selector&quot;).rup_dialog(&quot;disable&quot;); */ disable : function (){ $(this).dialog( &quot;disable&quot; ); }, /** * Funcion que, en caso de estar desahibilitado, habilita el dialogo sobre el que se aplica. * * @name jQuery.rup_dialog#enable * @function * * @example * $(&quot;#selector&quot;).rup_dialog(&quot;enable&quot;); */ enable : function (){ $(this).dialog( &quot;enable&quot; ); }, widget : function (){ return ($(this).dialog( &quot;widget&quot; )); }, /** * Funcion encargada de poner por encima de todos los dialogos al dialogo sobre el que se aplica. Puede ser muy util se se tiene mas de un dialog abierto a la vez. * * @name jQuery.rup_dialog#moveToTop * @function * * @example * $(&quot;#selector&quot;).rup_dialog(&quot;moveToTop&quot;); */ moveToTop : function(){ $(this).dialog( &quot;moveToTop&quot; ); }, /** * Cierra el dialogo. * * @name jQuery.rup_dialog#close * @function * * @example * $(&quot;#selector&quot;).rup_dialog(&quot;close&quot;); */ close : function () {//Cierra el dialogo. $(this).dialog(&quot;close&quot;); }, /** * Función que devuelve si el dialogo esta abierto o no. * * @name jQuery.rup_dialog#isOpen * @function * @returns {boolean} - Determina si el diálogo está abierto o no. * @example * $(&quot;#selector&quot;).rup_dialog(&quot;isOpen&quot;); */ isOpen : function () {//Función que devuelve si el dialogo esta abierto. return $(this).dialog(&quot;isOpen&quot;); }, /** * Obtiene la propiedad que recibe como parametro. * * @name jQuery.rup_dialog#getOption * @function * @param {string} opt - Nombre de la propiedad. * @returns {Object} - Valor de la propiedad especificada. * @example * $(&quot;#selector&quot;).rup_dialog(&quot;getOption&quot;,&quot;width&quot;); */ getOption : function (opt) {//Obtiene la propiedad que recibe como parametro. return $(this).dialog(&quot;option&quot;, opt); }, /** * Establece la propiedad que recibe como parametro. * * @name jQuery.rup_dialog#setOption * @function * @param {string} opt - Nombre de la propiedad. * @param {object} value - Valor de la propiedad a establecer. * @example * $(&quot;#selector&quot;).rup_dialog(&quot;setOption&quot;,&quot;width&quot;, 200); */ setOption : function (opt, value) {//Establece la propiedad que recibe como parametro. if (opt === &quot;buttons&quot;) {//si establecemos los botones tenemos que tener encuenta lo de los links var btnsLength = value.length, aux, i, j, linkButtons = [], linkButtonsLength;//tamaño incial de los botones se o no enlaces if (btnsLength &gt; 1) {//si tenemos mas de un boton buscamos cual es el link aux = value; for (i = 0; i &lt; value.length;i++) {//se usa el length y no una variable porque se eliminan botones y el tamaño varia if (value[i].btnType === $.rup.dialog.LINK) { linkButtons.push(value.splice(i, 1)); i--; } } i = null; } linkButtonsLength = linkButtons.length; //Si tiene mas de dos botones y ninguno de ellos es de tipo link, entonces le mostrar una alerta diciendo que no cumple arista. if (btnsLength &gt; 1 &amp;&amp; linkButtonsLength === 0 /*&amp;&amp; settings.rupCheckStyle*/) { $.rup.msgAlert({message: $.rup.i18nParse ($.rup.i18n, &quot;base.rup_global.rupCheckStyleError&quot;)}); return false; } $(this).dialog(&quot;option&quot;, opt, value); if (linkButtonsLength &gt; 0) { //si tenemos enlaces los añadimos for (j = 0; j &lt; linkButtonsLength; j++) { this.createBtnLinks(linkButtons[j][0], this[0].id); } j = null; } return; } if(opt !== &quot;title&quot;){ if (value !== undefined){ $(this).dialog(&quot;option&quot;, opt, value); } else { $(this).dialog(&quot;option&quot;, opt); } } else { //A raíz de un bug del plug-in subyacente, el cambio del titulo se hace a mano (en caso de que se corrija el error esto sorbería y habría que borrarlo) $(&quot;#ui-dialog-title-&quot;+$(this).attr(&quot;id&quot;)).html(value); } }, /** * Función que crea los botones como enlaces y se los añade al panel de botones al final de los botones. * * @name jQuery.rup_dialog#createBtnLinks * @function * @param {object} btn - Objeto de definición del botón. * @param {object} id - Identificador del diálogo. * @example * $(&quot;#selector&quot;).rup_dialog(&quot;createBtnLinks&quot;, btnObj, &quot;idDialog&quot;); */ createBtnLinks : function (btn, id) { /** * Función que crea los botones como enlaces y se los añade al panel de botones al final de los botones */ var buttonHREF = $(&quot;&lt;a href='#'&gt;&lt;/a&gt;&quot;) .attr(&quot;role&quot;, &quot;button&quot;) .attr(&quot;id&quot;, &quot;rup_dialog&quot; + btn.text) .addClass(&quot;rup-enlaceCancelar&quot;) .html(btn.text) .click(btn.click); $('div[aria-labelledby=ui-dialog-title-' + id + '] .ui-dialog-buttonset ').append(buttonHREF); } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** $.fn.rup_dialog(&quot;extend&quot;,{ /** * Método de inicialización del componente * * @name jQuery.rup_dialog#_init * @function * @private */ _init : function(args){ if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.initError&quot; + $(this).attr(&quot;id&quot;))); } else { //Se recogen y cruzan las paremetrizaciones del objeto var settings = $.extend({}, $.fn.rup_dialog.defaults, args[0]), json_i18n, dialog = this, msgDiv, codeEventCreate = undefined; //Sobrecargar close para recuperar foco en elemento que ha lanzado el diálogo settings._close = settings.close; settings.close = function(event, ui) { if ($(this).data(&quot;focus&quot;)!==undefined){ $(this).data(&quot;focus&quot;).focus();} if (settings._close!==undefined){settings._close(event,ui);} }; //Se verifica que el selector solo contenga un diálogo if(settings.type !== null &amp;&amp; $(this).length &gt; 0){ $.each($(this), function(index, object) { if($(this).attr('id') !== undefined){ settings.id = $(this).attr('id'); } else { settings.id = &quot;rup_&quot;+settings.type+&quot;DIV&quot;; msgDiv = $(&quot;&lt;div/&gt;&quot;).attr(&quot;id&quot;, settings.id); msgDiv.appendTo('body'); } var autopen = false, linkButtons = [], btnsLength, aux, aClose, linkButtonsLength = 0, closeSpan, i, j, created = false, codeEventCreate = undefined; //Se determina la ubicación del dialogo físicamente (dentro de la pagina html). Por defecto se ubica en el body de la página pero puede determinarse una ubicación específica. //En caso de encontrarnos en portales (Ejie), y no determinar una ubicación específica, se ubica dentro de los rangos apropiados. if($('div[aria-labelledby=ui-dialog-title-' + settings.id + ']').length &gt; 0){//comprobamos que no se haya ya creado el dialog sobre ese div para evitar problemas de sobreescritura de propiedades, como el tiulo... created = true; } else { if($(&quot;body #&quot;+settings.id).not(&quot;.ui-dialog-content&quot;).length &gt; 1){ $($(&quot;body #&quot;+settings.id).not(&quot;.ui-dialog-content&quot;)[1]).remove(); } if(settings.specificLocation !== &quot;&quot;){ codeEventCreate = function(event, ui){ $(&quot;#&quot;+settings.id).parent(&quot;.ui-dialog&quot;).insertAfter($(&quot;#&quot;+settings.specificLocation)); }; } else if ($.rup_utils.aplicatioInPortal()){ //Ajuste para portales codeEventCreate = function(event, ui){ $(&quot;.r01gContainer&quot;).append($(&quot;.ui-dialog&quot;)); }; } } //Evento de create (respetando las opciones de los usuarios) if (codeEventCreate !== undefined){ /* Gestion del evento create */ var createUserEvent = settings.create; settings.create = function(event, ui){ if(createUserEvent !== undefined &amp;&amp; createUserEvent !== null ){ if(createUserEvent.call(event, ui) === false){ return false; } } //Comportamiento por defecto del evento codeEventCreate(event, ui); }; } switch (settings.type) { case $.rup.dialog.DIV://si el dialog es de tipo DIV se utilizara el div creado por el desarrollador para crear el ui dialog if(settings.clone !== undefined){ $('#'+settings.id).clone(true).attr(&quot;id&quot;,settings.clone).insertAfter('#'+settings.id ); settings.id = settings.clone; } break; case $.rup.dialog.TEXT: $(&quot;#&quot;+settings.id).html(settings.message); break; case $.rup.dialog.AJAX: dialog._ajaxLoad(settings); break; } //Para que no se abra hasta que terminemos con todas nuestra acciones if (settings.autoOpen === true) { autopen = true; settings.autoOpen = false; } //controlar que existan los botones if (settings.buttons &amp;&amp; settings.buttons !== null) { btnsLength = settings.buttons.length;//tamaño incial de los botones se o no enlaces if (btnsLength &gt; 1) {//si tenemos mas de un boton buscamos cual es el link aux = settings.buttons; for (i = 0; i &lt; settings.buttons.length;i++) {//se usa el length y no una variable porque se eliminan botones y el tamaño varia if (settings.buttons[i].btnType === $.rup.dialog.LINK) { linkButtons.push(settings.buttons.splice(i, 1)); i--; } } i = null; } linkButtonsLength = linkButtons.length; //Si tiene mas de dos botones y ninguno de ellos es de tipo link, entonces le mostrar una alerta diciendo que no cumple arista. if (btnsLength &gt; 1 &amp;&amp; linkButtonsLength === 0 &amp;&amp; settings.rupCheckStyle) { $(document).rup().msgAlert({message: $.rup.i18nParse($.rup.i18n.base,&quot;rup_global.rupCheckStyleError&quot;)}); settings.stack = false; settings.modal = false; settings.zIndex = 9999; } } if (!created) { //si ha sido creado no hace falta volver a añadir el elnace de cierre $(&quot;#&quot; + settings.id).dialog(settings); closeSpan = &quot;&lt;span id='closeText_&quot; + settings.id + &quot;' style='float:right;font-size:0.85em'&gt;&quot; + $.rup.i18nParse($.rup.i18n.base,&quot;rup_global.cerrar&quot;) + &quot;&lt;/span&gt;&quot;; aClose = $(&quot;&lt;a href='#'&gt;&lt;/a&gt;&quot;) .attr(&quot;role&quot;, &quot;button&quot;) .css(&quot;margin-right&quot;, &quot;0.9em&quot;) .css(&quot;float&quot;, &quot;right&quot;) .css(&quot;width&quot;, &quot;50px&quot;) .addClass(&quot;ui-dialog-title&quot;) .html(closeSpan) .click(function (event) { $(&quot;#&quot; + settings.id).dialog(&quot;close&quot;); return false; }) .hover(function (eventObject) { //Evento lanzado para que se cambie el icono de la X a hover, marcado por ARISTA $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-titlebar-close').addClass(&quot;ui-state-hover&quot;); $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-titlebar-close').css(&quot;padding&quot;, &quot;0px&quot;); }, function (eventObject) { $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-titlebar-close').removeClass(&quot;ui-state-hover&quot;); $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-titlebar-close').attr(&quot;style&quot;, &quot;&quot;); }) .insertAfter(&quot;#ui-dialog-title-&quot; + settings.id); $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-titlebar-close').hover( function () { aClose.css(&quot;text-decoration&quot;, &quot;none&quot;); }, function () { aClose.css(&quot;text-decoration&quot;, &quot;&quot;); }); } else { //borramos todos los posibles enlances que se hayan creado para esa capa $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-buttonset a').remove(); if (settings.title){ $(&quot;#ui-dialog-title-&quot; + settings.id).text(settings.title); } } if (linkButtonsLength &gt; 0) { //si tenemos enlaces los añadimos for (j = 0; j &lt; linkButtonsLength; j++) { $(this).rup_dialog(&quot;createBtnLinks&quot;,linkButtons[j][0], settings.id); } j = null; } if (autopen) { //si se auto abría lo mostramos if( settings.type !== $.rup.dialog.AJAX){ $(&quot;#&quot; + settings.id).rup_dialog(&quot;open&quot;); //le establecemos el foco $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-buttonpane button:first').focus(); } else { settings.autoOpen = true; } } }); } else { if ($(this).length === 0){ $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.selectorError&quot;)); } else { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.dialogTypeError&quot;)); } } } }, /** * Realiza la carga del contenido del diálogo a partir de una petición AJAX. * * @name jQuery.rup_messages#_createDiv * @function * @private * @param {object} settings - Propiedades de configuración del componente. */ _ajaxLoad : function(settings){ //Si el tipo de dialogo es AJAX y no se establece url se muestra un error y se devuelve el control if (!settings.url || settings.url === null || settings.url === '') { $.rup.msgAlert({title: $.rup.i18nParse($.rup.i18n.base,&quot;rup_global.error&quot;), message: $.rup.i18nParse($.rup.i18n.base,&quot;rup_dialog.noURL&quot;)}); return false; } if (settings.showLoading &amp;&amp; settings.autoOpen === true) { //si hay que mostrar la capa de cargando por defecto a false $.blockUI({ message: '&lt;img src=&quot;' + $.rup.RUP + '/basic-theme/images/rup.ajaxLoader.gif&quot; style=&quot;position:absolute;top:12px;left:15px;&quot; alt=&quot;' + $.rup.i18nParse($.rup.i18n.base,&quot;rup_blockUI.cargando&quot;) + '&quot; &gt;&lt;h1 class=&quot;loading&quot;&gt;' + $.rup.i18nParse($.rup.i18n.base,&quot;rup_blockUI.cargando&quot;) + '...' + '&lt;/h1&gt;' }); } //Especificación de las opciones asociadas a las llamada Ajax que carga el diálogo var ajaxOptions = $.extend({},settings.ajaxOptions); ajaxOptions.success = function (data, textStatus, XMLHttpRequest){ if (data !== '' || data !== null) {//si nos devuelve datos los mostramos como HTML y desbloqueamos el ui $(&quot;#&quot;+settings.id).html(data); $.unblockUI(); if(settings.autoOpen === true){ $(&quot;#&quot; + settings.id).rup_dialog(&quot;open&quot;); //le establecemos el foco $('div[aria-labelledby=ui-dialog-title-' + settings.id + '] .ui-dialog-buttonpane button:first').focus(); } } if(settings.ajaxOptions &amp;&amp; settings.ajaxOptions.success !== undefined &amp;&amp; settings.ajaxOptions.success !== null &amp;&amp; typeof settings.ajaxOptions.success === &quot;function&quot;){ settings.ajaxOptions.success(data, textStatus, XMLHttpRequest); } }; ajaxOptions.error = function (XMLHttpRequest, textStatus, errorThrown) { //en caso de error mostramos un mensaje de alerta $.unblockUI(); $(document).rup().msgAlert({message: $.rup.i18nParse($.rup.i18n.base,&quot;rup_dialog.errorLoadingData&quot;)}); if(settings.ajaxOptions.error !== undefined &amp;&amp; settings.ajaxOptions.error !== null &amp;&amp; typeof settings.ajaxOptions.error === &quot;function&quot;){ settings.ajaxOptions.error(XMLHttpRequest, textStatus, errorThrown); } }; ajaxOptions.url = $.rup_utils.setNoPortalParam(settings.url); ajaxOptions.type= 'GET'; ajaxOptions.cache= false; ajaxOptions.dataType= 'text'; //Peticion ajax para obtener los datos a mostrar $.rup_ajax(ajaxOptions); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Propiedades de configuración de la petición Ajax. * * @typedef {object} jQuery.rup_dialog~ajaxOptions * @see {@link http://api.jquery.com/jquery.ajax/#jQuery-ajax-settings|jQuery Ajax Settings} */ /** * Evento que se lanza cuando se abre el diálogo. * * @see {@link http://api.jqueryui.com/dialog/#event-open jQueryUI Dialog} * @callback jQuery.rup_dialog~onOpen * @param {Event} event - Fecha seleccionada * @param {object} ui - Objeto de jQueryUI correspondiente a la interfaz del diálogo. * @example * $(&quot;#idDialog&quot;).rup_dialog({ * open: function(event, ui) { ... } * }); */ /** * Evento que se lanza a la hora de cerrar el diálogo. * * @see {@link http://api.jqueryui.com/dialog/#event-open jQueryUI Dialog} * @callback jQuery.rup_dialog~onClose * @param {Event} event - Fecha seleccionada * @param {object} ui - Objeto de jQueryUI correspondiente a la interfaz del diálogo. * @example * $(&quot;#idDialog&quot;).rup_dialog({ * close: function(event, ui) { ... } * }); */ /** * Evento que se lanza justo antes de que se cierre el dialogo, si este evento devuelve false se anulará las acción de cierre y el dialogo seguirá abierto * * @see {@link http://api.jqueryui.com/dialog/#event-beforeClose jQueryUI Dialog} * @callback jQuery.rup_dialog~onBeforeClose * @param {Event} event - Fecha seleccionada * @param {object} ui - Objeto de jQueryUI correspondiente a la interfaz del diálogo. * @return {boolean} - Si devuelve false se anulará las acción de cierre y el dialogo seguirá abierto. * @example * $(&quot;#idDialog&quot;).rup_dialog({ * onBeforeClose: function(event, ui) { ... } * }); */ /** * Opciones por defecto de configuración del componente. * @name jQuery.rup_dialog#options * * @property {string} [url] - Url de donde se obtendrá el contenido del diálogo. * @property {boolean} [rupCheckStyle=true] Propiedad definida por el componentes base, si está a true se mostraran los mensajes específicos del componente base marcados por la guía de estilos, es decir, que si el desarrollador no cumple con la guisa de estilos o desarrollo el objeto base mostrará los mensajes advirtiendo su incumplimiento, si se pone a false no se mostraran. Esta acción queda bajo la responsabilidad de la aplicación, ya que esta propiedad no debería modificarse. * @property {jQuery.rup~dialog} type - Propiedad que establece el tipo de diálogo a mostrar. * @property {jQuery.rup_dialog~ajaxOptions} ajaxOptions - Establece las todas las propiedades para configurar la petición ajax. * @property {boolean} [showLoading=true] - Esta propiedad mostrará una capa de cargando datos en los diálogos de tipo Ajax durante la carga del mismo. * @property {boolean} [disabled=false] - Propiedad que deshabilita o no el diálogo. * @property {boolean} [autoOpen=true] - Si esta propiedad esta a true el diálogo se abrirá automáticamente cuando se cree, en el caso de que su valor sea false, el diálogo se mantendrá oculto hasta que se invoque a la función “open” (.rup_dialog(“open”)). * @property {Object} [buttons] - Define los botones (literales y funciones a las que invocan) que contendrá el diálogo. La propiedad sería de tipo Array. Donde cada elemento del array debe ser un objeto que define las propiedades de cada botón y el tipo del mismo. * @property {boolean} [closeOnEscape=true] - Especifica si se debe cerrar el diálogo cuando el tenga el foco y el usuario pulse la tecla ESC. * @property {string} dialogClass - Porpiedad que establece el/los estilos que se añadirán al dialogo para dotar al dialogo de estilos diferentes. * @property {boolean} [draggable=true] - Si su valor es true el diáologo sera dragable pinchando sobre el título. * @property {string | number} [height=auto] - Establece el alto del diálogoen pixeles. * @property {string} [hide=null] - Efecto utilizado cuando se cierra el diálogo. * @property {boolean | number} [maxHeight=false] - Alto máximo en pixeles al que se puede llegar a redimensionar el diálogo. * @property {boolean | number} [maxWidth=false] - Ancho máximo en pixeles al que se puede llegar a redimensionar el diálogo. * @property {boolean | number} [minHeight=100] - Alto mínimo en pixeles al que se puede llegar a redimensionar el diálogo. * @property {boolean | number} [minWidth=150] - Ancho mínimo en pixeles al que se puede llegar a redimensionar el diálogo. * @property {boolean} [modal=false] - Si se establece esta propiedad a true el diálogo se abrirá de forma modal, por encima del resto de elementos. * @property {string | string[] | number[]} position - Esta propiedad especifica donde debe mostrarse el diálogo. Sus posibles valores son: Un simple String representando la posición. 'center', 'left', 'right', 'top', 'bottom'. Un array con las coordenadas x, y en pixles (e. [350,100]). Un array con string que representan la posición (e. ['right','top']). * @property {boolean} [resizable=true] - Si se establece esta propiedad a true el diálogo se redimensionable. * @property {string} [show] - Efecto a realizar cuando se abre el diálogo. * @property {boolean} [stack] - Establece si el diálogo actual se situa por encima del resto de diálogos que existan en la ventana. * @property {string} [title] - Establece el título de la ventana. Puede ser cualquier html válido. * @property {number} [width=300] - Establece el ancho del diálogo en pixeles. * @property {number} [z-index=1000] - Establece el zIndex del diálogo. * @property {jQuery.rup_dialog~onOpen} open - Evento que se lanza cuando se abre el diálogo. * @property {jQuery.rup_dialog~onClose} close - Evento que se lanza a la hora de cerrar el diálogo. * @property {jQuery.rup_dialog~onBeforeClose} beforeClose - Evento que se lanza justo antes de que se cierre el dialogo, si este evento devuelve false se anulará las acción de cierre y el dialogo seguirá abierto. */ $.fn.rup_dialog.defaults = { rupCheckStyle: true, type: null, url: null, minHeight: 100, ajaxCache: true, specificLocation: &quot;&quot;, clone: undefined }; })(jQuery); × Search results Close "},"core_jqGrid_jqGrid-4.4.1.js.html":{"id":"core_jqGrid_jqGrid-4.4.1.js.html","title":"Source: core/jqGrid/jqGrid-4.4.1.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: core/jqGrid/jqGrid-4.4.1.js // ==ClosureCompiler== // @compilation_level SIMPLE_OPTIMIZATIONS /** * @license jqGrid 4.4.1 - jQuery Grid * Copyright (c) 2008, Tony Tomov, tony@trirand.com * Dual licensed under the MIT and GPL licenses * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * Date: 2012-08-28 */ //jsHint options /*global document, window, jQuery, DOMParser, ActiveXObject, $, alert */ (function ($) { &quot;use strict&quot;; $.jgrid = $.jgrid || {}; $.extend($.jgrid,{ version : &quot;4.4.1&quot;, htmlDecode : function(value){ if(value &amp;&amp; (value=='&amp;nbsp;' || value=='&amp;#160;' || (value.length===1 &amp;&amp; value.charCodeAt(0)===160))) { return &quot;&quot;;} return !value ? value : String(value).replace(/&amp;gt;/g, &quot;&gt;&quot;).replace(/&amp;lt;/g, &quot;&lt;&quot;).replace(/&amp;quot;/g, '&quot;').replace(/&amp;amp;/g, &quot;&amp;&quot;); }, htmlEncode : function (value){ return !value ? value : String(value).replace(/&amp;/g, &quot;&amp;amp;&quot;).replace(/\\&quot;/g, &quot;&amp;quot;&quot;).replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;); }, format : function(format){ //jqgformat var args = $.makeArray(arguments).slice(1); if(format===undefined) { format = &quot;&quot;; } return format.replace(/\\{(\\d+)\\}/g, function(m, i){ return args[i]; }); }, getCellIndex : function (cell) { var c = $(cell); if (c.is('tr')) { return -1; } c = (!c.is('td') &amp;&amp; !c.is('th') ? c.closest(&quot;td,th&quot;) : c)[0]; if ($.browser.msie) { return $.inArray(c, c.parentNode.cells); } return c.cellIndex; }, stripHtml : function(v) { v = v+&quot;&quot;; var regexp = /&lt;(&quot;[^&quot;]*&quot;|'[^']*'|[^'&quot;&gt;])*&gt;/gi; if (v) { v = v.replace(regexp,&quot;&quot;); return (v &amp;&amp; v !== '&amp;nbsp;' &amp;&amp; v !== '&amp;#160;') ? v.replace(/\\&quot;/g,&quot;'&quot;) : &quot;&quot;; } else { return v; } }, stripPref : function (pref, id) { var obj = $.type( pref ); if( obj == &quot;string&quot; || obj ==&quot;number&quot;) { pref = String(pref); id = pref !== &quot;&quot; ? String(id).replace(String(pref), &quot;&quot;) : id; } return id; }, stringToDoc : function (xmlString) { var xmlDoc; if(typeof xmlString !== 'string') { return xmlString; } try { var parser = new DOMParser(); xmlDoc = parser.parseFromString(xmlString,&quot;text/xml&quot;); } catch(e) { xmlDoc = new ActiveXObject(&quot;Microsoft.XMLDOM&quot;); xmlDoc.async=false; xmlDoc.loadXML(xmlString); } return (xmlDoc &amp;&amp; xmlDoc.documentElement &amp;&amp; xmlDoc.documentElement.tagName != 'parsererror') ? xmlDoc : null; }, parse : function(jsonString) { var js = jsonString; if (js.substr(0,9) == &quot;while(1);&quot;) { js = js.substr(9); } if (js.substr(0,2) == &quot;/*&quot;) { js = js.substr(2,js.length-4); } if(!js) { js = &quot;{}&quot;; } return ($.jgrid.useJSON===true &amp;&amp; typeof (JSON) === 'object' &amp;&amp; typeof (JSON.parse) === 'function') ? JSON.parse(js) : eval('(' + js + ')'); }, parseDate : function(format, date) { var tsp = {m : 1, d : 1, y : 1970, h : 0, i : 0, s : 0, u:0},k,hl,dM, regdate = /[\\\\\\/:_;.,\\t\\T\\s-]/; if(date &amp;&amp; date !== null &amp;&amp; date !== undefined){ date = $.trim(date); date = date.split(regdate); if ($.jgrid.formatter.date.masks[format] !== undefined) { format = $.jgrid.formatter.date.masks[format]; } format = format.split(regdate); var dfmt = $.jgrid.formatter.date.monthNames; var afmt = $.jgrid.formatter.date.AmPm; var h12to24 = function(ampm, h){ if (ampm === 0){ if (h === 12) { h = 0;} } else { if (h !== 12) { h += 12; } } return h; }; for(k=0,hl=format.length;k&lt;hl;k++){ if(format[k] == 'M') { dM = $.inArray(date[k],dfmt); if(dM !== -1 &amp;&amp; dM &lt; 12){ date[k] = dM+1; tsp.m = date[k]; } } if(format[k] == 'F') { dM = $.inArray(date[k],dfmt); if(dM !== -1 &amp;&amp; dM &gt; 11){ date[k] = dM+1-12; tsp.m = date[k]; } } if(format[k] == 'a') { dM = $.inArray(date[k],afmt); if(dM !== -1 &amp;&amp; dM &lt; 2 &amp;&amp; date[k] == afmt[dM]){ date[k] = dM; tsp.h = h12to24(date[k], tsp.h); } } if(format[k] == 'A') { dM = $.inArray(date[k],afmt); if(dM !== -1 &amp;&amp; dM &gt; 1 &amp;&amp; date[k] == afmt[dM]){ date[k] = dM-2; tsp.h = h12to24(date[k], tsp.h); } } if (format[k] === 'g') { tsp.h = parseInt(date[k], 10); } if(date[k] !== undefined) { tsp[format[k].toLowerCase()] = parseInt(date[k],10); } } tsp.m = parseInt(tsp.m,10)-1; var ty = tsp.y; if (ty &gt;= 70 &amp;&amp; ty &lt;= 99) {tsp.y = 1900+tsp.y;} else if (ty &gt;=0 &amp;&amp; ty &lt;=69) {tsp.y= 2000+tsp.y;} if(tsp.j !== undefined) { tsp.d = tsp.j; } if(tsp.n !== undefined) { tsp.m = parseInt(tsp.n,10)-1; } } return new Date(tsp.y, tsp.m, tsp.d, tsp.h, tsp.i, tsp.s, tsp.u); }, jqID : function(sid){ return String(sid).replace(/[!&quot;#$%&amp;'()*+,.\\/:;&lt;=&gt;?@\\[\\\\\\]\\^`{|}~]/g,&quot;\\\\$&amp;&quot;); }, guid : 1, uidPref: 'jqg', randId : function( prefix ) { return (prefix? prefix: $.jgrid.uidPref) + ($.jgrid.guid++); }, getAccessor : function(obj, expr) { var ret,p,prm = [], i; if( typeof expr === 'function') { return expr(obj); } ret = obj[expr]; if(ret===undefined) { try { if ( typeof expr === 'string' ) { prm = expr.split('.'); } i = prm.length; if( i ) { ret = obj; while (ret &amp;&amp; i--) { p = prm.shift(); ret = ret[p]; } } } catch (e) {} } return ret; }, getXmlData: function (obj, expr, returnObj) { var ret, m = typeof (expr) === 'string' ? expr.match(/^(.*)\\[(\\w+)\\]$/) : null; if (typeof (expr) === 'function') { return expr(obj); } if (m &amp;&amp; m[2]) { // m[2] is the attribute selector // m[1] is an optional element selector // examples: &quot;[id]&quot;, &quot;rows[page]&quot; return m[1] ? $(m[1], obj).attr(m[2]) : $(obj).attr(m[2]); } else { ret = $(expr, obj); if (returnObj) { return ret; } //$(expr, obj).filter(':last'); // we use ':last' to be more compatible with old version of jqGrid return ret.length &gt; 0 ? $(ret).text() : undefined; } }, cellWidth : function () { var $testDiv = $(&quot;&lt;div class='ui-jqgrid' style='left:10000px'&gt;&lt;table class='ui-jqgrid-btable' style='width:5px;'&gt;&lt;tr class='jqgrow'&gt;&lt;td style='width:5px;'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&quot;), testCell = $testDiv.appendTo(&quot;body&quot;) .find(&quot;td&quot;) .width(); $testDiv.remove(); return testCell !== 5; }, ajaxOptions: {}, from : function(source){ // Original Author Hugo Bonacci // License MIT http://jlinq.codeplex.com/license var QueryObject=function(d,q){ if(typeof(d)==&quot;string&quot;){ d=$.data(d); } var self=this, _data=d, _usecase=true, _trim=false, _query=q, _stripNum = /[\\$,%]/g, _lastCommand=null, _lastField=null, _orDepth=0, _negate=false, _queuedOperator=&quot;&quot;, _sorting=[], _useProperties=true; if(typeof(d)==&quot;object&quot;&amp;&amp;d.push) { if(d.length&gt;0){ if(typeof(d[0])!=&quot;object&quot;){ _useProperties=false; }else{ _useProperties=true; } } }else{ throw &quot;data provides is not an array&quot;; } this._hasData=function(){ return _data===null?false:_data.length===0?false:true; }; this._getStr=function(s){ var phrase=[]; if(_trim){ phrase.push(&quot;jQuery.trim(&quot;); } phrase.push(&quot;String(&quot;+s+&quot;)&quot;); if(_trim){ phrase.push(&quot;)&quot;); } if(!_usecase){ phrase.push(&quot;.toLowerCase()&quot;); } return phrase.join(&quot;&quot;); }; this._strComp=function(val){ if(typeof(val)==&quot;string&quot;){ return&quot;.toString()&quot;; }else{ return&quot;&quot;; } }; this._group=function(f,u){ return({field:f.toString(),unique:u,items:[]}); }; this._toStr=function(phrase){ if(_trim){ phrase=$.trim(phrase); } phrase=phrase.toString().replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;'); return _usecase ? phrase : phrase.toLowerCase(); }; this._funcLoop=function(func){ var results=[]; $.each(_data,function(i,v){ results.push(func(v)); }); return results; }; this._append=function(s){ var i; if(_query===null){ _query=&quot;&quot;; } else { _query+=_queuedOperator === &quot;&quot; ? &quot; &amp;&amp; &quot; :_queuedOperator; } for (i=0;i&lt;_orDepth;i++){ _query+=&quot;(&quot;; } if(_negate){ _query+=&quot;!&quot;; } _query+=&quot;(&quot;+s+&quot;)&quot;; _negate=false; _queuedOperator=&quot;&quot;; _orDepth=0; }; this._setCommand=function(f,c){ _lastCommand=f; _lastField=c; }; this._resetNegate=function(){ _negate=false; }; this._repeatCommand=function(f,v){ if(_lastCommand===null){ return self; } if(f!==null&amp;&amp;v!==null){ return _lastCommand(f,v); } if(_lastField===null){ return _lastCommand(f); } if(!_useProperties){ return _lastCommand(f); } return _lastCommand(_lastField,f); }; this._equals=function(a,b){ return(self._compare(a,b,1)===0); }; this._compare=function(a,b,d){ var toString = Object.prototype.toString; if( d === undefined) { d = 1; } if(a===undefined) { a = null; } if(b===undefined) { b = null; } if(a===null &amp;&amp; b===null){ return 0; } if(a===null&amp;&amp;b!==null){ return 1; } if(a!==null&amp;&amp;b===null){ return -1; } if (toString.call(a) === '[object Date]' &amp;&amp; toString.call(b) === '[object Date]') { if (a &lt; b) { return -d; } if (a &gt; b) { return d; } return 0; } if(!_usecase &amp;&amp; typeof(a) !== &quot;number&quot; &amp;&amp; typeof(b) !== &quot;number&quot; ) { a=String(a).toLowerCase(); b=String(b).toLowerCase(); } if(a&lt;b){return -d;} if(a&gt;b){return d;} return 0; }; this._performSort=function(){ if(_sorting.length===0){return;} _data=self._doSort(_data,0); }; this._doSort=function(d,q){ var by=_sorting[q].by, dir=_sorting[q].dir, type = _sorting[q].type, dfmt = _sorting[q].datefmt; if(q==_sorting.length-1){ return self._getOrder(d, by, dir, type, dfmt); } q++; var values=self._getGroup(d,by,dir,type,dfmt); var results=[]; for(var i=0;i&lt;values.length;i++){ var sorted=self._doSort(values[i].items,q); for(var j=0;j&lt;sorted.length;j++){ results.push(sorted[j]); } } return results; }; this._getOrder=function(data,by,dir,type, dfmt){ var sortData=[],_sortData=[], newDir = dir==&quot;a&quot; ? 1 : -1, i,ab,j, findSortKey; if(type === undefined ) { type = &quot;text&quot;; } if (type == 'float' || type== 'number' || type== 'currency' || type== 'numeric') { findSortKey = function($cell) { var key = parseFloat( String($cell).replace(_stripNum, '')); return isNaN(key) ? 0.00 : key; }; } else if (type=='int' || type=='integer') { findSortKey = function($cell) { return $cell ? parseFloat(String($cell).replace(_stripNum, '')) : 0; }; } else if(type == 'date' || type == 'datetime') { findSortKey = function($cell) { return $.jgrid.parseDate(dfmt,$cell).getTime(); }; } else if($.isFunction(type)) { findSortKey = type; } else { findSortKey = function($cell) { if(!$cell) {$cell =&quot;&quot;;} return $.trim(String($cell).toUpperCase()); }; } $.each(data,function(i,v){ ab = by!==&quot;&quot; ? $.jgrid.getAccessor(v,by) : v; if(ab === undefined) { ab = &quot;&quot;; } ab = findSortKey(ab, v); _sortData.push({ 'vSort': ab,'index':i}); }); _sortData.sort(function(a,b){ a = a.vSort; b = b.vSort; return self._compare(a,b,newDir); }); j=0; var nrec= data.length; // overhead, but we do not change the original data. while(j&lt;nrec) { i = _sortData[j].index; sortData.push(data[i]); j++; } return sortData; }; this._getGroup=function(data,by,dir,type, dfmt){ var results=[], group=null, last=null, val; $.each(self._getOrder(data,by,dir,type, dfmt),function(i,v){ val = $.jgrid.getAccessor(v, by); if(val === undefined) { val = &quot;&quot;; } if(!self._equals(last,val)){ last=val; if(group !== null){ results.push(group); } group=self._group(by,val); } group.items.push(v); }); if(group !== null){ results.push(group); } return results; }; this.ignoreCase=function(){ _usecase=false; return self; }; this.useCase=function(){ _usecase=true; return self; }; this.trim=function(){ _trim=true; return self; }; this.noTrim=function(){ _trim=false; return self; }; this.execute=function(){ var match=_query, results=[]; if(match === null){ return self; } $.each(_data,function(){ if(eval(match)){results.push(this);} }); _data=results; return self; }; this.data=function(){ return _data; }; this.select=function(f){ self._performSort(); if(!self._hasData()){ return[]; } self.execute(); if($.isFunction(f)){ var results=[]; $.each(_data,function(i,v){ results.push(f(v)); }); return results; } return _data; }; this.hasMatch=function(){ if(!self._hasData()) { return false; } self.execute(); return _data.length&gt;0; }; this.andNot=function(f,v,x){ _negate=!_negate; return self.and(f,v,x); }; this.orNot=function(f,v,x){ _negate=!_negate; return self.or(f,v,x); }; this.not=function(f,v,x){ return self.andNot(f,v,x); }; this.and=function(f,v,x){ _queuedOperator=&quot; &amp;&amp; &quot;; if(f===undefined){ return self; } return self._repeatCommand(f,v,x); }; this.or=function(f,v,x){ _queuedOperator=&quot; || &quot;; if(f===undefined) { return self; } return self._repeatCommand(f,v,x); }; this.orBegin=function(){ _orDepth++; return self; }; this.orEnd=function(){ if (_query !== null){ _query+=&quot;)&quot;; } return self; }; this.isNot=function(f){ _negate=!_negate; return self.is(f); }; this.is=function(f){ self._append('this.'+f); self._resetNegate(); return self; }; this._compareValues=function(func,f,v,how,t){ var fld; if(_useProperties){ fld='jQuery.jgrid.getAccessor(this,\\''+f+'\\')'; }else{ fld='this'; } if(v===undefined) { v = null; } //var val=v===null?f:v, var val =v, swst = t.stype === undefined ? &quot;text&quot; : t.stype; if(v !== null) { switch(swst) { case 'int': case 'integer': val = (isNaN(Number(val)) || val===&quot;&quot;) ? '0' : val; // To be fixed with more inteligent code fld = 'parseInt('+fld+',10)'; val = 'parseInt('+val+',10)'; break; case 'float': case 'number': case 'numeric': val = String(val).replace(_stripNum, ''); val = (isNaN(Number(val)) || val===&quot;&quot;) ? '0' : val; // To be fixed with more inteligent code fld = 'parseFloat('+fld+')'; val = 'parseFloat('+val+')'; break; case 'date': case 'datetime': val = String($.jgrid.parseDate(t.newfmt || 'Y-m-d',val).getTime()); fld = 'jQuery.jgrid.parseDate(&quot;'+t.srcfmt+'&quot;,'+fld+').getTime()'; break; default : fld=self._getStr(fld); val=self._getStr('&quot;'+self._toStr(val)+'&quot;'); } } self._append(fld+' '+how+' '+val); self._setCommand(func,f); self._resetNegate(); return self; }; this.equals=function(f,v,t){ return self._compareValues(self.equals,f,v,&quot;==&quot;,t); }; this.notEquals=function(f,v,t){ return self._compareValues(self.equals,f,v,&quot;!==&quot;,t); }; this.isNull = function(f,v,t){ return self._compareValues(self.equals,f,null,&quot;===&quot;,t); }; this.greater=function(f,v,t){ return self._compareValues(self.greater,f,v,&quot;&gt;&quot;,t); }; this.less=function(f,v,t){ return self._compareValues(self.less,f,v,&quot;&lt;&quot;,t); }; this.greaterOrEquals=function(f,v,t){ return self._compareValues(self.greaterOrEquals,f,v,&quot;&gt;=&quot;,t); }; this.lessOrEquals=function(f,v,t){ return self._compareValues(self.lessOrEquals,f,v,&quot;&lt;=&quot;,t); }; this.startsWith=function(f,v){ var val = (v===undefined || v===null) ? f: v, length=_trim ? $.trim(val.toString()).length : val.toString().length; if(_useProperties){ self._append(self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.substr(0,'+length+') == '+self._getStr('&quot;'+self._toStr(v)+'&quot;')); }else{ length=_trim?$.trim(v.toString()).length:v.toString().length; self._append(self._getStr('this')+'.substr(0,'+length+') == '+self._getStr('&quot;'+self._toStr(f)+'&quot;')); } self._setCommand(self.startsWith,f); self._resetNegate(); return self; }; this.endsWith=function(f,v){ var val = (v===undefined || v===null) ? f: v, length=_trim ? $.trim(val.toString()).length:val.toString().length; if(_useProperties){ self._append(self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.substr('+self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.length-'+length+','+length+') == &quot;'+self._toStr(v)+'&quot;'); } else { self._append(self._getStr('this')+'.substr('+self._getStr('this')+'.length-&quot;'+self._toStr(f)+'&quot;.length,&quot;'+self._toStr(f)+'&quot;.length) == &quot;'+self._toStr(f)+'&quot;'); } self._setCommand(self.endsWith,f);self._resetNegate(); return self; }; this.contains=function(f,v){ if(_useProperties){ self._append(self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.indexOf(&quot;'+self._toStr(v)+'&quot;,0) &gt; -1'); }else{ self._append(self._getStr('this')+'.indexOf(&quot;'+self._toStr(f)+'&quot;,0) &gt; -1'); } self._setCommand(self.contains,f); self._resetNegate(); return self; }; this.groupBy=function(by,dir,type, datefmt){ if(!self._hasData()){ return null; } return self._getGroup(_data,by,dir,type, datefmt); }; this.orderBy=function(by,dir,stype, dfmt){ dir = dir === undefined || dir === null ? &quot;a&quot; :$.trim(dir.toString().toLowerCase()); if(stype === null || stype === undefined) { stype = &quot;text&quot;; } if(dfmt === null || dfmt === undefined) { dfmt = &quot;Y-m-d&quot;; } if(dir==&quot;desc&quot;||dir==&quot;descending&quot;){dir=&quot;d&quot;;} if(dir==&quot;asc&quot;||dir==&quot;ascending&quot;){dir=&quot;a&quot;;} _sorting.push({by:by,dir:dir,type:stype, datefmt: dfmt}); return self; }; return self; }; return new QueryObject(source,null); }, extend : function(methods) { $.extend($.fn.jqGrid,methods); if (!this.no_legacy_api) { $.fn.extend(methods); } } }); $.fn.jqGrid = function( pin ) { if (typeof pin == 'string') { //var fn = $.fn.jqGrid[pin]; var fn = $.jgrid.getAccessor($.fn.jqGrid,pin); if (!fn) { throw (&quot;jqGrid - No such method: &quot; + pin); } var args = $.makeArray(arguments).slice(1); return fn.apply(this,args); } return this.each( function() { if(this.grid) {return;} var p = $.extend(true,{ url: &quot;&quot;, height: 150, page: 1, rowNum: 20, rowTotal : null, records: 0, pager: &quot;&quot;, pgbuttons: true, pginput: true, colModel: [], rowList: [], colNames: [], sortorder: &quot;asc&quot;, sortname: &quot;&quot;, datatype: &quot;xml&quot;, mtype: &quot;GET&quot;, altRows: false, selarrrow: [], savedRow: [], shrinkToFit: true, xmlReader: {}, jsonReader: {}, subGrid: false, subGridModel :[], reccount: 0, lastpage: 0, lastsort: 0, selrow: null, beforeSelectRow: null, onSelectRow: null, onSortCol: null, ondblClickRow: null, onRightClickRow: null, onPaging: null, onSelectAll: null, loadComplete: null, gridComplete: null, loadError: null, loadBeforeSend: null, afterInsertRow: null, beforeRequest: null, beforeProcessing : null, onHeaderClick: null, viewrecords: false, loadonce: false, multiselect: false, multikey: false, editurl: null, search: false, caption: &quot;&quot;, hidegrid: true, hiddengrid: false, postData: {}, userData: {}, treeGrid : false, treeGridModel : 'nested', treeReader : {}, treeANode : -1, ExpandColumn: null, tree_root_level : 0, prmNames: {page:&quot;page&quot;,rows:&quot;rows&quot;, sort: &quot;sidx&quot;,order: &quot;sord&quot;, search:&quot;_search&quot;, nd:&quot;nd&quot;, id:&quot;id&quot;,oper:&quot;oper&quot;,editoper:&quot;edit&quot;,addoper:&quot;add&quot;,deloper:&quot;del&quot;, subgridid:&quot;id&quot;, npage: null, totalrows:&quot;totalrows&quot;}, forceFit : false, gridstate : &quot;visible&quot;, cellEdit: false, cellsubmit: &quot;remote&quot;, nv:0, loadui: &quot;enable&quot;, toolbar: [false,&quot;&quot;], scroll: false, multiboxonly : false, deselectAfterSort : true, scrollrows : false, autowidth: false, scrollOffset :18, cellLayout: 5, subGridWidth: 20, multiselectWidth: 20, gridview: false, rownumWidth: 25, rownumbers : false, pagerpos: 'center', recordpos: 'right', footerrow : false, userDataOnFooter : false, hoverrows : true, altclass : 'ui-priority-secondary', viewsortcols : [false,'vertical',true], resizeclass : '', autoencode : false, remapColumns : [], ajaxGridOptions :{}, direction : &quot;ltr&quot;, toppager: false, headertitles: false, scrollTimeout: 40, data : [], _index : {}, grouping : false, groupingView : {groupField:[],groupOrder:[], groupText:[],groupColumnShow:[],groupSummary:[], showSummaryOnHide: false, sortitems:[], sortnames:[], summary:[],summaryval:[], plusicon: 'ui-icon-circlesmall-plus', minusicon: 'ui-icon-circlesmall-minus'}, ignoreCase : false, cmTemplate : {}, idPrefix : &quot;&quot; }, $.jgrid.defaults, pin || {}); var ts= this, grid={ headers:[], cols:[], footers: [], dragStart: function(i,x,y) { this.resizing = { idx: i, startX: x.clientX, sOL : y[0]}; this.hDiv.style.cursor = &quot;col-resize&quot;; this.curGbox = $(&quot;#rs_m&quot;+$.jgrid.jqID(p.id),&quot;#gbox_&quot;+$.jgrid.jqID(p.id)); this.curGbox.css({display:&quot;block&quot;,left:y[0],top:y[1],height:y[2]}); $(ts).triggerHandler(&quot;jqGridResizeStart&quot;, [x, i]); if($.isFunction(p.resizeStart)) { p.resizeStart.call(this,x,i); } document.onselectstart=function(){return false;}; }, dragMove: function(x) { if(this.resizing) { var diff = x.clientX-this.resizing.startX, h = this.headers[this.resizing.idx], newWidth = p.direction === &quot;ltr&quot; ? h.width + diff : h.width - diff, hn, nWn; if(newWidth &gt; 33) { this.curGbox.css({left:this.resizing.sOL+diff}); if(p.forceFit===true ){ hn = this.headers[this.resizing.idx+p.nv]; nWn = p.direction === &quot;ltr&quot; ? hn.width - diff : hn.width + diff; if(nWn &gt;33) { h.newWidth = newWidth; hn.newWidth = nWn; } } else { this.newWidth = p.direction === &quot;ltr&quot; ? p.tblwidth+diff : p.tblwidth-diff; h.newWidth = newWidth; } } } }, dragEnd: function() { this.hDiv.style.cursor = &quot;default&quot;; if(this.resizing) { var idx = this.resizing.idx, nw = this.headers[idx].newWidth || this.headers[idx].width; nw = parseInt(nw,10); this.resizing = false; $(&quot;#rs_m&quot;+$.jgrid.jqID(p.id)).css(&quot;display&quot;,&quot;none&quot;); p.colModel[idx].width = nw; this.headers[idx].width = nw; this.headers[idx].el.style.width = nw + &quot;px&quot;; this.cols[idx].style.width = nw+&quot;px&quot;; if(this.footers.length&gt;0) {this.footers[idx].style.width = nw+&quot;px&quot;;} if(p.forceFit===true){ nw = this.headers[idx+p.nv].newWidth || this.headers[idx+p.nv].width; this.headers[idx+p.nv].width = nw; this.headers[idx+p.nv].el.style.width = nw + &quot;px&quot;; this.cols[idx+p.nv].style.width = nw+&quot;px&quot;; if(this.footers.length&gt;0) {this.footers[idx+p.nv].style.width = nw+&quot;px&quot;;} p.colModel[idx+p.nv].width = nw; } else { p.tblwidth = this.newWidth || p.tblwidth; $('table:first',this.bDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;); $('table:first',this.hDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;); this.hDiv.scrollLeft = this.bDiv.scrollLeft; if(p.footerrow) { $('table:first',this.sDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;); this.sDiv.scrollLeft = this.bDiv.scrollLeft; } } $(ts).triggerHandler(&quot;jqGridResizeStop&quot;, [nw, idx]); if($.isFunction(p.resizeStop)) { p.resizeStop.call(this,nw,idx); } } this.curGbox = null; document.onselectstart=function(){return true;}; }, populateVisible: function() { if (grid.timer) { clearTimeout(grid.timer); } grid.timer = null; var dh = $(grid.bDiv).height(); if (!dh) { return; } var table = $(&quot;table:first&quot;, grid.bDiv); var rows, rh; if(table[0].rows.length) { try { rows = table[0].rows[1]; rh = rows ? $(rows).outerHeight() || grid.prevRowHeight : grid.prevRowHeight; } catch (pv) { rh = grid.prevRowHeight; } } if (!rh) { return; } grid.prevRowHeight = rh; var rn = p.rowNum; var scrollTop = grid.scrollTop = grid.bDiv.scrollTop; var ttop = Math.round(table.position().top) - scrollTop; var tbot = ttop + table.height(); var div = rh * rn; var page, npage, empty; if ( tbot &lt; dh &amp;&amp; ttop &lt;= 0 &amp;&amp; (p.lastpage===undefined||parseInt((tbot + scrollTop + div - 1) / div,10) &lt;= p.lastpage)) { npage = parseInt((dh - tbot + div - 1) / div,10); if (tbot &gt;= 0 || npage &lt; 2 || p.scroll === true) { page = Math.round((tbot + scrollTop) / div) + 1; ttop = -1; } else { ttop = 1; } } if (ttop &gt; 0) { page = parseInt(scrollTop / div,10) + 1; npage = parseInt((scrollTop + dh) / div,10) + 2 - page; empty = true; } if (npage) { if (p.lastpage &amp;&amp; page &gt; p.lastpage || p.lastpage==1 || (page === p.page &amp;&amp; page===p.lastpage) ) { return; } if (grid.hDiv.loading) { grid.timer = setTimeout(grid.populateVisible, p.scrollTimeout); } else { p.page = page; if (empty) { grid.selectionPreserver(table[0]); grid.emptyRows.call(table[0], false, false); } grid.populate(npage); } } }, scrollGrid: function( e ) { if(p.scroll) { var scrollTop = grid.bDiv.scrollTop; if(grid.scrollTop === undefined) { grid.scrollTop = 0; } if (scrollTop != grid.scrollTop) { grid.scrollTop = scrollTop; if (grid.timer) { clearTimeout(grid.timer); } grid.timer = setTimeout(grid.populateVisible, p.scrollTimeout); } } grid.hDiv.scrollLeft = grid.bDiv.scrollLeft; if(p.footerrow) { grid.sDiv.scrollLeft = grid.bDiv.scrollLeft; } if( e ) { e.stopPropagation(); } }, selectionPreserver : function(ts) { var p = ts.p, sr = p.selrow, sra = p.selarrrow ? $.makeArray(p.selarrrow) : null, left = ts.grid.bDiv.scrollLeft, restoreSelection = function() { var i; p.selrow = null; p.selarrrow = []; if(p.multiselect &amp;&amp; sra &amp;&amp; sra.length&gt;0) { for(i=0;i&lt;sra.length;i++){ if (sra[i] != sr) { $(ts).jqGrid(&quot;setSelection&quot;,sra[i],false, null); } } } if (sr) { $(ts).jqGrid(&quot;setSelection&quot;,sr,false,null); } ts.grid.bDiv.scrollLeft = left; $(ts).unbind('.selectionPreserver', restoreSelection); }; $(ts).bind('jqGridGridComplete.selectionPreserver', restoreSelection); } }; if(this.tagName.toUpperCase()!='TABLE') { alert(&quot;Element is not a table&quot;); return; } if(document.documentMode !== undefined ) { // IE only if(document.documentMode &lt;= 5) { alert(&quot;Grid can not be used in this ('quirks') mode!&quot;); return; } } $(this).empty().attr(&quot;tabindex&quot;,&quot;1&quot;); this.p = p ; this.p.useProp = !!$.fn.prop; var i, dir; if(this.p.colNames.length === 0) { for (i=0;i&lt;this.p.colModel.length;i++){ this.p.colNames[i] = this.p.colModel[i].label || this.p.colModel[i].name; } } if( this.p.colNames.length !== this.p.colModel.length ) { alert($.jgrid.errors.model); return; } var gv = $(&quot;&lt;div class='ui-jqgrid-view'&gt;&lt;/div&gt;&quot;), ii, isMSIE = $.browser.msie ? true:false; ts.p.direction = $.trim(ts.p.direction.toLowerCase()); if($.inArray(ts.p.direction,[&quot;ltr&quot;,&quot;rtl&quot;]) == -1) { ts.p.direction = &quot;ltr&quot;; } dir = ts.p.direction; $(gv).insertBefore(this); $(this).appendTo(gv).removeClass(&quot;scroll&quot;); var eg = $(&quot;&lt;div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'&gt;&lt;/div&gt;&quot;); $(eg).insertBefore(gv).attr({&quot;id&quot; : &quot;gbox_&quot;+this.id,&quot;dir&quot;:dir}); $(gv).appendTo(eg).attr(&quot;id&quot;,&quot;gview_&quot;+this.id); if (isMSIE &amp;&amp; $.browser.version &lt;= 6) { ii = '&lt;iframe style=&quot;display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\\'0\\');&quot; src=&quot;javascript:false;&quot;&gt;&lt;/iframe&gt;'; } else { ii=&quot;&quot;;} $(&quot;&lt;div class='ui-widget-overlay jqgrid-overlay' id='lui_&quot;+this.id+&quot;'&gt;&lt;/div&gt;&quot;).append(ii).insertBefore(gv); $(&quot;&lt;div class='loading ui-state-default ui-state-active' id='load_&quot;+this.id+&quot;'&gt;&quot;+this.p.loadtext+&quot;&lt;/div&gt;&quot;).insertBefore(gv); $(this).attr({cellspacing:&quot;0&quot;,cellpadding:&quot;0&quot;,border:&quot;0&quot;,&quot;role&quot;:&quot;grid&quot;,&quot;aria-multiselectable&quot;:!!this.p.multiselect,&quot;aria-labelledby&quot;:&quot;gbox_&quot;+this.id}); var sortkeys = [&quot;shiftKey&quot;,&quot;altKey&quot;,&quot;ctrlKey&quot;], intNum = function(val,defval) { val = parseInt(val,10); if (isNaN(val)) { return defval ? defval : 0;} else {return val;} }, formatCol = function (pos, rowInd, tv, rawObject, rowId, rdata){ var cm = ts.p.colModel[pos], ral = cm.align, result=&quot;style=\\&quot;&quot;, clas = cm.classes, nm = cm.name, celp, acp=[]; if(ral) { result += &quot;text-align:&quot;+ral+&quot;;&quot;; } if(cm.hidden===true) { result += &quot;display:none;&quot;; } if(rowInd===0) { result += &quot;width: &quot;+grid.headers[pos].width+&quot;px;&quot;; } else if (cm.cellattr &amp;&amp; $.isFunction(cm.cellattr)) { celp = cm.cellattr.call(ts, rowId, tv, rawObject, cm, rdata); if(celp &amp;&amp; typeof(celp) === &quot;string&quot;) { celp = celp.replace(/style/i,'style').replace(/title/i,'title'); if(celp.indexOf('title') &gt; -1) { cm.title=false;} if(celp.indexOf('class') &gt; -1) { clas = undefined;} acp = celp.split(&quot;style&quot;); if(acp.length === 2 ) { acp[1] = $.trim(acp[1].replace(&quot;=&quot;,&quot;&quot;)); if(acp[1].indexOf(&quot;'&quot;) === 0 || acp[1].indexOf('&quot;') === 0) { acp[1] = acp[1].substring(1); } result += acp[1].replace(/'/gi,'&quot;'); } else { result += &quot;\\&quot;&quot;; } } } if(!acp.length) { acp[0] = &quot;&quot;; result += &quot;\\&quot;&quot;;} result += (clas !== undefined ? (&quot; class=\\&quot;&quot;+clas+&quot;\\&quot;&quot;) :&quot;&quot;) + ((cm.title &amp;&amp; tv) ? (&quot; title=\\&quot;&quot;+$.jgrid.stripHtml(tv)+&quot;\\&quot;&quot;) :&quot;&quot;); result += &quot; aria-describedby=\\&quot;&quot;+ts.p.id+&quot;_&quot;+nm+&quot;\\&quot;&quot;; return result + acp[0]; }, cellVal = function (val) { return val === undefined || val === null || val === &quot;&quot; ? &quot;&amp;#160;&quot; : (ts.p.autoencode ? $.jgrid.htmlEncode(val) : val+&quot;&quot;); }, formatter = function (rowId, cellval , colpos, rwdat, _act){ var cm = ts.p.colModel[colpos],v; if(typeof cm.formatter !== 'undefined') { var opts= {rowId: rowId, colModel:cm, gid:ts.p.id, pos:colpos }; if($.isFunction( cm.formatter ) ) { v = cm.formatter.call(ts,cellval,opts,rwdat,_act); } else if($.fmatter){ v = $.fn.fmatter.call(ts,cm.formatter,cellval,opts,rwdat,_act); } else { v = cellVal(cellval); } } else { v = cellVal(cellval); } return v; }, addCell = function(rowId,cell,pos,irow, srvr) { var v,prp; v = formatter(rowId,cell,pos,srvr,'add'); prp = formatCol( pos,irow, v, srvr, rowId, true); return &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; }, addMulti = function(rowid,pos,irow,checked){ var v = &quot;&lt;input role=\\&quot;checkbox\\&quot; type=\\&quot;checkbox\\&quot;&quot;+&quot; id=\\&quot;jqg_&quot;+ts.p.id+&quot;_&quot;+rowid+&quot;\\&quot; class=\\&quot;cbox\\&quot; name=\\&quot;jqg_&quot;+ts.p.id+&quot;_&quot;+rowid+&quot;\\&quot;&quot; + ((checked) ? &quot;checked=\\&quot;checked\\&quot;&quot; : &quot;&quot;)+&quot;/&gt;&quot;, prp = formatCol( pos,irow,'',null, rowid, true); return &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; }, addRowNum = function (pos,irow,pG,rN) { var v = (parseInt(pG,10)-1)*parseInt(rN,10)+1+irow, prp = formatCol( pos,irow,v, null, irow, true); return &quot;&lt;td role=\\&quot;gridcell\\&quot; class=\\&quot;ui-state-default jqgrid-rownum\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; }, reader = function (datatype) { var field, f=[], j=0, i; for(i =0; i&lt;ts.p.colModel.length; i++){ field = ts.p.colModel[i]; if (field.name !== 'cb' &amp;&amp; field.name !=='subgrid' &amp;&amp; field.name !=='rn') { f[j]= datatype == &quot;local&quot; ? field.name : ( (datatype==&quot;xml&quot; || datatype === &quot;xmlstring&quot;) ? field.xmlmap || field.name : field.jsonmap || field.name ); j++; } } return f; }, orderedCols = function (offset) { var order = ts.p.remapColumns; if (!order || !order.length) { order = $.map(ts.p.colModel, function(v,i) { return i; }); } if (offset) { order = $.map(order, function(v) { return v&lt;offset?null:v-offset; }); } return order; }, emptyRows = function (scroll, locdata) { var firstrow; if (this.p.deepempty) { $(this.rows).slice(1).remove(); } else { firstrow = this.rows.length &gt; 0 ? this.rows[0] : null; $(this.firstChild).empty().append(firstrow); } if (scroll &amp;&amp; this.p.scroll) { $(this.grid.bDiv.firstChild).css({height: &quot;auto&quot;}); $(this.grid.bDiv.firstChild.firstChild).css({height: 0, display: &quot;none&quot;}); if (this.grid.bDiv.scrollTop !== 0) { this.grid.bDiv.scrollTop = 0; } } if(locdata === true &amp;&amp; this.p.treeGrid) { this.p.data = []; this.p._index = {}; } }, refreshIndex = function() { var datalen = ts.p.data.length, idname, i, val, ni = ts.p.rownumbers===true ? 1 :0, gi = ts.p.multiselect ===true ? 1 :0, si = ts.p.subGrid===true ? 1 :0; if(ts.p.keyIndex === false || ts.p.loadonce === true) { idname = ts.p.localReader.id; } else { idname = ts.p.colModel[ts.p.keyIndex+gi+si+ni].name; } for(i =0;i &lt; datalen; i++) { val = $.jgrid.getAccessor(ts.p.data[i],idname); ts.p._index[val] = i; } }, constructTr = function(id, hide, altClass, rd, cur, selected) { var tabindex = '-1', restAttr = '', attrName, style = hide ? 'display:none;' : '', classes = 'ui-widget-content jqgrow ui-row-' + ts.p.direction + altClass + ((selected) ? ' ui-state-highlight' : ''), rowAttrObj = $.isFunction(ts.p.rowattr) ? ts.p.rowattr.call(ts, rd, cur) : {}; if(!$.isEmptyObject( rowAttrObj )) { if (rowAttrObj.hasOwnProperty(&quot;id&quot;)) { id = rowAttrObj.id; delete rowAttrObj.id; } if (rowAttrObj.hasOwnProperty(&quot;tabindex&quot;)) { tabindex = rowAttrObj.tabindex; delete rowAttrObj.tabindex; } if (rowAttrObj.hasOwnProperty(&quot;style&quot;)) { style += rowAttrObj.style; delete rowAttrObj.style; } if (rowAttrObj.hasOwnProperty(&quot;class&quot;)) { classes += ' ' + rowAttrObj['class']; delete rowAttrObj['class']; } // dot't allow to change role attribute try { delete rowAttrObj.role; } catch(ra){} for (attrName in rowAttrObj) { if (rowAttrObj.hasOwnProperty(attrName)) { restAttr += ' ' + attrName + '=' + rowAttrObj[attrName]; } } } return '&lt;tr role=&quot;row&quot; id=&quot;' + id + '&quot; tabindex=&quot;' + tabindex + '&quot; class=&quot;' + classes + '&quot;' + (style === '' ? '' : ' style=&quot;' + style + '&quot;') + restAttr + '&gt;'; }, addXmlData = function (xml,t, rcnt, more, adjust) { var startReq = new Date(), locdata = (ts.p.datatype != &quot;local&quot; &amp;&amp; ts.p.loadonce) || ts.p.datatype == &quot;xmlstring&quot;, xmlid = &quot;_id_&quot;, xmlRd = ts.p.xmlReader, frd = ts.p.datatype == &quot;local&quot; ? &quot;local&quot; : &quot;xml&quot;; if(locdata) { ts.p.data = []; ts.p._index = {}; ts.p.localReader.id = xmlid; } ts.p.reccount = 0; if($.isXMLDoc(xml)) { if(ts.p.treeANode===-1 &amp;&amp; !ts.p.scroll) { emptyRows.call(ts, false, true); rcnt=1; } else { rcnt = rcnt &gt; 1 ? rcnt :1; } } else { return; } var i,fpos,ir=0,v,gi=ts.p.multiselect===true?1:0,si=ts.p.subGrid===true?1:0,ni=ts.p.rownumbers===true?1:0,idn, getId,f=[],F,rd ={}, xmlr,rid, rowData=[], cn=(ts.p.altRows === true) ? &quot; &quot;+ts.p.altclass:&quot;&quot;,cn1; if(!xmlRd.repeatitems) {f = reader(frd);} if( ts.p.keyIndex===false) { idn = $.isFunction( xmlRd.id ) ? xmlRd.id.call(ts, xml) : xmlRd.id; } else { idn = ts.p.keyIndex; } if(f.length&gt;0 &amp;&amp; !isNaN(idn)) { if (ts.p.remapColumns &amp;&amp; ts.p.remapColumns.length) { idn = $.inArray(idn, ts.p.remapColumns); } idn=f[idn]; } if( (idn+&quot;&quot;).indexOf(&quot;[&quot;) === -1 ) { if (f.length) { getId = function( trow, k) {return $(idn,trow).text() || k;}; } else { getId = function( trow, k) {return $(xmlRd.cell,trow).eq(idn).text() || k;}; } } else { getId = function( trow, k) {return trow.getAttribute(idn.replace(/[\\[\\]]/g,&quot;&quot;)) || k;}; } ts.p.userData = {}; ts.p.page = $.jgrid.getXmlData( xml,xmlRd.page ) || ts.p.page || 0; ts.p.lastpage = $.jgrid.getXmlData( xml,xmlRd.total ); if(ts.p.lastpage===undefined) { ts.p.lastpage=1; } ts.p.records = $.jgrid.getXmlData( xml,xmlRd.records ) || 0; if($.isFunction(xmlRd.userdata)) { ts.p.userData = xmlRd.userdata.call(ts, xml) || {}; } else { $.jgrid.getXmlData(xml, xmlRd.userdata, true).each(function() {ts.p.userData[this.getAttribute(&quot;name&quot;)]= $(this).text();}); } var gxml = $.jgrid.getXmlData( xml, xmlRd.root, true); gxml = $.jgrid.getXmlData( gxml, xmlRd.row, true); if (!gxml) { gxml = []; } var gl = gxml.length, j=0, grpdata=[], rn = parseInt(ts.p.rowNum,10); if (gl &gt; 0 &amp;&amp; ts.p.page &lt;= 0) { ts.p.page = 1; } if(gxml &amp;&amp; gl){ var br=ts.p.scroll?$.jgrid.randId():1,altr; if (adjust) { rn *= adjust+1; } var afterInsRow = $.isFunction(ts.p.afterInsertRow), hiderow=ts.p.grouping &amp;&amp; ts.p.groupingView.groupCollapse === true; while (j&lt;gl) { xmlr = gxml[j]; rid = getId(xmlr,br+j); rid = ts.p.idPrefix + rid; altr = rcnt === 0 ? 0 : rcnt+1; cn1 = (altr+j)%2 == 1 ? cn : ''; var iStartTrTag = rowData.length; rowData.push(&quot;&quot;); if( ni ) { rowData.push( addRowNum(0,j,ts.p.page,ts.p.rowNum) ); } if( gi ) { rowData.push( addMulti(rid,ni,j, false) ); } if( si ) { rowData.push( $(ts).jqGrid(&quot;addSubGridCell&quot;,gi+ni,j+rcnt) ); } if(xmlRd.repeatitems){ if (!F) { F=orderedCols(gi+si+ni); } var cells = $.jgrid.getXmlData( xmlr, xmlRd.cell, true); $.each(F, function (k) { var cell = cells[this]; if (!cell) { return false; } v = cell.textContent || cell.text; rd[ts.p.colModel[k+gi+si+ni].name] = v; rowData.push( addCell(rid,v,k+gi+si+ni,j+rcnt,xmlr) ); }); } else { for(i = 0; i &lt; f.length;i++) { v = $.jgrid.getXmlData( xmlr, f[i]); rd[ts.p.colModel[i+gi+si+ni].name] = v; rowData.push( addCell(rid, v, i+gi+si+ni, j+rcnt, xmlr) ); } } rowData[iStartTrTag] = constructTr(rid, hiderow, cn1, rd, xmlr, false); rowData.push(&quot;&lt;/tr&gt;&quot;); if(ts.p.grouping) { grpdata = $(ts).jqGrid('groupingPrepare',rowData, grpdata, rd, j); rowData = []; } if(locdata || ts.p.treeGrid === true) { rd[xmlid] = rid; ts.p.data.push(rd); ts.p._index[rid] = ts.p.data.length-1; } if(ts.p.gridview === false ) { $(&quot;tbody:first&quot;,t).append(rowData.join('')); $(ts).triggerHandler(&quot;jqGridAfterInsertRow&quot;, [rid, rd, xmlr]); if(afterInsRow) {ts.p.afterInsertRow.call(ts,rid,rd,xmlr);} rowData=[]; } rd={}; ir++; j++; if(ir==rn) {break;} } } if(ts.p.gridview === true) { fpos = ts.p.treeANode &gt; -1 ? ts.p.treeANode: 0; if(ts.p.grouping) { $(ts).jqGrid('groupingRender',grpdata,ts.p.colModel.length); grpdata = null; } else if(ts.p.treeGrid === true &amp;&amp; fpos &gt; 0) { $(ts.rows[fpos]).after(rowData.join('')); } else { $(&quot;tbody:first&quot;,t).append(rowData.join('')); } } if(ts.p.subGrid === true ) { try {$(ts).jqGrid(&quot;addSubGrid&quot;,gi+ni);} catch (_){} } ts.p.totaltime = new Date() - startReq; if(ir&gt;0) { if(ts.p.records===0) { ts.p.records=gl;} } rowData =null; if( ts.p.treeGrid === true) { try {$(ts).jqGrid(&quot;setTreeNode&quot;, fpos+1, ir+fpos+1);} catch (e) {} } if(!ts.p.treeGrid &amp;&amp; !ts.p.scroll) {ts.grid.bDiv.scrollTop = 0;} ts.p.reccount=ir; ts.p.treeANode = -1; if(ts.p.userDataOnFooter) { $(ts).jqGrid(&quot;footerData&quot;,&quot;set&quot;,ts.p.userData,true); } if(locdata) { ts.p.records = gl; ts.p.lastpage = Math.ceil(gl/ rn); } if (!more) { ts.updatepager(false,true); } if(locdata) { while (ir&lt;gl) { xmlr = gxml[ir]; rid = getId(xmlr,ir+br); rid = ts.p.idPrefix + rid; if(xmlRd.repeatitems){ if (!F) { F=orderedCols(gi+si+ni); } var cells2 = $.jgrid.getXmlData( xmlr, xmlRd.cell, true); $.each(F, function (k) { var cell = cells2[this]; if (!cell) { return false; } v = cell.textContent || cell.text; rd[ts.p.colModel[k+gi+si+ni].name] = v; }); } else { for(i = 0; i &lt; f.length;i++) { v = $.jgrid.getXmlData( xmlr, f[i]); rd[ts.p.colModel[i+gi+si+ni].name] = v; } } rd[xmlid] = rid; ts.p.data.push(rd); ts.p._index[rid] = ts.p.data.length-1; rd = {}; ir++; } } }, addJSONData = function(data,t, rcnt, more, adjust) { var startReq = new Date(); if(data) { if(ts.p.treeANode === -1 &amp;&amp; !ts.p.scroll) { emptyRows.call(ts, false, true); rcnt=1; } else { rcnt = rcnt &gt; 1 ? rcnt :1; } } else { return; } var dReader, locid = &quot;_id_&quot;, frd, locdata = (ts.p.datatype != &quot;local&quot; &amp;&amp; ts.p.loadonce) || ts.p.datatype == &quot;jsonstring&quot;; if(locdata) { ts.p.data = []; ts.p._index = {}; ts.p.localReader.id = locid;} ts.p.reccount = 0; if(ts.p.datatype == &quot;local&quot;) { dReader = ts.p.localReader; frd= 'local'; } else { dReader = ts.p.jsonReader; frd='json'; } var ir=0,v,i,j,f=[],F,cur,gi=ts.p.multiselect?1:0,si=ts.p.subGrid?1:0,ni=ts.p.rownumbers===true?1:0,len,drows,idn,rd={}, fpos, idr,rowData=[],cn=(ts.p.altRows === true) ? &quot; &quot;+ts.p.altclass:&quot;&quot;,cn1,lp; ts.p.page = $.jgrid.getAccessor(data,dReader.page) || ts.p.page || 0; lp = $.jgrid.getAccessor(data,dReader.total); ts.p.lastpage = lp === undefined ? 1 : lp; ts.p.records = $.jgrid.getAccessor(data,dReader.records) || 0; ts.p.userData = $.jgrid.getAccessor(data,dReader.userdata) || {}; if(!dReader.repeatitems) { F = f = reader(frd); } if( ts.p.keyIndex===false ) { idn = $.isFunction(dReader.id) ? dReader.id.call(ts, data) : dReader.id; } else { idn = ts.p.keyIndex; } if(f.length&gt;0 &amp;&amp; !isNaN(idn)) { if (ts.p.remapColumns &amp;&amp; ts.p.remapColumns.length) { idn = $.inArray(idn, ts.p.remapColumns); } idn=f[idn]; } drows = $.jgrid.getAccessor(data,dReader.root); if (!drows) { drows = []; } len = drows.length; i=0; if (len &gt; 0 &amp;&amp; ts.p.page &lt;= 0) { ts.p.page = 1; } var rn = parseInt(ts.p.rowNum,10),br=ts.p.scroll?$.jgrid.randId():1, altr, selected=false, selr; if (adjust) { rn *= adjust+1; } if(ts.p.datatype === &quot;local&quot; &amp;&amp; !ts.p.deselectAfterSort) { selected = true; } var afterInsRow = $.isFunction(ts.p.afterInsertRow), grpdata=[], hiderow=ts.p.grouping &amp;&amp; ts.p.groupingView.groupCollapse === true; while (i&lt;len) { cur = drows[i]; idr = $.jgrid.getAccessor(cur,idn); if(idr === undefined) { idr = br+i; if(f.length===0){ if(dReader.cell){ var ccur = $.jgrid.getAccessor(cur,dReader.cell); idr = ccur !== undefined ? ccur[idn] || idr : idr; ccur=null; } } } idr = ts.p.idPrefix + idr; altr = rcnt === 1 ? 0 : rcnt; cn1 = (altr+i)%2 == 1 ? cn : ''; if( selected) { if( ts.p.multiselect) { selr = ($.inArray(idr, ts.p.selarrrow) !== -1); } else { selr = (idr === ts.p.selrow); } } var iStartTrTag = rowData.length; rowData.push(&quot;&quot;); if( ni ) { rowData.push( addRowNum(0,i,ts.p.page,ts.p.rowNum) ); } if( gi ){ rowData.push( addMulti(idr,ni,i,selr) ); } if( si ) { rowData.push( $(ts).jqGrid(&quot;addSubGridCell&quot;,gi+ni,i+rcnt) ); } if (dReader.repeatitems) { if(dReader.cell) {cur = $.jgrid.getAccessor(cur,dReader.cell);} if (!F) { F=orderedCols(gi+si+ni); } } for (j=0;j&lt;F.length;j++) { v = $.jgrid.getAccessor(cur,F[j]); rowData.push( addCell(idr,v,j+gi+si+ni,i+rcnt,cur) ); rd[ts.p.colModel[j+gi+si+ni].name] = v; } rowData[iStartTrTag] = constructTr(idr, hiderow, cn1, rd, cur, selr); rowData.push( &quot;&lt;/tr&gt;&quot; ); if(ts.p.grouping) { grpdata = $(ts).jqGrid('groupingPrepare',rowData, grpdata, rd, i); rowData = []; } if(locdata || ts.p.treeGrid===true) { rd[locid] = idr; ts.p.data.push(rd); ts.p._index[idr] = ts.p.data.length-1; } if(ts.p.gridview === false ) { $(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;).append(rowData.join('')); $(ts).triggerHandler(&quot;jqGridAfterInsertRow&quot;, [idr, rd, cur]); if(afterInsRow) {ts.p.afterInsertRow.call(ts,idr,rd,cur);} rowData=[];//ari=0; } rd={}; ir++; i++; if(ir==rn) { break; } } if(ts.p.gridview === true ) { fpos = ts.p.treeANode &gt; -1 ? ts.p.treeANode: 0; if(ts.p.grouping) { $(ts).jqGrid('groupingRender',grpdata,ts.p.colModel.length); grpdata = null; } else if(ts.p.treeGrid === true &amp;&amp; fpos &gt; 0) { $(ts.rows[fpos]).after(rowData.join('')); } else { $(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;).append(rowData.join('')); } } if(ts.p.subGrid === true ) { try { $(ts).jqGrid(&quot;addSubGrid&quot;,gi+ni);} catch (_){} } ts.p.totaltime = new Date() - startReq; if(ir&gt;0) { if(ts.p.records===0) { ts.p.records=len; } } rowData = null; if( ts.p.treeGrid === true) { try {$(ts).jqGrid(&quot;setTreeNode&quot;, fpos+1, ir+fpos+1);} catch (e) {} } if(!ts.p.treeGrid &amp;&amp; !ts.p.scroll) {ts.grid.bDiv.scrollTop = 0;} ts.p.reccount=ir; ts.p.treeANode = -1; if(ts.p.userDataOnFooter) { $(ts).jqGrid(&quot;footerData&quot;,&quot;set&quot;,ts.p.userData,true); } if(locdata) { ts.p.records = len; ts.p.lastpage = Math.ceil(len/ rn); } if (!more) { ts.updatepager(false,true); } if(locdata) { while (ir&lt;len &amp;&amp; drows[ir]) { cur = drows[ir]; idr = $.jgrid.getAccessor(cur,idn); if(idr === undefined) { idr = br+ir; if(f.length===0){ if(dReader.cell){ var ccur2 = $.jgrid.getAccessor(cur,dReader.cell); idr = ccur2[idn] || idr; ccur2=null; } } } if(cur) { idr = ts.p.idPrefix + idr; if (dReader.repeatitems) { if(dReader.cell) {cur = $.jgrid.getAccessor(cur,dReader.cell);} if (!F) { F=orderedCols(gi+si+ni); } } for (j=0;j&lt;F.length;j++) { v = $.jgrid.getAccessor(cur,F[j]); rd[ts.p.colModel[j+gi+si+ni].name] = v; } rd[locid] = idr; ts.p.data.push(rd); ts.p._index[idr] = ts.p.data.length-1; rd = {}; } ir++; } } }, addLocalData = function() { var st, fndsort=false, cmtypes={}, grtypes=[], grindexes=[], srcformat, sorttype, newformat; if(!$.isArray(ts.p.data)) { return; } var grpview = ts.p.grouping ? ts.p.groupingView : false, lengrp, gin; $.each(ts.p.colModel,function(){ sorttype = this.sorttype || &quot;text&quot;; if(sorttype == &quot;date&quot; || sorttype == &quot;datetime&quot;) { if(this.formatter &amp;&amp; typeof(this.formatter) === 'string' &amp;&amp; this.formatter == 'date') { if(this.formatoptions &amp;&amp; this.formatoptions.srcformat) { srcformat = this.formatoptions.srcformat; } else { srcformat = $.jgrid.formatter.date.srcformat; } if(this.formatoptions &amp;&amp; this.formatoptions.newformat) { newformat = this.formatoptions.newformat; } else { newformat = $.jgrid.formatter.date.newformat; } } else { srcformat = newformat = this.datefmt || &quot;Y-m-d&quot;; } cmtypes[this.name] = {&quot;stype&quot;: sorttype, &quot;srcfmt&quot;: srcformat,&quot;newfmt&quot;:newformat}; } else { cmtypes[this.name] = {&quot;stype&quot;: sorttype, &quot;srcfmt&quot;:'',&quot;newfmt&quot;:''}; } if(ts.p.grouping ) { for(gin =0, lengrp = grpview.groupField.length; gin&lt; lengrp; gin++) { if( this.name == grpview.groupField[gin]) { var grindex = this.name; // if (typeof this.index != 'undefined') { // grindex = this.index; // } grtypes[gin] = cmtypes[grindex]; grindexes[gin]= grindex; } } } if(!fndsort &amp;&amp; (this.index == ts.p.sortname || this.name == ts.p.sortname)){ st = this.name; // ??? fndsort = true; } }); if(ts.p.treeGrid) { $(ts).jqGrid(&quot;SortTree&quot;, st, ts.p.sortorder, cmtypes[st].stype, cmtypes[st].srcfmt); return; } var compareFnMap = { 'eq':function(queryObj) {return queryObj.equals;}, 'ne':function(queryObj) {return queryObj.notEquals;}, 'lt':function(queryObj) {return queryObj.less;}, 'le':function(queryObj) {return queryObj.lessOrEquals;}, 'gt':function(queryObj) {return queryObj.greater;}, 'ge':function(queryObj) {return queryObj.greaterOrEquals;}, 'cn':function(queryObj) {return queryObj.contains;}, 'nc':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().contains : queryObj.andNot().contains;}, 'bw':function(queryObj) {return queryObj.startsWith;}, 'bn':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().startsWith : queryObj.andNot().startsWith;}, 'en':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().endsWith : queryObj.andNot().endsWith;}, 'ew':function(queryObj) {return queryObj.endsWith;}, 'ni':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().equals : queryObj.andNot().equals;}, 'in':function(queryObj) {return queryObj.equals;}, 'nu':function(queryObj) {return queryObj.isNull;}, 'nn':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().isNull : queryObj.andNot().isNull;} }, query = $.jgrid.from(ts.p.data); if (ts.p.ignoreCase) { query = query.ignoreCase(); } function tojLinq ( group ) { var s = 0, index, gor, ror, opr, rule; if (group.groups !== undefined) { gor = group.groups.length &amp;&amp; group.groupOp.toString().toUpperCase() === &quot;OR&quot;; if (gor) { query.orBegin(); } for (index = 0; index &lt; group.groups.length; index++) { if (s &gt; 0 &amp;&amp; gor) { query.or(); } try { tojLinq(group.groups[index]); } catch (e) {alert(e);} s++; } if (gor) { query.orEnd(); } } if (group.rules !== undefined) { if(s&gt;0) { var result = query.select(); query = $.jgrid.from( result); if (ts.p.ignoreCase) { query = query.ignoreCase(); } } try{ ror = group.rules.length &amp;&amp; group.groupOp.toString().toUpperCase() === &quot;OR&quot;; if (ror) { query.orBegin(); } for (index = 0; index &lt; group.rules.length; index++) { rule = group.rules[index]; opr = group.groupOp.toString().toUpperCase(); if (compareFnMap[rule.op] &amp;&amp; rule.field ) { if(s &gt; 0 &amp;&amp; opr &amp;&amp; opr === &quot;OR&quot;) { query = query.or(); } query = compareFnMap[rule.op](query, opr)(rule.field, rule.data, cmtypes[rule.field]); } s++; } if (ror) { query.orEnd(); } } catch (g) {alert(g);} } } if (ts.p.search === true) { var srules = ts.p.postData.filters; if(srules) { if(typeof srules == &quot;string&quot;) { srules = $.jgrid.parse(srules);} tojLinq( srules ); } else { try { query = compareFnMap[ts.p.postData.searchOper](query)(ts.p.postData.searchField, ts.p.postData.searchString,cmtypes[ts.p.postData.searchField]); } catch (se){} } } if(ts.p.grouping) { for(gin=0; gin&lt;lengrp;gin++) { query.orderBy(grindexes[gin],grpview.groupOrder[gin],grtypes[gin].stype, grtypes[gin].srcfmt); } } if (st &amp;&amp; ts.p.sortorder &amp;&amp; fndsort) { if(ts.p.sortorder.toUpperCase() == &quot;DESC&quot;) { query.orderBy(ts.p.sortname, &quot;d&quot;, cmtypes[st].stype, cmtypes[st].srcfmt); } else { query.orderBy(ts.p.sortname, &quot;a&quot;, cmtypes[st].stype, cmtypes[st].srcfmt); } } var queryResults = query.select(), recordsperpage = parseInt(ts.p.rowNum,10), total = queryResults.length, page = parseInt(ts.p.page,10), totalpages = Math.ceil(total / recordsperpage), retresult = {}; queryResults = queryResults.slice( (page-1)*recordsperpage , page*recordsperpage ); query = null; cmtypes = null; retresult[ts.p.localReader.total] = totalpages; retresult[ts.p.localReader.page] = page; retresult[ts.p.localReader.records] = total; retresult[ts.p.localReader.root] = queryResults; retresult[ts.p.localReader.userdata] = ts.p.userData; queryResults = null; return retresult; }, updatepager = function(rn, dnd) { var cp, last, base, from,to,tot,fmt, pgboxes = &quot;&quot;, sppg, tspg = ts.p.pager ? &quot;_&quot;+$.jgrid.jqID(ts.p.pager.substr(1)) : &quot;&quot;, tspg_t = ts.p.toppager ? &quot;_&quot;+ts.p.toppager.substr(1) : &quot;&quot;; base = parseInt(ts.p.page,10)-1; if(base &lt; 0) { base = 0; } base = base*parseInt(ts.p.rowNum,10); to = base + ts.p.reccount; if (ts.p.scroll) { var rows = $(&quot;tbody:first &gt; tr:gt(0)&quot;, ts.grid.bDiv); base = to - rows.length; ts.p.reccount = rows.length; var rh = rows.outerHeight() || ts.grid.prevRowHeight; if (rh) { var top = base * rh; var height = parseInt(ts.p.records,10) * rh; $(&quot;&gt;div:first&quot;,ts.grid.bDiv).css({height : height}).children(&quot;div:first&quot;).css({height:top,display:top?&quot;&quot;:&quot;none&quot;}); } ts.grid.bDiv.scrollLeft = ts.grid.hDiv.scrollLeft; } pgboxes = ts.p.pager ? ts.p.pager : &quot;&quot;; pgboxes += ts.p.toppager ? (pgboxes ? &quot;,&quot; + ts.p.toppager : ts.p.toppager) : &quot;&quot;; if(pgboxes) { fmt = $.jgrid.formatter.integer || {}; cp = intNum(ts.p.page); last = intNum(ts.p.lastpage); $(&quot;.selbox&quot;,pgboxes)[ this.p.useProp ? 'prop' : 'attr' ](&quot;disabled&quot;,false); if(ts.p.pginput===true) { $('.ui-pg-input',pgboxes).val(ts.p.page); sppg = ts.p.toppager ? '#sp_1'+tspg+&quot;,#sp_1&quot;+tspg_t : '#sp_1'+tspg; $(sppg).html($.fmatter ? $.fmatter.util.NumberFormat(ts.p.lastpage,fmt):ts.p.lastpage); } if (ts.p.viewrecords){ if(ts.p.reccount === 0) { $(&quot;.ui-paging-info&quot;,pgboxes).html(ts.p.emptyrecords); } else { from = base+1; tot=ts.p.records; if($.fmatter) { from = $.fmatter.util.NumberFormat(from,fmt); to = $.fmatter.util.NumberFormat(to,fmt); tot = $.fmatter.util.NumberFormat(tot,fmt); } $(&quot;.ui-paging-info&quot;,pgboxes).html($.jgrid.format(ts.p.recordtext,from,to,tot)); } } if(ts.p.pgbuttons===true) { if(cp&lt;=0) {cp = last = 0;} if(cp==1 || cp === 0) { $(&quot;#first&quot;+tspg+&quot;, #prev&quot;+tspg).addClass('ui-state-disabled').removeClass('ui-state-hover'); if(ts.p.toppager) { $(&quot;#first_t&quot;+tspg_t+&quot;, #prev_t&quot;+tspg_t).addClass('ui-state-disabled').removeClass('ui-state-hover'); } } else { $(&quot;#first&quot;+tspg+&quot;, #prev&quot;+tspg).removeClass('ui-state-disabled'); if(ts.p.toppager) { $(&quot;#first_t&quot;+tspg_t+&quot;, #prev_t&quot;+tspg_t).removeClass('ui-state-disabled'); } } if(cp==last || cp === 0) { $(&quot;#next&quot;+tspg+&quot;, #last&quot;+tspg).addClass('ui-state-disabled').removeClass('ui-state-hover'); if(ts.p.toppager) { $(&quot;#next_t&quot;+tspg_t+&quot;, #last_t&quot;+tspg_t).addClass('ui-state-disabled').removeClass('ui-state-hover'); } } else { $(&quot;#next&quot;+tspg+&quot;, #last&quot;+tspg).removeClass('ui-state-disabled'); if(ts.p.toppager) { $(&quot;#next_t&quot;+tspg_t+&quot;, #last_t&quot;+tspg_t).removeClass('ui-state-disabled'); } } } } if(rn===true &amp;&amp; ts.p.rownumbers === true) { $(&quot;td.jqgrid-rownum&quot;,ts.rows).each(function(i){ $(this).html(base+1+i); }); } if(dnd &amp;&amp; ts.p.jqgdnd) { $(ts).jqGrid('gridDnD','updateDnD');} $(ts).triggerHandler(&quot;jqGridGridComplete&quot;); if($.isFunction(ts.p.gridComplete)) {ts.p.gridComplete.call(ts);} $(ts).triggerHandler(&quot;jqGridAfterGridComplete&quot;); }, beginReq = function() { ts.grid.hDiv.loading = true; if(ts.p.hiddengrid) { return;} switch(ts.p.loadui) { case &quot;disable&quot;: break; case &quot;enable&quot;: $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show(); break; case &quot;block&quot;: $(&quot;#lui_&quot;+$.jgrid.jqID(ts.p.id)).show(); $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show(); break; } }, endReq = function() { ts.grid.hDiv.loading = false; switch(ts.p.loadui) { case &quot;disable&quot;: break; case &quot;enable&quot;: $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); break; case &quot;block&quot;: $(&quot;#lui_&quot;+$.jgrid.jqID(ts.p.id)).hide(); $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); break; } }, populate = function (npage) { if(!ts.grid.hDiv.loading) { var pvis = ts.p.scroll &amp;&amp; npage === false, prm = {}, dt, dstr, pN=ts.p.prmNames; if(ts.p.page &lt;=0) { ts.p.page = 1; } if(pN.search !== null) {prm[pN.search] = ts.p.search;} if(pN.nd !== null) {prm[pN.nd] = new Date().getTime();} if(pN.rows !== null) {prm[pN.rows]= ts.p.rowNum;} if(pN.page !== null) {prm[pN.page]= ts.p.page;} if(pN.sort !== null) {prm[pN.sort]= ts.p.sortname;} if(pN.order !== null) {prm[pN.order]= ts.p.sortorder;} if(ts.p.rowTotal !== null &amp;&amp; pN.totalrows !== null) { prm[pN.totalrows]= ts.p.rowTotal; } var lcf = $.isFunction(ts.p.loadComplete), lc = lcf ? ts.p.loadComplete : null; var adjust = 0; npage = npage || 1; if (npage &gt; 1) { if(pN.npage !== null) { prm[pN.npage] = npage; adjust = npage - 1; npage = 1; } else { lc = function(req) { ts.p.page++; ts.grid.hDiv.loading = false; if (lcf) { ts.p.loadComplete.call(ts,req); } populate(npage-1); }; } } else if (pN.npage !== null) { delete ts.p.postData[pN.npage]; } if(ts.p.grouping) { $(ts).jqGrid('groupingSetup'); var grp = ts.p.groupingView, gi, gs=&quot;&quot;; for(gi=0;gi&lt;grp.groupField.length;gi++) { var index = grp.groupField[gi]; $.each(ts.p.colModel, function(cmIndex, cmValue) { if (cmValue.name == index &amp;&amp; cmValue.index){ index = cmValue.index; } } ); gs += index +&quot; &quot;+grp.groupOrder[gi]+&quot;, &quot;; } prm[pN.sort] = gs + prm[pN.sort]; } $.extend(ts.p.postData,prm); var rcnt = !ts.p.scroll ? 1 : ts.rows.length-1; var bfr = $(ts).triggerHandler(&quot;jqGridBeforeRequest&quot;); if (bfr === false || bfr === 'stop') { return; } if ($.isFunction(ts.p.datatype)) { ts.p.datatype.call(ts,ts.p.postData,&quot;load_&quot;+ts.p.id); return;} else if($.isFunction(ts.p.beforeRequest)) { bfr = ts.p.beforeRequest.call(ts); if(bfr === undefined) { bfr = true; } if ( bfr === false ) { return; } } dt = ts.p.datatype.toLowerCase(); switch(dt) { case &quot;json&quot;: case &quot;jsonp&quot;: case &quot;xml&quot;: case &quot;script&quot;: $.ajax($.extend({ url:ts.p.url, type:ts.p.mtype, dataType: dt , data: $.isFunction(ts.p.serializeGridData)? ts.p.serializeGridData.call(ts,ts.p.postData) : ts.p.postData, success:function(data,st, xhr) { if ($.isFunction(ts.p.beforeProcessing)) { if (ts.p.beforeProcessing.call(ts, data, st, xhr) === false) { endReq(); return; } } if(dt === &quot;xml&quot;) { addXmlData(data,ts.grid.bDiv,rcnt,npage&gt;1,adjust); } else { addJSONData(data,ts.grid.bDiv,rcnt,npage&gt;1,adjust); } $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [data]); if(lc) { lc.call(ts,data); } $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [data]); if (pvis) { ts.grid.populateVisible(); } if( ts.p.loadonce || ts.p.treeGrid) {ts.p.datatype = &quot;local&quot;;} data=null; if (npage === 1) { endReq(); } }, error:function(xhr,st,err){ if($.isFunction(ts.p.loadError)) { ts.p.loadError.call(ts,xhr,st,err); } if (npage === 1) { endReq(); } xhr=null; }, beforeSend: function(xhr, settings ){ var gotoreq = true; if($.isFunction(ts.p.loadBeforeSend)) { gotoreq = ts.p.loadBeforeSend.call(ts,xhr, settings); } if(gotoreq === undefined) { gotoreq = true; } if(gotoreq === false) { return false; } else { beginReq(); } } },$.jgrid.ajaxOptions, ts.p.ajaxGridOptions)); break; case &quot;xmlstring&quot;: beginReq(); dstr = $.jgrid.stringToDoc(ts.p.datastr); addXmlData(dstr,ts.grid.bDiv); $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [dstr]); if(lcf) {ts.p.loadComplete.call(ts,dstr);} $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [dstr]); ts.p.datatype = &quot;local&quot;; ts.p.datastr = null; endReq(); break; case &quot;jsonstring&quot;: beginReq(); if(typeof ts.p.datastr == 'string') { dstr = $.jgrid.parse(ts.p.datastr); } else { dstr = ts.p.datastr; } addJSONData(dstr,ts.grid.bDiv); $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [dstr]); if(lcf) {ts.p.loadComplete.call(ts,dstr);} $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [dstr]); ts.p.datatype = &quot;local&quot;; ts.p.datastr = null; endReq(); break; case &quot;local&quot;: case &quot;clientside&quot;: beginReq(); ts.p.datatype = &quot;local&quot;; var req = addLocalData(); addJSONData(req,ts.grid.bDiv,rcnt,npage&gt;1,adjust); $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [req]); if(lc) { lc.call(ts,req); } $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [req]); if (pvis) { ts.grid.populateVisible(); } endReq(); break; } } }, setHeadCheckBox = function ( checked ) { $('#cb_'+$.jgrid.jqID(ts.p.id),ts.grid.hDiv)[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, checked); var fid = ts.p.frozenColumns ? ts.p.id+&quot;_frozen&quot; : &quot;&quot;; if(fid) { $('#cb_'+$.jgrid.jqID(ts.p.id),ts.grid.fhDiv)[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, checked); } }, setPager = function (pgid, tp){ // TBD - consider escaping pgid with pgid = $.jgrid.jqID(pgid); var sep = &quot;&lt;td class='ui-pg-button ui-state-disabled' style='width:4px;'&gt;&lt;span class='ui-separator'&gt;&lt;/span&gt;&lt;/td&gt;&quot;, pginp = &quot;&quot;, pgl=&quot;&lt;table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'&gt;&lt;tbody&gt;&lt;tr&gt;&quot;, str=&quot;&quot;, pgcnt, lft, cent, rgt, twd, tdw, i, clearVals = function(onpaging){ var ret; if ($.isFunction(ts.p.onPaging) ) { ret = ts.p.onPaging.call(ts,onpaging); } ts.p.selrow = null; if(ts.p.multiselect) {ts.p.selarrrow =[]; setHeadCheckBox( false );} ts.p.savedRow = []; if(ret=='stop') {return false;} return true; }; pgid = pgid.substr(1); tp += &quot;_&quot; + pgid; pgcnt = &quot;pg_&quot;+pgid; lft = pgid+&quot;_left&quot;; cent = pgid+&quot;_center&quot;; rgt = pgid+&quot;_right&quot;; $(&quot;#&quot;+$.jgrid.jqID(pgid) ) .append(&quot;&lt;div id='&quot;+pgcnt+&quot;' class='ui-pager-control' role='group'&gt;&lt;table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;height:100%;' role='row'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td id='&quot;+lft+&quot;' align='left'&gt;&lt;/td&gt;&lt;td id='&quot;+cent+&quot;' align='center' style='white-space:pre;'&gt;&lt;/td&gt;&lt;td id='&quot;+rgt+&quot;' align='right'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;) .attr(&quot;dir&quot;,&quot;ltr&quot;); //explicit setting if(ts.p.rowList.length &gt;0){ str = &quot;&lt;td dir='&quot;+dir+&quot;'&gt;&quot;; str +=&quot;&lt;select class='ui-pg-selbox' role='listbox'&gt;&quot;; for(i=0;i&lt;ts.p.rowList.length;i++){ str +=&quot;&lt;option role=\\&quot;option\\&quot; value=\\&quot;&quot;+ts.p.rowList[i]+&quot;\\&quot;&quot;+((ts.p.rowNum == ts.p.rowList[i])?&quot; selected=\\&quot;selected\\&quot;&quot;:&quot;&quot;)+&quot;&gt;&quot;+ts.p.rowList[i]+&quot;&lt;/option&gt;&quot;; } str +=&quot;&lt;/select&gt;&lt;/td&gt;&quot;; } if(dir==&quot;rtl&quot;) { pgl += str; } if(ts.p.pginput===true) { pginp= &quot;&lt;td dir='&quot;+dir+&quot;'&gt;&quot;+$.jgrid.format(ts.p.pgtext || &quot;&quot;,&quot;&lt;input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/&gt;&quot;,&quot;&lt;span id='sp_1_&quot;+$.jgrid.jqID(pgid)+&quot;'&gt;&lt;/span&gt;&quot;)+&quot;&lt;/td&gt;&quot;;} if(ts.p.pgbuttons===true) { var po=[&quot;first&quot;+tp,&quot;prev&quot;+tp, &quot;next&quot;+tp,&quot;last&quot;+tp]; if(dir==&quot;rtl&quot;) { po.reverse(); } pgl += &quot;&lt;td id='&quot;+po[0]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-first'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; pgl += &quot;&lt;td id='&quot;+po[1]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-prev'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; pgl += pginp !== &quot;&quot; ? sep+pginp+sep:&quot;&quot;; pgl += &quot;&lt;td id='&quot;+po[2]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-next'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; pgl += &quot;&lt;td id='&quot;+po[3]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-end'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; } else if (pginp !== &quot;&quot;) { pgl += pginp; } if(dir==&quot;ltr&quot;) { pgl += str; } pgl += &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; if(ts.p.viewrecords===true) {$(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.recordpos,&quot;#&quot;+pgcnt).append(&quot;&lt;div dir='&quot;+dir+&quot;' style='text-align:&quot;+ts.p.recordpos+&quot;' class='ui-paging-info'&gt;&lt;/div&gt;&quot;);} $(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.pagerpos,&quot;#&quot;+pgcnt).append(pgl); tdw = $(&quot;.ui-jqgrid&quot;).css(&quot;font-size&quot;) || &quot;11px&quot;; $(document.body).append(&quot;&lt;div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:&quot;+tdw+&quot;;visibility:hidden;' &gt;&lt;/div&gt;&quot;); twd = $(pgl).clone().appendTo(&quot;#testpg&quot;).width(); $(&quot;#testpg&quot;).remove(); if(twd &gt; 0) { if(pginp !== &quot;&quot;) { twd += 50; } //should be param $(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.pagerpos,&quot;#&quot;+pgcnt).width(twd); } ts.p._nvtd = []; ts.p._nvtd[0] = twd ? Math.floor((ts.p.width - twd)/2) : Math.floor(ts.p.width/3); ts.p._nvtd[1] = 0; pgl=null; $('.ui-pg-selbox',&quot;#&quot;+pgcnt).bind('change',function() { ts.p.page = Math.round(ts.p.rowNum*(ts.p.page-1)/this.value-0.5)+1; ts.p.rowNum = this.value; if(ts.p.pager) { $('.ui-pg-selbox',ts.p.pager).val(this.value); } if(ts.p.toppager) { $('.ui-pg-selbox',ts.p.toppager).val(this.value); } if(!clearVals('records')) { return false; } populate(); return false; }); if(ts.p.pgbuttons===true) { $(&quot;.ui-pg-button&quot;,&quot;#&quot;+pgcnt).hover(function(){ if($(this).hasClass('ui-state-disabled')) { this.style.cursor='default'; } else { $(this).addClass('ui-state-hover'); this.style.cursor='pointer'; } },function() { if(!$(this).hasClass('ui-state-disabled')) { $(this).removeClass('ui-state-hover'); this.style.cursor= &quot;default&quot;; } }); $(&quot;#first&quot;+$.jgrid.jqID(tp)+&quot;, #prev&quot;+$.jgrid.jqID(tp)+&quot;, #next&quot;+$.jgrid.jqID(tp)+&quot;, #last&quot;+$.jgrid.jqID(tp)).click( function() { var cp = intNum(ts.p.page,1), last = intNum(ts.p.lastpage,1), selclick = false, fp=true, pp=true, np=true,lp=true; if(last ===0 || last===1) {fp=false;pp=false;np=false;lp=false; } else if( last&gt;1 &amp;&amp; cp &gt;=1) { if( cp === 1) { fp=false; pp=false; } //else if( cp&gt;1 &amp;&amp; cp &lt;last){ } else if( cp===last){ np=false;lp=false; } } else if( last&gt;1 &amp;&amp; cp===0 ) { np=false;lp=false; cp=last-1;} if( this.id === 'first'+tp &amp;&amp; fp ) { ts.p.page=1; selclick=true;} if( this.id === 'prev'+tp &amp;&amp; pp) { ts.p.page=(cp-1); selclick=true;} if( this.id === 'next'+tp &amp;&amp; np) { ts.p.page=(cp+1); selclick=true;} if( this.id === 'last'+tp &amp;&amp; lp) { ts.p.page=last; selclick=true;} if(selclick) { if(!clearVals(this.id)) { return false; } populate(); } return false; }); } if(ts.p.pginput===true) { $('input.ui-pg-input',&quot;#&quot;+pgcnt).keypress( function(e) { var key = e.charCode ? e.charCode : e.keyCode ? e.keyCode : 0; if(key == 13) { ts.p.page = ($(this).val()&gt;0) ? $(this).val():ts.p.page; if(!clearVals('user')) { return false; } populate(); return false; } return this; }); } }, sortData = function (index, idxcol,reload,sor){ if(!ts.p.colModel[idxcol].sortable) { return; } var so; if(ts.p.savedRow.length &gt; 0) {return;} if(!reload) { if( ts.p.lastsort == idxcol ) { if( ts.p.sortorder == 'asc') { ts.p.sortorder = 'desc'; } else if(ts.p.sortorder == 'desc') { ts.p.sortorder = 'asc';} } else { ts.p.sortorder = ts.p.colModel[idxcol].firstsortorder || 'asc'; } ts.p.page = 1; } if(sor) { if(ts.p.lastsort == idxcol &amp;&amp; ts.p.sortorder == sor &amp;&amp; !reload) { return; } else { ts.p.sortorder = sor; } } var previousSelectedTh = ts.grid.headers[ts.p.lastsort].el, newSelectedTh = ts.grid.headers[idxcol].el; $(&quot;span.ui-grid-ico-sort&quot;,previousSelectedTh).addClass('ui-state-disabled'); $(previousSelectedTh).attr(&quot;aria-selected&quot;,&quot;false&quot;); $(&quot;span.ui-icon-&quot;+ts.p.sortorder,newSelectedTh).removeClass('ui-state-disabled'); $(newSelectedTh).attr(&quot;aria-selected&quot;,&quot;true&quot;); if(!ts.p.viewsortcols[0]) { if(ts.p.lastsort != idxcol) { $(&quot;span.s-ico&quot;,previousSelectedTh).hide(); $(&quot;span.s-ico&quot;,newSelectedTh).show(); } } index = index.substring(5 + ts.p.id.length + 1); // bad to be changed!?! ts.p.sortname = ts.p.colModel[idxcol].index || index; so = ts.p.sortorder; if ($(ts).triggerHandler(&quot;jqGridSortCol&quot;, [index, idxcol, so]) === 'stop') { ts.p.lastsort = idxcol; return; } if($.isFunction(ts.p.onSortCol)) {if (ts.p.onSortCol.call(ts,index,idxcol,so)=='stop') {ts.p.lastsort = idxcol; return;}} if(ts.p.datatype == &quot;local&quot;) { if(ts.p.deselectAfterSort) {$(ts).jqGrid(&quot;resetSelection&quot;);} } else { ts.p.selrow = null; if(ts.p.multiselect){setHeadCheckBox( false );} ts.p.selarrrow =[]; ts.p.savedRow =[]; } if(ts.p.scroll) { var sscroll = ts.grid.bDiv.scrollLeft; emptyRows.call(ts, true, false); ts.grid.hDiv.scrollLeft = sscroll; } if(ts.p.subGrid &amp;&amp; ts.p.datatype=='local') { $(&quot;td.sgexpanded&quot;,&quot;#&quot;+$.jgrid.jqID(ts.p.id)).each(function(){ $(this).trigger(&quot;click&quot;); }); } populate(); ts.p.lastsort = idxcol; if(ts.p.sortname != index &amp;&amp; idxcol) {ts.p.lastsort = idxcol;} }, setColWidth = function () { var initwidth = 0, brd=$.jgrid.cellWidth()? 0: intNum(ts.p.cellLayout,0), vc=0, lvc, scw=intNum(ts.p.scrollOffset,0),cw,hs=false,aw,gw=0, cl = 0, cr; $.each(ts.p.colModel, function() { if(typeof this.hidden === 'undefined') {this.hidden=false;} this.widthOrg = cw = intNum(this.width,0); if(this.hidden===false){ initwidth += cw+brd; if(this.fixed) { gw += cw+brd; } else { vc++; } cl++; } }); if(isNaN(ts.p.width)) { ts.p.width = initwidth + ((ts.p.shrinkToFit ===false &amp;&amp; !isNaN(ts.p.height)) ? scw : 0); } grid.width = ts.p.width; ts.p.tblwidth = initwidth; if(ts.p.shrinkToFit ===false &amp;&amp; ts.p.forceFit === true) {ts.p.forceFit=false;} if(ts.p.shrinkToFit===true &amp;&amp; vc &gt; 0) { aw = grid.width-brd*vc-gw; if(!isNaN(ts.p.height)) { aw -= scw; hs = true; } initwidth =0; $.each(ts.p.colModel, function(i) { if(this.hidden === false &amp;&amp; !this.fixed){ cw = Math.round(aw*this.width/(ts.p.tblwidth-brd*vc-gw)); this.width =cw; initwidth += cw; lvc = i; } }); cr =0; if (hs) { if(grid.width-gw-(initwidth+brd*vc) !== scw){ cr = grid.width-gw-(initwidth+brd*vc)-scw; } } else if(!hs &amp;&amp; Math.abs(grid.width-gw-(initwidth+brd*vc)) !== 1) { cr = grid.width-gw-(initwidth+brd*vc); } ts.p.colModel[lvc].width += cr; ts.p.tblwidth = initwidth+cr+brd*vc+gw; if(ts.p.tblwidth &gt; ts.p.width) { ts.p.colModel[lvc].width -= (ts.p.tblwidth - parseInt(ts.p.width,10)); ts.p.tblwidth = ts.p.width; } } }, nextVisible= function(iCol) { var ret = iCol, j=iCol, i; for (i = iCol+1;i&lt;ts.p.colModel.length;i++){ if(ts.p.colModel[i].hidden !== true ) { j=i; break; } } return j-ret; }, getOffset = function (iCol) { var i, ret = {}, brd1 = $.jgrid.cellWidth() ? 0 : ts.p.cellLayout; ret[0] = ret[1] = ret[2] = 0; for(i=0;i&lt;=iCol;i++){ if(ts.p.colModel[i].hidden === false ) { ret[0] += ts.p.colModel[i].width+brd1; } } if(ts.p.direction==&quot;rtl&quot;) { ret[0] = ts.p.width - ret[0]; } ret[0] = ret[0] - ts.grid.bDiv.scrollLeft; if($(ts.grid.cDiv).is(&quot;:visible&quot;)) {ret[1] += $(ts.grid.cDiv).height() +parseInt($(ts.grid.cDiv).css(&quot;padding-top&quot;),10)+parseInt($(ts.grid.cDiv).css(&quot;padding-bottom&quot;),10);} if(ts.p.toolbar[0]===true &amp;&amp; (ts.p.toolbar[1]=='top' || ts.p.toolbar[1]=='both')) {ret[1] += $(ts.grid.uDiv).height()+parseInt($(ts.grid.uDiv).css(&quot;border-top-width&quot;),10)+parseInt($(ts.grid.uDiv).css(&quot;border-bottom-width&quot;),10);} if(ts.p.toppager) {ret[1] += $(ts.grid.topDiv).height()+parseInt($(ts.grid.topDiv).css(&quot;border-bottom-width&quot;),10);} ret[2] += $(ts.grid.bDiv).height() + $(ts.grid.hDiv).height(); return ret; }, getColumnHeaderIndex = function (th) { var i, headers = ts.grid.headers, ci = $.jgrid.getCellIndex(th); for (i = 0; i &lt; headers.length; i++) { if (th === headers[i].el) { ci = i; break; } } return ci; }; this.p.id = this.id; if ($.inArray(ts.p.multikey,sortkeys) == -1 ) {ts.p.multikey = false;} ts.p.keyIndex=false; for (i=0; i&lt;ts.p.colModel.length;i++) { ts.p.colModel[i] = $.extend(true, {}, ts.p.cmTemplate, ts.p.colModel[i].template || {}, ts.p.colModel[i]); if (ts.p.keyIndex === false &amp;&amp; ts.p.colModel[i].key===true) { ts.p.keyIndex = i; } } ts.p.sortorder = ts.p.sortorder.toLowerCase(); if(ts.p.grouping===true) { ts.p.scroll = false; ts.p.rownumbers = false; //ts.p.subGrid = false; expiremental ts.p.treeGrid = false; ts.p.gridview = true; } if(this.p.treeGrid === true) { try { $(this).jqGrid(&quot;setTreeGrid&quot;);} catch (_) {} if(ts.p.datatype != &quot;local&quot;) { ts.p.localReader = {id: &quot;_id_&quot;}; } } if(this.p.subGrid) { try { $(ts).jqGrid(&quot;setSubGrid&quot;);} catch (s){} } if(this.p.multiselect) { this.p.colNames.unshift(&quot;&lt;input role='checkbox' id='cb_&quot;+this.p.id+&quot;' class='cbox' type='checkbox'/&gt;&quot;); this.p.colModel.unshift({name:'cb',width:$.jgrid.cellWidth() ? ts.p.multiselectWidth+ts.p.cellLayout : ts.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:'center',fixed:true}); } if(this.p.rownumbers) { this.p.colNames.unshift(&quot;&quot;); this.p.colModel.unshift({name:'rn',width:ts.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:'center',fixed:true}); } ts.p.xmlReader = $.extend(true,{ root: &quot;rows&quot;, row: &quot;row&quot;, page: &quot;rows&gt;page&quot;, total: &quot;rows&gt;total&quot;, records : &quot;rows&gt;records&quot;, repeatitems: true, cell: &quot;cell&quot;, id: &quot;[id]&quot;, userdata: &quot;userdata&quot;, subgrid: {root:&quot;rows&quot;, row: &quot;row&quot;, repeatitems: true, cell:&quot;cell&quot;} }, ts.p.xmlReader); ts.p.jsonReader = $.extend(true,{ root: &quot;rows&quot;, page: &quot;page&quot;, total: &quot;total&quot;, records: &quot;records&quot;, repeatitems: true, cell: &quot;cell&quot;, id: &quot;id&quot;, userdata: &quot;userdata&quot;, subgrid: {root:&quot;rows&quot;, repeatitems: true, cell:&quot;cell&quot;} },ts.p.jsonReader); ts.p.localReader = $.extend(true,{ root: &quot;rows&quot;, page: &quot;page&quot;, total: &quot;total&quot;, records: &quot;records&quot;, repeatitems: false, cell: &quot;cell&quot;, id: &quot;id&quot;, userdata: &quot;userdata&quot;, subgrid: {root:&quot;rows&quot;, repeatitems: true, cell:&quot;cell&quot;} },ts.p.localReader); if(ts.p.scroll){ ts.p.pgbuttons = false; ts.p.pginput=false; ts.p.rowList=[]; } if(ts.p.data.length) { refreshIndex(); } var thead = &quot;&lt;thead&gt;&lt;tr class='ui-jqgrid-labels' role='rowheader'&gt;&quot;, tdc, idn, w, res, sort, td, ptr, tbody, imgs,iac=&quot;&quot;,idc=&quot;&quot;; if(ts.p.shrinkToFit===true &amp;&amp; ts.p.forceFit===true) { for (i=ts.p.colModel.length-1;i&gt;=0;i--){ if(!ts.p.colModel[i].hidden) { ts.p.colModel[i].resizable=false; break; } } } if(ts.p.viewsortcols[1] == 'horizontal') {iac=&quot; ui-i-asc&quot;;idc=&quot; ui-i-desc&quot;;} tdc = isMSIE ? &quot;class='ui-th-div-ie'&quot; :&quot;&quot;; imgs = &quot;&lt;span class='s-ico' style='display:none'&gt;&lt;span sort='asc' class='ui-grid-ico-sort ui-icon-asc&quot;+iac+&quot; ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-&quot;+dir+&quot;'&gt;&lt;/span&gt;&quot;; imgs += &quot;&lt;span sort='desc' class='ui-grid-ico-sort ui-icon-desc&quot;+idc+&quot; ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-&quot;+dir+&quot;'&gt;&lt;/span&gt;&lt;/span&gt;&quot;; for(i=0;i&lt;this.p.colNames.length;i++){ var tooltip = ts.p.headertitles ? (&quot; title=\\&quot;&quot;+$.jgrid.stripHtml(ts.p.colNames[i])+&quot;\\&quot;&quot;) :&quot;&quot;; thead += &quot;&lt;th id='&quot;+ts.p.id+&quot;_&quot;+ts.p.colModel[i].name+&quot;' role='columnheader' class='ui-state-default ui-th-column ui-th-&quot;+dir+&quot;'&quot;+ tooltip+&quot;&gt;&quot;; idn = ts.p.colModel[i].index || ts.p.colModel[i].name; thead += &quot;&lt;div id='jqgh_&quot;+ts.p.id+&quot;_&quot;+ts.p.colModel[i].name+&quot;' &quot;+tdc+&quot;&gt;&quot;+ts.p.colNames[i]; if(!ts.p.colModel[i].width) { ts.p.colModel[i].width = 150; } else { ts.p.colModel[i].width = parseInt(ts.p.colModel[i].width,10); } if(typeof(ts.p.colModel[i].title) !== &quot;boolean&quot;) { ts.p.colModel[i].title = true; } if (idn == ts.p.sortname) { ts.p.lastsort = i; } thead += imgs+&quot;&lt;/div&gt;&lt;/th&gt;&quot;; } thead += &quot;&lt;/tr&gt;&lt;/thead&gt;&quot;; imgs = null; $(this).append(thead); $(&quot;thead tr:first th&quot;,this).hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');}); if(this.p.multiselect) { var emp=[], chk; $('#cb_'+$.jgrid.jqID(ts.p.id),this).bind('click',function(){ ts.p.selarrrow = []; var froz = ts.p.frozenColumns === true ? ts.p.id + &quot;_frozen&quot; : &quot;&quot;; if (this.checked) { $(ts.rows).each(function(i) { if (i&gt;0) { if(!$(this).hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$(this).hasClass(&quot;jqgroup&quot;) &amp;&amp; !$(this).hasClass('ui-state-disabled')){ $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id) )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(this).addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;); ts.p.selarrrow.push(this.id); ts.p.selrow = this.id; if(froz) { $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv).addClass(&quot;ui-state-highlight&quot;); } } } }); chk=true; emp=[]; } else { $(ts.rows).each(function(i) { if(i&gt;0) { if(!$(this).hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$(this).hasClass('ui-state-disabled')){ $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id) )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $(this).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); emp.push(this.id); if(froz) { $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); $(&quot;#&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv).removeClass(&quot;ui-state-highlight&quot;); } } } }); ts.p.selrow = null; chk=false; } $(ts).triggerHandler(&quot;jqGridSelectAll&quot;, [chk ? ts.p.selarrrow : emp, chk]); if($.isFunction(ts.p.onSelectAll)) {ts.p.onSelectAll.call(ts, chk ? ts.p.selarrrow : emp,chk);} }); } if(ts.p.autowidth===true) { var pw = $(eg).innerWidth(); ts.p.width = pw &gt; 0? pw: 'nw'; } setColWidth(); $(eg).css(&quot;width&quot;,grid.width+&quot;px&quot;).append(&quot;&lt;div class='ui-jqgrid-resize-mark' id='rs_m&quot;+ts.p.id+&quot;'&gt;&amp;#160;&lt;/div&gt;&quot;); $(gv).css(&quot;width&quot;,grid.width+&quot;px&quot;); thead = $(&quot;thead:first&quot;,ts).get(0); var tfoot = &quot;&quot;; if(ts.p.footerrow) { tfoot += &quot;&lt;table role='grid' style='width:&quot;+ts.p.tblwidth+&quot;px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;tr role='row' class='ui-widget-content footrow footrow-&quot;+dir+&quot;'&gt;&quot;; } var thr = $(&quot;tr:first&quot;,thead), firstr = &quot;&lt;tr class='jqgfirstrow' role='row' style='height:auto'&gt;&quot;; ts.p.disableClick=false; $(&quot;th&quot;,thr).each(function ( j ) { w = ts.p.colModel[j].width; if(typeof ts.p.colModel[j].resizable === 'undefined') {ts.p.colModel[j].resizable = true;} if(ts.p.colModel[j].resizable){ res = document.createElement(&quot;span&quot;); $(res).html(&quot;&amp;#160;&quot;).addClass('ui-jqgrid-resize ui-jqgrid-resize-'+dir); if(!$.browser.opera) { $(res).css(&quot;cursor&quot;,&quot;col-resize&quot;); } $(this).addClass(ts.p.resizeclass); } else { res = &quot;&quot;; } $(this).css(&quot;width&quot;,w+&quot;px&quot;).prepend(res); var hdcol = &quot;&quot;; if( ts.p.colModel[j].hidden ) { $(this).css(&quot;display&quot;,&quot;none&quot;); hdcol = &quot;display:none;&quot;; } firstr += &quot;&lt;td role='gridcell' style='height:0px;width:&quot;+w+&quot;px;&quot;+hdcol+&quot;'&gt;&lt;/td&gt;&quot;; grid.headers[j] = { width: w, el: this }; sort = ts.p.colModel[j].sortable; if( typeof sort !== 'boolean') {ts.p.colModel[j].sortable = true; sort=true;} var nm = ts.p.colModel[j].name; if( !(nm == 'cb' || nm=='subgrid' || nm=='rn') ) { if(ts.p.viewsortcols[2]){ $(&quot;&gt;div&quot;,this).addClass('ui-jqgrid-sortable'); } } if(sort) { if(ts.p.viewsortcols[0]) {$(&quot;div span.s-ico&quot;,this).show(); if(j==ts.p.lastsort){ $(&quot;div span.ui-icon-&quot;+ts.p.sortorder,this).removeClass(&quot;ui-state-disabled&quot;);}} else if( j == ts.p.lastsort) {$(&quot;div span.s-ico&quot;,this).show();$(&quot;div span.ui-icon-&quot;+ts.p.sortorder,this).removeClass(&quot;ui-state-disabled&quot;);} } if(ts.p.footerrow) { tfoot += &quot;&lt;td role='gridcell' &quot;+formatCol(j,0,'', null, '', false)+&quot;&gt;&amp;#160;&lt;/td&gt;&quot;; } }).mousedown(function(e) { if ($(e.target).closest(&quot;th&gt;span.ui-jqgrid-resize&quot;).length != 1) { return; } var ci = getColumnHeaderIndex(this); if(ts.p.forceFit===true) {ts.p.nv= nextVisible(ci);} grid.dragStart(ci, e, getOffset(ci)); return false; }).click(function(e) { if (ts.p.disableClick) { ts.p.disableClick = false; return false; } var s = &quot;th&gt;div.ui-jqgrid-sortable&quot;,r,d; if (!ts.p.viewsortcols[2]) { s = &quot;th&gt;div&gt;span&gt;span.ui-grid-ico-sort&quot;; } var t = $(e.target).closest(s); if (t.length != 1) { return; } var ci = getColumnHeaderIndex(this); if (!ts.p.viewsortcols[2]) { r=true;d=t.attr(&quot;sort&quot;); } sortData( $('div',this)[0].id, ci, r, d); return false; }); if (ts.p.sortable &amp;&amp; $.fn.sortable) { try { $(ts).jqGrid(&quot;sortableColumns&quot;, thr); } catch (e){} } if(ts.p.footerrow) { tfoot += &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; } firstr += &quot;&lt;/tr&gt;&quot;; tbody = document.createElement(&quot;tbody&quot;); this.appendChild(tbody); $(this).addClass('ui-jqgrid-btable').append(firstr); firstr = null; var hTable = $(&quot;&lt;table class='ui-jqgrid-htable' style='width:&quot;+ts.p.tblwidth+&quot;px' role='grid' aria-labelledby='gbox_&quot;+this.id+&quot;' cellspacing='0' cellpadding='0' border='0'&gt;&lt;/table&gt;&quot;).append(thead), hg = (ts.p.caption &amp;&amp; ts.p.hiddengrid===true) ? true : false, hb = $(&quot;&lt;div class='ui-jqgrid-hbox&quot; + (dir==&quot;rtl&quot; ? &quot;-rtl&quot; : &quot;&quot; )+&quot;'&gt;&lt;/div&gt;&quot;); thead = null; grid.hDiv = document.createElement(&quot;div&quot;); $(grid.hDiv) .css({ width: grid.width+&quot;px&quot;}) .addClass(&quot;ui-state-default ui-jqgrid-hdiv&quot;) .append(hb); $(hb).append(hTable); hTable = null; if(hg) { $(grid.hDiv).hide(); } if(ts.p.pager){ // TBD -- escape ts.p.pager here? if(typeof ts.p.pager == &quot;string&quot;) {if(ts.p.pager.substr(0,1) !=&quot;#&quot;) { ts.p.pager = &quot;#&quot;+ts.p.pager;} } else { ts.p.pager = &quot;#&quot;+ $(ts.p.pager).attr(&quot;id&quot;);} $(ts.p.pager).css({width: grid.width+&quot;px&quot;}).appendTo(eg).addClass('ui-state-default ui-jqgrid-pager ui-corner-bottom'); if(hg) {$(ts.p.pager).hide();} setPager(ts.p.pager,''); } if( ts.p.cellEdit === false &amp;&amp; ts.p.hoverrows === true) { $(ts).bind('mouseover',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); if($(ptr).attr(&quot;class&quot;) !== &quot;ui-subgrid&quot;) { $(ptr).addClass(&quot;ui-state-hover&quot;); } }).bind('mouseout',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); $(ptr).removeClass(&quot;ui-state-hover&quot;); }); } var ri,ci, tdHtml; $(ts).before(grid.hDiv).click(function(e) { td = e.target; ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;); if($(ptr).length === 0 || ptr[0].className.indexOf( 'ui-state-disabled' ) &gt; -1 || ($(td,ts).closest(&quot;table.ui-jqgrid-btable&quot;).attr('id') || '').replace(&quot;_frozen&quot;,&quot;&quot;) !== ts.id ) { return this; } var scb = $(td).hasClass(&quot;cbox&quot;), cSel = $(ts).triggerHandler(&quot;jqGridBeforeSelectRow&quot;, [ptr[0].id, e]); cSel = (cSel === false || cSel === 'stop') ? false : true; if(cSel &amp;&amp; $.isFunction(ts.p.beforeSelectRow)) { cSel = ts.p.beforeSelectRow.call(ts,ptr[0].id, e); } if (td.tagName == 'A' || ((td.tagName == 'INPUT' || td.tagName == 'TEXTAREA' || td.tagName == 'OPTION' || td.tagName == 'SELECT' ) &amp;&amp; !scb) ) { return; } if(cSel === true) { ri = ptr[0].id; ci = $.jgrid.getCellIndex(td); tdHtml = $(td).closest(&quot;td,th&quot;).html(); $(ts).triggerHandler(&quot;jqGridCellSelect&quot;, [ri,ci,tdHtml,e]); if($.isFunction(ts.p.onCellSelect)) { ts.p.onCellSelect.call(ts,ri,ci,tdHtml,e); } if(ts.p.cellEdit === true) { if(ts.p.multiselect &amp;&amp; scb){ $(ts).jqGrid(&quot;setSelection&quot;, ri ,true,e); } else { ri = ptr[0].rowIndex; try {$(ts).jqGrid(&quot;editCell&quot;,ri,ci,true);} catch (_) {} } } else if ( !ts.p.multikey ) { if(ts.p.multiselect &amp;&amp; ts.p.multiboxonly) { if(scb){$(ts).jqGrid(&quot;setSelection&quot;,ri,true,e);} else { var frz = ts.p.frozenColumns ? ts.p.id+&quot;_frozen&quot; : &quot;&quot;; $(ts.p.selarrrow).each(function(i,n){ var ind = ts.rows.namedItem(n); $(ind).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(n))[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); if(frz) { $(&quot;#&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(frz)).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(frz))[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); } }); ts.p.selarrrow = []; $(ts).jqGrid(&quot;setSelection&quot;,ri,true,e); } } else { $(ts).jqGrid(&quot;setSelection&quot;,ri,true,e); } } else { if(e[ts.p.multikey]) { $(ts).jqGrid(&quot;setSelection&quot;,ri,true,e); } else if(ts.p.multiselect &amp;&amp; scb) { scb = $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+ri).is(&quot;:checked&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+ri)[ts.p.useProp ? 'prop' : 'attr'](&quot;checked&quot;, scb); } } } }).bind('reloadGrid', function(e,opts) { if(ts.p.treeGrid ===true) { ts.p.datatype = ts.p.treedatatype;} if (opts &amp;&amp; opts.current) { ts.grid.selectionPreserver(ts); } if(ts.p.datatype==&quot;local&quot;){ $(ts).jqGrid(&quot;resetSelection&quot;); if(ts.p.data.length) { refreshIndex();} } else if(!ts.p.treeGrid) { ts.p.selrow=null; if(ts.p.multiselect) {ts.p.selarrrow =[];setHeadCheckBox(false);} ts.p.savedRow = []; } if(ts.p.scroll) {emptyRows.call(ts, true, false);} if (opts &amp;&amp; opts.page) { var page = opts.page; if (page &gt; ts.p.lastpage) { page = ts.p.lastpage; } if (page &lt; 1) { page = 1; } ts.p.page = page; if (ts.grid.prevRowHeight) { ts.grid.bDiv.scrollTop = (page - 1) * ts.grid.prevRowHeight * ts.p.rowNum; } else { ts.grid.bDiv.scrollTop = 0; } } if (ts.grid.prevRowHeight &amp;&amp; ts.p.scroll) { delete ts.p.lastpage; ts.grid.populateVisible(); } else { ts.grid.populate(); } if(ts.p._inlinenav===true) {$(ts).jqGrid('showAddEditButtons');} return false; }) .dblclick(function(e) { td = e.target; ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;); if($(ptr).length === 0 ){return;} ri = ptr[0].rowIndex; ci = $.jgrid.getCellIndex(td); $(ts).triggerHandler(&quot;jqGridDblClickRow&quot;, [$(ptr).attr(&quot;id&quot;),ri,ci,e]); if ($.isFunction(this.p.ondblClickRow)) { ts.p.ondblClickRow.call(ts,$(ptr).attr(&quot;id&quot;),ri,ci, e); } }) .bind('contextmenu', function(e) { td = e.target; ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;); if($(ptr).length === 0 ){return;} if(!ts.p.multiselect) { $(ts).jqGrid(&quot;setSelection&quot;,ptr[0].id,true,e); } ri = ptr[0].rowIndex; ci = $.jgrid.getCellIndex(td); $(ts).triggerHandler(&quot;jqGridRightClickRow&quot;, [$(ptr).attr(&quot;id&quot;),ri,ci,e]); if ($.isFunction(this.p.onRightClickRow)) { ts.p.onRightClickRow.call(ts,$(ptr).attr(&quot;id&quot;),ri,ci, e); } }); grid.bDiv = document.createElement(&quot;div&quot;); if(isMSIE) { if(String(ts.p.height).toLowerCase() === &quot;auto&quot;) { ts.p.height = &quot;100%&quot;; } } $(grid.bDiv) .append($('&lt;div style=&quot;position:relative;'+(isMSIE &amp;&amp; $.browser.version &lt; 8 ? &quot;height:0.01%;&quot; : &quot;&quot;)+'&quot;&gt;&lt;/div&gt;').append('&lt;div&gt;&lt;/div&gt;').append(this)) .addClass(&quot;ui-jqgrid-bdiv&quot;) .css({ height: ts.p.height+(isNaN(ts.p.height)?&quot;&quot;:&quot;px&quot;), width: (grid.width)+&quot;px&quot;}) .scroll(grid.scrollGrid); $(&quot;table:first&quot;,grid.bDiv).css({width:ts.p.tblwidth+&quot;px&quot;}); if( isMSIE ) { if( $(&quot;tbody&quot;,this).length == 2 ) { $(&quot;tbody:gt(0)&quot;,this).remove();} if( ts.p.multikey) {$(grid.bDiv).bind(&quot;selectstart&quot;,function(){return false;});} } else { if( ts.p.multikey) {$(grid.bDiv).bind(&quot;mousedown&quot;,function(){return false;});} } if(hg) {$(grid.bDiv).hide();} grid.cDiv = document.createElement(&quot;div&quot;); var arf = ts.p.hidegrid===true ? $(&quot;&lt;a role='link' href='javascript:void(0)'/&gt;&quot;).addClass('ui-jqgrid-titlebar-close HeaderButton').hover( function(){ arf.addClass('ui-state-hover');}, function() {arf.removeClass('ui-state-hover');}) .append(&quot;&lt;span class='ui-icon ui-icon-circle-triangle-n'&gt;&lt;/span&gt;&quot;).css((dir==&quot;rtl&quot;?&quot;left&quot;:&quot;right&quot;),&quot;0px&quot;) : &quot;&quot;; $(grid.cDiv).append(arf).append(&quot;&lt;span class='ui-jqgrid-title&quot;+(dir==&quot;rtl&quot; ? &quot;-rtl&quot; :&quot;&quot; )+&quot;'&gt;&quot;+ts.p.caption+&quot;&lt;/span&gt;&quot;) .addClass(&quot;ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix&quot;); $(grid.cDiv).insertBefore(grid.hDiv); if( ts.p.toolbar[0] ) { grid.uDiv = document.createElement(&quot;div&quot;); if(ts.p.toolbar[1] == &quot;top&quot;) {$(grid.uDiv).insertBefore(grid.hDiv);} else if (ts.p.toolbar[1]==&quot;bottom&quot; ) {$(grid.uDiv).insertAfter(grid.hDiv);} if(ts.p.toolbar[1]==&quot;both&quot;) { grid.ubDiv = document.createElement(&quot;div&quot;); $(grid.uDiv).insertBefore(grid.hDiv).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;t_&quot;+this.id); $(grid.ubDiv).insertAfter(grid.hDiv).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;tb_&quot;+this.id); if(hg) {$(grid.ubDiv).hide();} } else { $(grid.uDiv).width(grid.width).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;t_&quot;+this.id); } if(hg) {$(grid.uDiv).hide();} } if(ts.p.toppager) { ts.p.toppager = $.jgrid.jqID(ts.p.id)+&quot;_toppager&quot;; grid.topDiv = $(&quot;&lt;div id='&quot;+ts.p.toppager+&quot;'&gt;&lt;/div&gt;&quot;)[0]; ts.p.toppager = &quot;#&quot;+ts.p.toppager; $(grid.topDiv).insertBefore(grid.hDiv).addClass('ui-state-default ui-jqgrid-toppager').width(grid.width); setPager(ts.p.toppager,'_t'); } if(ts.p.footerrow) { grid.sDiv = $(&quot;&lt;div class='ui-jqgrid-sdiv'&gt;&lt;/div&gt;&quot;)[0]; hb = $(&quot;&lt;div class='ui-jqgrid-hbox&quot;+(dir==&quot;rtl&quot;?&quot;-rtl&quot;:&quot;&quot;)+&quot;'&gt;&lt;/div&gt;&quot;); $(grid.sDiv).append(hb).insertAfter(grid.hDiv).width(grid.width); $(hb).append(tfoot); grid.footers = $(&quot;.ui-jqgrid-ftable&quot;,grid.sDiv)[0].rows[0].cells; if(ts.p.rownumbers) { grid.footers[0].className = 'ui-state-default jqgrid-rownum'; } if(hg) {$(grid.sDiv).hide();} } hb = null; if(ts.p.caption) { var tdt = ts.p.datatype; if(ts.p.hidegrid===true) { $(&quot;.ui-jqgrid-titlebar-close&quot;,grid.cDiv).click( function(e){ var onHdCl = $.isFunction(ts.p.onHeaderClick), elems = &quot;.ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv&quot;, counter, self = this; if(ts.p.toolbar[0]===true) { if( ts.p.toolbar[1]=='both') { elems += ', #' + $(grid.ubDiv).attr('id'); } elems += ', #' + $(grid.uDiv).attr('id'); } counter = $(elems,&quot;#gview_&quot;+$.jgrid.jqID(ts.p.id)).length; if(ts.p.gridstate == 'visible') { $(elems,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).slideUp(&quot;fast&quot;, function() { counter--; if (counter === 0) { $(&quot;span&quot;,self).removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;); ts.p.gridstate = 'hidden'; if($(&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hasClass(&quot;ui-resizable&quot;)) { $(&quot;.ui-resizable-handle&quot;,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hide(); } $(ts).triggerHandler(&quot;jqGridHeaderClick&quot;, [ts.p.gridstate,e]); if(onHdCl) {if(!hg) {ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}} } }); } else if(ts.p.gridstate == 'hidden'){ $(elems,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).slideDown(&quot;fast&quot;, function() { counter--; if (counter === 0) { $(&quot;span&quot;,self).removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;); if(hg) {ts.p.datatype = tdt;populate();hg=false;} ts.p.gridstate = 'visible'; if($(&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hasClass(&quot;ui-resizable&quot;)) { $(&quot;.ui-resizable-handle&quot;,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).show(); } $(ts).triggerHandler(&quot;jqGridHeaderClick&quot;, [ts.p.gridstate,e]); if(onHdCl) {if(!hg) {ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}} } }); } return false; }); if(hg) {ts.p.datatype=&quot;local&quot;; $(&quot;.ui-jqgrid-titlebar-close&quot;,grid.cDiv).trigger(&quot;click&quot;);} } } else {$(grid.cDiv).hide();} $(grid.hDiv).after(grid.bDiv) .mousemove(function (e) { if(grid.resizing){grid.dragMove(e);return false;} }); $(&quot;.ui-jqgrid-labels&quot;,grid.hDiv).bind(&quot;selectstart&quot;, function () { return false; }); $(document).mouseup(function () { if(grid.resizing) { grid.dragEnd(); return false;} return true; }); ts.formatCol = formatCol; ts.sortData = sortData; ts.updatepager = updatepager; ts.refreshIndex = refreshIndex; ts.setHeadCheckBox = setHeadCheckBox; ts.constructTr = constructTr; ts.formatter = function ( rowId, cellval , colpos, rwdat, act){return formatter(rowId, cellval , colpos, rwdat, act);}; $.extend(grid,{populate : populate, emptyRows: emptyRows}); this.grid = grid; ts.addXmlData = function(d) {addXmlData(d,ts.grid.bDiv);}; ts.addJSONData = function(d) {addJSONData(d,ts.grid.bDiv);}; this.grid.cols = this.rows[0].cells; populate();ts.p.hiddengrid=false; }); }; $.jgrid.extend({ getGridParam : function(pName) { var $t = this[0]; if (!$t || !$t.grid) {return;} if (!pName) { return $t.p; } else {return typeof($t.p[pName]) != &quot;undefined&quot; ? $t.p[pName] : null;} }, setGridParam : function (newParams){ return this.each(function(){ if (this.grid &amp;&amp; typeof(newParams) === 'object') {$.extend(true,this.p,newParams);} }); }, getDataIDs : function () { var ids=[], i=0, len, j=0; this.each(function(){ len = this.rows.length; if(len &amp;&amp; len&gt;0){ while(i&lt;len) { if($(this.rows[i]).hasClass('jqgrow')) { ids[j] = this.rows[i].id; j++; } i++; } } }); return ids; }, setSelection : function(selection,onsr, e) { return this.each(function(){ var $t = this, stat,pt, ner, ia, tpsr, fid; if(selection === undefined) { return; } onsr = onsr === false ? false : true; pt=$t.rows.namedItem(selection+&quot;&quot;); if(!pt || !pt.className || pt.className.indexOf( 'ui-state-disabled' ) &gt; -1 ) { return; } function scrGrid(iR){ var ch = $($t.grid.bDiv)[0].clientHeight, st = $($t.grid.bDiv)[0].scrollTop, rpos = $($t.rows[iR]).position().top, rh = $t.rows[iR].clientHeight; if(rpos+rh &gt;= ch+st) { $($t.grid.bDiv)[0].scrollTop = rpos-(ch+st)+rh+st; } else if(rpos &lt; ch+st) { if(rpos &lt; st) { $($t.grid.bDiv)[0].scrollTop = rpos; } } } if($t.p.scrollrows===true) { ner = $t.rows.namedItem(selection).rowIndex; if(ner &gt;=0 ){ scrGrid(ner); } } if($t.p.frozenColumns === true ) { fid = $t.p.id+&quot;_frozen&quot;; } if(!$t.p.multiselect) { if(pt.className !== &quot;ui-subgrid&quot;) { if( $t.p.selrow != pt.id) { $($t.rows.namedItem($t.p.selrow)).removeClass(&quot;ui-state-highlight&quot;).attr({&quot;aria-selected&quot;:&quot;false&quot;, &quot;tabindex&quot; : &quot;-1&quot;}); $(pt).addClass(&quot;ui-state-highlight&quot;).attr({&quot;aria-selected&quot;:&quot;true&quot;, &quot;tabindex&quot; : &quot;0&quot;});//.focus(); if(fid) { $(&quot;#&quot;+$.jgrid.jqID($t.p.selrow), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).addClass(&quot;ui-state-highlight&quot;); } stat = true; } else { stat = false; } $t.p.selrow = pt.id; $($t).triggerHandler(&quot;jqGridSelectRow&quot;, [pt.id, stat, e]); if( $t.p.onSelectRow &amp;&amp; onsr) { $t.p.onSelectRow.call($t, pt.id, stat, e); } } } else { //unselect selectall checkbox when deselecting a specific row $t.setHeadCheckBox( false ); $t.p.selrow = pt.id; ia = $.inArray($t.p.selrow,$t.p.selarrrow); if ( ia === -1 ){ if(pt.className !== &quot;ui-subgrid&quot;) { $(pt).addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;);} stat = true; $t.p.selarrrow.push($t.p.selrow); } else { if(pt.className !== &quot;ui-subgrid&quot;) { $(pt).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);} stat = false; $t.p.selarrrow.splice(ia,1); tpsr = $t.p.selarrrow[0]; $t.p.selrow = (tpsr === undefined) ? null : tpsr; } $(&quot;#jqg_&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(pt.id))[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,stat); if(fid) { if(ia === -1) { $(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).addClass(&quot;ui-state-highlight&quot;); } else { $(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); } $(&quot;#jqg_&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid))[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,stat); } $($t).triggerHandler(&quot;jqGridSelectRow&quot;, [pt.id, stat, e]); if( $t.p.onSelectRow &amp;&amp; onsr) { $t.p.onSelectRow.call($t, pt.id , stat, e); } } }); }, resetSelection : function( rowid ){ return this.each(function(){ var t = this, ind, sr, fid; if( t.p.frozenColumns === true ) { fid = t.p.id+&quot;_frozen&quot;; } if(typeof(rowid) !== &quot;undefined&quot; ) { sr = rowid === t.p.selrow ? t.p.selrow : rowid; $(&quot;#&quot;+$.jgrid.jqID(t.p.id)+&quot; tbody:first tr#&quot;+$.jgrid.jqID(sr)).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); if (fid) { $(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); } if(t.p.multiselect) { $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(t.p.id))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); if(fid) { $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(fid))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); } t.setHeadCheckBox( false); } sr = null; } else if(!t.p.multiselect) { if(t.p.selrow) { $(&quot;#&quot;+$.jgrid.jqID(t.p.id)+&quot; tbody:first tr#&quot;+$.jgrid.jqID(t.p.selrow)).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); if(fid) { $(&quot;#&quot;+$.jgrid.jqID(t.p.selrow), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); } t.p.selrow = null; } } else { $(t.p.selarrrow).each(function(i,n){ ind = t.rows.namedItem(n); $(ind).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(n))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); if(fid) { $(&quot;#&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(fid))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); } }); t.setHeadCheckBox( false ); t.p.selarrrow = []; } if(t.p.cellEdit === true) { if(parseInt(t.p.iCol,10)&gt;=0 &amp;&amp; parseInt(t.p.iRow,10)&gt;=0) { $(&quot;td:eq(&quot;+t.p.iCol+&quot;)&quot;,t.rows[t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;); $(t.rows[t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;); } } t.p.savedRow = []; }); }, getRowData : function( rowid ) { var res = {}, resall, getall=false, len, j=0; this.each(function(){ var $t = this,nm,ind; if(typeof(rowid) == 'undefined') { getall = true; resall = []; len = $t.rows.length; } else { ind = $t.rows.namedItem(rowid); if(!ind) { return res; } len = 2; } while(j&lt;len){ if(getall) { ind = $t.rows[j]; } if( $(ind).hasClass('jqgrow') ) { $('td[role=&quot;gridcell&quot;]',ind).each( function(i) { nm = $t.p.colModel[i].name; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn') { if($t.p.treeGrid===true &amp;&amp; nm == $t.p.ExpandColumn) { res[nm] = $.jgrid.htmlDecode($(&quot;span:first&quot;,this).html()); } else { try { res[nm] = $.unformat.call($t,this,{rowId:ind.id, colModel:$t.p.colModel[i]},i); } catch (e){ res[nm] = $.jgrid.htmlDecode($(this).html()); } } } }); if(getall) { resall.push(res); res={}; } } j++; } }); return resall ? resall: res; }, delRowData : function(rowid) { var success = false, rowInd, ia, ri; this.each(function() { var $t = this; rowInd = $t.rows.namedItem(rowid); if(!rowInd) {return false;} else { ri = rowInd.rowIndex; $(rowInd).remove(); $t.p.records--; $t.p.reccount--; $t.updatepager(true,false); success=true; if($t.p.multiselect) { ia = $.inArray(rowid,$t.p.selarrrow); if(ia != -1) { $t.p.selarrrow.splice(ia,1);} } if(rowid == $t.p.selrow) {$t.p.selrow=null;} } if($t.p.datatype == 'local') { var id = $.jgrid.stripPref($t.p.idPrefix, rowid), pos = $t.p._index[id]; if(typeof(pos) != 'undefined') { $t.p.data.splice(pos,1); $t.refreshIndex(); } } if( $t.p.altRows === true &amp;&amp; success ) { var cn = $t.p.altclass; $($t.rows).each(function(i){ if(i % 2 ==1) { $(this).addClass(cn); } else { $(this).removeClass(cn); } }); } }); return success; }, setRowData : function(rowid, data, cssp) { var nm, success=true, title; this.each(function(){ if(!this.grid) {return false;} var t = this, vl, ind, cp = typeof cssp, lcdata={}; ind = t.rows.namedItem(rowid); if(!ind) { return false; } if( data ) { try { $(this.p.colModel).each(function(i){ nm = this.name; if( data[nm] !== undefined) { lcdata[nm] = this.formatter &amp;&amp; typeof(this.formatter) === 'string' &amp;&amp; this.formatter == 'date' ? $.unformat.date.call(t,data[nm],this) : data[nm]; vl = t.formatter( rowid, data[nm], i, data, 'edit'); title = this.title ? {&quot;title&quot;:$.jgrid.stripHtml(vl)} : {}; if(t.p.treeGrid===true &amp;&amp; nm == t.p.ExpandColumn) { $(&quot;td:eq(&quot;+i+&quot;) &gt; span:first&quot;,ind).html(vl).attr(title); } else { $(&quot;td:eq(&quot;+i+&quot;)&quot;,ind).html(vl).attr(title); } } }); if(t.p.datatype == 'local') { var id = $.jgrid.stripPref(t.p.idPrefix, rowid), pos = t.p._index[id]; if(t.p.treeGrid) { for(var key in t.p.treeReader ){ if(lcdata.hasOwnProperty(t.p.treeReader[key])) { delete lcdata[t.p.treeReader[key]]; } } } if(typeof(pos) != 'undefined') { t.p.data[pos] = $.extend(true, t.p.data[pos], lcdata); } lcdata = null; } } catch (e) { success = false; } } if(success) { if(cp === 'string') {$(ind).addClass(cssp);} else if(cp === 'object') {$(ind).css(cssp);} $(t).triggerHandler(&quot;jqGridAfterGridComplete&quot;); } }); return success; }, addRowData : function(rowid,rdata,pos,src) { if(!pos) {pos = &quot;last&quot;;} var success = false, nm, row, gi, si, ni,sind, i, v, prp=&quot;&quot;, aradd, cnm, cn, data, cm, id; if(rdata) { if($.isArray(rdata)) { aradd=true; pos = &quot;last&quot;; cnm = rowid; } else { rdata = [rdata]; aradd = false; } this.each(function() { var t = this, datalen = rdata.length; ni = t.p.rownumbers===true ? 1 :0; gi = t.p.multiselect ===true ? 1 :0; si = t.p.subGrid===true ? 1 :0; if(!aradd) { if(typeof(rowid) != 'undefined') { rowid = rowid+&quot;&quot;;} else { rowid = $.jgrid.randId(); if(t.p.keyIndex !== false) { cnm = t.p.colModel[t.p.keyIndex+gi+si+ni].name; if(typeof rdata[0][cnm] != &quot;undefined&quot;) { rowid = rdata[0][cnm]; } } } } cn = t.p.altclass; var k = 0, cna =&quot;&quot;, lcdata = {}, air = $.isFunction(t.p.afterInsertRow) ? true : false; while(k &lt; datalen) { data = rdata[k]; row=[]; if(aradd) { try {rowid = data[cnm];} catch (e) {rowid = $.jgrid.randId();} cna = t.p.altRows === true ? (t.rows.length-1)%2 === 0 ? cn : &quot;&quot; : &quot;&quot;; } id = rowid; rowid = t.p.idPrefix + rowid; if(ni){ prp = t.formatCol(0,1,'',null,rowid, true); row[row.length] = &quot;&lt;td role=\\&quot;gridcell\\&quot; class=\\&quot;ui-state-default jqgrid-rownum\\&quot; &quot;+prp+&quot;&gt;0&lt;/td&gt;&quot;; } if(gi) { v = &quot;&lt;input role=\\&quot;checkbox\\&quot; type=\\&quot;checkbox\\&quot;&quot;+&quot; id=\\&quot;jqg_&quot;+t.p.id+&quot;_&quot;+rowid+&quot;\\&quot; class=\\&quot;cbox\\&quot;/&gt;&quot;; prp = t.formatCol(ni,1,'', null, rowid, true); row[row.length] = &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; } if(si) { row[row.length] = $(t).jqGrid(&quot;addSubGridCell&quot;,gi+ni,1); } for(i = gi+si+ni; i &lt; t.p.colModel.length;i++){ cm = t.p.colModel[i]; nm = cm.name; lcdata[nm] = data[nm]; v = t.formatter( rowid, $.jgrid.getAccessor(data,nm), i, data ); prp = t.formatCol(i,1,v, data, rowid, true); row[row.length] = &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; } row.unshift( t.constructTr(rowid, false, cna, lcdata, data, false ) ); row[row.length] = &quot;&lt;/tr&gt;&quot;; if(t.rows.length === 0){ $(&quot;table:first&quot;,t.grid.bDiv).append(row.join('')); } else { switch (pos) { case 'last': $(t.rows[t.rows.length-1]).after(row.join('')); sind = t.rows.length-1; break; case 'first': $(t.rows[0]).after(row.join('')); sind = 1; break; case 'after': sind = t.rows.namedItem(src); if (sind) { if($(t.rows[sind.rowIndex+1]).hasClass(&quot;ui-subgrid&quot;)) { $(t.rows[sind.rowIndex+1]).after(row); } else { $(sind).after(row.join('')); } } sind++; break; case 'before': sind = t.rows.namedItem(src); if(sind) {$(sind).before(row.join(''));sind=sind.rowIndex;} sind--; break; } } if(t.p.subGrid===true) { $(t).jqGrid(&quot;addSubGrid&quot;,gi+ni, sind); } t.p.records++; t.p.reccount++; $(t).triggerHandler(&quot;jqGridAfterInsertRow&quot;, [rowid,data,data]); if(air) { t.p.afterInsertRow.call(t,rowid,data,data); } k++; if(t.p.datatype == 'local') { lcdata[t.p.localReader.id] = id; t.p._index[id] = t.p.data.length; t.p.data.push(lcdata); lcdata = {}; } } if( t.p.altRows === true &amp;&amp; !aradd) { if (pos == &quot;last&quot;) { if ((t.rows.length-1)%2 == 1) {$(t.rows[t.rows.length-1]).addClass(cn);} } else { $(t.rows).each(function(i){ if(i % 2 ==1) { $(this).addClass(cn); } else { $(this).removeClass(cn); } }); } } t.updatepager(true,true); success = true; }); } return success; }, footerData : function(action,data, format) { var nm, success=false, res={}, title; function isEmpty(obj) { for(var i in obj) { if (obj.hasOwnProperty(i)) { return false; } } return true; } if(typeof(action) == &quot;undefined&quot;) { action = &quot;get&quot;; } if(typeof(format) != &quot;boolean&quot;) { format = true; } action = action.toLowerCase(); this.each(function(){ var t = this, vl; if(!t.grid || !t.p.footerrow) {return false;} if(action == &quot;set&quot;) { if(isEmpty(data)) { return false; } } success=true; $(this.p.colModel).each(function(i){ nm = this.name; if(action == &quot;set&quot;) { if( data[nm] !== undefined) { vl = format ? t.formatter( &quot;&quot;, data[nm], i, data, 'edit') : data[nm]; title = this.title ? {&quot;title&quot;:$.jgrid.stripHtml(vl)} : {}; $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;,t.grid.sDiv).html(vl).attr(title); success = true; } } else if(action == &quot;get&quot;) { res[nm] = $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;,t.grid.sDiv).html(); } }); }); return action == &quot;get&quot; ? res : success; }, showHideCol : function(colname,show) { return this.each(function() { var $t = this, fndh=false, brd=$.jgrid.cellWidth()? 0: $t.p.cellLayout, cw; if (!$t.grid ) {return;} if( typeof colname === 'string') {colname=[colname];} show = show != &quot;none&quot; ? &quot;&quot; : &quot;none&quot;; var sw = show === &quot;&quot; ? true :false, gh = $t.p.groupHeader &amp;&amp; (typeof $t.p.groupHeader === 'object' || $.isFunction($t.p.groupHeader) ); if(gh) { $($t).jqGrid('destroyGroupHeader', false); } $(this.p.colModel).each(function(i) { if ($.inArray(this.name,colname) !== -1 &amp;&amp; this.hidden === sw) { if($t.p.frozenColumns === true &amp;&amp; this.frozen === true) { return true; } $(&quot;tr&quot;,$t.grid.hDiv).each(function(){ $(this.cells[i]).css(&quot;display&quot;, show); }); $($t.rows).each(function(){ if (!$(this).hasClass(&quot;jqgroup&quot;)) { $(this.cells[i]).css(&quot;display&quot;, show); } }); if($t.p.footerrow) { $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;, $t.grid.sDiv).css(&quot;display&quot;, show); } cw = parseInt(this.width,10); if(show === &quot;none&quot;) { $t.p.tblwidth -= cw+brd; } else { $t.p.tblwidth += cw+brd; } this.hidden = !sw; fndh=true; $($t).triggerHandler(&quot;jqGridShowHideCol&quot;, [sw,this.name,i]); } }); if(fndh===true) { if($t.p.shrinkToFit === true &amp;&amp; !isNaN($t.p.height)) { $t.p.tblwidth += parseInt($t.p.scrollOffset,10);} $($t).jqGrid(&quot;setGridWidth&quot;,$t.p.shrinkToFit === true ? $t.p.tblwidth : $t.p.width ); } if( gh ) { $($t).jqGrid('setGroupHeaders',$t.p.groupHeader); } }); }, hideCol : function (colname) { return this.each(function(){$(this).jqGrid(&quot;showHideCol&quot;,colname,&quot;none&quot;);}); }, showCol : function(colname) { return this.each(function(){$(this).jqGrid(&quot;showHideCol&quot;,colname,&quot;&quot;);}); }, remapColumns : function(permutation, updateCells, keepHeader) { function resortArray(a) { var ac; if (a.length) { ac = $.makeArray(a); } else { ac = $.extend({}, a); } $.each(permutation, function(i) { a[i] = ac[this]; }); } var ts = this.get(0); function resortRows(parent, clobj) { $(&quot;&gt;tr&quot;+(clobj||&quot;&quot;), parent).each(function() { var row = this; var elems = $.makeArray(row.cells); $.each(permutation, function() { var e = elems[this]; if (e) { row.appendChild(e); } }); }); } resortArray(ts.p.colModel); resortArray(ts.p.colNames); resortArray(ts.grid.headers); resortRows($(&quot;thead:first&quot;, ts.grid.hDiv), keepHeader &amp;&amp; &quot;:not(.ui-jqgrid-labels)&quot;); if (updateCells) { resortRows($(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;), &quot;.jqgfirstrow, tr.jqgrow, tr.jqfoot&quot;); } if (ts.p.footerrow) { resortRows($(&quot;tbody:first&quot;, ts.grid.sDiv)); } if (ts.p.remapColumns) { if (!ts.p.remapColumns.length){ ts.p.remapColumns = $.makeArray(permutation); } else { resortArray(ts.p.remapColumns); } } ts.p.lastsort = $.inArray(ts.p.lastsort, permutation); if(ts.p.treeGrid) { ts.p.expColInd = $.inArray(ts.p.expColInd, permutation); } $(ts).triggerHandler(&quot;jqGridRemapColumns&quot;, [permutation, updateCells, keepHeader]); }, setGridWidth : function(nwidth, shrink) { return this.each(function(){ if (!this.grid ) {return;} var $t = this, cw, initwidth = 0, brd=$.jgrid.cellWidth() ? 0: $t.p.cellLayout, lvc, vc=0, hs=false, scw=$t.p.scrollOffset, aw, gw=0, cl = 0,cr; if(typeof shrink != 'boolean') { shrink=$t.p.shrinkToFit; } if(isNaN(nwidth)) {return;} nwidth = parseInt(nwidth,10); $t.grid.width = $t.p.width = nwidth; $(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).css(&quot;width&quot;,nwidth+&quot;px&quot;); $(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).css(&quot;width&quot;,nwidth+&quot;px&quot;); $($t.grid.bDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); $($t.grid.hDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); if($t.p.pager ) {$($t.p.pager).css(&quot;width&quot;,nwidth+&quot;px&quot;);} if($t.p.toppager ) {$($t.p.toppager).css(&quot;width&quot;,nwidth+&quot;px&quot;);} if($t.p.toolbar[0] === true){ $($t.grid.uDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); if($t.p.toolbar[1]==&quot;both&quot;) {$($t.grid.ubDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;);} } if($t.p.footerrow) { $($t.grid.sDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); } if(shrink ===false &amp;&amp; $t.p.forceFit === true) {$t.p.forceFit=false;} if(shrink===true) { $.each($t.p.colModel, function() { if(this.hidden===false){ cw = this.widthOrg; initwidth += cw+brd; if(this.fixed) { gw += cw+brd; } else { vc++; } cl++; } }); if(vc === 0) { return; } $t.p.tblwidth = initwidth; aw = nwidth-brd*vc-gw; if(!isNaN($t.p.height)) { if($($t.grid.bDiv)[0].clientHeight &lt; $($t.grid.bDiv)[0].scrollHeight || $t.rows.length === 1){ hs = true; aw -= scw; } } initwidth =0; var cle = $t.grid.cols.length &gt;0; $.each($t.p.colModel, function(i) { if(this.hidden === false &amp;&amp; !this.fixed){ cw = this.widthOrg; cw = Math.round(aw*cw/($t.p.tblwidth-brd*vc-gw)); if (cw &lt; 0) { return; } this.width =cw; initwidth += cw; $t.grid.headers[i].width=cw; $t.grid.headers[i].el.style.width=cw+&quot;px&quot;; if($t.p.footerrow) { $t.grid.footers[i].style.width = cw+&quot;px&quot;; } if(cle) { $t.grid.cols[i].style.width = cw+&quot;px&quot;; } lvc = i; } }); if (!lvc) { return; } cr =0; if (hs) { if(nwidth-gw-(initwidth+brd*vc) !== scw){ cr = nwidth-gw-(initwidth+brd*vc)-scw; } } else if( Math.abs(nwidth-gw-(initwidth+brd*vc)) !== 1) { cr = nwidth-gw-(initwidth+brd*vc); } $t.p.colModel[lvc].width += cr; $t.p.tblwidth = initwidth+cr+brd*vc+gw; if($t.p.tblwidth &gt; nwidth) { var delta = $t.p.tblwidth - parseInt(nwidth,10); $t.p.tblwidth = nwidth; cw = $t.p.colModel[lvc].width = $t.p.colModel[lvc].width-delta; } else { cw= $t.p.colModel[lvc].width; } $t.grid.headers[lvc].width = cw; $t.grid.headers[lvc].el.style.width=cw+&quot;px&quot;; if(cle) { $t.grid.cols[lvc].style.width = cw+&quot;px&quot;; } if($t.p.footerrow) { $t.grid.footers[lvc].style.width = cw+&quot;px&quot;; } } if($t.p.tblwidth) { $('table:first',$t.grid.bDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;); $('table:first',$t.grid.hDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;); $t.grid.hDiv.scrollLeft = $t.grid.bDiv.scrollLeft; if($t.p.footerrow) { $('table:first',$t.grid.sDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;); } } }); }, setGridHeight : function (nh) { return this.each(function (){ var $t = this; if(!$t.grid) {return;} var bDiv = $($t.grid.bDiv); bDiv.css({height: nh+(isNaN(nh)?&quot;&quot;:&quot;px&quot;)}); if($t.p.frozenColumns === true){ //follow the original set height to use 16, better scrollbar width detection $('#'+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).parent().height(bDiv.height() - 16); } $t.p.height = nh; if ($t.p.scroll) { $t.grid.populateVisible(); } }); }, setCaption : function (newcap){ return this.each(function(){ this.p.caption=newcap; $(&quot;span.ui-jqgrid-title, span.ui-jqgrid-title-rtl&quot;,this.grid.cDiv).html(newcap); $(this.grid.cDiv).show(); }); }, setLabel : function(colname, nData, prop, attrp ){ return this.each(function(){ var $t = this, pos=-1; if(!$t.grid) {return;} if(typeof(colname) != &quot;undefined&quot;) { $($t.p.colModel).each(function(i){ if (this.name == colname) { pos = i;return false; } }); } else { return; } if(pos&gt;=0) { var thecol = $(&quot;tr.ui-jqgrid-labels th:eq(&quot;+pos+&quot;)&quot;,$t.grid.hDiv); if (nData){ var ico = $(&quot;.s-ico&quot;,thecol); $(&quot;[id^=jqgh_]&quot;,thecol).empty().html(nData).append(ico); $t.p.colNames[pos] = nData; } if (prop) { if(typeof prop === 'string') {$(thecol).addClass(prop);} else {$(thecol).css(prop);} } if(typeof attrp === 'object') {$(thecol).attr(attrp);} } }); }, setCell : function(rowid,colname,nData,cssp,attrp, forceupd) { return this.each(function(){ var $t = this, pos =-1,v, title; if(!$t.grid) {return;} if(isNaN(colname)) { $($t.p.colModel).each(function(i){ if (this.name == colname) { pos = i;return false; } }); } else {pos = parseInt(colname,10);} if(pos&gt;=0) { var ind = $t.rows.namedItem(rowid); if (ind){ var tcell = $(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind); if(nData !== &quot;&quot; || forceupd === true) { v = $t.formatter(rowid, nData, pos,ind,'edit'); title = $t.p.colModel[pos].title ? {&quot;title&quot;:$.jgrid.stripHtml(v)} : {}; if($t.p.treeGrid &amp;&amp; $(&quot;.tree-wrap&quot;,$(tcell)).length&gt;0) { $(&quot;span&quot;,$(tcell)).html(v).attr(title); } else { $(tcell).html(v).attr(title); } if($t.p.datatype == &quot;local&quot;) { var cm = $t.p.colModel[pos], index; nData = cm.formatter &amp;&amp; typeof(cm.formatter) === 'string' &amp;&amp; cm.formatter == 'date' ? $.unformat.date.call($t,nData,cm) : nData; index = $t.p._index[rowid]; if(typeof index != &quot;undefined&quot;) { $t.p.data[index][cm.name] = nData; } } } if(typeof cssp === 'string'){ $(tcell).addClass(cssp); } else if(cssp) { $(tcell).css(cssp); } if(typeof attrp === 'object') {$(tcell).attr(attrp);} } } }); }, getCell : function(rowid,col) { var ret = false; this.each(function(){ var $t=this, pos=-1; if(!$t.grid) {return;} if(isNaN(col)) { $($t.p.colModel).each(function(i){ if (this.name === col) { pos = i;return false; } }); } else {pos = parseInt(col,10);} if(pos&gt;=0) { var ind = $t.rows.namedItem(rowid); if(ind) { try { ret = $.unformat.call($t,$(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind),{rowId:ind.id, colModel:$t.p.colModel[pos]},pos); } catch (e){ ret = $.jgrid.htmlDecode($(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind).html()); } } } }); return ret; }, getCol : function (col, obj, mathopr) { var ret = [], val, sum=0, min, max, v; obj = typeof (obj) != 'boolean' ? false : obj; if(typeof mathopr == 'undefined') { mathopr = false; } this.each(function(){ var $t=this, pos=-1; if(!$t.grid) {return;} if(isNaN(col)) { $($t.p.colModel).each(function(i){ if (this.name === col) { pos = i;return false; } }); } else {pos = parseInt(col,10);} if(pos&gt;=0) { var ln = $t.rows.length, i =0; if (ln &amp;&amp; ln&gt;0){ while(i&lt;ln){ if($($t.rows[i]).hasClass('jqgrow')) { try { val = $.unformat.call($t,$($t.rows[i].cells[pos]),{rowId:$t.rows[i].id, colModel:$t.p.colModel[pos]},pos); } catch (e) { val = $.jgrid.htmlDecode($t.rows[i].cells[pos].innerHTML); } if(mathopr) { v = parseFloat(val); sum += v; if (max === undefined) {max = min = v} min = Math.min(min, v); max = Math.max(max, v); } else if(obj) { ret.push( {id:$t.rows[i].id,value:val} ); } else { ret.push( val ); } } i++; } if(mathopr) { switch(mathopr.toLowerCase()){ case 'sum': ret =sum; break; case 'avg': ret = sum/ln; break; case 'count': ret = ln; break; case 'min': ret = min; break; case 'max': ret = max; break; } } } } }); return ret; }, clearGridData : function(clearfooter) { return this.each(function(){ var $t = this; if(!$t.grid) {return;} if(typeof clearfooter != 'boolean') { clearfooter = false; } if($t.p.deepempty) {$(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first tr:gt(0)&quot;).remove();} else { var trf = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first tr:first&quot;)[0]; $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).empty().append(trf); } if($t.p.footerrow &amp;&amp; clearfooter) { $(&quot;.ui-jqgrid-ftable td&quot;,$t.grid.sDiv).html(&quot;&amp;#160;&quot;); } $t.p.selrow = null; $t.p.selarrrow= []; $t.p.savedRow = []; $t.p.records = 0;$t.p.page=1;$t.p.lastpage=0;$t.p.reccount=0; $t.p.data = []; $t.p._index = {}; $t.updatepager(true,false); }); }, getInd : function(rowid,rc){ var ret =false,rw; this.each(function(){ rw = this.rows.namedItem(rowid); if(rw) { ret = rc===true ? rw: rw.rowIndex; } }); return ret; }, bindKeys : function( settings ){ var o = $.extend({ onEnter: null, onSpace: null, onLeftKey: null, onRightKey: null, scrollingRows : true },settings || {}); return this.each(function(){ var $t = this; if( !$('body').is('[role]') ){$('body').attr('role','application');} $t.p.scrollrows = o.scrollingRows; $($t).keydown(function(event){ var target = $($t).find('tr[tabindex=0]')[0], id, r, mind, expanded = $t.p.treeReader.expanded_field; //check for arrow keys if(target) { mind = $t.p._index[target.id]; if(event.keyCode === 37 || event.keyCode === 38 || event.keyCode === 39 || event.keyCode === 40){ // up key if(event.keyCode === 38 ){ r = target.previousSibling; id = &quot;&quot;; if(r) { if($(r).is(&quot;:hidden&quot;)) { while(r) { r = r.previousSibling; if(!$(r).is(&quot;:hidden&quot;) &amp;&amp; $(r).hasClass('jqgrow')) {id = r.id;break;} } } else { id = r.id; } } $($t).jqGrid('setSelection', id, true, event); event.preventDefault(); } //if key is down arrow if(event.keyCode === 40){ r = target.nextSibling; id =&quot;&quot;; if(r) { if($(r).is(&quot;:hidden&quot;)) { while(r) { r = r.nextSibling; if(!$(r).is(&quot;:hidden&quot;) &amp;&amp; $(r).hasClass('jqgrow') ) {id = r.id;break;} } } else { id = r.id; } } $($t).jqGrid('setSelection', id, true, event); event.preventDefault(); } // left if(event.keyCode === 37 ){ if($t.p.treeGrid &amp;&amp; $t.p.data[mind][expanded]) { $(target).find(&quot;div.treeclick&quot;).trigger('click'); } $($t).triggerHandler(&quot;jqGridKeyLeft&quot;, [$t.p.selrow]); if($.isFunction(o.onLeftKey)) { o.onLeftKey.call($t, $t.p.selrow); } } // right if(event.keyCode === 39 ){ if($t.p.treeGrid &amp;&amp; !$t.p.data[mind][expanded]) { $(target).find(&quot;div.treeclick&quot;).trigger('click'); } $($t).triggerHandler(&quot;jqGridKeyRight&quot;, [$t.p.selrow]); if($.isFunction(o.onRightKey)) { o.onRightKey.call($t, $t.p.selrow); } } } //check if enter was pressed on a grid or treegrid node else if( event.keyCode === 13 ){ $($t).triggerHandler(&quot;jqGridKeyEnter&quot;, [$t.p.selrow]); if($.isFunction(o.onEnter)) { o.onEnter.call($t, $t.p.selrow); } } else if(event.keyCode === 32) { $($t).triggerHandler(&quot;jqGridKeySpace&quot;, [$t.p.selrow]); if($.isFunction(o.onSpace)) { o.onSpace.call($t, $t.p.selrow); } } } }); }); }, unbindKeys : function(){ return this.each(function(){ $(this).unbind('keydown'); }); }, getLocalRow : function (rowid) { var ret = false, ind; this.each(function(){ if(typeof(rowid) !== &quot;undefined&quot;) { ind = this.p._index[rowid]; if(ind &gt;= 0 ) { ret = this.p.data[ind]; } } }); return ret; } }); })(jQuery); (function($){ /** * jqGrid extension for custom methods * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * * Wildraid wildraid@mail.ru * Oleg Kiriljuk oleg.kiriljuk@ok-soft-gmbh.com * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ /*global jQuery, $ */ &quot;use strict&quot;; $.jgrid.extend({ getColProp : function(colname){ var ret ={}, $t = this[0]; if ( !$t.grid ) { return false; } var cM = $t.p.colModel; for ( var i =0;i&lt;cM.length;i++ ) { if ( cM[i].name == colname ) { ret = cM[i]; break; } } return ret; }, setColProp : function(colname, obj){ //do not set width will not work return this.each(function(){ if ( this.grid ) { if ( obj ) { var cM = this.p.colModel; for ( var i =0;i&lt;cM.length;i++ ) { if ( cM[i].name == colname ) { $.extend(this.p.colModel[i],obj); break; } } } } }); }, sortGrid : function(colname,reload, sor){ return this.each(function(){ var $t=this,idx=-1; if ( !$t.grid ) { return;} if ( !colname ) { colname = $t.p.sortname; } for ( var i=0;i&lt;$t.p.colModel.length;i++ ) { if ( $t.p.colModel[i].index == colname || $t.p.colModel[i].name==colname ) { idx = i; break; } } if ( idx!=-1 ){ var sort = $t.p.colModel[idx].sortable; if ( typeof sort !== 'boolean' ) { sort = true; } if ( typeof reload !=='boolean' ) { reload = false; } if ( sort ) { $t.sortData(&quot;jqgh_&quot;+$t.p.id+&quot;_&quot; + colname, idx, reload, sor); } } }); }, clearBeforeUnload : function () { return this.each(function(){ var grid = this.grid; grid.emptyRows.call(this, true, true); // this work quick enough and reduce the size of memory leaks if we have someone //$(document).unbind(&quot;mouseup&quot;); // TODO add namespace $(grid.hDiv).unbind(&quot;mousemove&quot;); // TODO add namespace $(this).unbind(); grid.dragEnd = null; grid.dragMove = null; grid.dragStart = null; grid.emptyRows = null; grid.populate = null; grid.populateVisible = null; grid.scrollGrid = null; grid.selectionPreserver = null; grid.bDiv = null; grid.cDiv = null; grid.hDiv = null; grid.cols = null; var i, l = grid.headers.length; for (i = 0; i &lt; l; i++) { grid.headers[i].el = null; } this.formatCol = null; this.sortData = null; this.updatepager = null; this.refreshIndex = null; this.setHeadCheckBox = null; this.constructTr = null; this.formatter = null; this.addXmlData = null; this.addJSONData = null; }); }, GridDestroy : function () { return this.each(function(){ if ( this.grid ) { if ( this.p.pager ) { // if not part of grid $(this.p.pager).remove(); } try { $(this).jqGrid('clearBeforeUnload'); $(&quot;#gbox_&quot;+$.jgrid.jqID(this.id)).remove(); } catch (_) {} } }); }, GridUnload : function(){ return this.each(function(){ if ( !this.grid ) {return;} var defgrid = {id: $(this).attr('id'),cl: $(this).attr('class')}; if (this.p.pager) { $(this.p.pager).empty().removeClass(&quot;ui-state-default ui-jqgrid-pager corner-bottom&quot;); } var newtable = document.createElement('table'); $(newtable).attr({id:defgrid.id}); newtable.className = defgrid.cl; var gid = $.jgrid.jqID(this.id); $(newtable).removeClass(&quot;ui-jqgrid-btable&quot;); if( $(this.p.pager).parents(&quot;#gbox_&quot;+gid).length === 1 ) { $(newtable).insertBefore(&quot;#gbox_&quot;+gid).show(); $(this.p.pager).insertBefore(&quot;#gbox_&quot;+gid); } else { $(newtable).insertBefore(&quot;#gbox_&quot;+gid).show(); } $(this).jqGrid('clearBeforeUnload'); $(&quot;#gbox_&quot;+gid).remove(); }); }, setGridState : function(state) { return this.each(function(){ if ( !this.grid ) {return;} var $t = this; if(state == 'hidden'){ $(&quot;.ui-jqgrid-bdiv, .ui-jqgrid-hdiv&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).slideUp(&quot;fast&quot;); if($t.p.pager) {$($t.p.pager).slideUp(&quot;fast&quot;);} if($t.p.toppager) {$($t.p.toppager).slideUp(&quot;fast&quot;);} if($t.p.toolbar[0]===true) { if( $t.p.toolbar[1]=='both') { $($t.grid.ubDiv).slideUp(&quot;fast&quot;); } $($t.grid.uDiv).slideUp(&quot;fast&quot;); } if($t.p.footerrow) { $(&quot;.ui-jqgrid-sdiv&quot;,&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).slideUp(&quot;fast&quot;); } $(&quot;.ui-jqgrid-titlebar-close span&quot;,$t.grid.cDiv).removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;); $t.p.gridstate = 'hidden'; } else if(state=='visible') { $(&quot;.ui-jqgrid-hdiv, .ui-jqgrid-bdiv&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).slideDown(&quot;fast&quot;); if($t.p.pager) {$($t.p.pager).slideDown(&quot;fast&quot;);} if($t.p.toppager) {$($t.p.toppager).slideDown(&quot;fast&quot;);} if($t.p.toolbar[0]===true) { if( $t.p.toolbar[1]=='both') { $($t.grid.ubDiv).slideDown(&quot;fast&quot;); } $($t.grid.uDiv).slideDown(&quot;fast&quot;); } if($t.p.footerrow) { $(&quot;.ui-jqgrid-sdiv&quot;,&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).slideDown(&quot;fast&quot;); } $(&quot;.ui-jqgrid-titlebar-close span&quot;,$t.grid.cDiv).removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;); $t.p.gridstate = 'visible'; } }); }, filterToolbar : function(p){ p = $.extend({ autosearch: true, searchOnEnter : true, beforeSearch: null, afterSearch: null, beforeClear: null, afterClear: null, searchurl : '', stringResult: false, groupOp: 'AND', defaultSearch : &quot;bw&quot; },p || {}); return this.each(function(){ var $t = this; if(this.ftoolbar) { return; } var triggerToolbar = function() { var sdata={}, j=0, v, nm, sopt={},so; $.each($t.p.colModel,function(){ nm = this.index || this.name; so = (this.searchoptions &amp;&amp; this.searchoptions.sopt) ? this.searchoptions.sopt[0] : this.stype=='select'? 'eq' : p.defaultSearch; v = $(&quot;#gs_&quot;+$.jgrid.jqID(this.name), (this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ? $t.grid.fhDiv : $t.grid.hDiv).val(); if(v) { sdata[nm] = v; sopt[nm] = so; j++; } else { try { delete $t.p.postData[nm]; } catch (z) {} } }); var sd = j&gt;0 ? true : false; if(p.stringResult === true || $t.p.datatype == &quot;local&quot;) { var ruleGroup = &quot;{\\&quot;groupOp\\&quot;:\\&quot;&quot; + p.groupOp + &quot;\\&quot;,\\&quot;rules\\&quot;:[&quot;; var gi=0; $.each(sdata,function(i,n){ if (gi &gt; 0) {ruleGroup += &quot;,&quot;;} ruleGroup += &quot;{\\&quot;field\\&quot;:\\&quot;&quot; + i + &quot;\\&quot;,&quot;; ruleGroup += &quot;\\&quot;op\\&quot;:\\&quot;&quot; + sopt[i] + &quot;\\&quot;,&quot;; n+=&quot;&quot;; ruleGroup += &quot;\\&quot;data\\&quot;:\\&quot;&quot; + n.replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;') + &quot;\\&quot;}&quot;; gi++; }); ruleGroup += &quot;]}&quot;; $.extend($t.p.postData,{filters:ruleGroup}); $.each(['searchField', 'searchString', 'searchOper'], function(i, n){ if($t.p.postData.hasOwnProperty(n)) { delete $t.p.postData[n];} }); } else { $.extend($t.p.postData,sdata); } var saveurl; if($t.p.searchurl) { saveurl = $t.p.url; $($t).jqGrid(&quot;setGridParam&quot;,{url:$t.p.searchurl}); } var bsr = $($t).triggerHandler(&quot;jqGridToolbarBeforeSearch&quot;) === 'stop' ? true : false; if(!bsr &amp;&amp; $.isFunction(p.beforeSearch)){bsr = p.beforeSearch.call($t);} if(!bsr) { $($t).jqGrid(&quot;setGridParam&quot;,{search:sd}).trigger(&quot;reloadGrid&quot;,[{page:1}]); } if(saveurl) {$($t).jqGrid(&quot;setGridParam&quot;,{url:saveurl});} $($t).triggerHandler(&quot;jqGridToolbarAfterSearch&quot;); if($.isFunction(p.afterSearch)){p.afterSearch.call($t);} }; var clearToolbar = function(trigger){ var sdata={}, j=0, nm; trigger = (typeof trigger != 'boolean') ? true : trigger; $.each($t.p.colModel,function(){ var v; if(this.searchoptions &amp;&amp; this.searchoptions.defaultValue !== undefined) { v = this.searchoptions.defaultValue; } nm = this.index || this.name; switch (this.stype) { case 'select' : $(&quot;#gs_&quot;+$.jgrid.jqID(this.name)+&quot; option&quot;,(this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ? $t.grid.fhDiv : $t.grid.hDiv).each(function (i){ if(i===0) { this.selected = true; } if ($(this).val() == v) { this.selected = true; return false; } }); if ( v !== undefined ) { // post the key and not the text sdata[nm] = v; j++; } else { try { delete $t.p.postData[nm]; } catch(e) {} } break; case 'text': $(&quot;#gs_&quot;+$.jgrid.jqID(this.name),(this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ? $t.grid.fhDiv : $t.grid.hDiv).val(v); if(v !== undefined) { sdata[nm] = v; j++; } else { try { delete $t.p.postData[nm]; } catch (y){} } break; } }); var sd = j&gt;0 ? true : false; if(p.stringResult === true || $t.p.datatype == &quot;local&quot;) { var ruleGroup = &quot;{\\&quot;groupOp\\&quot;:\\&quot;&quot; + p.groupOp + &quot;\\&quot;,\\&quot;rules\\&quot;:[&quot;; var gi=0; $.each(sdata,function(i,n){ if (gi &gt; 0) {ruleGroup += &quot;,&quot;;} ruleGroup += &quot;{\\&quot;field\\&quot;:\\&quot;&quot; + i + &quot;\\&quot;,&quot;; ruleGroup += &quot;\\&quot;op\\&quot;:\\&quot;&quot; + &quot;eq&quot; + &quot;\\&quot;,&quot;; n+=&quot;&quot;; ruleGroup += &quot;\\&quot;data\\&quot;:\\&quot;&quot; + n.replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;') + &quot;\\&quot;}&quot;; gi++; }); ruleGroup += &quot;]}&quot;; $.extend($t.p.postData,{filters:ruleGroup}); $.each(['searchField', 'searchString', 'searchOper'], function(i, n){ if($t.p.postData.hasOwnProperty(n)) { delete $t.p.postData[n];} }); } else { $.extend($t.p.postData,sdata); } var saveurl; if($t.p.searchurl) { saveurl = $t.p.url; $($t).jqGrid(&quot;setGridParam&quot;,{url:$t.p.searchurl}); } var bcv = $($t).triggerHandler(&quot;jqGridToolbarBeforeClear&quot;) === 'stop' ? true : false; if(!bcv &amp;&amp; $.isFunction(p.beforeClear)){bcv = p.beforeClear.call($t);} if(!bcv) { if(trigger) { $($t).jqGrid(&quot;setGridParam&quot;,{search:sd}).trigger(&quot;reloadGrid&quot;,[{page:1}]); } } if(saveurl) {$($t).jqGrid(&quot;setGridParam&quot;,{url:saveurl});} $($t).triggerHandler(&quot;jqGridToolbarAfterClear&quot;); if($.isFunction(p.afterClear)){p.afterClear();} }; var toggleToolbar = function(){ var trow = $(&quot;tr.ui-search-toolbar&quot;,$t.grid.hDiv), trow2 = $t.p.frozenColumns === true ? $(&quot;tr.ui-search-toolbar&quot;,$t.grid.fhDiv) : false; if(trow.css(&quot;display&quot;)=='none') { trow.show(); if(trow2) { trow2.show(); } } else { trow.hide(); if(trow2) { trow2.hide(); } } }; // create the row function bindEvents(selector, events) { var jElem = $(selector); if (jElem[0]) { jQuery.each(events, function() { if (this.data !== undefined) { jElem.bind(this.type, this.data, this.fn); } else { jElem.bind(this.type, this.fn); } }); } } var tr = $(&quot;&lt;tr class='ui-search-toolbar' role='rowheader'&gt;&lt;/tr&gt;&quot;); var timeoutHnd; $.each($t.p.colModel,function(){ var cm=this, thd , th, soptions,surl,self; th = $(&quot;&lt;th role='columnheader' class='ui-state-default ui-th-column ui-th-&quot;+$t.p.direction+&quot;'&gt;&lt;/th&gt;&quot;); thd = $(&quot;&lt;div style='width:100%;position:relative;height:100%;padding-right:0.3em;'&gt;&lt;/div&gt;&quot;); if(this.hidden===true) { $(th).css(&quot;display&quot;,&quot;none&quot;);} this.search = this.search === false ? false : true; if(typeof this.stype == 'undefined' ) {this.stype='text';} soptions = $.extend({},this.searchoptions || {}); if(this.search){ switch (this.stype) { case &quot;select&quot;: surl = this.surl || soptions.dataUrl; if(surl) { // data returned should have already constructed html select // primitive jQuery load self = thd; $.ajax($.extend({ url: surl, dataType: &quot;html&quot;, success: function(res) { if(soptions.buildSelect !== undefined) { var d = soptions.buildSelect(res); if (d) { $(self).append(d); } } else { $(self).append(res); } if(soptions.defaultValue !== undefined) { $(&quot;select&quot;,self).val(soptions.defaultValue); } $(&quot;select&quot;,self).attr({name:cm.index || cm.name, id: &quot;gs_&quot;+cm.name}); if(soptions.attr) {$(&quot;select&quot;,self).attr(soptions.attr);} $(&quot;select&quot;,self).css({width: &quot;100%&quot;}); // preserve autoserch if(soptions.dataInit !== undefined) { soptions.dataInit($(&quot;select&quot;,self)[0]); } if(soptions.dataEvents !== undefined) { bindEvents($(&quot;select&quot;,self)[0],soptions.dataEvents); } if(p.autosearch===true){ $(&quot;select&quot;,self).change(function(){ triggerToolbar(); return false; }); } res=null; } }, $.jgrid.ajaxOptions, $t.p.ajaxSelectOptions || {} )); } else { var oSv, sep, delim; if(cm.searchoptions) { oSv = cm.searchoptions.value === undefined ? &quot;&quot; : cm.searchoptions.value; sep = cm.searchoptions.separator === undefined ? &quot;:&quot; : cm.searchoptions.separator; delim = cm.searchoptions.delimiter === undefined ? &quot;;&quot; : cm.searchoptions.delimiter; } else if(cm.editoptions) { oSv = cm.editoptions.value === undefined ? &quot;&quot; : cm.editoptions.value; sep = cm.editoptions.separator === undefined ? &quot;:&quot; : cm.editoptions.separator; delim = cm.editoptions.delimiter === undefined ? &quot;;&quot; : cm.editoptions.delimiter; } if (oSv) { var elem = document.createElement(&quot;select&quot;); elem.style.width = &quot;100%&quot;; $(elem).attr({name:cm.index || cm.name, id: &quot;gs_&quot;+cm.name}); var so, sv, ov; if(typeof oSv === &quot;string&quot;) { so = oSv.split(delim); for(var k=0; k&lt;so.length;k++){ sv = so[k].split(sep); ov = document.createElement(&quot;option&quot;); ov.value = sv[0]; ov.innerHTML = sv[1]; elem.appendChild(ov); } } else if(typeof oSv === &quot;object&quot; ) { for ( var key in oSv) { if(oSv.hasOwnProperty(key)) { ov = document.createElement(&quot;option&quot;); ov.value = key; ov.innerHTML = oSv[key]; elem.appendChild(ov); } } } if(soptions.defaultValue !== undefined) { $(elem).val(soptions.defaultValue); } if(soptions.attr) {$(elem).attr(soptions.attr);} if(soptions.dataInit !== undefined) { soptions.dataInit(elem); } if(soptions.dataEvents !== undefined) { bindEvents(elem, soptions.dataEvents); } $(thd).append(elem); if(p.autosearch===true){ $(elem).change(function(){ triggerToolbar(); return false; }); } } } break; case 'text': var df = soptions.defaultValue !== undefined ? soptions.defaultValue: &quot;&quot;; $(thd).append(&quot;&lt;input type='text' style='width:95%;padding:0px;' name='&quot;+(cm.index || cm.name)+&quot;' id='gs_&quot;+cm.name+&quot;' value='&quot;+df+&quot;'/&gt;&quot;); if(soptions.attr) {$(&quot;input&quot;,thd).attr(soptions.attr);} if(soptions.dataInit !== undefined) { soptions.dataInit($(&quot;input&quot;,thd)[0]); } if(soptions.dataEvents !== undefined) { bindEvents($(&quot;input&quot;,thd)[0], soptions.dataEvents); } if(p.autosearch===true){ if(p.searchOnEnter) { $(&quot;input&quot;,thd).keypress(function(e){ var key = e.charCode ? e.charCode : e.keyCode ? e.keyCode : 0; if(key == 13){ triggerToolbar(); return false; } return this; }); } else { $(&quot;input&quot;,thd).keydown(function(e){ var key = e.which; switch (key) { case 13: return false; case 9 : case 16: case 37: case 38: case 39: case 40: case 27: break; default : if(timeoutHnd) { clearTimeout(timeoutHnd); } timeoutHnd = setTimeout(function(){triggerToolbar();},500); } }); } } break; } } $(th).append(thd); $(tr).append(th); }); $(&quot;table thead&quot;,$t.grid.hDiv).append(tr); this.ftoolbar = true; this.triggerToolbar = triggerToolbar; this.clearToolbar = clearToolbar; this.toggleToolbar = toggleToolbar; }); }, destroyGroupHeader : function(nullHeader) { if(typeof(nullHeader) == 'undefined') { nullHeader = true; } return this.each(function() { var $t = this, $tr, i, l, headers, $th, $resizing, grid = $t.grid, thead = $(&quot;table.ui-jqgrid-htable thead&quot;, grid.hDiv), cm = $t.p.colModel, hc; if(!grid) { return; } $(this).unbind('.setGroupHeaders'); $tr = $(&quot;&lt;tr&gt;&quot;, {role: &quot;rowheader&quot;}).addClass(&quot;ui-jqgrid-labels&quot;); headers = grid.headers; for (i = 0, l = headers.length; i &lt; l; i++) { hc = cm[i].hidden ? &quot;none&quot; : &quot;&quot;; $th = $(headers[i].el) .width(headers[i].width) .css('display',hc); try { $th.removeAttr(&quot;rowSpan&quot;); } catch (rs) { //IE 6/7 $th.attr(&quot;rowSpan&quot;,1); } $tr.append($th); $resizing = $th.children(&quot;span.ui-jqgrid-resize&quot;); if ($resizing.length&gt;0) {// resizable column $resizing[0].style.height = &quot;&quot;; } $th.children(&quot;div&quot;)[0].style.top = &quot;&quot;; } $(thead).children('tr.ui-jqgrid-labels').remove(); $(thead).prepend($tr); if(nullHeader === true) { $($t).jqGrid('setGridParam',{ 'groupHeader': null}); } }); }, setGroupHeaders : function ( o ) { o = $.extend({ useColSpanStyle : false, groupHeaders: [] },o || {}); return this.each(function(){ this.p.groupHeader = o; var ts = this, i, cmi, skip = 0, $tr, $colHeader, th, $th, thStyle, iCol, cghi, //startColumnName, numberOfColumns, titleText, cVisibleColumns, colModel = ts.p.colModel, cml = colModel.length, ths = ts.grid.headers, $htable = $(&quot;table.ui-jqgrid-htable&quot;, ts.grid.hDiv), $trLabels = $htable.children(&quot;thead&quot;).children(&quot;tr.ui-jqgrid-labels:last&quot;).addClass(&quot;jqg-second-row-header&quot;), $thead = $htable.children(&quot;thead&quot;), $theadInTable, $firstHeaderRow = $htable.find(&quot;.jqg-first-row-header&quot;); if($firstHeaderRow[0] === undefined) { $firstHeaderRow = $('&lt;tr&gt;', {role: &quot;row&quot;, &quot;aria-hidden&quot;: &quot;true&quot;}).addClass(&quot;jqg-first-row-header&quot;).css(&quot;height&quot;, &quot;auto&quot;); } else { $firstHeaderRow.empty(); } var $firstRow, inColumnHeader = function (text, columnHeaders) { var i = 0, length = columnHeaders.length; for (; i &lt; length; i++) { if (columnHeaders[i].startColumnName === text) { return i; } } return -1; }; $(ts).prepend($thead); $tr = $('&lt;tr&gt;', {role: &quot;rowheader&quot;}).addClass(&quot;ui-jqgrid-labels jqg-third-row-header&quot;); for (i = 0; i &lt; cml; i++) { th = ths[i].el; $th = $(th); cmi = colModel[i]; // build the next cell for the first header row thStyle = { height: '0px', width: ths[i].width + 'px', display: (cmi.hidden ? 'none' : '')}; $(&quot;&lt;th&gt;&quot;, {role: 'gridcell'}).css(thStyle).addClass(&quot;ui-first-th-&quot;+ts.p.direction).appendTo($firstHeaderRow); th.style.width = &quot;&quot;; // remove unneeded style iCol = inColumnHeader(cmi.name, o.groupHeaders); if (iCol &gt;= 0) { cghi = o.groupHeaders[iCol]; numberOfColumns = cghi.numberOfColumns; titleText = cghi.titleText; // caclulate the number of visible columns from the next numberOfColumns columns for (cVisibleColumns = 0, iCol = 0; iCol &lt; numberOfColumns &amp;&amp; (i + iCol &lt; cml); iCol++) { if (!colModel[i + iCol].hidden) { cVisibleColumns++; } } // The next numberOfColumns headers will be moved in the next row // in the current row will be placed the new column header with the titleText. // The text will be over the cVisibleColumns columns $colHeader = $('&lt;th&gt;').attr({role: &quot;columnheader&quot;}) .addClass(&quot;ui-state-default ui-th-column-header ui-th-&quot;+ts.p.direction) .css({'height':'22px', 'border-top': '0px none'}) .html(titleText); if(cVisibleColumns &gt; 0) { $colHeader.attr(&quot;colspan&quot;, String(cVisibleColumns)); } if (ts.p.headertitles) { $colHeader.attr(&quot;title&quot;, $colHeader.text()); } // hide if not a visible cols if( cVisibleColumns === 0) { $colHeader.hide(); } $th.before($colHeader); // insert new column header before the current $tr.append(th); // move the current header in the next row // set the coumter of headers which will be moved in the next row skip = numberOfColumns - 1; } else { if (skip === 0) { if (o.useColSpanStyle) { // expand the header height to two rows $th.attr(&quot;rowspan&quot;, &quot;2&quot;); } else { $('&lt;th&gt;', {role: &quot;columnheader&quot;}) .addClass(&quot;ui-state-default ui-th-column-header ui-th-&quot;+ts.p.direction) .css({&quot;display&quot;: cmi.hidden ? 'none' : '', 'border-top': '0px none'}) .insertBefore($th); $tr.append(th); } } else { // move the header to the next row //$th.css({&quot;padding-top&quot;: &quot;2px&quot;, height: &quot;19px&quot;}); $tr.append(th); skip--; } } } $theadInTable = $(ts).children(&quot;thead&quot;); $theadInTable.prepend($firstHeaderRow); $tr.insertAfter($trLabels); $htable.append($theadInTable); if (o.useColSpanStyle) { // Increase the height of resizing span of visible headers $htable.find(&quot;span.ui-jqgrid-resize&quot;).each(function () { var $parent = $(this).parent(); if ($parent.is(&quot;:visible&quot;)) { this.style.cssText = 'height: ' + $parent.height() + 'px !important; cursor: col-resize;'; } }); // Set position of the sortable div (the main lable) // with the column header text to the middle of the cell. // One should not do this for hidden headers. $htable.find(&quot;div.ui-jqgrid-sortable&quot;).each(function () { var $ts = $(this), $parent = $ts.parent(); if ($parent.is(&quot;:visible&quot;) &amp;&amp; $parent.is(&quot;:has(span.ui-jqgrid-resize)&quot;)) { $ts.css('top', ($parent.height() - $ts.outerHeight()) / 2 + 'px'); } }); } $firstRow = $theadInTable.find(&quot;tr.jqg-first-row-header&quot;); $(ts).bind('jqGridResizeStop.setGroupHeaders', function (e, nw, idx) { $firstRow.find('th').eq(idx).width(nw); }); }); }, setFrozenColumns : function () { return this.each(function() { if ( !this.grid ) {return;} var $t = this, cm = $t.p.colModel,i=0, len = cm.length, maxfrozen = -1, frozen= false; // TODO treeGrid and grouping Support if($t.p.subGrid === true || $t.p.treeGrid === true || $t.p.cellEdit === true || $t.p.sortable || $t.p.scroll || $t.p.grouping ) { return; } if($t.p.rownumbers) { i++; } if($t.p.multiselect) { i++; } // get the max index of frozen col while(i&lt;len) { // from left, no breaking frozen if(cm[i].frozen === true) { frozen = true; maxfrozen = i; } else { break; } i++; } if( maxfrozen&gt;=0 &amp;&amp; frozen) { var top = $t.p.caption ? $($t.grid.cDiv).outerHeight() : 0, hth = $(&quot;.ui-jqgrid-htable&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).height(); //headers if($t.p.toppager) { top = top + $($t.grid.topDiv).outerHeight(); } if($t.p.toolbar[0] === true) { if($t.p.toolbar[1] != &quot;bottom&quot;) { top = top + $($t.grid.uDiv).outerHeight(); } } $t.grid.fhDiv = $('&lt;div style=&quot;position:absolute;left:0px;top:'+top+'px;height:'+hth+'px;&quot; class=&quot;frozen-div ui-state-default ui-jqgrid-hdiv&quot;&gt;&lt;/div&gt;'); $t.grid.fbDiv = $('&lt;div style=&quot;position:absolute;left:0px;top:'+(parseInt(top,10)+parseInt(hth,10) + 1)+'px;overflow-y:hidden&quot; class=&quot;frozen-bdiv ui-jqgrid-bdiv&quot;&gt;&lt;/div&gt;'); $(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).append($t.grid.fhDiv); var htbl = $(&quot;.ui-jqgrid-htable&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).clone(true); // groupheader support - only if useColSpanstyle is false if($t.p.groupHeader) { $(&quot;tr.jqg-first-row-header, tr.jqg-third-row-header&quot;, htbl).each(function(){ $(&quot;th:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove(); }); var swapfroz = -1, fdel = -1; $(&quot;tr.jqg-second-row-header th&quot;, htbl).each(function(){ var cs= parseInt($(this).attr(&quot;colspan&quot;),10); if(cs) { swapfroz = swapfroz+cs; fdel++; } if(swapfroz === maxfrozen) { return false; } }); if(swapfroz !== maxfrozen) { fdel = maxfrozen; } $(&quot;tr.jqg-second-row-header&quot;, htbl).each(function(){ $(&quot;th:gt(&quot;+fdel+&quot;)&quot;,this).remove(); }); } else { $(&quot;tr&quot;,htbl).each(function(){ $(&quot;th:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove(); }); } $(htbl).width(1); // resizing stuff $($t.grid.fhDiv).append(htbl) .mousemove(function (e) { if($t.grid.resizing){ $t.grid.dragMove(e);return false; } }); $($t).bind('jqGridResizeStop.setFrozenColumns', function (e, w, index) { var rhth = $(&quot;.ui-jqgrid-htable&quot;,$t.grid.fhDiv); $(&quot;th:eq(&quot;+index+&quot;)&quot;,rhth).width( w ); var btd = $(&quot;.ui-jqgrid-btable&quot;,$t.grid.fbDiv); $(&quot;tr:first td:eq(&quot;+index+&quot;)&quot;,btd).width( w ); }); // sorting stuff $($t).bind('jqGridOnSortCol.setFrozenColumns', function (index, idxcol) { var previousSelectedTh = $(&quot;tr.ui-jqgrid-labels:last th:eq(&quot;+$t.p.lastsort+&quot;)&quot;,$t.grid.fhDiv), newSelectedTh = $(&quot;tr.ui-jqgrid-labels:last th:eq(&quot;+idxcol+&quot;)&quot;,$t.grid.fhDiv); $(&quot;span.ui-grid-ico-sort&quot;,previousSelectedTh).addClass('ui-state-disabled'); $(previousSelectedTh).attr(&quot;aria-selected&quot;,&quot;false&quot;); $(&quot;span.ui-icon-&quot;+$t.p.sortorder,newSelectedTh).removeClass('ui-state-disabled'); $(newSelectedTh).attr(&quot;aria-selected&quot;,&quot;true&quot;); if(!$t.p.viewsortcols[0]) { if($t.p.lastsort != idxcol) { $(&quot;span.s-ico&quot;,previousSelectedTh).hide(); $(&quot;span.s-ico&quot;,newSelectedTh).show(); } } }); // data stuff //TODO support for setRowData $(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).append($t.grid.fbDiv); jQuery($t.grid.bDiv).scroll(function () { jQuery($t.grid.fbDiv).scrollTop(jQuery(this).scrollTop()); }); if($t.p.hoverrows === true) { $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).unbind('mouseover').unbind('mouseout'); } $($t).bind('jqGridAfterGridComplete.setFrozenColumns', function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).remove(); jQuery($t.grid.fbDiv).height( jQuery($t.grid.bDiv).height()-16); var btbl = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).clone(true); $(&quot;tr&quot;,btbl).each(function(){ $(&quot;td:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove(); }); $(btbl).width(1).attr(&quot;id&quot;,$t.p.id+&quot;_frozen&quot;); $($t.grid.fbDiv).append(btbl); if($t.p.hoverrows === true) { $(&quot;tr.jqgrow&quot;, btbl).hover( function(){ $(this).addClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)).addClass(&quot;ui-state-hover&quot;); }, function(){ $(this).removeClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)).removeClass(&quot;ui-state-hover&quot;); } ); $(&quot;tr.jqgrow&quot;, &quot;#&quot;+$.jgrid.jqID($t.p.id)).hover( function(){ $(this).addClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).addClass(&quot;ui-state-hover&quot;);}, function(){ $(this).removeClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).removeClass(&quot;ui-state-hover&quot;); } ); } btbl=null; }); $t.p.frozenColumns = true; } }); }, destroyFrozenColumns : function() { return this.each(function() { if ( !this.grid ) {return;} if(this.p.frozenColumns === true) { var $t = this; $($t.grid.fhDiv).remove(); $($t.grid.fbDiv).remove(); $t.grid.fhDiv = null; $t.grid.fbDiv=null; $(this).unbind('.setFrozenColumns'); if($t.p.hoverrows === true) { var ptr; $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).bind('mouseover',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); if($(ptr).attr(&quot;class&quot;) !== &quot;ui-subgrid&quot;) { $(ptr).addClass(&quot;ui-state-hover&quot;); } }).bind('mouseout',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); $(ptr).removeClass(&quot;ui-state-hover&quot;); }); } this.p.frozenColumns = false; } }); } }); })(jQuery);/* * jqModal - Minimalist Modaling with jQuery * (http://dev.iceburg.net/jquery/jqmodal/) * * Copyright (c) 2007,2008 Brice Burgess &lt;bhb@iceburg.net&gt; * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl.html * * $Version: 07/06/2008 +r13 */ (function($) { $.fn.jqm=function(o){ var p={ overlay: 50, closeoverlay : true, overlayClass: 'jqmOverlay', closeClass: 'jqmClose', trigger: '.jqModal', ajax: F, ajaxText: '', target: F, modal: F, toTop: F, onShow: F, onHide: F, onLoad: F }; return this.each(function(){if(this._jqm)return H[this._jqm].c=$.extend({},H[this._jqm].c,o);s++;this._jqm=s; H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass('jqmID'+s),s:s}; if(p.trigger)$(this).jqmAddTrigger(p.trigger); });}; $.fn.jqmAddClose=function(e){return hs(this,e,'jqmHide');}; $.fn.jqmAddTrigger=function(e){return hs(this,e,'jqmShow');}; $.fn.jqmShow=function(t){return this.each(function(){$.jqm.open(this._jqm,t);});}; $.fn.jqmHide=function(t){return this.each(function(){$.jqm.close(this._jqm,t)});}; $.jqm = { hash:{}, open:function(s,t){var h=H[s],c=h.c,cc='.'+c.closeClass,z=(parseInt(h.w.css('z-index')));z=(z&gt;0)?z:3000;var o=$('&lt;div&gt;&lt;/div&gt;').css({height:'100%',width:'100%',position:'fixed',left:0,top:0,'z-index':z-1,opacity:c.overlay/100});if(h.a)return F;h.t=t;h.a=true;h.w.css('z-index',z); if(c.modal) {if(!A[0])setTimeout(function(){L('bind');},1);A.push(s);} else if(c.overlay &gt; 0) {if(c.closeoverlay) h.w.jqmAddClose(o);} else o=F; h.o=(o)?o.addClass(c.overlayClass).prependTo('body'):F; if(ie6){$('html,body').css({height:'100%',width:'100%'});if(o){o=o.css({position:'absolute'})[0];for(var y in {Top:1,Left:1})o.style.setExpression(y.toLowerCase(),&quot;(_=(document.documentElement.scroll&quot;+y+&quot; || document.body.scroll&quot;+y+&quot;))+'px'&quot;);}} if(c.ajax) {var r=c.target||h.w,u=c.ajax;r=(typeof r == 'string')?$(r,h.w):$(r);u=(u.substr(0,1) == '@')?$(t).attr(u.substring(1)):u; r.html(c.ajaxText).load(u,function(){if(c.onLoad)c.onLoad.call(this,h);if(cc)h.w.jqmAddClose($(cc,h.w));e(h);});} else if(cc)h.w.jqmAddClose($(cc,h.w)); if(c.toTop&amp;&amp;h.o)h.w.before('&lt;span id=&quot;jqmP'+h.w[0]._jqm+'&quot;&gt;&lt;/span&gt;').insertAfter(h.o); (c.onShow)?c.onShow(h):h.w.show();e(h);return F; }, close:function(s){var h=H[s];if(!h.a)return F;h.a=F; if(A[0]){A.pop();if(!A[0])L('unbind');} if(h.c.toTop&amp;&amp;h.o)$('#jqmP'+h.w[0]._jqm).after(h.w).remove(); if(h.c.onHide)h.c.onHide(h);else{h.w.hide();if(h.o)h.o.remove();} return F; }, params:{}}; var s=0,H=$.jqm.hash,A=[],ie6=$.browser.msie&amp;&amp;($.browser.version == &quot;6.0&quot;),F=false, e=function(h){var i=$('&lt;iframe src=&quot;javascript:false;document.write(\\'\\');&quot; class=&quot;jqm&quot;&gt;&lt;/iframe&gt;').css({opacity:0});if(ie6)if(h.o)h.o.html('&lt;p style=&quot;width:100%;height:100%&quot;/&gt;').prepend(i);else if(!$('iframe.jqm',h.w)[0])h.w.prepend(i); f(h);}, f=function(h){try{$(':input:visible',h.w)[0].focus();}catch(_){}}, L=function(t){$(document)[t](&quot;keypress&quot;,m)[t](&quot;keydown&quot;,m)[t](&quot;mousedown&quot;,m);}, m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents('.jqmID'+h.s)[0]);if(r)f(h);return !r;}, hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function() { if(!this[c]){this[c]=[];$(this).click(function(){for(var i in {jqmShow:1,jqmHide:1})for(var s in this[i])if(H[this[i][s]])H[this[i][s]].w[i](this);return F;});}this[c].push(s);});});}; })(jQuery);/* * jqDnR - Minimalistic Drag'n'Resize for jQuery. * * Copyright (c) 2007 Brice Burgess &lt;bhb@iceburg.net&gt;, http://www.iceburg.net * Licensed under the MIT License: * http://www.opensource.org/licenses/mit-license.php * * $Version: 2007.08.19 +r2 */ (function($){ $.fn.jqDrag=function(h){return i(this,h,'d');}; $.fn.jqResize=function(h,ar){return i(this,h,'r',ar);}; $.jqDnR={ dnr:{}, e:0, drag:function(v){ if(M.k == 'd'){E.css({left:M.X+v.pageX-M.pX,top:M.Y+v.pageY-M.pY});} else { E.css({width:Math.max(v.pageX-M.pX+M.W,0),height:Math.max(v.pageY-M.pY+M.H,0)}); if(M1){E1.css({width:Math.max(v.pageX-M1.pX+M1.W,0),height:Math.max(v.pageY-M1.pY+M1.H,0)});} } return false; }, stop:function(){ //E.css('opacity',M.o); $(document).unbind('mousemove',J.drag).unbind('mouseup',J.stop); } }; var J=$.jqDnR,M=J.dnr,E=J.e,E1,M1, i=function(e,h,k,aR){ return e.each(function(){ h=(h)?$(h,e):e; h.bind('mousedown',{e:e,k:k},function(v){ var d=v.data,p={};E=d.e;E1 = aR ? $(aR) : false; // attempt utilization of dimensions plugin to fix IE issues if(E.css('position') != 'relative'){try{E.position(p);}catch(e){}} M={ X:p.left||f('left')||0, Y:p.top||f('top')||0, W:f('width')||E[0].scrollWidth||0, H:f('height')||E[0].scrollHeight||0, pX:v.pageX, pY:v.pageY, k:d.k //o:E.css('opacity') }; // also resize if(E1 &amp;&amp; d.k != 'd'){ M1={ X:p.left||f1('left')||0, Y:p.top||f1('top')||0, W:E1[0].offsetWidth||f1('width')||0, H:E1[0].offsetHeight||f1('height')||0, pX:v.pageX, pY:v.pageY, k:d.k }; } else {M1 = false;} //E.css({opacity:0.8}); if($(&quot;input.hasDatepicker&quot;,E[0])[0]) { try {$(&quot;input.hasDatepicker&quot;,E[0]).datepicker('hide');}catch (dpe){} } $(document).mousemove($.jqDnR.drag).mouseup($.jqDnR.stop); return false; }); }); }, f=function(k){return parseInt(E.css(k),10)||false;}, f1=function(k){return parseInt(E1.css(k),10)||false;}; })(jQuery);/* The below work is licensed under Creative Commons GNU LGPL License. Original work: License: http://creativecommons.org/licenses/LGPL/2.1/ Author: Stefan Goessner/2006 Web: http://goessner.net/ Modifications made: Version: 0.9-p5 Description: Restructured code, JSLint validated (no strict whitespaces), added handling of empty arrays, empty strings, and int/floats values. Author: Michael SchÃ¸ler/2008-01-29 Web: http://michael.hinnerup.net/blog/2008/01/26/converting-json-to-xml-and-xml-to-json/ Description: json2xml added support to convert functions as CDATA so it will be easy to write characters that cause some problems when convert Author: Tony Tomov */ /*global alert */ var xmlJsonClass = { // Param &quot;xml&quot;: Element or document DOM node. // Param &quot;tab&quot;: Tab or indent string for pretty output formatting omit or use empty string &quot;&quot; to supress. // Returns: JSON string xml2json: function(xml, tab) { if (xml.nodeType === 9) { // document node xml = xml.documentElement; } var nws = this.removeWhite(xml); var obj = this.toObj(nws); var json = this.toJson(obj, xml.nodeName, &quot;\\t&quot;); return &quot;{\\n&quot; + tab + (tab ? json.replace(/\\t/g, tab) : json.replace(/\\t|\\n/g, &quot;&quot;)) + &quot;\\n}&quot;; }, // Param &quot;o&quot;: JavaScript object // Param &quot;tab&quot;: tab or indent string for pretty output formatting omit or use empty string &quot;&quot; to supress. // Returns: XML string json2xml: function(o, tab) { var toXml = function(v, name, ind) { var xml = &quot;&quot;; var i, n; if (v instanceof Array) { if (v.length === 0) { xml += ind + &quot;&lt;&quot;+name+&quot;&gt;__EMPTY_ARRAY_&lt;/&quot;+name+&quot;&gt;\\n&quot;; } else { for (i = 0, n = v.length; i &lt; n; i += 1) { var sXml = ind + toXml(v[i], name, ind+&quot;\\t&quot;) + &quot;\\n&quot;; xml += sXml; } } } else if (typeof(v) === &quot;object&quot;) { var hasChild = false; xml += ind + &quot;&lt;&quot; + name; var m; for (m in v) if (v.hasOwnProperty(m)) { if (m.charAt(0) === &quot;@&quot;) { xml += &quot; &quot; + m.substr(1) + &quot;=\\&quot;&quot; + v[m].toString() + &quot;\\&quot;&quot;; } else { hasChild = true; } } xml += hasChild ? &quot;&gt;&quot; : &quot;/&gt;&quot;; if (hasChild) { for (m in v) if (v.hasOwnProperty(m)) { if (m === &quot;#text&quot;) { xml += v[m]; } else if (m === &quot;#cdata&quot;) { xml += &quot;&lt;![CDATA[&quot; + v[m] + &quot;]]&gt;&quot;; } else if (m.charAt(0) !== &quot;@&quot;) { xml += toXml(v[m], m, ind+&quot;\\t&quot;); } } xml += (xml.charAt(xml.length - 1) === &quot;\\n&quot; ? ind : &quot;&quot;) + &quot;&lt;/&quot; + name + &quot;&gt;&quot;; } } else if (typeof(v) === &quot;function&quot;) { xml += ind + &quot;&lt;&quot; + name + &quot;&gt;&quot; + &quot;&lt;![CDATA[&quot; + v + &quot;]]&gt;&quot; + &quot;&lt;/&quot; + name + &quot;&gt;&quot;; } else { if (v === undefined ) { v = &quot;&quot;; } if (v.toString() === &quot;\\&quot;\\&quot;&quot; || v.toString().length === 0) { xml += ind + &quot;&lt;&quot; + name + &quot;&gt;__EMPTY_STRING_&lt;/&quot; + name + &quot;&gt;&quot;; } else { xml += ind + &quot;&lt;&quot; + name + &quot;&gt;&quot; + v.toString() + &quot;&lt;/&quot; + name + &quot;&gt;&quot;; } } return xml; }; var xml = &quot;&quot;; var m; for (m in o) if (o.hasOwnProperty(m)) { xml += toXml(o[m], m, &quot;&quot;); } return tab ? xml.replace(/\\t/g, tab) : xml.replace(/\\t|\\n/g, &quot;&quot;); }, // Internal methods toObj: function(xml) { var o = {}; var FuncTest = /function/i; if (xml.nodeType === 1) { // element node .. if (xml.attributes.length) { // element with attributes .. var i; for (i = 0; i &lt; xml.attributes.length; i += 1) { o[&quot;@&quot; + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || &quot;&quot;).toString(); } } if (xml.firstChild) { // element has child nodes .. var textChild = 0, cdataChild = 0, hasElementChild = false; var n; for (n = xml.firstChild; n; n = n.nextSibling) { if (n.nodeType === 1) { hasElementChild = true; } else if (n.nodeType === 3 &amp;&amp; n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) { // non-whitespace text textChild += 1; } else if (n.nodeType === 4) { // cdata section node cdataChild += 1; } } if (hasElementChild) { if (textChild &lt; 2 &amp;&amp; cdataChild &lt; 2) { // structured element with evtl. a single text or/and cdata node .. this.removeWhite(xml); for (n = xml.firstChild; n; n = n.nextSibling) { if (n.nodeType === 3) { // text node o[&quot;#text&quot;] = this.escape(n.nodeValue); } else if (n.nodeType === 4) { // cdata node if (FuncTest.test(n.nodeValue)) { o[n.nodeName] = [o[n.nodeName], n.nodeValue]; } else { o[&quot;#cdata&quot;] = this.escape(n.nodeValue); } } else if (o[n.nodeName]) { // multiple occurence of element .. if (o[n.nodeName] instanceof Array) { o[n.nodeName][o[n.nodeName].length] = this.toObj(n); } else { o[n.nodeName] = [o[n.nodeName], this.toObj(n)]; } } else { // first occurence of element .. o[n.nodeName] = this.toObj(n); } } } else { // mixed content if (!xml.attributes.length) { o = this.escape(this.innerXml(xml)); } else { o[&quot;#text&quot;] = this.escape(this.innerXml(xml)); } } } else if (textChild) { // pure text if (!xml.attributes.length) { o = this.escape(this.innerXml(xml)); if (o === &quot;__EMPTY_ARRAY_&quot;) { o = &quot;[]&quot;; } else if (o === &quot;__EMPTY_STRING_&quot;) { o = &quot;&quot;; } } else { o[&quot;#text&quot;] = this.escape(this.innerXml(xml)); } } else if (cdataChild) { // cdata if (cdataChild &gt; 1) { o = this.escape(this.innerXml(xml)); } else { for (n = xml.firstChild; n; n = n.nextSibling) { if(FuncTest.test(xml.firstChild.nodeValue)) { o = xml.firstChild.nodeValue; break; } else { o[&quot;#cdata&quot;] = this.escape(n.nodeValue); } } } } } if (!xml.attributes.length &amp;&amp; !xml.firstChild) { o = null; } } else if (xml.nodeType === 9) { // document.node o = this.toObj(xml.documentElement); } else { alert(&quot;unhandled node type: &quot; + xml.nodeType); } return o; }, toJson: function(o, name, ind, wellform) { if(wellform === undefined) wellform = true; var json = name ? (&quot;\\&quot;&quot; + name + &quot;\\&quot;&quot;) : &quot;&quot;, tab = &quot;\\t&quot;, newline = &quot;\\n&quot;; if(!wellform) { tab= &quot;&quot;; newline= &quot;&quot;; } if (o === &quot;[]&quot;) { json += (name ? &quot;:[]&quot; : &quot;[]&quot;); } else if (o instanceof Array) { var n, i, ar=[]; for (i = 0, n = o.length; i &lt; n; i += 1) { ar[i] = this.toJson(o[i], &quot;&quot;, ind + tab, wellform); } json += (name ? &quot;:[&quot; : &quot;[&quot;) + (ar.length &gt; 1 ? (newline + ind + tab + ar.join(&quot;,&quot;+newline + ind + tab) + newline + ind) : ar.join(&quot;&quot;)) + &quot;]&quot;; } else if (o === null) { json += (name &amp;&amp; &quot;:&quot;) + &quot;null&quot;; } else if (typeof(o) === &quot;object&quot;) { var arr = [], m; for (m in o) { if (o.hasOwnProperty(m)) { arr[arr.length] = this.toJson(o[m], m, ind + tab, wellform); } } json += (name ? &quot;:{&quot; : &quot;{&quot;) + (arr.length &gt; 1 ? (newline + ind + tab + arr.join(&quot;,&quot;+newline + ind + tab) + newline + ind) : arr.join(&quot;&quot;)) + &quot;}&quot;; } else if (typeof(o) === &quot;string&quot;) { /* var objRegExp = /(^-?\\d+\\.?\\d*$)/; var FuncTest = /function/i; var os = o.toString(); if (objRegExp.test(os) || FuncTest.test(os) || os===&quot;false&quot; || os===&quot;true&quot;) { // int or float json += (name &amp;&amp; &quot;:&quot;) + &quot;\\&quot;&quot; +os + &quot;\\&quot;&quot;; } else { */ json += (name &amp;&amp; &quot;:&quot;) + &quot;\\&quot;&quot; + o.replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;') + &quot;\\&quot;&quot;; //} } else { json += (name &amp;&amp; &quot;:&quot;) + o.toString(); } return json; }, innerXml: function(node) { var s = &quot;&quot;; if (&quot;innerHTML&quot; in node) { s = node.innerHTML; } else { var asXml = function(n) { var s = &quot;&quot;, i; if (n.nodeType === 1) { s += &quot;&lt;&quot; + n.nodeName; for (i = 0; i &lt; n.attributes.length; i += 1) { s += &quot; &quot; + n.attributes[i].nodeName + &quot;=\\&quot;&quot; + (n.attributes[i].nodeValue || &quot;&quot;).toString() + &quot;\\&quot;&quot;; } if (n.firstChild) { s += &quot;&gt;&quot;; for (var c = n.firstChild; c; c = c.nextSibling) { s += asXml(c); } s += &quot;&lt;/&quot; + n.nodeName + &quot;&gt;&quot;; } else { s += &quot;/&gt;&quot;; } } else if (n.nodeType === 3) { s += n.nodeValue; } else if (n.nodeType === 4) { s += &quot;&lt;![CDATA[&quot; + n.nodeValue + &quot;]]&gt;&quot;; } return s; }; for (var c = node.firstChild; c; c = c.nextSibling) { s += asXml(c); } } return s; }, escape: function(txt) { return txt.replace(/[\\\\]/g, &quot;\\\\\\\\&quot;).replace(/[\\&quot;]/g, '\\\\&quot;').replace(/[\\n]/g, '\\\\n').replace(/[\\r]/g, '\\\\r'); }, removeWhite: function(e) { e.normalize(); var n; for (n = e.firstChild; n; ) { if (n.nodeType === 3) { // text node if (!n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) { // pure whitespace text node var nxt = n.nextSibling; e.removeChild(n); n = nxt; } else { n = n.nextSibling; } } else if (n.nodeType === 1) { // element node this.removeWhite(n); n = n.nextSibling; } else { // any other node n = n.nextSibling; } } return e; } };/* ** * formatter for values but most of the values if for jqGrid * Some of this was inspired and based on how YUI does the table datagrid but in jQuery fashion * we are trying to keep it as light as possible * Joshua Burnett josh@9ci.com * http://www.greenbill.com * * Changes from Tony Tomov tony@trirand.com * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * **/ ;(function($) { &quot;use strict&quot;; $.fmatter = {}; //opts can be id:row id for the row, rowdata:the data for the row, colmodel:the column model for this column //example {id:1234,} $.extend($.fmatter,{ isBoolean : function(o) { return typeof o === 'boolean'; }, isObject : function(o) { return (o &amp;&amp; (typeof o === 'object' || $.isFunction(o))) || false; }, isString : function(o) { return typeof o === 'string'; }, isNumber : function(o) { return typeof o === 'number' &amp;&amp; isFinite(o); }, isNull : function(o) { return o === null; }, isUndefined : function(o) { return typeof o === 'undefined'; }, isValue : function (o) { return (this.isObject(o) || this.isString(o) || this.isNumber(o) || this.isBoolean(o)); }, isEmpty : function(o) { if(!this.isString(o) &amp;&amp; this.isValue(o)) { return false; }else if (!this.isValue(o)){ return true; } o = $.trim(o).replace(/\\&amp;nbsp\\;/ig,'').replace(/\\&amp;#160\\;/ig,''); return o===&quot;&quot;; } }); $.fn.fmatter = function(formatType, cellval, opts, rwd, act) { // build main options before element iteration var v=cellval; opts = $.extend({}, $.jgrid.formatter, opts); try { v = $.fn.fmatter[formatType].call(this, cellval, opts, rwd, act); } catch(fe){} return v; }; $.fmatter.util = { // Taken from YAHOO utils NumberFormat : function(nData,opts) { if(!$.fmatter.isNumber(nData)) { nData *= 1; } if($.fmatter.isNumber(nData)) { var bNegative = (nData &lt; 0); var sOutput = nData + &quot;&quot;; var sDecimalSeparator = (opts.decimalSeparator) ? opts.decimalSeparator : &quot;.&quot;; var nDotIndex; if($.fmatter.isNumber(opts.decimalPlaces)) { // Round to the correct decimal place var nDecimalPlaces = opts.decimalPlaces; var nDecimal = Math.pow(10, nDecimalPlaces); sOutput = Math.round(nData*nDecimal)/nDecimal + &quot;&quot;; nDotIndex = sOutput.lastIndexOf(&quot;.&quot;); if(nDecimalPlaces &gt; 0) { // Add the decimal separator if(nDotIndex &lt; 0) { sOutput += sDecimalSeparator; nDotIndex = sOutput.length-1; } // Replace the &quot;.&quot; else if(sDecimalSeparator !== &quot;.&quot;){ sOutput = sOutput.replace(&quot;.&quot;,sDecimalSeparator); } // Add missing zeros while((sOutput.length - 1 - nDotIndex) &lt; nDecimalPlaces) { sOutput += &quot;0&quot;; } } } if(opts.thousandsSeparator) { var sThousandsSeparator = opts.thousandsSeparator; nDotIndex = sOutput.lastIndexOf(sDecimalSeparator); nDotIndex = (nDotIndex &gt; -1) ? nDotIndex : sOutput.length; var sNewOutput = sOutput.substring(nDotIndex); var nCount = -1; for (var i=nDotIndex; i&gt;0; i--) { nCount++; if ((nCount%3 === 0) &amp;&amp; (i !== nDotIndex) &amp;&amp; (!bNegative || (i &gt; 1))) { sNewOutput = sThousandsSeparator + sNewOutput; } sNewOutput = sOutput.charAt(i-1) + sNewOutput; } sOutput = sNewOutput; } // Prepend prefix sOutput = (opts.prefix) ? opts.prefix + sOutput : sOutput; // Append suffix sOutput = (opts.suffix) ? sOutput + opts.suffix : sOutput; return sOutput; } else { return nData; } }, // Tony Tomov // PHP implementation. Sorry not all options are supported. // Feel free to add them if you want DateFormat : function (format, date, newformat, opts) { var token = /\\\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g, timezone = /\\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\\d{4})?)\\b/g, timezoneClip = /[^-+\\dA-Z]/g, msDateRegExp = new RegExp(&quot;^\\/Date\\\\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\\\\)\\/$&quot;), msMatch = ((typeof date === 'string') ? date.match(msDateRegExp): null), pad = function (value, length) { value = String(value); length = parseInt(length,10) || 2; while (value.length &lt; length) { value = '0' + value; } return value; }, ts = {m : 1, d : 1, y : 1970, h : 0, i : 0, s : 0, u:0}, timestamp=0, dM, k,hl, dateFormat=[&quot;i18n&quot;]; // Internationalization strings dateFormat.i18n = { dayNames: opts.dayNames, monthNames: opts.monthNames }; if( format in opts.masks ) { format = opts.masks[format]; } if( !isNaN( date - 0 ) &amp;&amp; String(format).toLowerCase() == &quot;u&quot;) { //Unix timestamp timestamp = new Date( parseFloat(date)*1000 ); } else if(date.constructor === Date) { timestamp = date; // Microsoft date format support } else if( msMatch !== null ) { timestamp = new Date(parseInt(msMatch[1], 10)); if (msMatch[3]) { var offset = Number(msMatch[5]) * 60 + Number(msMatch[6]); offset *= ((msMatch[4] == '-') ? 1 : -1); offset -= timestamp.getTimezoneOffset(); timestamp.setTime(Number(Number(timestamp) + (offset * 60 * 1000))); } } else { date = String(date).split(/[\\\\\\/:_;.,\\t\\T\\s-]/); format = format.split(/[\\\\\\/:_;.,\\t\\T\\s-]/); // parsing for month names for(k=0,hl=format.length;k&lt;hl;k++){ if(format[k] == 'M') { dM = $.inArray(date[k],dateFormat.i18n.monthNames); if(dM !== -1 &amp;&amp; dM &lt; 12){date[k] = dM+1;} } if(format[k] == 'F') { dM = $.inArray(date[k],dateFormat.i18n.monthNames); if(dM !== -1 &amp;&amp; dM &gt; 11){date[k] = dM+1-12;} } if(date[k]) { ts[format[k].toLowerCase()] = parseInt(date[k],10); } } if(ts.f) {ts.m = ts.f;} if( ts.m === 0 &amp;&amp; ts.y === 0 &amp;&amp; ts.d === 0) { return &quot;&amp;#160;&quot; ; } ts.m = parseInt(ts.m,10)-1; var ty = ts.y; if (ty &gt;= 70 &amp;&amp; ty &lt;= 99) {ts.y = 1900+ts.y;} else if (ty &gt;=0 &amp;&amp; ty &lt;=69) {ts.y= 2000+ts.y;} timestamp = new Date(ts.y, ts.m, ts.d, ts.h, ts.i, ts.s, ts.u); } if( newformat in opts.masks ) { newformat = opts.masks[newformat]; } else if ( !newformat ) { newformat = 'Y-m-d'; } var G = timestamp.getHours(), i = timestamp.getMinutes(), j = timestamp.getDate(), n = timestamp.getMonth() + 1, o = timestamp.getTimezoneOffset(), s = timestamp.getSeconds(), u = timestamp.getMilliseconds(), w = timestamp.getDay(), Y = timestamp.getFullYear(), N = (w + 6) % 7 + 1, z = (new Date(Y, n - 1, j) - new Date(Y, 0, 1)) / 86400000, flags = { // Day d: pad(j), D: dateFormat.i18n.dayNames[w], j: j, l: dateFormat.i18n.dayNames[w + 7], N: N, S: opts.S(j), //j &lt; 11 || j &gt; 13 ? ['st', 'nd', 'rd', 'th'][Math.min((j - 1) % 10, 3)] : 'th', w: w, z: z, // Week W: N &lt; 5 ? Math.floor((z + N - 1) / 7) + 1 : Math.floor((z + N - 1) / 7) || ((new Date(Y - 1, 0, 1).getDay() + 6) % 7 &lt; 4 ? 53 : 52), // Month F: dateFormat.i18n.monthNames[n - 1 + 12], m: pad(n), M: dateFormat.i18n.monthNames[n - 1], n: n, t: '?', // Year L: '?', o: '?', Y: Y, y: String(Y).substring(2), // Time a: G &lt; 12 ? opts.AmPm[0] : opts.AmPm[1], A: G &lt; 12 ? opts.AmPm[2] : opts.AmPm[3], B: '?', g: G % 12 || 12, G: G, h: pad(G % 12 || 12), H: pad(G), i: pad(i), s: pad(s), u: u, // Timezone e: '?', I: '?', O: (o &gt; 0 ? &quot;-&quot; : &quot;+&quot;) + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4), P: '?', T: (String(timestamp).match(timezone) || [&quot;&quot;]).pop().replace(timezoneClip, &quot;&quot;), Z: '?', // Full Date/Time c: '?', r: '?', U: Math.floor(timestamp / 1000) }; return newformat.replace(token, function ($0) { return $0 in flags ? flags[$0] : $0.substring(1); }); } }; $.fn.fmatter.defaultFormat = function(cellval, opts) { return ($.fmatter.isValue(cellval) &amp;&amp; cellval!==&quot;&quot; ) ? cellval : opts.defaultValue ? opts.defaultValue : &quot;&amp;#160;&quot;; }; $.fn.fmatter.email = function(cellval, opts) { if(!$.fmatter.isEmpty(cellval)) { return &quot;&lt;a href=\\&quot;mailto:&quot; + cellval + &quot;\\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;; }else { return $.fn.fmatter.defaultFormat(cellval,opts ); } }; $.fn.fmatter.checkbox =function(cval, opts) { var op = $.extend({},opts.checkbox), ds; if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(op.disabled===true) {ds = &quot;disabled=\\&quot;disabled\\&quot;&quot;;} else {ds=&quot;&quot;;} if($.fmatter.isEmpty(cval) || $.fmatter.isUndefined(cval) ) {cval = $.fn.fmatter.defaultFormat(cval,op);} cval=cval+&quot;&quot;;cval=cval.toLowerCase(); var bchk = cval.search(/(false|0|no|off)/i)&lt;0 ? &quot; checked='checked' &quot; : &quot;&quot;; return &quot;&lt;input type=\\&quot;checkbox\\&quot; &quot; + bchk + &quot; value=\\&quot;&quot;+ cval+&quot;\\&quot; offval=\\&quot;no\\&quot; &quot;+ds+ &quot;/&gt;&quot;; }; $.fn.fmatter.link = function(cellval, opts) { var op = {target:opts.target}; var target = &quot;&quot;; if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(op.target) {target = 'target=' + op.target;} if(!$.fmatter.isEmpty(cellval)) { return &quot;&lt;a &quot;+target+&quot; href=\\&quot;&quot; + cellval + &quot;\\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;; }else { return $.fn.fmatter.defaultFormat(cellval,opts); } }; $.fn.fmatter.showlink = function(cellval, opts) { var op = {baseLinkUrl: opts.baseLinkUrl,showAction:opts.showAction, addParam: opts.addParam || &quot;&quot;, target: opts.target, idName: opts.idName}, target = &quot;&quot;, idUrl; if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(op.target) {target = 'target=' + op.target;} idUrl = op.baseLinkUrl+op.showAction + '?'+ op.idName+'='+opts.rowId+op.addParam; if($.fmatter.isString(cellval) || $.fmatter.isNumber(cellval)) { //add this one even if its blank string return &quot;&lt;a &quot;+target+&quot; href=\\&quot;&quot; + idUrl + &quot;\\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;; }else { return $.fn.fmatter.defaultFormat(cellval,opts); } }; $.fn.fmatter.integer = function(cellval, opts) { var op = $.extend({},opts.integer); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if($.fmatter.isEmpty(cellval)) { return op.defaultValue; } return $.fmatter.util.NumberFormat(cellval,op); }; $.fn.fmatter.number = function (cellval, opts) { var op = $.extend({},opts.number); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if($.fmatter.isEmpty(cellval)) { return op.defaultValue; } return $.fmatter.util.NumberFormat(cellval,op); }; $.fn.fmatter.currency = function (cellval, opts) { var op = $.extend({},opts.currency); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if($.fmatter.isEmpty(cellval)) { return op.defaultValue; } return $.fmatter.util.NumberFormat(cellval,op); }; $.fn.fmatter.date = function (cellval, opts, rwd, act) { var op = $.extend({},opts.date); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(!op.reformatAfterEdit &amp;&amp; act=='edit'){ return $.fn.fmatter.defaultFormat(cellval, opts); } else if(!$.fmatter.isEmpty(cellval)) { return $.fmatter.util.DateFormat(op.srcformat,cellval,op.newformat,op); } else { return $.fn.fmatter.defaultFormat(cellval, opts); } }; $.fn.fmatter.select = function (cellval,opts) { // jqGrid specific cellval = cellval + &quot;&quot;; var oSelect = false, ret=[], sep, delim; if(!$.fmatter.isUndefined(opts.colModel.formatoptions)){ oSelect= opts.colModel.formatoptions.value; sep = opts.colModel.formatoptions.separator === undefined ? &quot;:&quot; : opts.colModel.formatoptions.separator; delim = opts.colModel.formatoptions.delimiter === undefined ? &quot;;&quot; : opts.colModel.formatoptions.delimiter; } else if(!$.fmatter.isUndefined(opts.colModel.editoptions)){ oSelect= opts.colModel.editoptions.value; sep = opts.colModel.editoptions.separator === undefined ? &quot;:&quot; : opts.colModel.editoptions.separator; delim = opts.colModel.editoptions.delimiter === undefined ? &quot;;&quot; : opts.colModel.editoptions.delimiter; } if (oSelect) { var msl = opts.colModel.editoptions.multiple === true ? true : false, scell = [], sv; if(msl) {scell = cellval.split(&quot;,&quot;);scell = $.map(scell,function(n){return $.trim(n);});} if ($.fmatter.isString(oSelect)) { // mybe here we can use some caching with care ???? var so = oSelect.split(delim), j=0; for(var i=0; i&lt;so.length;i++){ sv = so[i].split(sep); if(sv.length &gt; 2 ) { sv[1] = $.map(sv,function(n,i){if(i&gt;0) {return n;}}).join(sep); } if(msl) { if($.inArray(sv[0],scell)&gt;-1) { ret[j] = sv[1]; j++; } } else if($.trim(sv[0])==$.trim(cellval)) { ret[0] = sv[1]; break; } } } else if($.fmatter.isObject(oSelect)) { // this is quicker if(msl) { ret = $.map(scell, function(n){ return oSelect[n]; }); } else { ret[0] = oSelect[cellval] || &quot;&quot;; } } } cellval = ret.join(&quot;, &quot;); return cellval === &quot;&quot; ? $.fn.fmatter.defaultFormat(cellval,opts) : cellval; }; $.fn.fmatter.rowactions = function(rid,gid,act,pos) { var op ={ keys:false, onEdit : null, onSuccess: null, afterSave:null, onError: null, afterRestore: null, extraparam: {}, url: null, restoreAfterError: true, mtype: &quot;POST&quot;, delOptions: {}, editOptions : {} }; rid = $.jgrid.jqID( rid ); gid = $.jgrid.jqID( gid ); var cm = $('#'+gid)[0].p.colModel[pos]; if(!$.fmatter.isUndefined(cm.formatoptions)) { op = $.extend(op,cm.formatoptions); } if( !$.fmatter.isUndefined($('#'+gid)[0].p.editOptions) ) { op.editOptions = $('#'+gid)[0].p.editOptions; } if( !$.fmatter.isUndefined($('#'+gid)[0].p.delOptions) ) { op.delOptions = $('#'+gid)[0].p.delOptions; } var $t = $(&quot;#&quot;+gid)[0]; var saverow = function( rowid, res) { if($.isFunction(op.afterSave)) { op.afterSave.call($t, rowid, res); } $(&quot;tr#&quot;+rid+&quot; div.ui-inline-edit, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-del&quot;,&quot;#&quot;+gid + &quot;.ui-jqgrid-btable:first&quot;).show(); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-save, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-cancel&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).hide(); }, restorerow = function( rowid) { if($.isFunction(op.afterRestore) ) { op.afterRestore.call($t, rowid); } $(&quot;tr#&quot;+rid+&quot; div.ui-inline-edit, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-del&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).show(); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-save, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-cancel&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).hide(); }; if( $(&quot;#&quot;+rid,&quot;#&quot;+gid).hasClass(&quot;jqgrid-new-row&quot;) ){ var opers = $t.p.prmNames, oper = opers.oper; op.extraparam[oper] = opers.addoper; } var actop = { keys : op.keys, oneditfunc: op.onEdit, successfunc: op.onSuccess, url: op.url, extraparam: op.extraparam, aftersavefunc: saverow, errorfunc: op.onError, afterrestorefunc: restorerow, restoreAfterError: op.restoreAfterError, mtype: op.mtype }; switch(act) { case 'edit': $('#'+gid).jqGrid('editRow', rid, actop); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-edit, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-del&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).hide(); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-save, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-cancel&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).show(); $($t).triggerHandler(&quot;jqGridAfterGridComplete&quot;); break; case 'save': if ( $('#'+gid).jqGrid('saveRow', rid, actop) ) { $(&quot;tr#&quot;+rid+&quot; div.ui-inline-edit, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-del&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).show(); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-save, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-cancel&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).hide(); $($t).triggerHandler(&quot;jqGridAfterGridComplete&quot;); } break; case 'cancel' : $('#'+gid).jqGrid('restoreRow',rid, restorerow); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-edit, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-del&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).show(); $(&quot;tr#&quot;+rid+&quot; div.ui-inline-save, &quot;+&quot;tr#&quot;+rid+&quot; div.ui-inline-cancel&quot;,&quot;#&quot;+gid+ &quot;.ui-jqgrid-btable:first&quot;).hide(); $($t).triggerHandler(&quot;jqGridAfterGridComplete&quot;); break; case 'del': $('#'+gid).jqGrid('delGridRow',rid, op.delOptions); break; case 'formedit': $('#'+gid).jqGrid('setSelection',rid); $('#'+gid).jqGrid('editGridRow',rid, op.editOptions); break; } }; $.fn.fmatter.actions = function(cellval,opts) { var op ={keys:false, editbutton:true, delbutton:true, editformbutton: false}; if(!$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend(op,opts.colModel.formatoptions); } var rowid = opts.rowId, str=&quot;&quot;,ocl; if(typeof(rowid) =='undefined' || $.fmatter.isEmpty(rowid)) {return &quot;&quot;;} if(op.editformbutton){ ocl = &quot;onclick=jQuery.fn.fmatter.rowactions('&quot;+rowid+&quot;','&quot;+opts.gid+&quot;','formedit',&quot;+opts.pos+&quot;); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str =str+ &quot;&lt;div title='&quot;+$.jgrid.nav.edittitle+&quot;' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-pencil'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; } else if(op.editbutton){ ocl = &quot;onclick=jQuery.fn.fmatter.rowactions('&quot;+rowid+&quot;','&quot;+opts.gid+&quot;','edit',&quot;+opts.pos+&quot;); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover') &quot;; str =str+ &quot;&lt;div title='&quot;+$.jgrid.nav.edittitle+&quot;' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-pencil'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; } if(op.delbutton) { ocl = &quot;onclick=jQuery.fn.fmatter.rowactions('&quot;+rowid+&quot;','&quot;+opts.gid+&quot;','del',&quot;+opts.pos+&quot;); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str = str+&quot;&lt;div title='&quot;+$.jgrid.nav.deltitle+&quot;' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-trash'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; } ocl = &quot;onclick=jQuery.fn.fmatter.rowactions('&quot;+rowid+&quot;','&quot;+opts.gid+&quot;','save',&quot;+opts.pos+&quot;); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str = str+&quot;&lt;div title='&quot;+$.jgrid.edit.bSubmit+&quot;' style='float:left;display:none' class='ui-pg-div ui-inline-save' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-disk'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; ocl = &quot;onclick=jQuery.fn.fmatter.rowactions('&quot;+rowid+&quot;','&quot;+opts.gid+&quot;','cancel',&quot;+opts.pos+&quot;); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str = str+&quot;&lt;div title='&quot;+$.jgrid.edit.bCancel+&quot;' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-cancel'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; return &quot;&lt;div style='margin-left:8px;'&gt;&quot; + str + &quot;&lt;/div&gt;&quot;; }; $.unformat = function (cellval,options,pos,cnt) { // specific for jqGrid only var ret, formatType = options.colModel.formatter, op =options.colModel.formatoptions || {}, sep, re = /([\\.\\*\\_\\'\\(\\)\\{\\}\\+\\?\\\\])/g, unformatFunc = options.colModel.unformat||($.fn.fmatter[formatType] &amp;&amp; $.fn.fmatter[formatType].unformat); if(typeof unformatFunc !== 'undefined' &amp;&amp; $.isFunction(unformatFunc) ) { ret = unformatFunc.call(this, $(cellval).text(), options, cellval); } else if(!$.fmatter.isUndefined(formatType) &amp;&amp; $.fmatter.isString(formatType) ) { var opts = $.jgrid.formatter || {}, stripTag; switch(formatType) { case 'integer' : op = $.extend({},opts.integer,op); sep = op.thousandsSeparator.replace(re,&quot;\\\\$1&quot;); stripTag = new RegExp(sep, &quot;g&quot;); ret = $(cellval).text().replace(stripTag,''); break; case 'number' : op = $.extend({},opts.number,op); sep = op.thousandsSeparator.replace(re,&quot;\\\\$1&quot;); stripTag = new RegExp(sep, &quot;g&quot;); ret = $(cellval).text().replace(stripTag,&quot;&quot;).replace(op.decimalSeparator,'.'); break; case 'currency': op = $.extend({},opts.currency,op); sep = op.thousandsSeparator.replace(re,&quot;\\\\$1&quot;); stripTag = new RegExp(sep, &quot;g&quot;); ret = $(cellval).text(); if (op.prefix &amp;&amp; op.prefix.length) { ret = ret.substr(op.prefix.length); } if (op.suffix &amp;&amp; op.suffix.length) { ret = ret.substr(0, ret.length - op.suffix.length); } ret = ret.replace(stripTag,'').replace(op.decimalSeparator,'.'); break; case 'checkbox': var cbv = (options.colModel.editoptions) ? options.colModel.editoptions.value.split(&quot;:&quot;) : [&quot;Yes&quot;,&quot;No&quot;]; ret = $('input',cellval).is(&quot;:checked&quot;) ? cbv[0] : cbv[1]; break; case 'select' : ret = $.unformat.select(cellval,options,pos,cnt); break; case 'actions': return &quot;&quot;; default: ret= $(cellval).text(); } } return ret !== undefined ? ret : cnt===true ? $(cellval).text() : $.jgrid.htmlDecode($(cellval).html()); }; $.unformat.select = function (cellval,options,pos,cnt) { // Spacial case when we have local data and perform a sort // cnt is set to true only in sortDataArray var ret = []; var cell = $(cellval).text(); if(cnt===true) {return cell;} var op = $.extend({}, !$.fmatter.isUndefined(options.colModel.formatoptions) ? options.colModel.formatoptions: options.colModel.editoptions), sep = op.separator === undefined ? &quot;:&quot; : op.separator, delim = op.delimiter === undefined ? &quot;;&quot; : op.delimiter; if(op.value){ var oSelect = op.value, msl = op.multiple === true ? true : false, scell = [], sv; if(msl) {scell = cell.split(&quot;,&quot;);scell = $.map(scell,function(n){return $.trim(n);});} if ($.fmatter.isString(oSelect)) { var so = oSelect.split(delim), j=0; for(var i=0; i&lt;so.length;i++){ sv = so[i].split(sep); if(sv.length &gt; 2 ) { sv[1] = $.map(sv,function(n,i){if(i&gt;0) {return n;}}).join(sep); } if(msl) { if($.inArray(sv[1],scell)&gt;-1) { ret[j] = sv[0]; j++; } } else if($.trim(sv[1])==$.trim(cell)) { ret[0] = sv[0]; break; } } } else if($.fmatter.isObject(oSelect) || $.isArray(oSelect) ){ if(!msl) {scell[0] = cell;} ret = $.map(scell, function(n){ var rv; $.each(oSelect, function(i,val){ if (val == n) { rv = i; return false; } }); if( typeof(rv) != 'undefined' ) {return rv;} }); } return ret.join(&quot;, &quot;); } else { return cell || &quot;&quot;; } }; $.unformat.date = function (cellval, opts) { var op = $.jgrid.formatter.date || {}; if(!$.fmatter.isUndefined(opts.formatoptions)) { op = $.extend({},op,opts.formatoptions); } if(!$.fmatter.isEmpty(cellval)) { return $.fmatter.util.DateFormat(op.newformat,cellval,op.srcformat,op); } else { return $.fn.fmatter.defaultFormat(cellval, opts); } }; })(jQuery); ;(function($){ /* * jqGrid common function * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html */ /*global jQuery, $ */ $.extend($.jgrid,{ // Modal functions showModal : function(h) { h.w.show(); }, closeModal : function(h) { h.w.hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;); if(h.o) {h.o.remove();} }, hideModal : function (selector,o) { o = $.extend({jqm : true, gb :''}, o || {}); if(o.onClose) { var oncret = o.onClose(selector); if (typeof oncret == 'boolean' &amp;&amp; !oncret ) { return; } } if ($.fn.jqm &amp;&amp; o.jqm === true) { $(selector).attr(&quot;aria-hidden&quot;,&quot;true&quot;).jqmHide(); } else { if(o.gb !== '') { try {$(&quot;.jqgrid-overlay:first&quot;,o.gb).hide();} catch (e){} } $(selector).hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;); } }, //Helper functions findPos : function(obj) { var curleft = 0, curtop = 0; if (obj.offsetParent) { do { curleft += obj.offsetLeft; curtop += obj.offsetTop; } while (obj = obj.offsetParent); //do not change obj == obj.offsetParent } return [curleft,curtop]; }, createModal : function(aIDs, content, p, insertSelector, posSelector, appendsel, css) { p = $.extend(true, $.jgrid.jqModal || {}, p); var mw = document.createElement('div'), rtlsup, self = this; css = $.extend({}, css || {}); rtlsup = $(p.gbox).attr(&quot;dir&quot;) == &quot;rtl&quot; ? true : false; mw.className= &quot;ui-widget ui-widget-content ui-corner-all ui-jqdialog&quot;; mw.id = aIDs.themodal; var mh = document.createElement('div'); mh.className = &quot;ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix&quot;; mh.id = aIDs.modalhead; $(mh).append(&quot;&lt;span class='ui-jqdialog-title'&gt;&quot;+p.caption+&quot;&lt;/span&gt;&quot;); var ahr= $(&quot;&lt;a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'&gt;&lt;/a&gt;&quot;) .hover(function(){ahr.addClass('ui-state-hover');}, function(){ahr.removeClass('ui-state-hover');}) .append(&quot;&lt;span class='ui-icon ui-icon-closethick'&gt;&lt;/span&gt;&quot;); $(mh).append(ahr); if(rtlsup) { mw.dir = &quot;rtl&quot;; $(&quot;.ui-jqdialog-title&quot;,mh).css(&quot;float&quot;,&quot;right&quot;); $(&quot;.ui-jqdialog-titlebar-close&quot;,mh).css(&quot;left&quot;,0.3+&quot;em&quot;); } else { mw.dir = &quot;ltr&quot;; $(&quot;.ui-jqdialog-title&quot;,mh).css(&quot;float&quot;,&quot;left&quot;); $(&quot;.ui-jqdialog-titlebar-close&quot;,mh).css(&quot;right&quot;,0.3+&quot;em&quot;); } var mc = document.createElement('div'); $(mc).addClass(&quot;ui-jqdialog-content ui-widget-content&quot;).attr(&quot;id&quot;,aIDs.modalcontent); $(mc).append(content); mw.appendChild(mc); $(mw).prepend(mh); if(appendsel===true) { $('body').append(mw); } //append as first child in body -for alert dialog else if (typeof appendsel == &quot;string&quot;) $(appendsel).append(mw); else {$(mw).insertBefore(insertSelector);} $(mw).css(css); if(typeof p.jqModal === 'undefined') {p.jqModal = true;} // internal use var coord = {}; if ( $.fn.jqm &amp;&amp; p.jqModal === true) { if(p.left ===0 &amp;&amp; p.top===0 &amp;&amp; p.overlay) { var pos = []; pos = $.jgrid.findPos(posSelector); p.left = pos[0] + 4; p.top = pos[1] + 4; } coord.top = p.top+&quot;px&quot;; coord.left = p.left; } else if(p.left !==0 || p.top!==0) { coord.left = p.left; coord.top = p.top+&quot;px&quot;; } $(&quot;a.ui-jqdialog-titlebar-close&quot;,mh).click(function(){ var oncm = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;onClose&quot;) || p.onClose; var gboxclose = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;gbox&quot;) || p.gbox; self.hideModal(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal),{gb:gboxclose,jqm:p.jqModal,onClose:oncm}); return false; }); if (p.width === 0 || !p.width) {p.width = 300;} if(p.height === 0 || !p.height) {p.height =200;} if(!p.zIndex) { var parentZ = $(insertSelector).parents(&quot;*[role=dialog]&quot;).filter(':first').css(&quot;z-index&quot;); if(parentZ) { p.zIndex = parseInt(parentZ,10)+2; } else { p.zIndex = 950; } } var rtlt = 0; if( rtlsup &amp;&amp; coord.left &amp;&amp; !appendsel) { rtlt = $(p.gbox).width()- (!isNaN(p.width) ? parseInt(p.width,10) :0) - 8; // to do // just in case coord.left = parseInt(coord.left,10) + parseInt(rtlt,10); } if(coord.left) { coord.left += &quot;px&quot;; } $(mw).css($.extend({ width: isNaN(p.width) ? &quot;auto&quot;: p.width+&quot;px&quot;, height:isNaN(p.height) ? &quot;auto&quot; : p.height + &quot;px&quot;, zIndex:p.zIndex, overflow: 'hidden' },coord)) .attr({tabIndex: &quot;-1&quot;,&quot;role&quot;:&quot;dialog&quot;,&quot;aria-labelledby&quot;:aIDs.modalhead,&quot;aria-hidden&quot;:&quot;true&quot;}); if(typeof p.drag == 'undefined') { p.drag=true;} if(typeof p.resize == 'undefined') {p.resize=true;} if (p.drag) { $(mh).css('cursor','move'); if($.fn.jqDrag) { $(mw).jqDrag(mh); } else { try { $(mw).draggable({handle: $(&quot;#&quot;+$.jgrid.jqID(mh.id))}); } catch (e) {} } } if(p.resize) { if($.fn.jqResize) { $(mw).append(&quot;&lt;div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'&gt;&lt;/div&gt;&quot;); $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).jqResize(&quot;.jqResize&quot;,aIDs.scrollelm ? &quot;#&quot;+$.jgrid.jqID(aIDs.scrollelm) : false); } else { try { $(mw).resizable({handles: 'se, sw',alsoResize: aIDs.scrollelm ? &quot;#&quot;+$.jgrid.jqID(aIDs.scrollelm) : false}); } catch (r) {} } } if(p.closeOnEscape === true){ $(mw).keydown( function( e ) { if( e.which == 27 ) { var cone = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;onClose&quot;) || p.onClose; self.hideModal(this,{gb:p.gbox,jqm:p.jqModal,onClose: cone}); } }); } }, viewModal : function (selector,o){ o = $.extend({ toTop: true, overlay: 10, modal: false, overlayClass : 'ui-widget-overlay', onShow: $.jgrid.showModal, onHide: $.jgrid.closeModal, gbox: '', jqm : true, jqM : true }, o || {}); if ($.fn.jqm &amp;&amp; o.jqm === true) { if(o.jqM) { $(selector).attr(&quot;aria-hidden&quot;,&quot;false&quot;).jqm(o).jqmShow(); } else {$(selector).attr(&quot;aria-hidden&quot;,&quot;false&quot;).jqmShow();} } else { if(o.gbox !== '') { $(&quot;.jqgrid-overlay:first&quot;,o.gbox).show(); $(selector).data(&quot;gbox&quot;,o.gbox); } $(selector).show().attr(&quot;aria-hidden&quot;,&quot;false&quot;); try{$(':input:visible',selector)[0].focus();}catch(_){} } }, info_dialog : function(caption, content,c_b, modalopt) { var mopt = { width:290, height:'auto', dataheight: 'auto', drag: true, resize: false, caption:&quot;&lt;b&gt;&quot;+caption+&quot;&lt;/b&gt;&quot;, left:250, top:170, zIndex : 1000, jqModal : true, modal : false, closeOnEscape : true, align: 'center', buttonalign : 'center', buttons : [] // {text:'textbutt', id:&quot;buttid&quot;, onClick : function(){...}} // if the id is not provided we set it like info_button_+ the index in the array - i.e info_button_0,info_button_1... }; $.extend(mopt,modalopt || {}); var jm = mopt.jqModal, self = this; if($.fn.jqm &amp;&amp; !jm) { jm = false; } // in case there is no jqModal var buttstr =&quot;&quot;; if(mopt.buttons.length &gt; 0) { for(var i=0;i&lt;mopt.buttons.length;i++) { if(typeof mopt.buttons[i].id == &quot;undefined&quot;) { mopt.buttons[i].id = &quot;info_button_&quot;+i; } buttstr += &quot;&lt;a href='javascript:void(0)' id='&quot;+mopt.buttons[i].id+&quot;' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+mopt.buttons[i].text+&quot;&lt;/a&gt;&quot;; } } var dh = isNaN(mopt.dataheight) ? mopt.dataheight : mopt.dataheight+&quot;px&quot;, cn = &quot;text-align:&quot;+mopt.align+&quot;;&quot;; var cnt = &quot;&lt;div id='info_id'&gt;&quot;; cnt += &quot;&lt;div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:&quot;+dh+&quot;;&quot;+cn+&quot;'&gt;&quot;+content+&quot;&lt;/div&gt;&quot;; cnt += c_b ? &quot;&lt;div class='ui-widget-content ui-helper-clearfix' style='text-align:&quot;+mopt.buttonalign+&quot;;padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'&gt;&lt;a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+c_b+&quot;&lt;/a&gt;&quot;+buttstr+&quot;&lt;/div&gt;&quot; : buttstr !== &quot;&quot; ? &quot;&lt;div class='ui-widget-content ui-helper-clearfix' style='text-align:&quot;+mopt.buttonalign+&quot;;padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'&gt;&quot;+buttstr+&quot;&lt;/div&gt;&quot; : &quot;&quot;; cnt += &quot;&lt;/div&gt;&quot;; try { if($(&quot;#info_dialog&quot;).attr(&quot;aria-hidden&quot;) == &quot;false&quot;) { $.jgrid.hideModal(&quot;#info_dialog&quot;,{jqm:jm}); } $(&quot;#info_dialog&quot;).remove(); } catch (e){} $.jgrid.createModal({ themodal:'info_dialog', modalhead:'info_head', modalcontent:'info_content', scrollelm: 'infocnt'}, cnt, mopt, '','',true ); // attach onclick after inserting into the dom if(buttstr) { $.each(mopt.buttons,function(i){ $(&quot;#&quot;+$.jgrid.jqID(this.id),&quot;#info_id&quot;).bind('click',function(){mopt.buttons[i].onClick.call($(&quot;#info_dialog&quot;)); return false;}); }); } $(&quot;#closedialog&quot;, &quot;#info_id&quot;).click(function(){ self.hideModal(&quot;#info_dialog&quot;,{jqm:jm}); return false; }); $(&quot;.fm-button&quot;,&quot;#info_dialog&quot;).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); if($.isFunction(mopt.beforeOpen) ) { mopt.beforeOpen(); } $.jgrid.viewModal(&quot;#info_dialog&quot;,{ onHide: function(h) { h.w.hide().remove(); if(h.o) { h.o.remove(); } }, modal :mopt.modal, jqm:jm }); if($.isFunction(mopt.afterOpen) ) { mopt.afterOpen(); } try{ $(&quot;#info_dialog&quot;).focus();} catch (m){} }, // Form Functions createEl : function(eltype,options,vl,autowidth, ajaxso) { var elem = &quot;&quot;, $t = this; function bindEv (el, opt) { if($.isFunction(opt.dataInit)) { opt.dataInit.call($t,el); } if(opt.dataEvents) { $.each(opt.dataEvents, function() { if (this.data !== undefined) { $(el).bind(this.type, this.data, this.fn); } else { $(el).bind(this.type, this.fn); } }); } return opt; } function setAttributes(elm, atr, exl ) { var exclude = ['dataInit','dataEvents','dataUrl', 'buildSelect','sopt', 'searchhidden', 'defaultValue', 'attr']; if(typeof(exl) != &quot;undefined&quot; &amp;&amp; $.isArray(exl)) { $.merge(exclude, exl); } $.each(atr, function(key, value){ if($.inArray(key, exclude) === -1) { $(elm).attr(key,value); } }); if(!atr.hasOwnProperty('id')) { $(elm).attr('id', $.jgrid.randId()); } } switch (eltype) { case &quot;textarea&quot; : elem = document.createElement(&quot;textarea&quot;); if(autowidth) { if(!options.cols) { $(elem).css({width:&quot;98%&quot;});} } else if (!options.cols) { options.cols = 20; } if(!options.rows) { options.rows = 2; } if(vl=='&amp;nbsp;' || vl=='&amp;#160;' || (vl.length==1 &amp;&amp; vl.charCodeAt(0)==160)) {vl=&quot;&quot;;} elem.value = vl; setAttributes(elem, options); options = bindEv(elem,options); $(elem).attr({&quot;role&quot;:&quot;textbox&quot;,&quot;multiline&quot;:&quot;true&quot;}); break; case &quot;checkbox&quot; : //what code for simple checkbox elem = document.createElement(&quot;input&quot;); elem.type = &quot;checkbox&quot;; if( !options.value ) { var vl1 = vl.toLowerCase(); if(vl1.search(/(false|0|no|off|undefined)/i)&lt;0 &amp;&amp; vl1!==&quot;&quot;) { elem.checked=true; elem.defaultChecked=true; elem.value = vl; } else { elem.value = &quot;on&quot;; } $(elem).attr(&quot;offval&quot;,&quot;off&quot;); } else { var cbval = options.value.split(&quot;:&quot;); if(vl === cbval[0]) { elem.checked=true; elem.defaultChecked=true; } elem.value = cbval[0]; $(elem).attr(&quot;offval&quot;,cbval[1]); } setAttributes(elem, options, ['value']); options = bindEv(elem,options); $(elem).attr(&quot;role&quot;,&quot;checkbox&quot;); break; case &quot;select&quot; : elem = document.createElement(&quot;select&quot;); elem.setAttribute(&quot;role&quot;,&quot;select&quot;); var msl, ovm = []; if(options.multiple===true) { msl = true; elem.multiple=&quot;multiple&quot;; $(elem).attr(&quot;aria-multiselectable&quot;,&quot;true&quot;); } else { msl = false; } if(typeof(options.dataUrl) != &quot;undefined&quot;) { $.ajax($.extend({ url: options.dataUrl, type : &quot;GET&quot;, dataType: &quot;html&quot;, context: {elem:elem, options:options, vl:vl}, success: function(data){ var a, ovm = [], elem = this.elem, vl = this.vl, options = $.extend({},this.options), msl = options.multiple===true; if($.isFunction(options.buildSelect)) { var b = options.buildSelect.call($t,data); a = $(b).html(); } else { a = $(data).html(); } if(a) { $(elem).append(a); setAttributes(elem, options); options = bindEv(elem,options); if(typeof options.size === 'undefined') { options.size = msl ? 3 : 1;} if(msl) { ovm = vl.split(&quot;,&quot;); ovm = $.map(ovm,function(n){return $.trim(n);}); } else { ovm[0] = $.trim(vl); } //$(elem).attr(options); setTimeout(function(){ $(&quot;option&quot;,elem).each(function(i){ //if(i===0) { this.selected = &quot;&quot;; } // fix IE8/IE7 problem with selecting of the first item on multiple=true if (i === 0 &amp;&amp; elem.multiple) { this.selected = false; } $(this).attr(&quot;role&quot;,&quot;option&quot;); if($.inArray($.trim($(this).text()),ovm) &gt; -1 || $.inArray($.trim($(this).val()),ovm) &gt; -1 ) { this.selected= &quot;selected&quot;; } }); },0); } } },ajaxso || {})); } else if(options.value) { var i; if(typeof options.size === 'undefined') { options.size = msl ? 3 : 1; } if(msl) { ovm = vl.split(&quot;,&quot;); ovm = $.map(ovm,function(n){return $.trim(n);}); } if(typeof options.value === 'function') { options.value = options.value(); } var so,sv, ov, sep = options.separator === undefined ? &quot;:&quot; : options.separator, delim = options.delimiter === undefined ? &quot;;&quot; : options.delimiter; if(typeof options.value === 'string') { so = options.value.split(delim); for(i=0; i&lt;so.length;i++){ sv = so[i].split(sep); if(sv.length &gt; 2 ) { sv[1] = $.map(sv,function(n,ii){if(ii&gt;0) { return n;} }).join(sep); } ov = document.createElement(&quot;option&quot;); ov.setAttribute(&quot;role&quot;,&quot;option&quot;); ov.value = sv[0]; ov.innerHTML = sv[1]; elem.appendChild(ov); if (!msl &amp;&amp; ($.trim(sv[0]) == $.trim(vl) || $.trim(sv[1]) == $.trim(vl))) { ov.selected =&quot;selected&quot;; } if (msl &amp;&amp; ($.inArray($.trim(sv[1]), ovm)&gt;-1 || $.inArray($.trim(sv[0]), ovm)&gt;-1)) {ov.selected =&quot;selected&quot;;} } } else if (typeof options.value === 'object') { var oSv = options.value; for ( var key in oSv) { if (oSv.hasOwnProperty(key ) ){ ov = document.createElement(&quot;option&quot;); ov.setAttribute(&quot;role&quot;,&quot;option&quot;); ov.value = key; ov.innerHTML = oSv[key]; elem.appendChild(ov); if (!msl &amp;&amp; ( $.trim(key) == $.trim(vl) || $.trim(oSv[key]) == $.trim(vl)) ) { ov.selected =&quot;selected&quot;; } if (msl &amp;&amp; ($.inArray($.trim(oSv[key]),ovm)&gt;-1 || $.inArray($.trim(key),ovm)&gt;-1)) { ov.selected =&quot;selected&quot;; } } } } setAttributes(elem, options, ['value']); options = bindEv(elem,options); } break; case &quot;text&quot; : case &quot;password&quot; : case &quot;button&quot; : var role; if(eltype==&quot;button&quot;) { role = &quot;button&quot;; } else { role = &quot;textbox&quot;; } elem = document.createElement(&quot;input&quot;); elem.type = eltype; elem.value = vl; setAttributes(elem, options); options = bindEv(elem,options); if(eltype != &quot;button&quot;){ if(autowidth) { if(!options.size) { $(elem).css({width:&quot;98%&quot;}); } } else if (!options.size) { options.size = 20; } } $(elem).attr(&quot;role&quot;,role); break; case &quot;image&quot; : case &quot;file&quot; : elem = document.createElement(&quot;input&quot;); elem.type = eltype; setAttributes(elem, options); options = bindEv(elem,options); break; case &quot;custom&quot; : elem = document.createElement(&quot;span&quot;); try { if($.isFunction(options.custom_element)) { var celm = options.custom_element.call($t,vl,options); if(celm) { celm = $(celm).addClass(&quot;customelement&quot;).attr({id:options.id,name:options.name}); $(elem).empty().append(celm); } else { throw &quot;e2&quot;; } } else { throw &quot;e1&quot;; } } catch (e) { if (e==&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_element' &quot;+$.jgrid.edit.msg.nodefined, $.jgrid.edit.bClose);} if (e==&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_element' &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose);} else { $.jgrid.info_dialog($.jgrid.errors.errcap,typeof(e)===&quot;string&quot;?e:e.message,$.jgrid.edit.bClose); } } break; } return elem; }, // Date Validation Javascript checkDate : function (format, date) { var daysInFebruary = function(year){ // February has 29 days in any year evenly divisible by four, // EXCEPT for centurial years which are not also divisible by 400. return (((year % 4 === 0) &amp;&amp; ( year % 100 !== 0 || (year % 400 === 0))) ? 29 : 28 ); }, DaysArray = function(n) { for (var i = 1; i &lt;= n; i++) { this[i] = 31; if (i==4 || i==6 || i==9 || i==11) {this[i] = 30;} if (i==2) {this[i] = 29;} } return this; }; var tsp = {}, sep; format = format.toLowerCase(); //we search for /,-,. for the date separator if(format.indexOf(&quot;/&quot;) != -1) { sep = &quot;/&quot;; } else if(format.indexOf(&quot;-&quot;) != -1) { sep = &quot;-&quot;; } else if(format.indexOf(&quot;.&quot;) != -1) { sep = &quot;.&quot;; } else { sep = &quot;/&quot;; } format = format.split(sep); date = date.split(sep); if (date.length != 3) { return false; } var j=-1,yln, dln=-1, mln=-1; for(var i=0;i&lt;format.length;i++){ var dv = isNaN(date[i]) ? 0 : parseInt(date[i],10); tsp[format[i]] = dv; yln = format[i]; if(yln.indexOf(&quot;y&quot;) != -1) { j=i; } if(yln.indexOf(&quot;m&quot;) != -1) { mln=i; } if(yln.indexOf(&quot;d&quot;) != -1) { dln=i; } } if (format[j] == &quot;y&quot; || format[j] == &quot;yyyy&quot;) { yln=4; } else if(format[j] ==&quot;yy&quot;){ yln = 2; } else { yln = -1; } var daysInMonth = DaysArray(12), strDate; if (j === -1) { return false; } else { strDate = tsp[format[j]].toString(); if(yln == 2 &amp;&amp; strDate.length == 1) {yln = 1;} if (strDate.length != yln || (tsp[format[j]]===0 &amp;&amp; date[j]!=&quot;00&quot;)){ return false; } } if(mln === -1) { return false; } else { strDate = tsp[format[mln]].toString(); if (strDate.length&lt;1 || tsp[format[mln]]&lt;1 || tsp[format[mln]]&gt;12){ return false; } } if(dln === -1) { return false; } else { strDate = tsp[format[dln]].toString(); if (strDate.length&lt;1 || tsp[format[dln]]&lt;1 || tsp[format[dln]]&gt;31 || (tsp[format[mln]]==2 &amp;&amp; tsp[format[dln]]&gt;daysInFebruary(tsp[format[j]])) || tsp[format[dln]] &gt; daysInMonth[tsp[format[mln]]]){ return false; } } return true; }, isEmpty : function(val) { if (val.match(/^\\s+$/) || val === &quot;&quot;) { return true; } else { return false; } }, checkTime : function(time){ // checks only hh:ss (and optional am/pm) var re = /^(\\d{1,2}):(\\d{2})([ap]m)?$/,regs; if(!$.jgrid.isEmpty(time)) { regs = time.match(re); if(regs) { if(regs[3]) { if(regs[1] &lt; 1 || regs[1] &gt; 12) { return false; } } else { if(regs[1] &gt; 23) { return false; } } if(regs[2] &gt; 59) { return false; } } else { return false; } } return true; }, checkValues : function(val, valref,g, customobject, nam) { var edtrul,i, nm, dft, len; if(typeof(customobject) === &quot;undefined&quot;) { if(typeof(valref)=='string'){ for( i =0, len=g.p.colModel.length;i&lt;len; i++){ if(g.p.colModel[i].name==valref) { edtrul = g.p.colModel[i].editrules; valref = i; try { nm = g.p.colModel[i].formoptions.label; } catch (e) {} break; } } } else if(valref &gt;=0) { edtrul = g.p.colModel[valref].editrules; } } else { edtrul = customobject; nm = nam===undefined ? &quot;_&quot; : nam; } if(edtrul) { if(!nm) { nm = g.p.colNames[valref]; } if(edtrul.required === true) { if( $.jgrid.isEmpty(val) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.required,&quot;&quot;]; } } // force required var rqfield = edtrul.required === false ? false : true; if(edtrul.number === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(isNaN(val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.number,&quot;&quot;]; } } } if(typeof edtrul.minValue != 'undefined' &amp;&amp; !isNaN(edtrul.minValue)) { if (parseFloat(val) &lt; parseFloat(edtrul.minValue) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.minValue+&quot; &quot;+edtrul.minValue,&quot;&quot;];} } if(typeof edtrul.maxValue != 'undefined' &amp;&amp; !isNaN(edtrul.maxValue)) { if (parseFloat(val) &gt; parseFloat(edtrul.maxValue) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.maxValue+&quot; &quot;+edtrul.maxValue,&quot;&quot;];} } var filter; if(edtrul.email === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { // taken from $ Validate plugin filter = /^((([a-z]|\\d|[!#\\$%&amp;'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&amp;'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i; if(!filter.test(val)) {return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.email,&quot;&quot;];} } } if(edtrul.integer === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(isNaN(val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.integer,&quot;&quot;]; } if ((val % 1 !== 0) || (val.indexOf('.') != -1)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.integer,&quot;&quot;];} } } if(edtrul.date === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(g.p.colModel[valref].formatoptions &amp;&amp; g.p.colModel[valref].formatoptions.newformat) { dft = g.p.colModel[valref].formatoptions.newformat; } else { dft = g.p.colModel[valref].datefmt || &quot;Y-m-d&quot;; } if(!$.jgrid.checkDate (dft, val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.date+&quot; - &quot;+dft,&quot;&quot;]; } } } if(edtrul.time === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(!$.jgrid.checkTime (val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.date+&quot; - hh:mm (am/pm)&quot;,&quot;&quot;]; } } } if(edtrul.url === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { filter = /^(((https?)|(ftp)):\\/\\/([\\-\\w]+\\.)+\\w{2,3}(\\/[%\\-\\w]+(\\.\\w{2,})?)*(([\\w\\-\\.\\?\\\\\\/+@&amp;#;`~=%!]*)(\\.\\w{2,})?)*\\/?)/i; if(!filter.test(val)) {return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.url,&quot;&quot;];} } } if(edtrul.custom === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if($.isFunction(edtrul.custom_func)) { var ret = edtrul.custom_func.call(g,val,nm); if($.isArray(ret)) { return ret; } else { return [false,$.jgrid.edit.msg.customarray,&quot;&quot;]; } } else { return [false,$.jgrid.edit.msg.customfcheck,&quot;&quot;]; } } } } return [true,&quot;&quot;,&quot;&quot;]; } }); })(jQuery);/* * jqFilter jQuery jqGrid filter addon. * Copyright (c) 2011, Tony Tomov, tony@trirand.com * Dual licensed under the MIT and GPL licenses * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * * The work is inspired from this Stefan Pirvu * http://www.codeproject.com/KB/scripting/json-filtering.aspx * * The filter uses JSON entities to hold filter rules and groups. Here is an example of a filter: { &quot;groupOp&quot;: &quot;AND&quot;, &quot;groups&quot; : [ { &quot;groupOp&quot;: &quot;OR&quot;, &quot;rules&quot;: [ { &quot;field&quot;: &quot;name&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;data&quot;: &quot;England&quot; }, { &quot;field&quot;: &quot;id&quot;, &quot;op&quot;: &quot;le&quot;, &quot;data&quot;: &quot;5&quot;} ] } ], &quot;rules&quot;: [ { &quot;field&quot;: &quot;name&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;data&quot;: &quot;Romania&quot; }, { &quot;field&quot;: &quot;id&quot;, &quot;op&quot;: &quot;le&quot;, &quot;data&quot;: &quot;1&quot;} ] } */ /*global jQuery, $, window, navigator */ (function ($) { $.fn.jqFilter = function( arg ) { if (typeof arg === 'string') { var fn = $.fn.jqFilter[arg]; if (!fn) { throw (&quot;jqFilter - No such method: &quot; + arg); } var args = $.makeArray(arguments).slice(1); return fn.apply(this,args); } var p = $.extend(true,{ filter: null, columns: [], onChange : null, afterRedraw : null, checkValues : null, error: false, errmsg : &quot;&quot;, errorcheck : true, showQuery : true, sopt : null, ops : [ {&quot;name&quot;: &quot;eq&quot;, &quot;description&quot;: &quot;equal&quot;, &quot;operator&quot;:&quot;=&quot;}, {&quot;name&quot;: &quot;ne&quot;, &quot;description&quot;: &quot;not equal&quot;, &quot;operator&quot;:&quot;&lt;&gt;&quot;}, {&quot;name&quot;: &quot;lt&quot;, &quot;description&quot;: &quot;less&quot;, &quot;operator&quot;:&quot;&lt;&quot;}, {&quot;name&quot;: &quot;le&quot;, &quot;description&quot;: &quot;less or equal&quot;,&quot;operator&quot;:&quot;&lt;=&quot;}, {&quot;name&quot;: &quot;gt&quot;, &quot;description&quot;: &quot;greater&quot;, &quot;operator&quot;:&quot;&gt;&quot;}, {&quot;name&quot;: &quot;ge&quot;, &quot;description&quot;: &quot;greater or equal&quot;, &quot;operator&quot;:&quot;&gt;=&quot;}, {&quot;name&quot;: &quot;bw&quot;, &quot;description&quot;: &quot;begins with&quot;, &quot;operator&quot;:&quot;LIKE&quot;}, {&quot;name&quot;: &quot;bn&quot;, &quot;description&quot;: &quot;does not begin with&quot;, &quot;operator&quot;:&quot;NOT LIKE&quot;}, {&quot;name&quot;: &quot;in&quot;, &quot;description&quot;: &quot;in&quot;, &quot;operator&quot;:&quot;IN&quot;}, {&quot;name&quot;: &quot;ni&quot;, &quot;description&quot;: &quot;not in&quot;, &quot;operator&quot;:&quot;NOT IN&quot;}, {&quot;name&quot;: &quot;ew&quot;, &quot;description&quot;: &quot;ends with&quot;, &quot;operator&quot;:&quot;LIKE&quot;}, {&quot;name&quot;: &quot;en&quot;, &quot;description&quot;: &quot;does not end with&quot;, &quot;operator&quot;:&quot;NOT LIKE&quot;}, {&quot;name&quot;: &quot;cn&quot;, &quot;description&quot;: &quot;contains&quot;, &quot;operator&quot;:&quot;LIKE&quot;}, {&quot;name&quot;: &quot;nc&quot;, &quot;description&quot;: &quot;does not contain&quot;, &quot;operator&quot;:&quot;NOT LIKE&quot;}, {&quot;name&quot;: &quot;nu&quot;, &quot;description&quot;: &quot;is null&quot;, &quot;operator&quot;:&quot;IS NULL&quot;}, {&quot;name&quot;: &quot;nn&quot;, &quot;description&quot;: &quot;is not null&quot;, &quot;operator&quot;:&quot;IS NOT NULL&quot;} ], numopts : ['eq','ne', 'lt', 'le', 'gt', 'ge', 'nu', 'nn', 'in', 'ni'], stropts : ['eq', 'ne', 'bw', 'bn', 'ew', 'en', 'cn', 'nc', 'nu', 'nn', 'in', 'ni'], _gridsopt : [], // grid translated strings, do not tuch groupOps : [{ op: &quot;AND&quot;, text: &quot;AND&quot; }, { op: &quot;OR&quot;, text: &quot;OR&quot; }], groupButton : true, ruleButtons : true, direction : &quot;ltr&quot; }, $.jgrid.filter, arg || {}); return this.each( function() { if (this.filter) {return;} this.p = p; // setup filter in case if they is not defined if (this.p.filter === null || this.p.filter === undefined) { this.p.filter = { groupOp: this.p.groupOps[0].op, rules: [], groups: [] }; } var i, len = this.p.columns.length, cl, isIE = /msie/i.test(navigator.userAgent) &amp;&amp; !window.opera; // translating the options if(this.p._gridsopt.length) { // ['eq','ne','lt','le','gt','ge','bw','bn','in','ni','ew','en','cn','nc'] for(i=0;i&lt;this.p._gridsopt.length;i++) { this.p.ops[i].description = this.p._gridsopt[i]; } } this.p.initFilter = $.extend(true,{},this.p.filter); // set default values for the columns if they are not set if( !len ) {return;} for(i=0; i &lt; len; i++) { cl = this.p.columns[i]; if( cl.stype ) { // grid compatibility cl.inputtype = cl.stype; } else if(!cl.inputtype) { cl.inputtype = 'text'; } if( cl.sorttype ) { // grid compatibility cl.searchtype = cl.sorttype; } else if (!cl.searchtype) { cl.searchtype = 'string'; } if(cl.hidden === undefined) { // jqGrid compatibility cl.hidden = false; } if(!cl.label) { cl.label = cl.name; } if(cl.index) { cl.name = cl.index; } if(!cl.hasOwnProperty('searchoptions')) { cl.searchoptions = {}; } if(!cl.hasOwnProperty('searchrules')) { cl.searchrules = {}; } } if(this.p.showQuery) { $(this).append(&quot;&lt;table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;' dir='&quot;+this.p.direction+&quot;'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class='query'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); } /* *Perform checking. * */ var checkData = function(val, colModelItem) { var ret = [true,&quot;&quot;]; if($.isFunction(colModelItem.searchrules)) { ret = colModelItem.searchrules(val, colModelItem); } else if($.jgrid &amp;&amp; $.jgrid.checkValues) { try { ret = $.jgrid.checkValues(val, -1, null, colModelItem.searchrules, colModelItem.label); } catch (e) {} } if(ret &amp;&amp; ret.length &amp;&amp; ret[0] === false) { p.error = !ret[0]; p.errmsg = ret[1]; } }; /* moving to common randId = function() { return Math.floor(Math.random()*10000).toString(); }; */ this.onchange = function ( ){ // clear any error this.p.error = false; this.p.errmsg=&quot;&quot;; return $.isFunction(this.p.onChange) ? this.p.onChange.call( this, this.p ) : false; }; /* * Redraw the filter every time when new field is added/deleted * and field is changed */ this.reDraw = function() { $(&quot;table.group:first&quot;,this).remove(); var t = this.createTableForGroup(p.filter, null); $(this).append(t); if($.isFunction(this.p.afterRedraw) ) { this.p.afterRedraw.call(this, this.p); } }; /* * Creates a grouping data for the filter * @param group - object * @param parentgroup - object */ this.createTableForGroup = function(group, parentgroup) { var that = this, i; // this table will hold all the group (tables) and rules (rows) var table = $(&quot;&lt;table class='group ui-widget ui-widget-content' style='border:0px none;'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), // create error message row align = &quot;left&quot;; if(this.p.direction == &quot;rtl&quot;) { align = &quot;right&quot;; table.attr(&quot;dir&quot;,&quot;rtl&quot;); } if(parentgroup === null) { table.append(&quot;&lt;tr class='error' style='display:none;'&gt;&lt;th colspan='5' class='ui-state-error' align='&quot;+align+&quot;'&gt;&lt;/th&gt;&lt;/tr&gt;&quot;); } var tr = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); table.append(tr); // this header will hold the group operator type and group action buttons for // creating subgroup &quot;+ {}&quot;, creating rule &quot;+&quot; or deleting the group &quot;-&quot; var th = $(&quot;&lt;th colspan='5' align='&quot;+align+&quot;'&gt;&lt;/th&gt;&quot;); tr.append(th); if(this.p.ruleButtons === true) { // dropdown for: choosing group operator type var groupOpSelect = $(&quot;&lt;select class='opsel'&gt;&lt;/select&gt;&quot;); th.append(groupOpSelect); // populate dropdown with all posible group operators: or, and var str= &quot;&quot;, selected; for (i = 0; i &lt; p.groupOps.length; i++) { selected = group.groupOp === that.p.groupOps[i].op ? &quot; selected='selected'&quot; :&quot;&quot;; str += &quot;&lt;option value='&quot;+that.p.groupOps[i].op+&quot;'&quot; + selected+&quot;&gt;&quot;+that.p.groupOps[i].text+&quot;&lt;/option&gt;&quot;; } groupOpSelect .append(str) .bind('change',function() { group.groupOp = $(groupOpSelect).val(); that.onchange(); // signals that the filter has changed }); } // button for adding a new subgroup var inputAddSubgroup =&quot;&lt;span&gt;&lt;/span&gt;&quot;; if(this.p.groupButton) { inputAddSubgroup = $(&quot;&lt;input type='button' value='+ {}' title='Add subgroup' class='add-group'/&gt;&quot;); inputAddSubgroup.bind('click',function() { if (group.groups === undefined ) { group.groups = []; } group.groups.push({ groupOp: p.groupOps[0].op, rules: [], groups: [] }); // adding a new group that.reDraw(); // the html has changed, force reDraw that.onchange(); // signals that the filter has changed return false; }); } th.append(inputAddSubgroup); if(this.p.ruleButtons === true) { // button for adding a new rule var inputAddRule = $(&quot;&lt;input type='button' value='+' title='Add rule' class='add-rule ui-add'/&gt;&quot;), cm; inputAddRule.bind('click',function() { //if(!group) { group = {};} if (group.rules === undefined) { group.rules = []; } for (i = 0; i &lt; that.p.columns.length; i++) { // but show only serchable and serchhidden = true fields var searchable = (typeof that.p.columns[i].search === 'undefined') ? true: that.p.columns[i].search , hidden = (that.p.columns[i].hidden === true), ignoreHiding = (that.p.columns[i].searchoptions.searchhidden === true); if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) { cm = that.p.columns[i]; break; } } var opr; if( cm.searchoptions.sopt ) {opr = cm.searchoptions.sopt;} else if(that.p.sopt) { opr= that.p.sopt; } else if (cm.searchtype === 'string') {opr = that.p.stropts;} else {opr = that.p.numopts;} group.rules.push({ field: cm.name, op: opr[0], data: &quot;&quot; }); // adding a new rule that.reDraw(); // the html has changed, force reDraw // for the moment no change have been made to the rule, so // this will not trigger onchange event return false; }); th.append(inputAddRule); } // button for delete the group if (parentgroup !== null) { // ignore the first group var inputDeleteGroup = $(&quot;&lt;input type='button' value='-' title='Delete group' class='delete-group'/&gt;&quot;); th.append(inputDeleteGroup); inputDeleteGroup.bind('click',function() { // remove group from parent for (i = 0; i &lt; parentgroup.groups.length; i++) { if (parentgroup.groups[i] === group) { parentgroup.groups.splice(i, 1); break; } } that.reDraw(); // the html has changed, force reDraw that.onchange(); // signals that the filter has changed return false; }); } // append subgroup rows if (group.groups !== undefined) { for (i = 0; i &lt; group.groups.length; i++) { var trHolderForSubgroup = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); table.append(trHolderForSubgroup); var tdFirstHolderForSubgroup = $(&quot;&lt;td class='first'&gt;&lt;/td&gt;&quot;); trHolderForSubgroup.append(tdFirstHolderForSubgroup); var tdMainHolderForSubgroup = $(&quot;&lt;td colspan='4'&gt;&lt;/td&gt;&quot;); tdMainHolderForSubgroup.append(this.createTableForGroup(group.groups[i], group)); trHolderForSubgroup.append(tdMainHolderForSubgroup); } } if(group.groupOp === undefined) { group.groupOp = that.p.groupOps[0].op; } // append rules rows if (group.rules !== undefined) { for (i = 0; i &lt; group.rules.length; i++) { table.append( this.createTableRowForRule(group.rules[i], group) ); } } return table; }; /* * Create the rule data for the filter */ this.createTableRowForRule = function(rule, group ) { // save current entity in a variable so that it could // be referenced in anonimous method calls var that=this, tr = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;), //document.createElement(&quot;tr&quot;), // first column used for padding //tdFirstHolderForRule = document.createElement(&quot;td&quot;), i, op, trpar, cm, str=&quot;&quot;, selected; //tdFirstHolderForRule.setAttribute(&quot;class&quot;, &quot;first&quot;); tr.append(&quot;&lt;td class='first'&gt;&lt;/td&gt;&quot;); // create field container var ruleFieldTd = $(&quot;&lt;td class='columns'&gt;&lt;/td&gt;&quot;); tr.append(ruleFieldTd); // dropdown for: choosing field var ruleFieldSelect = $(&quot;&lt;select&gt;&lt;/select&gt;&quot;), ina, aoprs = []; ruleFieldTd.append(ruleFieldSelect); ruleFieldSelect.bind('change',function() { rule.field = $(ruleFieldSelect).val(); trpar = $(this).parents(&quot;tr:first&quot;); for (i=0;i&lt;that.p.columns.length;i++) { if(that.p.columns[i].name === rule.field) { cm = that.p.columns[i]; break; } } if(!cm) {return;} cm.searchoptions.id = $.jgrid.randId(); if(isIE &amp;&amp; cm.inputtype === &quot;text&quot;) { if(!cm.searchoptions.size) { cm.searchoptions.size = 10; } } var elm = $.jgrid.createEl(cm.inputtype,cm.searchoptions, &quot;&quot;, true, that.p.ajaxSelectOptions, true); $(elm).addClass(&quot;input-elm&quot;); //that.createElement(rule, &quot;&quot;); if( cm.searchoptions.sopt ) {op = cm.searchoptions.sopt;} else if(that.p.sopt) { op= that.p.sopt; } else if (cm.searchtype === 'string') {op = that.p.stropts;} else {op = that.p.numopts;} // operators var s =&quot;&quot;, so = 0; aoprs = []; $.each(that.p.ops, function() { aoprs.push(this.name) }); for ( i = 0 ; i &lt; op.length; i++) { ina = $.inArray(op[i],aoprs); if(ina !== -1) { if(so===0) { rule.op = that.p.ops[ina].name; } s += &quot;&lt;option value='&quot;+that.p.ops[ina].name+&quot;'&gt;&quot;+that.p.ops[ina].description+&quot;&lt;/option&gt;&quot;; so++; } } $(&quot;.selectopts&quot;,trpar).empty().append( s ); $(&quot;.selectopts&quot;,trpar)[0].selectedIndex = 0; if( $.browser.msie &amp;&amp; $.browser.version &lt; 9) { var sw = parseInt($(&quot;select.selectopts&quot;,trpar)[0].offsetWidth) + 1; $(&quot;.selectopts&quot;,trpar).width( sw ); $(&quot;.selectopts&quot;,trpar).css(&quot;width&quot;,&quot;auto&quot;); } // data $(&quot;.data&quot;,trpar).empty().append( elm ); $(&quot;.input-elm&quot;,trpar).bind('change',function( e ) { var tmo = $(this).hasClass(&quot;ui-autocomplete-input&quot;) ? 200 :0; setTimeout(function(){ var elem = e.target; rule.data = elem.nodeName.toUpperCase() === &quot;SPAN&quot; &amp;&amp; cm.searchoptions &amp;&amp; $.isFunction(cm.searchoptions.custom_value) ? cm.searchoptions.custom_value($(elem).children(&quot;.customelement:first&quot;), 'get') : elem.value; that.onchange(); // signals that the filter has changed }, tmo); }); setTimeout(function(){ //IE, Opera, Chrome rule.data = $(elm).val(); that.onchange(); // signals that the filter has changed }, 0); }); // populate drop down with user provided column definitions var j=0; for (i = 0; i &lt; that.p.columns.length; i++) { // but show only serchable and serchhidden = true fields var searchable = (typeof that.p.columns[i].search === 'undefined') ? true: that.p.columns[i].search , hidden = (that.p.columns[i].hidden === true), ignoreHiding = (that.p.columns[i].searchoptions.searchhidden === true); if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) { selected = &quot;&quot;; if(rule.field === that.p.columns[i].name) { selected = &quot; selected='selected'&quot;; j=i; } str += &quot;&lt;option value='&quot;+that.p.columns[i].name+&quot;'&quot; +selected+&quot;&gt;&quot;+that.p.columns[i].label+&quot;&lt;/option&gt;&quot;; } } ruleFieldSelect.append( str ); // create operator container var ruleOperatorTd = $(&quot;&lt;td class='operators'&gt;&lt;/td&gt;&quot;); tr.append(ruleOperatorTd); cm = p.columns[j]; // create it here so it can be referentiated in the onchange event //var RD = that.createElement(rule, rule.data); cm.searchoptions.id = $.jgrid.randId(); if(isIE &amp;&amp; cm.inputtype === &quot;text&quot;) { if(!cm.searchoptions.size) { cm.searchoptions.size = 10; } } var ruleDataInput = $.jgrid.createEl(cm.inputtype,cm.searchoptions, rule.data, true, that.p.ajaxSelectOptions, true); // dropdown for: choosing operator var ruleOperatorSelect = $(&quot;&lt;select class='selectopts'&gt;&lt;/select&gt;&quot;); ruleOperatorTd.append(ruleOperatorSelect); ruleOperatorSelect.bind('change',function() { rule.op = $(ruleOperatorSelect).val(); trpar = $(this).parents(&quot;tr:first&quot;); var rd = $(&quot;.input-elm&quot;,trpar)[0]; if (rule.op === &quot;nu&quot; || rule.op === &quot;nn&quot;) { // disable for operator &quot;is null&quot; and &quot;is not null&quot; rule.data = &quot;&quot;; rd.value = &quot;&quot;; rd.setAttribute(&quot;readonly&quot;, &quot;true&quot;); rd.setAttribute(&quot;disabled&quot;, &quot;true&quot;); } else { rd.removeAttribute(&quot;readonly&quot;); rd.removeAttribute(&quot;disabled&quot;); } that.onchange(); // signals that the filter has changed }); // populate drop down with all available operators if( cm.searchoptions.sopt ) {op = cm.searchoptions.sopt;} else if(that.p.sopt) { op= that.p.sopt; } else if (cm.searchtype === 'string') {op = p.stropts;} else {op = that.p.numopts;} str=&quot;&quot;; $.each(that.p.ops, function() { aoprs.push(this.name) }); for ( i = 0; i &lt; op.length; i++) { ina = $.inArray(op[i],aoprs); if(ina !== -1) { selected = rule.op === that.p.ops[ina].name ? &quot; selected='selected'&quot; : &quot;&quot;; str += &quot;&lt;option value='&quot;+that.p.ops[ina].name+&quot;'&quot;+selected+&quot;&gt;&quot;+that.p.ops[ina].description+&quot;&lt;/option&gt;&quot;; } } ruleOperatorSelect.append( str ); // create data container var ruleDataTd = $(&quot;&lt;td class='data'&gt;&lt;/td&gt;&quot;); tr.append(ruleDataTd); // textbox for: data // is created previously //ruleDataInput.setAttribute(&quot;type&quot;, &quot;text&quot;); ruleDataTd.append(ruleDataInput); $(ruleDataInput) .addClass(&quot;input-elm&quot;) .bind('change', function() { rule.data = cm.inputtype === 'custom' ? cm.searchoptions.custom_value($(this).children(&quot;.customelement:first&quot;),'get') : $(this).val(); that.onchange(); // signals that the filter has changed }); // create action container var ruleDeleteTd = $(&quot;&lt;td&gt;&lt;/td&gt;&quot;); tr.append(ruleDeleteTd); // create button for: delete rule if(this.p.ruleButtons === true) { var ruleDeleteInput = $(&quot;&lt;input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/&gt;&quot;); ruleDeleteTd.append(ruleDeleteInput); //$(ruleDeleteInput).html(&quot;&quot;).height(20).width(30).button({icons: { primary: &quot;ui-icon-minus&quot;, text:false}}); ruleDeleteInput.bind('click',function() { // remove rule from group for (i = 0; i &lt; group.rules.length; i++) { if (group.rules[i] === rule) { group.rules.splice(i, 1); break; } } that.reDraw(); // the html has changed, force reDraw that.onchange(); // signals that the filter has changed return false; }); } return tr; }; this.getStringForGroup = function(group) { var s = &quot;(&quot;, index; if (group.groups !== undefined) { for (index = 0; index &lt; group.groups.length; index++) { if (s.length &gt; 1) { s += &quot; &quot; + group.groupOp + &quot; &quot;; } try { s += this.getStringForGroup(group.groups[index]); } catch (eg) {alert(eg);} } } if (group.rules !== undefined) { try{ for (index = 0; index &lt; group.rules.length; index++) { if (s.length &gt; 1) { s += &quot; &quot; + group.groupOp + &quot; &quot;; } s += this.getStringForRule(group.rules[index]); } } catch (e) {alert(e);} } s += &quot;)&quot;; if (s === &quot;()&quot;) { return &quot;&quot;; // ignore groups that don't have rules } else { return s; } }; this.getStringForRule = function(rule) { var opUF = &quot;&quot;,opC=&quot;&quot;, i, cm, ret, val, numtypes = ['int', 'integer', 'float', 'number', 'currency']; // jqGrid for (i = 0; i &lt; this.p.ops.length; i++) { if (this.p.ops[i].name === rule.op) { opUF = this.p.ops[i].operator; opC = this.p.ops[i].name; break; } } for (i=0; i&lt;this.p.columns.length; i++) { if(this.p.columns[i].name === rule.field) { cm = this.p.columns[i]; break; } } val = rule.data; if(opC === 'bw' || opC === 'bn') { val = val+&quot;%&quot;; } if(opC === 'ew' || opC === 'en') { val = &quot;%&quot;+val; } if(opC === 'cn' || opC === 'nc') { val = &quot;%&quot;+val+&quot;%&quot;; } if(opC === 'in' || opC === 'ni') { val = &quot; (&quot;+val+&quot;)&quot;; } if(p.errorcheck) { checkData(rule.data, cm); } if($.inArray(cm.searchtype, numtypes) !== -1 || opC === 'nn' || opC === 'nu') { ret = rule.field + &quot; &quot; + opUF + &quot; &quot; + val; } else { ret = rule.field + &quot; &quot; + opUF + &quot; \\&quot;&quot; + val + &quot;\\&quot;&quot;; } return ret; }; this.resetFilter = function () { this.p.filter = $.extend(true,{},this.p.initFilter); this.reDraw(); this.onchange(); }; this.hideError = function() { $(&quot;th.ui-state-error&quot;, this).html(&quot;&quot;); $(&quot;tr.error&quot;, this).hide(); }; this.showError = function() { $(&quot;th.ui-state-error&quot;, this).html(this.p.errmsg); $(&quot;tr.error&quot;, this).show(); }; this.toUserFriendlyString = function() { return this.getStringForGroup(p.filter); }; this.toString = function() { // this will obtain a string that can be used to match an item. var that = this; function getStringRule(rule) { if(that.p.errorcheck) { var i, cm; for (i=0; i&lt;that.p.columns.length; i++) { if(that.p.columns[i].name === rule.field) { cm = that.p.columns[i]; break; } } if(cm) {checkData(rule.data, cm);} } return rule.op + &quot;(item.&quot; + rule.field + &quot;,'&quot; + rule.data + &quot;')&quot;; } function getStringForGroup(group) { var s = &quot;(&quot;, index; if (group.groups !== undefined) { for (index = 0; index &lt; group.groups.length; index++) { if (s.length &gt; 1) { if (group.groupOp === &quot;OR&quot;) { s += &quot; || &quot;; } else { s += &quot; &amp;&amp; &quot;; } } s += getStringForGroup(group.groups[index]); } } if (group.rules !== undefined) { for (index = 0; index &lt; group.rules.length; index++) { if (s.length &gt; 1) { if (group.groupOp === &quot;OR&quot;) { s += &quot; || &quot;; } else { s += &quot; &amp;&amp; &quot;; } } s += getStringRule(group.rules[index]); } } s += &quot;)&quot;; if (s === &quot;()&quot;) { return &quot;&quot;; // ignore groups that don't have rules } else { return s; } } return getStringForGroup(this.p.filter); }; // Here we init the filter this.reDraw(); if(this.p.showQuery) { this.onchange(); } // mark is as created so that it will not be created twice on this element this.filter = true; }); }; $.extend($.fn.jqFilter,{ /* * Return SQL like string. Can be used directly */ toSQLString : function() { var s =&quot;&quot;; this.each(function(){ s = this.toUserFriendlyString(); }); return s; }, /* * Return filter data as object. */ filterData : function() { var s; this.each(function(){ s = this.p.filter; }); return s; }, getParameter : function (param) { if(param !== undefined) { if (this.p.hasOwnProperty(param) ) { return this.p[param]; } } return this.p; }, resetFilter: function() { return this.each(function(){ this.resetFilter(); }); }, addFilter: function (pfilter) { if (typeof pfilter === &quot;string&quot;) { pfilter = jQuery.jgrid.parse( pfilter ); } this.each(function(){ this.p.filter = pfilter; this.reDraw(); this.onchange(); }); } }); })(jQuery); (function($){ /** * jqGrid extension for form editing Grid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; /*global xmlJsonClass, jQuery, $ */ var rp_ge = {}; $.jgrid.extend({ searchGrid : function (p) { p = $.extend({ recreateFilter: false, drag: true, sField:'searchField', sValue:'searchString', sOper: 'searchOper', sFilter: 'filters', loadDefaults: true, // this options activates loading of default filters from grid's postData for Multipe Search only. beforeShowSearch: null, afterShowSearch : null, onInitializeSearch: null, afterRedraw : null, afterChange: null, closeAfterSearch : false, closeAfterReset: false, closeOnEscape : false, searchOnEnter : false, multipleSearch : false, multipleGroup : false, //cloneSearchRowOnAdd: true, top : 0, left: 0, jqModal : true, modal: false, resize : true, width: 450, height: 'auto', dataheight: 'auto', showQuery: false, errorcheck : true, // translation // if you want to change or remove the order change it in sopt // ['eq','ne','lt','le','gt','ge','bw','bn','in','ni','ew','en','cn','nc'], sopt: null, stringResult: undefined, onClose : null, onSearch : null, onReset : null, toTop : true, overlay : 30, columns : [], tmplNames : null, tmplFilters : null, // translations - later in lang file tmplLabel : ' Template: ', showOnLoad: false, layer: null }, $.jgrid.search, p || {}); return this.each(function() { var $t = this; if(!$t.grid) {return;} var fid = &quot;fbox_&quot;+$t.p.id, showFrm = true, IDs = {themodal:'searchmod'+fid,modalhead:'searchhd'+fid,modalcontent:'searchcnt'+fid, scrollelm : fid}, defaultFilters = $t.p.postData[p.sFilter]; if(typeof(defaultFilters) === &quot;string&quot;) { defaultFilters = $.jgrid.parse( defaultFilters ); } if(p.recreateFilter === true) { $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).remove(); } function showFilter(_filter) { showFrm = $($t).triggerHandler(&quot;jqGridFilterBeforeShow&quot;, [_filter]); if(typeof(showFrm) === &quot;undefined&quot;) { showFrm = true; } if(showFrm &amp;&amp; $.isFunction(p.beforeShowSearch)) { showFrm = p.beforeShowSearch.call($t,_filter); } if(showFrm) { $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(fid),jqm:p.jqModal, modal:p.modal, overlay: p.overlay, toTop: p.toTop}); $($t).triggerHandler(&quot;jqGridFilterAfterShow&quot;, [_filter]); if($.isFunction(p.afterShowSearch)) { p.afterShowSearch.call($t, _filter); } } } if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { showFilter($(&quot;#fbox_&quot;+$.jgrid.jqID(+$t.p.id))); } else { var fil = $(&quot;&lt;div&gt;&lt;div id='&quot;+fid+&quot;' class='searchFilter' style='overflow:auto'&gt;&lt;/div&gt;&lt;/div&gt;&quot;).insertBefore(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)), align = &quot;left&quot;, butleft =&quot;&quot;; if($t.p.direction == &quot;rtl&quot;) { align = &quot;right&quot;; butleft = &quot; style='text-align:left'&quot;; fil.attr(&quot;dir&quot;,&quot;rtl&quot;); } var columns = $.extend([],$t.p.colModel), bS =&quot;&lt;a href='javascript:void(0)' id='&quot;+fid+&quot;_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'&gt;&lt;span class='ui-icon ui-icon-search'&gt;&lt;/span&gt;&quot;+p.Find+&quot;&lt;/a&gt;&quot;, bC =&quot;&lt;a href='javascript:void(0)' id='&quot;+fid+&quot;_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'&gt;&lt;span class='ui-icon ui-icon-arrowreturnthick-1-w'&gt;&lt;/span&gt;&quot;+p.Reset+&quot;&lt;/a&gt;&quot;, bQ = &quot;&quot;, tmpl=&quot;&quot;, colnm, found = false, bt, cmi=-1; if(p.showQuery) { bQ =&quot;&lt;a href='javascript:void(0)' id='&quot;+fid+&quot;_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'&gt;&lt;span class='ui-icon ui-icon-comment'&gt;&lt;/span&gt;Query&lt;/a&gt;&quot;; } if(!p.columns.length) { $.each(columns, function(i,n){ if(!n.label) { n.label = $t.p.colNames[i]; } // find first searchable column and set it if no default filter if(!found) { var searchable = (typeof n.search === 'undefined') ? true: n.search , hidden = (n.hidden === true), ignoreHiding = (n.searchoptions &amp;&amp; n.searchoptions.searchhidden === true); if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) { found = true; colnm = n.index || n.name; cmi =i; } } }); } else { columns = p.columns; } // old behaviour if( (!defaultFilters &amp;&amp; colnm) || p.multipleSearch === false ) { var cmop = &quot;eq&quot;; if(cmi &gt;=0 &amp;&amp; columns[cmi].searchoptions &amp;&amp; columns[cmi].searchoptions.sopt) { cmop = columns[cmi].searchoptions.sopt[0]; } else if(p.sopt &amp;&amp; p.sopt.length) { cmop = p.sopt[0]; } defaultFilters = {&quot;groupOp&quot;: &quot;AND&quot;,rules:[{&quot;field&quot;:colnm,&quot;op&quot;:cmop,&quot;data&quot;:&quot;&quot;}]}; } found = false; if(p.tmplNames &amp;&amp; p.tmplNames.length) { found = true; tmpl = p.tmplLabel; tmpl += &quot;&lt;select class='ui-template'&gt;&quot;; tmpl += &quot;&lt;option value='default'&gt;Default&lt;/option&gt;&quot;; $.each(p.tmplNames, function(i,n){ tmpl += &quot;&lt;option value='&quot;+i+&quot;'&gt;&quot;+n+&quot;&lt;/option&gt;&quot;; }); tmpl += &quot;&lt;/select&gt;&quot;; } bt = &quot;&lt;table class='EditTable' style='border:0px none;margin-top:5px' id='&quot;+fid+&quot;_2'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;hr class='ui-widget-content' style='margin:1px'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class='EditButton' style='text-align:&quot;+align+&quot;'&gt;&quot;+bC+tmpl+&quot;&lt;/td&gt;&lt;td class='EditButton' &quot;+butleft+&quot;&gt;&quot;+bQ+bS+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; fid = $.jgrid.jqID( fid); $(&quot;#&quot;+fid).jqFilter({ columns : columns, filter: p.loadDefaults ? defaultFilters : null, showQuery: p.showQuery, errorcheck : p.errorcheck, sopt: p.sopt, groupButton : p.multipleGroup, ruleButtons : p.multipleSearch, afterRedraw : p.afterRedraw, _gridsopt : $.jgrid.search.odata, ajaxSelectOptions: $t.p.ajaxSelectOptions, groupOps: p.groupOps, onChange : function() { if(this.p.showQuery) { $('.query',this).html(this.toUserFriendlyString()); } if ($.isFunction(p.afterChange)) { p.afterChange.call($t, $(&quot;#&quot;+fid), p); } }, direction : $t.p.direction }); fil.append( bt ); if(found &amp;&amp; p.tmplFilters &amp;&amp; p.tmplFilters.length) { $(&quot;.ui-template&quot;, fil).bind('change', function(){ var curtempl = $(this).val(); if(curtempl==&quot;default&quot;) { $(&quot;#&quot;+fid).jqFilter('addFilter', defaultFilters); } else { $(&quot;#&quot;+fid).jqFilter('addFilter', p.tmplFilters[parseInt(curtempl,10)]); } return false; }); } if(p.multipleGroup === true) {p.multipleSearch = true;} $($t).triggerHandler(&quot;jqGridFilterInitialize&quot;, [$(&quot;#&quot;+fid)]); if($.isFunction(p.onInitializeSearch) ) { p.onInitializeSearch.call($t, $(&quot;#&quot;+fid)); } p.gbox = &quot;#gbox_&quot;+fid; if (p.layer) { $.jgrid.createModal(IDs ,fil,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0], &quot;#&quot;+$.jgrid.jqID(p.layer), {position: &quot;relative&quot;}); } else { $.jgrid.createModal(IDs ,fil,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0]); } if (p.searchOnEnter || p.closeOnEscape) { $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).keydown(function (e) { var $target = $(e.target); if (p.searchOnEnter &amp;&amp; e.which === 13 &amp;&amp; // 13 === $.ui.keyCode.ENTER !$target.hasClass('add-group') &amp;&amp; !$target.hasClass('add-rule') &amp;&amp; !$target.hasClass('delete-group') &amp;&amp; !$target.hasClass('delete-rule') &amp;&amp; (!$target.hasClass(&quot;fm-button&quot;) || !$target.is(&quot;[id$=_query]&quot;))) { $(&quot;#&quot;+fid+&quot;_search&quot;).focus().click(); return false; } if (p.closeOnEscape &amp;&amp; e.which === 27) { // 27 === $.ui.keyCode.ESCAPE $(&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).find(&quot;.ui-jqdialog-titlebar-close&quot;).focus().click(); return false; } }); } if(bQ) { $(&quot;#&quot;+fid+&quot;_query&quot;).bind('click', function(){ $(&quot;.queryresult&quot;, fil).toggle(); return false; }); } if (p.stringResult===undefined) { // to provide backward compatibility, inferring stringResult value from multipleSearch p.stringResult = p.multipleSearch; } $(&quot;#&quot;+fid+&quot;_search&quot;).bind('click', function(){ var fl = $(&quot;#&quot;+fid), sdata={}, res , filters = fl.jqFilter('filterData'); if(p.errorcheck) { fl[0].hideError(); if(!p.showQuery) {fl.jqFilter('toSQLString');} if(fl[0].p.error) { fl[0].showError(); return false; } } if(p.stringResult) { try { // xmlJsonClass or JSON.stringify res = xmlJsonClass.toJson(filters, '', '', false); } catch (e) { try { res = JSON.stringify(filters); } catch (e2) { } } if(typeof(res)===&quot;string&quot;) { sdata[p.sFilter] = res; $.each([p.sField,p.sValue, p.sOper], function() {sdata[this] = &quot;&quot;;}); } } else { if(p.multipleSearch) { sdata[p.sFilter] = filters; $.each([p.sField,p.sValue, p.sOper], function() {sdata[this] = &quot;&quot;;}); } else { sdata[p.sField] = filters.rules[0].field; sdata[p.sValue] = filters.rules[0].data; sdata[p.sOper] = filters.rules[0].op; sdata[p.sFilter] = &quot;&quot;; } } $t.p.search = true; $.extend($t.p.postData,sdata); $($t).triggerHandler(&quot;jqGridFilterSearch&quot;); if($.isFunction(p.onSearch) ) { p.onSearch.call($t); } $($t).trigger(&quot;reloadGrid&quot;,[{page:1}]); if(p.closeAfterSearch) { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:p.jqModal,onClose: p.onClose}); } return false; }); $(&quot;#&quot;+fid+&quot;_reset&quot;).bind('click', function(){ var sdata={}, fl = $(&quot;#&quot;+fid); $t.p.search = false; if(p.multipleSearch===false) { sdata[p.sField] = sdata[p.sValue] = sdata[p.sOper] = &quot;&quot;; } else { sdata[p.sFilter] = &quot;&quot;; } fl[0].resetFilter(); if(found) { $(&quot;.ui-template&quot;, fil).val(&quot;default&quot;); } $.extend($t.p.postData,sdata); $($t).triggerHandler(&quot;jqGridFilterReset&quot;); if($.isFunction(p.onReset) ) { p.onReset.call($t); } $($t).trigger(&quot;reloadGrid&quot;,[{page:1}]); return false; }); showFilter($(&quot;#&quot;+fid)); $(&quot;.fm-button:not(.ui-state-disabled)&quot;,fil).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); } }); }, editGridRow : function(rowid, p){ p = $.extend({ top : 0, left: 0, width: 300, height: 'auto', dataheight: 'auto', modal: false, overlay : 30, drag: true, resize: true, url: null, mtype : &quot;POST&quot;, clearAfterAdd :true, closeAfterEdit : false, reloadAfterSubmit : true, onInitializeForm: null, beforeInitData: null, beforeShowForm: null, afterShowForm: null, beforeSubmit: null, afterSubmit: null, onclickSubmit: null, afterComplete: null, onclickPgButtons : null, afterclickPgButtons: null, editData : {}, recreateForm : false, jqModal : true, closeOnEscape : false, addedrow : &quot;first&quot;, topinfo : '', bottominfo: '', saveicon : [], closeicon : [], savekey: [false,13], navkeys: [false,38,40], checkOnSubmit : false, checkOnUpdate : false, _savedData : {}, processing : false, onClose : null, ajaxEditOptions : {}, serializeEditData : null, viewPagerButtons : true }, $.jgrid.edit, p || {}); rp_ge[$(this)[0].p.id] = p; return this.each(function(){ var $t = this; if (!$t.grid || !rowid) {return;} var gID = $t.p.id, frmgr = &quot;FrmGrid_&quot;+gID, frmtborg = &quot;TblGrid_&quot;+gID, frmtb = &quot;#&quot;+$.jgrid.jqID(frmtborg), IDs = {themodal:'editmod'+gID,modalhead:'edithd'+gID,modalcontent:'editcnt'+gID, scrollelm : frmgr}, onBeforeShow = $.isFunction(rp_ge[$t.p.id].beforeShowForm) ? rp_ge[$t.p.id].beforeShowForm : false, onAfterShow = $.isFunction(rp_ge[$t.p.id].afterShowForm) ? rp_ge[$t.p.id].afterShowForm : false, onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false, onInitializeForm = $.isFunction(rp_ge[$t.p.id].onInitializeForm) ? rp_ge[$t.p.id].onInitializeForm : false, showFrm = true, maxCols = 1, maxRows=0, postdata, extpost, newData, diff, frmoper; frmgr = $.jgrid.jqID(frmgr); if (rowid === &quot;new&quot;) { rowid = &quot;_empty&quot;; frmoper = &quot;add&quot;; p.caption=rp_ge[$t.p.id].addCaption; } else { p.caption=rp_ge[$t.p.id].editCaption; frmoper = &quot;edit&quot;; } if(p.recreateForm===true &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined) { $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).remove(); } var closeovrl = true; if(p.checkOnUpdate &amp;&amp; p.jqModal &amp;&amp; !p.modal) { closeovrl = false; } function getFormData(){ $(frmtb+&quot; &gt; tbody &gt; tr &gt; td &gt; .FormElement&quot;).each(function() { var celm = $(&quot;.customelement&quot;, this); if (celm.length) { var elem = celm[0], nm = $(elem).attr('name'); $.each($t.p.colModel, function(){ if(this.name === nm &amp;&amp; this.editoptions &amp;&amp; $.isFunction(this.editoptions.custom_value)) { try { postdata[nm] = this.editoptions.custom_value.call($t, $(&quot;#&quot;+$.jgrid.jqID(nm),frmtb),'get'); if (postdata[nm] === undefined) {throw &quot;e1&quot;;} } catch (e) { if (e===&quot;e1&quot;) {$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);} else {$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);} } return true; } }); } else { switch ($(this).get(0).type) { case &quot;checkbox&quot;: if($(this).is(&quot;:checked&quot;)) { postdata[this.name]= $(this).val(); }else { var ofv = $(this).attr(&quot;offval&quot;); postdata[this.name]= ofv; } break; case &quot;select-one&quot;: postdata[this.name]= $(&quot;option:selected&quot;,this).val(); extpost[this.name]= $(&quot;option:selected&quot;,this).text(); break; case &quot;select-multiple&quot;: postdata[this.name]= $(this).val(); if(postdata[this.name]) {postdata[this.name] = postdata[this.name].join(&quot;,&quot;);} else {postdata[this.name] =&quot;&quot;;} var selectedText = []; $(&quot;option:selected&quot;,this).each( function(i,selected){ selectedText[i] = $(selected).text(); } ); extpost[this.name]= selectedText.join(&quot;,&quot;); break; case &quot;password&quot;: case &quot;text&quot;: case &quot;textarea&quot;: case &quot;button&quot;: postdata[this.name] = $(this).val(); break; } if($t.p.autoencode) {postdata[this.name] = $.jgrid.htmlEncode(postdata[this.name]);} } }); return true; } function createData(rowid,obj,tb,maxcols){ var nm, hc,trdata, cnt=0,tmp, dc,elc, retpos=[], ind=false, tdtmpl = &quot;&lt;td class='CaptionTD'&gt;&amp;#160;&lt;/td&gt;&lt;td class='DataTD'&gt;&amp;#160;&lt;/td&gt;&quot;, tmpl=&quot;&quot;, i; //*2 for (i =1; i&lt;=maxcols;i++) { tmpl += tdtmpl; } if(rowid != '_empty') { ind = $(obj).jqGrid(&quot;getInd&quot;,rowid); } $(obj.p.colModel).each( function(i) { nm = this.name; // hidden fields are included in the form if(this.editrules &amp;&amp; this.editrules.edithidden === true) { hc = false; } else { hc = this.hidden === true ? true : false; } dc = hc ? &quot;style='display:none'&quot; : &quot;&quot;; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; this.editable===true &amp;&amp; nm !== 'rn') { if(ind === false) { tmp = &quot;&quot;; } else { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text(); } else { try { tmp = $.unformat.call(obj, $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]),{rowId:rowid, colModel:this},i); } catch (_) { tmp = (this.edittype &amp;&amp; this.edittype == &quot;textarea&quot;) ? $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text() : $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).html(); } if(!tmp || tmp == &quot;&amp;nbsp;&quot; || tmp == &quot;&amp;#160;&quot; || (tmp.length==1 &amp;&amp; tmp.charCodeAt(0)==160) ) {tmp='';} } } var opt = $.extend({}, this.editoptions || {} ,{id:nm,name:nm}), frmopt = $.extend({}, {elmprefix:'',elmsuffix:'',rowabove:false,rowcontent:''}, this.formoptions || {}), rp = parseInt(frmopt.rowpos,10) || cnt+1, cp = parseInt((parseInt(frmopt.colpos,10) || 1)*2,10); if(rowid == &quot;_empty&quot; &amp;&amp; opt.defaultValue ) { tmp = $.isFunction(opt.defaultValue) ? opt.defaultValue.call($t) : opt.defaultValue; } if(!this.edittype) {this.edittype = &quot;text&quot;;} if($t.p.autoencode) {tmp = $.jgrid.htmlDecode(tmp);} elc = $.jgrid.createEl.call($t,this.edittype,opt,tmp,false,$.extend({},$.jgrid.ajaxOptions,obj.p.ajaxSelectOptions || {})); if(tmp === &quot;&quot; &amp;&amp; this.edittype == &quot;checkbox&quot;) {tmp = $(elc).attr(&quot;offval&quot;);} if(tmp === &quot;&quot; &amp;&amp; this.edittype == &quot;select&quot;) {tmp = $(&quot;option:eq(0)&quot;,elc).text();} if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = tmp;} $(elc).addClass(&quot;FormElement&quot;); if(this.edittype == 'text' || this.edittype == 'textarea') { $(elc).addClass(&quot;ui-widget-content ui-corner-all&quot;); } trdata = $(tb).find(&quot;tr[rowpos=&quot;+rp+&quot;]&quot;); if(frmopt.rowabove) { var newdata = $(&quot;&lt;tr&gt;&lt;td class='contentinfo' colspan='&quot;+(maxcols*2)+&quot;'&gt;&quot;+frmopt.rowcontent+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;); $(tb).append(newdata); newdata[0].rp = rp; } if ( trdata.length===0 ) { trdata = $(&quot;&lt;tr &quot;+dc+&quot; rowpos='&quot;+rp+&quot;'&gt;&lt;/tr&gt;&quot;).addClass(&quot;FormData&quot;).attr(&quot;id&quot;,&quot;tr_&quot;+nm); $(trdata).append(tmpl); $(tb).append(trdata); trdata[0].rp = rp; } $(&quot;td:eq(&quot;+(cp-2)+&quot;)&quot;,trdata[0]).html( typeof frmopt.label === 'undefined' ? obj.p.colNames[i]: frmopt.label); $(&quot;td:eq(&quot;+(cp-1)+&quot;)&quot;,trdata[0]).append(frmopt.elmprefix).append(elc).append(frmopt.elmsuffix); retpos[cnt] = i; cnt++; } }); if( cnt &gt; 0) { var idrow = $(&quot;&lt;tr class='FormData' style='display:none'&gt;&lt;td class='CaptionTD'&gt;&lt;/td&gt;&lt;td colspan='&quot;+ (maxcols*2-1)+&quot;' class='DataTD'&gt;&lt;input class='FormElement' id='id_g' type='text' name='&quot;+obj.p.id+&quot;_id' value='&quot;+rowid+&quot;'/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;); idrow[0].rp = cnt+999; $(tb).append(idrow); if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[obj.p.id+&quot;_id&quot;] = rowid;} } return retpos; } function fillData(rowid,obj,fmid){ var nm,cnt=0,tmp, fld,opt,vl,vlc; if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData = {};rp_ge[$t.p.id]._savedData[obj.p.id+&quot;_id&quot;]=rowid;} var cm = obj.p.colModel; if(rowid == '_empty') { $(cm).each(function(){ nm = this.name; opt = $.extend({}, this.editoptions || {} ); fld = $(&quot;#&quot;+$.jgrid.jqID(nm),&quot;#&quot;+fmid); if(fld &amp;&amp; fld.length &amp;&amp; fld[0] !== null) { vl = &quot;&quot;; if(opt.defaultValue ) { vl = $.isFunction(opt.defaultValue) ? opt.defaultValue.call($t) : opt.defaultValue; if(fld[0].type=='checkbox') { vlc = vl.toLowerCase(); if(vlc.search(/(false|0|no|off|undefined)/i)&lt;0 &amp;&amp; vlc!==&quot;&quot;) { fld[0].checked = true; fld[0].defaultChecked = true; fld[0].value = vl; } else { fld[0].checked = false; fld[0].defaultChecked = false; } } else {fld.val(vl);} } else { if( fld[0].type=='checkbox' ) { fld[0].checked = false; fld[0].defaultChecked = false; vl = $(fld).attr(&quot;offval&quot;); } else if (fld[0].type &amp;&amp; fld[0].type.substr(0,6)=='select') { fld[0].selectedIndex = 0; } else { fld.val(vl); } } if(rp_ge[$t.p.id].checkOnSubmit===true || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = vl;} } }); $(&quot;#id_g&quot;,&quot;#&quot;+fmid).val(rowid); return; } var tre = $(obj).jqGrid(&quot;getInd&quot;,rowid,true); if(!tre) {return;} $('td[role=&quot;gridcell&quot;]',tre).each( function(i) { nm = cm[i].name; // hidden fields are included in the form if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn' &amp;&amp; cm[i].editable===true) { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(this).text(); } else { try { tmp = $.unformat.call(obj, $(this),{rowId:rowid, colModel:cm[i]},i); } catch (_) { tmp = cm[i].edittype==&quot;textarea&quot; ? $(this).text() : $(this).html(); } } if($t.p.autoencode) {tmp = $.jgrid.htmlDecode(tmp);} if(rp_ge[$t.p.id].checkOnSubmit===true || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = tmp;} nm = $.jgrid.jqID(nm); switch (cm[i].edittype) { case &quot;password&quot;: case &quot;text&quot;: case &quot;button&quot; : case &quot;image&quot;: case &quot;textarea&quot;: if(tmp == &quot;&amp;nbsp;&quot; || tmp == &quot;&amp;#160;&quot; || (tmp.length==1 &amp;&amp; tmp.charCodeAt(0)==160) ) {tmp='';} $(&quot;#&quot;+nm,&quot;#&quot;+fmid).val(tmp); break; case &quot;select&quot;: var opv = tmp.split(&quot;,&quot;); opv = $.map(opv,function(n){return $.trim(n);}); $(&quot;#&quot;+nm+&quot; option&quot;,&quot;#&quot;+fmid).each(function(){ if (!cm[i].editoptions.multiple &amp;&amp; ($.trim(tmp) == $.trim($(this).text()) || opv[0] == $.trim($(this).text()) || opv[0] == $.trim($(this).val())) ){ this.selected= true; } else if (cm[i].editoptions.multiple){ if( $.inArray($.trim($(this).text()), opv ) &gt; -1 || $.inArray($.trim($(this).val()), opv ) &gt; -1 ){ this.selected = true; }else{ this.selected = false; } } else { this.selected = false; } }); break; case &quot;checkbox&quot;: tmp = tmp+&quot;&quot;; if(cm[i].editoptions &amp;&amp; cm[i].editoptions.value) { var cb = cm[i].editoptions.value.split(&quot;:&quot;); if(cb[0] == tmp) { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;,true); //ie } else { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;, false); //ie } } else { tmp = tmp.toLowerCase(); if(tmp.search(/(false|0|no|off|undefined)/i)&lt;0 &amp;&amp; tmp!==&quot;&quot;) { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;,true); //ie } else { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;, false); //ie } } break; case 'custom' : try { if(cm[i].editoptions &amp;&amp; $.isFunction(cm[i].editoptions.custom_value)) { cm[i].editoptions.custom_value.call($t, $(&quot;#&quot;+nm,&quot;#&quot;+fmid),'set',tmp); } else {throw &quot;e1&quot;;} } catch (e) { if (e==&quot;e1&quot;) {$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);} else {$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);} } break; } cnt++; } }); if(cnt&gt;0) {$(&quot;#id_g&quot;,frmtb).val(rowid);} } function setNulls() { $.each($t.p.colModel, function(i,n){ if(n.editoptions &amp;&amp; n.editoptions.NullIfEmpty === true) { if(postdata.hasOwnProperty(n.name) &amp;&amp; postdata[n.name] === &quot;&quot;) { postdata[n.name] = 'null'; } } }); } function postIt() { var copydata, ret=[true,&quot;&quot;,&quot;&quot;], onCS = {}, opers = $t.p.prmNames, idname, oper, key, selr, i; var retvals = $($t).triggerHandler(&quot;jqGridAddEditBeforeCheckValues&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(retvals &amp;&amp; typeof(retvals) === 'object') {postdata = retvals;} if($.isFunction(rp_ge[$t.p.id].beforeCheckValues)) { retvals = rp_ge[$t.p.id].beforeCheckValues.call($t, postdata,$(&quot;#&quot;+frmgr),postdata[$t.p.id+&quot;_id&quot;] == &quot;_empty&quot; ? opers.addoper : opers.editoper); if(retvals &amp;&amp; typeof(retvals) === 'object') {postdata = retvals;} } for( key in postdata ){ if(postdata.hasOwnProperty(key)) { ret = $.jgrid.checkValues.call($t,postdata[key],key,$t); if(ret[0] === false) {break;} } } setNulls(); if(ret[0]) { onCS = $($t).triggerHandler(&quot;jqGridAddEditClickSubmit&quot;, [rp_ge[$t.p.id], postdata, frmoper]); if( onCS === undefined &amp;&amp; $.isFunction( rp_ge[$t.p.id].onclickSubmit)) { onCS = rp_ge[$t.p.id].onclickSubmit.call($t, rp_ge[$t.p.id], postdata) || {}; } ret = $($t).triggerHandler(&quot;jqGridAddEditBeforeSubmit&quot;, [postdata, $(&quot;#&quot;+frmgr), frmoper]); if(ret === undefined) { ret = [true,&quot;&quot;,&quot;&quot;]; } if( ret[0] &amp;&amp; $.isFunction(rp_ge[$t.p.id].beforeSubmit)) { ret = rp_ge[$t.p.id].beforeSubmit.call($t,postdata,$(&quot;#&quot;+frmgr)); } } if(ret[0] &amp;&amp; !rp_ge[$t.p.id].processing) { rp_ge[$t.p.id].processing = true; $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).addClass('ui-state-active'); oper = opers.oper; idname = opers.id; // we add to pos data array the action - the name is oper postdata[oper] = ($.trim(postdata[$t.p.id+&quot;_id&quot;]) == &quot;_empty&quot;) ? opers.addoper : opers.editoper; if(postdata[oper] != opers.addoper) { postdata[idname] = postdata[$t.p.id+&quot;_id&quot;]; } else { // check to see if we have allredy this field in the form and if yes lieve it if( postdata[idname] === undefined ) {postdata[idname] = postdata[$t.p.id+&quot;_id&quot;];} } delete postdata[$t.p.id+&quot;_id&quot;]; postdata = $.extend(postdata,rp_ge[$t.p.id].editData,onCS); if($t.p.treeGrid === true) { if(postdata[oper] == opers.addoper) { selr = $($t).jqGrid(&quot;getGridParam&quot;, 'selrow'); var tr_par_id = $t.p.treeGridModel == 'adjacency' ? $t.p.treeReader.parent_id_field : 'parent_id'; postdata[tr_par_id] = selr; } for(i in $t.p.treeReader){ if($t.p.treeReader.hasOwnProperty(i)) { var itm = $t.p.treeReader[i]; if(postdata.hasOwnProperty(itm)) { if(postdata[oper] == opers.addoper &amp;&amp; i === 'parent_id_field') {continue;} delete postdata[itm]; } } } } postdata[idname] = $.jgrid.stripPref($t.p.idPrefix, postdata[idname]); var ajaxOptions = $.extend({ url: rp_ge[$t.p.id].url ? rp_ge[$t.p.id].url : $($t).jqGrid('getGridParam','editurl'), type: rp_ge[$t.p.id].mtype, data: $.isFunction(rp_ge[$t.p.id].serializeEditData) ? rp_ge[$t.p.id].serializeEditData.call($t,postdata) : postdata, complete:function(data,Status){ postdata[idname] = $t.p.idPrefix + postdata[idname]; if(Status != &quot;success&quot;) { ret[0] = false; ret[1] = $($t).triggerHandler(&quot;jqGridAddEditErrorTextFormat&quot;, [data, frmoper]); if ($.isFunction(rp_ge[$t.p.id].errorTextFormat)) { ret[1] = rp_ge[$t.p.id].errorTextFormat.call($t, data); } else { ret[1] = Status + &quot; Status: '&quot; + data.statusText + &quot;'. Error code: &quot; + data.status; } } else { // data is posted successful // execute aftersubmit with the returned data from server ret = $($t).triggerHandler(&quot;jqGridAddEditAfterSubmit&quot;, [data, postdata, frmoper]); if(ret === undefined) { ret = [true,&quot;&quot;,&quot;&quot;]; } if( ret[0] &amp;&amp; $.isFunction(rp_ge[$t.p.id].afterSubmit) ) { ret = rp_ge[$t.p.id].afterSubmit.call($t, data,postdata); } } if(ret[0] === false) { $(&quot;#FormError&gt;td&quot;,frmtb).html(ret[1]); $(&quot;#FormError&quot;,frmtb).show(); } else { // remove some values if formattaer select or checkbox $.each($t.p.colModel, function(){ if(extpost[this.name] &amp;&amp; this.formatter &amp;&amp; this.formatter=='select') { try {delete extpost[this.name];} catch (e) {} } }); postdata = $.extend(postdata,extpost); if($t.p.autoencode) { $.each(postdata,function(n,v){ postdata[n] = $.jgrid.htmlDecode(v); }); } //rp_ge[$t.p.id].reloadAfterSubmit = rp_ge[$t.p.id].reloadAfterSubmit &amp;&amp; $t.p.datatype != &quot;local&quot;; // the action is add if(postdata[oper] == opers.addoper ) { //id processing // user not set the id ret[2] if(!ret[2]) {ret[2] = $.jgrid.randId();} postdata[idname] = ret[2]; if(rp_ge[$t.p.id].closeAfterAdd) { if(rp_ge[$t.p.id].reloadAfterSubmit) {$($t).trigger(&quot;reloadGrid&quot;);} else { if($t.p.treeGrid === true){ $($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata ); } else { $($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow); $($t).jqGrid(&quot;setSelection&quot;,ret[2]); } } $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); } else if (rp_ge[$t.p.id].clearAfterAdd) { if(rp_ge[$t.p.id].reloadAfterSubmit) {$($t).trigger(&quot;reloadGrid&quot;);} else { if($t.p.treeGrid === true){ $($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata ); } else { $($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow); } } fillData(&quot;_empty&quot;,$t,frmgr); } else { if(rp_ge[$t.p.id].reloadAfterSubmit) {$($t).trigger(&quot;reloadGrid&quot;);} else { if($t.p.treeGrid === true){ $($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata ); } else { $($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow); } } } } else { // the action is update if(rp_ge[$t.p.id].reloadAfterSubmit) { $($t).trigger(&quot;reloadGrid&quot;); if( !rp_ge[$t.p.id].closeAfterEdit ) {setTimeout(function(){$($t).jqGrid(&quot;setSelection&quot;,postdata[idname]);},1000);} } else { if($t.p.treeGrid === true) { $($t).jqGrid(&quot;setTreeRow&quot;, postdata[idname],postdata); } else { $($t).jqGrid(&quot;setRowData&quot;, postdata[idname],postdata); } } if(rp_ge[$t.p.id].closeAfterEdit) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});} } if($.isFunction(rp_ge[$t.p.id].afterComplete)) { copydata = data; setTimeout(function(){ $($t).triggerHandler(&quot;jqGridAddEditAfterComplete&quot;, [copydata, postdata, $(&quot;#&quot;+frmgr), frmoper]); rp_ge[$t.p.id].afterComplete.call($t, copydata, postdata, $(&quot;#&quot;+frmgr)); copydata=null; },500); } if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) { $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); if(rp_ge[$t.p.id]._savedData[$t.p.id+&quot;_id&quot;] !=&quot;_empty&quot;){ for(var key in rp_ge[$t.p.id]._savedData) { if(postdata[key]) { rp_ge[$t.p.id]._savedData[key] = postdata[key]; } } } } } rp_ge[$t.p.id].processing=false; $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).removeClass('ui-state-active'); try{$(':input:visible',&quot;#&quot;+frmgr)[0].focus();} catch (e){} } }, $.jgrid.ajaxOptions, rp_ge[$t.p.id].ajaxEditOptions ); if (!ajaxOptions.url &amp;&amp; !rp_ge[$t.p.id].useDataProxy) { if ($.isFunction($t.p.dataProxy)) { rp_ge[$t.p.id].useDataProxy = true; } else { ret[0]=false;ret[1] += &quot; &quot;+$.jgrid.errors.nourl; } } if (ret[0]) { if (rp_ge[$t.p.id].useDataProxy) { var dpret = $t.p.dataProxy.call($t, ajaxOptions, &quot;set_&quot;+$t.p.id); if(typeof(dpret) == &quot;undefined&quot;) { dpret = [true, &quot;&quot;]; } if(dpret[0] === false ) { ret[0] = false; ret[1] = dpret[1] || &quot;Error deleting the selected row!&quot; ; } else { if(ajaxOptions.data.oper == opers.addoper &amp;&amp; rp_ge[$t.p.id].closeAfterAdd ) { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); } if(ajaxOptions.data.oper == opers.editoper &amp;&amp; rp_ge[$t.p.id].closeAfterEdit ) { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); } } } else { $.ajax(ajaxOptions); } } } if(ret[0] === false) { $(&quot;#FormError&gt;td&quot;,frmtb).html(ret[1]); $(&quot;#FormError&quot;,frmtb).show(); // return; } } function compareData(nObj, oObj ) { var ret = false,key; for (key in nObj) { if(nObj[key] != oObj[key]) { ret = true; break; } } return ret; } function checkUpdates () { var stat = true; $(&quot;#FormError&quot;,frmtb).hide(); if(rp_ge[$t.p.id].checkOnUpdate) { postdata = {};extpost={}; getFormData(); newData = $.extend({},postdata,extpost); diff = compareData(newData,rp_ge[$t.p.id]._savedData); if(diff) { $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,true); $(&quot;.confirm&quot;,&quot;#&quot;+IDs.themodal).show(); stat = false; } } return stat; } function restoreInline() { if (rowid !== &quot;_empty&quot; &amp;&amp; typeof($t.p.savedRow) !== &quot;undefined&quot; &amp;&amp; $t.p.savedRow.length &gt; 0 &amp;&amp; $.isFunction($.fn.jqGrid.restoreRow)) { for (var i=0;i&lt;$t.p.savedRow.length;i++) { if ($t.p.savedRow[i].id == rowid) { $($t).jqGrid('restoreRow',rowid); break; } } } } function updateNav(cr,totr){ if (cr===0) {$(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled');} else {$(&quot;#pData&quot;,frmtb+&quot;_2&quot;).removeClass('ui-state-disabled');} if (cr==totr) {$(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled');} else {$(&quot;#nData&quot;,frmtb+&quot;_2&quot;).removeClass('ui-state-disabled');} } function getCurrPos() { var rowsInGrid = $($t).jqGrid(&quot;getDataIDs&quot;), selrow = $(&quot;#id_g&quot;,frmtb).val(), pos = $.inArray(selrow,rowsInGrid); return [pos,rowsInGrid]; } if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { showFrm = $($t).triggerHandler(&quot;jqGridAddEditBeforeInitData&quot;, [$(&quot;#&quot;+$.jgrid.jqID(frmgr)), frmoper]); if(typeof(showFrm) == &quot;undefined&quot;) { showFrm = true; } if(showFrm &amp;&amp; onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); } if(showFrm === false) {return;} restoreInline(); $(&quot;.ui-jqdialog-title&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).html(p.caption); $(&quot;#FormError&quot;,frmtb).hide(); if(rp_ge[$t.p.id].topinfo) { $(&quot;.topinfo&quot;,frmtb).html(rp_ge[$t.p.id].topinfo); $(&quot;.tinfo&quot;,frmtb).show(); } else { $(&quot;.tinfo&quot;,frmtb).hide(); } if(rp_ge[$t.p.id].bottominfo) { $(&quot;.bottominfo&quot;,frmtb+&quot;_2&quot;).html(rp_ge[$t.p.id].bottominfo); $(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).show(); } else { $(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).hide(); } // filldata fillData(rowid,$t,frmgr); /// if(rowid==&quot;_empty&quot; || !rp_ge[$t.p.id].viewPagerButtons) { $(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).hide(); } else { $(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).show(); } if(rp_ge[$t.p.id].processing===true) { rp_ge[$t.p.id].processing=false; $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).removeClass('ui-state-active'); } if($(&quot;#&quot;+frmgr).data(&quot;disabled&quot;)===true) { $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); } $($t).triggerHandler(&quot;jqGridAddEditBeforeShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onBeforeShow) { onBeforeShow.call($t, $(&quot;#&quot;+frmgr)); } $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).data(&quot;onClose&quot;,rp_ge[$t.p.id].onClose); $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, jqM: false, overlay: p.overlay, modal:p.modal}); if(!closeovrl) { $(&quot;.jqmOverlay&quot;).click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); return false; }); } $($t).triggerHandler(&quot;jqGridAddEditAfterShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onAfterShow) { onAfterShow.call($t, $(&quot;#&quot;+frmgr)); } } else { var dh = isNaN(p.dataheight) ? p.dataheight : p.dataheight+&quot;px&quot;, frm = $(&quot;&lt;form name='FormPost' id='&quot;+frmgr+&quot;' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:&quot;+dh+&quot;;'&gt;&lt;/form&gt;&quot;).data(&quot;disabled&quot;,false), tbl = $(&quot;&lt;table id='&quot;+frmtborg+&quot;' class='EditTable' cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); showFrm = $($t).triggerHandler(&quot;jqGridAddEditBeforeInitData&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(typeof(showFrm) == &quot;undefined&quot;) { showFrm = true; } if(showFrm &amp;&amp; onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); } if(showFrm === false) {return;} restoreInline(); $($t.p.colModel).each( function() { var fmto = this.formoptions; maxCols = Math.max(maxCols, fmto ? fmto.colpos || 0 : 0 ); maxRows = Math.max(maxRows, fmto ? fmto.rowpos || 0 : 0 ); }); $(frm).append(tbl); var flr = $(&quot;&lt;tr id='FormError' style='display:none'&gt;&lt;td class='ui-state-error' colspan='&quot;+(maxCols*2)+&quot;'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;); flr[0].rp = 0; $(tbl).append(flr); //topinfo flr = $(&quot;&lt;tr style='display:none' class='tinfo'&gt;&lt;td class='topinfo' colspan='&quot;+(maxCols*2)+&quot;'&gt;&quot;+rp_ge[$t.p.id].topinfo+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;); flr[0].rp = 0; $(tbl).append(flr); // set the id. // use carefull only to change here colproperties. // create data var rtlb = $t.p.direction == &quot;rtl&quot; ? true :false, bp = rtlb ? &quot;nData&quot; : &quot;pData&quot;, bn = rtlb ? &quot;pData&quot; : &quot;nData&quot;; createData(rowid,$t,tbl,maxCols); // buttons at footer var bP = &quot;&lt;a href='javascript:void(0)' id='&quot;+bp+&quot;' class='fm-button ui-state-default ui-corner-left'&gt;&lt;span class='ui-icon ui-icon-triangle-1-w'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bN = &quot;&lt;a href='javascript:void(0)' id='&quot;+bn+&quot;' class='fm-button ui-state-default ui-corner-right'&gt;&lt;span class='ui-icon ui-icon-triangle-1-e'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bS =&quot;&lt;a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bSubmit+&quot;&lt;/a&gt;&quot;, bC =&quot;&lt;a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bCancel+&quot;&lt;/a&gt;&quot;; var bt = &quot;&lt;table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='&quot;+frmtborg+&quot;_2'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;hr class='ui-widget-content' style='margin:1px'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr id='Act_Buttons'&gt;&lt;td class='navButton'&gt;&quot;+(rtlb ? bN+bP : bP+bN)+&quot;&lt;/td&gt;&lt;td class='EditButton'&gt;&quot;+bS+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; bt += &quot;&lt;tr style='display:none' class='binfo'&gt;&lt;td class='bottominfo' colspan='2'&gt;&quot;+rp_ge[$t.p.id].bottominfo+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; bt += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;; if(maxRows &gt; 0) { var sd=[]; $.each($(tbl)[0].rows,function(i,r){ sd[i] = r; }); sd.sort(function(a,b){ if(a.rp &gt; b.rp) {return 1;} if(a.rp &lt; b.rp) {return -1;} return 0; }); $.each(sd, function(index, row) { $('tbody',tbl).append(row); }); } p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID); var cle = false; if(p.closeOnEscape===true){ p.closeOnEscape = false; cle = true; } var tms = $(&quot;&lt;span&gt;&lt;/span&gt;&quot;).append(frm).append(bt); $.jgrid.createModal(IDs,tms,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0]); if(rtlb) { $(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).css(&quot;float&quot;,&quot;right&quot;); $(&quot;.EditButton&quot;,frmtb+&quot;_2&quot;).css(&quot;text-align&quot;,&quot;left&quot;); } if(rp_ge[$t.p.id].topinfo) {$(&quot;.tinfo&quot;,frmtb).show();} if(rp_ge[$t.p.id].bottominfo) {$(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).show();} tms = null;bt=null; $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).keydown( function( e ) { var wkey = e.target; if ($(&quot;#&quot;+frmgr).data(&quot;disabled&quot;)===true ) {return false;}//?? if(rp_ge[$t.p.id].savekey[0] === true &amp;&amp; e.which == rp_ge[$t.p.id].savekey[1]) { // save if(wkey.tagName != &quot;TEXTAREA&quot;) { $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } } if(e.which === 27) { if(!checkUpdates()) {return false;} if(cle) {$.jgrid.hideModal(this,{gb:p.gbox,jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});} return false; } if(rp_ge[$t.p.id].navkeys[0]===true) { if($(&quot;#id_g&quot;,frmtb).val() == &quot;_empty&quot;) {return true;} if(e.which == rp_ge[$t.p.id].navkeys[1]){ //up $(&quot;#pData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } if(e.which == rp_ge[$t.p.id].navkeys[2]){ //down $(&quot;#nData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } } }); if(p.checkOnUpdate) { $(&quot;a.ui-jqdialog-titlebar-close span&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).removeClass(&quot;jqmClose&quot;); $(&quot;a.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).unbind(&quot;click&quot;) .click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); return false; }); } p.saveicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-disk&quot;],p.saveicon); p.closeicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-close&quot;],p.closeicon); // beforeinitdata after creation of the form if(p.saveicon[0]===true) { $(&quot;#sData&quot;,frmtb+&quot;_2&quot;).addClass(p.saveicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.saveicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if(p.closeicon[0]===true) { $(&quot;#cData&quot;,frmtb+&quot;_2&quot;).addClass(p.closeicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.closeicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) { bS =&quot;&lt;a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'&gt;&quot;+p.bYes+&quot;&lt;/a&gt;&quot;; bN =&quot;&lt;a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'&gt;&quot;+p.bNo+&quot;&lt;/a&gt;&quot;; bC =&quot;&lt;a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'&gt;&quot;+p.bExit+&quot;&lt;/a&gt;&quot;; var ii, zI = p.zIndex || 999;zI ++; if ($.browser.msie &amp;&amp; $.browser.version ==6) { ii = '&lt;iframe style=&quot;display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\\'0\\');&quot; src=&quot;javascript:false;&quot;&gt;&lt;/iframe&gt;'; } else {ii=&quot;&quot;;} $(&quot;&lt;div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:&quot;+zI+&quot;;display:none;'&gt;&amp;#160;&quot;+ii+&quot;&lt;/div&gt;&lt;div class='confirm ui-widget-content ui-jqconfirm' style='z-index:&quot;+(zI+1)+&quot;'&gt;&quot;+p.saveData+&quot;&lt;br/&gt;&lt;br/&gt;&quot;+bS+bN+bC+&quot;&lt;/div&gt;&quot;).insertAfter(&quot;#&quot;+frmgr); $(&quot;#sNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){ postIt(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); return false; }); $(&quot;#nNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){ $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); setTimeout(function(){$(&quot;:input&quot;,&quot;#&quot;+frmgr)[0].focus();},0); return false; }); $(&quot;#cNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){ $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); return false; }); } // here initform - only once $($t).triggerHandler(&quot;jqGridAddEditInitializeForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onInitializeForm) {onInitializeForm.call($t,$(&quot;#&quot;+frmgr));} if(rowid==&quot;_empty&quot; || !rp_ge[$t.p.id].viewPagerButtons) {$(&quot;#pData,#nData&quot;,frmtb+&quot;_2&quot;).hide();} else {$(&quot;#pData,#nData&quot;,frmtb+&quot;_2&quot;).show();} $($t).triggerHandler(&quot;jqGridAddEditBeforeShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onBeforeShow) { onBeforeShow.call($t, $(&quot;#&quot;+frmgr));} $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).data(&quot;onClose&quot;,rp_ge[$t.p.id].onClose); $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, overlay: p.overlay,modal:p.modal}); if(!closeovrl) { $(&quot;.jqmOverlay&quot;).click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); return false; }); } $($t).triggerHandler(&quot;jqGridAddEditAfterShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onAfterShow) { onAfterShow.call($t, $(&quot;#&quot;+frmgr)); } $(&quot;.fm-button&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).click(function(){ postdata = {};extpost={}; $(&quot;#FormError&quot;,frmtb).hide(); // all depend on ret array //ret[0] - succes //ret[1] - msg if not succes //ret[2] - the id that will be set if reload after submit false getFormData(); if(postdata[$t.p.id+&quot;_id&quot;] == &quot;_empty&quot;) {postIt();} else if(p.checkOnSubmit===true ) { newData = $.extend({},postdata,extpost); diff = compareData(newData,rp_ge[$t.p.id]._savedData); if(diff) { $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,true); $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).show(); } else { postIt(); } } else { postIt(); } return false; }); $(&quot;#cData&quot;, frmtb+&quot;_2&quot;).click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); return false; }); $(&quot;#nData&quot;, frmtb+&quot;_2&quot;).click(function(){ if(!checkUpdates()) {return false;} $(&quot;#FormError&quot;,frmtb).hide(); var npos = getCurrPos(); npos[0] = parseInt(npos[0],10); if(npos[0] != -1 &amp;&amp; npos[1][npos[0]+1]) { $($t).triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, ['next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]]); var nposret = true; if($.isFunction(p.onclickPgButtons)) { nposret = p.onclickPgButtons.call($t, 'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]); if( nposret !== undefined &amp;&amp; nposret === false ) {return false;} } if( $(&quot;#&quot;+$.jgrid.jqID(npos[1][npos[0]+1])).hasClass('ui-state-disabled')) {return false;} fillData(npos[1][npos[0]+1],$t,frmgr); $($t).jqGrid(&quot;setSelection&quot;,npos[1][npos[0]+1]); $($t).triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, ['next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t, 'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]+1]); } updateNav(npos[0]+1,npos[1].length-1); } return false; }); $(&quot;#pData&quot;, frmtb+&quot;_2&quot;).click(function(){ if(!checkUpdates()) {return false;} $(&quot;#FormError&quot;,frmtb).hide(); var ppos = getCurrPos(); if(ppos[0] != -1 &amp;&amp; ppos[1][ppos[0]-1]) { $($t).triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, ['prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]]); var pposret = true; if($.isFunction(p.onclickPgButtons)) { pposret = p.onclickPgButtons.call($t, 'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]); if( pposret !== undefined &amp;&amp; pposret === false ) {return false;} } if( $(&quot;#&quot;+$.jgrid.jqID(ppos[1][ppos[0]-1])).hasClass('ui-state-disabled')) {return false;} fillData(ppos[1][ppos[0]-1],$t,frmgr); $($t).jqGrid(&quot;setSelection&quot;,ppos[1][ppos[0]-1]); $($t).triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, ['prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t, 'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]-1]); } updateNav(ppos[0]-1,ppos[1].length-1); } return false; }); } var posInit =getCurrPos(); updateNav(posInit[0],posInit[1].length-1); }); }, viewGridRow : function(rowid, p){ p = $.extend({ top : 0, left: 0, width: 0, height: 'auto', dataheight: 'auto', modal: false, overlay: 30, drag: true, resize: true, jqModal: true, closeOnEscape : false, labelswidth: '30%', closeicon: [], navkeys: [false,38,40], onClose: null, beforeShowForm : null, beforeInitData : null, viewPagerButtons : true }, $.jgrid.view, p || {}); rp_ge[$(this)[0].p.id] = p; return this.each(function(){ var $t = this; if (!$t.grid || !rowid) {return;} var gID = $t.p.id, frmgr = &quot;ViewGrid_&quot;+$.jgrid.jqID( gID ), frmtb = &quot;ViewTbl_&quot; + $.jgrid.jqID( gID ), frmgr_id = &quot;ViewGrid_&quot;+gID, frmtb_id = &quot;ViewTbl_&quot;+gID, IDs = {themodal:'viewmod'+gID,modalhead:'viewhd'+gID,modalcontent:'viewcnt'+gID, scrollelm : frmgr}, onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false, showFrm = true, maxCols = 1, maxRows=0; function focusaref(){ //Sfari 3 issues if(rp_ge[$t.p.id].closeOnEscape===true || rp_ge[$t.p.id].navkeys[0]===true) { setTimeout(function(){$(&quot;.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).focus();},0); } } function createData(rowid,obj,tb,maxcols){ var nm, hc,trdata, cnt=0,tmp, dc, retpos=[], ind=false, tdtmpl = &quot;&lt;td class='CaptionTD form-view-label ui-widget-content' width='&quot;+p.labelswidth+&quot;'&gt;&amp;#160;&lt;/td&gt;&lt;td class='DataTD form-view-data ui-helper-reset ui-widget-content'&gt;&amp;#160;&lt;/td&gt;&quot;, tmpl=&quot;&quot;, tdtmpl2 = &quot;&lt;td class='CaptionTD form-view-label ui-widget-content'&gt;&amp;#160;&lt;/td&gt;&lt;td class='DataTD form-view-data ui-widget-content'&gt;&amp;#160;&lt;/td&gt;&quot;, fmtnum = ['integer','number','currency'],max1 =0, max2=0 ,maxw,setme, viewfld; for (var i =1;i&lt;=maxcols;i++) { tmpl += i == 1 ? tdtmpl : tdtmpl2; } // find max number align rigth with property formatter $(obj.p.colModel).each( function() { if(this.editrules &amp;&amp; this.editrules.edithidden === true) { hc = false; } else { hc = this.hidden === true ? true : false; } if(!hc &amp;&amp; this.align==='right') { if(this.formatter &amp;&amp; $.inArray(this.formatter,fmtnum) !== -1 ) { max1 = Math.max(max1,parseInt(this.width,10)); } else { max2 = Math.max(max2,parseInt(this.width,10)); } } }); maxw = max1 !==0 ? max1 : max2 !==0 ? max2 : 0; ind = $(obj).jqGrid(&quot;getInd&quot;,rowid); $(obj.p.colModel).each( function(i) { nm = this.name; setme = false; // hidden fields are included in the form if(this.editrules &amp;&amp; this.editrules.edithidden === true) { hc = false; } else { hc = this.hidden === true ? true : false; } dc = hc ? &quot;style='display:none'&quot; : &quot;&quot;; viewfld = (typeof this.viewable != 'boolean') ? true : this.viewable; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn' &amp;&amp; viewfld) { if(ind === false) { tmp = &quot;&quot;; } else { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text(); } else { tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).html(); } } setme = this.align === 'right' &amp;&amp; maxw !==0 ? true : false; var frmopt = $.extend({},{rowabove:false,rowcontent:''}, this.formoptions || {}), rp = parseInt(frmopt.rowpos,10) || cnt+1, cp = parseInt((parseInt(frmopt.colpos,10) || 1)*2,10); if(frmopt.rowabove) { var newdata = $(&quot;&lt;tr&gt;&lt;td class='contentinfo' colspan='&quot;+(maxcols*2)+&quot;'&gt;&quot;+frmopt.rowcontent+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;); $(tb).append(newdata); newdata[0].rp = rp; } trdata = $(tb).find(&quot;tr[rowpos=&quot;+rp+&quot;]&quot;); if ( trdata.length===0 ) { trdata = $(&quot;&lt;tr &quot;+dc+&quot; rowpos='&quot;+rp+&quot;'&gt;&lt;/tr&gt;&quot;).addClass(&quot;FormData&quot;).attr(&quot;id&quot;,&quot;trv_&quot;+nm); $(trdata).append(tmpl); $(tb).append(trdata); trdata[0].rp = rp; } $(&quot;td:eq(&quot;+(cp-2)+&quot;)&quot;,trdata[0]).html('&lt;b&gt;'+ (typeof frmopt.label === 'undefined' ? obj.p.colNames[i]: frmopt.label)+'&lt;/b&gt;'); $(&quot;td:eq(&quot;+(cp-1)+&quot;)&quot;,trdata[0]).append(&quot;&lt;span&gt;&quot;+tmp+&quot;&lt;/span&gt;&quot;).attr(&quot;id&quot;,&quot;v_&quot;+nm); if(setme){ $(&quot;td:eq(&quot;+(cp-1)+&quot;) span&quot;,trdata[0]).css({'text-align':'right',width:maxw+&quot;px&quot;}); } retpos[cnt] = i; cnt++; } }); if( cnt &gt; 0) { var idrow = $(&quot;&lt;tr class='FormData' style='display:none'&gt;&lt;td class='CaptionTD'&gt;&lt;/td&gt;&lt;td colspan='&quot;+ (maxcols*2-1)+&quot;' class='DataTD'&gt;&lt;input class='FormElement' id='id_g' type='text' name='id' value='&quot;+rowid+&quot;'/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;); idrow[0].rp = cnt+99; $(tb).append(idrow); } return retpos; } function fillData(rowid,obj){ var nm, hc,cnt=0,tmp, opt,trv; trv = $(obj).jqGrid(&quot;getInd&quot;,rowid,true); if(!trv) {return;} $('td',trv).each( function(i) { nm = obj.p.colModel[i].name; // hidden fields are included in the form if(obj.p.colModel[i].editrules &amp;&amp; obj.p.colModel[i].editrules.edithidden === true) { hc = false; } else { hc = obj.p.colModel[i].hidden === true ? true : false; } if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn') { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(this).text(); } else { tmp = $(this).html(); } opt = $.extend({},obj.p.colModel[i].editoptions || {}); nm = $.jgrid.jqID(&quot;v_&quot;+nm); $(&quot;#&quot;+nm+&quot; span&quot;,&quot;#&quot;+frmtb).html(tmp); if (hc) {$(&quot;#&quot;+nm,&quot;#&quot;+frmtb).parents(&quot;tr:first&quot;).hide();} cnt++; } }); if(cnt&gt;0) {$(&quot;#id_g&quot;,&quot;#&quot;+frmtb).val(rowid);} } function updateNav(cr,totr){ if (cr===0) {$(&quot;#pData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass('ui-state-disabled');} else {$(&quot;#pData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).removeClass('ui-state-disabled');} if (cr==totr) {$(&quot;#nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass('ui-state-disabled');} else {$(&quot;#nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).removeClass('ui-state-disabled');} } function getCurrPos() { var rowsInGrid = $($t).jqGrid(&quot;getDataIDs&quot;), selrow = $(&quot;#id_g&quot;,&quot;#&quot;+frmtb).val(), pos = $.inArray(selrow,rowsInGrid); return [pos,rowsInGrid]; } if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); if(typeof(showFrm) == &quot;undefined&quot;) { showFrm = true; } } if(showFrm === false) {return;} $(&quot;.ui-jqdialog-title&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).html(p.caption); $(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide(); fillData(rowid,$t); if($.isFunction(rp_ge[$t.p.id].beforeShowForm)) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+frmgr));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, jqM: false, overlay: p.overlay, modal:p.modal}); focusaref(); } else { var dh = isNaN(p.dataheight) ? p.dataheight : p.dataheight+&quot;px&quot;; var frm = $(&quot;&lt;form name='FormPost' id='&quot;+frmgr_id+&quot;' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:&quot;+dh+&quot;;'&gt;&lt;/form&gt;&quot;), tbl =$(&quot;&lt;table id='&quot;+frmtb_id+&quot;' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); if(typeof(showFrm) == &quot;undefined&quot;) { showFrm = true; } } if(showFrm === false) {return;} $($t.p.colModel).each( function() { var fmto = this.formoptions; maxCols = Math.max(maxCols, fmto ? fmto.colpos || 0 : 0 ); maxRows = Math.max(maxRows, fmto ? fmto.rowpos || 0 : 0 ); }); // set the id. $(frm).append(tbl); createData(rowid, $t, tbl, maxCols); var rtlb = $t.p.direction == &quot;rtl&quot; ? true :false, bp = rtlb ? &quot;nData&quot; : &quot;pData&quot;, bn = rtlb ? &quot;pData&quot; : &quot;nData&quot;, // buttons at footer bP = &quot;&lt;a href='javascript:void(0)' id='&quot;+bp+&quot;' class='fm-button ui-state-default ui-corner-left'&gt;&lt;span class='ui-icon ui-icon-triangle-1-w'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bN = &quot;&lt;a href='javascript:void(0)' id='&quot;+bn+&quot;' class='fm-button ui-state-default ui-corner-right'&gt;&lt;span class='ui-icon ui-icon-triangle-1-e'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bC =&quot;&lt;a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bClose+&quot;&lt;/a&gt;&quot;; if(maxRows &gt; 0) { var sd=[]; $.each($(tbl)[0].rows,function(i,r){ sd[i] = r; }); sd.sort(function(a,b){ if(a.rp &gt; b.rp) {return 1;} if(a.rp &lt; b.rp) {return -1;} return 0; }); $.each(sd, function(index, row) { $('tbody',tbl).append(row); }); } p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID); var bt = $(&quot;&lt;span&gt;&lt;/span&gt;&quot;).append(frm).append(&quot;&lt;table border='0' class='EditTable' id='&quot;+frmtb+&quot;_2'&gt;&lt;tbody&gt;&lt;tr id='Act_Buttons'&gt;&lt;td class='navButton' width='&quot;+p.labelswidth+&quot;'&gt;&quot;+(rtlb ? bN+bP : bP+bN)+&quot;&lt;/td&gt;&lt;td class='EditButton'&gt;&quot;+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); $.jgrid.createModal(IDs,bt,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id))[0]); if(rtlb) { $(&quot;#pData, #nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).css(&quot;float&quot;,&quot;right&quot;); $(&quot;.EditButton&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).css(&quot;text-align&quot;,&quot;left&quot;); } if(!p.viewPagerButtons) {$(&quot;#pData, #nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).hide();} bt = null; $(&quot;#&quot;+IDs.themodal).keydown( function( e ) { if(e.which === 27) { if(rp_ge[$t.p.id].closeOnEscape) {$.jgrid.hideModal(this,{gb:p.gbox,jqm:p.jqModal, onClose: p.onClose});} return false; } if(p.navkeys[0]===true) { if(e.which === p.navkeys[1]){ //up $(&quot;#pData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } if(e.which === p.navkeys[2]){ //down $(&quot;#nData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } } }); p.closeicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-close&quot;],p.closeicon); if(p.closeicon[0]===true) { $(&quot;#cData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass(p.closeicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.closeicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if($.isFunction(p.beforeShowForm)) {p.beforeShowForm.call($t,$(&quot;#&quot;+frmgr));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, modal:p.modal}); $(&quot;.fm-button:not(.ui-state-disabled)&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); focusaref(); $(&quot;#cData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){ $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: p.onClose}); return false; }); $(&quot;#nData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){ $(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide(); var npos = getCurrPos(); npos[0] = parseInt(npos[0],10); if(npos[0] != -1 &amp;&amp; npos[1][npos[0]+1]) { if($.isFunction(p.onclickPgButtons)) { p.onclickPgButtons.call($t,'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]); } fillData(npos[1][npos[0]+1],$t); $($t).jqGrid(&quot;setSelection&quot;,npos[1][npos[0]+1]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t,'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]+1]); } updateNav(npos[0]+1,npos[1].length-1); } focusaref(); return false; }); $(&quot;#pData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){ $(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide(); var ppos = getCurrPos(); if(ppos[0] != -1 &amp;&amp; ppos[1][ppos[0]-1]) { if($.isFunction(p.onclickPgButtons)) { p.onclickPgButtons.call($t,'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]); } fillData(ppos[1][ppos[0]-1],$t); $($t).jqGrid(&quot;setSelection&quot;,ppos[1][ppos[0]-1]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t,'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]-1]); } updateNav(ppos[0]-1,ppos[1].length-1); } focusaref(); return false; }); } var posInit =getCurrPos(); updateNav(posInit[0],posInit[1].length-1); }); }, delGridRow : function(rowids,p) { p = $.extend({ top : 0, left: 0, width: 240, height: 'auto', dataheight : 'auto', modal: false, overlay: 30, drag: true, resize: true, url : '', mtype : &quot;POST&quot;, reloadAfterSubmit: true, beforeShowForm: null, beforeInitData : null, afterShowForm: null, beforeSubmit: null, onclickSubmit: null, afterSubmit: null, jqModal : true, closeOnEscape : false, delData: {}, delicon : [], cancelicon : [], onClose : null, ajaxDelOptions : {}, processing : false, serializeDelData : null, useDataProxy : false }, $.jgrid.del, p ||{}); rp_ge[$(this)[0].p.id] = p; return this.each(function(){ var $t = this; if (!$t.grid ) {return;} if(!rowids) {return;} var onBeforeShow = $.isFunction( rp_ge[$t.p.id].beforeShowForm ), onAfterShow = $.isFunction( rp_ge[$t.p.id].afterShowForm ), onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false, gID = $t.p.id, onCS = {}, showFrm = true, dtbl = &quot;DelTbl_&quot;+$.jgrid.jqID(gID),postd, idname, opers, oper, dtbl_id = &quot;DelTbl_&quot; + gID, IDs = {themodal:'delmod'+gID,modalhead:'delhd'+gID,modalcontent:'delcnt'+gID, scrollelm: dtbl}; if (jQuery.isArray(rowids)) {rowids = rowids.join();} if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+dtbl)); if(typeof(showFrm) == &quot;undefined&quot;) { showFrm = true; } } if(showFrm === false) {return;} $(&quot;#DelData&gt;td&quot;,&quot;#&quot;+dtbl).text(rowids); $(&quot;#DelError&quot;,&quot;#&quot;+dtbl).hide(); if( rp_ge[$t.p.id].processing === true) { rp_ge[$t.p.id].processing=false; $(&quot;#dData&quot;, &quot;#&quot;+dtbl).removeClass('ui-state-active'); } if(onBeforeShow) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+dtbl));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal,jqM: false, overlay: rp_ge[$t.p.id].overlay, modal:rp_ge[$t.p.id].modal}); if(onAfterShow) {rp_ge[$t.p.id].afterShowForm.call($t,$(&quot;#&quot;+dtbl));} } else { var dh = isNaN(rp_ge[$t.p.id].dataheight) ? rp_ge[$t.p.id].dataheight : rp_ge[$t.p.id].dataheight+&quot;px&quot;; var tbl = &quot;&lt;div id='&quot;+dtbl_id+&quot;' class='formdata' style='width:100%;overflow:auto;position:relative;height:&quot;+dh+&quot;;'&gt;&quot;; tbl += &quot;&lt;table class='DelTable'&gt;&lt;tbody&gt;&quot;; // error data tbl += &quot;&lt;tr id='DelError' style='display:none'&gt;&lt;td class='ui-state-error'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;; tbl += &quot;&lt;tr id='DelData' style='display:none'&gt;&lt;td &gt;&quot;+rowids+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; tbl += &quot;&lt;tr&gt;&lt;td class=\\&quot;delmsg\\&quot; style=\\&quot;white-space:pre;\\&quot;&gt;&quot;+rp_ge[$t.p.id].msg+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td &gt;&amp;#160;&lt;/td&gt;&lt;/tr&gt;&quot;; // buttons at footer tbl += &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;; var bS = &quot;&lt;a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bSubmit+&quot;&lt;/a&gt;&quot;, bC = &quot;&lt;a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bCancel+&quot;&lt;/a&gt;&quot;; tbl += &quot;&lt;table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='&quot;+dtbl+&quot;_2'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;hr class='ui-widget-content' style='margin:1px'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class='DelButton EditButton'&gt;&quot;+bS+&quot;&amp;#160;&quot;+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID); $.jgrid.createModal(IDs,tbl,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id))[0]); if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+dtbl)); if(typeof(showFrm) == &quot;undefined&quot;) { showFrm = true; } } if(showFrm === false) {return;} $(&quot;.fm-button&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); p.delicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-scissors&quot;],rp_ge[$t.p.id].delicon); p.cancelicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-cancel&quot;],rp_ge[$t.p.id].cancelicon); if(p.delicon[0]===true) { $(&quot;#dData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).addClass(p.delicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.delicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if(p.cancelicon[0]===true) { $(&quot;#eData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).addClass(p.cancelicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.cancelicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } $(&quot;#dData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).click(function(){ var ret=[true,&quot;&quot;];onCS = {}; var postdata = $(&quot;#DelData&gt;td&quot;,&quot;#&quot;+dtbl).text(); //the pair is name=val1,val2,... if( $.isFunction( rp_ge[$t.p.id].onclickSubmit ) ) {onCS = rp_ge[$t.p.id].onclickSubmit.call($t,rp_ge[$t.p.id], postdata) || {};} if( $.isFunction( rp_ge[$t.p.id].beforeSubmit ) ) {ret = rp_ge[$t.p.id].beforeSubmit.call($t,postdata);} if(ret[0] &amp;&amp; !rp_ge[$t.p.id].processing) { rp_ge[$t.p.id].processing = true; opers = $t.p.prmNames; postd = $.extend({},rp_ge[$t.p.id].delData, onCS); oper = opers.oper; postd[oper] = opers.deloper; idname = opers.id; postdata = String(postdata).split(&quot;,&quot;); if(!postdata.length) { return false; } for( var pk in postdata) { if(postdata.hasOwnProperty(pk)) { postdata[pk] = $.jgrid.stripPref($t.p.idPrefix, postdata[pk]); } } postd[idname] = postdata.join(); $(this).addClass('ui-state-active'); var ajaxOptions = $.extend({ url: rp_ge[$t.p.id].url ? rp_ge[$t.p.id].url : $($t).jqGrid('getGridParam','editurl'), type: rp_ge[$t.p.id].mtype, data: $.isFunction(rp_ge[$t.p.id].serializeDelData) ? rp_ge[$t.p.id].serializeDelData.call($t,postd) : postd, complete:function(data,Status){ if(Status != &quot;success&quot;) { ret[0] = false; if ($.isFunction(rp_ge[$t.p.id].errorTextFormat)) { ret[1] = rp_ge[$t.p.id].errorTextFormat.call($t,data); } else { ret[1] = Status + &quot; Status: '&quot; + data.statusText + &quot;'. Error code: &quot; + data.status; } } else { // data is posted successful // execute aftersubmit with the returned data from server if( $.isFunction( rp_ge[$t.p.id].afterSubmit ) ) { ret = rp_ge[$t.p.id].afterSubmit.call($t,data,postd); } } if(ret[0] === false) { $(&quot;#DelError&gt;td&quot;,&quot;#&quot;+dtbl).html(ret[1]); $(&quot;#DelError&quot;,&quot;#&quot;+dtbl).show(); } else { if(rp_ge[$t.p.id].reloadAfterSubmit &amp;&amp; $t.p.datatype != &quot;local&quot;) { $($t).trigger(&quot;reloadGrid&quot;); } else { if($t.p.treeGrid===true){ try {$($t).jqGrid(&quot;delTreeNode&quot;,$t.p.idPrefix+postdata[0]);} catch(e){} } else { for(var i=0;i&lt;postdata.length;i++) { $($t).jqGrid(&quot;delRowData&quot;,$t.p.idPrefix+ postdata[i]); } } $t.p.selrow = null; $t.p.selarrrow = []; } if($.isFunction(rp_ge[$t.p.id].afterComplete)) { setTimeout(function(){rp_ge[$t.p.id].afterComplete.call($t,data,postdata);},500); } } rp_ge[$t.p.id].processing=false; $(&quot;#dData&quot;, &quot;#&quot;+dtbl+&quot;_2&quot;).removeClass('ui-state-active'); if(ret[0]) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});} } }, $.jgrid.ajaxOptions, rp_ge[$t.p.id].ajaxDelOptions); if (!ajaxOptions.url &amp;&amp; !rp_ge[$t.p.id].useDataProxy) { if ($.isFunction($t.p.dataProxy)) { rp_ge[$t.p.id].useDataProxy = true; } else { ret[0]=false;ret[1] += &quot; &quot;+$.jgrid.errors.nourl; } } if (ret[0]) { if (rp_ge[$t.p.id].useDataProxy) { var dpret = $t.p.dataProxy.call($t, ajaxOptions, &quot;del_&quot;+$t.p.id); if(typeof(dpret) == &quot;undefined&quot;) { dpret = [true, &quot;&quot;]; } if(dpret[0] === false ) { ret[0] = false; ret[1] = dpret[1] || &quot;Error deleting the selected row!&quot; ; } else { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); } } else {$.ajax(ajaxOptions);} } } if(ret[0] === false) { $(&quot;#DelError&gt;td&quot;,&quot;#&quot;+dtbl).html(ret[1]); $(&quot;#DelError&quot;,&quot;#&quot;+dtbl).show(); } return false; }); $(&quot;#eData&quot;, &quot;#&quot;+dtbl+&quot;_2&quot;).click(function(){ $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal, onClose: rp_ge[$t.p.id].onClose}); return false; }); if(onBeforeShow) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+dtbl));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal, overlay: rp_ge[$t.p.id].overlay, modal:rp_ge[$t.p.id].modal}); if(onAfterShow) {rp_ge[$t.p.id].afterShowForm.call($t,$(&quot;#&quot;+dtbl));} } if(rp_ge[$t.p.id].closeOnEscape===true) { setTimeout(function(){$(&quot;.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).focus();},0); } }); }, navGrid : function (elem, o, pEdit,pAdd,pDel,pSearch, pView) { o = $.extend({ edit: true, editicon: &quot;ui-icon-pencil&quot;, add: true, addicon:&quot;ui-icon-plus&quot;, del: true, delicon:&quot;ui-icon-trash&quot;, search: true, searchicon:&quot;ui-icon-search&quot;, refresh: true, refreshicon:&quot;ui-icon-refresh&quot;, refreshstate: 'firstpage', view: false, viewicon : &quot;ui-icon-document&quot;, position : &quot;left&quot;, closeOnEscape : true, beforeRefresh : null, afterRefresh : null, cloneToTop : false, alertwidth : 200, alertheight : 'auto', alerttop: null, alertleft: null, alertzIndex : null }, $.jgrid.nav, o ||{}); return this.each(function() { if(this.nav) {return;} var alertIDs = {themodal:'alertmod',modalhead:'alerthd',modalcontent:'alertcnt'}, $t = this, twd, tdw; if(!$t.grid || typeof elem != 'string') {return;} if ($(&quot;#&quot;+alertIDs.themodal)[0] === undefined) { if(!o.alerttop &amp;&amp; !o.alertleft) { if (typeof window.innerWidth != 'undefined') { o.alertleft = window.innerWidth; o.alerttop = window.innerHeight; } else if (typeof document.documentElement != 'undefined' &amp;&amp; typeof document.documentElement.clientWidth != 'undefined' &amp;&amp; document.documentElement.clientWidth !== 0) { o.alertleft = document.documentElement.clientWidth; o.alerttop = document.documentElement.clientHeight; } else { o.alertleft=1024; o.alerttop=768; } o.alertleft = o.alertleft/2 - parseInt(o.alertwidth,10)/2; o.alerttop = o.alerttop/2-25; } $.jgrid.createModal(alertIDs,&quot;&lt;div&gt;&quot;+o.alerttext+&quot;&lt;/div&gt;&lt;span tabindex='0'&gt;&lt;span tabindex='-1' id='jqg_alrt'&gt;&lt;/span&gt;&lt;/span&gt;&quot;,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqModal:true,drag:true,resize:true,caption:o.alertcap,top:o.alerttop,left:o.alertleft,width:o.alertwidth,height: o.alertheight,closeOnEscape:o.closeOnEscape, zIndex: o.alertzIndex},&quot;&quot;,&quot;&quot;,true); } var clone = 1; if(o.cloneToTop &amp;&amp; $t.p.toppager) {clone = 2;} for(var i = 0; i&lt;clone; i++) { var tbd, navtbl = $(&quot;&lt;table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), sep = &quot;&lt;td class='ui-pg-button ui-state-disabled' style='width:4px;'&gt;&lt;span class='ui-separator'&gt;&lt;/span&gt;&lt;/td&gt;&quot;, pgid, elemids; if(i===0) { pgid = elem; elemids = $t.p.id; if(pgid == $t.p.toppager) { elemids += &quot;_top&quot;; clone = 1; } } else { pgid = $t.p.toppager; elemids = $t.p.id+&quot;_top&quot;; } if($t.p.direction == &quot;rtl&quot;) {$(navtbl).attr(&quot;dir&quot;,&quot;rtl&quot;).css(&quot;float&quot;,&quot;right&quot;);} if (o.add) { pAdd = pAdd || {}; tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.addicon+&quot;'&gt;&lt;/span&gt;&quot;+o.addtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.addtitle || &quot;&quot;,id : pAdd.id || &quot;add_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { if ($.isFunction( o.addfunc )) { o.addfunc.call($t); } else { $($t).jqGrid(&quot;editGridRow&quot;,&quot;new&quot;,pAdd); } } return false; }).hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); tbd = null; } if (o.edit) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pEdit = pEdit || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.editicon+&quot;'&gt;&lt;/span&gt;&quot;+o.edittext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.edittitle || &quot;&quot;,id: pEdit.id || &quot;edit_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { var sr = $t.p.selrow; if (sr) { if($.isFunction( o.editfunc ) ) { o.editfunc.call($t, sr); } else { $($t).jqGrid(&quot;editGridRow&quot;,sr,pEdit); } } else { $.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true}); $(&quot;#jqg_alrt&quot;).focus(); } } return false; }).hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); tbd = null; } if (o.view) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pView = pView || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.viewicon+&quot;'&gt;&lt;/span&gt;&quot;+o.viewtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.viewtitle || &quot;&quot;,id: pView.id || &quot;view_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { var sr = $t.p.selrow; if (sr) { if($.isFunction( o.viewfunc ) ) { o.viewfunc.call($t, sr); } else { $($t).jqGrid(&quot;viewGridRow&quot;,sr,pView); } } else { $.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true}); $(&quot;#jqg_alrt&quot;).focus(); } } return false; }).hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); tbd = null; } if (o.del) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pDel = pDel || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.delicon+&quot;'&gt;&lt;/span&gt;&quot;+o.deltext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.deltitle || &quot;&quot;,id: pDel.id || &quot;del_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { var dr; if($t.p.multiselect) { dr = $t.p.selarrrow; if(dr.length===0) {dr = null;} } else { dr = $t.p.selrow; } if(dr){ if($.isFunction( o.delfunc )){ o.delfunc.call($t, dr); }else{ $($t).jqGrid(&quot;delGridRow&quot;,dr,pDel); } } else { $.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } return false; }).hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); tbd = null; } if(o.add || o.edit || o.del || o.view) {$(&quot;tr&quot;,navtbl).append(sep);} if (o.search) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pSearch = pSearch || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.searchicon+&quot;'&gt;&lt;/span&gt;&quot;+o.searchtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.searchtitle || &quot;&quot;,id:pSearch.id || &quot;search_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { if($.isFunction( o.searchfunc )) { o.searchfunc.call($t, pSearch); } else { $($t).jqGrid(&quot;searchGrid&quot;,pSearch); } } return false; }).hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); if (pSearch.showOnLoad &amp;&amp; pSearch.showOnLoad === true) { $(tbd,navtbl).click(); } tbd = null; } if (o.refresh) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.refreshicon+&quot;'&gt;&lt;/span&gt;&quot;+o.refreshtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.refreshtitle || &quot;&quot;,id: &quot;refresh_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { if($.isFunction(o.beforeRefresh)) {o.beforeRefresh.call($t);} $t.p.search = false; try { var gID = $t.p.id; $t.p.postData.filters =&quot;&quot;; $(&quot;#fbox_&quot;+$.jgrid.jqID(gID)).jqFilter('resetFilter'); if($.isFunction($t.clearToolbar)) {$t.clearToolbar.call($t,false);} } catch (e) {} switch (o.refreshstate) { case 'firstpage': $($t).trigger(&quot;reloadGrid&quot;, [{page:1}]); break; case 'current': $($t).trigger(&quot;reloadGrid&quot;, [{current:true}]); break; } if($.isFunction(o.afterRefresh)) {o.afterRefresh.call($t);} } return false; }).hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); tbd = null; } tdw = $(&quot;.ui-jqgrid&quot;).css(&quot;font-size&quot;) || &quot;11px&quot;; $('body').append(&quot;&lt;div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:&quot;+tdw+&quot;;visibility:hidden;' &gt;&lt;/div&gt;&quot;); twd = $(navtbl).clone().appendTo(&quot;#testpg2&quot;).width(); $(&quot;#testpg2&quot;).remove(); $(pgid+&quot;_&quot;+o.position,pgid).append(navtbl); if($t.p._nvtd) { if(twd &gt; $t.p._nvtd[0] ) { $(pgid+&quot;_&quot;+o.position,pgid).width(twd); $t.p._nvtd[0] = twd; } $t.p._nvtd[1] = twd; } tdw =null;twd=null;navtbl =null; this.nav = true; } }); }, navButtonAdd : function (elem, p) { p = $.extend({ caption : &quot;newButton&quot;, title: '', buttonicon : 'ui-icon-newwin', onClickButton: null, position : &quot;last&quot;, cursor : 'pointer' }, p ||{}); return this.each(function() { if( !this.grid) {return;} if( typeof elem === &quot;string&quot; &amp;&amp; elem.indexOf(&quot;#&quot;) !== 0) {elem = &quot;#&quot;+$.jgrid.jqID(elem);} var findnav = $(&quot;.navtable&quot;,elem)[0], $t = this; if (findnav) { if( p.id &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(p.id), findnav)[0] !== undefined ) {return;} var tbd = $(&quot;&lt;td&gt;&lt;/td&gt;&quot;); if(p.buttonicon.toString().toUpperCase() == &quot;NONE&quot;) { $(tbd).addClass('ui-pg-button ui-corner-all').append(&quot;&lt;div class='ui-pg-div'&gt;&quot;+p.caption+&quot;&lt;/div&gt;&quot;); } else { $(tbd).addClass('ui-pg-button ui-corner-all').append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+p.buttonicon+&quot;'&gt;&lt;/span&gt;&quot;+p.caption+&quot;&lt;/div&gt;&quot;); } if(p.id) {$(tbd).attr(&quot;id&quot;,p.id);} if(p.position=='first'){ if(findnav.rows[0].cells.length ===0 ) { $(&quot;tr&quot;,findnav).append(tbd); } else { $(&quot;tr td:eq(0)&quot;,findnav).before(tbd); } } else { $(&quot;tr&quot;,findnav).append(tbd); } $(tbd,findnav) .attr(&quot;title&quot;,p.title || &quot;&quot;) .click(function(e){ if (!$(this).hasClass('ui-state-disabled')) { if ($.isFunction(p.onClickButton) ) {p.onClickButton.call($t,e);} } return false; }) .hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass('ui-state-hover'); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); } }); }, navSeparatorAdd:function (elem,p) { p = $.extend({ sepclass : &quot;ui-separator&quot;, sepcontent: '' }, p ||{}); return this.each(function() { if( !this.grid) {return;} if( typeof elem === &quot;string&quot; &amp;&amp; elem.indexOf(&quot;#&quot;) !== 0) {elem = &quot;#&quot;+$.jgrid.jqID(elem);} var findnav = $(&quot;.navtable&quot;,elem)[0]; if(findnav) { var sep = &quot;&lt;td class='ui-pg-button ui-state-disabled' style='width:4px;'&gt;&lt;span class='&quot;+p.sepclass+&quot;'&gt;&lt;/span&gt;&quot;+p.sepcontent+&quot;&lt;/td&gt;&quot;; $(&quot;tr&quot;,findnav).append(sep); } }); }, GridToForm : function( rowid, formid ) { return this.each(function(){ var $t = this; if (!$t.grid) {return;} var rowdata = $($t).jqGrid(&quot;getRowData&quot;,rowid); if (rowdata) { for(var i in rowdata) { if ( $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).is(&quot;input:radio&quot;) || $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).is(&quot;input:checkbox&quot;)) { $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).each( function() { if( $(this).val() == rowdata[i] ) { $(this)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); } else { $(this)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); } }); } else { // this is very slow on big table and form. $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).val(rowdata[i]); } } } }); }, FormToGrid : function(rowid, formid, mode, position){ return this.each(function() { var $t = this; if(!$t.grid) {return;} if(!mode) {mode = 'set';} if(!position) {position = 'first';} var fields = $(formid).serializeArray(); var griddata = {}; $.each(fields, function(i, field){ griddata[field.name] = field.value; }); if(mode=='add') {$($t).jqGrid(&quot;addRowData&quot;,rowid,griddata, position);} else if(mode=='set') {$($t).jqGrid(&quot;setRowData&quot;,rowid,griddata);} }); } }); })(jQuery); ;(function($){ /** * jqGrid extension for manipulating Grid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ //jsHint options /*global alert, $, jQuery */ &quot;use strict&quot;; $.jgrid.inlineEdit = $.jgrid.inlineEdit || {}; $.jgrid.extend({ //Editing editRow : function(rowid,keys,oneditfunc,successfunc, url, extraparam, aftersavefunc,errorfunc, afterrestorefunc) { // Compatible mode old versions var o={}, args = $.makeArray(arguments).slice(1); if( $.type(args[0]) === &quot;object&quot; ) { o = args[0]; } else { if (typeof keys !== &quot;undefined&quot;) { o.keys = keys; } if ($.isFunction(oneditfunc)) { o.oneditfunc = oneditfunc; } if ($.isFunction(successfunc)) { o.successfunc = successfunc; } if (typeof url !== &quot;undefined&quot;) { o.url = url; } if (typeof extraparam !== &quot;undefined&quot;) { o.extraparam = extraparam; } if ($.isFunction(aftersavefunc)) { o.aftersavefunc = aftersavefunc; } if ($.isFunction(errorfunc)) { o.errorfunc = errorfunc; } if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; } // last two not as param, but as object (sorry) //if (typeof restoreAfterError !== &quot;undefined&quot;) { o.restoreAfterError = restoreAfterError; } //if (typeof mtype !== &quot;undefined&quot;) { o.mtype = mtype || &quot;POST&quot;; } } o = $.extend(true, { keys : false, oneditfunc: null, successfunc: null, url: null, extraparam: {}, aftersavefunc: null, errorfunc: null, afterrestorefunc: null, restoreAfterError: true, mtype: &quot;POST&quot; }, $.jgrid.inlineEdit, o ); // End compatible return this.each(function(){ var $t = this, nm, tmp, editable, cnt=0, focus=null, svr={}, ind,cm; if (!$t.grid ) { return; } ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true); if( ind === false ) {return;} editable = $(ind).attr(&quot;editable&quot;) || &quot;0&quot;; if (editable == &quot;0&quot; &amp;&amp; !$(ind).hasClass(&quot;not-editable-row&quot;)) { cm = $t.p.colModel; $('td[role=&quot;gridcell&quot;]',ind).each( function(i) { nm = cm[i].name; var treeg = $t.p.treeGrid===true &amp;&amp; nm == $t.p.ExpandColumn; if(treeg) { tmp = $(&quot;span:first&quot;,this).html();} else { try { tmp = $.unformat.call($t,this,{rowId:rowid, colModel:cm[i]},i); } catch (_) { tmp = ( cm[i].edittype &amp;&amp; cm[i].edittype == 'textarea' ) ? $(this).text() : $(this).html(); } } if ( nm != 'cb' &amp;&amp; nm != 'subgrid' &amp;&amp; nm != 'rn') { if($t.p.autoencode) { tmp = $.jgrid.htmlDecode(tmp); } svr[nm]=tmp; if(cm[i].editable===true) { if(focus===null) { focus = i; } if (treeg) { $(&quot;span:first&quot;,this).html(&quot;&quot;); } else { $(this).html(&quot;&quot;); } var opt = $.extend({},cm[i].editoptions || {},{id:rowid+&quot;_&quot;+nm,name:nm}); if(!cm[i].edittype) { cm[i].edittype = &quot;text&quot;; } if(tmp == &quot;&amp;nbsp;&quot; || tmp == &quot;&amp;#160;&quot; || (tmp.length==1 &amp;&amp; tmp.charCodeAt(0)==160) ) {tmp='';} var elc = $.jgrid.createEl.call($t,cm[i].edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions || {})); $(elc).addClass(&quot;editable&quot;); if(treeg) { $(&quot;span:first&quot;,this).append(elc); } else { $(this).append(elc); } //Again IE if(cm[i].edittype == &quot;select&quot; &amp;&amp; typeof(cm[i].editoptions)!==&quot;undefined&quot; &amp;&amp; cm[i].editoptions.multiple===true &amp;&amp; typeof(cm[i].editoptions.dataUrl)===&quot;undefined&quot; &amp;&amp; $.browser.msie) { $(elc).width($(elc).width()); } cnt++; } } }); if(cnt &gt; 0) { svr.id = rowid; $t.p.savedRow.push(svr); $(ind).attr(&quot;editable&quot;,&quot;1&quot;); $(&quot;td:eq(&quot;+focus+&quot;) input&quot;,ind).focus(); if(o.keys===true) { $(ind).bind(&quot;keydown&quot;,function(e) { if (e.keyCode === 27) { $($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc); if($t.p._inlinenav) { try { $($t).jqGrid('showAddEditButtons'); } catch (eer1) {} } return false; } if (e.keyCode === 13) { var ta = e.target; if(ta.tagName == 'TEXTAREA') { return true; } if( $($t).jqGrid(&quot;saveRow&quot;, rowid, o ) ) { if($t.p._inlinenav) { try { $($t).jqGrid('showAddEditButtons'); } catch (eer2) {} } } return false; } }); } $($t).triggerHandler(&quot;jqGridInlineEditRow&quot;, [rowid, o]); if( $.isFunction(o.oneditfunc)) { o.oneditfunc.call($t, rowid); } } } }); }, saveRow : function(rowid, successfunc, url, extraparam, aftersavefunc,errorfunc, afterrestorefunc) { // Compatible mode old versions var args = $.makeArray(arguments).slice(1), o = {}; if( $.type(args[0]) === &quot;object&quot; ) { o = args[0]; } else { if ($.isFunction(successfunc)) { o.successfunc = successfunc; } if (typeof url !== &quot;undefined&quot;) { o.url = url; } if (typeof extraparam !== &quot;undefined&quot;) { o.extraparam = extraparam; } if ($.isFunction(aftersavefunc)) { o.aftersavefunc = aftersavefunc; } if ($.isFunction(errorfunc)) { o.errorfunc = errorfunc; } if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; } } o = $.extend(true, { successfunc: null, url: null, extraparam: {}, aftersavefunc: null, errorfunc: null, afterrestorefunc: null, restoreAfterError: true, mtype: &quot;POST&quot; }, $.jgrid.inlineEdit, o ); // End compatible var success = false; var $t = this[0], nm, tmp={}, tmp2={}, tmp3= {}, editable, fr, cv, ind; if (!$t.grid ) { return success; } ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true); if(ind === false) {return success;} editable = $(ind).attr(&quot;editable&quot;); o.url = o.url ? o.url : $t.p.editurl; if (editable===&quot;1&quot;) { var cm; $('td[role=&quot;gridcell&quot;]',ind).each(function(i) { cm = $t.p.colModel[i]; nm = cm.name; if ( nm != 'cb' &amp;&amp; nm != 'subgrid' &amp;&amp; cm.editable===true &amp;&amp; nm != 'rn' &amp;&amp; !$(this).hasClass('not-editable-cell')) { switch (cm.edittype) { case &quot;checkbox&quot;: var cbv = [&quot;Yes&quot;,&quot;No&quot;]; if(cm.editoptions ) { cbv = cm.editoptions.value.split(&quot;:&quot;); } tmp[nm]= $(&quot;input&quot;,this).is(&quot;:checked&quot;) ? cbv[0] : cbv[1]; break; case 'text': case 'password': case 'textarea': case &quot;button&quot; : tmp[nm]=$(&quot;input, textarea&quot;,this).val(); break; case 'select': if(!cm.editoptions.multiple) { tmp[nm] = $(&quot;select option:selected&quot;,this).val(); tmp2[nm] = $(&quot;select option:selected&quot;, this).text(); } else { var sel = $(&quot;select&quot;,this), selectedText = []; tmp[nm] = $(sel).val(); if(tmp[nm]) { tmp[nm]= tmp[nm].join(&quot;,&quot;); } else { tmp[nm] =&quot;&quot;; } $(&quot;select option:selected&quot;,this).each( function(i,selected){ selectedText[i] = $(selected).text(); } ); tmp2[nm] = selectedText.join(&quot;,&quot;); } if(cm.formatter &amp;&amp; cm.formatter == 'select') { tmp2={}; } break; case 'custom' : try { if(cm.editoptions &amp;&amp; $.isFunction(cm.editoptions.custom_value)) { tmp[nm] = cm.editoptions.custom_value.call($t, $(&quot;.customelement&quot;,this),'get'); if (tmp[nm] === undefined) { throw &quot;e2&quot;; } } else { throw &quot;e1&quot;; } } catch (e) { if (e==&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose); } if (e==&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose); } else { $.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose); } } break; } cv = $.jgrid.checkValues(tmp[nm],i,$t); if(cv[0] === false) { cv[1] = tmp[nm] + &quot; &quot; + cv[1]; return false; } if($t.p.autoencode) { tmp[nm] = $.jgrid.htmlEncode(tmp[nm]); } if(o.url !== 'clientArray' &amp;&amp; cm.editoptions &amp;&amp; cm.editoptions.NullIfEmpty === true) { if(tmp[nm] === &quot;&quot;) { tmp3[nm] = 'null'; } } } }); if (cv[0] === false){ try { var positions = $.jgrid.findPos($(&quot;#&quot;+$.jgrid.jqID(rowid), $t.grid.bDiv)[0]); $.jgrid.info_dialog($.jgrid.errors.errcap,cv[1],$.jgrid.edit.bClose,{left:positions[0],top:positions[1]}); } catch (e) { alert(cv[1]); } return success; } var idname, opers, oper; opers = $t.p.prmNames; oper = opers.oper; idname = opers.id; if(tmp) { tmp[oper] = opers.editoper; tmp[idname] = rowid; if(typeof($t.p.inlineData) == 'undefined') { $t.p.inlineData ={}; } tmp = $.extend({},tmp,$t.p.inlineData,o.extraparam); } if (o.url == 'clientArray') { tmp = $.extend({},tmp, tmp2); if($t.p.autoencode) { $.each(tmp,function(n,v){ tmp[n] = $.jgrid.htmlDecode(v); }); } var resp = $($t).jqGrid(&quot;setRowData&quot;,rowid,tmp); $(ind).attr(&quot;editable&quot;,&quot;0&quot;); for( var k=0;k&lt;$t.p.savedRow.length;k++) { if( $t.p.savedRow[k].id == rowid) {fr = k; break;} } if(fr &gt;= 0) { $t.p.savedRow.splice(fr,1); } $($t).triggerHandler(&quot;jqGridInlineAfterSaveRow&quot;, [rowid, resp, tmp, o]); if( $.isFunction(o.aftersavefunc) ) { o.aftersavefunc.call($t, rowid,resp, o); } success = true; $(ind).unbind(&quot;keydown&quot;); } else { $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).show(); tmp3 = $.extend({},tmp,tmp3); tmp3[idname] = $.jgrid.stripPref($t.p.idPrefix, tmp3[idname]); $.ajax($.extend({ url:o.url, data: $.isFunction($t.p.serializeRowData) ? $t.p.serializeRowData.call($t, tmp3) : tmp3, type: o.mtype, async : false, //?!? complete: function(res,stat){ $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide(); if (stat === &quot;success&quot;){ var ret = true, sucret; sucret = $($t).triggerHandler(&quot;jqGridInlineSuccessSaveRow&quot;, [res, rowid, o]); if (!$.isArray(sucret)) {sucret = [true, tmp];} if (sucret[0] &amp;&amp; $.isFunction(o.successfunc)) {sucret = o.successfunc.call($t, res);} if($.isArray(sucret)) { // expect array - status, data, rowid ret = sucret[0]; tmp = sucret[1] ? sucret[1] : tmp; } else { ret = sucret; } if (ret===true) { if($t.p.autoencode) { $.each(tmp,function(n,v){ tmp[n] = $.jgrid.htmlDecode(v); }); } tmp = $.extend({},tmp, tmp2); $($t).jqGrid(&quot;setRowData&quot;,rowid,tmp); $(ind).attr(&quot;editable&quot;,&quot;0&quot;); for( var k=0;k&lt;$t.p.savedRow.length;k++) { if( $t.p.savedRow[k].id == rowid) {fr = k; break;} } if(fr &gt;= 0) { $t.p.savedRow.splice(fr,1); } $($t).triggerHandler(&quot;jqGridInlineAfterSaveRow&quot;, [rowid, res, tmp, o]); if( $.isFunction(o.aftersavefunc) ) { o.aftersavefunc.call($t, rowid,res); } success = true; $(ind).unbind(&quot;keydown&quot;); } else { $($t).triggerHandler(&quot;jqGridInlineErrorSaveRow&quot;, [rowid, res, stat, null, o]); if($.isFunction(o.errorfunc) ) { o.errorfunc.call($t, rowid, res, stat, null); } if(o.restoreAfterError === true) { $($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc); } } } }, error:function(res,stat,err){ $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide(); $($t).triggerHandler(&quot;jqGridInlineErrorSaveRow&quot;, [rowid, res, stat, err, o]); if($.isFunction(o.errorfunc) ) { o.errorfunc.call($t, rowid, res, stat, err); } else { var rT = res.responseText || res.statusText; try { $.jgrid.info_dialog($.jgrid.errors.errcap,'&lt;div class=&quot;ui-state-error&quot;&gt;'+ rT +'&lt;/div&gt;', $.jgrid.edit.bClose,{buttonalign:'right'}); } catch(e) { alert(rT); } } if(o.restoreAfterError === true) { $($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc); } } }, $.jgrid.ajaxOptions, $t.p.ajaxRowOptions || {})); } } return success; }, restoreRow : function(rowid, afterrestorefunc) { // Compatible mode old versions var args = $.makeArray(arguments).slice(1), o={}; if( $.type(args[0]) === &quot;object&quot; ) { o = args[0]; } else { if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; } } o = $.extend(true, $.jgrid.inlineEdit, o ); // End compatible return this.each(function(){ var $t= this, fr, ind, ares={}; if (!$t.grid ) { return; } ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true); if(ind === false) {return;} for( var k=0;k&lt;$t.p.savedRow.length;k++) { if( $t.p.savedRow[k].id == rowid) {fr = k; break;} } if(fr &gt;= 0) { if($.isFunction($.fn.datepicker)) { try { $(&quot;input.hasDatepicker&quot;,&quot;#&quot;+$.jgrid.jqID(ind.id)).datepicker('hide'); } catch (e) {} } $.each($t.p.colModel, function(){ if(this.editable === true &amp;&amp; this.name in $t.p.savedRow[fr] ) { ares[this.name] = $t.p.savedRow[fr][this.name]; } }); $($t).jqGrid(&quot;setRowData&quot;,rowid,ares); $(ind).attr(&quot;editable&quot;,&quot;0&quot;).unbind(&quot;keydown&quot;); $t.p.savedRow.splice(fr,1); if($(&quot;#&quot;+$.jgrid.jqID(rowid), &quot;#&quot;+$.jgrid.jqID($t.p.id)).hasClass(&quot;jqgrid-new-row&quot;)){ setTimeout(function(){$($t).jqGrid(&quot;delRowData&quot;,rowid);},0); } } $($t).triggerHandler(&quot;jqGridInlineAfterRestoreRow&quot;, [rowid]); if ($.isFunction(o.afterrestorefunc)) { o.afterrestorefunc.call($t, rowid); } }); }, addRow : function ( p ) { p = $.extend(true, { rowID : &quot;new_row&quot;, initdata : {}, position :&quot;first&quot;, useDefValues : true, useFormatter : false, addRowParams : {extraparam:{}} },p || {}); return this.each(function(){ if (!this.grid ) { return; } var $t = this; if(p.useDefValues === true) { $($t.p.colModel).each(function(){ if( this.editoptions &amp;&amp; this.editoptions.defaultValue ) { var opt = this.editoptions.defaultValue, tmp = $.isFunction(opt) ? opt.call($t) : opt; p.initdata[this.name] = tmp; } }); } $($t).jqGrid('addRowData', p.rowID, p.initdata, p.position); p.rowID = $t.p.idPrefix + p.rowID; $(&quot;#&quot;+$.jgrid.jqID(p.rowID), &quot;#&quot;+$.jgrid.jqID($t.p.id)).addClass(&quot;jqgrid-new-row&quot;); if(p.useFormatter) { $(&quot;#&quot;+$.jgrid.jqID(p.rowID)+&quot; .ui-inline-edit&quot;, &quot;#&quot;+$.jgrid.jqID($t.p.id)).click(); } else { var opers = $t.p.prmNames, oper = opers.oper; p.addRowParams.extraparam[oper] = opers.addoper; $($t).jqGrid('editRow', p.rowID, p.addRowParams); $($t).jqGrid('setSelection', p.rowID); } }); }, inlineNav : function (elem, o) { o = $.extend({ edit: true, editicon: &quot;ui-icon-pencil&quot;, add: true, addicon:&quot;ui-icon-plus&quot;, save: true, saveicon:&quot;ui-icon-disk&quot;, cancel: true, cancelicon:&quot;ui-icon-cancel&quot;, addParams : {useFormatter : false,rowID : &quot;new_row&quot;}, editParams : {}, restoreAfterSelect : true }, $.jgrid.nav, o ||{}); return this.each(function(){ if (!this.grid ) { return; } var $t = this, onSelect, gID = $.jgrid.jqID($t.p.id); $t.p._inlinenav = true; // detect the formatactions column if(o.addParams.useFormatter === true) { var cm = $t.p.colModel,i; for (i = 0; i&lt;cm.length; i++) { if(cm[i].formatter &amp;&amp; cm[i].formatter === &quot;actions&quot; ) { if(cm[i].formatoptions) { var defaults = { keys:false, onEdit : null, onSuccess: null, afterSave:null, onError: null, afterRestore: null, extraparam: {}, url: null }, ap = $.extend( defaults, cm[i].formatoptions ); o.addParams.addRowParams = { &quot;keys&quot; : ap.keys, &quot;oneditfunc&quot; : ap.onEdit, &quot;successfunc&quot; : ap.onSuccess, &quot;url&quot; : ap.url, &quot;extraparam&quot; : ap.extraparam, &quot;aftersavefunc&quot; : ap.afterSavef, &quot;errorfunc&quot;: ap.onError, &quot;afterrestorefunc&quot; : ap.afterRestore }; } break; } } } if(o.add) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.addtext, title : o.addtitle, buttonicon : o.addicon, id : $t.p.id+&quot;_iladd&quot;, onClickButton : function () { $($t).jqGrid('addRow', o.addParams); if(!o.addParams.useFormatter) { $(&quot;#&quot;+gID+&quot;_ilsave&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iladd&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iledit&quot;).addClass('ui-state-disabled'); } } }); } if(o.edit) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.edittext, title : o.edittitle, buttonicon : o.editicon, id : $t.p.id+&quot;_iledit&quot;, onClickButton : function () { var sr = $($t).jqGrid('getGridParam','selrow'); if(sr) { $($t).jqGrid('editRow', sr, o.editParams); $(&quot;#&quot;+gID+&quot;_ilsave&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iladd&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iledit&quot;).addClass('ui-state-disabled'); } else { $.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } }); } if(o.save) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.savetext || '', title : o.savetitle || 'Save row', buttonicon : o.saveicon, id : $t.p.id+&quot;_ilsave&quot;, onClickButton : function () { var sr = $t.p.savedRow[0].id; if(sr) { var opers = $t.p.prmNames, oper = opers.oper; if(!o.editParams.extraparam) { o.editParams.extraparam = {}; } if($(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+gID ).hasClass(&quot;jqgrid-new-row&quot;)) { o.editParams.extraparam[oper] = opers.addoper; } else { o.editParams.extraparam[oper] = opers.editoper; } if( $($t).jqGrid('saveRow', sr, o.editParams) ) { $($t).jqGrid('showAddEditButtons'); } } else { $.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } }); $(&quot;#&quot;+gID+&quot;_ilsave&quot;).addClass('ui-state-disabled'); } if(o.cancel) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.canceltext || '', title : o.canceltitle || 'Cancel row editing', buttonicon : o.cancelicon, id : $t.p.id+&quot;_ilcancel&quot;, onClickButton : function () { var sr = $t.p.savedRow[0].id; if(sr) { $($t).jqGrid('restoreRow', sr, o.editParams); $($t).jqGrid('showAddEditButtons'); } else { $.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } }); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).addClass('ui-state-disabled'); } if(o.restoreAfterSelect === true) { if($.isFunction($t.p.beforeSelectRow)) { onSelect = $t.p.beforeSelectRow; } else { onSelect = false; } $t.p.beforeSelectRow = function(id, stat) { var ret = true; if($t.p.savedRow.length &gt; 0 &amp;&amp; $t.p._inlinenav===true &amp;&amp; ( id !== $t.p.selrow &amp;&amp; $t.p.selrow !==null) ) { if($t.p.selrow == o.addParams.rowID ) { $($t).jqGrid('delRowData', $t.p.selrow); } else { $($t).jqGrid('restoreRow', $t.p.selrow, o.editParams); } $($t).jqGrid('showAddEditButtons'); } if(onSelect) { ret = onSelect.call($t, id, stat); } return ret; }; } }); }, showAddEditButtons : function() { return this.each(function(){ if (!this.grid ) { return; } var gID = $.jgrid.jqID(this.p.id); $(&quot;#&quot;+gID+&quot;_ilsave&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iladd&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iledit&quot;).removeClass('ui-state-disabled'); }); } //end inline edit }); })(jQuery); ;(function($){ /* ** * jqGrid extension for cellediting Grid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ /** * all events and options here are aded anonynous and not in the base grid * since the array is to big. Here is the order of execution. * From this point we use jQuery isFunction * formatCell * beforeEditCell, * onSelectCell (used only for noneditable cels) * afterEditCell, * beforeSaveCell, (called before validation of values if any) * beforeSubmitCell (if cellsubmit remote (ajax)) * afterSubmitCell(if cellsubmit remote (ajax)), * afterSaveCell, * errorCell, * serializeCellData - new * Options * cellsubmit (remote,clientArray) (added in grid options) * cellurl * ajaxCellOptions * */ &quot;use strict&quot;; $.jgrid.extend({ editCell : function (iRow,iCol, ed){ return this.each(function (){ var $t = this, nm, tmp,cc, cm; if (!$t.grid || $t.p.cellEdit !== true) {return;} iCol = parseInt(iCol,10); // select the row that can be used for other methods $t.p.selrow = $t.rows[iRow].id; if (!$t.p.knv) {$($t).jqGrid(&quot;GridNav&quot;);} // check to see if we have already edited cell if ($t.p.savedRow.length&gt;0) { // prevent second click on that field and enable selects if (ed===true ) { if(iRow == $t.p.iRow &amp;&amp; iCol == $t.p.iCol){ return; } } // save the cell $($t).jqGrid(&quot;saveCell&quot;,$t.p.savedRow[0].id,$t.p.savedRow[0].ic); } else { window.setTimeout(function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0); } cm = $t.p.colModel[iCol]; nm = cm.name; if (nm=='subgrid' || nm=='cb' || nm=='rn') {return;} cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]); if (cm.editable===true &amp;&amp; ed===true &amp;&amp; !cc.hasClass(&quot;not-editable-cell&quot;)) { if(parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) { $(&quot;td:eq(&quot;+$t.p.iCol+&quot;)&quot;,$t.rows[$t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[$t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;); } $(cc).addClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[iRow]).addClass(&quot;selected-row ui-state-hover&quot;); try { tmp = $.unformat.call($t,cc,{rowId: $t.rows[iRow].id, colModel:cm},iCol); } catch (_) { tmp = ( cm.edittype &amp;&amp; cm.edittype == 'textarea' ) ? $(cc).text() : $(cc).html(); } if($t.p.autoencode) { tmp = $.jgrid.htmlDecode(tmp); } if (!cm.edittype) {cm.edittype = &quot;text&quot;;} $t.p.savedRow.push({id:iRow,ic:iCol,name:nm,v:tmp}); if(tmp === &quot;&amp;nbsp;&quot; || tmp === &quot;&amp;#160;&quot; || (tmp.length===1 &amp;&amp; tmp.charCodeAt(0)===160) ) {tmp='';} if($.isFunction($t.p.formatCell)) { var tmp2 = $t.p.formatCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); if(tmp2 !== undefined ) {tmp = tmp2;} } var opt = $.extend({}, cm.editoptions || {} ,{id:iRow+&quot;_&quot;+nm,name:nm}); var elc = $.jgrid.createEl.call($t,cm.edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions || {})); $($t).triggerHandler(&quot;jqGridBeforeEditCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]); if ($.isFunction($t.p.beforeEditCell)) { $t.p.beforeEditCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); } $(cc).html(&quot;&quot;).append(elc).attr(&quot;tabindex&quot;,&quot;0&quot;); window.setTimeout(function () { $(elc).focus();},0); $(&quot;input, select, textarea&quot;,cc).bind(&quot;keydown&quot;,function(e) { if (e.keyCode === 27) { if($(&quot;input.hasDatepicker&quot;,cc).length &gt;0) { if( $(&quot;.ui-datepicker&quot;).is(&quot;:hidden&quot;) ) { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } else { $(&quot;input.hasDatepicker&quot;,cc).datepicker('hide'); } } else { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } //ESC if (e.keyCode === 13) { $($t).jqGrid(&quot;saveCell&quot;,iRow,iCol); // Prevent default action return false; } //Enter if (e.keyCode === 9) { if(!$t.grid.hDiv.loading ) { if (e.shiftKey) {$($t).jqGrid(&quot;prevCell&quot;,iRow,iCol);} //Shift TAb else {$($t).jqGrid(&quot;nextCell&quot;,iRow,iCol);} //Tab } else { return false; } } e.stopPropagation(); }); $($t).triggerHandler(&quot;jqGridAfterEditCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]); if ($.isFunction($t.p.afterEditCell)) { $t.p.afterEditCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); } } else { if (parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) { $(&quot;td:eq(&quot;+$t.p.iCol+&quot;)&quot;,$t.rows[$t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[$t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;); } cc.addClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[iRow]).addClass(&quot;selected-row ui-state-hover&quot;); tmp = cc.html().replace(/\\&amp;#160\\;/ig,''); $($t).triggerHandler(&quot;jqGridSelectCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]); if ($.isFunction($t.p.onSelectCell)) { $t.p.onSelectCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); } } $t.p.iCol = iCol; $t.p.iRow = iRow; }); }, saveCell : function (iRow, iCol){ return this.each(function(){ var $t= this, fr; if (!$t.grid || $t.p.cellEdit !== true) {return;} if ( $t.p.savedRow.length &gt;= 1) {fr = 0;} else {fr=null;} if(fr !== null) { var cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]),v,v2, cm = $t.p.colModel[iCol], nm = cm.name, nmjq = $.jgrid.jqID(nm) ; switch (cm.edittype) { case &quot;select&quot;: if(!cm.editoptions.multiple) { v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq+&quot; option:selected&quot;,$t.rows[iRow]).val(); v2 = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq+&quot; option:selected&quot;,$t.rows[iRow]).text(); } else { var sel = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]), selectedText = []; v = $(sel).val(); if(v) { v.join(&quot;,&quot;);} else { v=&quot;&quot;; } $(&quot;option:selected&quot;,sel).each( function(i,selected){ selectedText[i] = $(selected).text(); } ); v2 = selectedText.join(&quot;,&quot;); } if(cm.formatter) { v2 = v; } break; case &quot;checkbox&quot;: var cbv = [&quot;Yes&quot;,&quot;No&quot;]; if(cm.editoptions){ cbv = cm.editoptions.value.split(&quot;:&quot;); } v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]).is(&quot;:checked&quot;) ? cbv[0] : cbv[1]; v2=v; break; case &quot;password&quot;: case &quot;text&quot;: case &quot;textarea&quot;: case &quot;button&quot; : v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]).val(); v2=v; break; case 'custom' : try { if(cm.editoptions &amp;&amp; $.isFunction(cm.editoptions.custom_value)) { v = cm.editoptions.custom_value.call($t, $(&quot;.customelement&quot;,cc),'get'); if (v===undefined) { throw &quot;e2&quot;;} else { v2=v; } } else { throw &quot;e1&quot;; } } catch (e) { if (e==&quot;e1&quot;) { $.jgrid.info_dialog(jQuery.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose); } if (e==&quot;e2&quot;) { $.jgrid.info_dialog(jQuery.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose); } else {$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose); } } break; } // The common approach is if nothing changed do not do anything if (v2 !== $t.p.savedRow[fr].v){ var vvv = $($t).triggerHandler(&quot;jqGridBeforeSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]); if (vvv) {v = vvv; v2=vvv;} if ($.isFunction($t.p.beforeSaveCell)) { var vv = $t.p.beforeSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); if (vv) {v = vv; v2=vv;} } var cv = $.jgrid.checkValues(v,iCol,$t); if(cv[0] === true) { var addpost = $($t).triggerHandler(&quot;jqGridBeforeSubmitCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]) || {}; if ($.isFunction($t.p.beforeSubmitCell)) { addpost = $t.p.beforeSubmitCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); if (!addpost) {addpost={};} } if( $(&quot;input.hasDatepicker&quot;,cc).length &gt;0) { $(&quot;input.hasDatepicker&quot;,cc).datepicker('hide'); } if ($t.p.cellsubmit == 'remote') { if ($t.p.cellurl) { var postdata = {}; if($t.p.autoencode) { v = $.jgrid.htmlEncode(v); } postdata[nm] = v; var idname,oper, opers; opers = $t.p.prmNames; idname = opers.id; oper = opers.oper; postdata[idname] = $.jgrid.stripPref($t.p.idPrefix, $t.rows[iRow].id); postdata[oper] = opers.editoper; postdata = $.extend(addpost,postdata); $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).show(); $t.grid.hDiv.loading = true; $.ajax( $.extend( { url: $t.p.cellurl, data :$.isFunction($t.p.serializeCellData) ? $t.p.serializeCellData.call($t, postdata) : postdata, type: &quot;POST&quot;, complete: function (result, stat) { $(&quot;#lui_&quot;+$t.p.id).hide(); $t.grid.hDiv.loading = false; if (stat == 'success') { var ret = $($t).triggerHandler(&quot;jqGridAfterSubmitCell&quot;, [$t, result, postdata.id, nm, v, iRow, iCol]) || [true, '']; if (ret[0] === true &amp;&amp; $.isFunction($t.p.afterSubmitCell)) { ret = $t.p.afterSubmitCell.call($t, result,postdata.id,nm,v,iRow,iCol); } if(ret[0] === true){ $(cc).empty(); $($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id, iCol, v2, false, false, true); $(cc).addClass(&quot;dirty-cell&quot;); $($t.rows[iRow]).addClass(&quot;edited&quot;); $($t).triggerHandler(&quot;jqGridAfterSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]); if ($.isFunction($t.p.afterSaveCell)) { $t.p.afterSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); } $t.p.savedRow.splice(0,1); } else { $.jgrid.info_dialog($.jgrid.errors.errcap,ret[1],$.jgrid.edit.bClose); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } }, error:function(res,stat,err) { $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide(); $t.grid.hDiv.loading = false; $($t).triggerHandler(&quot;jqGridErrorCell&quot;, [res, stat, err]); if ($.isFunction($t.p.errorCell)) { $t.p.errorCell.call($t, res,stat,err); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } else { $.jgrid.info_dialog($.jgrid.errors.errcap,res.status+&quot; : &quot;+res.statusText+&quot;&lt;br/&gt;&quot;+stat,$.jgrid.edit.bClose); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } }, $.jgrid.ajaxOptions, $t.p.ajaxCellOptions || {})); } else { try { $.jgrid.info_dialog($.jgrid.errors.errcap,$.jgrid.errors.nourl,$.jgrid.edit.bClose); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } catch (e) {} } } if ($t.p.cellsubmit == 'clientArray') { $(cc).empty(); $($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id,iCol, v2, false, false, true); $(cc).addClass(&quot;dirty-cell&quot;); $($t.rows[iRow]).addClass(&quot;edited&quot;); $($t).triggerHandler(&quot;jqGridAfterSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]); if ($.isFunction($t.p.afterSaveCell)) { $t.p.afterSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); } $t.p.savedRow.splice(0,1); } } else { try { window.setTimeout(function(){$.jgrid.info_dialog($.jgrid.errors.errcap,v+&quot; &quot;+cv[1],$.jgrid.edit.bClose);},100); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } catch (e) {} } } else { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } if ($.browser.opera) { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus(); } else { window.setTimeout(function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0); } }); }, restoreCell : function(iRow, iCol) { return this.each(function(){ var $t= this, fr; if (!$t.grid || $t.p.cellEdit !== true ) {return;} if ( $t.p.savedRow.length &gt;= 1) {fr = 0;} else {fr=null;} if(fr !== null) { var cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]); // datepicker fix if($.isFunction($.fn.datepicker)) { try { $(&quot;input.hasDatepicker&quot;,cc).datepicker('hide'); } catch (e) {} } $(cc).empty().attr(&quot;tabindex&quot;,&quot;-1&quot;); $($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id, iCol, $t.p.savedRow[fr].v, false, false, true); $($t).triggerHandler(&quot;jqGridAfterRestoreCell&quot;, [$t.rows[iRow].id, $t.p.savedRow[fr].v, iRow, iCol]); if ($.isFunction($t.p.afterRestoreCell)) { $t.p.afterRestoreCell.call($t, $t.rows[iRow].id, $t.p.savedRow[fr].v, iRow, iCol); } $t.p.savedRow.splice(0,1); } window.setTimeout(function () { $(&quot;#&quot;+$t.p.knv).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0); }); }, nextCell : function (iRow,iCol) { return this.each(function (){ var $t = this, nCol=false; if (!$t.grid || $t.p.cellEdit !== true) {return;} // try to find next editable cell for (var i=iCol+1; i&lt;$t.p.colModel.length; i++) { if ( $t.p.colModel[i].editable ===true) { nCol = i; break; } } if(nCol !== false) { $($t).jqGrid(&quot;editCell&quot;,iRow,nCol,true); } else { if ($t.p.savedRow.length &gt;0) { $($t).jqGrid(&quot;saveCell&quot;,iRow,iCol); } } }); }, prevCell : function (iRow,iCol) { return this.each(function (){ var $t = this, nCol=false; if (!$t.grid || $t.p.cellEdit !== true) {return;} // try to find next editable cell for (var i=iCol-1; i&gt;=0; i--) { if ( $t.p.colModel[i].editable ===true) { nCol = i; break; } } if(nCol !== false) { $($t).jqGrid(&quot;editCell&quot;,iRow,nCol,true); } else { if ($t.p.savedRow.length &gt;0) { $($t).jqGrid(&quot;saveCell&quot;,iRow,iCol); } } }); }, GridNav : function() { return this.each(function () { var $t = this; if (!$t.grid || $t.p.cellEdit !== true ) {return;} // trick to process keydown on non input elements $t.p.knv = $t.p.id + &quot;_kn&quot;; var selection = $(&quot;&lt;div style='position:absolute;top:-1000000px;width:1px;height:1px;' tabindex='0'&gt;&lt;div tabindex='-1' style='width:1px;height:1px;' id='&quot;+$t.p.knv+&quot;'&gt;&lt;/div&gt;&lt;/div&gt;&quot;), i, kdir; function scrollGrid(iR, iC, tp){ if (tp.substr(0,1)=='v') { var ch = $($t.grid.bDiv)[0].clientHeight, st = $($t.grid.bDiv)[0].scrollTop, nROT = $t.rows[iR].offsetTop+$t.rows[iR].clientHeight, pROT = $t.rows[iR].offsetTop; if(tp == 'vd') { if(nROT &gt;= ch) { $($t.grid.bDiv)[0].scrollTop = $($t.grid.bDiv)[0].scrollTop + $t.rows[iR].clientHeight; } } if(tp == 'vu'){ if (pROT &lt; st ) { $($t.grid.bDiv)[0].scrollTop = $($t.grid.bDiv)[0].scrollTop - $t.rows[iR].clientHeight; } } } if(tp=='h') { var cw = $($t.grid.bDiv)[0].clientWidth, sl = $($t.grid.bDiv)[0].scrollLeft, nCOL = $t.rows[iR].cells[iC].offsetLeft+$t.rows[iR].cells[iC].clientWidth, pCOL = $t.rows[iR].cells[iC].offsetLeft; if(nCOL &gt;= cw+parseInt(sl,10)) { $($t.grid.bDiv)[0].scrollLeft = $($t.grid.bDiv)[0].scrollLeft + $t.rows[iR].cells[iC].clientWidth; } else if (pCOL &lt; sl) { $($t.grid.bDiv)[0].scrollLeft = $($t.grid.bDiv)[0].scrollLeft - $t.rows[iR].cells[iC].clientWidth; } } } function findNextVisible(iC,act){ var ind, i; if(act == 'lft') { ind = iC+1; for (i=iC;i&gt;=0;i--){ if ($t.p.colModel[i].hidden !== true) { ind = i; break; } } } if(act == 'rgt') { ind = iC-1; for (i=iC; i&lt;$t.p.colModel.length;i++){ if ($t.p.colModel[i].hidden !== true) { ind = i; break; } } } return ind; } $(selection).insertBefore($t.grid.cDiv); $(&quot;#&quot;+$t.p.knv) .focus() .keydown(function (e){ kdir = e.keyCode; if($t.p.direction == &quot;rtl&quot;) { if(kdir===37) { kdir = 39;} else if (kdir===39) { kdir = 37; } } switch (kdir) { case 38: if ($t.p.iRow-1 &gt;0 ) { scrollGrid($t.p.iRow-1,$t.p.iCol,'vu'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow-1,$t.p.iCol,false); } break; case 40 : if ($t.p.iRow+1 &lt;= $t.rows.length-1) { scrollGrid($t.p.iRow+1,$t.p.iCol,'vd'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow+1,$t.p.iCol,false); } break; case 37 : if ($t.p.iCol -1 &gt;= 0) { i = findNextVisible($t.p.iCol-1,'lft'); scrollGrid($t.p.iRow, i,'h'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow, i,false); } break; case 39 : if ($t.p.iCol +1 &lt;= $t.p.colModel.length-1) { i = findNextVisible($t.p.iCol+1,'rgt'); scrollGrid($t.p.iRow,i,'h'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow,i,false); } break; case 13: if (parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) { $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow,$t.p.iCol,true); } break; default : return true; } return false; }); }); }, getChangedCells : function (mthd) { var ret=[]; if (!mthd) {mthd='all';} this.each(function(){ var $t= this,nm; if (!$t.grid || $t.p.cellEdit !== true ) {return;} $($t.rows).each(function(j){ var res = {}; if ($(this).hasClass(&quot;edited&quot;)) { $('td',this).each( function(i) { nm = $t.p.colModel[i].name; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid') { if (mthd=='dirty') { if ($(this).hasClass('dirty-cell')) { try { res[nm] = $.unformat.call($t,this,{rowId:$t.rows[j].id, colModel:$t.p.colModel[i]},i); } catch (e){ res[nm] = $.jgrid.htmlDecode($(this).html()); } } } else { try { res[nm] = $.unformat.call($t,this,{rowId:$t.rows[j].id,colModel:$t.p.colModel[i]},i); } catch (e) { res[nm] = $.jgrid.htmlDecode($(this).html()); } } } }); res.id = this.id; ret.push(res); } }); }); return ret; } /// end cell editing }); })(jQuery); ;(function($){ /** * jqGrid extension for SubGrid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; $.jgrid.extend({ setSubGrid : function () { return this.each(function (){ var $t = this, cm, suboptions = { plusicon : &quot;ui-icon-plus&quot;, minusicon : &quot;ui-icon-minus&quot;, openicon: &quot;ui-icon-carat-1-sw&quot;, expandOnLoad: false, delayOnLoad : 50, selectOnExpand : false, reloadOnExpand : true }; $t.p.subGridOptions = $.extend(suboptions, $t.p.subGridOptions || {}); $t.p.colNames.unshift(&quot;&quot;); $t.p.colModel.unshift({name:'subgrid',width: $.browser.safari ? $t.p.subGridWidth+$t.p.cellLayout : $t.p.subGridWidth,sortable: false,resizable:false,hidedlg:true,search:false,fixed:true}); cm = $t.p.subGridModel; if(cm[0]) { cm[0].align = $.extend([],cm[0].align || []); for(var i=0;i&lt;cm[0].name.length;i++) { cm[0].align[i] = cm[0].align[i] || 'left';} } }); }, addSubGridCell :function (pos,iRow) { var prp='',ic,sid; this.each(function(){ prp = this.formatCol(pos,iRow); sid= this.p.id; ic = this.p.subGridOptions.plusicon; }); return &quot;&lt;td role=\\&quot;gridcell\\&quot; aria-describedby=\\&quot;&quot;+sid+&quot;_subgrid\\&quot; class=\\&quot;ui-sgcollapsed sgcollapsed\\&quot; &quot;+prp+&quot;&gt;&lt;a href='javascript:void(0);'&gt;&lt;span class='ui-icon &quot;+ic+&quot;'&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;&quot;; }, addSubGrid : function( pos, sind ) { return this.each(function(){ var ts = this; if (!ts.grid ) { return; } //------------------------- var subGridCell = function(trdiv,cell,pos) { var tddiv = $(&quot;&lt;td align='&quot;+ts.p.subGridModel[0].align[pos]+&quot;'&gt;&lt;/td&gt;&quot;).html(cell); $(trdiv).append(tddiv); }; var subGridXml = function(sjxml, sbid){ var tddiv, i, sgmap, dummy = $(&quot;&lt;table cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), trdiv = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); for (i = 0; i&lt;ts.p.subGridModel[0].name.length; i++) { tddiv = $(&quot;&lt;th class='ui-state-default ui-th-subgrid ui-th-column ui-th-&quot;+ts.p.direction+&quot;'&gt;&lt;/th&gt;&quot;); $(tddiv).html(ts.p.subGridModel[0].name[i]); $(tddiv).width( ts.p.subGridModel[0].width[i]); $(trdiv).append(tddiv); } $(dummy).append(trdiv); if (sjxml){ sgmap = ts.p.xmlReader.subgrid; $(sgmap.root+&quot; &quot;+sgmap.row, sjxml).each( function(){ trdiv = $(&quot;&lt;tr class='ui-widget-content ui-subtblcell'&gt;&lt;/tr&gt;&quot;); if(sgmap.repeatitems === true) { $(sgmap.cell,this).each( function(i) { subGridCell(trdiv, $(this).text() || '&amp;#160;',i); }); } else { var f = ts.p.subGridModel[0].mapping || ts.p.subGridModel[0].name; if (f) { for (i=0;i&lt;f.length;i++) { subGridCell(trdiv, $(f[i],this).text() || '&amp;#160;',i); } } } $(dummy).append(trdiv); }); } var pID = $(&quot;table:first&quot;,ts.grid.bDiv).attr(&quot;id&quot;)+&quot;_&quot;; $(&quot;#&quot;+$.jgrid.jqID(pID+sbid)).append(dummy); ts.grid.hDiv.loading = false; $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); return false; }; var subGridJson = function(sjxml, sbid){ var tddiv,result,i,cur, sgmap,j, dummy = $(&quot;&lt;table cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), trdiv = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); for (i = 0; i&lt;ts.p.subGridModel[0].name.length; i++) { tddiv = $(&quot;&lt;th class='ui-state-default ui-th-subgrid ui-th-column ui-th-&quot;+ts.p.direction+&quot;'&gt;&lt;/th&gt;&quot;); $(tddiv).html(ts.p.subGridModel[0].name[i]); $(tddiv).width( ts.p.subGridModel[0].width[i]); $(trdiv).append(tddiv); } $(dummy).append(trdiv); if (sjxml){ sgmap = ts.p.jsonReader.subgrid; result = $.jgrid.getAccessor(sjxml, sgmap.root); if ( typeof result !== 'undefined' ) { for (i=0;i&lt;result.length;i++) { cur = result[i]; trdiv = $(&quot;&lt;tr class='ui-widget-content ui-subtblcell'&gt;&lt;/tr&gt;&quot;); if(sgmap.repeatitems === true) { if(sgmap.cell) { cur=cur[sgmap.cell]; } for (j=0;j&lt;cur.length;j++) { subGridCell(trdiv, cur[j] || '&amp;#160;',j); } } else { var f = ts.p.subGridModel[0].mapping || ts.p.subGridModel[0].name; if(f.length) { for (j=0;j&lt;f.length;j++) { subGridCell(trdiv, cur[f[j]] || '&amp;#160;',j); } } } $(dummy).append(trdiv); } } } var pID = $(&quot;table:first&quot;,ts.grid.bDiv).attr(&quot;id&quot;)+&quot;_&quot;; $(&quot;#&quot;+$.jgrid.jqID(pID+sbid)).append(dummy); ts.grid.hDiv.loading = false; $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); return false; }; var populatesubgrid = function( rd ) { var sid,dp, i, j; sid = $(rd).attr(&quot;id&quot;); dp = {nd_: (new Date().getTime())}; dp[ts.p.prmNames.subgridid]=sid; if(!ts.p.subGridModel[0]) { return false; } if(ts.p.subGridModel[0].params) { for(j=0; j &lt; ts.p.subGridModel[0].params.length; j++) { for(i=0; i&lt;ts.p.colModel.length; i++) { if(ts.p.colModel[i].name === ts.p.subGridModel[0].params[j]) { dp[ts.p.colModel[i].name]= $(&quot;td:eq(&quot;+i+&quot;)&quot;,rd).text().replace(/\\&amp;#160\\;/ig,''); } } } } if(!ts.grid.hDiv.loading) { ts.grid.hDiv.loading = true; $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show(); if(!ts.p.subgridtype) { ts.p.subgridtype = ts.p.datatype; } if($.isFunction(ts.p.subgridtype)) { ts.p.subgridtype.call(ts, dp); } else { ts.p.subgridtype = ts.p.subgridtype.toLowerCase(); } switch(ts.p.subgridtype) { case &quot;xml&quot;: case &quot;json&quot;: $.ajax($.extend({ type:ts.p.mtype, url: ts.p.subGridUrl, dataType:ts.p.subgridtype, data: $.isFunction(ts.p.serializeSubGridData)? ts.p.serializeSubGridData.call(ts, dp) : dp, complete: function(sxml) { if(ts.p.subgridtype === &quot;xml&quot;) { subGridXml(sxml.responseXML, sid); } else { subGridJson($.jgrid.parse(sxml.responseText),sid); } sxml=null; } }, $.jgrid.ajaxOptions, ts.p.ajaxSubgridOptions || {})); break; } } return false; }; var _id, pID,atd, nhc=0, bfsc, r; $.each(ts.p.colModel,function(){ if(this.hidden === true || this.name === 'rn' || this.name === 'cb') { nhc++; } }); var len = ts.rows.length, i=1; if( sind !== undefined &amp;&amp; sind &gt; 0) { i = sind; len = sind+1; } while(i &lt; len) { if($(ts.rows[i]).hasClass('jqgrow')) { $(ts.rows[i].cells[pos]).bind('click', function() { var tr = $(this).parent(&quot;tr&quot;)[0]; r = tr.nextSibling; if($(this).hasClass(&quot;sgcollapsed&quot;)) { pID = ts.p.id; _id = tr.id; if(ts.p.subGridOptions.reloadOnExpand === true || ( ts.p.subGridOptions.reloadOnExpand === false &amp;&amp; !$(r).hasClass('ui-subgrid') ) ) { atd = pos &gt;=1 ? &quot;&lt;td colspan='&quot;+pos+&quot;'&gt;&amp;#160;&lt;/td&gt;&quot;:&quot;&quot;; bfsc = $(ts).triggerHandler(&quot;jqGridSubGridBeforeExpand&quot;, [pID + &quot;_&quot; + _id, _id]); bfsc = (bfsc === false || bfsc === 'stop') ? false : true; if(bfsc &amp;&amp; $.isFunction(ts.p.subGridBeforeExpand)) { bfsc = ts.p.subGridBeforeExpand.call(ts, pID+&quot;_&quot;+_id,_id); } if(bfsc === false) {return false;} $(tr).after( &quot;&lt;tr role='row' class='ui-subgrid'&gt;&quot;+atd+&quot;&lt;td class='ui-widget-content subgrid-cell'&gt;&lt;span class='ui-icon &quot;+ts.p.subGridOptions.openicon+&quot;'&gt;&lt;/span&gt;&lt;/td&gt;&lt;td colspan='&quot;+parseInt(ts.p.colNames.length-1-nhc,10)+&quot;' class='ui-widget-content subgrid-data'&gt;&lt;div id=&quot;+pID+&quot;_&quot;+_id+&quot; class='tablediv'&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&quot; ); $(ts).triggerHandler(&quot;jqGridSubGridRowExpanded&quot;, [pID + &quot;_&quot; + _id, _id]); if( $.isFunction(ts.p.subGridRowExpanded)) { ts.p.subGridRowExpanded.call(ts, pID+&quot;_&quot;+ _id,_id); } else { populatesubgrid(tr); } } else { $(r).show(); } $(this).html(&quot;&lt;a href='javascript:void(0);'&gt;&lt;span class='ui-icon &quot;+ts.p.subGridOptions.minusicon+&quot;'&gt;&lt;/span&gt;&lt;/a&gt;&quot;).removeClass(&quot;sgcollapsed&quot;).addClass(&quot;sgexpanded&quot;); if(ts.p.subGridOptions.selectOnExpand) { $(ts).jqGrid('setSelection',_id); } } else if($(this).hasClass(&quot;sgexpanded&quot;)) { bfsc = $(ts).triggerHandler(&quot;jqGridSubGridRowColapsed&quot;, [pID + &quot;_&quot; + _id, _id]); bfsc = (bfsc === false || bfsc === 'stop') ? false : true; if( bfsc &amp;&amp; $.isFunction(ts.p.subGridRowColapsed)) { _id = tr.id; bfsc = ts.p.subGridRowColapsed.call(ts, pID+&quot;_&quot;+_id,_id ); } if(bfsc===false) {return false;} if(ts.p.subGridOptions.reloadOnExpand === true) { $(r).remove(&quot;.ui-subgrid&quot;); } else if($(r).hasClass('ui-subgrid')) { // incase of dynamic deleting $(r).hide(); } $(this).html(&quot;&lt;a href='javascript:void(0);'&gt;&lt;span class='ui-icon &quot;+ts.p.subGridOptions.plusicon+&quot;'&gt;&lt;/span&gt;&lt;/a&gt;&quot;).removeClass(&quot;sgexpanded&quot;).addClass(&quot;sgcollapsed&quot;); } return false; }); } i++; } if(ts.p.subGridOptions.expandOnLoad === true) { $(ts.rows).filter('.jqgrow').each(function(index,row){ $(row.cells[0]).click(); }); } ts.subGridXml = function(xml,sid) {subGridXml(xml,sid);}; ts.subGridJson = function(json,sid) {subGridJson(json,sid);}; }); }, expandSubGridRow : function(rowid) { return this.each(function () { var $t = this; if(!$t.grid &amp;&amp; !rowid) {return;} if($t.p.subGrid===true) { var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true); if(rc) { var sgc = $(&quot;td.sgcollapsed&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } } } }); }, collapseSubGridRow : function(rowid) { return this.each(function () { var $t = this; if(!$t.grid &amp;&amp; !rowid) {return;} if($t.p.subGrid===true) { var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true); if(rc) { var sgc = $(&quot;td.sgexpanded&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } } } }); }, toggleSubGridRow : function(rowid) { return this.each(function () { var $t = this; if(!$t.grid &amp;&amp; !rowid) {return;} if($t.p.subGrid===true) { var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true); if(rc) { var sgc = $(&quot;td.sgcollapsed&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } else { sgc = $(&quot;td.sgexpanded&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } } } } }); } }); })(jQuery); /** * jqGrid extension - Tree Grid * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl.html **/ /*global document, jQuery, $ */ (function($) { &quot;use strict&quot;; $.jgrid.extend({ setTreeNode : function(i, len){ return this.each(function(){ var $t = this; if( !$t.grid || !$t.p.treeGrid ) {return;} var expCol = $t.p.expColInd, expanded = $t.p.treeReader.expanded_field, isLeaf = $t.p.treeReader.leaf_field, level = $t.p.treeReader.level_field, icon = $t.p.treeReader.icon_field, loaded = $t.p.treeReader.loaded, lft, rgt, curLevel, ident,lftpos, twrap, ldat, lf; while(i&lt;len) { var ind = $t.rows[i].id, dind = $t.p._index[ind], expan; ldat = $t.p.data[dind]; //$t.rows[i].level = ldat[level]; if($t.p.treeGridModel == 'nested') { if(!ldat[isLeaf]) { lft = parseInt(ldat[$t.p.treeReader.left_field],10); rgt = parseInt(ldat[$t.p.treeReader.right_field],10); // NS Model ldat[isLeaf] = (rgt === lft+1) ? 'true' : 'false'; $t.rows[i].cells[$t.p._treeleafpos].innerHTML = ldat[isLeaf]; } } //else { //row.parent_id = rd[$t.p.treeReader.parent_id_field]; //} curLevel = parseInt(ldat[level],10); if($t.p.tree_root_level === 0) { ident = curLevel+1; lftpos = curLevel; } else { ident = curLevel; lftpos = curLevel -1; } twrap = &quot;&lt;div class='tree-wrap tree-wrap-&quot;+$t.p.direction+&quot;' style='width:&quot;+(ident*18)+&quot;px;'&gt;&quot;; twrap += &quot;&lt;div style='&quot;+($t.p.direction==&quot;rtl&quot; ? &quot;right:&quot; : &quot;left:&quot;)+(lftpos*18)+&quot;px;' class='ui-icon &quot;; if(ldat[loaded] !== undefined) { if(ldat[loaded]==&quot;true&quot; || ldat[loaded]===true) { ldat[loaded] = true; } else { ldat[loaded] = false; } } if(ldat[isLeaf] == &quot;true&quot; || ldat[isLeaf] === true) { twrap += ((ldat[icon] !== undefined &amp;&amp; ldat[icon] !== &quot;&quot;) ? ldat[icon] : $t.p.treeIcons.leaf)+&quot; tree-leaf treeclick&quot;; ldat[isLeaf] = true; lf=&quot;leaf&quot;; } else { ldat[isLeaf] = false; lf=&quot;&quot;; } ldat[expanded] = ((ldat[expanded] == &quot;true&quot; || ldat[expanded] === true) ? true : false) &amp;&amp; ldat[loaded]; if(ldat[expanded] === false) { twrap += ((ldat[isLeaf] === true) ? &quot;'&quot; : $t.p.treeIcons.plus+&quot; tree-plus treeclick'&quot;); } else { twrap += ((ldat[isLeaf] === true) ? &quot;'&quot; : $t.p.treeIcons.minus+&quot; tree-minus treeclick'&quot;); } twrap += &quot;&gt;&lt;/div&gt;&lt;/div&gt;&quot;; $($t.rows[i].cells[expCol]).wrapInner(&quot;&lt;span class='cell-wrapper&quot;+lf+&quot;'&gt;&lt;/span&gt;&quot;).prepend(twrap); if(curLevel !== parseInt($t.p.tree_root_level,10)) { var pn = $($t).jqGrid('getNodeParent',ldat); expan = pn &amp;&amp; pn.hasOwnProperty(expanded) ? pn[expanded] : true; if( !expan ){ $($t.rows[i]).css(&quot;display&quot;,&quot;none&quot;); } } $($t.rows[i].cells[expCol]) .find(&quot;div.treeclick&quot;) .bind(&quot;click&quot;,function(e){ var target = e.target || e.srcElement, ind2 =$(target,$t.rows).closest(&quot;tr.jqgrow&quot;)[0].id, pos = $t.p._index[ind2]; if(!$t.p.data[pos][isLeaf]){ if($t.p.data[pos][expanded]){ $($t).jqGrid(&quot;collapseRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;collapseNode&quot;,$t.p.data[pos]); } else { $($t).jqGrid(&quot;expandRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;expandNode&quot;,$t.p.data[pos]); } } return false; }); if($t.p.ExpandColClick === true) { $($t.rows[i].cells[expCol]) .find(&quot;span.cell-wrapper&quot;) .css(&quot;cursor&quot;,&quot;pointer&quot;) .bind(&quot;click&quot;,function(e) { var target = e.target || e.srcElement, ind2 =$(target,$t.rows).closest(&quot;tr.jqgrow&quot;)[0].id, pos = $t.p._index[ind2]; if(!$t.p.data[pos][isLeaf]){ if($t.p.data[pos][expanded]){ $($t).jqGrid(&quot;collapseRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;collapseNode&quot;,$t.p.data[pos]); } else { $($t).jqGrid(&quot;expandRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;expandNode&quot;,$t.p.data[pos]); } } $($t).jqGrid(&quot;setSelection&quot;,ind2); return false; }); } i++; } }); }, setTreeGrid : function() { return this.each(function (){ var $t = this, i=0, pico, ecol = false, nm, key, dupcols=[]; if(!$t.p.treeGrid) {return;} if(!$t.p.treedatatype ) {$.extend($t.p,{treedatatype: $t.p.datatype});} $t.p.subGrid = false;$t.p.altRows =false; $t.p.pgbuttons = false;$t.p.pginput = false; $t.p.gridview = true; if($t.p.rowTotal === null ) { $t.p.rowNum = 10000; } $t.p.multiselect = false;$t.p.rowList = []; $t.p.expColInd = 0; pico = 'ui-icon-triangle-1-' + ($t.p.direction==&quot;rtl&quot; ? 'w' : 'e'); $t.p.treeIcons = $.extend({plus:pico,minus:'ui-icon-triangle-1-s',leaf:'ui-icon-radio-off'},$t.p.treeIcons || {}); if($t.p.treeGridModel == 'nested') { $t.p.treeReader = $.extend({ level_field: &quot;level&quot;, left_field:&quot;lft&quot;, right_field: &quot;rgt&quot;, leaf_field: &quot;isLeaf&quot;, expanded_field: &quot;expanded&quot;, loaded: &quot;loaded&quot;, icon_field: &quot;icon&quot; },$t.p.treeReader); } else if($t.p.treeGridModel == 'adjacency') { $t.p.treeReader = $.extend({ level_field: &quot;level&quot;, parent_id_field: &quot;parent&quot;, leaf_field: &quot;isLeaf&quot;, expanded_field: &quot;expanded&quot;, loaded: &quot;loaded&quot;, icon_field: &quot;icon&quot; },$t.p.treeReader ); } for ( key in $t.p.colModel){ if($t.p.colModel.hasOwnProperty(key)) { nm = $t.p.colModel[key].name; if( nm == $t.p.ExpandColumn &amp;&amp; !ecol ) { ecol = true; $t.p.expColInd = i; } i++; // for(var tkey in $t.p.treeReader) { if($t.p.treeReader[tkey] == nm) { dupcols.push(nm); } } } } $.each($t.p.treeReader,function(j,n){ if(n &amp;&amp; $.inArray(n, dupcols) === -1){ if(j==='leaf_field') { $t.p._treeleafpos= i; } i++; $t.p.colNames.push(n); $t.p.colModel.push({name:n,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false}); } }); }); }, expandRow: function (record){ this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var childern = $($t).jqGrid(&quot;getNodeChildren&quot;,record), //if ($($t).jqGrid(&quot;isVisibleNode&quot;,record)) { expanded = $t.p.treeReader.expanded_field, rows = $t.rows; $(childern).each(function(){ var id = $.jgrid.getAccessor(this,$t.p.localReader.id); $(rows.namedItem(id)).css(&quot;display&quot;,&quot;&quot;); if(this[expanded]) { $($t).jqGrid(&quot;expandRow&quot;,this); } }); //} }); }, collapseRow : function (record) { this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var childern = $($t).jqGrid(&quot;getNodeChildren&quot;,record), expanded = $t.p.treeReader.expanded_field, rows = $t.rows; $(childern).each(function(){ var id = $.jgrid.getAccessor(this,$t.p.localReader.id); $(rows.namedItem(id)).css(&quot;display&quot;,&quot;none&quot;); if(this[expanded]){ $($t).jqGrid(&quot;collapseRow&quot;,this); } }); }); }, // NS ,adjacency models getRootNodes : function() { var result = []; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var level = $t.p.treeReader.level_field; $($t.p.data).each(function(){ if(parseInt(this[level],10) === parseInt($t.p.tree_root_level,10)) { result.push(this); } }); break; case 'adjacency' : var parent_id = $t.p.treeReader.parent_id_field; $($t.p.data).each(function(){ if(this[parent_id] === null || String(this[parent_id]).toLowerCase() == &quot;null&quot;) { result.push(this); } }); break; } }); return result; }, getNodeDepth : function(rc) { var ret = null; this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var $t = this; switch ($t.p.treeGridModel) { case 'nested' : var level = $t.p.treeReader.level_field; ret = parseInt(rc[level],10) - parseInt($t.p.tree_root_level,10); break; case 'adjacency' : ret = $($t).jqGrid(&quot;getNodeAncestors&quot;,rc).length; break; } }); return ret; }, getNodeParent : function(rc) { var result = null; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var lftc = $t.p.treeReader.left_field, rgtc = $t.p.treeReader.right_field, levelc = $t.p.treeReader.level_field, lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10); $(this.p.data).each(function(){ if(parseInt(this[levelc],10) === level-1 &amp;&amp; parseInt(this[lftc],10) &lt; lft &amp;&amp; parseInt(this[rgtc],10) &gt; rgt) { result = this; return false; } }); break; case 'adjacency' : var parent_id = $t.p.treeReader.parent_id_field, dtid = $t.p.localReader.id; $(this.p.data).each(function(){ if(this[dtid] == rc[parent_id] ) { result = this; return false; } }); break; } }); return result; }, getNodeChildren : function(rc) { var result = []; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var lftc = $t.p.treeReader.left_field, rgtc = $t.p.treeReader.right_field, levelc = $t.p.treeReader.level_field, lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10); $(this.p.data).each(function(){ if(parseInt(this[levelc],10) === level+1 &amp;&amp; parseInt(this[lftc],10) &gt; lft &amp;&amp; parseInt(this[rgtc],10) &lt; rgt) { result.push(this); } }); break; case 'adjacency' : var parent_id = $t.p.treeReader.parent_id_field, dtid = $t.p.localReader.id; $(this.p.data).each(function(){ if(this[parent_id] == rc[dtid]) { result.push(this); } }); break; } }); return result; }, getFullTreeNode : function(rc) { var result = []; this.each(function(){ var $t = this, len; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var lftc = $t.p.treeReader.left_field, rgtc = $t.p.treeReader.right_field, levelc = $t.p.treeReader.level_field, lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10); $(this.p.data).each(function(){ if(parseInt(this[levelc],10) &gt;= level &amp;&amp; parseInt(this[lftc],10) &gt;= lft &amp;&amp; parseInt(this[lftc],10) &lt;= rgt) { result.push(this); } }); break; case 'adjacency' : if(rc) { result.push(rc); var parent_id = $t.p.treeReader.parent_id_field, dtid = $t.p.localReader.id; $(this.p.data).each(function(i){ len = result.length; for (i = 0; i &lt; len; i++) { if (result[i][dtid] == this[parent_id]) { result.push(this); break; } } }); } break; } }); return result; }, // End NS, adjacency Model getNodeAncestors : function(rc) { var ancestors = []; this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var parent = $(this).jqGrid(&quot;getNodeParent&quot;,rc); while (parent) { ancestors.push(parent); parent = $(this).jqGrid(&quot;getNodeParent&quot;,parent); } }); return ancestors; }, isVisibleNode : function(rc) { var result = true; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var ancestors = $($t).jqGrid(&quot;getNodeAncestors&quot;,rc), expanded = $t.p.treeReader.expanded_field; $(ancestors).each(function(){ result = result &amp;&amp; this[expanded]; if(!result) {return false;} }); }); return result; }, isNodeLoaded : function(rc) { var result; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var isLeaf = $t.p.treeReader.leaf_field; if(rc !== undefined ) { if(rc.loaded !== undefined) { result = rc.loaded; } else if( rc[isLeaf] || $($t).jqGrid(&quot;getNodeChildren&quot;,rc).length &gt; 0){ result = true; } else { result = false; } } else { result = false; } }); return result; }, expandNode : function(rc) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var expanded = this.p.treeReader.expanded_field, parent = this.p.treeReader.parent_id_field, loaded = this.p.treeReader.loaded, level = this.p.treeReader.level_field, lft = this.p.treeReader.left_field, rgt = this.p.treeReader.right_field; if(!rc[expanded]) { var id = $.jgrid.getAccessor(rc,this.p.localReader.id); var rc1 = $(&quot;#&quot;+$.jgrid.jqID(id),this.grid.bDiv)[0]; var position = this.p._index[id]; if( $(this).jqGrid(&quot;isNodeLoaded&quot;,this.p.data[position]) ) { rc[expanded] = true; $(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.plus+&quot; tree-plus&quot;).addClass(this.p.treeIcons.minus+&quot; tree-minus&quot;); } else if (!this.grid.hDiv.loading) { rc[expanded] = true; $(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.plus+&quot; tree-plus&quot;).addClass(this.p.treeIcons.minus+&quot; tree-minus&quot;); this.p.treeANode = rc1.rowIndex; this.p.datatype = this.p.treedatatype; if(this.p.treeGridModel == 'nested') { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:id,n_left:rc[lft],n_right:rc[rgt],n_level:rc[level]}}); } else { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:id,parentid:rc[parent],n_level:rc[level]}} ); } $(this).trigger(&quot;reloadGrid&quot;); rc[loaded] = true; if(this.p.treeGridModel == 'nested') { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:'',n_left:'',n_right:'',n_level:''}}); } else { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:'',parentid:'',n_level:''}}); } } } }); }, collapseNode : function(rc) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var expanded = this.p.treeReader.expanded_field; if(rc[expanded]) { rc[expanded] = false; var id = $.jgrid.getAccessor(rc,this.p.localReader.id); var rc1 = $(&quot;#&quot;+$.jgrid.jqID(id),this.grid.bDiv)[0]; $(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.minus+&quot; tree-minus&quot;).addClass(this.p.treeIcons.plus+&quot; tree-plus&quot;); } }); }, SortTree : function( sortname, newDir, st, datefmt) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var i, len, rec, records = [], $t = this, query, roots, rt = $(this).jqGrid(&quot;getRootNodes&quot;); // Sorting roots query = $.jgrid.from(rt); query.orderBy(sortname,newDir,st, datefmt); roots = query.select(); // Sorting children for (i = 0, len = roots.length; i &lt; len; i++) { rec = roots[i]; records.push(rec); $(this).jqGrid(&quot;collectChildrenSortTree&quot;,records, rec, sortname, newDir,st, datefmt); } $.each(records, function(index) { var id = $.jgrid.getAccessor(this,$t.p.localReader.id); $('#'+$.jgrid.jqID($t.p.id)+ ' tbody tr:eq('+index+')').after($('tr#'+$.jgrid.jqID(id),$t.grid.bDiv)); }); query = null;roots=null;records=null; }); }, collectChildrenSortTree : function(records, rec, sortname, newDir,st, datefmt) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var i, len, child, ch, query, children; ch = $(this).jqGrid(&quot;getNodeChildren&quot;,rec); query = $.jgrid.from(ch); query.orderBy(sortname, newDir, st, datefmt); children = query.select(); for (i = 0, len = children.length; i &lt; len; i++) { child = children[i]; records.push(child); $(this).jqGrid(&quot;collectChildrenSortTree&quot;,records, child, sortname, newDir, st, datefmt); } }); }, // experimental setTreeRow : function(rowid, data) { var success=false; this.each(function(){ var t = this; if(!t.grid || !t.p.treeGrid) {return;} success = $(t).jqGrid(&quot;setRowData&quot;,rowid,data); }); return success; }, delTreeNode : function (rowid) { return this.each(function () { var $t = this, rid = $t.p.localReader.id, left = $t.p.treeReader.left_field, right = $t.p.treeReader.right_field, myright, width, res, key; if(!$t.grid || !$t.p.treeGrid) {return;} var rc = $t.p._index[rowid]; if (rc !== undefined) { // nested myright = parseInt($t.p.data[rc][right],10); width = myright - parseInt($t.p.data[rc][left],10) + 1; var dr = $($t).jqGrid(&quot;getFullTreeNode&quot;,$t.p.data[rc]); if(dr.length&gt;0){ for (var i=0;i&lt;dr.length;i++){ $($t).jqGrid(&quot;delRowData&quot;,dr[i][rid]); } } if( $t.p.treeGridModel === &quot;nested&quot;) { // ToDo - update grid data res = $.jgrid.from($t.p.data) .greater(left,myright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][left] = parseInt(res[key][left],10) - width ; } } } res = $.jgrid.from($t.p.data) .greater(right,myright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][right] = parseInt(res[key][right],10) - width ; } } } } } }); }, addChildNode : function( nodeid, parentid, data ) { //return this.each(function(){ var $t = this[0]; if(data) { // we suppose tha the id is autoincremet and var expanded = $t.p.treeReader.expanded_field, isLeaf = $t.p.treeReader.leaf_field, level = $t.p.treeReader.level_field, //icon = $t.p.treeReader.icon_field, parent = $t.p.treeReader.parent_id_field, left = $t.p.treeReader.left_field, right = $t.p.treeReader.right_field, loaded = $t.p.treeReader.loaded, method, parentindex, parentdata, parentlevel, i, len, max=0, rowind = parentid, leaf, maxright; if ( typeof nodeid === 'undefined' || nodeid === null ) { i = $t.p.data.length-1; if( i&gt;= 0 ) { while(i&gt;=0){max = Math.max(max, parseInt($t.p.data[i][$t.p.localReader.id],10)); i--;} } nodeid = max+1; } var prow = $($t).jqGrid('getInd', parentid); leaf = false; // if not a parent we assume root if ( parentid === undefined || parentid === null || parentid===&quot;&quot;) { parentid = null; rowind = null; method = 'last'; parentlevel = $t.p.tree_root_level; i = $t.p.data.length+1; } else { method = 'after'; parentindex = $t.p._index[parentid]; parentdata = $t.p.data[parentindex]; parentid = parentdata[$t.p.localReader.id]; parentlevel = parseInt(parentdata[level],10)+1; var childs = $($t).jqGrid('getFullTreeNode', parentdata); // if there are child nodes get the last index of it if(childs.length) { i = childs[childs.length-1][$t.p.localReader.id]; rowind = i; i = $($t).jqGrid('getInd',rowind)+1; } else { i = $($t).jqGrid('getInd', parentid)+1; } // if the node is leaf if(parentdata[isLeaf]) { leaf = true; parentdata[expanded] = true; //var prow = $($t).jqGrid('getInd', parentid); $($t.rows[prow]) .find(&quot;span.cell-wrapperleaf&quot;).removeClass(&quot;cell-wrapperleaf&quot;).addClass(&quot;cell-wrapper&quot;) .end() .find(&quot;div.tree-leaf&quot;).removeClass($t.p.treeIcons.leaf+&quot; tree-leaf&quot;).addClass($t.p.treeIcons.minus+&quot; tree-minus&quot;); $t.p.data[parentindex][isLeaf] = false; parentdata[loaded] = true; } } len = i+1; data[expanded] = false; data[loaded] = true; data[level] = parentlevel; data[isLeaf] = true; if( $t.p.treeGridModel === &quot;adjacency&quot;) { data[parent] = parentid; } if( $t.p.treeGridModel === &quot;nested&quot;) { // this method requiere more attention var query, res, key; //maxright = parseInt(maxright,10); // ToDo - update grid data if(parentid !== null) { maxright = parseInt(parentdata[right],10); query = $.jgrid.from($t.p.data); query = query.greaterOrEquals(right,maxright,{stype:'integer'}); res = query.select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][left] = res[key][left] &gt; maxright ? parseInt(res[key][left],10) +2 : res[key][left]; res[key][right] = res[key][right] &gt;= maxright ? parseInt(res[key][right],10) +2 : res[key][right]; } } } data[left] = maxright; data[right]= maxright+1; } else { maxright = parseInt( $($t).jqGrid('getCol', right, false, 'max'), 10); res = $.jgrid.from($t.p.data) .greater(left,maxright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][left] = parseInt(res[key][left],10) +2 ; } } } res = $.jgrid.from($t.p.data) .greater(right,maxright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][right] = parseInt(res[key][right],10) +2 ; } } } data[left] = maxright+1; data[right] = maxright + 2; } } if( parentid === null || $($t).jqGrid(&quot;isNodeLoaded&quot;,parentdata) || leaf ) { $($t).jqGrid('addRowData', nodeid, data, method, rowind); $($t).jqGrid('setTreeNode', i, len); } if(parentdata &amp;&amp; !parentdata[expanded]) { $($t.rows[prow]) .find(&quot;div.treeclick&quot;) .click(); } } //}); } }); })(jQuery); // Grouping module ;(function($){ &quot;use strict&quot;; $.extend($.jgrid,{ template : function(format){ //jqgformat var args = $.makeArray(arguments).slice(1), j = 1; if(format===undefined) { format = &quot;&quot;; } return format.replace(/\\{([\\w\\-]+)(?:\\:([\\w\\.]*)(?:\\((.*?)?\\))?)?\\}/g, function(m,i){ if(!isNaN(parseInt(i,10))) { j++; return args[parseInt(i,10)]; } else { var nmarr = args[ j ], k = nmarr.length; while(k--) { if(i===nmarr[k].nm) { return nmarr[k].v; break; } } j++; } }); } }); $.jgrid.extend({ groupingSetup : function () { return this.each(function (){ var $t = this, grp = $t.p.groupingView; if(grp !== null &amp;&amp; ( (typeof grp === 'object') || $.isFunction(grp) ) ) { if(!grp.groupField.length) { $t.p.grouping = false; } else { if ( typeof(grp.visibiltyOnNextGrouping) === 'undefined') { grp.visibiltyOnNextGrouping = []; } grp.lastvalues=[]; grp.groups =[]; grp.counters =[]; for(var i=0;i&lt;grp.groupField.length;i++) { if(!grp.groupOrder[i]) { grp.groupOrder[i] = 'asc'; } if(!grp.groupText[i]) { grp.groupText[i] = '{0}'; } if( typeof(grp.groupColumnShow[i]) !== 'boolean') { grp.groupColumnShow[i] = true; } if( typeof(grp.groupSummary[i]) !== 'boolean') { grp.groupSummary[i] = false; } if(grp.groupColumnShow[i] === true) { grp.visibiltyOnNextGrouping[i] = true; $($t).jqGrid('showCol',grp.groupField[i]); } else { grp.visibiltyOnNextGrouping[i] = $(&quot;#&quot;+$.jgrid.jqID($t.p.id+&quot;_&quot;+grp.groupField[i])).is(&quot;:visible&quot;); $($t).jqGrid('hideCol',grp.groupField[i]); } } grp.summary =[]; var cm = $t.p.colModel; for(var j=0, cml = cm.length; j &lt; cml; j++) { if(cm[j].summaryType) { grp.summary.push({nm:cm[j].name,st:cm[j].summaryType, v: '', sr: cm[j].summaryRound, srt: cm[j].summaryRoundType || 'round'}); } } } } else { $t.p.grouping = false; } }); }, groupingPrepare : function (rData, gdata, record, irow) { this.each(function(){ var grp = this.p.groupingView, $t= this; var grlen = grp.groupField.length, fieldName, v, changed = 0; for(var i=0;i&lt;grlen;i++) { fieldName = grp.groupField[i]; v = record[fieldName]; if( v !== undefined ) { if(irow === 0 ) { // First record always starts a new group grp.groups.push({idx:i,dataIndex:fieldName,value:v, startRow: irow, cnt:1, summary : [] } ); grp.lastvalues[i] = v; grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)}; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } else { if( (typeof(v) !== &quot;object&quot; &amp;&amp; (grp.lastvalues[i] !== v) ) ) { // This record is not in same group as previous one grp.groups.push({idx:i,dataIndex:fieldName,value:v, startRow: irow, cnt:1, summary : [] } ); grp.lastvalues[i] = v; changed = 1; grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)}; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } else { if (changed === 1) { // This group has changed because an earlier group changed. grp.groups.push({idx:i,dataIndex:fieldName,value:v, startRow: irow, cnt:1, summary : [] } ); grp.lastvalues[i] = v; grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)}; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } else { grp.counters[i].cnt += 1; grp.groups[grp.counters[i].pos].cnt = grp.counters[i].cnt; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } } } } } gdata.push( rData ); }); return gdata; }, groupingToggle : function(hid){ this.each(function(){ var $t = this, grp = $t.p.groupingView, strpos = hid.split('_'), //uid = hid.substring(0,strpos+1), num = parseInt(strpos[strpos.length-2], 10); strpos.splice(strpos.length-2,2); var uid = strpos.join(&quot;_&quot;), minus = grp.minusicon, plus = grp.plusicon, tar = $(&quot;#&quot;+$.jgrid.jqID(hid)), r = tar.length ? tar[0].nextSibling : null, tarspan = $(&quot;#&quot;+$.jgrid.jqID(hid)+&quot; span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction), collapsed = false, tspan; if( tarspan.hasClass(minus) ) { if(grp.showSummaryOnHide) { if(r){ while(r) { if($(r).hasClass('jqfoot') ) { var lv = parseInt($(r).attr(&quot;jqfootlevel&quot;),10); if( lv &lt;= num) { break; } } $(r).hide(); r = r.nextSibling; } } } else { if(r){ while(r) { if( $(r).hasClass(uid+&quot;_&quot;+String(num) ) || $(r).hasClass(uid+&quot;_&quot;+String(num-1))) { break; } $(r).hide(); r = r.nextSibling; } } } tarspan.removeClass(minus).addClass(plus); collapsed = true; } else { if(r){ while(r) { if($(r).hasClass(uid+&quot;_&quot;+String(num)) || $(r).hasClass(uid+&quot;_&quot;+String(num-1)) ) { break; } $(r).show(); tspan = $(r).find(&quot;span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction); if( tspan &amp;&amp; $(tspan).hasClass(plus) ) { $(tspan).removeClass(plus).addClass(minus); } r = r.nextSibling; } } tarspan.removeClass(plus).addClass(minus); } $($t).triggerHandler(&quot;jqGridGroupingClickGroup&quot;, [hid , collapsed]); if( $.isFunction($t.p.onClickGroup)) { $t.p.onClickGroup.call($t, hid , collapsed); } }); return false; }, groupingRender : function (grdata, colspans ) { return this.each(function(){ var $t = this, grp = $t.p.groupingView, str = &quot;&quot;, icon = &quot;&quot;, hid, clid, pmrtl = grp.groupCollapse ? grp.plusicon : grp.minusicon, gv, cp=[], ii, len =grp.groupField.length; pmrtl += &quot; tree-wrap-&quot;+$t.p.direction; ii = 0; $.each($t.p.colModel, function (i,n){ for(var ii=0;ii&lt;len;ii++) { if(grp.groupField[ii] === n.name ) { cp[ii] = i; break; } } }); var toEnd = 0; function findGroupIdx( ind , offset, grp) { if(offset===0) { return grp[ind]; } else { var id = grp[ind].idx; if(id===0) { return grp[ind]; } for(var i=ind;i &gt;= 0; i--) { if(grp[i].idx === id-offset) { return grp[i]; } } } } var sumreverse = $.makeArray(grp.groupSummary); sumreverse.reverse(); $.each(grp.groups,function(i,n){ toEnd++; clid = $t.p.id+&quot;ghead_&quot;+n.idx; hid = clid+&quot;_&quot;+i; icon = &quot;&lt;span style='cursor:pointer;' class='ui-icon &quot;+pmrtl+&quot;' onclick=\\&quot;jQuery('#&quot;+$.jgrid.jqID($t.p.id)+&quot;').jqGrid('groupingToggle','&quot;+hid+&quot;');return false;\\&quot;&gt;&lt;/span&gt;&quot;; try { gv = $t.formatter(hid, n.value, cp[n.idx], n.value ); } catch (egv) { gv = n.value; } str += &quot;&lt;tr id=\\&quot;&quot;+hid+&quot;\\&quot; role=\\&quot;row\\&quot; class= \\&quot;ui-widget-content jqgroup ui-row-&quot;+$t.p.direction+&quot; &quot;+clid+&quot;\\&quot;&gt;&lt;td style=\\&quot;padding-left:&quot;+(n.idx * 12) + &quot;px;&quot;+&quot;\\&quot; colspan=\\&quot;&quot;+colspans+&quot;\\&quot;&gt;&quot;+icon+$.jgrid.template(grp.groupText[n.idx], gv, n.cnt, n.summary)+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; var leaf = len-1 === n.idx; if( leaf ) { var gg = grp.groups[i+1]; var end = gg !== undefined ? grp.groups[i+1].startRow : grdata.length; for(var kk=n.startRow;kk&lt;end;kk++) { str += grdata[kk].join(''); } var jj; if (gg !== undefined) { for (jj = 0; jj &lt; grp.groupField.length; jj++) { if (gg.dataIndex === grp.groupField[jj]) { break; } } toEnd = grp.groupField.length - jj; } for (var ik = 0; ik &lt; toEnd; ik++) { if(!sumreverse[ik]) { continue; } var hhdr = &quot;&quot;; if(grp.groupCollapse &amp;&amp; !grp.showSummaryOnHide) { hhdr = &quot; style=\\&quot;display:none;\\&quot;&quot;; } str += &quot;&lt;tr&quot;+hhdr+&quot; jqfootlevel=\\&quot;&quot;+(n.idx-ik)+&quot;\\&quot; role=\\&quot;row\\&quot; class=\\&quot;ui-widget-content jqfoot ui-row-&quot;+$t.p.direction+&quot;\\&quot;&gt;&quot;; var fdata = findGroupIdx(i, ik, grp.groups), cm = $t.p.colModel, vv, grlen = fdata.cnt; for(var k=0; k&lt;colspans;k++) { var tmpdata = &quot;&lt;td &quot;+$t.formatCol(k,1,'')+&quot;&gt;&amp;#160;&lt;/td&gt;&quot;, tplfld = &quot;{0}&quot;; $.each(fdata.summary,function(){ if(this.nm === cm[k].name) { if(cm[k].summaryTpl) { tplfld = cm[k].summaryTpl; } if(typeof(this.st) === 'string' &amp;&amp; this.st.toLowerCase() === 'avg') { if(this.v &amp;&amp; grlen &gt; 0) { this.v = (this.v/grlen); } } try { vv = $t.formatter('', this.v, k, this); } catch (ef) { vv = this.v; } tmpdata= &quot;&lt;td &quot;+$t.formatCol(k,1,'')+&quot;&gt;&quot;+$.jgrid.format(tplfld,vv)+ &quot;&lt;/td&gt;&quot;; return false; } }); str += tmpdata; } str += &quot;&lt;/tr&gt;&quot;; } toEnd = jj; } }); $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).append(str); // free up memory str = null; }); }, groupingGroupBy : function (name, options ) { return this.each(function(){ var $t = this; if(typeof(name) === &quot;string&quot;) { name = [name]; } var grp = $t.p.groupingView; $t.p.grouping = true; //Set default, in case visibilityOnNextGrouping is undefined if (typeof grp.visibiltyOnNextGrouping === &quot;undefined&quot;) { grp.visibiltyOnNextGrouping = []; } var i; // show previous hidden groups if they are hidden and weren't removed yet for(i=0;i&lt;grp.groupField.length;i++) { if(!grp.groupColumnShow[i] &amp;&amp; grp.visibiltyOnNextGrouping[i]) { $($t).jqGrid('showCol',grp.groupField[i]); } } // set visibility status of current group columns on next grouping for(i=0;i&lt;name.length;i++) { grp.visibiltyOnNextGrouping[i] = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(name[i])).is(&quot;:visible&quot;); } $t.p.groupingView = $.extend($t.p.groupingView, options || {}); grp.groupField = name; $($t).trigger(&quot;reloadGrid&quot;); }); }, groupingRemove : function (current) { return this.each(function(){ var $t = this; if(typeof(current) === 'undefined') { current = true; } $t.p.grouping = false; if(current===true) { var grp = $t.p.groupingView; // show previous hidden groups if they are hidden and weren't removed yet for(var i=0;i&lt;grp.groupField.length;i++) { if (!grp.groupColumnShow[i] &amp;&amp; grp.visibiltyOnNextGrouping[i]) { $($t).jqGrid('showCol', grp.groupField); } } $(&quot;tr.jqgroup, tr.jqfoot&quot;,&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).remove(); $(&quot;tr.jqgrow:hidden&quot;,&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).show(); } else { $($t).trigger(&quot;reloadGrid&quot;); } }); }, groupingCalculations : { handler: function(fn, v, field, round, roundType, rc) { var funcs = { sum: function() { return parseFloat(v||0) + parseFloat((rc[field]||0)); }, min: function() { if(v===&quot;&quot;) { return parseFloat(rc[field]||0); } return Math.min(parseFloat(v),parseFloat(rc[field]||0)); }, max: function() { if(v===&quot;&quot;) { return parseFloat(rc[field]||0); } return Math.max(parseFloat(v),parseFloat(rc[field]||0)); }, count: function() { if(v===&quot;&quot;) {v=0;} if(rc.hasOwnProperty(field)) { return v+1; } else { return 0; } }, avg: function() { // the same as sum, but at end we divide it // so use sum instead of duplicating the code (?) return funcs.sum(); } } if(!funcs[fn]) { throw (&quot;jqGrid Grouping No such method: &quot; + fn); } var res = funcs[fn](); if (round != null) { if (roundType == 'fixed') res = res.toFixed(round); else { var mul = Math.pow(10, round); res = Math.round(res * mul) / mul; } } return res; } } }); })(jQuery); ;(function($){ /* * jqGrid extension for constructing Grid Data from external file * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ //jsHint options /*global jQuery, $, alert, xmlJsonClass */ &quot;use strict&quot;; $.jgrid.extend({ jqGridImport : function(o) { o = $.extend({ imptype : &quot;xml&quot;, // xml, json, xmlstring, jsonstring impstring: &quot;&quot;, impurl: &quot;&quot;, mtype: &quot;GET&quot;, impData : {}, xmlGrid :{ config : &quot;roots&gt;grid&quot;, data: &quot;roots&gt;rows&quot; }, jsonGrid :{ config : &quot;grid&quot;, data: &quot;data&quot; }, ajaxOptions :{} }, o || {}); return this.each(function(){ var $t = this; var xmlConvert = function (xml,o) { var cnfg = $(o.xmlGrid.config,xml)[0]; var xmldata = $(o.xmlGrid.data,xml)[0], jstr, jstr1; if(xmlJsonClass.xml2json &amp;&amp; $.jgrid.parse) { jstr = xmlJsonClass.xml2json(cnfg,&quot; &quot;); jstr = $.jgrid.parse(jstr); for(var key in jstr) { if(jstr.hasOwnProperty(key)) { jstr1=jstr[key]; } } if(xmldata) { // save the datatype var svdatatype = jstr.grid.datatype; jstr.grid.datatype = 'xmlstring'; jstr.grid.datastr = xml; $($t).jqGrid( jstr1 ).jqGrid(&quot;setGridParam&quot;,{datatype:svdatatype}); } else { $($t).jqGrid( jstr1 ); } jstr = null;jstr1=null; } else { alert(&quot;xml2json or parse are not present&quot;); } }; var jsonConvert = function (jsonstr,o){ if (jsonstr &amp;&amp; typeof jsonstr == 'string') { var _jsonparse = false; if($.jgrid.useJSON) { $.jgrid.useJSON = false; _jsonparse = true; } var json = $.jgrid.parse(jsonstr); if(_jsonparse) { $.jgrid.useJSON = true; } var gprm = json[o.jsonGrid.config]; var jdata = json[o.jsonGrid.data]; if(jdata) { var svdatatype = gprm.datatype; gprm.datatype = 'jsonstring'; gprm.datastr = jdata; $($t).jqGrid( gprm ).jqGrid(&quot;setGridParam&quot;,{datatype:svdatatype}); } else { $($t).jqGrid( gprm ); } } }; switch (o.imptype){ case 'xml': $.ajax($.extend({ url:o.impurl, type:o.mtype, data: o.impData, dataType:&quot;xml&quot;, complete: function(xml,stat) { if(stat == 'success') { xmlConvert(xml.responseXML,o); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [xml, o]); if($.isFunction(o.importComplete)) { o.importComplete(xml); } } xml=null; } }, o.ajaxOptions)); break; case 'xmlstring' : // we need to make just the conversion and use the same code as xml if(o.impstring &amp;&amp; typeof o.impstring == 'string') { var xmld = $.jgrid.stringToDoc(o.impstring); if(xmld) { xmlConvert(xmld,o); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [xmld, o]); if($.isFunction(o.importComplete)) { o.importComplete(xmld); } o.impstring = null; } xmld = null; } break; case 'json': $.ajax($.extend({ url:o.impurl, type:o.mtype, data: o.impData, dataType:&quot;json&quot;, complete: function(json) { try { jsonConvert(json.responseText,o ); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [json, o]); if($.isFunction(o.importComplete)) { o.importComplete(json); } } catch (ee){} json=null; } }, o.ajaxOptions )); break; case 'jsonstring' : if(o.impstring &amp;&amp; typeof o.impstring == 'string') { jsonConvert(o.impstring,o ); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [o.impstring, o]); if($.isFunction(o.importComplete)) { o.importComplete(o.impstring); } o.impstring = null; } break; } }); }, jqGridExport : function(o) { o = $.extend({ exptype : &quot;xmlstring&quot;, root: &quot;grid&quot;, ident: &quot;\\t&quot; }, o || {}); var ret = null; this.each(function () { if(!this.grid) { return;} var gprm = $.extend(true, {},$(this).jqGrid(&quot;getGridParam&quot;)); // we need to check for: // 1.multiselect, 2.subgrid 3. treegrid and remove the unneded columns from colNames if(gprm.rownumbers) { gprm.colNames.splice(0,1); gprm.colModel.splice(0,1); } if(gprm.multiselect) { gprm.colNames.splice(0,1); gprm.colModel.splice(0,1); } if(gprm.subGrid) { gprm.colNames.splice(0,1); gprm.colModel.splice(0,1); } gprm.knv = null; if(gprm.treeGrid) { for (var key in gprm.treeReader) { if(gprm.treeReader.hasOwnProperty(key)) { gprm.colNames.splice(gprm.colNames.length-1); gprm.colModel.splice(gprm.colModel.length-1); } } } switch (o.exptype) { case 'xmlstring' : ret = &quot;&lt;&quot;+o.root+&quot;&gt;&quot;+xmlJsonClass.json2xml(gprm,o.ident)+&quot;&lt;/&quot;+o.root+&quot;&gt;&quot;; break; case 'jsonstring' : ret = &quot;{&quot;+ xmlJsonClass.toJson(gprm,o.root,o.ident,false)+&quot;}&quot;; if(gprm.postData.filters !== undefined) { ret=ret.replace(/filters&quot;:&quot;/,'filters&quot;:'); ret=ret.replace(/}]}&quot;/,'}]}'); } break; } }); return ret; }, excelExport : function(o) { o = $.extend({ exptype : &quot;remote&quot;, url : null, oper: &quot;oper&quot;, tag: &quot;excel&quot;, exportOptions : {} }, o || {}); return this.each(function(){ if(!this.grid) { return;} var url; if(o.exptype == &quot;remote&quot;) { var pdata = $.extend({},this.p.postData); pdata[o.oper] = o.tag; var params = jQuery.param(pdata); if(o.url.indexOf(&quot;?&quot;) != -1) { url = o.url+&quot;&amp;&quot;+params; } else { url = o.url+&quot;?&quot;+params; } window.location = url; } }); } }); })(jQuery);;(function($){ /* ** * jqGrid addons using jQuery UI * Author: Mark Williams * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * depends on jQuery UI **/ if ($.browser.msie &amp;&amp; $.browser.version==8) { $.expr[&quot;:&quot;].hidden = function(elem) { return elem.offsetWidth === 0 || elem.offsetHeight === 0 || elem.style.display == &quot;none&quot;; }; } // requiere load multiselect before grid $.jgrid._multiselect = false; if($.ui) { if ($.ui.multiselect ) { if($.ui.multiselect.prototype._setSelected) { var setSelected = $.ui.multiselect.prototype._setSelected; $.ui.multiselect.prototype._setSelected = function(item,selected) { var ret = setSelected.call(this,item,selected); if (selected &amp;&amp; this.selectedList) { var elt = this.element; this.selectedList.find('li').each(function() { if ($(this).data('optionLink')) { $(this).data('optionLink').remove().appendTo(elt); } }); } return ret; }; } if($.ui.multiselect.prototype.destroy) { $.ui.multiselect.prototype.destroy = function() { this.element.show(); this.container.remove(); if ($.Widget === undefined) { $.widget.prototype.destroy.apply(this, arguments); } else { $.Widget.prototype.destroy.apply(this, arguments); } }; } $.jgrid._multiselect = true; } } $.jgrid.extend({ sortableColumns : function (tblrow) { return this.each(function (){ var ts = this, tid= $.jgrid.jqID( ts.p.id ); function start() {ts.p.disableClick = true;} var sortable_opts = { &quot;tolerance&quot; : &quot;pointer&quot;, &quot;axis&quot; : &quot;x&quot;, &quot;scrollSensitivity&quot;: &quot;1&quot;, &quot;items&quot;: '&gt;th:not(:has(#jqgh_'+tid+'_cb'+',#jqgh_'+tid+'_rn'+',#jqgh_'+tid+'_subgrid),:hidden)', &quot;placeholder&quot;: { element: function(item) { var el = $(document.createElement(item[0].nodeName)) .addClass(item[0].className+&quot; ui-sortable-placeholder ui-state-highlight&quot;) .removeClass(&quot;ui-sortable-helper&quot;)[0]; return el; }, update: function(self, p) { p.height(self.currentItem.innerHeight() - parseInt(self.currentItem.css('paddingTop')||0, 10) - parseInt(self.currentItem.css('paddingBottom')||0, 10)); p.width(self.currentItem.innerWidth() - parseInt(self.currentItem.css('paddingLeft')||0, 10) - parseInt(self.currentItem.css('paddingRight')||0, 10)); } }, &quot;update&quot;: function(event, ui) { var p = $(ui.item).parent(), th = $(&quot;&gt;th&quot;, p), colModel = ts.p.colModel, cmMap = {}, tid= ts.p.id+&quot;_&quot;; $.each(colModel, function(i) { cmMap[this.name]=i; }); var permutation = []; th.each(function() { var id = $(&quot;&gt;div&quot;, this).get(0).id.replace(/^jqgh_/, &quot;&quot;).replace(tid,&quot;&quot;); if (id in cmMap) { permutation.push(cmMap[id]); } }); $(ts).jqGrid(&quot;remapColumns&quot;,permutation, true, true); if ($.isFunction(ts.p.sortable.update)) { ts.p.sortable.update(permutation); } setTimeout(function(){ts.p.disableClick=false;}, 50); } }; if (ts.p.sortable.options) { $.extend(sortable_opts, ts.p.sortable.options); } else if ($.isFunction(ts.p.sortable)) { ts.p.sortable = { &quot;update&quot; : ts.p.sortable }; } if (sortable_opts.start) { var s = sortable_opts.start; sortable_opts.start = function(e,ui) { start(); s.call(this,e,ui); }; } else { sortable_opts.start = start; } if (ts.p.sortable.exclude) { sortable_opts.items += &quot;:not(&quot;+ts.p.sortable.exclude+&quot;)&quot;; } tblrow.sortable(sortable_opts).data(&quot;sortable&quot;).floating = true; }); }, columnChooser : function(opts) { var self = this; if($(&quot;#colchooser_&quot;+$.jgrid.jqID(self[0].p.id)).length ) { return; } var selector = $('&lt;div id=&quot;colchooser_'+self[0].p.id+'&quot; style=&quot;position:relative;overflow:hidden&quot;&gt;&lt;div&gt;&lt;select multiple=&quot;multiple&quot;&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;'); var select = $('select', selector); function insert(perm,i,v) { if(i&gt;=0){ var a = perm.slice(); var b = a.splice(i,Math.max(perm.length-i,i)); if(i&gt;perm.length) { i = perm.length; } a[i] = v; return a.concat(b); } } opts = $.extend({ &quot;width&quot; : 420, &quot;height&quot; : 240, &quot;classname&quot; : null, &quot;done&quot; : function(perm) { if (perm) { self.jqGrid(&quot;remapColumns&quot;, perm, true); } }, /* msel is either the name of a ui widget class that extends a multiselect, or a function that supports creating a multiselect object (with no argument, or when passed an object), and destroying it (when passed the string &quot;destroy&quot;). */ &quot;msel&quot; : &quot;multiselect&quot;, /* &quot;msel_opts&quot; : {}, */ /* dlog is either the name of a ui widget class that behaves in a dialog-like way, or a function, that supports creating a dialog (when passed dlog_opts) or destroying a dialog (when passed the string &quot;destroy&quot;) */ &quot;dlog&quot; : &quot;dialog&quot;, &quot;dialog_opts&quot; : { &quot;minWidth&quot;: 470 }, /* dlog_opts is either an option object to be passed to &quot;dlog&quot;, or (more likely) a function that creates the options object. The default produces a suitable options object for ui.dialog */ &quot;dlog_opts&quot; : function(opts) { var buttons = {}; buttons[opts.bSubmit] = function() { opts.apply_perm(); opts.cleanup(false); }; buttons[opts.bCancel] = function() { opts.cleanup(true); }; return $.extend(true, { &quot;buttons&quot;: buttons, &quot;close&quot;: function() { opts.cleanup(true); }, &quot;modal&quot; : opts.modal ? opts.modal : false, &quot;resizable&quot;: opts.resizable ? opts.resizable : true, &quot;width&quot;: opts.width+20 }, opts.dialog_opts || {}); }, /* Function to get the permutation array, and pass it to the &quot;done&quot; function */ &quot;apply_perm&quot; : function() { $('option',select).each(function() { if (this.selected) { self.jqGrid(&quot;showCol&quot;, colModel[this.value].name); } else { self.jqGrid(&quot;hideCol&quot;, colModel[this.value].name); } }); var perm = []; //fixedCols.slice(0); $('option:selected',select).each(function() { perm.push(parseInt(this.value,10)); }); $.each(perm, function() { delete colMap[colModel[parseInt(this,10)].name]; }); $.each(colMap, function() { var ti = parseInt(this,10); perm = insert(perm,ti,ti); }); if (opts.done) { opts.done.call(self, perm); } }, /* Function to cleanup the dialog, and select. Also calls the done function with no permutation (to indicate that the columnChooser was aborted */ &quot;cleanup&quot; : function(calldone) { call(opts.dlog, selector, 'destroy'); call(opts.msel, select, 'destroy'); selector.remove(); if (calldone &amp;&amp; opts.done) { opts.done.call(self); } }, &quot;msel_opts&quot; : {} }, $.jgrid.col, opts || {}); if($.ui) { if ($.ui.multiselect ) { if(opts.msel == &quot;multiselect&quot;) { if(!$.jgrid._multiselect) { // should be in language file alert(&quot;Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!&quot;); return; } opts.msel_opts = $.extend($.ui.multiselect.defaults,opts.msel_opts); } } } if (opts.caption) { selector.attr(&quot;title&quot;, opts.caption); } if (opts.classname) { selector.addClass(opts.classname); select.addClass(opts.classname); } if (opts.width) { $(&quot;&gt;div&quot;,selector).css({&quot;width&quot;: opts.width,&quot;margin&quot;:&quot;0 auto&quot;}); select.css(&quot;width&quot;, opts.width); } if (opts.height) { $(&quot;&gt;div&quot;,selector).css(&quot;height&quot;, opts.height); select.css(&quot;height&quot;, opts.height - 10); } var colModel = self.jqGrid(&quot;getGridParam&quot;, &quot;colModel&quot;); var colNames = self.jqGrid(&quot;getGridParam&quot;, &quot;colNames&quot;); var colMap = {}, fixedCols = []; select.empty(); $.each(colModel, function(i) { colMap[this.name] = i; if (this.hidedlg) { if (!this.hidden) { fixedCols.push(i); } return; } select.append(&quot;&lt;option value='&quot;+i+&quot;' &quot;+ (this.hidden?&quot;&quot;:&quot;selected='selected'&quot;)+&quot;&gt;&quot;+jQuery.jgrid.stripHtml(colNames[i])+&quot;&lt;/option&gt;&quot;); }); function call(fn, obj) { if (!fn) { return; } if (typeof fn == 'string') { if ($.fn[fn]) { $.fn[fn].apply(obj, $.makeArray(arguments).slice(2)); } } else if ($.isFunction(fn)) { fn.apply(obj, $.makeArray(arguments).slice(2)); } } var dopts = $.isFunction(opts.dlog_opts) ? opts.dlog_opts.call(self, opts) : opts.dlog_opts; call(opts.dlog, selector, dopts); var mopts = $.isFunction(opts.msel_opts) ? opts.msel_opts.call(self, opts) : opts.msel_opts; call(opts.msel, select, mopts); }, sortableRows : function (opts) { // Can accept all sortable options and events return this.each(function(){ var $t = this; if(!$t.grid) { return; } // Currently we disable a treeGrid sortable if($t.p.treeGrid) { return; } if($.fn.sortable) { opts = $.extend({ &quot;cursor&quot;:&quot;move&quot;, &quot;axis&quot; : &quot;y&quot;, &quot;items&quot;: &quot;.jqgrow&quot; }, opts || {}); if(opts.start &amp;&amp; $.isFunction(opts.start)) { opts._start_ = opts.start; delete opts.start; } else {opts._start_=false;} if(opts.update &amp;&amp; $.isFunction(opts.update)) { opts._update_ = opts.update; delete opts.update; } else {opts._update_ = false;} opts.start = function(ev,ui) { $(ui.item).css(&quot;border-width&quot;,&quot;0px&quot;); $(&quot;td&quot;,ui.item).each(function(i){ this.style.width = $t.grid.cols[i].style.width; }); if($t.p.subGrid) { var subgid = $(ui.item).attr(&quot;id&quot;); try { $($t).jqGrid('collapseSubGridRow',subgid); } catch (e) {} } if(opts._start_) { opts._start_.apply(this,[ev,ui]); } }; opts.update = function (ev,ui) { $(ui.item).css(&quot;border-width&quot;,&quot;&quot;); if($t.p.rownumbers === true) { $(&quot;td.jqgrid-rownum&quot;,$t.rows).each(function( i ){ $(this).html( i+1+(parseInt($t.p.page,10)-1)*parseInt($t.p.rowNum,10) ); }); } if(opts._update_) { opts._update_.apply(this,[ev,ui]); } }; $(&quot;tbody:first&quot;,$t).sortable(opts); $(&quot;tbody:first&quot;,$t).disableSelection(); } }); }, gridDnD : function(opts) { return this.each(function(){ var $t = this; if(!$t.grid) { return; } // Currently we disable a treeGrid drag and drop if($t.p.treeGrid) { return; } if(!$.fn.draggable || !$.fn.droppable) { return; } function updateDnD () { var datadnd = $.data($t,&quot;dnd&quot;); $(&quot;tr.jqgrow:not(.ui-draggable)&quot;,$t).draggable($.isFunction(datadnd.drag) ? datadnd.drag.call($($t),datadnd) : datadnd.drag); } var appender = &quot;&lt;table id='jqgrid_dnd' class='ui-jqgrid-dnd'&gt;&lt;/table&gt;&quot;; if($(&quot;#jqgrid_dnd&quot;)[0] === undefined) { $('body').append(appender); } if(typeof opts == 'string' &amp;&amp; opts == 'updateDnD' &amp;&amp; $t.p.jqgdnd===true) { updateDnD(); return; } opts = $.extend({ &quot;drag&quot; : function (opts) { return $.extend({ start : function (ev, ui) { // if we are in subgrid mode try to collapse the node if($t.p.subGrid) { var subgid = $(ui.helper).attr(&quot;id&quot;); try { $($t).jqGrid('collapseSubGridRow',subgid); } catch (e) {} } // hack // drag and drop does not insert tr in table, when the table has no rows // we try to insert new empty row on the target(s) for (var i=0;i&lt;$.data($t,&quot;dnd&quot;).connectWith.length;i++){ if($($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid('getGridParam','reccount') == &quot;0&quot; ){ $($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid('addRowData','jqg_empty_row',{}); } } ui.helper.addClass(&quot;ui-state-highlight&quot;); $(&quot;td&quot;,ui.helper).each(function(i) { this.style.width = $t.grid.headers[i].width+&quot;px&quot;; }); if(opts.onstart &amp;&amp; $.isFunction(opts.onstart) ) { opts.onstart.call($($t),ev,ui); } }, stop :function(ev,ui) { if(ui.helper.dropped &amp;&amp; !opts.dragcopy) { var ids = $(ui.helper).attr(&quot;id&quot;); if(ids === undefined) { ids = $(this).attr(&quot;id&quot;); } $($t).jqGrid('delRowData',ids ); } // if we have a empty row inserted from start event try to delete it for (var i=0;i&lt;$.data($t,&quot;dnd&quot;).connectWith.length;i++){ $($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid('delRowData','jqg_empty_row'); } if(opts.onstop &amp;&amp; $.isFunction(opts.onstop) ) { opts.onstop.call($($t),ev,ui); } } },opts.drag_opts || {}); }, &quot;drop&quot; : function (opts) { return $.extend({ accept: function(d) { if (!$(d).hasClass('jqgrow')) { return d;} var tid = $(d).closest(&quot;table.ui-jqgrid-btable&quot;); if(tid.length &gt; 0 &amp;&amp; $.data(tid[0],&quot;dnd&quot;) !== undefined) { var cn = $.data(tid[0],&quot;dnd&quot;).connectWith; return $.inArray('#'+$.jgrid.jqID(this.id),cn) != -1 ? true : false; } return false; }, drop: function(ev, ui) { if (!$(ui.draggable).hasClass('jqgrow')) { return; } var accept = $(ui.draggable).attr(&quot;id&quot;); var getdata = ui.draggable.parent().parent().jqGrid('getRowData',accept); if(!opts.dropbyname) { var j =0, tmpdata = {}, nm; var dropmodel = $(&quot;#&quot;+$.jgrid.jqID(this.id)).jqGrid('getGridParam','colModel'); try { for (var key in getdata) { nm = dropmodel[j].name; if( !(nm == 'cb' || nm =='rn' || nm == 'subgrid' )) { if(getdata.hasOwnProperty(key) &amp;&amp; dropmodel[j]) { tmpdata[nm] = getdata[key]; } } j++; } getdata = tmpdata; } catch (e) {} } ui.helper.dropped = true; if(opts.beforedrop &amp;&amp; $.isFunction(opts.beforedrop) ) { //parameters to this callback - event, element, data to be inserted, sender, reciever // should return object which will be inserted into the reciever var datatoinsert = opts.beforedrop.call(this,ev,ui,getdata,$('#'+$.jgrid.jqID($t.p.id)),$(this)); if (typeof datatoinsert != &quot;undefined&quot; &amp;&amp; datatoinsert !== null &amp;&amp; typeof datatoinsert == &quot;object&quot;) { getdata = datatoinsert; } } if(ui.helper.dropped) { var grid; if(opts.autoid) { if($.isFunction(opts.autoid)) { grid = opts.autoid.call(this,getdata); } else { grid = Math.ceil(Math.random()*1000); grid = opts.autoidprefix+grid; } } // NULL is interpreted as undefined while null as object $(&quot;#&quot;+$.jgrid.jqID(this.id)).jqGrid('addRowData',grid,getdata,opts.droppos); } if(opts.ondrop &amp;&amp; $.isFunction(opts.ondrop) ) { opts.ondrop.call(this,ev,ui, getdata); } }}, opts.drop_opts || {}); }, &quot;onstart&quot; : null, &quot;onstop&quot; : null, &quot;beforedrop&quot;: null, &quot;ondrop&quot; : null, &quot;drop_opts&quot; : { &quot;activeClass&quot;: &quot;ui-state-active&quot;, &quot;hoverClass&quot;: &quot;ui-state-hover&quot; }, &quot;drag_opts&quot; : { &quot;revert&quot;: &quot;invalid&quot;, &quot;helper&quot;: &quot;clone&quot;, &quot;cursor&quot;: &quot;move&quot;, &quot;appendTo&quot; : &quot;#jqgrid_dnd&quot;, &quot;zIndex&quot;: 5000 }, &quot;dragcopy&quot;: false, &quot;dropbyname&quot; : false, &quot;droppos&quot; : &quot;first&quot;, &quot;autoid&quot; : true, &quot;autoidprefix&quot; : &quot;dnd_&quot; }, opts || {}); if(!opts.connectWith) { return; } opts.connectWith = opts.connectWith.split(&quot;,&quot;); opts.connectWith = $.map(opts.connectWith,function(n){return $.trim(n);}); $.data($t,&quot;dnd&quot;,opts); if($t.p.reccount != &quot;0&quot; &amp;&amp; !$t.p.jqgdnd) { updateDnD(); } $t.p.jqgdnd = true; for (var i=0;i&lt;opts.connectWith.length;i++){ var cn =opts.connectWith[i]; $(cn).droppable($.isFunction(opts.drop) ? opts.drop.call($($t),opts) : opts.drop); } }); }, gridResize : function(opts) { return this.each(function(){ var $t = this, gID = $.jgrid.jqID($t.p.id); if(!$t.grid || !$.fn.resizable) { return; } opts = $.extend({}, opts || {}); if(opts.alsoResize ) { opts._alsoResize_ = opts.alsoResize; delete opts.alsoResize; } else { opts._alsoResize_ = false; } if(opts.stop &amp;&amp; $.isFunction(opts.stop)) { opts._stop_ = opts.stop; delete opts.stop; } else { opts._stop_ = false; } opts.stop = function (ev, ui) { $($t).jqGrid('setGridParam',{height:$(&quot;#gview_&quot;+gID+&quot; .ui-jqgrid-bdiv&quot;).height()}); $($t).jqGrid('setGridWidth',ui.size.width,opts.shrinkToFit); if(opts._stop_) { opts._stop_.call($t,ev,ui); } }; if(opts._alsoResize_) { var optstest = &quot;{\\'#gview_&quot;+gID+&quot; .ui-jqgrid-bdiv\\':true,'&quot; +opts._alsoResize_+&quot;':true}&quot;; opts.alsoResize = eval('('+optstest+')'); // the only way that I found to do this } else { opts.alsoResize = $(&quot;.ui-jqgrid-bdiv&quot;,&quot;#gview_&quot;+gID); } delete opts._alsoResize_; $(&quot;#gbox_&quot;+gID).resizable(opts); }); } }); })(jQuery); /* Transform a table to a jqGrid. Peter Romianowski &lt;peter.romianowski@optivo.de&gt; If the first column of the table contains checkboxes or radiobuttons then the jqGrid is made selectable. */ // Addition - selector can be a class or id function tableToGrid(selector, options) { jQuery(selector).each(function() { if(this.grid) {return;} //Adedd from Tony Tomov // This is a small &quot;hack&quot; to make the width of the jqGrid 100% jQuery(this).width(&quot;99%&quot;); var w = jQuery(this).width(); // Text whether we have single or multi select var inputCheckbox = jQuery('tr td:first-child input[type=checkbox]:first', jQuery(this)); var inputRadio = jQuery('tr td:first-child input[type=radio]:first', jQuery(this)); var selectMultiple = inputCheckbox.length &gt; 0; var selectSingle = !selectMultiple &amp;&amp; inputRadio.length &gt; 0; var selectable = selectMultiple || selectSingle; //var inputName = inputCheckbox.attr(&quot;name&quot;) || inputRadio.attr(&quot;name&quot;); // Build up the columnModel and the data var colModel = []; var colNames = []; jQuery('th', jQuery(this)).each(function() { if (colModel.length === 0 &amp;&amp; selectable) { colModel.push({ name: '__selection__', index: '__selection__', width: 0, hidden: true }); colNames.push('__selection__'); } else { colModel.push({ name: jQuery(this).attr(&quot;id&quot;) || jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'), index: jQuery(this).attr(&quot;id&quot;) || jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'), width: jQuery(this).width() || 150 }); colNames.push(jQuery(this).html()); } }); var data = []; var rowIds = []; var rowChecked = []; jQuery('tbody &gt; tr', jQuery(this)).each(function() { var row = {}; var rowPos = 0; jQuery('td', jQuery(this)).each(function() { if (rowPos === 0 &amp;&amp; selectable) { var input = jQuery('input', jQuery(this)); var rowId = input.attr(&quot;value&quot;); rowIds.push(rowId || data.length); if (input.is(&quot;:checked&quot;)) { rowChecked.push(rowId); } row[colModel[rowPos].name] = input.attr(&quot;value&quot;); } else { row[colModel[rowPos].name] = jQuery(this).html(); } rowPos++; }); if(rowPos &gt;0) { data.push(row); } }); // Clear the original HTML table jQuery(this).empty(); // Mark it as jqGrid jQuery(this).addClass(&quot;scroll&quot;); jQuery(this).jqGrid(jQuery.extend({ datatype: &quot;local&quot;, width: w, colNames: colNames, colModel: colModel, multiselect: selectMultiple //inputName: inputName, //inputValueCol: imputName != null ? &quot;__selection__&quot; : null }, options || {})); // Add data var a; for (a = 0; a &lt; data.length; a++) { var id = null; if (rowIds.length &gt; 0) { id = rowIds[a]; if (id &amp;&amp; id.replace) { // We have to do this since the value of a checkbox // or radio button can be anything id = encodeURIComponent(id).replace(/[.\\-%]/g, &quot;_&quot;); } } if (id === null) { id = a + 1; } jQuery(this).jqGrid(&quot;addRowData&quot;,id, data[a]); } // Set the selection for (a = 0; a &lt; rowChecked.length; a++) { jQuery(this).jqGrid(&quot;setSelection&quot;,rowChecked[a]); } }); }; × Search results Close "},"core_jqGrid_jquery.jqGrid.src.js.html":{"id":"core_jqGrid_jquery.jqGrid.src.js.html","title":"Source: core/jqGrid/jquery.jqGrid.src.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: core/jqGrid/jquery.jqGrid.src.js // ==ClosureCompiler== // @compilation_level SIMPLE_OPTIMIZATIONS /* * @license jqGrid 4.4.4 - jQuery Grid * Copyright (c) 2008, Tony Tomov, tony@trirand.com * Dual licensed under the MIT and GPL licenses * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * Date: 2013-01-30 */ //jsHint options /*jshint evil:true, eqeqeq:false, eqnull:true, devel:true */ /*global jQuery, DOMParser, ActiveXObject */ (function ($) { &quot;use strict&quot;; $.jgrid = $.jgrid || {}; $.extend($.jgrid,{ version : &quot;4.4.4&quot;, htmlDecode : function(value){ if(value &amp;&amp; (value=='&amp;nbsp;' || value=='&amp;#160;' || (value.length===1 &amp;&amp; value.charCodeAt(0)===160))) { return &quot;&quot;;} return !value ? value : String(value).replace(/&amp;gt;/g, &quot;&gt;&quot;).replace(/&amp;lt;/g, &quot;&lt;&quot;).replace(/&amp;quot;/g, '&quot;').replace(/&amp;amp;/g, &quot;&amp;&quot;); }, htmlEncode : function (value){ return !value ? value : String(value).replace(/&amp;/g, &quot;&amp;amp;&quot;).replace(/\\&quot;/g, &quot;&amp;quot;&quot;).replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;); }, format : function(format){ //jqgformat var args = $.makeArray(arguments).slice(1); if(format==null) { format = &quot;&quot;; } return format.replace(/\\{(\\d+)\\}/g, function(m, i){ return args[i]; }); }, msie : navigator.appName == 'Microsoft Internet Explorer', msiever : function () { var rv = -1; var ua = navigator.userAgent; var re = new RegExp(&quot;MSIE ([0-9]{1,}[\\.0-9]{0,})&quot;); if (re.exec(ua) != null) { rv = parseFloat( RegExp.$1 ); } return rv; }, getCellIndex : function (cell) { var c = $(cell); if (c.is('tr')) { return -1; } c = (!c.is('td') &amp;&amp; !c.is('th') ? c.closest(&quot;td,th&quot;) : c)[0]; if ($.jgrid.msie) { return $.inArray(c, c.parentNode.cells); } return c.cellIndex; }, stripHtml : function(v) { v = String(v); var regexp = /&lt;(&quot;[^&quot;]*&quot;|'[^']*'|[^'&quot;&gt;])*&gt;/gi; if (v) { v = v.replace(regexp,&quot;&quot;); return (v &amp;&amp; v !== '&amp;nbsp;' &amp;&amp; v !== '&amp;#160;') ? v.replace(/\\&quot;/g,&quot;'&quot;) : &quot;&quot;; } return v; }, stripPref : function (pref, id) { var obj = $.type( pref ); if( obj == &quot;string&quot; || obj ==&quot;number&quot;) { pref = String(pref); id = pref !== &quot;&quot; ? String(id).replace(String(pref), &quot;&quot;) : id; } return id; }, stringToDoc : function (xmlString) { var xmlDoc; if(typeof xmlString !== 'string') { return xmlString; } try { var parser = new DOMParser(); xmlDoc = parser.parseFromString(xmlString,&quot;text/xml&quot;); } catch(e) { xmlDoc = new ActiveXObject(&quot;Microsoft.XMLDOM&quot;); xmlDoc.async=false; xmlDoc.loadXML(xmlString); } return (xmlDoc &amp;&amp; xmlDoc.documentElement &amp;&amp; xmlDoc.documentElement.tagName != 'parsererror') ? xmlDoc : null; }, parse : function(jsonString) { var js = jsonString; if (js.substr(0,9) == &quot;while(1);&quot;) { js = js.substr(9); } if (js.substr(0,2) == &quot;/*&quot;) { js = js.substr(2,js.length-4); } if(!js) { js = &quot;{}&quot;; } return ($.jgrid.useJSON===true &amp;&amp; typeof JSON === 'object' &amp;&amp; typeof JSON.parse === 'function') ? JSON.parse(js) : eval('(' + js + ')'); }, parseDate : function(format, date) { var tsp = {m : 1, d : 1, y : 1970, h : 0, i : 0, s : 0, u:0},k,hl,dM, regdate = /[\\\\\\/:_;.,\\t\\T\\s-]/; if(date &amp;&amp; date != null){ date = $.trim(date); date = date.split(regdate); if ($.jgrid.formatter.date.masks[format] !== undefined) { format = $.jgrid.formatter.date.masks[format]; } format = format.split(regdate); var dfmt = $.jgrid.formatter.date.monthNames; var afmt = $.jgrid.formatter.date.AmPm; var h12to24 = function(ampm, h){ if (ampm === 0){ if (h === 12) { h = 0;} } else { if (h !== 12) { h += 12; } } return h; }; for(k=0,hl=format.length;k&lt;hl;k++){ if(format[k] == 'M') { dM = $.inArray(date[k],dfmt); if(dM !== -1 &amp;&amp; dM &lt; 12){ date[k] = dM+1; tsp.m = date[k]; } } if(format[k] == 'F') { dM = $.inArray(date[k],dfmt); if(dM !== -1 &amp;&amp; dM &gt; 11){ date[k] = dM+1-12; tsp.m = date[k]; } } if(format[k] == 'a') { dM = $.inArray(date[k],afmt); if(dM !== -1 &amp;&amp; dM &lt; 2 &amp;&amp; date[k] == afmt[dM]){ date[k] = dM; tsp.h = h12to24(date[k], tsp.h); } } if(format[k] == 'A') { dM = $.inArray(date[k],afmt); if(dM !== -1 &amp;&amp; dM &gt; 1 &amp;&amp; date[k] == afmt[dM]){ date[k] = dM-2; tsp.h = h12to24(date[k], tsp.h); } } if (format[k] === 'g') { tsp.h = parseInt(date[k], 10); } if(date[k] !== undefined) { tsp[format[k].toLowerCase()] = parseInt(date[k],10); } } tsp.m = parseInt(tsp.m,10)-1; var ty = tsp.y; if (ty &gt;= 70 &amp;&amp; ty &lt;= 99) {tsp.y = 1900+tsp.y;} else if (ty &gt;=0 &amp;&amp; ty &lt;=69) {tsp.y= 2000+tsp.y;} if(tsp.j !== undefined) { tsp.d = tsp.j; } if(tsp.n !== undefined) { tsp.m = parseInt(tsp.n,10)-1; } } return new Date(tsp.y, tsp.m, tsp.d, tsp.h, tsp.i, tsp.s, tsp.u); }, jqID : function(sid){ return String(sid).replace(/[!&quot;#$%&amp;'()*+,.\\/:; &lt;=&gt;?@\\[\\\\\\]\\^`{|}~]/g,&quot;\\\\$&amp;&quot;); }, guid : 1, uidPref: 'jqg', randId : function( prefix ) { return (prefix || $.jgrid.uidPref) + ($.jgrid.guid++); }, getAccessor : function(obj, expr) { var ret,p,prm = [], i; if( typeof expr === 'function') { return expr(obj); } ret = obj[expr]; if(ret===undefined) { try { if ( typeof expr === 'string' ) { prm = expr.split('.'); } i = prm.length; if( i ) { ret = obj; while (ret &amp;&amp; i--) { p = prm.shift(); ret = ret[p]; } } } catch (e) {} } return ret; }, getXmlData: function (obj, expr, returnObj) { var ret, m = typeof expr === 'string' ? expr.match(/^(.*)\\[(\\w+)\\]$/) : null; if (typeof expr === 'function') { return expr(obj); } if (m &amp;&amp; m[2]) { // m[2] is the attribute selector // m[1] is an optional element selector // examples: &quot;[id]&quot;, &quot;rows[page]&quot; return m[1] ? $(m[1], obj).attr(m[2]) : $(obj).attr(m[2]); } ret = $(expr, obj); if (returnObj) { return ret; } //$(expr, obj).filter(':last'); // we use ':last' to be more compatible with old version of jqGrid return ret.length &gt; 0 ? $(ret).text() : undefined; }, cellWidth : function () { var $testDiv = $(&quot;&lt;div class='ui-jqgrid' style='left:10000px'&gt;&lt;table class='ui-jqgrid-btable' style='width:5px;'&gt;&lt;tr class='jqgrow'&gt;&lt;td style='width:5px;'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&quot;), testCell = $testDiv.appendTo(&quot;body&quot;) .find(&quot;td&quot;) .width(); $testDiv.remove(); return testCell !== 5; }, cell_width : true, ajaxOptions: {}, from : function(source){ // Original Author Hugo Bonacci // License MIT http://jlinq.codeplex.com/license var QueryObject=function(d,q){ if(typeof d===&quot;string&quot;){ d=$.data(d); } var self=this, _data=d, _usecase=true, _trim=false, _query=q, _stripNum = /[\\$,%]/g, _lastCommand=null, _lastField=null, _orDepth=0, _negate=false, _queuedOperator=&quot;&quot;, _sorting=[], _useProperties=true; if(typeof d===&quot;object&quot;&amp;&amp;d.push) { if(d.length&gt;0){ if(typeof d[0]!==&quot;object&quot;){ _useProperties=false; }else{ _useProperties=true; } } }else{ throw &quot;data provides is not an array&quot;; } this._hasData=function(){ return _data===null?false:_data.length===0?false:true; }; this._getStr=function(s){ var phrase=[]; if(_trim){ phrase.push(&quot;jQuery.trim(&quot;); } phrase.push(&quot;String(&quot;+s+&quot;)&quot;); if(_trim){ phrase.push(&quot;)&quot;); } if(!_usecase){ phrase.push(&quot;.toLowerCase()&quot;); } return phrase.join(&quot;&quot;); }; this._strComp=function(val){ if(typeof val===&quot;string&quot;){ return&quot;.toString()&quot;; } return&quot;&quot;; }; this._group=function(f,u){ return({field:f.toString(),unique:u,items:[]}); }; this._toStr=function(phrase){ if(_trim){ phrase=$.trim(phrase); } phrase=phrase.toString().replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;'); return _usecase ? phrase : phrase.toLowerCase(); }; this._funcLoop=function(func){ var results=[]; $.each(_data,function(i,v){ results.push(func(v)); }); return results; }; this._append=function(s){ var i; if(_query===null){ _query=&quot;&quot;; } else { _query+=_queuedOperator === &quot;&quot; ? &quot; &amp;&amp; &quot; :_queuedOperator; } for (i=0;i&lt;_orDepth;i++){ _query+=&quot;(&quot;; } if(_negate){ _query+=&quot;!&quot;; } _query+=&quot;(&quot;+s+&quot;)&quot;; _negate=false; _queuedOperator=&quot;&quot;; _orDepth=0; }; this._setCommand=function(f,c){ _lastCommand=f; _lastField=c; }; this._resetNegate=function(){ _negate=false; }; this._repeatCommand=function(f,v){ if(_lastCommand===null){ return self; } if(f!==null&amp;&amp;v!==null){ return _lastCommand(f,v); } if(_lastField===null){ return _lastCommand(f); } if(!_useProperties){ return _lastCommand(f); } return _lastCommand(_lastField,f); }; this._equals=function(a,b){ return(self._compare(a,b,1)===0); }; this._compare=function(a,b,d){ var toString = Object.prototype.toString; if( d === undefined) { d = 1; } if(a===undefined) { a = null; } if(b===undefined) { b = null; } if(a===null &amp;&amp; b===null){ return 0; } if(a===null&amp;&amp;b!==null){ return 1; } if(a!==null&amp;&amp;b===null){ return -1; } if (toString.call(a) === '[object Date]' &amp;&amp; toString.call(b) === '[object Date]') { if (a &lt; b) { return -d; } if (a &gt; b) { return d; } return 0; } if(!_usecase &amp;&amp; typeof a !== &quot;number&quot; &amp;&amp; typeof b !== &quot;number&quot; ) { a=String(a); b=String(b); } if(a&lt;b){return -d;} if(a&gt;b){return d;} return 0; }; this._performSort=function(){ if(_sorting.length===0){return;} _data=self._doSort(_data,0); }; this._doSort=function(d,q){ var by=_sorting[q].by, dir=_sorting[q].dir, type = _sorting[q].type, dfmt = _sorting[q].datefmt; if(q==_sorting.length-1){ return self._getOrder(d, by, dir, type, dfmt); } q++; var values=self._getGroup(d,by,dir,type,dfmt), results=[], i, j, sorted; for(i=0;i&lt;values.length;i++){ sorted=self._doSort(values[i].items,q); for(j=0;j&lt;sorted.length;j++){ results.push(sorted[j]); } } return results; }; this._getOrder=function(data,by,dir,type, dfmt){ var sortData=[],_sortData=[], newDir = dir==&quot;a&quot; ? 1 : -1, i,ab,j, findSortKey; if(type === undefined ) { type = &quot;text&quot;; } if (type == 'float' || type== 'number' || type== 'currency' || type== 'numeric') { findSortKey = function($cell) { var key = parseFloat( String($cell).replace(_stripNum, '')); return isNaN(key) ? 0.00 : key; }; } else if (type=='int' || type=='integer') { findSortKey = function($cell) { return $cell ? parseFloat(String($cell).replace(_stripNum, '')) : 0; }; } else if(type == 'date' || type == 'datetime') { findSortKey = function($cell) { return $.jgrid.parseDate(dfmt,$cell).getTime(); }; } else if($.isFunction(type)) { findSortKey = type; } else { findSortKey = function($cell) { $cell = $cell ? $.trim(String($cell)) : &quot;&quot;; return _usecase ? $cell : $cell.toLowerCase(); }; } $.each(data,function(i,v){ ab = by!==&quot;&quot; ? $.jgrid.getAccessor(v,by) : v; if(ab === undefined) { ab = &quot;&quot;; } ab = findSortKey(ab, v); _sortData.push({ 'vSort': ab,'index':i}); }); _sortData.sort(function(a,b){ a = a.vSort; b = b.vSort; return self._compare(a,b,newDir); }); j=0; var nrec= data.length; // overhead, but we do not change the original data. while(j&lt;nrec) { i = _sortData[j].index; sortData.push(data[i]); j++; } return sortData; }; this._getGroup=function(data,by,dir,type, dfmt){ var results=[], group=null, last=null, val; $.each(self._getOrder(data,by,dir,type, dfmt),function(i,v){ val = $.jgrid.getAccessor(v, by); if(val == null) { val = &quot;&quot;; } if(!self._equals(last,val)){ last=val; if(group !== null){ results.push(group); } group=self._group(by,val); } group.items.push(v); }); if(group !== null){ results.push(group); } return results; }; this.ignoreCase=function(){ _usecase=false; return self; }; this.useCase=function(){ _usecase=true; return self; }; this.trim=function(){ _trim=true; return self; }; this.noTrim=function(){ _trim=false; return self; }; this.execute=function(){ var match=_query, results=[]; if(match === null){ return self; } $.each(_data,function(){ if(eval(match)){results.push(this);} }); _data=results; return self; }; this.data=function(){ return _data; }; this.select=function(f){ self._performSort(); if(!self._hasData()){ return[]; } self.execute(); if($.isFunction(f)){ var results=[]; $.each(_data,function(i,v){ results.push(f(v)); }); return results; } return _data; }; this.hasMatch=function(){ if(!self._hasData()) { return false; } self.execute(); return _data.length&gt;0; }; this.andNot=function(f,v,x){ _negate=!_negate; return self.and(f,v,x); }; this.orNot=function(f,v,x){ _negate=!_negate; return self.or(f,v,x); }; this.not=function(f,v,x){ return self.andNot(f,v,x); }; this.and=function(f,v,x){ _queuedOperator=&quot; &amp;&amp; &quot;; if(f===undefined){ return self; } return self._repeatCommand(f,v,x); }; this.or=function(f,v,x){ _queuedOperator=&quot; || &quot;; if(f===undefined) { return self; } return self._repeatCommand(f,v,x); }; this.orBegin=function(){ _orDepth++; return self; }; this.orEnd=function(){ if (_query !== null){ _query+=&quot;)&quot;; } return self; }; this.isNot=function(f){ _negate=!_negate; return self.is(f); }; this.is=function(f){ self._append('this.'+f); self._resetNegate(); return self; }; this._compareValues=function(func,f,v,how,t){ var fld; if(_useProperties){ fld='jQuery.jgrid.getAccessor(this,\\''+f+'\\')'; }else{ fld='this'; } if(v===undefined) { v = null; } //var val=v===null?f:v, var val =v, swst = t.stype === undefined ? &quot;text&quot; : t.stype; if(v !== null) { switch(swst) { case 'int': case 'integer': val = (isNaN(Number(val)) || val===&quot;&quot;) ? '0' : val; // To be fixed with more inteligent code fld = 'parseInt('+fld+',10)'; val = 'parseInt('+val+',10)'; break; case 'float': case 'number': case 'numeric': val = String(val).replace(_stripNum, ''); val = (isNaN(Number(val)) || val===&quot;&quot;) ? '0' : val; // To be fixed with more inteligent code fld = 'parseFloat('+fld+')'; val = 'parseFloat('+val+')'; break; case 'date': case 'datetime': val = String($.jgrid.parseDate(t.newfmt || 'Y-m-d',val).getTime()); fld = 'jQuery.jgrid.parseDate(&quot;'+t.srcfmt+'&quot;,'+fld+').getTime()'; break; default : fld=self._getStr(fld); val=self._getStr('&quot;'+self._toStr(val)+'&quot;'); } } self._append(fld+' '+how+' '+val); self._setCommand(func,f); self._resetNegate(); return self; }; this.equals=function(f,v,t){ return self._compareValues(self.equals,f,v,&quot;==&quot;,t); }; this.notEquals=function(f,v,t){ return self._compareValues(self.equals,f,v,&quot;!==&quot;,t); }; this.isNull = function(f,v,t){ return self._compareValues(self.equals,f,null,&quot;===&quot;,t); }; this.greater=function(f,v,t){ return self._compareValues(self.greater,f,v,&quot;&gt;&quot;,t); }; this.less=function(f,v,t){ return self._compareValues(self.less,f,v,&quot;&lt;&quot;,t); }; this.greaterOrEquals=function(f,v,t){ return self._compareValues(self.greaterOrEquals,f,v,&quot;&gt;=&quot;,t); }; this.lessOrEquals=function(f,v,t){ return self._compareValues(self.lessOrEquals,f,v,&quot;&lt;=&quot;,t); }; this.startsWith=function(f,v){ var val = (v==null) ? f: v, length=_trim ? $.trim(val.toString()).length : val.toString().length; if(_useProperties){ self._append(self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.substr(0,'+length+') == '+self._getStr('&quot;'+self._toStr(v)+'&quot;')); }else{ length=_trim?$.trim(v.toString()).length:v.toString().length; self._append(self._getStr('this')+'.substr(0,'+length+') == '+self._getStr('&quot;'+self._toStr(f)+'&quot;')); } self._setCommand(self.startsWith,f); self._resetNegate(); return self; }; this.endsWith=function(f,v){ var val = (v==null) ? f: v, length=_trim ? $.trim(val.toString()).length:val.toString().length; if(_useProperties){ self._append(self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.substr('+self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.length-'+length+','+length+') == &quot;'+self._toStr(v)+'&quot;'); } else { self._append(self._getStr('this')+'.substr('+self._getStr('this')+'.length-&quot;'+self._toStr(f)+'&quot;.length,&quot;'+self._toStr(f)+'&quot;.length) == &quot;'+self._toStr(f)+'&quot;'); } self._setCommand(self.endsWith,f);self._resetNegate(); return self; }; this.contains=function(f,v){ if(_useProperties){ self._append(self._getStr('jQuery.jgrid.getAccessor(this,\\''+f+'\\')')+'.indexOf(&quot;'+self._toStr(v)+'&quot;,0) &gt; -1'); }else{ self._append(self._getStr('this')+'.indexOf(&quot;'+self._toStr(f)+'&quot;,0) &gt; -1'); } self._setCommand(self.contains,f); self._resetNegate(); return self; }; this.groupBy=function(by,dir,type, datefmt){ if(!self._hasData()){ return null; } return self._getGroup(_data,by,dir,type, datefmt); }; this.orderBy=function(by,dir,stype, dfmt){ dir = dir == null ? &quot;a&quot; :$.trim(dir.toString().toLowerCase()); if(stype == null) { stype = &quot;text&quot;; } if(dfmt == null) { dfmt = &quot;Y-m-d&quot;; } if(dir==&quot;desc&quot;||dir==&quot;descending&quot;){dir=&quot;d&quot;;} if(dir==&quot;asc&quot;||dir==&quot;ascending&quot;){dir=&quot;a&quot;;} _sorting.push({by:by,dir:dir,type:stype, datefmt: dfmt}); return self; }; return self; }; return new QueryObject(source,null); }, getMethod: function (name) { return this.getAccessor($.fn.jqGrid, name); }, extend : function(methods) { $.extend($.fn.jqGrid,methods); if (!this.no_legacy_api) { $.fn.extend(methods); } } }); $.fn.jqGrid = function( pin ) { if (typeof pin === 'string') { var fn = $.jgrid.getMethod(pin); if (!fn) { throw (&quot;jqGrid - No such method: &quot; + pin); } var args = $.makeArray(arguments).slice(1); return fn.apply(this,args); } return this.each( function() { if(this.grid) {return;} var p = $.extend(true,{ url: &quot;&quot;, height: 150, page: 1, rowNum: 20, rowTotal : null, records: 0, pager: &quot;&quot;, pgbuttons: true, pginput: true, colModel: [], rowList: [], colNames: [], sortorder: &quot;asc&quot;, sortname: &quot;&quot;, datatype: &quot;xml&quot;, mtype: &quot;GET&quot;, altRows: false, selarrrow: [], savedRow: [], shrinkToFit: true, xmlReader: {}, jsonReader: {}, subGrid: false, subGridModel :[], reccount: 0, lastpage: 0, lastsort: 0, selrow: null, beforeSelectRow: null, onSelectRow: null, onSortCol: null, ondblClickRow: null, onRightClickRow: null, onPaging: null, onSelectAll: null, onInitGrid : null, loadComplete: null, gridComplete: null, loadError: null, loadBeforeSend: null, afterInsertRow: null, beforeRequest: null, beforeProcessing : null, onHeaderClick: null, viewrecords: false, loadonce: false, multiselect: false, multikey: false, editurl: null, search: false, caption: &quot;&quot;, hidegrid: true, hiddengrid: false, postData: {}, userData: {}, treeGrid : false, treeGridModel : 'nested', treeReader : {}, treeANode : -1, ExpandColumn: null, tree_root_level : 0, prmNames: {page:&quot;page&quot;,rows:&quot;rows&quot;, sort: &quot;sidx&quot;,order: &quot;sord&quot;, search:&quot;_search&quot;, nd:&quot;nd&quot;, id:&quot;id&quot;,oper:&quot;oper&quot;,editoper:&quot;edit&quot;,addoper:&quot;add&quot;,deloper:&quot;del&quot;, subgridid:&quot;id&quot;, npage: null, totalrows:&quot;totalrows&quot;}, forceFit : false, gridstate : &quot;visible&quot;, cellEdit: false, cellsubmit: &quot;remote&quot;, nv:0, loadui: &quot;enable&quot;, toolbar: [false,&quot;&quot;], scroll: false, multiboxonly : false, deselectAfterSort : true, scrollrows : false, autowidth: false, scrollOffset :18, cellLayout: 5, subGridWidth: 20, multiselectWidth: 20, gridview: false, rownumWidth: 25, rownumbers : false, pagerpos: 'center', recordpos: 'right', footerrow : false, userDataOnFooter : false, hoverrows : true, altclass : 'ui-priority-secondary', viewsortcols : [false,'vertical',true], resizeclass : '', autoencode : false, remapColumns : [], ajaxGridOptions :{}, direction : &quot;ltr&quot;, toppager: false, headertitles: false, scrollTimeout: 40, data : [], _index : {}, grouping : false, groupingView : {groupField:[],groupOrder:[], groupText:[],groupColumnShow:[],groupSummary:[], showSummaryOnHide: false, sortitems:[], sortnames:[], summary:[],summaryval:[], plusicon: 'ui-icon-circlesmall-plus', minusicon: 'ui-icon-circlesmall-minus', displayField: []}, ignoreCase : false, cmTemplate : {}, idPrefix : &quot;&quot; }, $.jgrid.defaults, pin || {}); var ts= this, grid={ headers:[], cols:[], footers: [], dragStart: function(i,x,y) { this.resizing = { idx: i, startX: x.clientX, sOL : y[0]}; this.hDiv.style.cursor = &quot;col-resize&quot;; this.curGbox = $(&quot;#rs_m&quot;+$.jgrid.jqID(p.id),&quot;#gbox_&quot;+$.jgrid.jqID(p.id)); this.curGbox.css({display:&quot;block&quot;,left:y[0],top:y[1],height:y[2]}); $(ts).triggerHandler(&quot;jqGridResizeStart&quot;, [x, i]); if($.isFunction(p.resizeStart)) { p.resizeStart.call(this,x,i); } document.onselectstart=function(){return false;}; }, dragMove: function(x) { if(this.resizing) { var diff = x.clientX-this.resizing.startX, h = this.headers[this.resizing.idx], newWidth = p.direction === &quot;ltr&quot; ? h.width + diff : h.width - diff, hn, nWn; if(newWidth &gt; 33) { this.curGbox.css({left:this.resizing.sOL+diff}); if(p.forceFit===true ){ hn = this.headers[this.resizing.idx+p.nv]; nWn = p.direction === &quot;ltr&quot; ? hn.width - diff : hn.width + diff; if(nWn &gt;33) { h.newWidth = newWidth; hn.newWidth = nWn; } } else { this.newWidth = p.direction === &quot;ltr&quot; ? p.tblwidth+diff : p.tblwidth-diff; h.newWidth = newWidth; } } } }, dragEnd: function() { this.hDiv.style.cursor = &quot;default&quot;; if(this.resizing) { var idx = this.resizing.idx, nw = this.headers[idx].newWidth || this.headers[idx].width; nw = parseInt(nw,10); this.resizing = false; $(&quot;#rs_m&quot;+$.jgrid.jqID(p.id)).css(&quot;display&quot;,&quot;none&quot;); p.colModel[idx].width = nw; this.headers[idx].width = nw; this.headers[idx].el.style.width = nw + &quot;px&quot;; this.cols[idx].style.width = nw+&quot;px&quot;; if(this.footers.length&gt;0) {this.footers[idx].style.width = nw+&quot;px&quot;;} if(p.forceFit===true){ nw = this.headers[idx+p.nv].newWidth || this.headers[idx+p.nv].width; this.headers[idx+p.nv].width = nw; this.headers[idx+p.nv].el.style.width = nw + &quot;px&quot;; this.cols[idx+p.nv].style.width = nw+&quot;px&quot;; if(this.footers.length&gt;0) {this.footers[idx+p.nv].style.width = nw+&quot;px&quot;;} p.colModel[idx+p.nv].width = nw; } else { p.tblwidth = this.newWidth || p.tblwidth; $('table:first',this.bDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;); $('table:first',this.hDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;); this.hDiv.scrollLeft = this.bDiv.scrollLeft; if(p.footerrow) { $('table:first',this.sDiv).css(&quot;width&quot;,p.tblwidth+&quot;px&quot;); this.sDiv.scrollLeft = this.bDiv.scrollLeft; } } $(ts).triggerHandler(&quot;jqGridResizeStop&quot;, [nw, idx]); if($.isFunction(p.resizeStop)) { p.resizeStop.call(this,nw,idx); } } this.curGbox = null; document.onselectstart=function(){return true;}; }, populateVisible: function() { if (grid.timer) { clearTimeout(grid.timer); } grid.timer = null; var dh = $(grid.bDiv).height(); if (!dh) { return; } var table = $(&quot;table:first&quot;, grid.bDiv); var rows, rh; if(table[0].rows.length) { try { rows = table[0].rows[1]; rh = rows ? $(rows).outerHeight() || grid.prevRowHeight : grid.prevRowHeight; } catch (pv) { rh = grid.prevRowHeight; } } if (!rh) { return; } grid.prevRowHeight = rh; var rn = p.rowNum; var scrollTop = grid.scrollTop = grid.bDiv.scrollTop; var ttop = Math.round(table.position().top) - scrollTop; var tbot = ttop + table.height(); var div = rh * rn; var page, npage, empty; if ( tbot &lt; dh &amp;&amp; ttop &lt;= 0 &amp;&amp; (p.lastpage===undefined||parseInt((tbot + scrollTop + div - 1) / div,10) &lt;= p.lastpage)) { npage = parseInt((dh - tbot + div - 1) / div,10); if (tbot &gt;= 0 || npage &lt; 2 || p.scroll === true) { page = Math.round((tbot + scrollTop) / div) + 1; ttop = -1; } else { ttop = 1; } } if (ttop &gt; 0) { page = parseInt(scrollTop / div,10) + 1; npage = parseInt((scrollTop + dh) / div,10) + 2 - page; empty = true; } if (npage) { if (p.lastpage &amp;&amp; (page &gt; p.lastpage || p.lastpage==1 || (page === p.page &amp;&amp; page===p.lastpage)) ) { return; } if (grid.hDiv.loading) { grid.timer = setTimeout(grid.populateVisible, p.scrollTimeout); } else { p.page = page; if (empty) { grid.selectionPreserver(table[0]); grid.emptyRows.call(table[0], false, false); } grid.populate(npage); } } }, scrollGrid: function( e ) { if(p.scroll) { var scrollTop = grid.bDiv.scrollTop; if(grid.scrollTop === undefined) { grid.scrollTop = 0; } if (scrollTop != grid.scrollTop) { grid.scrollTop = scrollTop; if (grid.timer) { clearTimeout(grid.timer); } grid.timer = setTimeout(grid.populateVisible, p.scrollTimeout); } } grid.hDiv.scrollLeft = grid.bDiv.scrollLeft; if(p.footerrow) { grid.sDiv.scrollLeft = grid.bDiv.scrollLeft; } if( e ) { e.stopPropagation(); } }, selectionPreserver : function(ts) { var p = ts.p, sr = p.selrow, sra = p.selarrrow ? $.makeArray(p.selarrrow) : null, left = ts.grid.bDiv.scrollLeft, restoreSelection = function() { var i; p.selrow = null; p.selarrrow = []; if(p.multiselect &amp;&amp; sra &amp;&amp; sra.length&gt;0) { for(i=0;i&lt;sra.length;i++){ if (sra[i] != sr) { $(ts).jqGrid(&quot;setSelection&quot;,sra[i],false, null); } } } if (sr) { $(ts).jqGrid(&quot;setSelection&quot;,sr,false,null); } ts.grid.bDiv.scrollLeft = left; $(ts).unbind('.selectionPreserver', restoreSelection); }; $(ts).bind('jqGridGridComplete.selectionPreserver', restoreSelection); } }; if(this.tagName.toUpperCase()!='TABLE') { alert(&quot;Element is not a table&quot;); return; } if(document.documentMode !== undefined ) { // IE only if(document.documentMode &lt;= 5) { alert(&quot;Grid can not be used in this ('quirks') mode!&quot;); return; } } $(this).empty().attr(&quot;tabindex&quot;,&quot;0&quot;); this.p = p ; this.p.useProp = !!$.fn.prop; var i, dir; if(this.p.colNames.length === 0) { for (i=0;i&lt;this.p.colModel.length;i++){ this.p.colNames[i] = this.p.colModel[i].label || this.p.colModel[i].name; } } if( this.p.colNames.length !== this.p.colModel.length ) { alert($.jgrid.errors.model); return; } var gv = $(&quot;&lt;div class='ui-jqgrid-view'&gt;&lt;/div&gt;&quot;), isMSIE = $.jgrid.msie; ts.p.direction = $.trim(ts.p.direction.toLowerCase()); if($.inArray(ts.p.direction,[&quot;ltr&quot;,&quot;rtl&quot;]) == -1) { ts.p.direction = &quot;ltr&quot;; } dir = ts.p.direction; $(gv).insertBefore(this); $(this).removeClass(&quot;scroll&quot;).appendTo(gv); var eg = $(&quot;&lt;div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'&gt;&lt;/div&gt;&quot;); $(eg).attr({&quot;id&quot; : &quot;gbox_&quot;+this.id,&quot;dir&quot;:dir}).insertBefore(gv); $(gv).attr(&quot;id&quot;,&quot;gview_&quot;+this.id).appendTo(eg); $(&quot;&lt;div class='ui-widget-overlay jqgrid-overlay' id='lui_&quot;+this.id+&quot;'&gt;&lt;/div&gt;&quot;).insertBefore(gv); $(&quot;&lt;div class='loading ui-state-default ui-state-active' id='load_&quot;+this.id+&quot;'&gt;&quot;+this.p.loadtext+&quot;&lt;/div&gt;&quot;).insertBefore(gv); $(this).attr({cellspacing:&quot;0&quot;,cellpadding:&quot;0&quot;,border:&quot;0&quot;,&quot;role&quot;:&quot;grid&quot;,&quot;aria-multiselectable&quot;:!!this.p.multiselect,&quot;aria-labelledby&quot;:&quot;gbox_&quot;+this.id}); var sortkeys = [&quot;shiftKey&quot;,&quot;altKey&quot;,&quot;ctrlKey&quot;], intNum = function(val,defval) { val = parseInt(val,10); if (isNaN(val)) { return defval || 0;} return val; }, formatCol = function (pos, rowInd, tv, rawObject, rowId, rdata){ var cm = ts.p.colModel[pos], ral = cm.align, result=&quot;style=\\&quot;&quot;, clas = cm.classes, nm = cm.name, celp, acp=[]; if(ral) { result += &quot;text-align:&quot;+ral+&quot;;&quot;; } if(cm.hidden===true) { result += &quot;display:none;&quot;; } if(rowInd===0) { result += &quot;width: &quot;+grid.headers[pos].width+&quot;px;&quot;; } else if (cm.cellattr &amp;&amp; $.isFunction(cm.cellattr)) { celp = cm.cellattr.call(ts, rowId, tv, rawObject, cm, rdata); if(celp &amp;&amp; typeof celp === &quot;string&quot;) { celp = celp.replace(/style/i,'style').replace(/title/i,'title'); if(celp.indexOf('title') &gt; -1) { cm.title=false;} if(celp.indexOf('class') &gt; -1) { clas = undefined;} acp = celp.split(&quot;style&quot;); if(acp.length === 2 ) { acp[1] = $.trim(acp[1].replace(&quot;=&quot;,&quot;&quot;)); if(acp[1].indexOf(&quot;'&quot;) === 0 || acp[1].indexOf('&quot;') === 0) { acp[1] = acp[1].substring(1); } result += acp[1].replace(/'/gi,'&quot;'); } else { result += &quot;\\&quot;&quot;; } } } if(!acp.length) { acp[0] = &quot;&quot;; result += &quot;\\&quot;&quot;;} result += (clas !== undefined ? (&quot; class=\\&quot;&quot;+clas+&quot;\\&quot;&quot;) :&quot;&quot;) + ((cm.title &amp;&amp; tv) ? (&quot; title=\\&quot;&quot;+$.jgrid.stripHtml(tv)+&quot;\\&quot;&quot;) :&quot;&quot;); result += &quot; aria-describedby=\\&quot;&quot;+ts.p.id+&quot;_&quot;+nm+&quot;\\&quot;&quot;; return result + acp[0]; }, cellVal = function (val) { return val == null || val === &quot;&quot; ? &quot;&amp;#160;&quot; : (ts.p.autoencode ? $.jgrid.htmlEncode(val) : String(val)); }, formatter = function (rowId, cellval , colpos, rwdat, _act){ var cm = ts.p.colModel[colpos],v; if(cm.formatter !== undefined) { rowId = String(ts.p.idPrefix) !== &quot;&quot; ? $.jgrid.stripPref(ts.p.idPrefix, rowId) : rowId; var opts= {rowId: rowId, colModel:cm, gid:ts.p.id, pos:colpos }; if($.isFunction( cm.formatter ) ) { v = cm.formatter.call(ts,cellval,opts,rwdat,_act); } else if($.fmatter){ v = $.fn.fmatter.call(ts,cm.formatter,cellval,opts,rwdat,_act); } else { v = cellVal(cellval); } } else { v = cellVal(cellval); } return v; }, addCell = function(rowId,cell,pos,irow, srvr, rdata) { var v,prp; v = formatter(rowId,cell,pos,srvr,'add'); prp = formatCol( pos,irow, v, srvr, rowId, rdata); return &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; }, addMulti = function(rowid,pos,irow,checked){ var v = &quot;&lt;input role=\\&quot;checkbox\\&quot; type=\\&quot;checkbox\\&quot;&quot;+&quot; id=\\&quot;jqg_&quot;+ts.p.id+&quot;_&quot;+rowid+&quot;\\&quot; class=\\&quot;cbox\\&quot; name=\\&quot;jqg_&quot;+ts.p.id+&quot;_&quot;+rowid+&quot;\\&quot;&quot; + (checked ? &quot;checked=\\&quot;checked\\&quot;&quot; : &quot;&quot;)+&quot;/&gt;&quot;, prp = formatCol( pos,irow,'',null, rowid, true); return &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; }, addRowNum = function (pos,irow,pG,rN) { var v = (parseInt(pG,10)-1)*parseInt(rN,10)+1+irow, prp = formatCol( pos,irow,v, null, irow, true); return &quot;&lt;td role=\\&quot;gridcell\\&quot; class=\\&quot;ui-state-default jqgrid-rownum\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; }, reader = function (datatype) { var field, f=[], j=0, i; for(i =0; i&lt;ts.p.colModel.length; i++){ field = ts.p.colModel[i]; if (field.name !== 'cb' &amp;&amp; field.name !=='subgrid' &amp;&amp; field.name !=='rn') { f[j]= datatype == &quot;local&quot; ? field.name : ( (datatype==&quot;xml&quot; || datatype === &quot;xmlstring&quot;) ? field.xmlmap || field.name : field.jsonmap || field.name ); j++; } } return f; }, orderedCols = function (offset) { var order = ts.p.remapColumns; if (!order || !order.length) { order = $.map(ts.p.colModel, function(v,i) { return i; }); } if (offset) { order = $.map(order, function(v) { return v&lt;offset?null:v-offset; }); } return order; }, emptyRows = function (scroll, locdata) { var firstrow; if (this.p.deepempty) { $(this.rows).slice(1).remove(); } else { firstrow = this.rows.length &gt; 0 ? this.rows[0] : null; $(this.firstChild).empty().append(firstrow); } if (scroll &amp;&amp; this.p.scroll) { $(this.grid.bDiv.firstChild).css({height: &quot;auto&quot;}); $(this.grid.bDiv.firstChild.firstChild).css({height: 0, display: &quot;none&quot;}); if (this.grid.bDiv.scrollTop !== 0) { this.grid.bDiv.scrollTop = 0; } } if(locdata === true &amp;&amp; this.p.treeGrid) { this.p.data = []; this.p._index = {}; } }, refreshIndex = function() { var datalen = ts.p.data.length, idname, i, val, ni = ts.p.rownumbers===true ? 1 :0, gi = ts.p.multiselect ===true ? 1 :0, si = ts.p.subGrid===true ? 1 :0; if(ts.p.keyIndex === false || ts.p.loadonce === true) { idname = ts.p.localReader.id; } else { idname = ts.p.colModel[ts.p.keyIndex+gi+si+ni].name; } for(i =0;i &lt; datalen; i++) { val = $.jgrid.getAccessor(ts.p.data[i],idname); if (val === undefined) { val=String(i+1); } ts.p._index[val] = i; } }, constructTr = function(id, hide, altClass, rd, cur, selected) { var tabindex = '-1', restAttr = '', attrName, style = hide ? 'display:none;' : '', classes = 'ui-widget-content jqgrow ui-row-' + ts.p.direction + altClass + (selected ? ' ui-state-highlight' : ''), rowAttrObj = $.isFunction(ts.p.rowattr) ? ts.p.rowattr.call(ts, rd, cur) : {}; if(!$.isEmptyObject( rowAttrObj )) { if (rowAttrObj.hasOwnProperty(&quot;id&quot;)) { id = rowAttrObj.id; delete rowAttrObj.id; } if (rowAttrObj.hasOwnProperty(&quot;tabindex&quot;)) { tabindex = rowAttrObj.tabindex; delete rowAttrObj.tabindex; } if (rowAttrObj.hasOwnProperty(&quot;style&quot;)) { style += rowAttrObj.style; delete rowAttrObj.style; } if (rowAttrObj.hasOwnProperty(&quot;class&quot;)) { classes += ' ' + rowAttrObj['class']; delete rowAttrObj['class']; } // dot't allow to change role attribute try { delete rowAttrObj.role; } catch(ra){} for (attrName in rowAttrObj) { if (rowAttrObj.hasOwnProperty(attrName)) { restAttr += ' ' + attrName + '=' + rowAttrObj[attrName]; } } } return '&lt;tr role=&quot;row&quot; id=&quot;' + id + '&quot; tabindex=&quot;' + tabindex + '&quot; class=&quot;' + classes + '&quot;' + (style === '' ? '' : ' style=&quot;' + style + '&quot;') + restAttr + '&gt;'; }, addXmlData = function (xml,t, rcnt, more, adjust) { var startReq = new Date(), locdata = (ts.p.datatype != &quot;local&quot; &amp;&amp; ts.p.loadonce) || ts.p.datatype == &quot;xmlstring&quot;, xmlid = &quot;_id_&quot;, xmlRd = ts.p.xmlReader, frd = ts.p.datatype == &quot;local&quot; ? &quot;local&quot; : &quot;xml&quot;; if(locdata) { ts.p.data = []; ts.p._index = {}; ts.p.localReader.id = xmlid; } ts.p.reccount = 0; if($.isXMLDoc(xml)) { if(ts.p.treeANode===-1 &amp;&amp; !ts.p.scroll) { emptyRows.call(ts, false, true); rcnt=1; } else { rcnt = rcnt &gt; 1 ? rcnt :1; } } else { return; } var self= $(ts), i,fpos,ir=0,v,gi=ts.p.multiselect===true?1:0,si=0,addSubGridCell,ni=ts.p.rownumbers===true?1:0,idn, getId,f=[],F,rd ={}, xmlr,rid, rowData=[], cn=(ts.p.altRows === true) ? &quot; &quot;+ts.p.altclass:&quot;&quot;,cn1; if(ts.p.subGrid===true) { si = 1; addSubGridCell = $.jgrid.getMethod(&quot;addSubGridCell&quot;); } if(!xmlRd.repeatitems) {f = reader(frd);} if( ts.p.keyIndex===false) { idn = $.isFunction( xmlRd.id ) ? xmlRd.id.call(ts, xml) : xmlRd.id; } else { idn = ts.p.keyIndex; } if(f.length&gt;0 &amp;&amp; !isNaN(idn)) { if (ts.p.remapColumns &amp;&amp; ts.p.remapColumns.length) { idn = $.inArray(idn, ts.p.remapColumns); } idn=f[idn]; } if( String(idn).indexOf(&quot;[&quot;) === -1 ) { if (f.length) { getId = function( trow, k) {return $(idn,trow).text() || k;}; } else { getId = function( trow, k) {return $(xmlRd.cell,trow).eq(idn).text() || k;}; } } else { getId = function( trow, k) {return trow.getAttribute(idn.replace(/[\\[\\]]/g,&quot;&quot;)) || k;}; } ts.p.userData = {}; ts.p.page = $.jgrid.getXmlData( xml,xmlRd.page ) || ts.p.page || 0; ts.p.lastpage = $.jgrid.getXmlData( xml,xmlRd.total ); if(ts.p.lastpage===undefined) { ts.p.lastpage=1; } ts.p.records = $.jgrid.getXmlData( xml,xmlRd.records ) || 0; if($.isFunction(xmlRd.userdata)) { ts.p.userData = xmlRd.userdata.call(ts, xml) || {}; } else { $.jgrid.getXmlData(xml, xmlRd.userdata, true).each(function() {ts.p.userData[this.getAttribute(&quot;name&quot;)]= $(this).text();}); } var gxml = $.jgrid.getXmlData( xml, xmlRd.root, true); gxml = $.jgrid.getXmlData( gxml, xmlRd.row, true); if (!gxml) { gxml = []; } var gl = gxml.length, j=0, grpdata=[], rn = parseInt(ts.p.rowNum,10), br=ts.p.scroll?$.jgrid.randId():1, altr; if (gl &gt; 0 &amp;&amp; ts.p.page &lt;= 0) { ts.p.page = 1; } if(gxml &amp;&amp; gl){ if (adjust) { rn *= adjust+1; } var afterInsRow = $.isFunction(ts.p.afterInsertRow), hiderow=false, groupingPrepare; if(ts.p.grouping) { hiderow = ts.p.groupingView.groupCollapse === true; groupingPrepare = $.jgrid.getMethod(&quot;groupingPrepare&quot;); } while (j&lt;gl) { xmlr = gxml[j]; rid = getId(xmlr,br+j); rid = ts.p.idPrefix + rid; altr = rcnt === 0 ? 0 : rcnt+1; cn1 = (altr+j)%2 == 1 ? cn : ''; var iStartTrTag = rowData.length; rowData.push(&quot;&quot;); if( ni ) { rowData.push( addRowNum(0,j,ts.p.page,ts.p.rowNum) ); } if( gi ) { rowData.push( addMulti(rid,ni,j, false) ); } if( si ) { rowData.push( addSubGridCell.call(self,gi+ni,j+rcnt) ); } if(xmlRd.repeatitems){ if (!F) { F=orderedCols(gi+si+ni); } var cells = $.jgrid.getXmlData( xmlr, xmlRd.cell, true); $.each(F, function (k) { var cell = cells[this]; if (!cell) { return false; } v = cell.textContent || cell.text; rd[ts.p.colModel[k+gi+si+ni].name] = v; rowData.push( addCell(rid,v,k+gi+si+ni,j+rcnt,xmlr, rd) ); }); } else { for(i = 0; i &lt; f.length;i++) { v = $.jgrid.getXmlData( xmlr, f[i]); rd[ts.p.colModel[i+gi+si+ni].name] = v; rowData.push( addCell(rid, v, i+gi+si+ni, j+rcnt, xmlr, rd) ); } } rowData[iStartTrTag] = constructTr(rid, hiderow, cn1, rd, xmlr, false); rowData.push(&quot;&lt;/tr&gt;&quot;); if(ts.p.grouping) { grpdata = groupingPrepare.call(self,rowData, grpdata, rd, j); rowData = []; } if(locdata || ts.p.treeGrid === true) { rd[xmlid] = rid; ts.p.data.push(rd); ts.p._index[rid] = ts.p.data.length-1; } if(ts.p.gridview === false ) { $(&quot;tbody:first&quot;,t).append(rowData.join('')); self.triggerHandler(&quot;jqGridAfterInsertRow&quot;, [rid, rd, xmlr]); if(afterInsRow) {ts.p.afterInsertRow.call(ts,rid,rd,xmlr);} rowData=[]; } rd={}; ir++; j++; if(ir==rn) {break;} } } if(ts.p.gridview === true) { fpos = ts.p.treeANode &gt; -1 ? ts.p.treeANode: 0; if(ts.p.grouping) { self.jqGrid('groupingRender',grpdata,ts.p.colModel.length); grpdata = null; } else if(ts.p.treeGrid === true &amp;&amp; fpos &gt; 0) { $(ts.rows[fpos]).after(rowData.join('')); } else { $(&quot;tbody:first&quot;,t).append(rowData.join('')); } } if(ts.p.subGrid === true ) { try {self.jqGrid(&quot;addSubGrid&quot;,gi+ni);} catch (_){} } ts.p.totaltime = new Date() - startReq; if(ir&gt;0) { if(ts.p.records===0) { ts.p.records=gl;} } rowData =null; if( ts.p.treeGrid === true) { try {self.jqGrid(&quot;setTreeNode&quot;, fpos+1, ir+fpos+1);} catch (e) {} } if(!ts.p.treeGrid &amp;&amp; !ts.p.scroll) {ts.grid.bDiv.scrollTop = 0;} ts.p.reccount=ir; ts.p.treeANode = -1; if(ts.p.userDataOnFooter) { self.jqGrid(&quot;footerData&quot;,&quot;set&quot;,ts.p.userData,true); } if(locdata) { ts.p.records = gl; ts.p.lastpage = Math.ceil(gl/ rn); } if (!more) { ts.updatepager(false,true); } if(locdata) { while (ir&lt;gl) { xmlr = gxml[ir]; rid = getId(xmlr,ir+br); rid = ts.p.idPrefix + rid; if(xmlRd.repeatitems){ if (!F) { F=orderedCols(gi+si+ni); } var cells2 = $.jgrid.getXmlData( xmlr, xmlRd.cell, true); $.each(F, function (k) { var cell = cells2[this]; if (!cell) { return false; } v = cell.textContent || cell.text; rd[ts.p.colModel[k+gi+si+ni].name] = v; }); } else { for(i = 0; i &lt; f.length;i++) { v = $.jgrid.getXmlData( xmlr, f[i]); rd[ts.p.colModel[i+gi+si+ni].name] = v; } } rd[xmlid] = rid; ts.p.data.push(rd); ts.p._index[rid] = ts.p.data.length-1; rd = {}; ir++; } } }, addJSONData = function(data,t, rcnt, more, adjust) { var startReq = new Date(); if(data) { if(ts.p.treeANode === -1 &amp;&amp; !ts.p.scroll) { emptyRows.call(ts, false, true); rcnt=1; } else { rcnt = rcnt &gt; 1 ? rcnt :1; } } else { return; } var dReader, locid = &quot;_id_&quot;, frd, locdata = (ts.p.datatype != &quot;local&quot; &amp;&amp; ts.p.loadonce) || ts.p.datatype == &quot;jsonstring&quot;; if(locdata) { ts.p.data = []; ts.p._index = {}; ts.p.localReader.id = locid;} ts.p.reccount = 0; if(ts.p.datatype == &quot;local&quot;) { dReader = ts.p.localReader; frd= 'local'; } else { dReader = ts.p.jsonReader; frd='json'; } var self = $(ts), ir=0,v,i,j,f=[],F,cur,gi=ts.p.multiselect?1:0,si=0,addSubGridCell,ni=ts.p.rownumbers===true?1:0,len,drows,idn,rd={}, fpos, idr,rowData=[],cn=(ts.p.altRows === true) ? &quot; &quot;+ts.p.altclass:&quot;&quot;,cn1,lp; ts.p.page = $.jgrid.getAccessor(data,dReader.page) || ts.p.page || 0; lp = $.jgrid.getAccessor(data,dReader.total); if(ts.p.subGrid===true) { si = 1; addSubGridCell = $.jgrid.getMethod(&quot;addSubGridCell&quot;); } ts.p.lastpage = lp === undefined ? 1 : lp; ts.p.records = $.jgrid.getAccessor(data,dReader.records) || 0; ts.p.userData = $.jgrid.getAccessor(data,dReader.userdata) || {}; if(!dReader.repeatitems) { F = f = reader(frd); } if( ts.p.keyIndex===false ) { idn = $.isFunction(dReader.id) ? dReader.id.call(ts, data) : dReader.id; } else { idn = ts.p.keyIndex; } if(f.length&gt;0 &amp;&amp; !isNaN(idn)) { if (ts.p.remapColumns &amp;&amp; ts.p.remapColumns.length) { idn = $.inArray(idn, ts.p.remapColumns); } idn=f[idn]; } drows = $.jgrid.getAccessor(data,dReader.root); if (!drows) { drows = []; } len = drows.length; i=0; if (len &gt; 0 &amp;&amp; ts.p.page &lt;= 0) { ts.p.page = 1; } var rn = parseInt(ts.p.rowNum,10),br=ts.p.scroll?$.jgrid.randId():1, altr, selected=false, selr; if (adjust) { rn *= adjust+1; } if(ts.p.datatype === &quot;local&quot; &amp;&amp; !ts.p.deselectAfterSort) { selected = true; } var afterInsRow = $.isFunction(ts.p.afterInsertRow), grpdata=[],hiderow=false, groupingPrepare; if(ts.p.grouping) { hiderow = ts.p.groupingView.groupCollapse === true; groupingPrepare = $.jgrid.getMethod(&quot;groupingPrepare&quot;); } while (i&lt;len) { cur = drows[i]; idr = $.jgrid.getAccessor(cur,idn); if(idr === undefined) { idr = br+i; if(f.length===0){ if(dReader.cell){ var ccur = $.jgrid.getAccessor(cur,dReader.cell); idr = ccur !== undefined ? ccur[idn] || idr : idr; ccur=null; } } } idr = ts.p.idPrefix + idr; altr = rcnt === 1 ? 0 : rcnt; cn1 = (altr+i)%2 == 1 ? cn : ''; if( selected) { if( ts.p.multiselect) { selr = ($.inArray(idr, ts.p.selarrrow) !== -1); } else { selr = (idr === ts.p.selrow); } } var iStartTrTag = rowData.length; rowData.push(&quot;&quot;); if( ni ) { rowData.push( addRowNum(0,i,ts.p.page,ts.p.rowNum) ); } if( gi ){ rowData.push( addMulti(idr,ni,i,selr) ); } if( si ) { rowData.push( addSubGridCell.call(self,gi+ni,i+rcnt) ); } if (dReader.repeatitems) { if(dReader.cell) {cur = $.jgrid.getAccessor(cur,dReader.cell);} if (!F) { F=orderedCols(gi+si+ni); } } for (j=0;j&lt;F.length;j++) { v = $.jgrid.getAccessor(cur,F[j]); rd[ts.p.colModel[j+gi+si+ni].name] = v; rowData.push( addCell(idr,v,j+gi+si+ni,i+rcnt,cur, rd) ); } rowData[iStartTrTag] = constructTr(idr, hiderow, cn1, rd, cur, selr); rowData.push( &quot;&lt;/tr&gt;&quot; ); if(ts.p.grouping) { grpdata = groupingPrepare.call(self,rowData, grpdata, rd, i); rowData = []; } if(locdata || ts.p.treeGrid===true) { rd[locid] = idr; ts.p.data.push(rd); ts.p._index[idr] = ts.p.data.length-1; } if(ts.p.gridview === false ) { $(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;).append(rowData.join('')); self.triggerHandler(&quot;jqGridAfterInsertRow&quot;, [idr, rd, cur]); if(afterInsRow) {ts.p.afterInsertRow.call(ts,idr,rd,cur);} rowData=[];//ari=0; } rd={}; ir++; i++; if(ir==rn) { break; } } if(ts.p.gridview === true ) { fpos = ts.p.treeANode &gt; -1 ? ts.p.treeANode: 0; if(ts.p.grouping) { self.jqGrid('groupingRender',grpdata,ts.p.colModel.length); grpdata = null; } else if(ts.p.treeGrid === true &amp;&amp; fpos &gt; 0) { $(ts.rows[fpos]).after(rowData.join('')); } else { $(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;).append(rowData.join('')); } } if(ts.p.subGrid === true ) { try { self.jqGrid(&quot;addSubGrid&quot;,gi+ni);} catch (_){} } ts.p.totaltime = new Date() - startReq; if(ir&gt;0) { if(ts.p.records===0) { ts.p.records=len; } } rowData = null; if( ts.p.treeGrid === true) { try {self.jqGrid(&quot;setTreeNode&quot;, fpos+1, ir+fpos+1);} catch (e) {} } if(!ts.p.treeGrid &amp;&amp; !ts.p.scroll) {ts.grid.bDiv.scrollTop = 0;} ts.p.reccount=ir; ts.p.treeANode = -1; if(ts.p.userDataOnFooter) { self.jqGrid(&quot;footerData&quot;,&quot;set&quot;,ts.p.userData,true); } if(locdata) { ts.p.records = len; ts.p.lastpage = Math.ceil(len/ rn); } if (!more) { ts.updatepager(false,true); } if(locdata) { while (ir&lt;len &amp;&amp; drows[ir]) { cur = drows[ir]; idr = $.jgrid.getAccessor(cur,idn); if(idr === undefined) { idr = br+ir; if(f.length===0){ if(dReader.cell){ var ccur2 = $.jgrid.getAccessor(cur,dReader.cell); idr = ccur2[idn] || idr; ccur2=null; } } } if(cur) { idr = ts.p.idPrefix + idr; if (dReader.repeatitems) { if(dReader.cell) {cur = $.jgrid.getAccessor(cur,dReader.cell);} if (!F) { F=orderedCols(gi+si+ni); } } for (j=0;j&lt;F.length;j++) { v = $.jgrid.getAccessor(cur,F[j]); rd[ts.p.colModel[j+gi+si+ni].name] = v; } rd[locid] = idr; ts.p.data.push(rd); ts.p._index[idr] = ts.p.data.length-1; rd = {}; } ir++; } } }, addLocalData = function() { var st, fndsort=false, cmtypes={}, grtypes=[], grindexes=[], srcformat, sorttype, newformat; if(!$.isArray(ts.p.data)) { return; } var grpview = ts.p.grouping ? ts.p.groupingView : false, lengrp, gin; $.each(ts.p.colModel,function(){ sorttype = this.sorttype || &quot;text&quot;; if(sorttype == &quot;date&quot; || sorttype == &quot;datetime&quot;) { if(this.formatter &amp;&amp; typeof this.formatter === 'string' &amp;&amp; this.formatter == 'date') { if(this.formatoptions &amp;&amp; this.formatoptions.srcformat) { srcformat = this.formatoptions.srcformat; } else { srcformat = $.jgrid.formatter.date.srcformat; } if(this.formatoptions &amp;&amp; this.formatoptions.newformat) { newformat = this.formatoptions.newformat; } else { newformat = $.jgrid.formatter.date.newformat; } } else { srcformat = newformat = this.datefmt || &quot;Y-m-d&quot;; } cmtypes[this.name] = {&quot;stype&quot;: sorttype, &quot;srcfmt&quot;: srcformat,&quot;newfmt&quot;:newformat}; } else { cmtypes[this.name] = {&quot;stype&quot;: sorttype, &quot;srcfmt&quot;:'',&quot;newfmt&quot;:''}; } if(ts.p.grouping ) { for(gin =0, lengrp = grpview.groupField.length; gin&lt; lengrp; gin++) { if( this.name == grpview.groupField[gin]) { var grindex = this.name; if (this.index) { grindex = this.index; } grtypes[gin] = cmtypes[grindex]; grindexes[gin]= grindex; } } } if(!fndsort &amp;&amp; (this.index == ts.p.sortname || this.name == ts.p.sortname)){ st = this.name; // ??? fndsort = true; } }); if(ts.p.treeGrid) { $(ts).jqGrid(&quot;SortTree&quot;, st, ts.p.sortorder, cmtypes[st].stype, cmtypes[st].srcfmt); return; } var compareFnMap = { 'eq':function(queryObj) {return queryObj.equals;}, 'ne':function(queryObj) {return queryObj.notEquals;}, 'lt':function(queryObj) {return queryObj.less;}, 'le':function(queryObj) {return queryObj.lessOrEquals;}, 'gt':function(queryObj) {return queryObj.greater;}, 'ge':function(queryObj) {return queryObj.greaterOrEquals;}, 'cn':function(queryObj) {return queryObj.contains;}, 'nc':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().contains : queryObj.andNot().contains;}, 'bw':function(queryObj) {return queryObj.startsWith;}, 'bn':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().startsWith : queryObj.andNot().startsWith;}, 'en':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().endsWith : queryObj.andNot().endsWith;}, 'ew':function(queryObj) {return queryObj.endsWith;}, 'ni':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().equals : queryObj.andNot().equals;}, 'in':function(queryObj) {return queryObj.equals;}, 'nu':function(queryObj) {return queryObj.isNull;}, 'nn':function(queryObj,op) {return op === &quot;OR&quot; ? queryObj.orNot().isNull : queryObj.andNot().isNull;} }, query = $.jgrid.from(ts.p.data); if (ts.p.ignoreCase) { query = query.ignoreCase(); } function tojLinq ( group ) { var s = 0, index, gor, ror, opr, rule; if (group.groups != null) { gor = group.groups.length &amp;&amp; group.groupOp.toString().toUpperCase() === &quot;OR&quot;; if (gor) { query.orBegin(); } for (index = 0; index &lt; group.groups.length; index++) { if (s &gt; 0 &amp;&amp; gor) { query.or(); } try { tojLinq(group.groups[index]); } catch (e) {alert(e);} s++; } if (gor) { query.orEnd(); } } if (group.rules != null) { //if(s&gt;0) { // var result = query.select(); // query = $.jgrid.from( result); // if (ts.p.ignoreCase) { query = query.ignoreCase(); } //} try{ ror = group.rules.length &amp;&amp; group.groupOp.toString().toUpperCase() === &quot;OR&quot;; if (ror) { query.orBegin(); } for (index = 0; index &lt; group.rules.length; index++) { rule = group.rules[index]; opr = group.groupOp.toString().toUpperCase(); if (compareFnMap[rule.op] &amp;&amp; rule.field ) { if(s &gt; 0 &amp;&amp; opr &amp;&amp; opr === &quot;OR&quot;) { query = query.or(); } query = compareFnMap[rule.op](query, opr)(rule.field, rule.data, cmtypes[rule.field]); } s++; } if (ror) { query.orEnd(); } } catch (g) {alert(g);} } } if (ts.p.search === true) { var srules = ts.p.postData.filters; if(srules) { if(typeof srules === &quot;string&quot;) { srules = $.jgrid.parse(srules);} tojLinq( srules ); } else { try { query = compareFnMap[ts.p.postData.searchOper](query)(ts.p.postData.searchField, ts.p.postData.searchString,cmtypes[ts.p.postData.searchField]); } catch (se){} } } if(ts.p.grouping) { for(gin=0; gin&lt;lengrp;gin++) { query.orderBy(grindexes[gin],grpview.groupOrder[gin],grtypes[gin].stype, grtypes[gin].srcfmt); } } if (st &amp;&amp; ts.p.sortorder &amp;&amp; fndsort) { if(ts.p.sortorder.toUpperCase() == &quot;DESC&quot;) { query.orderBy(ts.p.sortname, &quot;d&quot;, cmtypes[st].stype, cmtypes[st].srcfmt); } else { query.orderBy(ts.p.sortname, &quot;a&quot;, cmtypes[st].stype, cmtypes[st].srcfmt); } } var queryResults = query.select(), recordsperpage = parseInt(ts.p.rowNum,10), total = queryResults.length, page = parseInt(ts.p.page,10), totalpages = Math.ceil(total / recordsperpage), retresult = {}; queryResults = queryResults.slice( (page-1)*recordsperpage , page*recordsperpage ); query = null; cmtypes = null; retresult[ts.p.localReader.total] = totalpages; retresult[ts.p.localReader.page] = page; retresult[ts.p.localReader.records] = total; retresult[ts.p.localReader.root] = queryResults; retresult[ts.p.localReader.userdata] = ts.p.userData; queryResults = null; return retresult; }, updatepager = function(rn, dnd) { var cp, last, base, from,to,tot,fmt, pgboxes = &quot;&quot;, sppg, tspg = ts.p.pager ? &quot;_&quot;+$.jgrid.jqID(ts.p.pager.substr(1)) : &quot;&quot;, tspg_t = ts.p.toppager ? &quot;_&quot;+ts.p.toppager.substr(1) : &quot;&quot;; base = parseInt(ts.p.page,10)-1; if(base &lt; 0) { base = 0; } base = base*parseInt(ts.p.rowNum,10); to = base + ts.p.reccount; if (ts.p.scroll) { var rows = $(&quot;tbody:first &gt; tr:gt(0)&quot;, ts.grid.bDiv); base = to - rows.length; ts.p.reccount = rows.length; var rh = rows.outerHeight() || ts.grid.prevRowHeight; if (rh) { var top = base * rh; var height = parseInt(ts.p.records,10) * rh; $(&quot;&gt;div:first&quot;,ts.grid.bDiv).css({height : height}).children(&quot;div:first&quot;).css({height:top,display:top?&quot;&quot;:&quot;none&quot;}); } ts.grid.bDiv.scrollLeft = ts.grid.hDiv.scrollLeft; } pgboxes = ts.p.pager || &quot;&quot;; pgboxes += ts.p.toppager ? (pgboxes ? &quot;,&quot; + ts.p.toppager : ts.p.toppager) : &quot;&quot;; if(pgboxes) { fmt = $.jgrid.formatter.integer || {}; cp = intNum(ts.p.page); last = intNum(ts.p.lastpage); $(&quot;.selbox&quot;,pgboxes)[ this.p.useProp ? 'prop' : 'attr' ](&quot;disabled&quot;,false); if(ts.p.pginput===true) { $('.ui-pg-input',pgboxes).val(ts.p.page); sppg = ts.p.toppager ? '#sp_1'+tspg+&quot;,#sp_1&quot;+tspg_t : '#sp_1'+tspg; $(sppg).html($.fmatter ? $.fmatter.util.NumberFormat(ts.p.lastpage,fmt):ts.p.lastpage); } if (ts.p.viewrecords){ if(ts.p.reccount === 0) { $(&quot;.ui-paging-info&quot;,pgboxes).html(ts.p.emptyrecords); } else { from = base+1; tot=ts.p.records; if($.fmatter) { from = $.fmatter.util.NumberFormat(from,fmt); to = $.fmatter.util.NumberFormat(to,fmt); tot = $.fmatter.util.NumberFormat(tot,fmt); } $(&quot;.ui-paging-info&quot;,pgboxes).html($.jgrid.format(ts.p.recordtext,from,to,tot)); } } if(ts.p.pgbuttons===true) { if(cp&lt;=0) {cp = last = 0;} if(cp==1 || cp === 0) { $(&quot;#first&quot;+tspg+&quot;, #prev&quot;+tspg).addClass('ui-state-disabled').removeClass('ui-state-hover'); if(ts.p.toppager) { $(&quot;#first_t&quot;+tspg_t+&quot;, #prev_t&quot;+tspg_t).addClass('ui-state-disabled').removeClass('ui-state-hover'); } } else { $(&quot;#first&quot;+tspg+&quot;, #prev&quot;+tspg).removeClass('ui-state-disabled'); if(ts.p.toppager) { $(&quot;#first_t&quot;+tspg_t+&quot;, #prev_t&quot;+tspg_t).removeClass('ui-state-disabled'); } } if(cp==last || cp === 0) { $(&quot;#next&quot;+tspg+&quot;, #last&quot;+tspg).addClass('ui-state-disabled').removeClass('ui-state-hover'); if(ts.p.toppager) { $(&quot;#next_t&quot;+tspg_t+&quot;, #last_t&quot;+tspg_t).addClass('ui-state-disabled').removeClass('ui-state-hover'); } } else { $(&quot;#next&quot;+tspg+&quot;, #last&quot;+tspg).removeClass('ui-state-disabled'); if(ts.p.toppager) { $(&quot;#next_t&quot;+tspg_t+&quot;, #last_t&quot;+tspg_t).removeClass('ui-state-disabled'); } } } } if(rn===true &amp;&amp; ts.p.rownumbers === true) { $(&quot;td.jqgrid-rownum&quot;,ts.rows).each(function(i){ $(this).html(base+1+i); }); } if(dnd &amp;&amp; ts.p.jqgdnd) { $(ts).jqGrid('gridDnD','updateDnD');} $(ts).triggerHandler(&quot;jqGridGridComplete&quot;); if($.isFunction(ts.p.gridComplete)) {ts.p.gridComplete.call(ts);} $(ts).triggerHandler(&quot;jqGridAfterGridComplete&quot;); }, beginReq = function() { ts.grid.hDiv.loading = true; if(ts.p.hiddengrid) { return;} switch(ts.p.loadui) { case &quot;disable&quot;: break; case &quot;enable&quot;: $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show(); break; case &quot;block&quot;: $(&quot;#lui_&quot;+$.jgrid.jqID(ts.p.id)).show(); $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show(); break; } }, endReq = function() { ts.grid.hDiv.loading = false; switch(ts.p.loadui) { case &quot;disable&quot;: break; case &quot;enable&quot;: $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); break; case &quot;block&quot;: $(&quot;#lui_&quot;+$.jgrid.jqID(ts.p.id)).hide(); $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); break; } }, populate = function (npage) { if(!ts.grid.hDiv.loading) { var pvis = ts.p.scroll &amp;&amp; npage === false, prm = {}, dt, dstr, pN=ts.p.prmNames; if(ts.p.page &lt;=0) { ts.p.page = 1; } if(pN.search !== null) {prm[pN.search] = ts.p.search;} if(pN.nd !== null) {prm[pN.nd] = new Date().getTime();} if(pN.rows !== null) {prm[pN.rows]= ts.p.rowNum;} if(pN.page !== null) {prm[pN.page]= ts.p.page;} if(pN.sort !== null) {prm[pN.sort]= ts.p.sortname;} if(pN.order !== null) {prm[pN.order]= ts.p.sortorder;} if(ts.p.rowTotal !== null &amp;&amp; pN.totalrows !== null) { prm[pN.totalrows]= ts.p.rowTotal; } var lcf = $.isFunction(ts.p.loadComplete), lc = lcf ? ts.p.loadComplete : null; var adjust = 0; npage = npage || 1; if (npage &gt; 1) { if(pN.npage !== null) { prm[pN.npage] = npage; adjust = npage - 1; npage = 1; } else { lc = function(req) { ts.p.page++; ts.grid.hDiv.loading = false; if (lcf) { ts.p.loadComplete.call(ts,req); } populate(npage-1); }; } } else if (pN.npage !== null) { delete ts.p.postData[pN.npage]; } if(ts.p.grouping) { $(ts).jqGrid('groupingSetup'); var grp = ts.p.groupingView, gi, gs=&quot;&quot;; for(gi=0;gi&lt;grp.groupField.length;gi++) { var index = grp.groupField[gi]; $.each(ts.p.colModel, function(cmIndex, cmValue) { if (cmValue.name == index &amp;&amp; cmValue.index){ index = cmValue.index; } } ); gs += index +&quot; &quot;+grp.groupOrder[gi]+&quot;, &quot;; } prm[pN.sort] = gs + prm[pN.sort]; } $.extend(ts.p.postData,prm); var rcnt = !ts.p.scroll ? 1 : ts.rows.length-1; var bfr = $(ts).triggerHandler(&quot;jqGridBeforeRequest&quot;); if (bfr === false || bfr === 'stop') { return; } if ($.isFunction(ts.p.datatype)) { ts.p.datatype.call(ts,ts.p.postData,&quot;load_&quot;+ts.p.id); return;} if ($.isFunction(ts.p.beforeRequest)) { bfr = ts.p.beforeRequest.call(ts); if(bfr === undefined) { bfr = true; } if ( bfr === false ) { return; } } dt = ts.p.datatype.toLowerCase(); switch(dt) { case &quot;json&quot;: case &quot;jsonp&quot;: case &quot;xml&quot;: case &quot;script&quot;: $.ajax($.extend({ url:ts.p.url, type:ts.p.mtype, dataType: dt , data: $.isFunction(ts.p.serializeGridData)? ts.p.serializeGridData.call(ts,ts.p.postData) : ts.p.postData, success:function(data,st, xhr) { if ($.isFunction(ts.p.beforeProcessing)) { if (ts.p.beforeProcessing.call(ts, data, st, xhr) === false) { endReq(); return; } } if(dt === &quot;xml&quot;) { addXmlData(data,ts.grid.bDiv,rcnt,npage&gt;1,adjust); } else { addJSONData(data,ts.grid.bDiv,rcnt,npage&gt;1,adjust); } $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [data]); if(lc) { lc.call(ts,data); } $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [data]); if (pvis) { ts.grid.populateVisible(); } if( ts.p.loadonce || ts.p.treeGrid) {ts.p.datatype = &quot;local&quot;;} data=null; if (npage === 1) { endReq(); } }, error:function(xhr,st,err){ if($.isFunction(ts.p.loadError)) { ts.p.loadError.call(ts,xhr,st,err); } if (npage === 1) { endReq(); } xhr=null; }, beforeSend: function(xhr, settings ){ var gotoreq = true; if($.isFunction(ts.p.loadBeforeSend)) { gotoreq = ts.p.loadBeforeSend.call(ts,xhr, settings); } if(gotoreq === undefined) { gotoreq = true; } if(gotoreq === false) { return false; } beginReq(); } },$.jgrid.ajaxOptions, ts.p.ajaxGridOptions)); break; case &quot;xmlstring&quot;: beginReq(); dstr = $.jgrid.stringToDoc(ts.p.datastr); addXmlData(dstr,ts.grid.bDiv); $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [dstr]); if(lcf) {ts.p.loadComplete.call(ts,dstr);} $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [dstr]); ts.p.datatype = &quot;local&quot;; ts.p.datastr = null; endReq(); break; case &quot;jsonstring&quot;: beginReq(); if(typeof ts.p.datastr === 'string') { dstr = $.jgrid.parse(ts.p.datastr); } else { dstr = ts.p.datastr; } addJSONData(dstr,ts.grid.bDiv); $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [dstr]); if(lcf) {ts.p.loadComplete.call(ts,dstr);} $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [dstr]); ts.p.datatype = &quot;local&quot;; ts.p.datastr = null; endReq(); break; case &quot;local&quot;: case &quot;clientside&quot;: beginReq(); ts.p.datatype = &quot;local&quot;; var req = addLocalData(); addJSONData(req,ts.grid.bDiv,rcnt,npage&gt;1,adjust); $(ts).triggerHandler(&quot;jqGridLoadComplete&quot;, [req]); if(lc) { lc.call(ts,req); } $(ts).triggerHandler(&quot;jqGridAfterLoadComplete&quot;, [req]); if (pvis) { ts.grid.populateVisible(); } endReq(); break; } } }, setHeadCheckBox = function ( checked ) { $('#cb_'+$.jgrid.jqID(ts.p.id),ts.grid.hDiv)[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, checked); var fid = ts.p.frozenColumns ? ts.p.id+&quot;_frozen&quot; : &quot;&quot;; if(fid) { $('#cb_'+$.jgrid.jqID(ts.p.id),ts.grid.fhDiv)[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, checked); } }, setPager = function (pgid, tp){ // TBD - consider escaping pgid with pgid = $.jgrid.jqID(pgid); var sep = &quot;&lt;td class='ui-pg-button ui-state-disabled' style='width:4px;'&gt;&lt;span class='ui-separator'&gt;&lt;/span&gt;&lt;/td&gt;&quot;, pginp = &quot;&quot;, pgl=&quot;&lt;table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'&gt;&lt;tbody&gt;&lt;tr&gt;&quot;, str=&quot;&quot;, pgcnt, lft, cent, rgt, twd, tdw, i, clearVals = function(onpaging){ var ret; if ($.isFunction(ts.p.onPaging) ) { ret = ts.p.onPaging.call(ts,onpaging); } ts.p.selrow = null; if(ts.p.multiselect) {ts.p.selarrrow =[]; setHeadCheckBox( false );} ts.p.savedRow = []; if(ret=='stop') {return false;} return true; }; pgid = pgid.substr(1); tp += &quot;_&quot; + pgid; pgcnt = &quot;pg_&quot;+pgid; lft = pgid+&quot;_left&quot;; cent = pgid+&quot;_center&quot;; rgt = pgid+&quot;_right&quot;; $(&quot;#&quot;+$.jgrid.jqID(pgid) ) .append(&quot;&lt;div id='&quot;+pgcnt+&quot;' class='ui-pager-control' role='group'&gt;&lt;table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;height:100%;' role='row'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td id='&quot;+lft+&quot;' align='left'&gt;&lt;/td&gt;&lt;td id='&quot;+cent+&quot;' align='center' style='white-space:pre;'&gt;&lt;/td&gt;&lt;td id='&quot;+rgt+&quot;' align='right'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;) .attr(&quot;dir&quot;,&quot;ltr&quot;); //explicit setting if(ts.p.rowList.length &gt;0){ str = &quot;&lt;td dir='&quot;+dir+&quot;'&gt;&quot;; str +=&quot;&lt;select class='ui-pg-selbox' role='listbox'&gt;&quot;; for(i=0;i&lt;ts.p.rowList.length;i++){ str +=&quot;&lt;option role=\\&quot;option\\&quot; value=\\&quot;&quot;+ts.p.rowList[i]+&quot;\\&quot;&quot;+((ts.p.rowNum == ts.p.rowList[i])?&quot; selected=\\&quot;selected\\&quot;&quot;:&quot;&quot;)+&quot;&gt;&quot;+ts.p.rowList[i]+&quot;&lt;/option&gt;&quot;; } str +=&quot;&lt;/select&gt;&lt;/td&gt;&quot;; } if(dir==&quot;rtl&quot;) { pgl += str; } if(ts.p.pginput===true) { pginp= &quot;&lt;td dir='&quot;+dir+&quot;'&gt;&quot;+$.jgrid.format(ts.p.pgtext || &quot;&quot;,&quot;&lt;input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/&gt;&quot;,&quot;&lt;span id='sp_1_&quot;+$.jgrid.jqID(pgid)+&quot;'&gt;&lt;/span&gt;&quot;)+&quot;&lt;/td&gt;&quot;;} if(ts.p.pgbuttons===true) { var po=[&quot;first&quot;+tp,&quot;prev&quot;+tp, &quot;next&quot;+tp,&quot;last&quot;+tp]; if(dir==&quot;rtl&quot;) { po.reverse(); } pgl += &quot;&lt;td id='&quot;+po[0]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-first'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; pgl += &quot;&lt;td id='&quot;+po[1]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-prev'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; pgl += pginp !== &quot;&quot; ? sep+pginp+sep:&quot;&quot;; pgl += &quot;&lt;td id='&quot;+po[2]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-next'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; pgl += &quot;&lt;td id='&quot;+po[3]+&quot;' class='ui-pg-button ui-corner-all'&gt;&lt;span class='ui-icon ui-icon-seek-end'&gt;&lt;/span&gt;&lt;/td&gt;&quot;; } else if (pginp !== &quot;&quot;) { pgl += pginp; } if(dir==&quot;ltr&quot;) { pgl += str; } pgl += &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; if(ts.p.viewrecords===true) {$(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.recordpos,&quot;#&quot;+pgcnt).append(&quot;&lt;div dir='&quot;+dir+&quot;' style='text-align:&quot;+ts.p.recordpos+&quot;' class='ui-paging-info'&gt;&lt;/div&gt;&quot;);} $(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.pagerpos,&quot;#&quot;+pgcnt).append(pgl); tdw = $(&quot;.ui-jqgrid&quot;).css(&quot;font-size&quot;) || &quot;11px&quot;; $(document.body).append(&quot;&lt;div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:&quot;+tdw+&quot;;visibility:hidden;' &gt;&lt;/div&gt;&quot;); twd = $(pgl).clone().appendTo(&quot;#testpg&quot;).width(); $(&quot;#testpg&quot;).remove(); if(twd &gt; 0) { if(pginp !== &quot;&quot;) { twd += 50; } //should be param $(&quot;td#&quot;+pgid+&quot;_&quot;+ts.p.pagerpos,&quot;#&quot;+pgcnt).width(twd); } ts.p._nvtd = []; ts.p._nvtd[0] = twd ? Math.floor((ts.p.width - twd)/2) : Math.floor(ts.p.width/3); ts.p._nvtd[1] = 0; pgl=null; $('.ui-pg-selbox',&quot;#&quot;+pgcnt).bind('change',function() { if(!clearVals('records')) { return false; } ts.p.page = Math.round(ts.p.rowNum*(ts.p.page-1)/this.value-0.5)+1; ts.p.rowNum = this.value; if(ts.p.pager) { $('.ui-pg-selbox',ts.p.pager).val(this.value); } if(ts.p.toppager) { $('.ui-pg-selbox',ts.p.toppager).val(this.value); } populate(); return false; }); if(ts.p.pgbuttons===true) { $(&quot;.ui-pg-button&quot;,&quot;#&quot;+pgcnt).hover(function(){ if($(this).hasClass('ui-state-disabled')) { this.style.cursor='default'; } else { $(this).addClass('ui-state-hover'); this.style.cursor='pointer'; } },function() { if(!$(this).hasClass('ui-state-disabled')) { $(this).removeClass('ui-state-hover'); this.style.cursor= &quot;default&quot;; } }); $(&quot;#first&quot;+$.jgrid.jqID(tp)+&quot;, #prev&quot;+$.jgrid.jqID(tp)+&quot;, #next&quot;+$.jgrid.jqID(tp)+&quot;, #last&quot;+$.jgrid.jqID(tp)).click( function() { var cp = intNum(ts.p.page,1), last = intNum(ts.p.lastpage,1), selclick = false, fp=true, pp=true, np=true,lp=true; if(last ===0 || last===1) {fp=false;pp=false;np=false;lp=false; } else if( last&gt;1 &amp;&amp; cp &gt;=1) { if( cp === 1) { fp=false; pp=false; } //else if( cp&gt;1 &amp;&amp; cp &lt;last){ } else if( cp===last){ np=false;lp=false; } } else if( last&gt;1 &amp;&amp; cp===0 ) { np=false;lp=false; cp=last-1;} if(!clearVals(this.id)) { return false; } if( this.id === 'first'+tp &amp;&amp; fp ) { ts.p.page=1; selclick=true;} if( this.id === 'prev'+tp &amp;&amp; pp) { ts.p.page=(cp-1); selclick=true;} if( this.id === 'next'+tp &amp;&amp; np) { ts.p.page=(cp+1); selclick=true;} if( this.id === 'last'+tp &amp;&amp; lp) { ts.p.page=last; selclick=true;} if(selclick) { populate(); } return false; }); } if(ts.p.pginput===true) { $('input.ui-pg-input',&quot;#&quot;+pgcnt).keypress( function(e) { var key = e.charCode || e.keyCode || 0; if(key == 13) { if(!clearVals('user')) { return false; } ts.p.page = ($(this).val()&gt;0) ? $(this).val():ts.p.page; populate(); return false; } return this; }); } }, sortData = function (index, idxcol,reload,sor){ if(!ts.p.colModel[idxcol].sortable) { return; } var so; if(ts.p.savedRow.length &gt; 0) {return;} if(!reload) { if( ts.p.lastsort == idxcol ) { if( ts.p.sortorder == 'asc') { ts.p.sortorder = 'desc'; } else if(ts.p.sortorder == 'desc') { ts.p.sortorder = 'asc';} } else { ts.p.sortorder = ts.p.colModel[idxcol].firstsortorder || 'asc'; } ts.p.page = 1; } if(sor) { if(ts.p.lastsort == idxcol &amp;&amp; ts.p.sortorder == sor &amp;&amp; !reload) { return; } ts.p.sortorder = sor; } var previousSelectedTh = ts.grid.headers[ts.p.lastsort].el, newSelectedTh = ts.grid.headers[idxcol].el; $(&quot;span.ui-grid-ico-sort&quot;,previousSelectedTh).addClass('ui-state-disabled'); $(previousSelectedTh).attr(&quot;aria-selected&quot;,&quot;false&quot;); $(&quot;span.ui-icon-&quot;+ts.p.sortorder,newSelectedTh).removeClass('ui-state-disabled'); $(newSelectedTh).attr(&quot;aria-selected&quot;,&quot;true&quot;); if(!ts.p.viewsortcols[0]) { if(ts.p.lastsort != idxcol) { $(&quot;span.s-ico&quot;,previousSelectedTh).hide(); $(&quot;span.s-ico&quot;,newSelectedTh).show(); } } index = index.substring(5 + ts.p.id.length + 1); // bad to be changed!?! ts.p.sortname = ts.p.colModel[idxcol].index || index; so = ts.p.sortorder; if ($(ts).triggerHandler(&quot;jqGridSortCol&quot;, [index, idxcol, so]) === 'stop') { ts.p.lastsort = idxcol; return; } if($.isFunction(ts.p.onSortCol)) {if (ts.p.onSortCol.call(ts,index,idxcol,so)=='stop') {ts.p.lastsort = idxcol; return;}} if(ts.p.datatype == &quot;local&quot;) { if(ts.p.deselectAfterSort) {$(ts).jqGrid(&quot;resetSelection&quot;);} } else { ts.p.selrow = null; if(ts.p.multiselect){setHeadCheckBox( false );} ts.p.selarrrow =[]; ts.p.savedRow =[]; } if(ts.p.scroll) { var sscroll = ts.grid.bDiv.scrollLeft; emptyRows.call(ts, true, false); ts.grid.hDiv.scrollLeft = sscroll; } if(ts.p.subGrid &amp;&amp; ts.p.datatype=='local') { $(&quot;td.sgexpanded&quot;,&quot;#&quot;+$.jgrid.jqID(ts.p.id)).each(function(){ $(this).trigger(&quot;click&quot;); }); } populate(); ts.p.lastsort = idxcol; if(ts.p.sortname != index &amp;&amp; idxcol) {ts.p.lastsort = idxcol;} }, setColWidth = function () { var initwidth = 0, brd=$.jgrid.cell_width? 0: intNum(ts.p.cellLayout,0), vc=0, lvc, scw=intNum(ts.p.scrollOffset,0),cw,hs=false,aw,gw=0, cl = 0, cr; $.each(ts.p.colModel, function() { if(this.hidden === undefined) {this.hidden=false;} if(ts.p.grouping &amp;&amp; ts.p.autowidth) { var ind = $.inArray(this.name, ts.p.groupingView.groupField); if(ind !== -1) { this.hidden = !ts.p.groupingView.groupColumnShow[ind]; } } this.widthOrg = cw = intNum(this.width,0); if(this.hidden===false){ initwidth += cw+brd; if(this.fixed) { gw += cw+brd; } else { vc++; } cl++; } }); if(isNaN(ts.p.width)) { ts.p.width = initwidth + ((ts.p.shrinkToFit ===false &amp;&amp; !isNaN(ts.p.height)) ? scw : 0); } grid.width = ts.p.width; ts.p.tblwidth = initwidth; if(ts.p.shrinkToFit ===false &amp;&amp; ts.p.forceFit === true) {ts.p.forceFit=false;} if(ts.p.shrinkToFit===true &amp;&amp; vc &gt; 0) { aw = grid.width-brd*vc-gw; if(!isNaN(ts.p.height)) { aw -= scw; hs = true; } initwidth =0; $.each(ts.p.colModel, function(i) { if(this.hidden === false &amp;&amp; !this.fixed){ cw = Math.round(aw*this.width/(ts.p.tblwidth-brd*vc-gw)); this.width =cw; initwidth += cw; lvc = i; } }); cr =0; if (hs) { if(grid.width-gw-(initwidth+brd*vc) !== scw){ cr = grid.width-gw-(initwidth+brd*vc)-scw; } } else if(!hs &amp;&amp; Math.abs(grid.width-gw-(initwidth+brd*vc)) !== 1) { cr = grid.width-gw-(initwidth+brd*vc); } ts.p.colModel[lvc].width += cr; ts.p.tblwidth = initwidth+cr+brd*vc+gw; if(ts.p.tblwidth &gt; ts.p.width) { ts.p.colModel[lvc].width -= (ts.p.tblwidth - parseInt(ts.p.width,10)); ts.p.tblwidth = ts.p.width; } } }, nextVisible= function(iCol) { var ret = iCol, j=iCol, i; for (i = iCol+1;i&lt;ts.p.colModel.length;i++){ if(ts.p.colModel[i].hidden !== true ) { j=i; break; } } return j-ret; }, getOffset = function (iCol) { var i, ret = [0], brd1 = $.jgrid.cell_width ? 0 : ts.p.cellLayout; for(i=0;i&lt;=iCol;i++){ if(ts.p.colModel[i].hidden === false ) { ret[0] += ts.p.colModel[i].width+brd1; } } if(ts.p.direction==&quot;rtl&quot;) { ret[0] = ts.p.width - ret[0]; } ret[0] -= ts.grid.bDiv.scrollLeft; ret.push($(ts.grid.hDiv).position().top); ret.push($(ts.grid.bDiv).offset().top - $(ts.grid.hDiv).offset().top + $(ts.grid.bDiv).height()); return ret; }, getColumnHeaderIndex = function (th) { var i, headers = ts.grid.headers, ci = $.jgrid.getCellIndex(th); for (i = 0; i &lt; headers.length; i++) { if (th === headers[i].el) { ci = i; break; } } return ci; }; this.p.id = this.id; if ($.inArray(ts.p.multikey,sortkeys) == -1 ) {ts.p.multikey = false;} ts.p.keyIndex=false; for (i=0; i&lt;ts.p.colModel.length;i++) { ts.p.colModel[i] = $.extend(true, {}, ts.p.cmTemplate, ts.p.colModel[i].template || {}, ts.p.colModel[i]); if (ts.p.keyIndex === false &amp;&amp; ts.p.colModel[i].key===true) { ts.p.keyIndex = i; } } ts.p.sortorder = ts.p.sortorder.toLowerCase(); $.jgrid.cell_width = $.jgrid.cellWidth(); if(ts.p.grouping===true) { ts.p.scroll = false; ts.p.rownumbers = false; //ts.p.subGrid = false; expiremental // ts.p.treeGrid = false; ts.p.gridview = true; } if(this.p.treeGrid === true) { try { $(this).jqGrid(&quot;setTreeGrid&quot;);} catch (_) {} if(ts.p.datatype != &quot;local&quot;) { ts.p.localReader = {id: &quot;_id_&quot;}; } } if(this.p.subGrid) { try { $(ts).jqGrid(&quot;setSubGrid&quot;);} catch (s){} } if(this.p.multiselect) { this.p.colNames.unshift(&quot;&lt;input role='checkbox' id='cb_&quot;+this.p.id+&quot;' class='cbox' type='checkbox'/&gt;&quot;); this.p.colModel.unshift({name:'cb',width:$.jgrid.cell_width ? ts.p.multiselectWidth+ts.p.cellLayout : ts.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:'center',fixed:true}); } if(this.p.rownumbers) { this.p.colNames.unshift(&quot;&quot;); this.p.colModel.unshift({name:'rn',width:ts.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:'center',fixed:true}); } ts.p.xmlReader = $.extend(true,{ root: &quot;rows&quot;, row: &quot;row&quot;, page: &quot;rows&gt;page&quot;, total: &quot;rows&gt;total&quot;, records : &quot;rows&gt;records&quot;, repeatitems: true, cell: &quot;cell&quot;, id: &quot;[id]&quot;, userdata: &quot;userdata&quot;, subgrid: {root:&quot;rows&quot;, row: &quot;row&quot;, repeatitems: true, cell:&quot;cell&quot;} }, ts.p.xmlReader); ts.p.jsonReader = $.extend(true,{ root: &quot;rows&quot;, page: &quot;page&quot;, total: &quot;total&quot;, records: &quot;records&quot;, repeatitems: true, cell: &quot;cell&quot;, id: &quot;id&quot;, userdata: &quot;userdata&quot;, subgrid: {root:&quot;rows&quot;, repeatitems: true, cell:&quot;cell&quot;} },ts.p.jsonReader); ts.p.localReader = $.extend(true,{ root: &quot;rows&quot;, page: &quot;page&quot;, total: &quot;total&quot;, records: &quot;records&quot;, repeatitems: false, cell: &quot;cell&quot;, id: &quot;id&quot;, userdata: &quot;userdata&quot;, subgrid: {root:&quot;rows&quot;, repeatitems: true, cell:&quot;cell&quot;} },ts.p.localReader); if(ts.p.scroll){ ts.p.pgbuttons = false; ts.p.pginput=false; ts.p.rowList=[]; } if(ts.p.data.length) { refreshIndex(); } var thead = &quot;&lt;thead&gt;&lt;tr class='ui-jqgrid-labels' role='rowheader'&gt;&quot;, tdc, idn, w, res, sort, td, ptr, tbody, imgs,iac=&quot;&quot;,idc=&quot;&quot;; if(ts.p.shrinkToFit===true &amp;&amp; ts.p.forceFit===true) { for (i=ts.p.colModel.length-1;i&gt;=0;i--){ if(!ts.p.colModel[i].hidden) { ts.p.colModel[i].resizable=false; break; } } } if(ts.p.viewsortcols[1] == 'horizontal') {iac=&quot; ui-i-asc&quot;;idc=&quot; ui-i-desc&quot;;} tdc = isMSIE ? &quot;class='ui-th-div-ie'&quot; :&quot;&quot;; imgs = &quot;&lt;span class='s-ico' style='display:none'&gt;&lt;span sort='asc' class='ui-grid-ico-sort ui-icon-asc&quot;+iac+&quot; ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-&quot;+dir+&quot;'&gt;&lt;/span&gt;&quot;; imgs += &quot;&lt;span sort='desc' class='ui-grid-ico-sort ui-icon-desc&quot;+idc+&quot; ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-&quot;+dir+&quot;'&gt;&lt;/span&gt;&lt;/span&gt;&quot;; for(i=0;i&lt;this.p.colNames.length;i++){ var tooltip = ts.p.headertitles ? (&quot; title=\\&quot;&quot;+$.jgrid.stripHtml(ts.p.colNames[i])+&quot;\\&quot;&quot;) :&quot;&quot;; thead += &quot;&lt;th id='&quot;+ts.p.id+&quot;_&quot;+ts.p.colModel[i].name+&quot;' role='columnheader' class='ui-state-default ui-th-column ui-th-&quot;+dir+&quot;'&quot;+ tooltip+&quot;&gt;&quot;; idn = ts.p.colModel[i].index || ts.p.colModel[i].name; thead += &quot;&lt;div id='jqgh_&quot;+ts.p.id+&quot;_&quot;+ts.p.colModel[i].name+&quot;' &quot;+tdc+&quot;&gt;&quot;+ts.p.colNames[i]; if(!ts.p.colModel[i].width) { ts.p.colModel[i].width = 150; } else { ts.p.colModel[i].width = parseInt(ts.p.colModel[i].width,10); } if(typeof ts.p.colModel[i].title !== &quot;boolean&quot;) { ts.p.colModel[i].title = true; } if (idn == ts.p.sortname) { ts.p.lastsort = i; } thead += imgs+&quot;&lt;/div&gt;&lt;/th&gt;&quot;; } thead += &quot;&lt;/tr&gt;&lt;/thead&gt;&quot;; imgs = null; $(this).append(thead); $(&quot;thead tr:first th&quot;,this).hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');}); if(this.p.multiselect) { var emp=[], chk; $('#cb_'+$.jgrid.jqID(ts.p.id),this).bind('click',function(){ ts.p.selarrrow = []; var froz = ts.p.frozenColumns === true ? ts.p.id + &quot;_frozen&quot; : &quot;&quot;; if (this.checked) { $(ts.rows).each(function(i) { if (i&gt;0) { if(!$(this).hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$(this).hasClass(&quot;jqgroup&quot;) &amp;&amp; !$(this).hasClass('ui-state-disabled')){ $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id) )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(this).addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;); ts.p.selarrrow.push(this.id); ts.p.selrow = this.id; if(froz) { $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv).addClass(&quot;ui-state-highlight&quot;); } } } }); chk=true; emp=[]; } else { $(ts.rows).each(function(i) { if(i&gt;0) { if(!$(this).hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$(this).hasClass('ui-state-disabled')){ $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id) )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $(this).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); emp.push(this.id); if(froz) { $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv )[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); $(&quot;#&quot;+$.jgrid.jqID(this.id), ts.grid.fbDiv).removeClass(&quot;ui-state-highlight&quot;); } } } }); ts.p.selrow = null; chk=false; } $(ts).triggerHandler(&quot;jqGridSelectAll&quot;, [chk ? ts.p.selarrrow : emp, chk]); if($.isFunction(ts.p.onSelectAll)) {ts.p.onSelectAll.call(ts, chk ? ts.p.selarrrow : emp,chk);} }); } if(ts.p.autowidth===true) { var pw = $(eg).innerWidth(); ts.p.width = pw &gt; 0? pw: 'nw'; } setColWidth(); $(eg).css(&quot;width&quot;,grid.width+&quot;px&quot;).append(&quot;&lt;div class='ui-jqgrid-resize-mark' id='rs_m&quot;+ts.p.id+&quot;'&gt;&amp;#160;&lt;/div&gt;&quot;); $(gv).css(&quot;width&quot;,grid.width+&quot;px&quot;); thead = $(&quot;thead:first&quot;,ts).get(0); var tfoot = &quot;&quot;; if(ts.p.footerrow) { tfoot += &quot;&lt;table role='grid' style='width:&quot;+ts.p.tblwidth+&quot;px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;tr role='row' class='ui-widget-content footrow footrow-&quot;+dir+&quot;'&gt;&quot;; } var thr = $(&quot;tr:first&quot;,thead), firstr = &quot;&lt;tr class='jqgfirstrow' role='row' style='height:auto'&gt;&quot;; ts.p.disableClick=false; $(&quot;th&quot;,thr).each(function ( j ) { w = ts.p.colModel[j].width; if(ts.p.colModel[j].resizable === undefined) {ts.p.colModel[j].resizable = true;} if(ts.p.colModel[j].resizable){ res = document.createElement(&quot;span&quot;); $(res).html(&quot;&amp;#160;&quot;).addClass('ui-jqgrid-resize ui-jqgrid-resize-'+dir) .css(&quot;cursor&quot;,&quot;col-resize&quot;); $(this).addClass(ts.p.resizeclass); } else { res = &quot;&quot;; } $(this).css(&quot;width&quot;,w+&quot;px&quot;).prepend(res); var hdcol = &quot;&quot;; if( ts.p.colModel[j].hidden ) { $(this).css(&quot;display&quot;,&quot;none&quot;); hdcol = &quot;display:none;&quot;; } firstr += &quot;&lt;td role='gridcell' style='height:0px;width:&quot;+w+&quot;px;&quot;+hdcol+&quot;'&gt;&lt;/td&gt;&quot;; grid.headers[j] = { width: w, el: this }; sort = ts.p.colModel[j].sortable; if( typeof sort !== 'boolean') {ts.p.colModel[j].sortable = true; sort=true;} var nm = ts.p.colModel[j].name; if( !(nm == 'cb' || nm=='subgrid' || nm=='rn') ) { if(ts.p.viewsortcols[2]){ $(&quot;&gt;div&quot;,this).addClass('ui-jqgrid-sortable'); } } if(sort) { if(ts.p.viewsortcols[0]) {$(&quot;div span.s-ico&quot;,this).show(); if(j==ts.p.lastsort){ $(&quot;div span.ui-icon-&quot;+ts.p.sortorder,this).removeClass(&quot;ui-state-disabled&quot;);}} else if( j == ts.p.lastsort) {$(&quot;div span.s-ico&quot;,this).show();$(&quot;div span.ui-icon-&quot;+ts.p.sortorder,this).removeClass(&quot;ui-state-disabled&quot;);} } if(ts.p.footerrow) { tfoot += &quot;&lt;td role='gridcell' &quot;+formatCol(j,0,'', null, '', false)+&quot;&gt;&amp;#160;&lt;/td&gt;&quot;; } }).mousedown(function(e) { if ($(e.target).closest(&quot;th&gt;span.ui-jqgrid-resize&quot;).length != 1) { return; } var ci = getColumnHeaderIndex(this); if(ts.p.forceFit===true) {ts.p.nv= nextVisible(ci);} grid.dragStart(ci, e, getOffset(ci)); return false; }).click(function(e) { if (ts.p.disableClick) { ts.p.disableClick = false; return false; } var s = &quot;th&gt;div.ui-jqgrid-sortable&quot;,r,d; if (!ts.p.viewsortcols[2]) { s = &quot;th&gt;div&gt;span&gt;span.ui-grid-ico-sort&quot;; } var t = $(e.target).closest(s); if (t.length != 1) { return; } var ci = getColumnHeaderIndex(this); if (!ts.p.viewsortcols[2]) { r=true;d=t.attr(&quot;sort&quot;); } sortData( $('div',this)[0].id, ci, r, d); return false; }); if (ts.p.sortable &amp;&amp; $.fn.sortable) { try { $(ts).jqGrid(&quot;sortableColumns&quot;, thr); } catch (e){} } if(ts.p.footerrow) { tfoot += &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; } firstr += &quot;&lt;/tr&gt;&quot;; tbody = document.createElement(&quot;tbody&quot;); this.appendChild(tbody); $(this).addClass('ui-jqgrid-btable').append(firstr); firstr = null; var hTable = $(&quot;&lt;table class='ui-jqgrid-htable' style='width:&quot;+ts.p.tblwidth+&quot;px' role='grid' aria-labelledby='gbox_&quot;+this.id+&quot;' cellspacing='0' cellpadding='0' border='0'&gt;&lt;/table&gt;&quot;).append(thead), hg = (ts.p.caption &amp;&amp; ts.p.hiddengrid===true) ? true : false, hb = $(&quot;&lt;div class='ui-jqgrid-hbox&quot; + (dir==&quot;rtl&quot; ? &quot;-rtl&quot; : &quot;&quot; )+&quot;'&gt;&lt;/div&gt;&quot;); thead = null; grid.hDiv = document.createElement(&quot;div&quot;); $(grid.hDiv) .css({ width: grid.width+&quot;px&quot;}) .addClass(&quot;ui-state-default ui-jqgrid-hdiv&quot;) .append(hb); $(hb).append(hTable); hTable = null; if(hg) { $(grid.hDiv).hide(); } if(ts.p.pager){ // TBD -- escape ts.p.pager here? if(typeof ts.p.pager === &quot;string&quot;) {if(ts.p.pager.substr(0,1) !=&quot;#&quot;) { ts.p.pager = &quot;#&quot;+ts.p.pager;} } else { ts.p.pager = &quot;#&quot;+ $(ts.p.pager).attr(&quot;id&quot;);} $(ts.p.pager).css({width: grid.width+&quot;px&quot;}).addClass('ui-state-default ui-jqgrid-pager ui-corner-bottom').appendTo(eg); if(hg) {$(ts.p.pager).hide();} setPager(ts.p.pager,''); } if( ts.p.cellEdit === false &amp;&amp; ts.p.hoverrows === true) { $(ts).bind('mouseover',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); if($(ptr).attr(&quot;class&quot;) !== &quot;ui-subgrid&quot;) { $(ptr).addClass(&quot;ui-state-hover&quot;); } }).bind('mouseout',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); $(ptr).removeClass(&quot;ui-state-hover&quot;); }); } var ri,ci, tdHtml; $(ts).before(grid.hDiv).click(function(e) { td = e.target; ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;); if($(ptr).length === 0 || ptr[0].className.indexOf( 'ui-state-disabled' ) &gt; -1 || ($(td,ts).closest(&quot;table.ui-jqgrid-btable&quot;).attr('id') || '').replace(&quot;_frozen&quot;,&quot;&quot;) !== ts.id ) { return this; } var scb = $(td).hasClass(&quot;cbox&quot;), cSel = $(ts).triggerHandler(&quot;jqGridBeforeSelectRow&quot;, [ptr[0].id, e]); cSel = (cSel === false || cSel === 'stop') ? false : true; if(cSel &amp;&amp; $.isFunction(ts.p.beforeSelectRow)) { cSel = ts.p.beforeSelectRow.call(ts,ptr[0].id, e); } if (td.tagName == 'A' || ((td.tagName == 'INPUT' || td.tagName == 'TEXTAREA' || td.tagName == 'OPTION' || td.tagName == 'SELECT' ) &amp;&amp; !scb) ) { return; } if(cSel === true) { ri = ptr[0].id; ci = $.jgrid.getCellIndex(td); tdHtml = $(td).closest(&quot;td,th&quot;).html(); $(ts).triggerHandler(&quot;jqGridCellSelect&quot;, [ri,ci,tdHtml,e]); if($.isFunction(ts.p.onCellSelect)) { ts.p.onCellSelect.call(ts,ri,ci,tdHtml,e); } if(ts.p.cellEdit === true) { if(ts.p.multiselect &amp;&amp; scb){ $(ts).jqGrid(&quot;setSelection&quot;, ri ,true,e); } else { ri = ptr[0].rowIndex; try {$(ts).jqGrid(&quot;editCell&quot;,ri,ci,true);} catch (_) {} } } else if ( !ts.p.multikey ) { if(ts.p.multiselect &amp;&amp; ts.p.multiboxonly) { if(scb){$(ts).jqGrid(&quot;setSelection&quot;,ri,true,e);} else { var frz = ts.p.frozenColumns ? ts.p.id+&quot;_frozen&quot; : &quot;&quot;; $(ts.p.selarrrow).each(function(i,n){ var ind = ts.rows.namedItem(n); $(ind).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(n))[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); if(frz) { $(&quot;#&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(frz)).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(frz))[ts.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); } }); ts.p.selarrrow = []; $(ts).jqGrid(&quot;setSelection&quot;,ri,true,e); } } else { $(ts).jqGrid(&quot;setSelection&quot;,ri,true,e); } } else { if(e[ts.p.multikey]) { $(ts).jqGrid(&quot;setSelection&quot;,ri,true,e); } else if(ts.p.multiselect &amp;&amp; scb) { scb = $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+ri).is(&quot;:checked&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(ts.p.id)+&quot;_&quot;+ri)[ts.p.useProp ? 'prop' : 'attr'](&quot;checked&quot;, scb); } } } }).bind('reloadGrid', function(e,opts) { if(ts.p.treeGrid ===true) { ts.p.datatype = ts.p.treedatatype;} if (opts &amp;&amp; opts.current) { ts.grid.selectionPreserver(ts); } if(ts.p.datatype==&quot;local&quot;){ $(ts).jqGrid(&quot;resetSelection&quot;); if(ts.p.data.length) { refreshIndex();} } else if(!ts.p.treeGrid) { ts.p.selrow=null; if(ts.p.multiselect) {ts.p.selarrrow =[];setHeadCheckBox(false);} ts.p.savedRow = []; } if(ts.p.scroll) {emptyRows.call(ts, true, false);} if (opts &amp;&amp; opts.page) { var page = opts.page; if (page &gt; ts.p.lastpage) { page = ts.p.lastpage; } if (page &lt; 1) { page = 1; } ts.p.page = page; if (ts.grid.prevRowHeight) { ts.grid.bDiv.scrollTop = (page - 1) * ts.grid.prevRowHeight * ts.p.rowNum; } else { ts.grid.bDiv.scrollTop = 0; } } if (ts.grid.prevRowHeight &amp;&amp; ts.p.scroll) { delete ts.p.lastpage; ts.grid.populateVisible(); } else { ts.grid.populate(); } if(ts.p._inlinenav===true) {$(ts).jqGrid('showAddEditButtons');} return false; }) .dblclick(function(e) { td = e.target; ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;); if($(ptr).length === 0 ){return;} ri = ptr[0].rowIndex; ci = $.jgrid.getCellIndex(td); $(ts).triggerHandler(&quot;jqGridDblClickRow&quot;, [$(ptr).attr(&quot;id&quot;),ri,ci,e]); if ($.isFunction(this.p.ondblClickRow)) { ts.p.ondblClickRow.call(ts,$(ptr).attr(&quot;id&quot;),ri,ci, e); } }) .bind('contextmenu', function(e) { td = e.target; ptr = $(td,ts.rows).closest(&quot;tr.jqgrow&quot;); if($(ptr).length === 0 ){return;} if(!ts.p.multiselect) { $(ts).jqGrid(&quot;setSelection&quot;,ptr[0].id,true,e); } ri = ptr[0].rowIndex; ci = $.jgrid.getCellIndex(td); $(ts).triggerHandler(&quot;jqGridRightClickRow&quot;, [$(ptr).attr(&quot;id&quot;),ri,ci,e]); if ($.isFunction(this.p.onRightClickRow)) { ts.p.onRightClickRow.call(ts,$(ptr).attr(&quot;id&quot;),ri,ci, e); } }); grid.bDiv = document.createElement(&quot;div&quot;); if(isMSIE) { if(String(ts.p.height).toLowerCase() === &quot;auto&quot;) { ts.p.height = &quot;100%&quot;; } } $(grid.bDiv) .append($('&lt;div style=&quot;position:relative;'+(isMSIE &amp;&amp; $.jgrid.msiever() &lt; 8 ? &quot;height:0.01%;&quot; : &quot;&quot;)+'&quot;&gt;&lt;/div&gt;').append('&lt;div&gt;&lt;/div&gt;').append(this)) .addClass(&quot;ui-jqgrid-bdiv&quot;) .css({ height: ts.p.height+(isNaN(ts.p.height)?&quot;&quot;:&quot;px&quot;), width: (grid.width)+&quot;px&quot;}) .scroll(grid.scrollGrid); $(&quot;table:first&quot;,grid.bDiv).css({width:ts.p.tblwidth+&quot;px&quot;}); if( !$.support.tbody ) { //IE if( $(&quot;tbody&quot;,this).length == 2 ) { $(&quot;tbody:gt(0)&quot;,this).remove();} } if(ts.p.multikey){ if( $.jgrid.msie) { $(grid.bDiv).bind(&quot;selectstart&quot;,function(){return false;}); } else { $(grid.bDiv).bind(&quot;mousedown&quot;,function(){return false;}); } } if(hg) {$(grid.bDiv).hide();} grid.cDiv = document.createElement(&quot;div&quot;); var arf = ts.p.hidegrid===true ? $(&quot;&lt;a role='link' href='javascript:void(0)'/&gt;&quot;).addClass('ui-jqgrid-titlebar-close HeaderButton').hover( function(){ arf.addClass('ui-state-hover');}, function() {arf.removeClass('ui-state-hover');}) .append(&quot;&lt;span class='ui-icon ui-icon-circle-triangle-n'&gt;&lt;/span&gt;&quot;).css((dir==&quot;rtl&quot;?&quot;left&quot;:&quot;right&quot;),&quot;0px&quot;) : &quot;&quot;; $(grid.cDiv).append(arf).append(&quot;&lt;span class='ui-jqgrid-title&quot;+(dir==&quot;rtl&quot; ? &quot;-rtl&quot; :&quot;&quot; )+&quot;'&gt;&quot;+ts.p.caption+&quot;&lt;/span&gt;&quot;) .addClass(&quot;ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix&quot;); $(grid.cDiv).insertBefore(grid.hDiv); if( ts.p.toolbar[0] ) { grid.uDiv = document.createElement(&quot;div&quot;); if(ts.p.toolbar[1] == &quot;top&quot;) {$(grid.uDiv).insertBefore(grid.hDiv);} else if (ts.p.toolbar[1]==&quot;bottom&quot; ) {$(grid.uDiv).insertAfter(grid.hDiv);} if(ts.p.toolbar[1]==&quot;both&quot;) { grid.ubDiv = document.createElement(&quot;div&quot;); $(grid.uDiv).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;t_&quot;+this.id).insertBefore(grid.hDiv); $(grid.ubDiv).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;tb_&quot;+this.id).insertAfter(grid.hDiv); if(hg) {$(grid.ubDiv).hide();} } else { $(grid.uDiv).width(grid.width).addClass(&quot;ui-userdata ui-state-default&quot;).attr(&quot;id&quot;,&quot;t_&quot;+this.id); } if(hg) {$(grid.uDiv).hide();} } if(ts.p.toppager) { ts.p.toppager = $.jgrid.jqID(ts.p.id)+&quot;_toppager&quot;; grid.topDiv = $(&quot;&lt;div id='&quot;+ts.p.toppager+&quot;'&gt;&lt;/div&gt;&quot;)[0]; ts.p.toppager = &quot;#&quot;+ts.p.toppager; $(grid.topDiv).addClass('ui-state-default ui-jqgrid-toppager').width(grid.width).insertBefore(grid.hDiv); setPager(ts.p.toppager,'_t'); } if(ts.p.footerrow) { grid.sDiv = $(&quot;&lt;div class='ui-jqgrid-sdiv'&gt;&lt;/div&gt;&quot;)[0]; hb = $(&quot;&lt;div class='ui-jqgrid-hbox&quot;+(dir==&quot;rtl&quot;?&quot;-rtl&quot;:&quot;&quot;)+&quot;'&gt;&lt;/div&gt;&quot;); $(grid.sDiv).append(hb).width(grid.width).insertAfter(grid.hDiv); $(hb).append(tfoot); grid.footers = $(&quot;.ui-jqgrid-ftable&quot;,grid.sDiv)[0].rows[0].cells; if(ts.p.rownumbers) { grid.footers[0].className = 'ui-state-default jqgrid-rownum'; } if(hg) {$(grid.sDiv).hide();} } hb = null; if(ts.p.caption) { var tdt = ts.p.datatype; if(ts.p.hidegrid===true) { $(&quot;.ui-jqgrid-titlebar-close&quot;,grid.cDiv).click( function(e){ var onHdCl = $.isFunction(ts.p.onHeaderClick), elems = &quot;.ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv&quot;, counter, self = this; if(ts.p.toolbar[0]===true) { if( ts.p.toolbar[1]=='both') { elems += ', #' + $(grid.ubDiv).attr('id'); } elems += ', #' + $(grid.uDiv).attr('id'); } counter = $(elems,&quot;#gview_&quot;+$.jgrid.jqID(ts.p.id)).length; if(ts.p.gridstate == 'visible') { $(elems,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).slideUp(&quot;fast&quot;, function() { counter--; if (counter === 0) { $(&quot;span&quot;,self).removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;); ts.p.gridstate = 'hidden'; if($(&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hasClass(&quot;ui-resizable&quot;)) { $(&quot;.ui-resizable-handle&quot;,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hide(); } $(ts).triggerHandler(&quot;jqGridHeaderClick&quot;, [ts.p.gridstate,e]); if(onHdCl) {if(!hg) {ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}} } }); } else if(ts.p.gridstate == 'hidden'){ $(elems,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).slideDown(&quot;fast&quot;, function() { counter--; if (counter === 0) { $(&quot;span&quot;,self).removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;); if(hg) {ts.p.datatype = tdt;populate();hg=false;} ts.p.gridstate = 'visible'; if($(&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).hasClass(&quot;ui-resizable&quot;)) { $(&quot;.ui-resizable-handle&quot;,&quot;#gbox_&quot;+$.jgrid.jqID(ts.p.id)).show(); } $(ts).triggerHandler(&quot;jqGridHeaderClick&quot;, [ts.p.gridstate,e]); if(onHdCl) {if(!hg) {ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}} } }); } return false; }); if(hg) {ts.p.datatype=&quot;local&quot;; $(&quot;.ui-jqgrid-titlebar-close&quot;,grid.cDiv).trigger(&quot;click&quot;);} } } else {$(grid.cDiv).hide();} $(grid.hDiv).after(grid.bDiv) .mousemove(function (e) { if(grid.resizing){grid.dragMove(e);return false;} }); $(&quot;.ui-jqgrid-labels&quot;,grid.hDiv).bind(&quot;selectstart&quot;, function () { return false; }); $(document).mouseup(function () { if(grid.resizing) { grid.dragEnd(); return false;} return true; }); ts.formatCol = formatCol; ts.sortData = sortData; ts.updatepager = updatepager; ts.refreshIndex = refreshIndex; ts.setHeadCheckBox = setHeadCheckBox; ts.constructTr = constructTr; ts.formatter = function ( rowId, cellval , colpos, rwdat, act){return formatter(rowId, cellval , colpos, rwdat, act);}; $.extend(grid,{populate : populate, emptyRows: emptyRows}); this.grid = grid; ts.addXmlData = function(d) {addXmlData(d,ts.grid.bDiv);}; ts.addJSONData = function(d) {addJSONData(d,ts.grid.bDiv);}; this.grid.cols = this.rows[0].cells; $(ts).triggerHandler(&quot;jqGridInitGrid&quot;); if ($.isFunction( ts.p.onInitGrid )) { ts.p.onInitGrid.call(ts); } populate();ts.p.hiddengrid=false; }); }; $.jgrid.extend({ getGridParam : function(pName) { var $t = this[0]; if (!$t || !$t.grid) {return;} if (!pName) { return $t.p; } return $t.p[pName] !== undefined ? $t.p[pName] : null; }, setGridParam : function (newParams){ return this.each(function(){ if (this.grid &amp;&amp; typeof newParams === 'object') {$.extend(true,this.p,newParams);} }); }, getDataIDs : function () { var ids=[], i=0, len, j=0; this.each(function(){ len = this.rows.length; if(len &amp;&amp; len&gt;0){ while(i&lt;len) { if($(this.rows[i]).hasClass('jqgrow')) { ids[j] = this.rows[i].id; j++; } i++; } } }); return ids; }, setSelection : function(selection,onsr, e) { return this.each(function(){ var $t = this, stat,pt, ner, ia, tpsr, fid; if(selection === undefined) { return; } onsr = onsr === false ? false : true; pt=$t.rows.namedItem(String(selection)); if(!pt || !pt.className || pt.className.indexOf( 'ui-state-disabled' ) &gt; -1 ) { return; } function scrGrid(iR){ var ch = $($t.grid.bDiv)[0].clientHeight, st = $($t.grid.bDiv)[0].scrollTop, rpos = $($t.rows[iR]).position().top, rh = $t.rows[iR].clientHeight; if(rpos+rh &gt;= ch+st) { $($t.grid.bDiv)[0].scrollTop = rpos-(ch+st)+rh+st; } else if(rpos &lt; ch+st) { if(rpos &lt; st) { $($t.grid.bDiv)[0].scrollTop = rpos; } } } if($t.p.scrollrows===true) { ner = $t.rows.namedItem(selection).rowIndex; if(ner &gt;=0 ){ scrGrid(ner); } } if($t.p.frozenColumns === true ) { fid = $t.p.id+&quot;_frozen&quot;; } if(!$t.p.multiselect) { if(pt.className !== &quot;ui-subgrid&quot;) { if( $t.p.selrow != pt.id) { $($t.rows.namedItem($t.p.selrow)).removeClass(&quot;ui-state-highlight&quot;).attr({&quot;aria-selected&quot;:&quot;false&quot;, &quot;tabindex&quot; : &quot;-1&quot;}); $(pt).addClass(&quot;ui-state-highlight&quot;).attr({&quot;aria-selected&quot;:&quot;true&quot;, &quot;tabindex&quot; : &quot;0&quot;});//.focus(); if(fid) { $(&quot;#&quot;+$.jgrid.jqID($t.p.selrow), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).addClass(&quot;ui-state-highlight&quot;); } stat = true; } else { stat = false; } $t.p.selrow = pt.id; $($t).triggerHandler(&quot;jqGridSelectRow&quot;, [pt.id, stat, e]); if( $t.p.onSelectRow &amp;&amp; onsr) { $t.p.onSelectRow.call($t, pt.id, stat, e); } } } else { //unselect selectall checkbox when deselecting a specific row $t.setHeadCheckBox( false ); $t.p.selrow = pt.id; ia = $.inArray($t.p.selrow,$t.p.selarrrow); if ( ia === -1 ){ if(pt.className !== &quot;ui-subgrid&quot;) { $(pt).addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;);} stat = true; $t.p.selarrrow.push($t.p.selrow); } else { if(pt.className !== &quot;ui-subgrid&quot;) { $(pt).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;);} stat = false; $t.p.selarrrow.splice(ia,1); tpsr = $t.p.selarrrow[0]; $t.p.selrow = (tpsr === undefined) ? null : tpsr; } $(&quot;#jqg_&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(pt.id))[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,stat); if(fid) { if(ia === -1) { $(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).addClass(&quot;ui-state-highlight&quot;); } else { $(&quot;#&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); } $(&quot;#jqg_&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(selection), &quot;#&quot;+$.jgrid.jqID(fid))[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,stat); } $($t).triggerHandler(&quot;jqGridSelectRow&quot;, [pt.id, stat, e]); if( $t.p.onSelectRow &amp;&amp; onsr) { $t.p.onSelectRow.call($t, pt.id , stat, e); } } }); }, resetSelection : function( rowid ){ return this.each(function(){ var t = this, ind, sr, fid; if( t.p.frozenColumns === true ) { fid = t.p.id+&quot;_frozen&quot;; } if(rowid !== undefined ) { sr = rowid === t.p.selrow ? t.p.selrow : rowid; $(&quot;#&quot;+$.jgrid.jqID(t.p.id)+&quot; tbody:first tr#&quot;+$.jgrid.jqID(sr)).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); if (fid) { $(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); } if(t.p.multiselect) { $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(t.p.id))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); if(fid) { $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(sr), &quot;#&quot;+$.jgrid.jqID(fid))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); } t.setHeadCheckBox( false); } sr = null; } else if(!t.p.multiselect) { if(t.p.selrow) { $(&quot;#&quot;+$.jgrid.jqID(t.p.id)+&quot; tbody:first tr#&quot;+$.jgrid.jqID(t.p.selrow)).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); if(fid) { $(&quot;#&quot;+$.jgrid.jqID(t.p.selrow), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); } t.p.selrow = null; } } else { $(t.p.selarrrow).each(function(i,n){ ind = t.rows.namedItem(n); $(ind).removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(n))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); if(fid) { $(&quot;#&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(fid)).removeClass(&quot;ui-state-highlight&quot;); $(&quot;#jqg_&quot;+$.jgrid.jqID(t.p.id)+&quot;_&quot;+$.jgrid.jqID(n), &quot;#&quot;+$.jgrid.jqID(fid))[t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); } }); t.setHeadCheckBox( false ); t.p.selarrrow = []; } if(t.p.cellEdit === true) { if(parseInt(t.p.iCol,10)&gt;=0 &amp;&amp; parseInt(t.p.iRow,10)&gt;=0) { $(&quot;td:eq(&quot;+t.p.iCol+&quot;)&quot;,t.rows[t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;); $(t.rows[t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;); } } t.p.savedRow = []; }); }, getRowData : function( rowid ) { var res = {}, resall, getall=false, len, j=0; this.each(function(){ var $t = this,nm,ind; if(rowid === undefined) { getall = true; resall = []; len = $t.rows.length; } else { ind = $t.rows.namedItem(rowid); if(!ind) { return res; } len = 2; } while(j&lt;len){ if(getall) { ind = $t.rows[j]; } if( $(ind).hasClass('jqgrow') ) { $('td[role=&quot;gridcell&quot;]',ind).each( function(i) { nm = $t.p.colModel[i].name; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn') { if($t.p.treeGrid===true &amp;&amp; nm == $t.p.ExpandColumn) { res[nm] = $.jgrid.htmlDecode($(&quot;span:first&quot;,this).html()); } else { try { res[nm] = $.unformat.call($t,this,{rowId:ind.id, colModel:$t.p.colModel[i]},i); } catch (e){ res[nm] = $.jgrid.htmlDecode($(this).html()); } } } }); if(getall) { resall.push(res); res={}; } } j++; } }); return resall || res; }, delRowData : function(rowid) { var success = false, rowInd, ia, ri; this.each(function() { var $t = this; rowInd = $t.rows.namedItem(rowid); if(!rowInd) {return false;} ri = rowInd.rowIndex; $(rowInd).remove(); $t.p.records--; $t.p.reccount--; $t.updatepager(true,false); success=true; if($t.p.multiselect) { ia = $.inArray(rowid,$t.p.selarrrow); if(ia != -1) { $t.p.selarrrow.splice(ia,1);} } if ($t.p.multiselect &amp;&amp; $t.p.selarrrow.length &gt; 0) { $t.p.selrow = $t.p.selarrrow[$t.p.selarrrow.length-1]; } else { $t.p.selrow = null; } if($t.p.datatype == 'local') { var id = $.jgrid.stripPref($t.p.idPrefix, rowid), pos = $t.p._index[id]; if(pos !== undefined) { $t.p.data.splice(pos,1); $t.refreshIndex(); } } if( $t.p.altRows === true &amp;&amp; success ) { var cn = $t.p.altclass; $($t.rows).each(function(i){ if(i % 2 ==1) { $(this).addClass(cn); } else { $(this).removeClass(cn); } }); } }); return success; }, setRowData : function(rowid, data, cssp) { var nm, success=true, title; this.each(function(){ if(!this.grid) {return false;} var t = this, vl, ind, cp = typeof cssp, lcdata={}; ind = t.rows.namedItem(rowid); if(!ind) { return false; } if( data ) { try { $(this.p.colModel).each(function(i){ nm = this.name; if( data[nm] !== undefined) { lcdata[nm] = this.formatter &amp;&amp; typeof this.formatter === 'string' &amp;&amp; this.formatter == 'date' ? $.unformat.date.call(t,data[nm],this) : data[nm]; vl = t.formatter( rowid, data[nm], i, data, 'edit'); title = this.title ? {&quot;title&quot;:$.jgrid.stripHtml(vl)} : {}; if(t.p.treeGrid===true &amp;&amp; nm == t.p.ExpandColumn) { $(&quot;td[role='gridcell']:eq(&quot;+i+&quot;) &gt; span:first&quot;,ind).html(vl).attr(title); } else { $(&quot;td[role='gridcell']:eq(&quot;+i+&quot;)&quot;,ind).html(vl).attr(title); } } }); if(t.p.datatype == 'local') { var id = $.jgrid.stripPref(t.p.idPrefix, rowid), pos = t.p._index[id], key; if(t.p.treeGrid) { for(key in t.p.treeReader){ if(t.p.treeReader.hasOwnProperty(key)) { delete lcdata[t.p.treeReader[key]]; } } } if(pos !== undefined) { t.p.data[pos] = $.extend(true, t.p.data[pos], lcdata); } lcdata = null; } } catch (e) { success = false; } } if(success) { if(cp === 'string') {$(ind).addClass(cssp);} else if(cp === 'object') {$(ind).css(cssp);} $(t).triggerHandler(&quot;jqGridAfterGridComplete&quot;); } }); return success; }, addRowData : function(rowid,rdata,pos,src) { if(!pos) {pos = &quot;last&quot;;} var success = false, nm, row, gi, si, ni,sind, i, v, prp=&quot;&quot;, aradd, cnm, cn, data, cm, id; if(rdata) { if($.isArray(rdata)) { aradd=true; pos = &quot;last&quot;; cnm = rowid; } else { rdata = [rdata]; aradd = false; } this.each(function() { var t = this, datalen = rdata.length; ni = t.p.rownumbers===true ? 1 :0; gi = t.p.multiselect ===true ? 1 :0; si = t.p.subGrid===true ? 1 :0; if(!aradd) { if(rowid !== undefined) { rowid = String(rowid);} else { rowid = $.jgrid.randId(); if(t.p.keyIndex !== false) { cnm = t.p.colModel[t.p.keyIndex+gi+si+ni].name; if(rdata[0][cnm] !== undefined) { rowid = rdata[0][cnm]; } } } } cn = t.p.altclass; var k = 0, cna =&quot;&quot;, lcdata = {}, air = $.isFunction(t.p.afterInsertRow) ? true : false; while(k &lt; datalen) { data = rdata[k]; row=[]; if(aradd) { try { rowid = data[cnm]; if(rowid===undefined) { rowid = $.jgrid.randId(); } } catch (e) {rowid = $.jgrid.randId();} cna = t.p.altRows === true ? (t.rows.length-1)%2 === 0 ? cn : &quot;&quot; : &quot;&quot;; } id = rowid; rowid = t.p.idPrefix + rowid; if(ni){ prp = t.formatCol(0,1,'',null,rowid, true); row[row.length] = &quot;&lt;td role=\\&quot;gridcell\\&quot; class=\\&quot;ui-state-default jqgrid-rownum\\&quot; &quot;+prp+&quot;&gt;0&lt;/td&gt;&quot;; } if(gi) { v = &quot;&lt;input role=\\&quot;checkbox\\&quot; type=\\&quot;checkbox\\&quot;&quot;+&quot; id=\\&quot;jqg_&quot;+t.p.id+&quot;_&quot;+rowid+&quot;\\&quot; class=\\&quot;cbox\\&quot;/&gt;&quot;; prp = t.formatCol(ni,1,'', null, rowid, true); row[row.length] = &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; } if(si) { row[row.length] = $(t).jqGrid(&quot;addSubGridCell&quot;,gi+ni,1); } for(i = gi+si+ni; i &lt; t.p.colModel.length;i++){ cm = t.p.colModel[i]; nm = cm.name; lcdata[nm] = data[nm]; v = t.formatter( rowid, $.jgrid.getAccessor(data,nm), i, data ); prp = t.formatCol(i,1,v, data, rowid, lcdata); row[row.length] = &quot;&lt;td role=\\&quot;gridcell\\&quot; &quot;+prp+&quot;&gt;&quot;+v+&quot;&lt;/td&gt;&quot;; } row.unshift( t.constructTr(rowid, false, cna, lcdata, data, false ) ); row[row.length] = &quot;&lt;/tr&gt;&quot;; if(t.rows.length === 0){ $(&quot;table:first&quot;,t.grid.bDiv).append(row.join('')); } else { switch (pos) { case 'last': $(t.rows[t.rows.length-1]).after(row.join('')); sind = t.rows.length-1; break; case 'first': $(t.rows[0]).after(row.join('')); sind = 1; break; case 'after': sind = t.rows.namedItem(src); if (sind) { if($(t.rows[sind.rowIndex+1]).hasClass(&quot;ui-subgrid&quot;)) { $(t.rows[sind.rowIndex+1]).after(row); } else { $(sind).after(row.join('')); } } sind++; break; case 'before': sind = t.rows.namedItem(src); if(sind) {$(sind).before(row.join(''));sind=sind.rowIndex;} sind--; break; } } if(t.p.subGrid===true) { $(t).jqGrid(&quot;addSubGrid&quot;,gi+ni, sind); } t.p.records++; t.p.reccount++; $(t).triggerHandler(&quot;jqGridAfterInsertRow&quot;, [rowid,data,data]); if(air) { t.p.afterInsertRow.call(t,rowid,data,data); } k++; if(t.p.datatype == 'local') { lcdata[t.p.localReader.id] = id; t.p._index[id] = t.p.data.length; t.p.data.push(lcdata); lcdata = {}; } } if( t.p.altRows === true &amp;&amp; !aradd) { if (pos == &quot;last&quot;) { if ((t.rows.length-1)%2 == 1) {$(t.rows[t.rows.length-1]).addClass(cn);} } else { $(t.rows).each(function(i){ if(i % 2 ==1) { $(this).addClass(cn); } else { $(this).removeClass(cn); } }); } } t.updatepager(true,true); success = true; }); } return success; }, footerData : function(action,data, format) { var nm, success=false, res={}, title; function isEmpty(obj) { var i; for(i in obj) { if (obj.hasOwnProperty(i)) { return false; } } return true; } if(action === undefined) { action = &quot;get&quot;; } if(typeof format !== &quot;boolean&quot;) { format = true; } action = action.toLowerCase(); this.each(function(){ var t = this, vl; if(!t.grid || !t.p.footerrow) {return false;} if(action == &quot;set&quot;) { if(isEmpty(data)) { return false; } } success=true; $(this.p.colModel).each(function(i){ nm = this.name; if(action == &quot;set&quot;) { if( data[nm] !== undefined) { vl = format ? t.formatter( &quot;&quot;, data[nm], i, data, 'edit') : data[nm]; title = this.title ? {&quot;title&quot;:$.jgrid.stripHtml(vl)} : {}; $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;,t.grid.sDiv).html(vl).attr(title); success = true; } } else if(action == &quot;get&quot;) { res[nm] = $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;,t.grid.sDiv).html(); } }); }); return action == &quot;get&quot; ? res : success; }, showHideCol : function(colname,show) { return this.each(function() { var $t = this, fndh=false, brd=$.jgrid.cell_width ? 0: $t.p.cellLayout, cw; if (!$t.grid ) {return;} if( typeof colname === 'string') {colname=[colname];} show = show != &quot;none&quot; ? &quot;&quot; : &quot;none&quot;; var sw = show === &quot;&quot; ? true :false, gh = $t.p.groupHeader &amp;&amp; (typeof $t.p.groupHeader === 'object' || $.isFunction($t.p.groupHeader) ); if(gh) { $($t).jqGrid('destroyGroupHeader', false); } $(this.p.colModel).each(function(i) { if ($.inArray(this.name,colname) !== -1 &amp;&amp; this.hidden === sw) { if($t.p.frozenColumns === true &amp;&amp; this.frozen === true) { return true; } $(&quot;tr&quot;,$t.grid.hDiv).each(function(){ $(this.cells[i]).css(&quot;display&quot;, show); }); $($t.rows).each(function(){ if (!$(this).hasClass(&quot;jqgroup&quot;)) { $(this.cells[i]).css(&quot;display&quot;, show); } }); if($t.p.footerrow) { $(&quot;tr.footrow td:eq(&quot;+i+&quot;)&quot;, $t.grid.sDiv).css(&quot;display&quot;, show); } cw = parseInt(this.width,10); if(show === &quot;none&quot;) { $t.p.tblwidth -= cw+brd; } else { $t.p.tblwidth += cw+brd; } this.hidden = !sw; fndh=true; $($t).triggerHandler(&quot;jqGridShowHideCol&quot;, [sw,this.name,i]); } }); if(fndh===true) { if($t.p.shrinkToFit === true &amp;&amp; !isNaN($t.p.height)) { $t.p.tblwidth += parseInt($t.p.scrollOffset,10);} $($t).jqGrid(&quot;setGridWidth&quot;,$t.p.shrinkToFit === true ? $t.p.tblwidth : $t.p.width ); } if( gh ) { $($t).jqGrid('setGroupHeaders',$t.p.groupHeader); } }); }, hideCol : function (colname) { return this.each(function(){$(this).jqGrid(&quot;showHideCol&quot;,colname,&quot;none&quot;);}); }, showCol : function(colname) { return this.each(function(){$(this).jqGrid(&quot;showHideCol&quot;,colname,&quot;&quot;);}); }, remapColumns : function(permutation, updateCells, keepHeader) { function resortArray(a) { var ac; if (a.length) { ac = $.makeArray(a); } else { ac = $.extend({}, a); } $.each(permutation, function(i) { a[i] = ac[this]; }); } var ts = this.get(0); function resortRows(parent, clobj) { $(&quot;&gt;tr&quot;+(clobj||&quot;&quot;), parent).each(function() { var row = this; var elems = $.makeArray(row.cells); $.each(permutation, function() { var e = elems[this]; if (e) { row.appendChild(e); } }); }); } resortArray(ts.p.colModel); resortArray(ts.p.colNames); resortArray(ts.grid.headers); resortRows($(&quot;thead:first&quot;, ts.grid.hDiv), keepHeader &amp;&amp; &quot;:not(.ui-jqgrid-labels)&quot;); if (updateCells) { resortRows($(&quot;#&quot;+$.jgrid.jqID(ts.p.id)+&quot; tbody:first&quot;), &quot;.jqgfirstrow, tr.jqgrow, tr.jqfoot&quot;); } if (ts.p.footerrow) { resortRows($(&quot;tbody:first&quot;, ts.grid.sDiv)); } if (ts.p.remapColumns) { if (!ts.p.remapColumns.length){ ts.p.remapColumns = $.makeArray(permutation); } else { resortArray(ts.p.remapColumns); } } ts.p.lastsort = $.inArray(ts.p.lastsort, permutation); if(ts.p.treeGrid) { ts.p.expColInd = $.inArray(ts.p.expColInd, permutation); } $(ts).triggerHandler(&quot;jqGridRemapColumns&quot;, [permutation, updateCells, keepHeader]); }, setGridWidth : function(nwidth, shrink) { return this.each(function(){ if (!this.grid ) {return;} var $t = this, cw, initwidth = 0, brd=$.jgrid.cell_width ? 0: $t.p.cellLayout, lvc, vc=0, hs=false, scw=$t.p.scrollOffset, aw, gw=0, cl = 0,cr; if(typeof shrink !== 'boolean') { shrink=$t.p.shrinkToFit; } if(isNaN(nwidth)) {return;} nwidth = parseInt(nwidth,10); $t.grid.width = $t.p.width = nwidth; $(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).css(&quot;width&quot;,nwidth+&quot;px&quot;); $(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).css(&quot;width&quot;,nwidth+&quot;px&quot;); $($t.grid.bDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); $($t.grid.hDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); if($t.p.pager ) {$($t.p.pager).css(&quot;width&quot;,nwidth+&quot;px&quot;);} if($t.p.toppager ) {$($t.p.toppager).css(&quot;width&quot;,nwidth+&quot;px&quot;);} if($t.p.toolbar[0] === true){ $($t.grid.uDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); if($t.p.toolbar[1]==&quot;both&quot;) {$($t.grid.ubDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;);} } if($t.p.footerrow) { $($t.grid.sDiv).css(&quot;width&quot;,nwidth+&quot;px&quot;); } if(shrink ===false &amp;&amp; $t.p.forceFit === true) {$t.p.forceFit=false;} if(shrink===true) { $.each($t.p.colModel, function() { if(this.hidden===false){ cw = this.widthOrg; initwidth += cw+brd; if(this.fixed) { gw += cw+brd; } else { vc++; } cl++; } }); if(vc === 0) { return; } $t.p.tblwidth = initwidth; aw = nwidth-brd*vc-gw; if(!isNaN($t.p.height)) { if($($t.grid.bDiv)[0].clientHeight &lt; $($t.grid.bDiv)[0].scrollHeight || $t.rows.length === 1){ hs = true; aw -= scw; } } initwidth =0; var cle = $t.grid.cols.length &gt;0; $.each($t.p.colModel, function(i) { if(this.hidden === false &amp;&amp; !this.fixed){ cw = this.widthOrg; cw = Math.round(aw*cw/($t.p.tblwidth-brd*vc-gw)); if (cw &lt; 0) { return; } this.width =cw; initwidth += cw; $t.grid.headers[i].width=cw; $t.grid.headers[i].el.style.width=cw+&quot;px&quot;; if($t.p.footerrow) { $t.grid.footers[i].style.width = cw+&quot;px&quot;; } if(cle) { $t.grid.cols[i].style.width = cw+&quot;px&quot;; } lvc = i; } }); if (!lvc) { return; } cr =0; if (hs) { if(nwidth-gw-(initwidth+brd*vc) !== scw){ cr = nwidth-gw-(initwidth+brd*vc)-scw; } } else if( Math.abs(nwidth-gw-(initwidth+brd*vc)) !== 1) { cr = nwidth-gw-(initwidth+brd*vc); } $t.p.colModel[lvc].width += cr; $t.p.tblwidth = initwidth+cr+brd*vc+gw; if($t.p.tblwidth &gt; nwidth) { var delta = $t.p.tblwidth - parseInt(nwidth,10); $t.p.tblwidth = nwidth; cw = $t.p.colModel[lvc].width = $t.p.colModel[lvc].width-delta; } else { cw= $t.p.colModel[lvc].width; } $t.grid.headers[lvc].width = cw; $t.grid.headers[lvc].el.style.width=cw+&quot;px&quot;; if(cle) { $t.grid.cols[lvc].style.width = cw+&quot;px&quot;; } if($t.p.footerrow) { $t.grid.footers[lvc].style.width = cw+&quot;px&quot;; } } if($t.p.tblwidth) { $('table:first',$t.grid.bDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;); $('table:first',$t.grid.hDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;); $t.grid.hDiv.scrollLeft = $t.grid.bDiv.scrollLeft; if($t.p.footerrow) { $('table:first',$t.grid.sDiv).css(&quot;width&quot;,$t.p.tblwidth+&quot;px&quot;); } } }); }, setGridHeight : function (nh) { return this.each(function (){ var $t = this; if(!$t.grid) {return;} var bDiv = $($t.grid.bDiv); bDiv.css({height: nh+(isNaN(nh)?&quot;&quot;:&quot;px&quot;)}); if($t.p.frozenColumns === true){ //follow the original set height to use 16, better scrollbar width detection $('#'+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).parent().height(bDiv.height() - 16); } $t.p.height = nh; if ($t.p.scroll) { $t.grid.populateVisible(); } }); }, setCaption : function (newcap){ return this.each(function(){ this.p.caption=newcap; $(&quot;span.ui-jqgrid-title, span.ui-jqgrid-title-rtl&quot;,this.grid.cDiv).html(newcap); $(this.grid.cDiv).show(); }); }, setLabel : function(colname, nData, prop, attrp ){ return this.each(function(){ var $t = this, pos=-1; if(!$t.grid) {return;} if(colname !== undefined) { $($t.p.colModel).each(function(i){ if (this.name == colname) { pos = i;return false; } }); } else { return; } if(pos&gt;=0) { var thecol = $(&quot;tr.ui-jqgrid-labels th:eq(&quot;+pos+&quot;)&quot;,$t.grid.hDiv); if (nData){ var ico = $(&quot;.s-ico&quot;,thecol); $(&quot;[id^=jqgh_]&quot;,thecol).empty().html(nData).append(ico); $t.p.colNames[pos] = nData; } if (prop) { if(typeof prop === 'string') {$(thecol).addClass(prop);} else {$(thecol).css(prop);} } if(typeof attrp === 'object') {$(thecol).attr(attrp);} } }); }, setCell : function(rowid,colname,nData,cssp,attrp, forceupd) { return this.each(function(){ var $t = this, pos =-1,v, title; if(!$t.grid) {return;} if(isNaN(colname)) { $($t.p.colModel).each(function(i){ if (this.name == colname) { pos = i;return false; } }); } else {pos = parseInt(colname,10);} if(pos&gt;=0) { var ind = $t.rows.namedItem(rowid); if (ind){ var tcell = $(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind); if(nData !== &quot;&quot; || forceupd === true) { v = $t.formatter(rowid, nData, pos,ind,'edit'); title = $t.p.colModel[pos].title ? {&quot;title&quot;:$.jgrid.stripHtml(v)} : {}; if($t.p.treeGrid &amp;&amp; $(&quot;.tree-wrap&quot;,$(tcell)).length&gt;0) { $(&quot;span&quot;,$(tcell)).html(v).attr(title); } else { $(tcell).html(v).attr(title); } if($t.p.datatype == &quot;local&quot;) { var cm = $t.p.colModel[pos], index; nData = cm.formatter &amp;&amp; typeof cm.formatter === 'string' &amp;&amp; cm.formatter == 'date' ? $.unformat.date.call($t,nData,cm) : nData; index = $t.p._index[rowid]; if(index !== undefined) { $t.p.data[index][cm.name] = nData; } } } if(typeof cssp === 'string'){ $(tcell).addClass(cssp); } else if(cssp) { $(tcell).css(cssp); } if(typeof attrp === 'object') {$(tcell).attr(attrp);} } } }); }, getCell : function(rowid,col) { var ret = false; this.each(function(){ var $t=this, pos=-1; if(!$t.grid) {return;} if(isNaN(col)) { $($t.p.colModel).each(function(i){ if (this.name === col) { pos = i;return false; } }); } else {pos = parseInt(col,10);} if(pos&gt;=0) { var ind = $t.rows.namedItem(rowid); if(ind) { try { ret = $.unformat.call($t,$(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind),{rowId:ind.id, colModel:$t.p.colModel[pos]},pos); } catch (e){ ret = $.jgrid.htmlDecode($(&quot;td:eq(&quot;+pos+&quot;)&quot;,ind).html()); } } } }); return ret; }, getCol : function (col, obj, mathopr) { var ret = [], val, sum=0, min, max, v; obj = typeof obj !== 'boolean' ? false : obj; if(mathopr === undefined) { mathopr = false; } this.each(function(){ var $t=this, pos=-1; if(!$t.grid) {return;} if(isNaN(col)) { $($t.p.colModel).each(function(i){ if (this.name === col) { pos = i;return false; } }); } else {pos = parseInt(col,10);} if(pos&gt;=0) { var ln = $t.rows.length, i =0; if (ln &amp;&amp; ln&gt;0){ while(i&lt;ln){ if($($t.rows[i]).hasClass('jqgrow')) { try { val = $.unformat.call($t,$($t.rows[i].cells[pos]),{rowId:$t.rows[i].id, colModel:$t.p.colModel[pos]},pos); } catch (e) { val = $.jgrid.htmlDecode($t.rows[i].cells[pos].innerHTML); } if(mathopr) { v = parseFloat(val); sum += v; if (max === undefined) {max = min = v;} min = Math.min(min, v); max = Math.max(max, v); } else if(obj) { ret.push( {id:$t.rows[i].id,value:val} ); } else { ret.push( val ); } } i++; } if(mathopr) { switch(mathopr.toLowerCase()){ case 'sum': ret =sum; break; case 'avg': ret = sum/ln; break; case 'count': ret = ln; break; case 'min': ret = min; break; case 'max': ret = max; break; } } } } }); return ret; }, clearGridData : function(clearfooter) { return this.each(function(){ var $t = this; if(!$t.grid) {return;} if(typeof clearfooter !== 'boolean') { clearfooter = false; } if($t.p.deepempty) {$(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first tr:gt(0)&quot;).remove();} else { var trf = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first tr:first&quot;)[0]; $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).empty().append(trf); } if($t.p.footerrow &amp;&amp; clearfooter) { $(&quot;.ui-jqgrid-ftable td&quot;,$t.grid.sDiv).html(&quot;&amp;#160;&quot;); } $t.p.selrow = null; $t.p.selarrrow= []; $t.p.savedRow = []; $t.p.records = 0;$t.p.page=1;$t.p.lastpage=0;$t.p.reccount=0; $t.p.data = []; $t.p._index = {}; $t.updatepager(true,false); }); }, getInd : function(rowid,rc){ var ret =false,rw; this.each(function(){ rw = this.rows.namedItem(rowid); if(rw) { ret = rc===true ? rw: rw.rowIndex; } }); return ret; }, bindKeys : function( settings ){ var o = $.extend({ onEnter: null, onSpace: null, onLeftKey: null, onRightKey: null, scrollingRows : true },settings || {}); return this.each(function(){ var $t = this; if( !$('body').is('[role]') ){$('body').attr('role','application');} $t.p.scrollrows = o.scrollingRows; $($t).keydown(function(event){ var target = $($t).find('tr[tabindex=0]')[0], id, r, mind, expanded = $t.p.treeReader.expanded_field; //check for arrow keys if(target) { mind = $t.p._index[target.id]; if(event.keyCode === 37 || event.keyCode === 38 || event.keyCode === 39 || event.keyCode === 40){ // up key if(event.keyCode === 38 ){ r = target.previousSibling; id = &quot;&quot;; if(r) { if($(r).is(&quot;:hidden&quot;)) { while(r) { r = r.previousSibling; if(!$(r).is(&quot;:hidden&quot;) &amp;&amp; $(r).hasClass('jqgrow')) {id = r.id;break;} } } else { id = r.id; } } $($t).jqGrid('setSelection', id, true, event); event.preventDefault(); } //if key is down arrow if(event.keyCode === 40){ r = target.nextSibling; id =&quot;&quot;; if(r) { if($(r).is(&quot;:hidden&quot;)) { while(r) { r = r.nextSibling; if(!$(r).is(&quot;:hidden&quot;) &amp;&amp; $(r).hasClass('jqgrow') ) {id = r.id;break;} } } else { id = r.id; } } $($t).jqGrid('setSelection', id, true, event); event.preventDefault(); } // left if(event.keyCode === 37 ){ if($t.p.treeGrid &amp;&amp; $t.p.data[mind][expanded]) { $(target).find(&quot;div.treeclick&quot;).trigger('click'); } $($t).triggerHandler(&quot;jqGridKeyLeft&quot;, [$t.p.selrow]); if($.isFunction(o.onLeftKey)) { o.onLeftKey.call($t, $t.p.selrow); } } // right if(event.keyCode === 39 ){ if($t.p.treeGrid &amp;&amp; !$t.p.data[mind][expanded]) { $(target).find(&quot;div.treeclick&quot;).trigger('click'); } $($t).triggerHandler(&quot;jqGridKeyRight&quot;, [$t.p.selrow]); if($.isFunction(o.onRightKey)) { o.onRightKey.call($t, $t.p.selrow); } } } //check if enter was pressed on a grid or treegrid node else if( event.keyCode === 13 ){ $($t).triggerHandler(&quot;jqGridKeyEnter&quot;, [$t.p.selrow]); if($.isFunction(o.onEnter)) { o.onEnter.call($t, $t.p.selrow); } } else if(event.keyCode === 32) { $($t).triggerHandler(&quot;jqGridKeySpace&quot;, [$t.p.selrow]); if($.isFunction(o.onSpace)) { o.onSpace.call($t, $t.p.selrow); } } } }); }); }, unbindKeys : function(){ return this.each(function(){ $(this).unbind('keydown'); }); }, getLocalRow : function (rowid) { var ret = false, ind; this.each(function(){ if(rowid !== undefined) { ind = this.p._index[rowid]; if(ind &gt;= 0 ) { ret = this.p.data[ind]; } } }); return ret; } }); })(jQuery); /*jshint eqeqeq:false */ /*global jQuery */ (function($){ /** * jqGrid extension for custom methods * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * * Wildraid wildraid@mail.ru * Oleg Kiriljuk oleg.kiriljuk@ok-soft-gmbh.com * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; $.jgrid.extend({ getColProp : function(colname){ var ret ={}, $t = this[0]; if ( !$t.grid ) { return false; } var cM = $t.p.colModel, i; for ( i=0;i&lt;cM.length;i++ ) { if ( cM[i].name == colname ) { ret = cM[i]; break; } } return ret; }, setColProp : function(colname, obj){ //do not set width will not work return this.each(function(){ if ( this.grid ) { if ( obj ) { var cM = this.p.colModel, i; for ( i=0;i&lt;cM.length;i++ ) { if ( cM[i].name == colname ) { $.extend(true, this.p.colModel[i],obj); break; } } } } }); }, sortGrid : function(colname,reload, sor){ return this.each(function(){ var $t=this,idx=-1,i; if ( !$t.grid ) { return;} if ( !colname ) { colname = $t.p.sortname; } for ( i=0;i&lt;$t.p.colModel.length;i++ ) { if ( $t.p.colModel[i].index == colname || $t.p.colModel[i].name==colname ) { idx = i; break; } } if ( idx!=-1 ){ var sort = $t.p.colModel[idx].sortable; if ( typeof sort !== 'boolean' ) { sort = true; } if ( typeof reload !=='boolean' ) { reload = false; } if ( sort ) { $t.sortData(&quot;jqgh_&quot;+$t.p.id+&quot;_&quot; + colname, idx, reload, sor); } } }); }, clearBeforeUnload : function () { return this.each(function(){ var grid = this.grid; grid.emptyRows.call(this, true, true); // this work quick enough and reduce the size of memory leaks if we have someone //$(document).unbind(&quot;mouseup&quot;); // TODO add namespace $(grid.hDiv).unbind(&quot;mousemove&quot;); // TODO add namespace $(this).unbind(); grid.dragEnd = null; grid.dragMove = null; grid.dragStart = null; grid.emptyRows = null; grid.populate = null; grid.populateVisible = null; grid.scrollGrid = null; grid.selectionPreserver = null; grid.bDiv = null; grid.cDiv = null; grid.hDiv = null; grid.cols = null; var i, l = grid.headers.length; for (i = 0; i &lt; l; i++) { grid.headers[i].el = null; } this.formatCol = null; this.sortData = null; this.updatepager = null; this.refreshIndex = null; this.setHeadCheckBox = null; this.constructTr = null; this.formatter = null; this.addXmlData = null; this.addJSONData = null; }); }, GridDestroy : function () { return this.each(function(){ if ( this.grid ) { if ( this.p.pager ) { // if not part of grid $(this.p.pager).remove(); } try { $(this).jqGrid('clearBeforeUnload'); $(&quot;#gbox_&quot;+$.jgrid.jqID(this.id)).remove(); } catch (_) {} } }); }, GridUnload : function(){ return this.each(function(){ if ( !this.grid ) {return;} var defgrid = {id: $(this).attr('id'),cl: $(this).attr('class')}; if (this.p.pager) { $(this.p.pager).empty().removeClass(&quot;ui-state-default ui-jqgrid-pager corner-bottom&quot;); } var newtable = document.createElement('table'); $(newtable).attr({id:defgrid.id}); newtable.className = defgrid.cl; var gid = $.jgrid.jqID(this.id); $(newtable).removeClass(&quot;ui-jqgrid-btable&quot;); if( $(this.p.pager).parents(&quot;#gbox_&quot;+gid).length === 1 ) { $(newtable).insertBefore(&quot;#gbox_&quot;+gid).show(); $(this.p.pager).insertBefore(&quot;#gbox_&quot;+gid); } else { $(newtable).insertBefore(&quot;#gbox_&quot;+gid).show(); } $(this).jqGrid('clearBeforeUnload'); $(&quot;#gbox_&quot;+gid).remove(); }); }, setGridState : function(state) { return this.each(function(){ if ( !this.grid ) {return;} var $t = this; if(state == 'hidden'){ $(&quot;.ui-jqgrid-bdiv, .ui-jqgrid-hdiv&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).slideUp(&quot;fast&quot;); if($t.p.pager) {$($t.p.pager).slideUp(&quot;fast&quot;);} if($t.p.toppager) {$($t.p.toppager).slideUp(&quot;fast&quot;);} if($t.p.toolbar[0]===true) { if( $t.p.toolbar[1]=='both') { $($t.grid.ubDiv).slideUp(&quot;fast&quot;); } $($t.grid.uDiv).slideUp(&quot;fast&quot;); } if($t.p.footerrow) { $(&quot;.ui-jqgrid-sdiv&quot;,&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).slideUp(&quot;fast&quot;); } $(&quot;.ui-jqgrid-titlebar-close span&quot;,$t.grid.cDiv).removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;); $t.p.gridstate = 'hidden'; } else if(state=='visible') { $(&quot;.ui-jqgrid-hdiv, .ui-jqgrid-bdiv&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).slideDown(&quot;fast&quot;); if($t.p.pager) {$($t.p.pager).slideDown(&quot;fast&quot;);} if($t.p.toppager) {$($t.p.toppager).slideDown(&quot;fast&quot;);} if($t.p.toolbar[0]===true) { if( $t.p.toolbar[1]=='both') { $($t.grid.ubDiv).slideDown(&quot;fast&quot;); } $($t.grid.uDiv).slideDown(&quot;fast&quot;); } if($t.p.footerrow) { $(&quot;.ui-jqgrid-sdiv&quot;,&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id)).slideDown(&quot;fast&quot;); } $(&quot;.ui-jqgrid-titlebar-close span&quot;,$t.grid.cDiv).removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;); $t.p.gridstate = 'visible'; } }); }, filterToolbar : function(p){ p = $.extend({ autosearch: true, searchOnEnter : true, beforeSearch: null, afterSearch: null, beforeClear: null, afterClear: null, searchurl : '', stringResult: false, groupOp: 'AND', defaultSearch : &quot;bw&quot; },p || {}); return this.each(function(){ var $t = this; if(this.ftoolbar) { return; } var triggerToolbar = function() { var sdata={}, j=0, v, nm, sopt={},so; $.each($t.p.colModel,function(){ nm = this.index || this.name; so = (this.searchoptions &amp;&amp; this.searchoptions.sopt) ? this.searchoptions.sopt[0] : this.stype=='select'? 'eq' : p.defaultSearch; v = $(&quot;#gs_&quot;+$.jgrid.jqID(this.name), (this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ? $t.grid.fhDiv : $t.grid.hDiv).val(); if(v) { sdata[nm] = v; sopt[nm] = so; j++; } else { try { delete $t.p.postData[nm]; } catch (z) {} } }); var sd = j&gt;0 ? true : false; if(p.stringResult === true || $t.p.datatype == &quot;local&quot;) { var ruleGroup = &quot;{\\&quot;groupOp\\&quot;:\\&quot;&quot; + p.groupOp + &quot;\\&quot;,\\&quot;rules\\&quot;:[&quot;; var gi=0; $.each(sdata,function(i,n){ if (gi &gt; 0) {ruleGroup += &quot;,&quot;;} ruleGroup += &quot;{\\&quot;field\\&quot;:\\&quot;&quot; + i + &quot;\\&quot;,&quot;; ruleGroup += &quot;\\&quot;op\\&quot;:\\&quot;&quot; + sopt[i] + &quot;\\&quot;,&quot;; n+=&quot;&quot;; ruleGroup += &quot;\\&quot;data\\&quot;:\\&quot;&quot; + n.replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;') + &quot;\\&quot;}&quot;; gi++; }); ruleGroup += &quot;]}&quot;; $.extend($t.p.postData,{filters:ruleGroup}); $.each(['searchField', 'searchString', 'searchOper'], function(i, n){ if($t.p.postData.hasOwnProperty(n)) { delete $t.p.postData[n];} }); } else { $.extend($t.p.postData,sdata); } var saveurl; if($t.p.searchurl) { saveurl = $t.p.url; $($t).jqGrid(&quot;setGridParam&quot;,{url:$t.p.searchurl}); } var bsr = $($t).triggerHandler(&quot;jqGridToolbarBeforeSearch&quot;) === 'stop' ? true : false; if(!bsr &amp;&amp; $.isFunction(p.beforeSearch)){bsr = p.beforeSearch.call($t);} if(!bsr) { $($t).jqGrid(&quot;setGridParam&quot;,{search:sd}).trigger(&quot;reloadGrid&quot;,[{page:1}]); } if(saveurl) {$($t).jqGrid(&quot;setGridParam&quot;,{url:saveurl});} $($t).triggerHandler(&quot;jqGridToolbarAfterSearch&quot;); if($.isFunction(p.afterSearch)){p.afterSearch.call($t);} }; var clearToolbar = function(trigger){ var sdata={}, j=0, nm; trigger = (typeof trigger !== 'boolean') ? true : trigger; $.each($t.p.colModel,function(){ var v; if(this.searchoptions &amp;&amp; this.searchoptions.defaultValue !== undefined) { v = this.searchoptions.defaultValue; } nm = this.index || this.name; switch (this.stype) { case 'select' : $(&quot;#gs_&quot;+$.jgrid.jqID(this.name)+&quot; option&quot;,(this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ? $t.grid.fhDiv : $t.grid.hDiv).each(function (i){ if(i===0) { this.selected = true; } if ($(this).val() == v) { this.selected = true; return false; } }); if ( v !== undefined ) { // post the key and not the text sdata[nm] = v; j++; } else { try { delete $t.p.postData[nm]; } catch(e) {} } break; case 'text': $(&quot;#gs_&quot;+$.jgrid.jqID(this.name),(this.frozen===true &amp;&amp; $t.p.frozenColumns === true) ? $t.grid.fhDiv : $t.grid.hDiv).val(v); if(v !== undefined) { sdata[nm] = v; j++; } else { try { delete $t.p.postData[nm]; } catch (y){} } break; } }); var sd = j&gt;0 ? true : false; if(p.stringResult === true || $t.p.datatype == &quot;local&quot;) { var ruleGroup = &quot;{\\&quot;groupOp\\&quot;:\\&quot;&quot; + p.groupOp + &quot;\\&quot;,\\&quot;rules\\&quot;:[&quot;; var gi=0; $.each(sdata,function(i,n){ if (gi &gt; 0) {ruleGroup += &quot;,&quot;;} ruleGroup += &quot;{\\&quot;field\\&quot;:\\&quot;&quot; + i + &quot;\\&quot;,&quot;; ruleGroup += &quot;\\&quot;op\\&quot;:\\&quot;&quot; + &quot;eq&quot; + &quot;\\&quot;,&quot;; n+=&quot;&quot;; ruleGroup += &quot;\\&quot;data\\&quot;:\\&quot;&quot; + n.replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;') + &quot;\\&quot;}&quot;; gi++; }); ruleGroup += &quot;]}&quot;; $.extend($t.p.postData,{filters:ruleGroup}); $.each(['searchField', 'searchString', 'searchOper'], function(i, n){ if($t.p.postData.hasOwnProperty(n)) { delete $t.p.postData[n];} }); } else { $.extend($t.p.postData,sdata); } var saveurl; if($t.p.searchurl) { saveurl = $t.p.url; $($t).jqGrid(&quot;setGridParam&quot;,{url:$t.p.searchurl}); } var bcv = $($t).triggerHandler(&quot;jqGridToolbarBeforeClear&quot;) === 'stop' ? true : false; if(!bcv &amp;&amp; $.isFunction(p.beforeClear)){bcv = p.beforeClear.call($t);} if(!bcv) { if(trigger) { $($t).jqGrid(&quot;setGridParam&quot;,{search:sd}).trigger(&quot;reloadGrid&quot;,[{page:1}]); } } if(saveurl) {$($t).jqGrid(&quot;setGridParam&quot;,{url:saveurl});} $($t).triggerHandler(&quot;jqGridToolbarAfterClear&quot;); if($.isFunction(p.afterClear)){p.afterClear();} }; var toggleToolbar = function(){ var trow = $(&quot;tr.ui-search-toolbar&quot;,$t.grid.hDiv), trow2 = $t.p.frozenColumns === true ? $(&quot;tr.ui-search-toolbar&quot;,$t.grid.fhDiv) : false; if(trow.css(&quot;display&quot;)=='none') { trow.show(); if(trow2) { trow2.show(); } } else { trow.hide(); if(trow2) { trow2.hide(); } } }; // create the row var tr = $(&quot;&lt;tr class='ui-search-toolbar' role='rowheader'&gt;&lt;/tr&gt;&quot;); var timeoutHnd; $.each($t.p.colModel,function(){ var cm=this, thd , th, soptions,surl,self; th = $(&quot;&lt;th role='columnheader' class='ui-state-default ui-th-column ui-th-&quot;+$t.p.direction+&quot;'&gt;&lt;/th&gt;&quot;); thd = $(&quot;&lt;div style='position:relative;height:100%;padding-right:0.3em;'&gt;&lt;/div&gt;&quot;); if(this.hidden===true) { $(th).css(&quot;display&quot;,&quot;none&quot;);} this.search = this.search === false ? false : true; if(this.stype === undefined) {this.stype='text';} soptions = $.extend({},this.searchoptions || {}); if(this.search){ switch (this.stype) { case &quot;select&quot;: surl = this.surl || soptions.dataUrl; if(surl) { // data returned should have already constructed html select // primitive jQuery load self = thd; $.ajax($.extend({ url: surl, dataType: &quot;html&quot;, success: function(res) { if(soptions.buildSelect !== undefined) { var d = soptions.buildSelect(res); if (d) { $(self).append(d); } } else { $(self).append(res); } if(soptions.defaultValue !== undefined) { $(&quot;select&quot;,self).val(soptions.defaultValue); } $(&quot;select&quot;,self).attr({name:cm.index || cm.name, id: &quot;gs_&quot;+cm.name}); if(soptions.attr) {$(&quot;select&quot;,self).attr(soptions.attr);} $(&quot;select&quot;,self).css({width: &quot;100%&quot;}); // preserve autoserch $.jgrid.bindEv( $(&quot;select&quot;,self)[0], soptions, $t); if(p.autosearch===true){ $(&quot;select&quot;,self).change(function(){ triggerToolbar(); return false; }); } res=null; } }, $.jgrid.ajaxOptions, $t.p.ajaxSelectOptions || {} )); } else { var oSv, sep, delim; if(cm.searchoptions) { oSv = cm.searchoptions.value === undefined ? &quot;&quot; : cm.searchoptions.value; sep = cm.searchoptions.separator === undefined ? &quot;:&quot; : cm.searchoptions.separator; delim = cm.searchoptions.delimiter === undefined ? &quot;;&quot; : cm.searchoptions.delimiter; } else if(cm.editoptions) { oSv = cm.editoptions.value === undefined ? &quot;&quot; : cm.editoptions.value; sep = cm.editoptions.separator === undefined ? &quot;:&quot; : cm.editoptions.separator; delim = cm.editoptions.delimiter === undefined ? &quot;;&quot; : cm.editoptions.delimiter; } if (oSv) { var elem = document.createElement(&quot;select&quot;); elem.style.width = &quot;100%&quot;; $(elem).attr({name:cm.index || cm.name, id: &quot;gs_&quot;+cm.name}); var so, sv, ov, key, k; if(typeof oSv === &quot;string&quot;) { so = oSv.split(delim); for(k=0; k&lt;so.length;k++){ sv = so[k].split(sep); ov = document.createElement(&quot;option&quot;); ov.value = sv[0]; ov.innerHTML = sv[1]; elem.appendChild(ov); } } else if(typeof oSv === &quot;object&quot; ) { for (key in oSv) { if(oSv.hasOwnProperty(key)) { ov = document.createElement(&quot;option&quot;); ov.value = key; ov.innerHTML = oSv[key]; elem.appendChild(ov); } } } if(soptions.defaultValue !== undefined) { $(elem).val(soptions.defaultValue); } if(soptions.attr) {$(elem).attr(soptions.attr);} $.jgrid.bindEv( elem , soptions, $t); $(thd).append(elem); if(p.autosearch===true){ $(elem).change(function(){ triggerToolbar(); return false; }); } } } break; case 'text': var df = soptions.defaultValue !== undefined ? soptions.defaultValue: &quot;&quot;; $(thd).append(&quot;&lt;input type='text' style='width:95%;padding:0px;' name='&quot;+(cm.index || cm.name)+&quot;' id='gs_&quot;+cm.name+&quot;' value='&quot;+df+&quot;'/&gt;&quot;); if(soptions.attr) {$(&quot;input&quot;,thd).attr(soptions.attr);} $.jgrid.bindEv( $(&quot;input&quot;,thd)[0], soptions, $t); if(p.autosearch===true){ if(p.searchOnEnter) { $(&quot;input&quot;,thd).keypress(function(e){ var key = e.charCode || e.keyCode || 0; if(key == 13){ triggerToolbar(); return false; } return this; }); } else { $(&quot;input&quot;,thd).keydown(function(e){ var key = e.which; switch (key) { case 13: return false; case 9 : case 16: case 37: case 38: case 39: case 40: case 27: break; default : if(timeoutHnd) { clearTimeout(timeoutHnd); } timeoutHnd = setTimeout(function(){triggerToolbar();},500); } }); } } break; } } $(th).append(thd); $(tr).append(th); }); $(&quot;table thead&quot;,$t.grid.hDiv).append(tr); this.ftoolbar = true; this.triggerToolbar = triggerToolbar; this.clearToolbar = clearToolbar; this.toggleToolbar = toggleToolbar; }); }, destroyFilterToolbar: function () { return this.each(function () { if (!this.ftoolbar) { return; } this.triggerToolbar = null; this.clearToolbar = null; this.toggleToolbar = null; this.ftoolbar = false; $(this.grid.hDiv).find(&quot;table thead tr.ui-search-toolbar&quot;).remove(); }); }, destroyGroupHeader : function(nullHeader) { if(nullHeader === undefined) { nullHeader = true; } return this.each(function() { var $t = this, $tr, i, l, headers, $th, $resizing, grid = $t.grid, thead = $(&quot;table.ui-jqgrid-htable thead&quot;, grid.hDiv), cm = $t.p.colModel, hc; if(!grid) { return; } $(this).unbind('.setGroupHeaders'); $tr = $(&quot;&lt;tr&gt;&quot;, {role: &quot;rowheader&quot;}).addClass(&quot;ui-jqgrid-labels&quot;); headers = grid.headers; for (i = 0, l = headers.length; i &lt; l; i++) { hc = cm[i].hidden ? &quot;none&quot; : &quot;&quot;; $th = $(headers[i].el) .width(headers[i].width) .css('display',hc); try { $th.removeAttr(&quot;rowSpan&quot;); } catch (rs) { //IE 6/7 $th.attr(&quot;rowSpan&quot;,1); } $tr.append($th); $resizing = $th.children(&quot;span.ui-jqgrid-resize&quot;); if ($resizing.length&gt;0) {// resizable column $resizing[0].style.height = &quot;&quot;; } $th.children(&quot;div&quot;)[0].style.top = &quot;&quot;; } $(thead).children('tr.ui-jqgrid-labels').remove(); $(thead).prepend($tr); if(nullHeader === true) { $($t).jqGrid('setGridParam',{ 'groupHeader': null}); } }); }, setGroupHeaders : function ( o ) { o = $.extend({ useColSpanStyle : false, groupHeaders: [] },o || {}); return this.each(function(){ this.p.groupHeader = o; var ts = this, i, cmi, skip = 0, $tr, $colHeader, th, $th, thStyle, iCol, cghi, //startColumnName, numberOfColumns, titleText, cVisibleColumns, colModel = ts.p.colModel, cml = colModel.length, ths = ts.grid.headers, $htable = $(&quot;table.ui-jqgrid-htable&quot;, ts.grid.hDiv), $trLabels = $htable.children(&quot;thead&quot;).children(&quot;tr.ui-jqgrid-labels:last&quot;).addClass(&quot;jqg-second-row-header&quot;), $thead = $htable.children(&quot;thead&quot;), $theadInTable, $firstHeaderRow = $htable.find(&quot;.jqg-first-row-header&quot;); if($firstHeaderRow[0] === undefined) { $firstHeaderRow = $('&lt;tr&gt;', {role: &quot;row&quot;, &quot;aria-hidden&quot;: &quot;true&quot;}).addClass(&quot;jqg-first-row-header&quot;).css(&quot;height&quot;, &quot;auto&quot;); } else { $firstHeaderRow.empty(); } var $firstRow, inColumnHeader = function (text, columnHeaders) { var length = columnHeaders.length, i; for (i = 0; i &lt; length; i++) { if (columnHeaders[i].startColumnName === text) { return i; } } return -1; }; $(ts).prepend($thead); $tr = $('&lt;tr&gt;', {role: &quot;rowheader&quot;}).addClass(&quot;ui-jqgrid-labels jqg-third-row-header&quot;); for (i = 0; i &lt; cml; i++) { th = ths[i].el; $th = $(th); cmi = colModel[i]; // build the next cell for the first header row thStyle = { height: '0px', width: ths[i].width + 'px', display: (cmi.hidden ? 'none' : '')}; $(&quot;&lt;th&gt;&quot;, {role: 'gridcell'}).css(thStyle).addClass(&quot;ui-first-th-&quot;+ts.p.direction).appendTo($firstHeaderRow); th.style.width = &quot;&quot;; // remove unneeded style iCol = inColumnHeader(cmi.name, o.groupHeaders); if (iCol &gt;= 0) { cghi = o.groupHeaders[iCol]; numberOfColumns = cghi.numberOfColumns; titleText = cghi.titleText; // caclulate the number of visible columns from the next numberOfColumns columns for (cVisibleColumns = 0, iCol = 0; iCol &lt; numberOfColumns &amp;&amp; (i + iCol &lt; cml); iCol++) { if (!colModel[i + iCol].hidden) { cVisibleColumns++; } } // The next numberOfColumns headers will be moved in the next row // in the current row will be placed the new column header with the titleText. // The text will be over the cVisibleColumns columns $colHeader = $('&lt;th&gt;').attr({role: &quot;columnheader&quot;}) .addClass(&quot;ui-state-default ui-th-column-header ui-th-&quot;+ts.p.direction) .css({'height':'22px', 'border-top': '0px none'}) .html(titleText); if(cVisibleColumns &gt; 0) { $colHeader.attr(&quot;colspan&quot;, String(cVisibleColumns)); } if (ts.p.headertitles) { $colHeader.attr(&quot;title&quot;, $colHeader.text()); } // hide if not a visible cols if( cVisibleColumns === 0) { $colHeader.hide(); } $th.before($colHeader); // insert new column header before the current $tr.append(th); // move the current header in the next row // set the coumter of headers which will be moved in the next row skip = numberOfColumns - 1; } else { if (skip === 0) { if (o.useColSpanStyle) { // expand the header height to two rows $th.attr(&quot;rowspan&quot;, &quot;2&quot;); } else { $('&lt;th&gt;', {role: &quot;columnheader&quot;}) .addClass(&quot;ui-state-default ui-th-column-header ui-th-&quot;+ts.p.direction) .css({&quot;display&quot;: cmi.hidden ? 'none' : '', 'border-top': '0px none'}) .insertBefore($th); $tr.append(th); } } else { // move the header to the next row //$th.css({&quot;padding-top&quot;: &quot;2px&quot;, height: &quot;19px&quot;}); $tr.append(th); skip--; } } } $theadInTable = $(ts).children(&quot;thead&quot;); $theadInTable.prepend($firstHeaderRow); $tr.insertAfter($trLabels); $htable.append($theadInTable); if (o.useColSpanStyle) { // Increase the height of resizing span of visible headers $htable.find(&quot;span.ui-jqgrid-resize&quot;).each(function () { var $parent = $(this).parent(); if ($parent.is(&quot;:visible&quot;)) { this.style.cssText = 'height: ' + $parent.height() + 'px !important; cursor: col-resize;'; } }); // Set position of the sortable div (the main lable) // with the column header text to the middle of the cell. // One should not do this for hidden headers. $htable.find(&quot;div.ui-jqgrid-sortable&quot;).each(function () { var $ts = $(this), $parent = $ts.parent(); if ($parent.is(&quot;:visible&quot;) &amp;&amp; $parent.is(&quot;:has(span.ui-jqgrid-resize)&quot;)) { $ts.css('top', ($parent.height() - $ts.outerHeight()) / 2 + 'px'); } }); } $firstRow = $theadInTable.find(&quot;tr.jqg-first-row-header&quot;); $(ts).bind('jqGridResizeStop.setGroupHeaders', function (e, nw, idx) { $firstRow.find('th').eq(idx).width(nw); }); }); }, setFrozenColumns : function () { return this.each(function() { if ( !this.grid ) {return;} var $t = this, cm = $t.p.colModel,i=0, len = cm.length, maxfrozen = -1, frozen= false; // TODO treeGrid and grouping Support if($t.p.subGrid === true || $t.p.treeGrid === true || $t.p.cellEdit === true || $t.p.sortable || $t.p.scroll || $t.p.grouping ) { return; } if($t.p.rownumbers) { i++; } if($t.p.multiselect) { i++; } // get the max index of frozen col while(i&lt;len) { // from left, no breaking frozen if(cm[i].frozen === true) { frozen = true; maxfrozen = i; } else { break; } i++; } if( maxfrozen&gt;=0 &amp;&amp; frozen) { var top = $t.p.caption ? $($t.grid.cDiv).outerHeight() : 0, hth = $(&quot;.ui-jqgrid-htable&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).height(); //headers if($t.p.toppager) { top = top + $($t.grid.topDiv).outerHeight(); } if($t.p.toolbar[0] === true) { if($t.p.toolbar[1] != &quot;bottom&quot;) { top = top + $($t.grid.uDiv).outerHeight(); } } $t.grid.fhDiv = $('&lt;div style=&quot;position:absolute;left:0px;top:'+top+'px;height:'+hth+'px;&quot; class=&quot;frozen-div ui-state-default ui-jqgrid-hdiv&quot;&gt;&lt;/div&gt;'); $t.grid.fbDiv = $('&lt;div style=&quot;position:absolute;left:0px;top:'+(parseInt(top,10)+parseInt(hth,10) + 1)+'px;overflow-y:hidden&quot; class=&quot;frozen-bdiv ui-jqgrid-bdiv&quot;&gt;&lt;/div&gt;'); $(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).append($t.grid.fhDiv); var htbl = $(&quot;.ui-jqgrid-htable&quot;,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).clone(true); // groupheader support - only if useColSpanstyle is false if($t.p.groupHeader) { $(&quot;tr.jqg-first-row-header, tr.jqg-third-row-header&quot;, htbl).each(function(){ $(&quot;th:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove(); }); var swapfroz = -1, fdel = -1; $(&quot;tr.jqg-second-row-header th&quot;, htbl).each(function(){ var cs= parseInt($(this).attr(&quot;colspan&quot;),10); if(cs) { swapfroz = swapfroz+cs; fdel++; } if(swapfroz === maxfrozen) { return false; } }); if(swapfroz !== maxfrozen) { fdel = maxfrozen; } $(&quot;tr.jqg-second-row-header&quot;, htbl).each(function(){ $(&quot;th:gt(&quot;+fdel+&quot;)&quot;,this).remove(); }); } else { $(&quot;tr&quot;,htbl).each(function(){ $(&quot;th:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove(); }); } $(htbl).width(1); // resizing stuff $($t.grid.fhDiv).append(htbl) .mousemove(function (e) { if($t.grid.resizing){ $t.grid.dragMove(e);return false; } }); $($t).bind('jqGridResizeStop.setFrozenColumns', function (e, w, index) { var rhth = $(&quot;.ui-jqgrid-htable&quot;,$t.grid.fhDiv); $(&quot;th:eq(&quot;+index+&quot;)&quot;,rhth).width( w ); var btd = $(&quot;.ui-jqgrid-btable&quot;,$t.grid.fbDiv); $(&quot;tr:first td:eq(&quot;+index+&quot;)&quot;,btd).width( w ); }); // sorting stuff $($t).bind('jqGridOnSortCol.setFrozenColumns', function (index, idxcol) { var previousSelectedTh = $(&quot;tr.ui-jqgrid-labels:last th:eq(&quot;+$t.p.lastsort+&quot;)&quot;,$t.grid.fhDiv), newSelectedTh = $(&quot;tr.ui-jqgrid-labels:last th:eq(&quot;+idxcol+&quot;)&quot;,$t.grid.fhDiv); $(&quot;span.ui-grid-ico-sort&quot;,previousSelectedTh).addClass('ui-state-disabled'); $(previousSelectedTh).attr(&quot;aria-selected&quot;,&quot;false&quot;); $(&quot;span.ui-icon-&quot;+$t.p.sortorder,newSelectedTh).removeClass('ui-state-disabled'); $(newSelectedTh).attr(&quot;aria-selected&quot;,&quot;true&quot;); if(!$t.p.viewsortcols[0]) { if($t.p.lastsort != idxcol) { $(&quot;span.s-ico&quot;,previousSelectedTh).hide(); $(&quot;span.s-ico&quot;,newSelectedTh).show(); } } }); // data stuff //TODO support for setRowData $(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)).append($t.grid.fbDiv); $($t.grid.bDiv).scroll(function () { $($t.grid.fbDiv).scrollTop($(this).scrollTop()); }); if($t.p.hoverrows === true) { $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).unbind('mouseover').unbind('mouseout'); } $($t).bind('jqGridAfterGridComplete.setFrozenColumns', function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).remove(); $($t.grid.fbDiv).height($($t.grid.bDiv).height()-16); var btbl = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).clone(true); $(&quot;tr&quot;,btbl).each(function(){ $(&quot;td:gt(&quot;+maxfrozen+&quot;)&quot;,this).remove(); }); $(btbl).width(1).attr(&quot;id&quot;,$t.p.id+&quot;_frozen&quot;); $($t.grid.fbDiv).append(btbl); if($t.p.hoverrows === true) { $(&quot;tr.jqgrow&quot;, btbl).hover( function(){ $(this).addClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)).addClass(&quot;ui-state-hover&quot;); }, function(){ $(this).removeClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)).removeClass(&quot;ui-state-hover&quot;); } ); $(&quot;tr.jqgrow&quot;, &quot;#&quot;+$.jgrid.jqID($t.p.id)).hover( function(){ $(this).addClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).addClass(&quot;ui-state-hover&quot;);}, function(){ $(this).removeClass(&quot;ui-state-hover&quot;); $(&quot;#&quot;+$.jgrid.jqID(this.id), &quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_frozen&quot;).removeClass(&quot;ui-state-hover&quot;); } ); } btbl=null; }); $t.p.frozenColumns = true; } }); }, destroyFrozenColumns : function() { return this.each(function() { if ( !this.grid ) {return;} if(this.p.frozenColumns === true) { var $t = this; $($t.grid.fhDiv).remove(); $($t.grid.fbDiv).remove(); $t.grid.fhDiv = null; $t.grid.fbDiv=null; $(this).unbind('.setFrozenColumns'); if($t.p.hoverrows === true) { var ptr; $(&quot;#&quot;+$.jgrid.jqID($t.p.id)).bind('mouseover',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); if($(ptr).attr(&quot;class&quot;) !== &quot;ui-subgrid&quot;) { $(ptr).addClass(&quot;ui-state-hover&quot;); } }).bind('mouseout',function(e) { ptr = $(e.target).closest(&quot;tr.jqgrow&quot;); $(ptr).removeClass(&quot;ui-state-hover&quot;); }); } this.p.frozenColumns = false; } }); } }); })(jQuery); /* * jqModal - Minimalist Modaling with jQuery * (http://dev.iceburg.net/jquery/jqmodal/) * * Copyright (c) 2007,2008 Brice Burgess &lt;bhb@iceburg.net&gt; * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl.html * * $Version: 07/06/2008 +r13 */ (function($) { $.fn.jqm=function(o){ var p={ overlay: 50, closeoverlay : true, overlayClass: 'jqmOverlay', closeClass: 'jqmClose', trigger: '.jqModal', ajax: F, ajaxText: '', target: F, modal: F, toTop: F, onShow: F, onHide: F, onLoad: F }; return this.each(function(){if(this._jqm)return H[this._jqm].c=$.extend({},H[this._jqm].c,o);s++;this._jqm=s; H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass('jqmID'+s),s:s}; if(p.trigger)$(this).jqmAddTrigger(p.trigger); });}; $.fn.jqmAddClose=function(e){return hs(this,e,'jqmHide');}; $.fn.jqmAddTrigger=function(e){return hs(this,e,'jqmShow');}; $.fn.jqmShow=function(t){return this.each(function(){$.jqm.open(this._jqm,t);});}; $.fn.jqmHide=function(t){return this.each(function(){$.jqm.close(this._jqm,t)});}; $.jqm = { hash:{}, open:function(s,t){var h=H[s],c=h.c,cc='.'+c.closeClass,z=(parseInt(h.w.css('z-index')));z=(z&gt;0)?z:3000;var o=$('&lt;div&gt;&lt;/div&gt;').css({height:'100%',width:'100%',position:'fixed',left:0,top:0,'z-index':z-1,opacity:c.overlay/100});if(h.a)return F;h.t=t;h.a=true;h.w.css('z-index',z); if(c.modal) {if(!A[0])setTimeout(function(){L('bind');},1);A.push(s);} else if(c.overlay &gt; 0) {if(c.closeoverlay) h.w.jqmAddClose(o);} else o=F; h.o=(o)?o.addClass(c.overlayClass).prependTo('body'):F; if(c.ajax) {var r=c.target||h.w,u=c.ajax;r=(typeof r == 'string')?$(r,h.w):$(r);u=(u.substr(0,1) == '@')?$(t).attr(u.substring(1)):u; r.html(c.ajaxText).load(u,function(){if(c.onLoad)c.onLoad.call(this,h);if(cc)h.w.jqmAddClose($(cc,h.w));e(h);});} else if(cc)h.w.jqmAddClose($(cc,h.w)); if(c.toTop&amp;&amp;h.o)h.w.before('&lt;span id=&quot;jqmP'+h.w[0]._jqm+'&quot;&gt;&lt;/span&gt;').insertAfter(h.o); (c.onShow)?c.onShow(h):h.w.show();e(h);return F; }, close:function(s){var h=H[s];if(!h.a)return F;h.a=F; if(A[0]){A.pop();if(!A[0])L('unbind');} if(h.c.toTop&amp;&amp;h.o)$('#jqmP'+h.w[0]._jqm).after(h.w).remove(); if(h.c.onHide)h.c.onHide(h);else{h.w.hide();if(h.o)h.o.remove();} return F; }, params:{}}; var s=0,H=$.jqm.hash,A=[],F=false, e=function(h){f(h);}, f=function(h){try{$(':input:visible',h.w)[0].focus();}catch(_){}}, L=function(t){$(document)[t](&quot;keypress&quot;,m)[t](&quot;keydown&quot;,m)[t](&quot;mousedown&quot;,m);}, m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents('.jqmID'+h.s)[0]);if(r)f(h);return !r;}, hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function() { if(!this[c]){this[c]=[];$(this).click(function(){for(var i in {jqmShow:1,jqmHide:1})for(var s in this[i])if(H[this[i][s]])H[this[i][s]].w[i](this);return F;});}this[c].push(s);});});}; })(jQuery);/* * jqDnR - Minimalistic Drag'n'Resize for jQuery. * * Copyright (c) 2007 Brice Burgess &lt;bhb@iceburg.net&gt;, http://www.iceburg.net * Licensed under the MIT License: * http://www.opensource.org/licenses/mit-license.php * * $Version: 2007.08.19 +r2 */ (function($){ $.fn.jqDrag=function(h){return i(this,h,'d');}; $.fn.jqResize=function(h,ar){return i(this,h,'r',ar);}; $.jqDnR={ dnr:{}, e:0, drag:function(v){ if(M.k == 'd'){E.css({left:M.X+v.pageX-M.pX,top:M.Y+v.pageY-M.pY});} else { E.css({width:Math.max(v.pageX-M.pX+M.W,0),height:Math.max(v.pageY-M.pY+M.H,0)}); if(M1){E1.css({width:Math.max(v.pageX-M1.pX+M1.W,0),height:Math.max(v.pageY-M1.pY+M1.H,0)});} } return false; }, stop:function(){ //E.css('opacity',M.o); $(document).unbind('mousemove',J.drag).unbind('mouseup',J.stop); } }; var J=$.jqDnR,M=J.dnr,E=J.e,E1,M1, i=function(e,h,k,aR){ return e.each(function(){ h=(h)?$(h,e):e; h.bind('mousedown',{e:e,k:k},function(v){ var d=v.data,p={};E=d.e;E1 = aR ? $(aR) : false; // attempt utilization of dimensions plugin to fix IE issues if(E.css('position') != 'relative'){try{E.position(p);}catch(e){}} M={ X:p.left||f('left')||0, Y:p.top||f('top')||0, W:f('width')||E[0].scrollWidth||0, H:f('height')||E[0].scrollHeight||0, pX:v.pageX, pY:v.pageY, k:d.k //o:E.css('opacity') }; // also resize if(E1 &amp;&amp; d.k != 'd'){ M1={ X:p.left||f1('left')||0, Y:p.top||f1('top')||0, W:E1[0].offsetWidth||f1('width')||0, H:E1[0].offsetHeight||f1('height')||0, pX:v.pageX, pY:v.pageY, k:d.k }; } else {M1 = false;} //E.css({opacity:0.8}); if($(&quot;input.hasDatepicker&quot;,E[0])[0]) { try {$(&quot;input.hasDatepicker&quot;,E[0]).datepicker('hide');}catch (dpe){} } $(document).mousemove($.jqDnR.drag).mouseup($.jqDnR.stop); return false; }); }); }, f=function(k){return parseInt(E.css(k),10)||false;}, f1=function(k){return parseInt(E1.css(k),10)||false;}; })(jQuery);/* The below work is licensed under Creative Commons GNU LGPL License. Original work: License: http://creativecommons.org/licenses/LGPL/2.1/ Author: Stefan Goessner/2006 Web: http://goessner.net/ Modifications made: Version: 0.9-p5 Description: Restructured code, JSLint validated (no strict whitespaces), added handling of empty arrays, empty strings, and int/floats values. Author: Michael Schøler/2008-01-29 Web: http://michael.hinnerup.net/blog/2008/01/26/converting-json-to-xml-and-xml-to-json/ Description: json2xml added support to convert functions as CDATA so it will be easy to write characters that cause some problems when convert Author: Tony Tomov */ /*global alert */ var xmlJsonClass = { // Param &quot;xml&quot;: Element or document DOM node. // Param &quot;tab&quot;: Tab or indent string for pretty output formatting omit or use empty string &quot;&quot; to supress. // Returns: JSON string xml2json: function(xml, tab) { if (xml.nodeType === 9) { // document node xml = xml.documentElement; } var nws = this.removeWhite(xml); var obj = this.toObj(nws); var json = this.toJson(obj, xml.nodeName, &quot;\\t&quot;); return &quot;{\\n&quot; + tab + (tab ? json.replace(/\\t/g, tab) : json.replace(/\\t|\\n/g, &quot;&quot;)) + &quot;\\n}&quot;; }, // Param &quot;o&quot;: JavaScript object // Param &quot;tab&quot;: tab or indent string for pretty output formatting omit or use empty string &quot;&quot; to supress. // Returns: XML string json2xml: function(o, tab) { var toXml = function(v, name, ind) { var xml = &quot;&quot;; var i, n; if (v instanceof Array) { if (v.length === 0) { xml += ind + &quot;&lt;&quot;+name+&quot;&gt;__EMPTY_ARRAY_&lt;/&quot;+name+&quot;&gt;\\n&quot;; } else { for (i = 0, n = v.length; i &lt; n; i += 1) { var sXml = ind + toXml(v[i], name, ind+&quot;\\t&quot;) + &quot;\\n&quot;; xml += sXml; } } } else if (typeof(v) === &quot;object&quot;) { var hasChild = false; xml += ind + &quot;&lt;&quot; + name; var m; for (m in v) if (v.hasOwnProperty(m)) { if (m.charAt(0) === &quot;@&quot;) { xml += &quot; &quot; + m.substr(1) + &quot;=\\&quot;&quot; + v[m].toString() + &quot;\\&quot;&quot;; } else { hasChild = true; } } xml += hasChild ? &quot;&gt;&quot; : &quot;/&gt;&quot;; if (hasChild) { for (m in v) if (v.hasOwnProperty(m)) { if (m === &quot;#text&quot;) { xml += v[m]; } else if (m === &quot;#cdata&quot;) { xml += &quot;&lt;![CDATA[&quot; + v[m] + &quot;]]&gt;&quot;; } else if (m.charAt(0) !== &quot;@&quot;) { xml += toXml(v[m], m, ind+&quot;\\t&quot;); } } xml += (xml.charAt(xml.length - 1) === &quot;\\n&quot; ? ind : &quot;&quot;) + &quot;&lt;/&quot; + name + &quot;&gt;&quot;; } } else if (typeof(v) === &quot;function&quot;) { xml += ind + &quot;&lt;&quot; + name + &quot;&gt;&quot; + &quot;&lt;![CDATA[&quot; + v + &quot;]]&gt;&quot; + &quot;&lt;/&quot; + name + &quot;&gt;&quot;; } else { if (v === undefined ) { v = &quot;&quot;; } if (v.toString() === &quot;\\&quot;\\&quot;&quot; || v.toString().length === 0) { xml += ind + &quot;&lt;&quot; + name + &quot;&gt;__EMPTY_STRING_&lt;/&quot; + name + &quot;&gt;&quot;; } else { xml += ind + &quot;&lt;&quot; + name + &quot;&gt;&quot; + v.toString() + &quot;&lt;/&quot; + name + &quot;&gt;&quot;; } } return xml; }; var xml = &quot;&quot;; var m; for (m in o) if (o.hasOwnProperty(m)) { xml += toXml(o[m], m, &quot;&quot;); } return tab ? xml.replace(/\\t/g, tab) : xml.replace(/\\t|\\n/g, &quot;&quot;); }, // Internal methods toObj: function(xml) { var o = {}; var FuncTest = /function/i; if (xml.nodeType === 1) { // element node .. if (xml.attributes.length) { // element with attributes .. var i; for (i = 0; i &lt; xml.attributes.length; i += 1) { o[&quot;@&quot; + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || &quot;&quot;).toString(); } } if (xml.firstChild) { // element has child nodes .. var textChild = 0, cdataChild = 0, hasElementChild = false; var n; for (n = xml.firstChild; n; n = n.nextSibling) { if (n.nodeType === 1) { hasElementChild = true; } else if (n.nodeType === 3 &amp;&amp; n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) { // non-whitespace text textChild += 1; } else if (n.nodeType === 4) { // cdata section node cdataChild += 1; } } if (hasElementChild) { if (textChild &lt; 2 &amp;&amp; cdataChild &lt; 2) { // structured element with evtl. a single text or/and cdata node .. this.removeWhite(xml); for (n = xml.firstChild; n; n = n.nextSibling) { if (n.nodeType === 3) { // text node o[&quot;#text&quot;] = this.escape(n.nodeValue); } else if (n.nodeType === 4) { // cdata node if (FuncTest.test(n.nodeValue)) { o[n.nodeName] = [o[n.nodeName], n.nodeValue]; } else { o[&quot;#cdata&quot;] = this.escape(n.nodeValue); } } else if (o[n.nodeName]) { // multiple occurence of element .. if (o[n.nodeName] instanceof Array) { o[n.nodeName][o[n.nodeName].length] = this.toObj(n); } else { o[n.nodeName] = [o[n.nodeName], this.toObj(n)]; } } else { // first occurence of element .. o[n.nodeName] = this.toObj(n); } } } else { // mixed content if (!xml.attributes.length) { o = this.escape(this.innerXml(xml)); } else { o[&quot;#text&quot;] = this.escape(this.innerXml(xml)); } } } else if (textChild) { // pure text if (!xml.attributes.length) { o = this.escape(this.innerXml(xml)); if (o === &quot;__EMPTY_ARRAY_&quot;) { o = &quot;[]&quot;; } else if (o === &quot;__EMPTY_STRING_&quot;) { o = &quot;&quot;; } } else { o[&quot;#text&quot;] = this.escape(this.innerXml(xml)); } } else if (cdataChild) { // cdata if (cdataChild &gt; 1) { o = this.escape(this.innerXml(xml)); } else { for (n = xml.firstChild; n; n = n.nextSibling) { if(FuncTest.test(xml.firstChild.nodeValue)) { o = xml.firstChild.nodeValue; break; } else { o[&quot;#cdata&quot;] = this.escape(n.nodeValue); } } } } } if (!xml.attributes.length &amp;&amp; !xml.firstChild) { o = null; } } else if (xml.nodeType === 9) { // document.node o = this.toObj(xml.documentElement); } else { alert(&quot;unhandled node type: &quot; + xml.nodeType); } return o; }, toJson: function(o, name, ind, wellform) { if(wellform === undefined) wellform = true; var json = name ? (&quot;\\&quot;&quot; + name + &quot;\\&quot;&quot;) : &quot;&quot;, tab = &quot;\\t&quot;, newline = &quot;\\n&quot;; if(!wellform) { tab= &quot;&quot;; newline= &quot;&quot;; } if (o === &quot;[]&quot;) { json += (name ? &quot;:[]&quot; : &quot;[]&quot;); } else if (o instanceof Array) { var n, i, ar=[]; for (i = 0, n = o.length; i &lt; n; i += 1) { ar[i] = this.toJson(o[i], &quot;&quot;, ind + tab, wellform); } json += (name ? &quot;:[&quot; : &quot;[&quot;) + (ar.length &gt; 1 ? (newline + ind + tab + ar.join(&quot;,&quot;+newline + ind + tab) + newline + ind) : ar.join(&quot;&quot;)) + &quot;]&quot;; } else if (o === null) { json += (name &amp;&amp; &quot;:&quot;) + &quot;null&quot;; } else if (typeof(o) === &quot;object&quot;) { var arr = [], m; for (m in o) { if (o.hasOwnProperty(m)) { arr[arr.length] = this.toJson(o[m], m, ind + tab, wellform); } } json += (name ? &quot;:{&quot; : &quot;{&quot;) + (arr.length &gt; 1 ? (newline + ind + tab + arr.join(&quot;,&quot;+newline + ind + tab) + newline + ind) : arr.join(&quot;&quot;)) + &quot;}&quot;; } else if (typeof(o) === &quot;string&quot;) { /* var objRegExp = /(^-?\\d+\\.?\\d*$)/; var FuncTest = /function/i; var os = o.toString(); if (objRegExp.test(os) || FuncTest.test(os) || os===&quot;false&quot; || os===&quot;true&quot;) { // int or float json += (name &amp;&amp; &quot;:&quot;) + &quot;\\&quot;&quot; +os + &quot;\\&quot;&quot;; } else { */ json += (name &amp;&amp; &quot;:&quot;) + &quot;\\&quot;&quot; + o.replace(/\\\\/g,'\\\\\\\\').replace(/\\&quot;/g,'\\\\&quot;') + &quot;\\&quot;&quot;; //} } else { json += (name &amp;&amp; &quot;:&quot;) + o.toString(); } return json; }, innerXml: function(node) { var s = &quot;&quot;; if (&quot;innerHTML&quot; in node) { s = node.innerHTML; } else { var asXml = function(n) { var s = &quot;&quot;, i; if (n.nodeType === 1) { s += &quot;&lt;&quot; + n.nodeName; for (i = 0; i &lt; n.attributes.length; i += 1) { s += &quot; &quot; + n.attributes[i].nodeName + &quot;=\\&quot;&quot; + (n.attributes[i].nodeValue || &quot;&quot;).toString() + &quot;\\&quot;&quot;; } if (n.firstChild) { s += &quot;&gt;&quot;; for (var c = n.firstChild; c; c = c.nextSibling) { s += asXml(c); } s += &quot;&lt;/&quot; + n.nodeName + &quot;&gt;&quot;; } else { s += &quot;/&gt;&quot;; } } else if (n.nodeType === 3) { s += n.nodeValue; } else if (n.nodeType === 4) { s += &quot;&lt;![CDATA[&quot; + n.nodeValue + &quot;]]&gt;&quot;; } return s; }; for (var c = node.firstChild; c; c = c.nextSibling) { s += asXml(c); } } return s; }, escape: function(txt) { return txt.replace(/[\\\\]/g, &quot;\\\\\\\\&quot;).replace(/[\\&quot;]/g, '\\\\&quot;').replace(/[\\n]/g, '\\\\n').replace(/[\\r]/g, '\\\\r'); }, removeWhite: function(e) { e.normalize(); var n; for (n = e.firstChild; n; ) { if (n.nodeType === 3) { // text node if (!n.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) { // pure whitespace text node var nxt = n.nextSibling; e.removeChild(n); n = nxt; } else { n = n.nextSibling; } } else if (n.nodeType === 1) { // element node this.removeWhite(n); n = n.nextSibling; } else { // any other node n = n.nextSibling; } } return e; } };/* ** * formatter for values but most of the values if for jqGrid * Some of this was inspired and based on how YUI does the table datagrid but in jQuery fashion * we are trying to keep it as light as possible * Joshua Burnett josh@9ci.com * http://www.greenbill.com * * Changes from Tony Tomov tony@trirand.com * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * **/ /*jshint eqeqeq:false */ /*global jQuery */ (function($) { &quot;use strict&quot;; $.fmatter = {}; //opts can be id:row id for the row, rowdata:the data for the row, colmodel:the column model for this column //example {id:1234,} $.extend($.fmatter,{ isBoolean : function(o) { return typeof o === 'boolean'; }, isObject : function(o) { return (o &amp;&amp; (typeof o === 'object' || $.isFunction(o))) || false; }, isString : function(o) { return typeof o === 'string'; }, isNumber : function(o) { return typeof o === 'number' &amp;&amp; isFinite(o); }, isNull : function(o) { return o === null; }, isUndefined : function(o) { return o === undefined; }, isValue : function (o) { return (this.isObject(o) || this.isString(o) || this.isNumber(o) || this.isBoolean(o)); }, isEmpty : function(o) { if(!this.isString(o) &amp;&amp; this.isValue(o)) { return false; } if (!this.isValue(o)){ return true; } o = $.trim(o).replace(/\\&amp;nbsp\\;/ig,'').replace(/\\&amp;#160\\;/ig,''); return o===&quot;&quot;; } }); $.fn.fmatter = function(formatType, cellval, opts, rwd, act) { // build main options before element iteration var v=cellval; opts = $.extend({}, $.jgrid.formatter, opts); try { v = $.fn.fmatter[formatType].call(this, cellval, opts, rwd, act); } catch(fe){} return v; }; $.fmatter.util = { // Taken from YAHOO utils NumberFormat : function(nData,opts) { if(!$.fmatter.isNumber(nData)) { nData *= 1; } if($.fmatter.isNumber(nData)) { var bNegative = (nData &lt; 0); var sOutput = String(nData); var sDecimalSeparator = opts.decimalSeparator || &quot;.&quot;; var nDotIndex; if($.fmatter.isNumber(opts.decimalPlaces)) { // Round to the correct decimal place var nDecimalPlaces = opts.decimalPlaces; var nDecimal = Math.pow(10, nDecimalPlaces); sOutput = String(Math.round(nData*nDecimal)/nDecimal); nDotIndex = sOutput.lastIndexOf(&quot;.&quot;); if(nDecimalPlaces &gt; 0) { // Add the decimal separator if(nDotIndex &lt; 0) { sOutput += sDecimalSeparator; nDotIndex = sOutput.length-1; } // Replace the &quot;.&quot; else if(sDecimalSeparator !== &quot;.&quot;){ sOutput = sOutput.replace(&quot;.&quot;,sDecimalSeparator); } // Add missing zeros while((sOutput.length - 1 - nDotIndex) &lt; nDecimalPlaces) { sOutput += &quot;0&quot;; } } } if(opts.thousandsSeparator) { var sThousandsSeparator = opts.thousandsSeparator; nDotIndex = sOutput.lastIndexOf(sDecimalSeparator); nDotIndex = (nDotIndex &gt; -1) ? nDotIndex : sOutput.length; var sNewOutput = sOutput.substring(nDotIndex); var nCount = -1, i; for (i=nDotIndex; i&gt;0; i--) { nCount++; if ((nCount%3 === 0) &amp;&amp; (i !== nDotIndex) &amp;&amp; (!bNegative || (i &gt; 1))) { sNewOutput = sThousandsSeparator + sNewOutput; } sNewOutput = sOutput.charAt(i-1) + sNewOutput; } sOutput = sNewOutput; } // Prepend prefix sOutput = (opts.prefix) ? opts.prefix + sOutput : sOutput; // Append suffix sOutput = (opts.suffix) ? sOutput + opts.suffix : sOutput; return sOutput; } return nData; }, // Tony Tomov // PHP implementation. Sorry not all options are supported. // Feel free to add them if you want DateFormat : function (format, date, newformat, opts) { var token = /\\\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g, timezone = /\\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\\d{4})?)\\b/g, timezoneClip = /[^-+\\dA-Z]/g, msDateRegExp = new RegExp(&quot;^\\/Date\\\\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\\\\)\\/$&quot;), msMatch = ((typeof date === 'string') ? date.match(msDateRegExp): null), pad = function (value, length) { value = String(value); length = parseInt(length,10) || 2; while (value.length &lt; length) { value = '0' + value; } return value; }, ts = {m : 1, d : 1, y : 1970, h : 0, i : 0, s : 0, u:0}, timestamp=0, dM, k,hl, dateFormat=[&quot;i18n&quot;]; // Internationalization strings dateFormat.i18n = { dayNames: opts.dayNames, monthNames: opts.monthNames }; if( opts.masks.hasOwnProperty(format) ) { format = opts.masks[format]; } if( !isNaN( date - 0 ) &amp;&amp; String(format).toLowerCase() == &quot;u&quot;) { //Unix timestamp timestamp = new Date( parseFloat(date)*1000 ); } else if(date.constructor === Date) { timestamp = date; // Microsoft date format support } else if( msMatch !== null ) { timestamp = new Date(parseInt(msMatch[1], 10)); if (msMatch[3]) { var offset = Number(msMatch[5]) * 60 + Number(msMatch[6]); offset *= ((msMatch[4] == '-') ? 1 : -1); offset -= timestamp.getTimezoneOffset(); timestamp.setTime(Number(Number(timestamp) + (offset * 60 * 1000))); } } else { date = String(date).split(/[\\\\\\/:_;.,\\t\\T\\s-]/); format = format.split(/[\\\\\\/:_;.,\\t\\T\\s-]/); // parsing for month names for(k=0,hl=format.length;k&lt;hl;k++){ if(format[k] == 'M') { dM = $.inArray(date[k],dateFormat.i18n.monthNames); if(dM !== -1 &amp;&amp; dM &lt; 12){date[k] = dM+1;} } if(format[k] == 'F') { dM = $.inArray(date[k],dateFormat.i18n.monthNames); if(dM !== -1 &amp;&amp; dM &gt; 11){date[k] = dM+1-12;} } if(date[k]) { ts[format[k].toLowerCase()] = parseInt(date[k],10); } } if(ts.f) {ts.m = ts.f;} if( ts.m === 0 &amp;&amp; ts.y === 0 &amp;&amp; ts.d === 0) { return &quot;&amp;#160;&quot; ; } ts.m = parseInt(ts.m,10)-1; var ty = ts.y; if (ty &gt;= 70 &amp;&amp; ty &lt;= 99) {ts.y = 1900+ts.y;} else if (ty &gt;=0 &amp;&amp; ty &lt;=69) {ts.y= 2000+ts.y;} timestamp = new Date(ts.y, ts.m, ts.d, ts.h, ts.i, ts.s, ts.u); } if( opts.masks.hasOwnProperty(newformat) ) { newformat = opts.masks[newformat]; } else if ( !newformat ) { newformat = 'Y-m-d'; } var G = timestamp.getHours(), i = timestamp.getMinutes(), j = timestamp.getDate(), n = timestamp.getMonth() + 1, o = timestamp.getTimezoneOffset(), s = timestamp.getSeconds(), u = timestamp.getMilliseconds(), w = timestamp.getDay(), Y = timestamp.getFullYear(), N = (w + 6) % 7 + 1, z = (new Date(Y, n - 1, j) - new Date(Y, 0, 1)) / 86400000, flags = { // Day d: pad(j), D: dateFormat.i18n.dayNames[w], j: j, l: dateFormat.i18n.dayNames[w + 7], N: N, S: opts.S(j), //j &lt; 11 || j &gt; 13 ? ['st', 'nd', 'rd', 'th'][Math.min((j - 1) % 10, 3)] : 'th', w: w, z: z, // Week W: N &lt; 5 ? Math.floor((z + N - 1) / 7) + 1 : Math.floor((z + N - 1) / 7) || ((new Date(Y - 1, 0, 1).getDay() + 6) % 7 &lt; 4 ? 53 : 52), // Month F: dateFormat.i18n.monthNames[n - 1 + 12], m: pad(n), M: dateFormat.i18n.monthNames[n - 1], n: n, t: '?', // Year L: '?', o: '?', Y: Y, y: String(Y).substring(2), // Time a: G &lt; 12 ? opts.AmPm[0] : opts.AmPm[1], A: G &lt; 12 ? opts.AmPm[2] : opts.AmPm[3], B: '?', g: G % 12 || 12, G: G, h: pad(G % 12 || 12), H: pad(G), i: pad(i), s: pad(s), u: u, // Timezone e: '?', I: '?', O: (o &gt; 0 ? &quot;-&quot; : &quot;+&quot;) + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4), P: '?', T: (String(timestamp).match(timezone) || [&quot;&quot;]).pop().replace(timezoneClip, &quot;&quot;), Z: '?', // Full Date/Time c: '?', r: '?', U: Math.floor(timestamp / 1000) }; return newformat.replace(token, function ($0) { return flags.hasOwnProperty($0) ? flags[$0] : $0.substring(1); }); } }; $.fn.fmatter.defaultFormat = function(cellval, opts) { return ($.fmatter.isValue(cellval) &amp;&amp; cellval!==&quot;&quot; ) ? cellval : opts.defaultValue || &quot;&amp;#160;&quot;; }; $.fn.fmatter.email = function(cellval, opts) { if(!$.fmatter.isEmpty(cellval)) { return &quot;&lt;a href=\\&quot;mailto:&quot; + cellval + &quot;\\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;; } return $.fn.fmatter.defaultFormat(cellval,opts ); }; $.fn.fmatter.checkbox =function(cval, opts) { var op = $.extend({},opts.checkbox), ds; if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(op.disabled===true) {ds = &quot;disabled=\\&quot;disabled\\&quot;&quot;;} else {ds=&quot;&quot;;} if($.fmatter.isEmpty(cval) || $.fmatter.isUndefined(cval) ) {cval = $.fn.fmatter.defaultFormat(cval,op);} cval=String(cval); cval=cval.toLowerCase(); var bchk = cval.search(/(false|0|no|n|off)/i)&lt;0 ? &quot; checked='checked' &quot; : &quot;&quot;; return &quot;&lt;input type=\\&quot;checkbox\\&quot; &quot; + bchk + &quot; value=\\&quot;&quot;+ cval+&quot;\\&quot; offval=\\&quot;no\\&quot; &quot;+ds+ &quot;/&gt;&quot;; }; $.fn.fmatter.link = function(cellval, opts) { var op = {target:opts.target}; var target = &quot;&quot;; if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(op.target) {target = 'target=' + op.target;} if(!$.fmatter.isEmpty(cellval)) { return &quot;&lt;a &quot;+target+&quot; href=\\&quot;&quot; + cellval + &quot;\\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;; } return $.fn.fmatter.defaultFormat(cellval,opts); }; $.fn.fmatter.showlink = function(cellval, opts) { var op = {baseLinkUrl: opts.baseLinkUrl,showAction:opts.showAction, addParam: opts.addParam || &quot;&quot;, target: opts.target, idName: opts.idName}, target = &quot;&quot;, idUrl; if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(op.target) {target = 'target=' + op.target;} idUrl = op.baseLinkUrl+op.showAction + '?'+ op.idName+'='+opts.rowId+op.addParam; if($.fmatter.isString(cellval) || $.fmatter.isNumber(cellval)) { //add this one even if its blank string return &quot;&lt;a &quot;+target+&quot; href=\\&quot;&quot; + idUrl + &quot;\\&quot;&gt;&quot; + cellval + &quot;&lt;/a&gt;&quot;; } return $.fn.fmatter.defaultFormat(cellval,opts); }; $.fn.fmatter.integer = function(cellval, opts) { var op = $.extend({},opts.integer); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if($.fmatter.isEmpty(cellval)) { return op.defaultValue; } return $.fmatter.util.NumberFormat(cellval,op); }; $.fn.fmatter.number = function (cellval, opts) { var op = $.extend({},opts.number); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if($.fmatter.isEmpty(cellval)) { return op.defaultValue; } return $.fmatter.util.NumberFormat(cellval,op); }; $.fn.fmatter.currency = function (cellval, opts) { var op = $.extend({},opts.currency); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if($.fmatter.isEmpty(cellval)) { return op.defaultValue; } return $.fmatter.util.NumberFormat(cellval,op); }; $.fn.fmatter.date = function (cellval, opts, rwd, act) { var op = $.extend({},opts.date); if(opts.colModel !== undefined &amp;&amp; !$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend({},op,opts.colModel.formatoptions); } if(!op.reformatAfterEdit &amp;&amp; act=='edit'){ return $.fn.fmatter.defaultFormat(cellval, opts); } if(!$.fmatter.isEmpty(cellval)) { return $.fmatter.util.DateFormat(op.srcformat,cellval,op.newformat,op); } return $.fn.fmatter.defaultFormat(cellval, opts); }; $.fn.fmatter.select = function (cellval,opts) { // jqGrid specific cellval = String(cellval); var oSelect = false, ret=[], sep, delim; if(!$.fmatter.isUndefined(opts.colModel.formatoptions)){ oSelect= opts.colModel.formatoptions.value; sep = opts.colModel.formatoptions.separator === undefined ? &quot;:&quot; : opts.colModel.formatoptions.separator; delim = opts.colModel.formatoptions.delimiter === undefined ? &quot;;&quot; : opts.colModel.formatoptions.delimiter; } else if(!$.fmatter.isUndefined(opts.colModel.editoptions)){ oSelect= opts.colModel.editoptions.value; sep = opts.colModel.editoptions.separator === undefined ? &quot;:&quot; : opts.colModel.editoptions.separator; delim = opts.colModel.editoptions.delimiter === undefined ? &quot;;&quot; : opts.colModel.editoptions.delimiter; } if (oSelect) { var msl = opts.colModel.editoptions.multiple === true ? true : false, scell = [], sv; if(msl) {scell = cellval.split(&quot;,&quot;);scell = $.map(scell,function(n){return $.trim(n);});} if ($.fmatter.isString(oSelect)) { // mybe here we can use some caching with care ???? var so = oSelect.split(delim), j=0, i; for(i=0; i&lt;so.length;i++){ sv = so[i].split(sep); if(sv.length &gt; 2 ) { sv[1] = $.map(sv,function(n,i){if(i&gt;0) {return n;}}).join(sep); } if(msl) { if($.inArray(sv[0],scell)&gt;-1) { ret[j] = sv[1]; j++; } } else if($.trim(sv[0])==$.trim(cellval)) { ret[0] = sv[1]; break; } } } else if($.fmatter.isObject(oSelect)) { // this is quicker if(msl) { ret = $.map(scell, function(n){ return oSelect[n]; }); } else { ret[0] = oSelect[cellval] || &quot;&quot;; } } } cellval = ret.join(&quot;, &quot;); return cellval === &quot;&quot; ? $.fn.fmatter.defaultFormat(cellval,opts) : cellval; }; $.fn.fmatter.rowactions = function(act) { var $tr = $(this).closest(&quot;tr.jqgrow&quot;), $actionsDiv = $(this).parent(), rid = $tr.attr(&quot;id&quot;), $grid = $(this).closest(&quot;table.ui-jqgrid-btable&quot;), $t = $grid[0], p = $t.p, cm = p.colModel[$.jgrid.getCellIndex(this)], op = { keys: false, onEdit: null, onSuccess: null, afterSave: null, onError: null, afterRestore: null, extraparam: {}, url: null, restoreAfterError: true, mtype: &quot;POST&quot;, delOptions: {}, editOptions: {} }, saverow = function(rowid, res) { if($.isFunction(op.afterSave)) { op.afterSave.call($t, rowid, res); } $actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show(); $actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide(); }, restorerow = function(rowid) { if($.isFunction(op.afterRestore)) { op.afterRestore.call($t, rowid); } $actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show(); $actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide(); }; if (!$.fmatter.isUndefined(cm.formatoptions)) { op = $.extend(op,cm.formatoptions); } if (!$.fmatter.isUndefined(p.editOptions)) { op.editOptions = p.editOptions; } if (!$.fmatter.isUndefined(p.delOptions)) { op.delOptions = p.delOptions; } if ($tr.hasClass(&quot;jqgrid-new-row&quot;)){ op.extraparam[p.prmNames.oper] = p.prmNames.addoper; } var actop = { keys: op.keys, oneditfunc: op.onEdit, successfunc: op.onSuccess, url: op.url, extraparam: op.extraparam, aftersavefunc: saverow, errorfunc: op.onError, afterrestorefunc: restorerow, restoreAfterError: op.restoreAfterError, mtype: op.mtype }; switch(act) { case 'edit': $grid.jqGrid('editRow', rid, actop); $actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).hide(); $actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).show(); $grid.triggerHandler(&quot;jqGridAfterGridComplete&quot;); break; case 'save': if ($grid.jqGrid('saveRow', rid, actop)) { $actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show(); $actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide(); $grid.triggerHandler(&quot;jqGridAfterGridComplete&quot;); } break; case 'cancel' : $grid.jqGrid('restoreRow', rid, restorerow); $actionsDiv.find(&quot;div.ui-inline-edit,div.ui-inline-del&quot;).show(); $actionsDiv.find(&quot;div.ui-inline-save,div.ui-inline-cancel&quot;).hide(); $grid.triggerHandler(&quot;jqGridAfterGridComplete&quot;); break; case 'del': $grid.jqGrid('delGridRow', rid, op.delOptions); break; case 'formedit': $grid.jqGrid('setSelection', rid); $grid.jqGrid('editGridRow', rid, op.editOptions); break; } }; $.fn.fmatter.actions = function(cellval,opts) { var op={keys:false, editbutton:true, delbutton:true, editformbutton: false}, rowid=opts.rowId, str=&quot;&quot;,ocl; if(!$.fmatter.isUndefined(opts.colModel.formatoptions)) { op = $.extend(op,opts.colModel.formatoptions); } if(rowid === undefined || $.fmatter.isEmpty(rowid)) {return &quot;&quot;;} if(op.editformbutton){ ocl = &quot;onclick=jQuery.fn.fmatter.rowactions.call(this,'formedit'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str += &quot;&lt;div title='&quot;+$.jgrid.nav.edittitle+&quot;' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-pencil'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; } else if(op.editbutton){ ocl = &quot;onclick=jQuery.fn.fmatter.rowactions.call(this,'edit'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover') &quot;; str += &quot;&lt;div title='&quot;+$.jgrid.nav.edittitle+&quot;' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-pencil'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; } if(op.delbutton) { ocl = &quot;onclick=jQuery.fn.fmatter.rowactions.call(this,'del'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str += &quot;&lt;div title='&quot;+$.jgrid.nav.deltitle+&quot;' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-trash'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; } ocl = &quot;onclick=jQuery.fn.fmatter.rowactions.call(this,'save'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str += &quot;&lt;div title='&quot;+$.jgrid.edit.bSubmit+&quot;' style='float:left;display:none' class='ui-pg-div ui-inline-save' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-disk'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; ocl = &quot;onclick=jQuery.fn.fmatter.rowactions.call(this,'cancel'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); &quot;; str += &quot;&lt;div title='&quot;+$.jgrid.edit.bCancel+&quot;' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel' &quot;+ocl+&quot;&gt;&lt;span class='ui-icon ui-icon-cancel'&gt;&lt;/span&gt;&lt;/div&gt;&quot;; return &quot;&lt;div style='margin-left:8px;'&gt;&quot; + str + &quot;&lt;/div&gt;&quot;; }; $.unformat = function (cellval,options,pos,cnt) { // specific for jqGrid only var ret, formatType = options.colModel.formatter, op =options.colModel.formatoptions || {}, sep, re = /([\\.\\*\\_\\'\\(\\)\\{\\}\\+\\?\\\\])/g, unformatFunc = options.colModel.unformat||($.fn.fmatter[formatType] &amp;&amp; $.fn.fmatter[formatType].unformat); if(unformatFunc !== undefined &amp;&amp; $.isFunction(unformatFunc) ) { ret = unformatFunc.call(this, $(cellval).text(), options, cellval); } else if(!$.fmatter.isUndefined(formatType) &amp;&amp; $.fmatter.isString(formatType) ) { var opts = $.jgrid.formatter || {}, stripTag; switch(formatType) { case 'integer' : op = $.extend({},opts.integer,op); sep = op.thousandsSeparator.replace(re,&quot;\\\\$1&quot;); stripTag = new RegExp(sep, &quot;g&quot;); ret = $(cellval).text().replace(stripTag,''); break; case 'number' : op = $.extend({},opts.number,op); sep = op.thousandsSeparator.replace(re,&quot;\\\\$1&quot;); stripTag = new RegExp(sep, &quot;g&quot;); ret = $(cellval).text().replace(stripTag,&quot;&quot;).replace(op.decimalSeparator,'.'); break; case 'currency': op = $.extend({},opts.currency,op); sep = op.thousandsSeparator.replace(re,&quot;\\\\$1&quot;); stripTag = new RegExp(sep, &quot;g&quot;); ret = $(cellval).text(); if (op.prefix &amp;&amp; op.prefix.length) { ret = ret.substr(op.prefix.length); } if (op.suffix &amp;&amp; op.suffix.length) { ret = ret.substr(0, ret.length - op.suffix.length); } ret = ret.replace(stripTag,'').replace(op.decimalSeparator,'.'); break; case 'checkbox': var cbv = (options.colModel.editoptions) ? options.colModel.editoptions.value.split(&quot;:&quot;) : [&quot;Yes&quot;,&quot;No&quot;]; ret = $('input',cellval).is(&quot;:checked&quot;) ? cbv[0] : cbv[1]; break; case 'select' : ret = $.unformat.select(cellval,options,pos,cnt); break; case 'actions': return &quot;&quot;; default: ret= $(cellval).text(); } } return ret !== undefined ? ret : cnt===true ? $(cellval).text() : $.jgrid.htmlDecode($(cellval).html()); }; $.unformat.select = function (cellval,options,pos,cnt) { // Spacial case when we have local data and perform a sort // cnt is set to true only in sortDataArray var ret = []; var cell = $(cellval).text(); if(cnt===true) {return cell;} var op = $.extend({}, !$.fmatter.isUndefined(options.colModel.formatoptions) ? options.colModel.formatoptions: options.colModel.editoptions), sep = op.separator === undefined ? &quot;:&quot; : op.separator, delim = op.delimiter === undefined ? &quot;;&quot; : op.delimiter; if(op.value){ var oSelect = op.value, msl = op.multiple === true ? true : false, scell = [], sv; if(msl) {scell = cell.split(&quot;,&quot;);scell = $.map(scell,function(n){return $.trim(n);});} if ($.fmatter.isString(oSelect)) { var so = oSelect.split(delim), j=0, i; for(i=0; i&lt;so.length;i++){ sv = so[i].split(sep); if(sv.length &gt; 2 ) { sv[1] = $.map(sv,function(n,i){if(i&gt;0) {return n;}}).join(sep); } if(msl) { if($.inArray(sv[1],scell)&gt;-1) { ret[j] = sv[0]; j++; } } else if($.trim(sv[1])==$.trim(cell)) { ret[0] = sv[0]; break; } } } else if($.fmatter.isObject(oSelect) || $.isArray(oSelect) ){ if(!msl) {scell[0] = cell;} ret = $.map(scell, function(n){ var rv; $.each(oSelect, function(i,val){ if (val == n) { rv = i; return false; } }); if( rv !== undefined ) {return rv;} }); } return ret.join(&quot;, &quot;); } return cell || &quot;&quot;; }; $.unformat.date = function (cellval, opts) { var op = $.jgrid.formatter.date || {}; if(!$.fmatter.isUndefined(opts.formatoptions)) { op = $.extend({},op,opts.formatoptions); } if(!$.fmatter.isEmpty(cellval)) { return $.fmatter.util.DateFormat(op.newformat,cellval,op.srcformat,op); } return $.fn.fmatter.defaultFormat(cellval, opts); }; })(jQuery); /*jshint eqeqeq:false */ /*global jQuery */ (function($){ /* * jqGrid common function * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html */ &quot;use strict&quot;; $.extend($.jgrid,{ // Modal functions showModal : function(h) { h.w.show(); }, closeModal : function(h) { h.w.hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;); if(h.o) {h.o.remove();} }, hideModal : function (selector,o) { o = $.extend({jqm : true, gb :''}, o || {}); if(o.onClose) { var oncret = o.gb &amp;&amp; typeof o.gb === &quot;string&quot; &amp;&amp; o.gb.substr(0,6) === &quot;#gbox_&quot; ? o.onClose.call($(&quot;#&quot; + o.gb.substr(6))[0], selector) : o.onClose(selector); if (typeof oncret === 'boolean' &amp;&amp; !oncret ) { return; } } if ($.fn.jqm &amp;&amp; o.jqm === true) { $(selector).attr(&quot;aria-hidden&quot;,&quot;true&quot;).jqmHide(); } else { if(o.gb !== '') { try {$(&quot;.jqgrid-overlay:first&quot;,o.gb).hide();} catch (e){} } $(selector).hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;); } }, //Helper functions findPos : function(obj) { var curleft = 0, curtop = 0; if (obj.offsetParent) { do { curleft += obj.offsetLeft; curtop += obj.offsetTop; } while (obj = obj.offsetParent); //do not change obj == obj.offsetParent } return [curleft,curtop]; }, createModal : function(aIDs, content, p, insertSelector, posSelector, appendsel, css) { p = $.extend(true, {}, $.jgrid.jqModal || {}, p); var mw = document.createElement('div'), rtlsup, self = this; css = $.extend({}, css || {}); rtlsup = $(p.gbox).attr(&quot;dir&quot;) == &quot;rtl&quot; ? true : false; mw.className= &quot;ui-widget ui-widget-content ui-corner-all ui-jqdialog&quot;; mw.id = aIDs.themodal; var mh = document.createElement('div'); mh.className = &quot;ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix&quot;; mh.id = aIDs.modalhead; $(mh).append(&quot;&lt;span class='ui-jqdialog-title'&gt;&quot;+p.caption+&quot;&lt;/span&gt;&quot;); var ahr= $(&quot;&lt;a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'&gt;&lt;/a&gt;&quot;) .hover(function(){ahr.addClass('ui-state-hover');}, function(){ahr.removeClass('ui-state-hover');}) .append(&quot;&lt;span class='ui-icon ui-icon-closethick'&gt;&lt;/span&gt;&quot;); $(mh).append(ahr); if(rtlsup) { mw.dir = &quot;rtl&quot;; $(&quot;.ui-jqdialog-title&quot;,mh).css(&quot;float&quot;,&quot;right&quot;); $(&quot;.ui-jqdialog-titlebar-close&quot;,mh).css(&quot;left&quot;,0.3+&quot;em&quot;); } else { mw.dir = &quot;ltr&quot;; $(&quot;.ui-jqdialog-title&quot;,mh).css(&quot;float&quot;,&quot;left&quot;); $(&quot;.ui-jqdialog-titlebar-close&quot;,mh).css(&quot;right&quot;,0.3+&quot;em&quot;); } var mc = document.createElement('div'); $(mc).addClass(&quot;ui-jqdialog-content ui-widget-content&quot;).attr(&quot;id&quot;,aIDs.modalcontent); $(mc).append(content); mw.appendChild(mc); $(mw).prepend(mh); if(appendsel===true) { $('body').append(mw); } //append as first child in body -for alert dialog else if (typeof appendsel === &quot;string&quot;) { $(appendsel).append(mw); } else {$(mw).insertBefore(insertSelector);} $(mw).css(css); if(p.jqModal === undefined) {p.jqModal = true;} // internal use var coord = {}; if ( $.fn.jqm &amp;&amp; p.jqModal === true) { if(p.left ===0 &amp;&amp; p.top===0 &amp;&amp; p.overlay) { var pos = []; pos = $.jgrid.findPos(posSelector); p.left = pos[0] + 4; p.top = pos[1] + 4; } coord.top = p.top+&quot;px&quot;; coord.left = p.left; } else if(p.left !==0 || p.top!==0) { coord.left = p.left; coord.top = p.top+&quot;px&quot;; } $(&quot;a.ui-jqdialog-titlebar-close&quot;,mh).click(function(){ var oncm = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;onClose&quot;) || p.onClose; var gboxclose = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;gbox&quot;) || p.gbox; self.hideModal(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal),{gb:gboxclose,jqm:p.jqModal,onClose:oncm}); return false; }); if (p.width === 0 || !p.width) {p.width = 300;} if(p.height === 0 || !p.height) {p.height =200;} if(!p.zIndex) { var parentZ = $(insertSelector).parents(&quot;*[role=dialog]&quot;).filter(':first').css(&quot;z-index&quot;); if(parentZ) { p.zIndex = parseInt(parentZ,10)+2; } else { p.zIndex = 950; } } var rtlt = 0; if( rtlsup &amp;&amp; coord.left &amp;&amp; !appendsel) { rtlt = $(p.gbox).width()- (!isNaN(p.width) ? parseInt(p.width,10) :0) - 8; // to do // just in case coord.left = parseInt(coord.left,10) + parseInt(rtlt,10); } if(coord.left) { coord.left += &quot;px&quot;; } $(mw).css($.extend({ width: isNaN(p.width) ? &quot;auto&quot;: p.width+&quot;px&quot;, height:isNaN(p.height) ? &quot;auto&quot; : p.height + &quot;px&quot;, zIndex:p.zIndex, overflow: 'hidden' },coord)) .attr({tabIndex: &quot;-1&quot;,&quot;role&quot;:&quot;dialog&quot;,&quot;aria-labelledby&quot;:aIDs.modalhead,&quot;aria-hidden&quot;:&quot;true&quot;}); if(p.drag === undefined) { p.drag=true;} if(p.resize === undefined) {p.resize=true;} if (p.drag) { $(mh).css('cursor','move'); if($.fn.jqDrag) { $(mw).jqDrag(mh); } else { try { $(mw).draggable({handle: $(&quot;#&quot;+$.jgrid.jqID(mh.id))}); } catch (e) {} } } if(p.resize) { if($.fn.jqResize) { $(mw).append(&quot;&lt;div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se'&gt;&lt;/div&gt;&quot;); $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).jqResize(&quot;.jqResize&quot;,aIDs.scrollelm ? &quot;#&quot;+$.jgrid.jqID(aIDs.scrollelm) : false); } else { try { $(mw).resizable({handles: 'se, sw',alsoResize: aIDs.scrollelm ? &quot;#&quot;+$.jgrid.jqID(aIDs.scrollelm) : false}); } catch (r) {} } } if(p.closeOnEscape === true){ $(mw).keydown( function( e ) { if( e.which == 27 ) { var cone = $(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal)).data(&quot;onClose&quot;) || p.onClose; self.hideModal(&quot;#&quot;+$.jgrid.jqID(aIDs.themodal),{gb:p.gbox,jqm:p.jqModal,onClose: cone}); } }); } }, viewModal : function (selector,o){ o = $.extend({ toTop: true, overlay: 10, modal: false, overlayClass : 'ui-widget-overlay', onShow: $.jgrid.showModal, onHide: $.jgrid.closeModal, gbox: '', jqm : true, jqM : true }, o || {}); if ($.fn.jqm &amp;&amp; o.jqm === true) { if(o.jqM) { $(selector).attr(&quot;aria-hidden&quot;,&quot;false&quot;).jqm(o).jqmShow(); } else {$(selector).attr(&quot;aria-hidden&quot;,&quot;false&quot;).jqmShow();} } else { if(o.gbox !== '') { $(&quot;.jqgrid-overlay:first&quot;,o.gbox).show(); $(selector).data(&quot;gbox&quot;,o.gbox); } $(selector).show().attr(&quot;aria-hidden&quot;,&quot;false&quot;); try{$(':input:visible',selector)[0].focus();}catch(_){} } }, info_dialog : function(caption, content,c_b, modalopt) { var mopt = { width:290, height:'auto', dataheight: 'auto', drag: true, resize: false, left:250, top:170, zIndex : 1000, jqModal : true, modal : false, closeOnEscape : true, align: 'center', buttonalign : 'center', buttons : [] // {text:'textbutt', id:&quot;buttid&quot;, onClick : function(){...}} // if the id is not provided we set it like info_button_+ the index in the array - i.e info_button_0,info_button_1... }; $.extend(true, mopt, $.jgrid.jqModal || {}, {caption:&quot;&lt;b&gt;&quot;+caption+&quot;&lt;/b&gt;&quot;}, modalopt || {}); var jm = mopt.jqModal, self = this; if($.fn.jqm &amp;&amp; !jm) { jm = false; } // in case there is no jqModal var buttstr =&quot;&quot;, i; if(mopt.buttons.length &gt; 0) { for(i=0;i&lt;mopt.buttons.length;i++) { if(mopt.buttons[i].id === undefined) { mopt.buttons[i].id = &quot;info_button_&quot;+i; } buttstr += &quot;&lt;a href='javascript:void(0)' id='&quot;+mopt.buttons[i].id+&quot;' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+mopt.buttons[i].text+&quot;&lt;/a&gt;&quot;; } } var dh = isNaN(mopt.dataheight) ? mopt.dataheight : mopt.dataheight+&quot;px&quot;, cn = &quot;text-align:&quot;+mopt.align+&quot;;&quot;; var cnt = &quot;&lt;div id='info_id'&gt;&quot;; cnt += &quot;&lt;div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:&quot;+dh+&quot;;&quot;+cn+&quot;'&gt;&quot;+content+&quot;&lt;/div&gt;&quot;; cnt += c_b ? &quot;&lt;div class='ui-widget-content ui-helper-clearfix' style='text-align:&quot;+mopt.buttonalign+&quot;;padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'&gt;&lt;a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+c_b+&quot;&lt;/a&gt;&quot;+buttstr+&quot;&lt;/div&gt;&quot; : buttstr !== &quot;&quot; ? &quot;&lt;div class='ui-widget-content ui-helper-clearfix' style='text-align:&quot;+mopt.buttonalign+&quot;;padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'&gt;&quot;+buttstr+&quot;&lt;/div&gt;&quot; : &quot;&quot;; cnt += &quot;&lt;/div&gt;&quot;; try { if($(&quot;#info_dialog&quot;).attr(&quot;aria-hidden&quot;) == &quot;false&quot;) { $.jgrid.hideModal(&quot;#info_dialog&quot;,{jqm:jm}); } $(&quot;#info_dialog&quot;).remove(); } catch (e){} $.jgrid.createModal({ themodal:'info_dialog', modalhead:'info_head', modalcontent:'info_content', scrollelm: 'infocnt'}, cnt, mopt, '','',true ); // attach onclick after inserting into the dom if(buttstr) { $.each(mopt.buttons,function(i){ $(&quot;#&quot;+$.jgrid.jqID(this.id),&quot;#info_id&quot;).bind('click',function(){mopt.buttons[i].onClick.call($(&quot;#info_dialog&quot;)); return false;}); }); } $(&quot;#closedialog&quot;, &quot;#info_id&quot;).click(function(){ self.hideModal(&quot;#info_dialog&quot;,{jqm:jm}); return false; }); $(&quot;.fm-button&quot;,&quot;#info_dialog&quot;).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); if($.isFunction(mopt.beforeOpen) ) { mopt.beforeOpen(); } $.jgrid.viewModal(&quot;#info_dialog&quot;,{ onHide: function(h) { h.w.hide().remove(); if(h.o) { h.o.remove(); } }, modal :mopt.modal, jqm:jm }); if($.isFunction(mopt.afterOpen) ) { mopt.afterOpen(); } try{ $(&quot;#info_dialog&quot;).focus();} catch (m){} }, bindEv: function (el, opt, $t) { if($.isFunction(opt.dataInit)) { opt.dataInit.call($t,el); } if(opt.dataEvents) { $.each(opt.dataEvents, function() { if (this.data !== undefined) { $(el).bind(this.type, this.data, this.fn); } else { $(el).bind(this.type, this.fn); } }); } }, // Form Functions createEl : function(eltype,options,vl,autowidth, ajaxso) { var elem = &quot;&quot;, $t = this; function setAttributes(elm, atr, exl ) { var exclude = ['dataInit','dataEvents','dataUrl', 'buildSelect','sopt', 'searchhidden', 'defaultValue', 'attr', 'custom_element', 'custom_value']; if(exl !== undefined &amp;&amp; $.isArray(exl)) { $.merge(exclude, exl); } $.each(atr, function(key, value){ if($.inArray(key, exclude) === -1) { $(elm).attr(key,value); } }); if(!atr.hasOwnProperty('id')) { $(elm).attr('id', $.jgrid.randId()); } } switch (eltype) { case &quot;textarea&quot; : elem = document.createElement(&quot;textarea&quot;); if(autowidth) { if(!options.cols) { $(elem).css({width:&quot;98%&quot;});} } else if (!options.cols) { options.cols = 20; } if(!options.rows) { options.rows = 2; } if(vl=='&amp;nbsp;' || vl=='&amp;#160;' || (vl.length==1 &amp;&amp; vl.charCodeAt(0)==160)) {vl=&quot;&quot;;} elem.value = vl; setAttributes(elem, options); $(elem).attr({&quot;role&quot;:&quot;textbox&quot;,&quot;multiline&quot;:&quot;true&quot;}); break; case &quot;checkbox&quot; : //what code for simple checkbox elem = document.createElement(&quot;input&quot;); elem.type = &quot;checkbox&quot;; if( !options.value ) { var vl1 = vl.toLowerCase(); if(vl1.search(/(false|0|no|off|undefined)/i)&lt;0 &amp;&amp; vl1!==&quot;&quot;) { elem.checked=true; elem.defaultChecked=true; elem.value = vl; } else { elem.value = &quot;on&quot;; } $(elem).attr(&quot;offval&quot;,&quot;off&quot;); } else { var cbval = options.value.split(&quot;:&quot;); if(vl === cbval[0]) { elem.checked=true; elem.defaultChecked=true; } elem.value = cbval[0]; $(elem).attr(&quot;offval&quot;,cbval[1]); } setAttributes(elem, options, ['value']); $(elem).attr(&quot;role&quot;,&quot;checkbox&quot;); break; case &quot;select&quot; : elem = document.createElement(&quot;select&quot;); elem.setAttribute(&quot;role&quot;,&quot;select&quot;); var msl, ovm = []; if(options.multiple===true) { msl = true; elem.multiple=&quot;multiple&quot;; $(elem).attr(&quot;aria-multiselectable&quot;,&quot;true&quot;); } else { msl = false; } if(options.dataUrl !== undefined) { var rowid = options.name ? String(options.id).substring(0, String(options.id).length - String(options.name).length - 1) : String(options.id), postData = options.postData || ajaxso.postData; if ($t.p &amp;&amp; $t.p.idPrefix) { rowid = $.jgrid.stripPref($t.p.idPrefix, rowid); } else { postData = undefined; // don't use postData for searching from jqFilter. One can implement the feature in the future if required. } $.ajax($.extend({ url: options.dataUrl, type : &quot;GET&quot;, dataType: &quot;html&quot;, data: $.isFunction(postData) ? postData.call($t, rowid, vl, String(options.name)) : postData, context: {elem:elem, options:options, vl:vl}, success: function(data){ var a, ovm = [], elem = this.elem, vl = this.vl, options = $.extend({},this.options), msl = options.multiple===true; if($.isFunction(options.buildSelect)) { var b = options.buildSelect.call($t,data); a = $(b).html(); } else { a = $(data).html(); } if(a) { $(elem).append(a); setAttributes(elem, options); if(options.size === undefined) { options.size = msl ? 3 : 1;} if(msl) { ovm = vl.split(&quot;,&quot;); ovm = $.map(ovm,function(n){return $.trim(n);}); } else { ovm[0] = $.trim(vl); } //$(elem).attr(options); setTimeout(function(){ $(&quot;option&quot;,elem).each(function(i){ //if(i===0) { this.selected = &quot;&quot;; } // fix IE8/IE7 problem with selecting of the first item on multiple=true if (i === 0 &amp;&amp; elem.multiple) { this.selected = false; } $(this).attr(&quot;role&quot;,&quot;option&quot;); if($.inArray($.trim($(this).text()),ovm) &gt; -1 || $.inArray($.trim($(this).val()),ovm) &gt; -1 ) { this.selected= &quot;selected&quot;; } }); },0); } } },ajaxso || {})); } else if(options.value) { var i; if(options.size === undefined) { options.size = msl ? 3 : 1; } if(msl) { ovm = vl.split(&quot;,&quot;); ovm = $.map(ovm,function(n){return $.trim(n);}); } if(typeof options.value === 'function') { options.value = options.value(); } var so,sv, ov, sep = options.separator === undefined ? &quot;:&quot; : options.separator, delim = options.delimiter === undefined ? &quot;;&quot; : options.delimiter; if(typeof options.value === 'string') { so = options.value.split(delim); for(i=0; i&lt;so.length;i++){ sv = so[i].split(sep); if(sv.length &gt; 2 ) { sv[1] = $.map(sv,function(n,ii){if(ii&gt;0) { return n;} }).join(sep); } ov = document.createElement(&quot;option&quot;); ov.setAttribute(&quot;role&quot;,&quot;option&quot;); ov.value = sv[0]; ov.innerHTML = sv[1]; elem.appendChild(ov); if (!msl &amp;&amp; ($.trim(sv[0]) == $.trim(vl) || $.trim(sv[1]) == $.trim(vl))) { ov.selected =&quot;selected&quot;; } if (msl &amp;&amp; ($.inArray($.trim(sv[1]), ovm)&gt;-1 || $.inArray($.trim(sv[0]), ovm)&gt;-1)) {ov.selected =&quot;selected&quot;;} } } else if (typeof options.value === 'object') { var oSv = options.value, key; for (key in oSv) { if (oSv.hasOwnProperty(key ) ){ ov = document.createElement(&quot;option&quot;); ov.setAttribute(&quot;role&quot;,&quot;option&quot;); ov.value = key; ov.innerHTML = oSv[key]; elem.appendChild(ov); if (!msl &amp;&amp; ( $.trim(key) == $.trim(vl) || $.trim(oSv[key]) == $.trim(vl)) ) { ov.selected =&quot;selected&quot;; } if (msl &amp;&amp; ($.inArray($.trim(oSv[key]),ovm)&gt;-1 || $.inArray($.trim(key),ovm)&gt;-1)) { ov.selected =&quot;selected&quot;; } } } } setAttributes(elem, options, ['value']); } break; case &quot;text&quot; : case &quot;password&quot; : case &quot;button&quot; : var role; if(eltype==&quot;button&quot;) { role = &quot;button&quot;; } else { role = &quot;textbox&quot;; } elem = document.createElement(&quot;input&quot;); elem.type = eltype; elem.value = vl; setAttributes(elem, options); if(eltype != &quot;button&quot;){ if(autowidth) { if(!options.size) { $(elem).css({width:&quot;98%&quot;}); } } else if (!options.size) { options.size = 20; } } $(elem).attr(&quot;role&quot;,role); break; case &quot;image&quot; : case &quot;file&quot; : elem = document.createElement(&quot;input&quot;); elem.type = eltype; setAttributes(elem, options); break; case &quot;custom&quot; : elem = document.createElement(&quot;span&quot;); try { if($.isFunction(options.custom_element)) { var celm = options.custom_element.call($t,vl,options); if(celm) { celm = $(celm).addClass(&quot;customelement&quot;).attr({id:options.id,name:options.name}); $(elem).empty().append(celm); } else { throw &quot;e2&quot;; } } else { throw &quot;e1&quot;; } } catch (e) { if (e==&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_element' &quot;+$.jgrid.edit.msg.nodefined, $.jgrid.edit.bClose);} if (e==&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_element' &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose);} else { $.jgrid.info_dialog($.jgrid.errors.errcap,typeof e===&quot;string&quot;?e:e.message,$.jgrid.edit.bClose); } } break; } return elem; }, // Date Validation Javascript checkDate : function (format, date) { var daysInFebruary = function(year){ // February has 29 days in any year evenly divisible by four, // EXCEPT for centurial years which are not also divisible by 400. return (((year % 4 === 0) &amp;&amp; ( year % 100 !== 0 || (year % 400 === 0))) ? 29 : 28 ); }, daysArray = function(n) { var i; for (i = 1; i &lt;= n; i++) { this[i] = 31; if (i==4 || i==6 || i==9 || i==11) {this[i] = 30;} if (i==2) {this[i] = 29;} } return this; }; var tsp = {}, sep; format = format.toLowerCase(); //we search for /,-,. for the date separator if(format.indexOf(&quot;/&quot;) != -1) { sep = &quot;/&quot;; } else if(format.indexOf(&quot;-&quot;) != -1) { sep = &quot;-&quot;; } else if(format.indexOf(&quot;.&quot;) != -1) { sep = &quot;.&quot;; } else { sep = &quot;/&quot;; } format = format.split(sep); date = date.split(sep); if (date.length != 3) { return false; } var j=-1,yln, dln=-1, mln=-1, i; for(i=0;i&lt;format.length;i++){ var dv = isNaN(date[i]) ? 0 : parseInt(date[i],10); tsp[format[i]] = dv; yln = format[i]; if(yln.indexOf(&quot;y&quot;) != -1) { j=i; } if(yln.indexOf(&quot;m&quot;) != -1) { mln=i; } if(yln.indexOf(&quot;d&quot;) != -1) { dln=i; } } if (format[j] == &quot;y&quot; || format[j] == &quot;yyyy&quot;) { yln=4; } else if(format[j] ==&quot;yy&quot;){ yln = 2; } else { yln = -1; } var daysInMonth = daysArray(12), strDate; if (j === -1) { return false; } strDate = tsp[format[j]].toString(); if(yln == 2 &amp;&amp; strDate.length == 1) {yln = 1;} if (strDate.length != yln || (tsp[format[j]]===0 &amp;&amp; date[j]!=&quot;00&quot;)){ return false; } if(mln === -1) { return false; } strDate = tsp[format[mln]].toString(); if (strDate.length&lt;1 || tsp[format[mln]]&lt;1 || tsp[format[mln]]&gt;12){ return false; } if(dln === -1) { return false; } strDate = tsp[format[dln]].toString(); if (strDate.length&lt;1 || tsp[format[dln]]&lt;1 || tsp[format[dln]]&gt;31 || (tsp[format[mln]]==2 &amp;&amp; tsp[format[dln]]&gt;daysInFebruary(tsp[format[j]])) || tsp[format[dln]] &gt; daysInMonth[tsp[format[mln]]]){ return false; } return true; }, isEmpty : function(val) { if (val.match(/^\\s+$/) || val === &quot;&quot;) { return true; } return false; }, checkTime : function(time){ // checks only hh:ss (and optional am/pm) var re = /^(\\d{1,2}):(\\d{2})([ap]m)?$/,regs; if(!$.jgrid.isEmpty(time)) { regs = time.match(re); if(regs) { if(regs[3]) { if(regs[1] &lt; 1 || regs[1] &gt; 12) { return false; } } else { if(regs[1] &gt; 23) { return false; } } if(regs[2] &gt; 59) { return false; } } else { return false; } } return true; }, checkValues : function(val, valref,g, customobject, nam) { var edtrul,i, nm, dft, len; if(customobject === undefined) { if(typeof valref==='string'){ for( i =0, len=g.p.colModel.length;i&lt;len; i++){ if(g.p.colModel[i].name==valref) { edtrul = g.p.colModel[i].editrules; valref = i; try { nm = g.p.colModel[i].formoptions.label; } catch (e) {} break; } } } else if(valref &gt;=0) { edtrul = g.p.colModel[valref].editrules; } } else { edtrul = customobject; nm = nam===undefined ? &quot;_&quot; : nam; } if(edtrul) { if(!nm) { nm = g.p.colNames[valref]; } if(edtrul.required === true) { if( $.jgrid.isEmpty(val) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.required,&quot;&quot;]; } } // force required var rqfield = edtrul.required === false ? false : true; if(edtrul.number === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(isNaN(val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.number,&quot;&quot;]; } } } if(edtrul.minValue !== undefined &amp;&amp; !isNaN(edtrul.minValue)) { if (parseFloat(val) &lt; parseFloat(edtrul.minValue) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.minValue+&quot; &quot;+edtrul.minValue,&quot;&quot;];} } if(edtrul.maxValue !== undefined &amp;&amp; !isNaN(edtrul.maxValue)) { if (parseFloat(val) &gt; parseFloat(edtrul.maxValue) ) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.maxValue+&quot; &quot;+edtrul.maxValue,&quot;&quot;];} } var filter; if(edtrul.email === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { // taken from $ Validate plugin filter = /^((([a-z]|\\d|[!#\\$%&amp;'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&amp;'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i; if(!filter.test(val)) {return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.email,&quot;&quot;];} } } if(edtrul.integer === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(isNaN(val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.integer,&quot;&quot;]; } if ((val % 1 !== 0) || (val.indexOf('.') != -1)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.integer,&quot;&quot;];} } } if(edtrul.date === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(g.p.colModel[valref].formatoptions &amp;&amp; g.p.colModel[valref].formatoptions.newformat) { dft = g.p.colModel[valref].formatoptions.newformat; } else { dft = g.p.colModel[valref].datefmt || &quot;Y-m-d&quot;; } if(!$.jgrid.checkDate (dft, val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.date+&quot; - &quot;+dft,&quot;&quot;]; } } } if(edtrul.time === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if(!$.jgrid.checkTime (val)) { return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.date+&quot; - hh:mm (am/pm)&quot;,&quot;&quot;]; } } } if(edtrul.url === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { filter = /^(((https?)|(ftp)):\\/\\/([\\-\\w]+\\.)+\\w{2,3}(\\/[%\\-\\w]+(\\.\\w{2,})?)*(([\\w\\-\\.\\?\\\\\\/+@&amp;#;`~=%!]*)(\\.\\w{2,})?)*\\/?)/i; if(!filter.test(val)) {return [false,nm+&quot;: &quot;+$.jgrid.edit.msg.url,&quot;&quot;];} } } if(edtrul.custom === true) { if( !(rqfield === false &amp;&amp; $.jgrid.isEmpty(val)) ) { if($.isFunction(edtrul.custom_func)) { var ret = edtrul.custom_func.call(g,val,nm); return $.isArray(ret) ? ret : [false,$.jgrid.edit.msg.customarray,&quot;&quot;]; } return [false,$.jgrid.edit.msg.customfcheck,&quot;&quot;]; } } } return [true,&quot;&quot;,&quot;&quot;]; } }); })(jQuery); /* * jqFilter jQuery jqGrid filter addon. * Copyright (c) 2011, Tony Tomov, tony@trirand.com * Dual licensed under the MIT and GPL licenses * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * * The work is inspired from this Stefan Pirvu * http://www.codeproject.com/KB/scripting/json-filtering.aspx * * The filter uses JSON entities to hold filter rules and groups. Here is an example of a filter: { &quot;groupOp&quot;: &quot;AND&quot;, &quot;groups&quot; : [ { &quot;groupOp&quot;: &quot;OR&quot;, &quot;rules&quot;: [ { &quot;field&quot;: &quot;name&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;data&quot;: &quot;England&quot; }, { &quot;field&quot;: &quot;id&quot;, &quot;op&quot;: &quot;le&quot;, &quot;data&quot;: &quot;5&quot;} ] } ], &quot;rules&quot;: [ { &quot;field&quot;: &quot;name&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;data&quot;: &quot;Romania&quot; }, { &quot;field&quot;: &quot;id&quot;, &quot;op&quot;: &quot;le&quot;, &quot;data&quot;: &quot;1&quot;} ] } */ /*jshint eqeqeq:false, eqnull:true, devel:true */ /*global jQuery */ (function ($) { &quot;use strict&quot;; $.fn.jqFilter = function( arg ) { if (typeof arg === 'string') { var fn = $.fn.jqFilter[arg]; if (!fn) { throw (&quot;jqFilter - No such method: &quot; + arg); } var args = $.makeArray(arguments).slice(1); return fn.apply(this,args); } var p = $.extend(true,{ filter: null, columns: [], onChange : null, afterRedraw : null, checkValues : null, error: false, errmsg : &quot;&quot;, errorcheck : true, showQuery : true, sopt : null, ops : [ {&quot;name&quot;: &quot;eq&quot;, &quot;description&quot;: &quot;equal&quot;, &quot;operator&quot;:&quot;=&quot;}, {&quot;name&quot;: &quot;ne&quot;, &quot;description&quot;: &quot;not equal&quot;, &quot;operator&quot;:&quot;&lt;&gt;&quot;}, {&quot;name&quot;: &quot;lt&quot;, &quot;description&quot;: &quot;less&quot;, &quot;operator&quot;:&quot;&lt;&quot;}, {&quot;name&quot;: &quot;le&quot;, &quot;description&quot;: &quot;less or equal&quot;,&quot;operator&quot;:&quot;&lt;=&quot;}, {&quot;name&quot;: &quot;gt&quot;, &quot;description&quot;: &quot;greater&quot;, &quot;operator&quot;:&quot;&gt;&quot;}, {&quot;name&quot;: &quot;ge&quot;, &quot;description&quot;: &quot;greater or equal&quot;, &quot;operator&quot;:&quot;&gt;=&quot;}, {&quot;name&quot;: &quot;bw&quot;, &quot;description&quot;: &quot;begins with&quot;, &quot;operator&quot;:&quot;LIKE&quot;}, {&quot;name&quot;: &quot;bn&quot;, &quot;description&quot;: &quot;does not begin with&quot;, &quot;operator&quot;:&quot;NOT LIKE&quot;}, {&quot;name&quot;: &quot;in&quot;, &quot;description&quot;: &quot;in&quot;, &quot;operator&quot;:&quot;IN&quot;}, {&quot;name&quot;: &quot;ni&quot;, &quot;description&quot;: &quot;not in&quot;, &quot;operator&quot;:&quot;NOT IN&quot;}, {&quot;name&quot;: &quot;ew&quot;, &quot;description&quot;: &quot;ends with&quot;, &quot;operator&quot;:&quot;LIKE&quot;}, {&quot;name&quot;: &quot;en&quot;, &quot;description&quot;: &quot;does not end with&quot;, &quot;operator&quot;:&quot;NOT LIKE&quot;}, {&quot;name&quot;: &quot;cn&quot;, &quot;description&quot;: &quot;contains&quot;, &quot;operator&quot;:&quot;LIKE&quot;}, {&quot;name&quot;: &quot;nc&quot;, &quot;description&quot;: &quot;does not contain&quot;, &quot;operator&quot;:&quot;NOT LIKE&quot;}, {&quot;name&quot;: &quot;nu&quot;, &quot;description&quot;: &quot;is null&quot;, &quot;operator&quot;:&quot;IS NULL&quot;}, {&quot;name&quot;: &quot;nn&quot;, &quot;description&quot;: &quot;is not null&quot;, &quot;operator&quot;:&quot;IS NOT NULL&quot;} ], numopts : ['eq','ne', 'lt', 'le', 'gt', 'ge', 'nu', 'nn', 'in', 'ni'], stropts : ['eq', 'ne', 'bw', 'bn', 'ew', 'en', 'cn', 'nc', 'nu', 'nn', 'in', 'ni'], strarr : ['text', 'string', 'blob'], _gridsopt : [], // grid translated strings, do not tuch groupOps : [{ op: &quot;AND&quot;, text: &quot;AND&quot; }, { op: &quot;OR&quot;, text: &quot;OR&quot; }], groupButton : true, ruleButtons : true, direction : &quot;ltr&quot; }, $.jgrid.filter, arg || {}); return this.each( function() { if (this.filter) {return;} this.p = p; // setup filter in case if they is not defined if (this.p.filter === null || this.p.filter === undefined) { this.p.filter = { groupOp: this.p.groupOps[0].op, rules: [], groups: [] }; } var i, len = this.p.columns.length, cl, isIE = /msie/i.test(navigator.userAgent) &amp;&amp; !window.opera; // translating the options if(this.p._gridsopt.length) { // ['eq','ne','lt','le','gt','ge','bw','bn','in','ni','ew','en','cn','nc'] for(i=0;i&lt;this.p._gridsopt.length;i++) { this.p.ops[i].description = this.p._gridsopt[i]; } } this.p.initFilter = $.extend(true,{},this.p.filter); // set default values for the columns if they are not set if( !len ) {return;} for(i=0; i &lt; len; i++) { cl = this.p.columns[i]; if( cl.stype ) { // grid compatibility cl.inputtype = cl.stype; } else if(!cl.inputtype) { cl.inputtype = 'text'; } if( cl.sorttype ) { // grid compatibility cl.searchtype = cl.sorttype; } else if (!cl.searchtype) { cl.searchtype = 'string'; } if(cl.hidden === undefined) { // jqGrid compatibility cl.hidden = false; } if(!cl.label) { cl.label = cl.name; } if(cl.index) { cl.name = cl.index; } if(!cl.hasOwnProperty('searchoptions')) { cl.searchoptions = {}; } if(!cl.hasOwnProperty('searchrules')) { cl.searchrules = {}; } } if(this.p.showQuery) { $(this).append(&quot;&lt;table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;' dir='&quot;+this.p.direction+&quot;'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class='query'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); } /* *Perform checking. * */ var checkData = function(val, colModelItem) { var ret = [true,&quot;&quot;]; if($.isFunction(colModelItem.searchrules)) { ret = colModelItem.searchrules(val, colModelItem); } else if($.jgrid &amp;&amp; $.jgrid.checkValues) { try { ret = $.jgrid.checkValues(val, -1, null, colModelItem.searchrules, colModelItem.label); } catch (e) {} } if(ret &amp;&amp; ret.length &amp;&amp; ret[0] === false) { p.error = !ret[0]; p.errmsg = ret[1]; } }; /* moving to common randId = function() { return Math.floor(Math.random()*10000).toString(); }; */ this.onchange = function ( ){ // clear any error this.p.error = false; this.p.errmsg=&quot;&quot;; return $.isFunction(this.p.onChange) ? this.p.onChange.call( this, this.p ) : false; }; /* * Redraw the filter every time when new field is added/deleted * and field is changed */ this.reDraw = function() { $(&quot;table.group:first&quot;,this).remove(); var t = this.createTableForGroup(p.filter, null); $(this).append(t); if($.isFunction(this.p.afterRedraw) ) { this.p.afterRedraw.call(this, this.p); } }; /* * Creates a grouping data for the filter * @param group - object * @param parentgroup - object */ this.createTableForGroup = function(group, parentgroup) { var that = this, i; // this table will hold all the group (tables) and rules (rows) var table = $(&quot;&lt;table class='group ui-widget ui-widget-content' style='border:0px none;'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), // create error message row align = &quot;left&quot;; if(this.p.direction == &quot;rtl&quot;) { align = &quot;right&quot;; table.attr(&quot;dir&quot;,&quot;rtl&quot;); } if(parentgroup === null) { table.append(&quot;&lt;tr class='error' style='display:none;'&gt;&lt;th colspan='5' class='ui-state-error' align='&quot;+align+&quot;'&gt;&lt;/th&gt;&lt;/tr&gt;&quot;); } var tr = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); table.append(tr); // this header will hold the group operator type and group action buttons for // creating subgroup &quot;+ {}&quot;, creating rule &quot;+&quot; or deleting the group &quot;-&quot; var th = $(&quot;&lt;th colspan='5' align='&quot;+align+&quot;'&gt;&lt;/th&gt;&quot;); tr.append(th); if(this.p.ruleButtons === true) { // dropdown for: choosing group operator type var groupOpSelect = $(&quot;&lt;select class='opsel'&gt;&lt;/select&gt;&quot;); th.append(groupOpSelect); // populate dropdown with all posible group operators: or, and var str= &quot;&quot;, selected; for (i = 0; i &lt; p.groupOps.length; i++) { selected = group.groupOp === that.p.groupOps[i].op ? &quot; selected='selected'&quot; :&quot;&quot;; str += &quot;&lt;option value='&quot;+that.p.groupOps[i].op+&quot;'&quot; + selected+&quot;&gt;&quot;+that.p.groupOps[i].text+&quot;&lt;/option&gt;&quot;; } groupOpSelect .append(str) .bind('change',function() { group.groupOp = $(groupOpSelect).val(); that.onchange(); // signals that the filter has changed }); } // button for adding a new subgroup var inputAddSubgroup =&quot;&lt;span&gt;&lt;/span&gt;&quot;; if(this.p.groupButton) { inputAddSubgroup = $(&quot;&lt;input type='button' value='+ {}' title='Add subgroup' class='add-group'/&gt;&quot;); inputAddSubgroup.bind('click',function() { if (group.groups === undefined ) { group.groups = []; } group.groups.push({ groupOp: p.groupOps[0].op, rules: [], groups: [] }); // adding a new group that.reDraw(); // the html has changed, force reDraw that.onchange(); // signals that the filter has changed return false; }); } th.append(inputAddSubgroup); if(this.p.ruleButtons === true) { // button for adding a new rule var inputAddRule = $(&quot;&lt;input type='button' value='+' title='Add rule' class='add-rule ui-add'/&gt;&quot;), cm; inputAddRule.bind('click',function() { //if(!group) { group = {};} if (group.rules === undefined) { group.rules = []; } for (i = 0; i &lt; that.p.columns.length; i++) { // but show only serchable and serchhidden = true fields var searchable = (that.p.columns[i].search === undefined) ? true: that.p.columns[i].search , hidden = (that.p.columns[i].hidden === true), ignoreHiding = (that.p.columns[i].searchoptions.searchhidden === true); if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) { cm = that.p.columns[i]; break; } } var opr; if( cm.searchoptions.sopt ) {opr = cm.searchoptions.sopt;} else if(that.p.sopt) { opr= that.p.sopt; } else if ( $.inArray(cm.searchtype, that.p.strarr) !== -1 ) {opr = that.p.stropts;} else {opr = that.p.numopts;} group.rules.push({ field: cm.name, op: opr[0], data: &quot;&quot; }); // adding a new rule that.reDraw(); // the html has changed, force reDraw // for the moment no change have been made to the rule, so // this will not trigger onchange event return false; }); th.append(inputAddRule); } // button for delete the group if (parentgroup !== null) { // ignore the first group var inputDeleteGroup = $(&quot;&lt;input type='button' value='-' title='Delete group' class='delete-group'/&gt;&quot;); th.append(inputDeleteGroup); inputDeleteGroup.bind('click',function() { // remove group from parent for (i = 0; i &lt; parentgroup.groups.length; i++) { if (parentgroup.groups[i] === group) { parentgroup.groups.splice(i, 1); break; } } that.reDraw(); // the html has changed, force reDraw that.onchange(); // signals that the filter has changed return false; }); } // append subgroup rows if (group.groups !== undefined) { for (i = 0; i &lt; group.groups.length; i++) { var trHolderForSubgroup = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); table.append(trHolderForSubgroup); var tdFirstHolderForSubgroup = $(&quot;&lt;td class='first'&gt;&lt;/td&gt;&quot;); trHolderForSubgroup.append(tdFirstHolderForSubgroup); var tdMainHolderForSubgroup = $(&quot;&lt;td colspan='4'&gt;&lt;/td&gt;&quot;); tdMainHolderForSubgroup.append(this.createTableForGroup(group.groups[i], group)); trHolderForSubgroup.append(tdMainHolderForSubgroup); } } if(group.groupOp === undefined) { group.groupOp = that.p.groupOps[0].op; } // append rules rows if (group.rules !== undefined) { for (i = 0; i &lt; group.rules.length; i++) { table.append( this.createTableRowForRule(group.rules[i], group) ); } } return table; }; /* * Create the rule data for the filter */ this.createTableRowForRule = function(rule, group ) { // save current entity in a variable so that it could // be referenced in anonimous method calls var that=this, tr = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;), //document.createElement(&quot;tr&quot;), // first column used for padding //tdFirstHolderForRule = document.createElement(&quot;td&quot;), i, op, trpar, cm, str=&quot;&quot;, selected; //tdFirstHolderForRule.setAttribute(&quot;class&quot;, &quot;first&quot;); tr.append(&quot;&lt;td class='first'&gt;&lt;/td&gt;&quot;); // create field container var ruleFieldTd = $(&quot;&lt;td class='columns'&gt;&lt;/td&gt;&quot;); tr.append(ruleFieldTd); // dropdown for: choosing field var ruleFieldSelect = $(&quot;&lt;select&gt;&lt;/select&gt;&quot;), ina, aoprs = []; ruleFieldTd.append(ruleFieldSelect); ruleFieldSelect.bind('change',function() { rule.field = $(ruleFieldSelect).val(); trpar = $(this).parents(&quot;tr:first&quot;); for (i=0;i&lt;that.p.columns.length;i++) { if(that.p.columns[i].name === rule.field) { cm = that.p.columns[i]; break; } } if(!cm) {return;} cm.searchoptions.id = $.jgrid.randId(); if(isIE &amp;&amp; cm.inputtype === &quot;text&quot;) { if(!cm.searchoptions.size) { cm.searchoptions.size = 10; } } var elm = $.jgrid.createEl(cm.inputtype,cm.searchoptions, &quot;&quot;, true, that.p.ajaxSelectOptions, true); $(elm).addClass(&quot;input-elm&quot;); //that.createElement(rule, &quot;&quot;); if( cm.searchoptions.sopt ) {op = cm.searchoptions.sopt;} else if(that.p.sopt) { op= that.p.sopt; } else if ($.inArray(cm.searchtype, that.p.strarr) !== -1) {op = that.p.stropts;} else {op = that.p.numopts;} // operators var s =&quot;&quot;, so = 0; aoprs = []; $.each(that.p.ops, function() { aoprs.push(this.name); }); for ( i = 0 ; i &lt; op.length; i++) { ina = $.inArray(op[i],aoprs); if(ina !== -1) { if(so===0) { rule.op = that.p.ops[ina].name; } s += &quot;&lt;option value='&quot;+that.p.ops[ina].name+&quot;'&gt;&quot;+that.p.ops[ina].description+&quot;&lt;/option&gt;&quot;; so++; } } $(&quot;.selectopts&quot;,trpar).empty().append( s ); $(&quot;.selectopts&quot;,trpar)[0].selectedIndex = 0; if( $.jgrid.msie &amp;&amp; $.jgrid.msiever() &lt; 9) { var sw = parseInt($(&quot;select.selectopts&quot;,trpar)[0].offsetWidth, 10) + 1; $(&quot;.selectopts&quot;,trpar).width( sw ); $(&quot;.selectopts&quot;,trpar).css(&quot;width&quot;,&quot;auto&quot;); } // data $(&quot;.data&quot;,trpar).empty().append( elm ); $.jgrid.bindEv( elm, cm.searchoptions, that); $(&quot;.input-elm&quot;,trpar).bind('change',function( e ) { var tmo = $(this).hasClass(&quot;ui-autocomplete-input&quot;) ? 200 :0; setTimeout(function(){ var elem = e.target; rule.data = elem.nodeName.toUpperCase() === &quot;SPAN&quot; &amp;&amp; cm.searchoptions &amp;&amp; $.isFunction(cm.searchoptions.custom_value) ? cm.searchoptions.custom_value($(elem).children(&quot;.customelement:first&quot;), 'get') : elem.value; that.onchange(); // signals that the filter has changed }, tmo); }); setTimeout(function(){ //IE, Opera, Chrome rule.data = $(elm).val(); that.onchange(); // signals that the filter has changed }, 0); }); // populate drop down with user provided column definitions var j=0; for (i = 0; i &lt; that.p.columns.length; i++) { // but show only serchable and serchhidden = true fields var searchable = (that.p.columns[i].search === undefined) ? true: that.p.columns[i].search, hidden = (that.p.columns[i].hidden === true), ignoreHiding = (that.p.columns[i].searchoptions.searchhidden === true); if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) { selected = &quot;&quot;; if(rule.field === that.p.columns[i].name) { selected = &quot; selected='selected'&quot;; j=i; } str += &quot;&lt;option value='&quot;+that.p.columns[i].name+&quot;'&quot; +selected+&quot;&gt;&quot;+that.p.columns[i].label+&quot;&lt;/option&gt;&quot;; } } ruleFieldSelect.append( str ); // create operator container var ruleOperatorTd = $(&quot;&lt;td class='operators'&gt;&lt;/td&gt;&quot;); tr.append(ruleOperatorTd); cm = p.columns[j]; // create it here so it can be referentiated in the onchange event //var RD = that.createElement(rule, rule.data); cm.searchoptions.id = $.jgrid.randId(); if(isIE &amp;&amp; cm.inputtype === &quot;text&quot;) { if(!cm.searchoptions.size) { cm.searchoptions.size = 10; } } var ruleDataInput = $.jgrid.createEl(cm.inputtype,cm.searchoptions, rule.data, true, that.p.ajaxSelectOptions, true); if(rule.op == 'nu' || rule.op == 'nn') { $(ruleDataInput).attr('readonly','true'); $(ruleDataInput).attr('disabled','true'); } //retain the state of disabled text fields in case of null ops // dropdown for: choosing operator var ruleOperatorSelect = $(&quot;&lt;select class='selectopts'&gt;&lt;/select&gt;&quot;); ruleOperatorTd.append(ruleOperatorSelect); ruleOperatorSelect.bind('change',function() { rule.op = $(ruleOperatorSelect).val(); trpar = $(this).parents(&quot;tr:first&quot;); var rd = $(&quot;.input-elm&quot;,trpar)[0]; if (rule.op === &quot;nu&quot; || rule.op === &quot;nn&quot;) { // disable for operator &quot;is null&quot; and &quot;is not null&quot; rule.data = &quot;&quot;; rd.value = &quot;&quot;; rd.setAttribute(&quot;readonly&quot;, &quot;true&quot;); rd.setAttribute(&quot;disabled&quot;, &quot;true&quot;); } else { rd.removeAttribute(&quot;readonly&quot;); rd.removeAttribute(&quot;disabled&quot;); } that.onchange(); // signals that the filter has changed }); // populate drop down with all available operators if( cm.searchoptions.sopt ) {op = cm.searchoptions.sopt;} else if(that.p.sopt) { op= that.p.sopt; } else if ($.inArray(cm.searchtype, that.p.strarr) !== -1) {op = that.p.stropts;} else {op = that.p.numopts;} str=&quot;&quot;; $.each(that.p.ops, function() { aoprs.push(this.name); }); for ( i = 0; i &lt; op.length; i++) { ina = $.inArray(op[i],aoprs); if(ina !== -1) { selected = rule.op === that.p.ops[ina].name ? &quot; selected='selected'&quot; : &quot;&quot;; str += &quot;&lt;option value='&quot;+that.p.ops[ina].name+&quot;'&quot;+selected+&quot;&gt;&quot;+that.p.ops[ina].description+&quot;&lt;/option&gt;&quot;; } } ruleOperatorSelect.append( str ); // create data container var ruleDataTd = $(&quot;&lt;td class='data'&gt;&lt;/td&gt;&quot;); tr.append(ruleDataTd); // textbox for: data // is created previously //ruleDataInput.setAttribute(&quot;type&quot;, &quot;text&quot;); ruleDataTd.append(ruleDataInput); $.jgrid.bindEv( ruleDataInput, cm.searchoptions, that); $(ruleDataInput) .addClass(&quot;input-elm&quot;) .bind('change', function() { rule.data = cm.inputtype === 'custom' ? cm.searchoptions.custom_value($(this).children(&quot;.customelement:first&quot;),'get') : $(this).val(); that.onchange(); // signals that the filter has changed }); // create action container var ruleDeleteTd = $(&quot;&lt;td&gt;&lt;/td&gt;&quot;); tr.append(ruleDeleteTd); // create button for: delete rule if(this.p.ruleButtons === true) { var ruleDeleteInput = $(&quot;&lt;input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/&gt;&quot;); ruleDeleteTd.append(ruleDeleteInput); //$(ruleDeleteInput).html(&quot;&quot;).height(20).width(30).button({icons: { primary: &quot;ui-icon-minus&quot;, text:false}}); ruleDeleteInput.bind('click',function() { // remove rule from group for (i = 0; i &lt; group.rules.length; i++) { if (group.rules[i] === rule) { group.rules.splice(i, 1); break; } } that.reDraw(); // the html has changed, force reDraw that.onchange(); // signals that the filter has changed return false; }); } return tr; }; this.getStringForGroup = function(group) { var s = &quot;(&quot;, index; if (group.groups !== undefined) { for (index = 0; index &lt; group.groups.length; index++) { if (s.length &gt; 1) { s += &quot; &quot; + group.groupOp + &quot; &quot;; } try { s += this.getStringForGroup(group.groups[index]); } catch (eg) {alert(eg);} } } if (group.rules !== undefined) { try{ for (index = 0; index &lt; group.rules.length; index++) { if (s.length &gt; 1) { s += &quot; &quot; + group.groupOp + &quot; &quot;; } s += this.getStringForRule(group.rules[index]); } } catch (e) {alert(e);} } s += &quot;)&quot;; if (s === &quot;()&quot;) { return &quot;&quot;; // ignore groups that don't have rules } return s; }; this.getStringForRule = function(rule) { var opUF = &quot;&quot;,opC=&quot;&quot;, i, cm, ret, val, numtypes = ['int', 'integer', 'float', 'number', 'currency']; // jqGrid for (i = 0; i &lt; this.p.ops.length; i++) { if (this.p.ops[i].name === rule.op) { opUF = this.p.ops[i].operator; opC = this.p.ops[i].name; break; } } for (i=0; i&lt;this.p.columns.length; i++) { if(this.p.columns[i].name === rule.field) { cm = this.p.columns[i]; break; } } if (cm == null) { return &quot;&quot;; } val = rule.data; if(opC === 'bw' || opC === 'bn') { val = val+&quot;%&quot;; } if(opC === 'ew' || opC === 'en') { val = &quot;%&quot;+val; } if(opC === 'cn' || opC === 'nc') { val = &quot;%&quot;+val+&quot;%&quot;; } if(opC === 'in' || opC === 'ni') { val = &quot; (&quot;+val+&quot;)&quot;; } if(p.errorcheck) { checkData(rule.data, cm); } if($.inArray(cm.searchtype, numtypes) !== -1 || opC === 'nn' || opC === 'nu') { ret = rule.field + &quot; &quot; + opUF + &quot; &quot; + val; } else { ret = rule.field + &quot; &quot; + opUF + &quot; \\&quot;&quot; + val + &quot;\\&quot;&quot;; } return ret; }; this.resetFilter = function () { this.p.filter = $.extend(true,{},this.p.initFilter); this.reDraw(); this.onchange(); }; this.hideError = function() { $(&quot;th.ui-state-error&quot;, this).html(&quot;&quot;); $(&quot;tr.error&quot;, this).hide(); }; this.showError = function() { $(&quot;th.ui-state-error&quot;, this).html(this.p.errmsg); $(&quot;tr.error&quot;, this).show(); }; this.toUserFriendlyString = function() { return this.getStringForGroup(p.filter); }; this.toString = function() { // this will obtain a string that can be used to match an item. var that = this; function getStringRule(rule) { if(that.p.errorcheck) { var i, cm; for (i=0; i&lt;that.p.columns.length; i++) { if(that.p.columns[i].name === rule.field) { cm = that.p.columns[i]; break; } } if(cm) {checkData(rule.data, cm);} } return rule.op + &quot;(item.&quot; + rule.field + &quot;,'&quot; + rule.data + &quot;')&quot;; } function getStringForGroup(group) { var s = &quot;(&quot;, index; if (group.groups !== undefined) { for (index = 0; index &lt; group.groups.length; index++) { if (s.length &gt; 1) { if (group.groupOp === &quot;OR&quot;) { s += &quot; || &quot;; } else { s += &quot; &amp;&amp; &quot;; } } s += getStringForGroup(group.groups[index]); } } if (group.rules !== undefined) { for (index = 0; index &lt; group.rules.length; index++) { if (s.length &gt; 1) { if (group.groupOp === &quot;OR&quot;) { s += &quot; || &quot;; } else { s += &quot; &amp;&amp; &quot;; } } s += getStringRule(group.rules[index]); } } s += &quot;)&quot;; if (s === &quot;()&quot;) { return &quot;&quot;; // ignore groups that don't have rules } return s; } return getStringForGroup(this.p.filter); }; // Here we init the filter this.reDraw(); if(this.p.showQuery) { this.onchange(); } // mark is as created so that it will not be created twice on this element this.filter = true; }); }; $.extend($.fn.jqFilter,{ /* * Return SQL like string. Can be used directly */ toSQLString : function() { var s =&quot;&quot;; this.each(function(){ s = this.toUserFriendlyString(); }); return s; }, /* * Return filter data as object. */ filterData : function() { var s; this.each(function(){ s = this.p.filter; }); return s; }, getParameter : function (param) { if(param !== undefined) { if (this.p.hasOwnProperty(param) ) { return this.p[param]; } } return this.p; }, resetFilter: function() { return this.each(function(){ this.resetFilter(); }); }, addFilter: function (pfilter) { if (typeof pfilter === &quot;string&quot;) { pfilter = $.jgrid.parse( pfilter ); } this.each(function(){ this.p.filter = pfilter; this.reDraw(); this.onchange(); }); } }); })(jQuery); /*jshint eqeqeq:false, eqnull:true, devel:true */ /*global xmlJsonClass, jQuery */ (function($){ /** * jqGrid extension for form editing Grid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; //var rp_ge = {}; $.jgrid.extend({ searchGrid : function (p) { p = $.extend(true, { recreateFilter: false, drag: true, sField:'searchField', sValue:'searchString', sOper: 'searchOper', sFilter: 'filters', loadDefaults: true, // this options activates loading of default filters from grid's postData for Multipe Search only. beforeShowSearch: null, afterShowSearch : null, onInitializeSearch: null, afterRedraw : null, afterChange: null, closeAfterSearch : false, closeAfterReset: false, closeOnEscape : false, searchOnEnter : false, multipleSearch : false, multipleGroup : false, //cloneSearchRowOnAdd: true, top : 0, left: 0, jqModal : true, modal: false, resize : true, width: 450, height: 'auto', dataheight: 'auto', showQuery: false, errorcheck : true, // translation // if you want to change or remove the order change it in sopt // ['eq','ne','lt','le','gt','ge','bw','bn','in','ni','ew','en','cn','nc'], sopt: null, stringResult: undefined, onClose : null, onSearch : null, onReset : null, toTop : true, overlay : 30, columns : [], tmplNames : null, tmplFilters : null, // translations - later in lang file tmplLabel : ' Template: ', showOnLoad: false, layer: null }, $.jgrid.search, p || {}); return this.each(function() { var $t = this; if(!$t.grid) {return;} var fid = &quot;fbox_&quot;+$t.p.id, showFrm = true, IDs = {themodal:'searchmod'+fid,modalhead:'searchhd'+fid,modalcontent:'searchcnt'+fid, scrollelm : fid}, defaultFilters = $t.p.postData[p.sFilter]; if(typeof defaultFilters === &quot;string&quot;) { defaultFilters = $.jgrid.parse( defaultFilters ); } if(p.recreateFilter === true) { $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).remove(); } function showFilter(_filter) { showFrm = $($t).triggerHandler(&quot;jqGridFilterBeforeShow&quot;, [_filter]); if(showFrm === undefined) { showFrm = true; } if(showFrm &amp;&amp; $.isFunction(p.beforeShowSearch)) { showFrm = p.beforeShowSearch.call($t,_filter); } if(showFrm) { $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(fid),jqm:p.jqModal, modal:p.modal, overlay: p.overlay, toTop: p.toTop}); $($t).triggerHandler(&quot;jqGridFilterAfterShow&quot;, [_filter]); if($.isFunction(p.afterShowSearch)) { p.afterShowSearch.call($t, _filter); } } } if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { showFilter($(&quot;#fbox_&quot;+$.jgrid.jqID(+$t.p.id))); } else { var fil = $(&quot;&lt;div&gt;&lt;div id='&quot;+fid+&quot;' class='searchFilter' style='overflow:auto'&gt;&lt;/div&gt;&lt;/div&gt;&quot;).insertBefore(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id)), align = &quot;left&quot;, butleft =&quot;&quot;; if($t.p.direction == &quot;rtl&quot;) { align = &quot;right&quot;; butleft = &quot; style='text-align:left'&quot;; fil.attr(&quot;dir&quot;,&quot;rtl&quot;); } var columns = $.extend([],$t.p.colModel), bS =&quot;&lt;a href='javascript:void(0)' id='&quot;+fid+&quot;_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'&gt;&lt;span class='ui-icon ui-icon-search'&gt;&lt;/span&gt;&quot;+p.Find+&quot;&lt;/a&gt;&quot;, bC =&quot;&lt;a href='javascript:void(0)' id='&quot;+fid+&quot;_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'&gt;&lt;span class='ui-icon ui-icon-arrowreturnthick-1-w'&gt;&lt;/span&gt;&quot;+p.Reset+&quot;&lt;/a&gt;&quot;, bQ = &quot;&quot;, tmpl=&quot;&quot;, colnm, found = false, bt, cmi=-1; if(p.showQuery) { bQ =&quot;&lt;a href='javascript:void(0)' id='&quot;+fid+&quot;_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'&gt;&lt;span class='ui-icon ui-icon-comment'&gt;&lt;/span&gt;Query&lt;/a&gt;&quot;; } if(!p.columns.length) { $.each(columns, function(i,n){ if(!n.label) { n.label = $t.p.colNames[i]; } // find first searchable column and set it if no default filter if(!found) { var searchable = (n.search === undefined) ? true: n.search , hidden = (n.hidden === true), ignoreHiding = (n.searchoptions &amp;&amp; n.searchoptions.searchhidden === true); if ((ignoreHiding &amp;&amp; searchable) || (searchable &amp;&amp; !hidden)) { found = true; colnm = n.index || n.name; cmi =i; } } }); } else { columns = p.columns; } // old behaviour if( (!defaultFilters &amp;&amp; colnm) || p.multipleSearch === false ) { var cmop = &quot;eq&quot;; if(cmi &gt;=0 &amp;&amp; columns[cmi].searchoptions &amp;&amp; columns[cmi].searchoptions.sopt) { cmop = columns[cmi].searchoptions.sopt[0]; } else if(p.sopt &amp;&amp; p.sopt.length) { cmop = p.sopt[0]; } defaultFilters = {&quot;groupOp&quot;: &quot;AND&quot;,rules:[{&quot;field&quot;:colnm,&quot;op&quot;:cmop,&quot;data&quot;:&quot;&quot;}]}; } found = false; if(p.tmplNames &amp;&amp; p.tmplNames.length) { found = true; tmpl = p.tmplLabel; tmpl += &quot;&lt;select class='ui-template'&gt;&quot;; tmpl += &quot;&lt;option value='default'&gt;Default&lt;/option&gt;&quot;; $.each(p.tmplNames, function(i,n){ tmpl += &quot;&lt;option value='&quot;+i+&quot;'&gt;&quot;+n+&quot;&lt;/option&gt;&quot;; }); tmpl += &quot;&lt;/select&gt;&quot;; } bt = &quot;&lt;table class='EditTable' style='border:0px none;margin-top:5px' id='&quot;+fid+&quot;_2'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;hr class='ui-widget-content' style='margin:1px'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class='EditButton' style='text-align:&quot;+align+&quot;'&gt;&quot;+bC+tmpl+&quot;&lt;/td&gt;&lt;td class='EditButton' &quot;+butleft+&quot;&gt;&quot;+bQ+bS+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; fid = $.jgrid.jqID( fid); $(&quot;#&quot;+fid).jqFilter({ columns : columns, filter: p.loadDefaults ? defaultFilters : null, showQuery: p.showQuery, errorcheck : p.errorcheck, sopt: p.sopt, groupButton : p.multipleGroup, ruleButtons : p.multipleSearch, afterRedraw : p.afterRedraw, _gridsopt : $.jgrid.search.odata, ajaxSelectOptions: $t.p.ajaxSelectOptions, groupOps: p.groupOps, onChange : function() { if(this.p.showQuery) { $('.query',this).html(this.toUserFriendlyString()); } if ($.isFunction(p.afterChange)) { p.afterChange.call($t, $(&quot;#&quot;+fid), p); } }, direction : $t.p.direction }); fil.append( bt ); if(found &amp;&amp; p.tmplFilters &amp;&amp; p.tmplFilters.length) { $(&quot;.ui-template&quot;, fil).bind('change', function(){ var curtempl = $(this).val(); if(curtempl==&quot;default&quot;) { $(&quot;#&quot;+fid).jqFilter('addFilter', defaultFilters); } else { $(&quot;#&quot;+fid).jqFilter('addFilter', p.tmplFilters[parseInt(curtempl,10)]); } return false; }); } if(p.multipleGroup === true) {p.multipleSearch = true;} $($t).triggerHandler(&quot;jqGridFilterInitialize&quot;, [$(&quot;#&quot;+fid)]); if($.isFunction(p.onInitializeSearch) ) { p.onInitializeSearch.call($t, $(&quot;#&quot;+fid)); } p.gbox = &quot;#gbox_&quot;+fid; if (p.layer) { $.jgrid.createModal(IDs ,fil,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0], &quot;#&quot;+$.jgrid.jqID(p.layer), {position: &quot;relative&quot;}); } else { $.jgrid.createModal(IDs ,fil,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0]); } if (p.searchOnEnter || p.closeOnEscape) { $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).keydown(function (e) { var $target = $(e.target); if (p.searchOnEnter &amp;&amp; e.which === 13 &amp;&amp; // 13 === $.ui.keyCode.ENTER !$target.hasClass('add-group') &amp;&amp; !$target.hasClass('add-rule') &amp;&amp; !$target.hasClass('delete-group') &amp;&amp; !$target.hasClass('delete-rule') &amp;&amp; (!$target.hasClass(&quot;fm-button&quot;) || !$target.is(&quot;[id$=_query]&quot;))) { $(&quot;#&quot;+fid+&quot;_search&quot;).focus().click(); return false; } if (p.closeOnEscape &amp;&amp; e.which === 27) { // 27 === $.ui.keyCode.ESCAPE $(&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).find(&quot;.ui-jqdialog-titlebar-close&quot;).focus().click(); return false; } }); } if(bQ) { $(&quot;#&quot;+fid+&quot;_query&quot;).bind('click', function(){ $(&quot;.queryresult&quot;, fil).toggle(); return false; }); } if (p.stringResult===undefined) { // to provide backward compatibility, inferring stringResult value from multipleSearch p.stringResult = p.multipleSearch; } $(&quot;#&quot;+fid+&quot;_search&quot;).bind('click', function(){ var fl = $(&quot;#&quot;+fid), sdata={}, res , filters = fl.jqFilter('filterData'); if(p.errorcheck) { fl[0].hideError(); if(!p.showQuery) {fl.jqFilter('toSQLString');} if(fl[0].p.error) { fl[0].showError(); return false; } } if(p.stringResult) { try { // xmlJsonClass or JSON.stringify res = xmlJsonClass.toJson(filters, '', '', false); } catch (e) { try { res = JSON.stringify(filters); } catch (e2) { } } if(typeof res===&quot;string&quot;) { sdata[p.sFilter] = res; $.each([p.sField,p.sValue, p.sOper], function() {sdata[this] = &quot;&quot;;}); } } else { if(p.multipleSearch) { sdata[p.sFilter] = filters; $.each([p.sField,p.sValue, p.sOper], function() {sdata[this] = &quot;&quot;;}); } else { sdata[p.sField] = filters.rules[0].field; sdata[p.sValue] = filters.rules[0].data; sdata[p.sOper] = filters.rules[0].op; sdata[p.sFilter] = &quot;&quot;; } } $t.p.search = true; $.extend($t.p.postData,sdata); $($t).triggerHandler(&quot;jqGridFilterSearch&quot;); if($.isFunction(p.onSearch) ) { p.onSearch.call($t); } $($t).trigger(&quot;reloadGrid&quot;,[{page:1}]); if(p.closeAfterSearch) { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:p.jqModal,onClose: p.onClose}); } return false; }); $(&quot;#&quot;+fid+&quot;_reset&quot;).bind('click', function(){ var sdata={}, fl = $(&quot;#&quot;+fid); $t.p.search = false; if(p.multipleSearch===false) { sdata[p.sField] = sdata[p.sValue] = sdata[p.sOper] = &quot;&quot;; } else { sdata[p.sFilter] = &quot;&quot;; } fl[0].resetFilter(); if(found) { $(&quot;.ui-template&quot;, fil).val(&quot;default&quot;); } $.extend($t.p.postData,sdata); $($t).triggerHandler(&quot;jqGridFilterReset&quot;); if($.isFunction(p.onReset) ) { p.onReset.call($t); } $($t).trigger(&quot;reloadGrid&quot;,[{page:1}]); return false; }); showFilter($(&quot;#&quot;+fid)); $(&quot;.fm-button:not(.ui-state-disabled)&quot;,fil).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); } }); }, editGridRow : function(rowid, p){ p = $.extend(true, { top : 0, left: 0, width: 300, datawidth: 'auto', height: 'auto', dataheight: 'auto', modal: false, overlay : 30, drag: true, resize: true, url: null, mtype : &quot;POST&quot;, clearAfterAdd :true, closeAfterEdit : false, reloadAfterSubmit : true, onInitializeForm: null, beforeInitData: null, beforeShowForm: null, afterShowForm: null, beforeSubmit: null, afterSubmit: null, onclickSubmit: null, afterComplete: null, onclickPgButtons : null, afterclickPgButtons: null, editData : {}, recreateForm : false, jqModal : true, closeOnEscape : false, addedrow : &quot;first&quot;, topinfo : '', bottominfo: '', saveicon : [], closeicon : [], savekey: [false,13], navkeys: [false,38,40], checkOnSubmit : false, checkOnUpdate : false, _savedData : {}, processing : false, onClose : null, ajaxEditOptions : {}, serializeEditData : null, viewPagerButtons : true }, $.jgrid.edit, p || {}); rp_ge[$(this)[0].p.id] = p; return this.each(function(){ var $t = this; if (!$t.grid || !rowid) {return;} var gID = $t.p.id, frmgr = &quot;FrmGrid_&quot;+gID, frmtborg = &quot;TblGrid_&quot;+gID, frmtb = &quot;#&quot;+$.jgrid.jqID(frmtborg), IDs = {themodal:'editmod'+gID,modalhead:'edithd'+gID,modalcontent:'editcnt'+gID, scrollelm : frmgr}, onBeforeShow = $.isFunction(rp_ge[$t.p.id].beforeShowForm) ? rp_ge[$t.p.id].beforeShowForm : false, onAfterShow = $.isFunction(rp_ge[$t.p.id].afterShowForm) ? rp_ge[$t.p.id].afterShowForm : false, onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false, onInitializeForm = $.isFunction(rp_ge[$t.p.id].onInitializeForm) ? rp_ge[$t.p.id].onInitializeForm : false, showFrm = true, maxCols = 1, maxRows=0, postdata, extpost, newData, diff, frmoper; frmgr = $.jgrid.jqID(frmgr); if (rowid === &quot;new&quot;) { rowid = &quot;_empty&quot;; frmoper = &quot;add&quot;; p.caption=rp_ge[$t.p.id].addCaption; } else { p.caption=rp_ge[$t.p.id].editCaption; frmoper = &quot;edit&quot;; } if(p.recreateForm===true &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined) { $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).remove(); } var closeovrl = true; if(p.checkOnUpdate &amp;&amp; p.jqModal &amp;&amp; !p.modal) { closeovrl = false; } function getFormData(){ $(frmtb+&quot; &gt; tbody &gt; tr &gt; td &gt; .FormElement&quot;).each(function() { var celm = $(&quot;.customelement&quot;, this); if (celm.length) { var elem = celm[0], nm = $(elem).attr('name'); $.each($t.p.colModel, function(){ if(this.name === nm &amp;&amp; this.editoptions &amp;&amp; $.isFunction(this.editoptions.custom_value)) { try { postdata[nm] = this.editoptions.custom_value.call($t, $(&quot;#&quot;+$.jgrid.jqID(nm),frmtb),'get'); if (postdata[nm] === undefined) {throw &quot;e1&quot;;} } catch (e) { if (e===&quot;e1&quot;) {$.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose);} else {$.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose);} } return true; } }); } else { switch ($(this).get(0).type) { case &quot;checkbox&quot;: if($(this).is(&quot;:checked&quot;)) { postdata[this.name]= $(this).val(); }else { var ofv = $(this).attr(&quot;offval&quot;); postdata[this.name]= ofv; } break; case &quot;select-one&quot;: postdata[this.name]= $(&quot;option:selected&quot;,this).val(); extpost[this.name]= $(&quot;option:selected&quot;,this).text(); break; case &quot;select-multiple&quot;: postdata[this.name]= $(this).val(); if(postdata[this.name]) {postdata[this.name] = postdata[this.name].join(&quot;,&quot;);} else {postdata[this.name] =&quot;&quot;;} var selectedText = []; $(&quot;option:selected&quot;,this).each( function(i,selected){ selectedText[i] = $(selected).text(); } ); extpost[this.name]= selectedText.join(&quot;,&quot;); break; case &quot;password&quot;: case &quot;text&quot;: case &quot;textarea&quot;: case &quot;button&quot;: postdata[this.name] = $(this).val(); break; } if($t.p.autoencode) {postdata[this.name] = $.jgrid.htmlEncode(postdata[this.name]);} } }); return true; } function createData(rowid,obj,tb,maxcols){ var nm, hc,trdata, cnt=0,tmp, dc,elc, retpos=[], ind=false, tdtmpl = &quot;&lt;td class='CaptionTD'&gt;&amp;#160;&lt;/td&gt;&lt;td class='DataTD'&gt;&amp;#160;&lt;/td&gt;&quot;, tmpl=&quot;&quot;, i; //*2 for (i =1; i&lt;=maxcols;i++) { tmpl += tdtmpl; } if(rowid != '_empty') { ind = $(obj).jqGrid(&quot;getInd&quot;,rowid); } $(obj.p.colModel).each( function(i) { nm = this.name; // hidden fields are included in the form if(this.editrules &amp;&amp; this.editrules.edithidden === true) { hc = false; } else { hc = this.hidden === true ? true : false; } dc = hc ? &quot;style='display:none'&quot; : &quot;&quot;; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; this.editable===true &amp;&amp; nm !== 'rn') { if(ind === false) { tmp = &quot;&quot;; } else { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(&quot;td[role='gridcell']:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text(); } else { try { tmp = $.unformat.call(obj, $(&quot;td[role='gridcell']:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]),{rowId:rowid, colModel:this},i); } catch (_) { tmp = (this.edittype &amp;&amp; this.edittype == &quot;textarea&quot;) ? $(&quot;td[role='gridcell']:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text() : $(&quot;td[role='gridcell']:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).html(); } if(!tmp || tmp == &quot;&amp;nbsp;&quot; || tmp == &quot;&amp;#160;&quot; || (tmp.length==1 &amp;&amp; tmp.charCodeAt(0)==160) ) {tmp='';} } } var opt = $.extend({}, this.editoptions || {} ,{id:nm,name:nm}), frmopt = $.extend({}, {elmprefix:'',elmsuffix:'',rowabove:false,rowcontent:''}, this.formoptions || {}), rp = parseInt(frmopt.rowpos,10) || cnt+1, cp = parseInt((parseInt(frmopt.colpos,10) || 1)*2,10); if(rowid == &quot;_empty&quot; &amp;&amp; opt.defaultValue ) { tmp = $.isFunction(opt.defaultValue) ? opt.defaultValue.call($t) : opt.defaultValue; } if(!this.edittype) {this.edittype = &quot;text&quot;;} if($t.p.autoencode) {tmp = $.jgrid.htmlDecode(tmp);} elc = $.jgrid.createEl.call($t,this.edittype,opt,tmp,false,$.extend({},$.jgrid.ajaxOptions,obj.p.ajaxSelectOptions || {})); if(tmp === &quot;&quot; &amp;&amp; this.edittype == &quot;checkbox&quot;) {tmp = $(elc).attr(&quot;offval&quot;);} if(tmp === &quot;&quot; &amp;&amp; this.edittype == &quot;select&quot;) {tmp = $(&quot;option:eq(0)&quot;,elc).text();} if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = tmp;} $(elc).addClass(&quot;FormElement&quot;); if( $.inArray(this.edittype, ['text','textarea','password','select']) &gt; -1) { $(elc).addClass(&quot;ui-widget-content ui-corner-all&quot;); } trdata = $(tb).find(&quot;tr[rowpos=&quot;+rp+&quot;]&quot;); if(frmopt.rowabove) { var newdata = $(&quot;&lt;tr&gt;&lt;td class='contentinfo' colspan='&quot;+(maxcols*2)+&quot;'&gt;&quot;+frmopt.rowcontent+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;); $(tb).append(newdata); newdata[0].rp = rp; } if ( trdata.length===0 ) { trdata = $(&quot;&lt;tr &quot;+dc+&quot; rowpos='&quot;+rp+&quot;'&gt;&lt;/tr&gt;&quot;).addClass(&quot;FormData&quot;).attr(&quot;id&quot;,&quot;tr_&quot;+nm); $(trdata).append(tmpl); $(tb).append(trdata); trdata[0].rp = rp; } $(&quot;td:eq(&quot;+(cp-2)+&quot;)&quot;,trdata[0]).html(frmopt.label === undefined ? obj.p.colNames[i]: frmopt.label); $(&quot;td:eq(&quot;+(cp-1)+&quot;)&quot;,trdata[0]).append(frmopt.elmprefix).append(elc).append(frmopt.elmsuffix); if($.isFunction(opt.custom_value) &amp;&amp; rowid !== &quot;_empty&quot; ) { opt.custom_value.call($t, $(&quot;#&quot;+nm,&quot;#&quot;+frmgr),'set',tmp); } $.jgrid.bindEv( elc, opt, $t); retpos[cnt] = i; cnt++; } }); if( cnt &gt; 0) { var idrow = $(&quot;&lt;tr class='FormData' style='display:none'&gt;&lt;td class='CaptionTD'&gt;&lt;/td&gt;&lt;td colspan='&quot;+ (maxcols*2-1)+&quot;' class='DataTD'&gt;&lt;input class='FormElement' id='id_g' type='text' name='&quot;+obj.p.id+&quot;_id' value='&quot;+rowid+&quot;'/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;); idrow[0].rp = cnt+999; $(tb).append(idrow); if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[obj.p.id+&quot;_id&quot;] = rowid;} } return retpos; } function fillData(rowid,obj,fmid){ var nm,cnt=0,tmp, fld,opt,vl,vlc; if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData = {};rp_ge[$t.p.id]._savedData[obj.p.id+&quot;_id&quot;]=rowid;} var cm = obj.p.colModel; if(rowid == '_empty') { $(cm).each(function(){ nm = this.name; opt = $.extend({}, this.editoptions || {} ); fld = $(&quot;#&quot;+$.jgrid.jqID(nm),&quot;#&quot;+fmid); if(fld &amp;&amp; fld.length &amp;&amp; fld[0] !== null) { vl = &quot;&quot;; if(opt.defaultValue ) { vl = $.isFunction(opt.defaultValue) ? opt.defaultValue.call($t) : opt.defaultValue; if(fld[0].type=='checkbox') { vlc = vl.toLowerCase(); if(vlc.search(/(false|0|no|off|undefined)/i)&lt;0 &amp;&amp; vlc!==&quot;&quot;) { fld[0].checked = true; fld[0].defaultChecked = true; fld[0].value = vl; } else { fld[0].checked = false; fld[0].defaultChecked = false; } } else {fld.val(vl);} } else { if( fld[0].type=='checkbox' ) { fld[0].checked = false; fld[0].defaultChecked = false; vl = $(fld).attr(&quot;offval&quot;); } else if (fld[0].type &amp;&amp; fld[0].type.substr(0,6)=='select') { fld[0].selectedIndex = 0; } else { fld.val(vl); } } if(rp_ge[$t.p.id].checkOnSubmit===true || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = vl;} } }); $(&quot;#id_g&quot;,&quot;#&quot;+fmid).val(rowid); return; } var tre = $(obj).jqGrid(&quot;getInd&quot;,rowid,true); if(!tre) {return;} $('td[role=&quot;gridcell&quot;]',tre).each( function(i) { nm = cm[i].name; // hidden fields are included in the form if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn' &amp;&amp; cm[i].editable===true) { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(this).text(); } else { try { tmp = $.unformat.call(obj, $(this),{rowId:rowid, colModel:cm[i]},i); } catch (_) { tmp = cm[i].edittype==&quot;textarea&quot; ? $(this).text() : $(this).html(); } } if($t.p.autoencode) {tmp = $.jgrid.htmlDecode(tmp);} if(rp_ge[$t.p.id].checkOnSubmit===true || rp_ge[$t.p.id].checkOnUpdate) {rp_ge[$t.p.id]._savedData[nm] = tmp;} nm = $.jgrid.jqID(nm); switch (cm[i].edittype) { case &quot;password&quot;: case &quot;text&quot;: case &quot;button&quot; : case &quot;image&quot;: case &quot;textarea&quot;: if(tmp == &quot;&amp;nbsp;&quot; || tmp == &quot;&amp;#160;&quot; || (tmp.length==1 &amp;&amp; tmp.charCodeAt(0)==160) ) {tmp='';} $(&quot;#&quot;+nm,&quot;#&quot;+fmid).val(tmp); break; case &quot;select&quot;: var opv = tmp.split(&quot;,&quot;); opv = $.map(opv,function(n){return $.trim(n);}); $(&quot;#&quot;+nm+&quot; option&quot;,&quot;#&quot;+fmid).each(function(){ if (!cm[i].editoptions.multiple &amp;&amp; ($.trim(tmp) == $.trim($(this).text()) || opv[0] == $.trim($(this).text()) || opv[0] == $.trim($(this).val())) ){ this.selected= true; } else if (cm[i].editoptions.multiple){ if( $.inArray($.trim($(this).text()), opv ) &gt; -1 || $.inArray($.trim($(this).val()), opv ) &gt; -1 ){ this.selected = true; }else{ this.selected = false; } } else { this.selected = false; } }); break; case &quot;checkbox&quot;: tmp = String(tmp); if(cm[i].editoptions &amp;&amp; cm[i].editoptions.value) { var cb = cm[i].editoptions.value.split(&quot;:&quot;); if(cb[0] == tmp) { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;,true); //ie } else { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;, false); //ie } } else { tmp = tmp.toLowerCase(); if(tmp.search(/(false|0|no|off|undefined)/i)&lt;0 &amp;&amp; tmp!==&quot;&quot;) { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;,true); //ie } else { $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $(&quot;#&quot;+nm,&quot;#&quot;+fmid)[$t.p.useProp ? 'prop': 'attr'](&quot;defaultChecked&quot;, false); //ie } } break; case 'custom' : try { if(cm[i].editoptions &amp;&amp; $.isFunction(cm[i].editoptions.custom_value)) { cm[i].editoptions.custom_value.call($t, $(&quot;#&quot;+nm,&quot;#&quot;+fmid),'set',tmp); } else {throw &quot;e1&quot;;} } catch (e) { if (e==&quot;e1&quot;) {$.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose);} else {$.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose);} } break; } cnt++; } }); if(cnt&gt;0) {$(&quot;#id_g&quot;,frmtb).val(rowid);} } function setNulls() { $.each($t.p.colModel, function(i,n){ if(n.editoptions &amp;&amp; n.editoptions.NullIfEmpty === true) { if(postdata.hasOwnProperty(n.name) &amp;&amp; postdata[n.name] === &quot;&quot;) { postdata[n.name] = 'null'; } } }); } function postIt() { var copydata, ret=[true,&quot;&quot;,&quot;&quot;], onCS = {}, opers = $t.p.prmNames, idname, oper, key, selr, i; var retvals = $($t).triggerHandler(&quot;jqGridAddEditBeforeCheckValues&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(retvals &amp;&amp; typeof retvals === 'object') {postdata = retvals;} if($.isFunction(rp_ge[$t.p.id].beforeCheckValues)) { retvals = rp_ge[$t.p.id].beforeCheckValues.call($t, postdata,$(&quot;#&quot;+frmgr),postdata[$t.p.id+&quot;_id&quot;] == &quot;_empty&quot; ? opers.addoper : opers.editoper); if(retvals &amp;&amp; typeof retvals === 'object') {postdata = retvals;} } for( key in postdata ){ if(postdata.hasOwnProperty(key)) { ret = $.jgrid.checkValues.call($t,postdata[key],key,$t); if(ret[0] === false) {break;} } } setNulls(); if(ret[0]) { onCS = $($t).triggerHandler(&quot;jqGridAddEditClickSubmit&quot;, [rp_ge[$t.p.id], postdata, frmoper]); if( onCS === undefined &amp;&amp; $.isFunction( rp_ge[$t.p.id].onclickSubmit)) { onCS = rp_ge[$t.p.id].onclickSubmit.call($t, rp_ge[$t.p.id], postdata) || {}; } ret = $($t).triggerHandler(&quot;jqGridAddEditBeforeSubmit&quot;, [postdata, $(&quot;#&quot;+frmgr), frmoper]); if(ret === undefined) { ret = [true,&quot;&quot;,&quot;&quot;]; } if( ret[0] &amp;&amp; $.isFunction(rp_ge[$t.p.id].beforeSubmit)) { ret = rp_ge[$t.p.id].beforeSubmit.call($t,postdata,$(&quot;#&quot;+frmgr)); } } if(ret[0] &amp;&amp; !rp_ge[$t.p.id].processing) { rp_ge[$t.p.id].processing = true; $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).addClass('ui-state-active'); oper = opers.oper; idname = opers.id; // we add to pos data array the action - the name is oper postdata[oper] = ($.trim(postdata[$t.p.id+&quot;_id&quot;]) == &quot;_empty&quot;) ? opers.addoper : opers.editoper; if(postdata[oper] != opers.addoper) { postdata[idname] = postdata[$t.p.id+&quot;_id&quot;]; } else { // check to see if we have allredy this field in the form and if yes lieve it if( postdata[idname] === undefined ) {postdata[idname] = postdata[$t.p.id+&quot;_id&quot;];} } delete postdata[$t.p.id+&quot;_id&quot;]; postdata = $.extend(postdata,rp_ge[$t.p.id].editData,onCS); if($t.p.treeGrid === true) { if(postdata[oper] == opers.addoper) { selr = $($t).jqGrid(&quot;getGridParam&quot;, 'selrow'); var tr_par_id = $t.p.treeGridModel == 'adjacency' ? $t.p.treeReader.parent_id_field : 'parent_id'; postdata[tr_par_id] = selr; } for(i in $t.p.treeReader){ if($t.p.treeReader.hasOwnProperty(i)) { var itm = $t.p.treeReader[i]; if(postdata.hasOwnProperty(itm)) { if(postdata[oper] == opers.addoper &amp;&amp; i === 'parent_id_field') {continue;} delete postdata[itm]; } } } } postdata[idname] = $.jgrid.stripPref($t.p.idPrefix, postdata[idname]); var ajaxOptions = $.extend({ url: rp_ge[$t.p.id].url || $($t).jqGrid('getGridParam','editurl'), type: rp_ge[$t.p.id].mtype, data: $.isFunction(rp_ge[$t.p.id].serializeEditData) ? rp_ge[$t.p.id].serializeEditData.call($t,postdata) : postdata, complete:function(data,status){ var key; postdata[idname] = $t.p.idPrefix + postdata[idname]; if(status != &quot;success&quot;) { ret[0] = false; ret[1] = $($t).triggerHandler(&quot;jqGridAddEditErrorTextFormat&quot;, [data, frmoper]); if ($.isFunction(rp_ge[$t.p.id].errorTextFormat)) { ret[1] = rp_ge[$t.p.id].errorTextFormat.call($t, data); } else { ret[1] = status + &quot; Status: '&quot; + data.statusText + &quot;'. Error code: &quot; + data.status; } } else { // data is posted successful // execute aftersubmit with the returned data from server ret = $($t).triggerHandler(&quot;jqGridAddEditAfterSubmit&quot;, [data, postdata, frmoper]); if(ret === undefined) { ret = [true,&quot;&quot;,&quot;&quot;]; } if( ret[0] &amp;&amp; $.isFunction(rp_ge[$t.p.id].afterSubmit) ) { ret = rp_ge[$t.p.id].afterSubmit.call($t, data,postdata); } } if(ret[0] === false) { $(&quot;#FormError&gt;td&quot;,frmtb).html(ret[1]); $(&quot;#FormError&quot;,frmtb).show(); } else { // remove some values if formattaer select or checkbox $.each($t.p.colModel, function(){ if(extpost[this.name] &amp;&amp; this.formatter &amp;&amp; this.formatter=='select') { try {delete extpost[this.name];} catch (e) {} } }); postdata = $.extend(postdata,extpost); if($t.p.autoencode) { $.each(postdata,function(n,v){ postdata[n] = $.jgrid.htmlDecode(v); }); } //rp_ge[$t.p.id].reloadAfterSubmit = rp_ge[$t.p.id].reloadAfterSubmit &amp;&amp; $t.p.datatype != &quot;local&quot;; // the action is add if(postdata[oper] == opers.addoper ) { //id processing // user not set the id ret[2] if(!ret[2]) {ret[2] = $.jgrid.randId();} postdata[idname] = ret[2]; if(rp_ge[$t.p.id].closeAfterAdd) { if(rp_ge[$t.p.id].reloadAfterSubmit) {$($t).trigger(&quot;reloadGrid&quot;);} else { if($t.p.treeGrid === true){ $($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata ); } else { $($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow); $($t).jqGrid(&quot;setSelection&quot;,ret[2]); } } $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); } else if (rp_ge[$t.p.id].clearAfterAdd) { if(rp_ge[$t.p.id].reloadAfterSubmit) {$($t).trigger(&quot;reloadGrid&quot;);} else { if($t.p.treeGrid === true){ $($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata ); } else { $($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow); } } fillData(&quot;_empty&quot;,$t,frmgr); } else { if(rp_ge[$t.p.id].reloadAfterSubmit) {$($t).trigger(&quot;reloadGrid&quot;);} else { if($t.p.treeGrid === true){ $($t).jqGrid(&quot;addChildNode&quot;,ret[2],selr,postdata ); } else { $($t).jqGrid(&quot;addRowData&quot;,ret[2],postdata,p.addedrow); } } } } else { // the action is update if(rp_ge[$t.p.id].reloadAfterSubmit) { $($t).trigger(&quot;reloadGrid&quot;); if( !rp_ge[$t.p.id].closeAfterEdit ) {setTimeout(function(){$($t).jqGrid(&quot;setSelection&quot;,postdata[idname]);},1000);} } else { if($t.p.treeGrid === true) { $($t).jqGrid(&quot;setTreeRow&quot;, postdata[idname],postdata); } else { $($t).jqGrid(&quot;setRowData&quot;, postdata[idname],postdata); } } if(rp_ge[$t.p.id].closeAfterEdit) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose});} } if($.isFunction(rp_ge[$t.p.id].afterComplete)) { copydata = data; setTimeout(function(){ $($t).triggerHandler(&quot;jqGridAddEditAfterComplete&quot;, [copydata, postdata, $(&quot;#&quot;+frmgr), frmoper]); rp_ge[$t.p.id].afterComplete.call($t, copydata, postdata, $(&quot;#&quot;+frmgr)); copydata=null; },500); } if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) { $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); if(rp_ge[$t.p.id]._savedData[$t.p.id+&quot;_id&quot;] !=&quot;_empty&quot;){ for(key in rp_ge[$t.p.id]._savedData) { if(rp_ge[$t.p.id]._savedData.hasOwnProperty(key) &amp;&amp; postdata[key]) { rp_ge[$t.p.id]._savedData[key] = postdata[key]; } } } } } rp_ge[$t.p.id].processing=false; $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).removeClass('ui-state-active'); try{$(':input:visible',&quot;#&quot;+frmgr)[0].focus();} catch (e){} } }, $.jgrid.ajaxOptions, rp_ge[$t.p.id].ajaxEditOptions ); if (!ajaxOptions.url &amp;&amp; !rp_ge[$t.p.id].useDataProxy) { if ($.isFunction($t.p.dataProxy)) { rp_ge[$t.p.id].useDataProxy = true; } else { ret[0]=false;ret[1] += &quot; &quot;+$.jgrid.errors.nourl; } } if (ret[0]) { if (rp_ge[$t.p.id].useDataProxy) { var dpret = $t.p.dataProxy.call($t, ajaxOptions, &quot;set_&quot;+$t.p.id); if(dpret === undefined) { dpret = [true, &quot;&quot;]; } if(dpret[0] === false ) { ret[0] = false; ret[1] = dpret[1] || &quot;Error deleting the selected row!&quot; ; } else { if(ajaxOptions.data.oper == opers.addoper &amp;&amp; rp_ge[$t.p.id].closeAfterAdd ) { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); } if(ajaxOptions.data.oper == opers.editoper &amp;&amp; rp_ge[$t.p.id].closeAfterEdit ) { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); } } } else { $.ajax(ajaxOptions); } } } if(ret[0] === false) { $(&quot;#FormError&gt;td&quot;,frmtb).html(ret[1]); $(&quot;#FormError&quot;,frmtb).show(); // return; } } function compareData(nObj, oObj ) { var ret = false,key; for (key in nObj) { if(nObj.hasOwnProperty(key) &amp;&amp; nObj[key] != oObj[key]) { ret = true; break; } } return ret; } function checkUpdates () { var stat = true; $(&quot;#FormError&quot;,frmtb).hide(); if(rp_ge[$t.p.id].checkOnUpdate) { postdata = {};extpost={}; getFormData(); newData = $.extend({},postdata,extpost); diff = compareData(newData,rp_ge[$t.p.id]._savedData); if(diff) { $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,true); $(&quot;.confirm&quot;,&quot;#&quot;+IDs.themodal).show(); stat = false; } } return stat; } function restoreInline() { var i; if (rowid !== &quot;_empty&quot; &amp;&amp; $t.p.savedRow !== undefined &amp;&amp; $t.p.savedRow.length &gt; 0 &amp;&amp; $.isFunction($.fn.jqGrid.restoreRow)) { for (i=0;i&lt;$t.p.savedRow.length;i++) { if ($t.p.savedRow[i].id == rowid) { $($t).jqGrid('restoreRow',rowid); break; } } } } function updateNav(cr, posarr){ var totr = posarr[1].length-1; if (cr===0) { $(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else if( posarr[1][cr-1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr-1])).hasClass('ui-state-disabled')) { $(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else { $(&quot;#pData&quot;,frmtb+&quot;_2&quot;).removeClass('ui-state-disabled'); } if (cr==totr) { $(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else if( posarr[1][cr+1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr+1])).hasClass('ui-state-disabled')) { $(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else { $(&quot;#nData&quot;,frmtb+&quot;_2&quot;).removeClass('ui-state-disabled'); } } function getCurrPos() { var rowsInGrid = $($t).jqGrid(&quot;getDataIDs&quot;), selrow = $(&quot;#id_g&quot;,frmtb).val(), pos = $.inArray(selrow,rowsInGrid); return [pos,rowsInGrid]; } if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { showFrm = $($t).triggerHandler(&quot;jqGridAddEditBeforeInitData&quot;, [$(&quot;#&quot;+$.jgrid.jqID(frmgr)), frmoper]); if(showFrm === undefined) { showFrm = true; } if(showFrm &amp;&amp; onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); } if(showFrm === false) {return;} restoreInline(); $(&quot;.ui-jqdialog-title&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).html(p.caption); $(&quot;#FormError&quot;,frmtb).hide(); if(rp_ge[$t.p.id].topinfo) { $(&quot;.topinfo&quot;,frmtb).html(rp_ge[$t.p.id].topinfo); $(&quot;.tinfo&quot;,frmtb).show(); } else { $(&quot;.tinfo&quot;,frmtb).hide(); } if(rp_ge[$t.p.id].bottominfo) { $(&quot;.bottominfo&quot;,frmtb+&quot;_2&quot;).html(rp_ge[$t.p.id].bottominfo); $(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).show(); } else { $(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).hide(); } // filldata fillData(rowid,$t,frmgr); /// if(rowid==&quot;_empty&quot; || !rp_ge[$t.p.id].viewPagerButtons) { $(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).hide(); } else { $(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).show(); } if(rp_ge[$t.p.id].processing===true) { rp_ge[$t.p.id].processing=false; $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).removeClass('ui-state-active'); } if($(&quot;#&quot;+frmgr).data(&quot;disabled&quot;)===true) { $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); } $($t).triggerHandler(&quot;jqGridAddEditBeforeShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onBeforeShow) { onBeforeShow.call($t, $(&quot;#&quot;+frmgr)); } $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).data(&quot;onClose&quot;,rp_ge[$t.p.id].onClose); $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, jqM: false, overlay: p.overlay, modal:p.modal}); if(!closeovrl) { $(&quot;.jqmOverlay&quot;).click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); return false; }); } $($t).triggerHandler(&quot;jqGridAddEditAfterShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onAfterShow) { onAfterShow.call($t, $(&quot;#&quot;+frmgr)); } } else { var dh = isNaN(p.dataheight) ? p.dataheight : p.dataheight+&quot;px&quot;, dw = isNaN(p.datawidth) ? p.datawidth : p.datawidth+&quot;px&quot;, frm = $(&quot;&lt;form name='FormPost' id='&quot;+frmgr+&quot;' class='FormGrid' onSubmit='return false;' style='width:&quot;+dw+&quot;;overflow:auto;position:relative;height:&quot;+dh+&quot;;'&gt;&lt;/form&gt;&quot;).data(&quot;disabled&quot;,false), tbl = $(&quot;&lt;table id='&quot;+frmtborg+&quot;' class='EditTable' cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); showFrm = $($t).triggerHandler(&quot;jqGridAddEditBeforeInitData&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(showFrm === undefined) { showFrm = true; } if(showFrm &amp;&amp; onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); } if(showFrm === false) {return;} restoreInline(); $($t.p.colModel).each( function() { var fmto = this.formoptions; maxCols = Math.max(maxCols, fmto ? fmto.colpos || 0 : 0 ); maxRows = Math.max(maxRows, fmto ? fmto.rowpos || 0 : 0 ); }); $(frm).append(tbl); var flr = $(&quot;&lt;tr id='FormError' style='display:none'&gt;&lt;td class='ui-state-error' colspan='&quot;+(maxCols*2)+&quot;'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;); flr[0].rp = 0; $(tbl).append(flr); //topinfo flr = $(&quot;&lt;tr style='display:none' class='tinfo'&gt;&lt;td class='topinfo' colspan='&quot;+(maxCols*2)+&quot;'&gt;&quot;+rp_ge[$t.p.id].topinfo+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;); flr[0].rp = 0; $(tbl).append(flr); // set the id. // use carefull only to change here colproperties. // create data var rtlb = $t.p.direction == &quot;rtl&quot; ? true :false, bp = rtlb ? &quot;nData&quot; : &quot;pData&quot;, bn = rtlb ? &quot;pData&quot; : &quot;nData&quot;; createData(rowid,$t,tbl,maxCols); // buttons at footer var bP = &quot;&lt;a href='javascript:void(0)' id='&quot;+bp+&quot;' class='fm-button ui-state-default ui-corner-left'&gt;&lt;span class='ui-icon ui-icon-triangle-1-w'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bN = &quot;&lt;a href='javascript:void(0)' id='&quot;+bn+&quot;' class='fm-button ui-state-default ui-corner-right'&gt;&lt;span class='ui-icon ui-icon-triangle-1-e'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bS =&quot;&lt;a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bSubmit+&quot;&lt;/a&gt;&quot;, bC =&quot;&lt;a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bCancel+&quot;&lt;/a&gt;&quot;; var bt = &quot;&lt;table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='&quot;+frmtborg+&quot;_2'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;hr class='ui-widget-content' style='margin:1px'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr id='Act_Buttons'&gt;&lt;td class='navButton'&gt;&quot;+(rtlb ? bN+bP : bP+bN)+&quot;&lt;/td&gt;&lt;td class='EditButton'&gt;&quot;+bS+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; bt += &quot;&lt;tr style='display:none' class='binfo'&gt;&lt;td class='bottominfo' colspan='2'&gt;&quot;+rp_ge[$t.p.id].bottominfo+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; bt += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;; if(maxRows &gt; 0) { var sd=[]; $.each($(tbl)[0].rows,function(i,r){ sd[i] = r; }); sd.sort(function(a,b){ if(a.rp &gt; b.rp) {return 1;} if(a.rp &lt; b.rp) {return -1;} return 0; }); $.each(sd, function(index, row) { $('tbody',tbl).append(row); }); } p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID); var cle = false; if(p.closeOnEscape===true){ p.closeOnEscape = false; cle = true; } var tms = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;).append(frm).append(bt); $.jgrid.createModal(IDs,tms,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0]); if(rtlb) { $(&quot;#pData, #nData&quot;,frmtb+&quot;_2&quot;).css(&quot;float&quot;,&quot;right&quot;); $(&quot;.EditButton&quot;,frmtb+&quot;_2&quot;).css(&quot;text-align&quot;,&quot;left&quot;); } if(rp_ge[$t.p.id].topinfo) {$(&quot;.tinfo&quot;,frmtb).show();} if(rp_ge[$t.p.id].bottominfo) {$(&quot;.binfo&quot;,frmtb+&quot;_2&quot;).show();} tms = null;bt=null; $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).keydown( function( e ) { var wkey = e.target; if ($(&quot;#&quot;+frmgr).data(&quot;disabled&quot;)===true ) {return false;}//?? if(rp_ge[$t.p.id].savekey[0] === true &amp;&amp; e.which == rp_ge[$t.p.id].savekey[1]) { // save if(wkey.tagName != &quot;TEXTAREA&quot;) { $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } } if(e.which === 27) { if(!checkUpdates()) {return false;} if(cle) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:p.gbox,jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});} return false; } if(rp_ge[$t.p.id].navkeys[0]===true) { if($(&quot;#id_g&quot;,frmtb).val() == &quot;_empty&quot;) {return true;} if(e.which == rp_ge[$t.p.id].navkeys[1]){ //up $(&quot;#pData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } if(e.which == rp_ge[$t.p.id].navkeys[2]){ //down $(&quot;#nData&quot;, frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } } }); if(p.checkOnUpdate) { $(&quot;a.ui-jqdialog-titlebar-close span&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).removeClass(&quot;jqmClose&quot;); $(&quot;a.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).unbind(&quot;click&quot;) .click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); return false; }); } p.saveicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-disk&quot;],p.saveicon); p.closeicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-close&quot;],p.closeicon); // beforeinitdata after creation of the form if(p.saveicon[0]===true) { $(&quot;#sData&quot;,frmtb+&quot;_2&quot;).addClass(p.saveicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.saveicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if(p.closeicon[0]===true) { $(&quot;#cData&quot;,frmtb+&quot;_2&quot;).addClass(p.closeicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.closeicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if(rp_ge[$t.p.id].checkOnSubmit || rp_ge[$t.p.id].checkOnUpdate) { bS =&quot;&lt;a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'&gt;&quot;+p.bYes+&quot;&lt;/a&gt;&quot;; bN =&quot;&lt;a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'&gt;&quot;+p.bNo+&quot;&lt;/a&gt;&quot;; bC =&quot;&lt;a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'&gt;&quot;+p.bExit+&quot;&lt;/a&gt;&quot;; var zI = p.zIndex || 999;zI ++; $(&quot;&lt;div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:&quot;+zI+&quot;;display:none;'&gt;&amp;#160;&quot;+&quot;&lt;/div&gt;&lt;div class='confirm ui-widget-content ui-jqconfirm' style='z-index:&quot;+(zI+1)+&quot;'&gt;&quot;+p.saveData+&quot;&lt;br/&gt;&lt;br/&gt;&quot;+bS+bN+bC+&quot;&lt;/div&gt;&quot;).insertAfter(&quot;#&quot;+frmgr); $(&quot;#sNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){ postIt(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); return false; }); $(&quot;#nNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){ $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); setTimeout(function(){$(&quot;:input&quot;,&quot;#&quot;+frmgr)[0].focus();},0); return false; }); $(&quot;#cNew&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).click(function(){ $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hide(); $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,false); $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); return false; }); } // here initform - only once $($t).triggerHandler(&quot;jqGridAddEditInitializeForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onInitializeForm) {onInitializeForm.call($t,$(&quot;#&quot;+frmgr));} if(rowid==&quot;_empty&quot; || !rp_ge[$t.p.id].viewPagerButtons) {$(&quot;#pData,#nData&quot;,frmtb+&quot;_2&quot;).hide();} else {$(&quot;#pData,#nData&quot;,frmtb+&quot;_2&quot;).show();} $($t).triggerHandler(&quot;jqGridAddEditBeforeShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onBeforeShow) { onBeforeShow.call($t, $(&quot;#&quot;+frmgr));} $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).data(&quot;onClose&quot;,rp_ge[$t.p.id].onClose); $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, overlay: p.overlay,modal:p.modal}); if(!closeovrl) { $(&quot;.jqmOverlay&quot;).click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); return false; }); } $($t).triggerHandler(&quot;jqGridAddEditAfterShowForm&quot;, [$(&quot;#&quot;+frmgr), frmoper]); if(onAfterShow) { onAfterShow.call($t, $(&quot;#&quot;+frmgr)); } $(&quot;.fm-button&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); $(&quot;#sData&quot;, frmtb+&quot;_2&quot;).click(function(){ postdata = {};extpost={}; $(&quot;#FormError&quot;,frmtb).hide(); // all depend on ret array //ret[0] - succes //ret[1] - msg if not succes //ret[2] - the id that will be set if reload after submit false getFormData(); if(postdata[$t.p.id+&quot;_id&quot;] == &quot;_empty&quot;) {postIt();} else if(p.checkOnSubmit===true ) { newData = $.extend({},postdata,extpost); diff = compareData(newData,rp_ge[$t.p.id]._savedData); if(diff) { $(&quot;#&quot;+frmgr).data(&quot;disabled&quot;,true); $(&quot;.confirm&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.themodal)).show(); } else { postIt(); } } else { postIt(); } return false; }); $(&quot;#cData&quot;, frmtb+&quot;_2&quot;).click(function(){ if(!checkUpdates()) {return false;} $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,onClose: rp_ge[$t.p.id].onClose}); return false; }); $(&quot;#nData&quot;, frmtb+&quot;_2&quot;).click(function(){ if(!checkUpdates()) {return false;} $(&quot;#FormError&quot;,frmtb).hide(); var npos = getCurrPos(); npos[0] = parseInt(npos[0],10); if(npos[0] != -1 &amp;&amp; npos[1][npos[0]+1]) { $($t).triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, ['next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]]); var nposret; if($.isFunction(p.onclickPgButtons)) { nposret = p.onclickPgButtons.call($t, 'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]); if( nposret !== undefined &amp;&amp; nposret === false ) {return false;} } if( $(&quot;#&quot;+$.jgrid.jqID(npos[1][npos[0]+1])).hasClass('ui-state-disabled')) {return false;} fillData(npos[1][npos[0]+1],$t,frmgr); $($t).jqGrid(&quot;setSelection&quot;,npos[1][npos[0]+1]); $($t).triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, ['next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t, 'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]+1]); } updateNav(npos[0]+1,npos); } return false; }); $(&quot;#pData&quot;, frmtb+&quot;_2&quot;).click(function(){ if(!checkUpdates()) {return false;} $(&quot;#FormError&quot;,frmtb).hide(); var ppos = getCurrPos(); if(ppos[0] != -1 &amp;&amp; ppos[1][ppos[0]-1]) { $($t).triggerHandler(&quot;jqGridAddEditClickPgButtons&quot;, ['prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]]); var pposret; if($.isFunction(p.onclickPgButtons)) { pposret = p.onclickPgButtons.call($t, 'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]); if( pposret !== undefined &amp;&amp; pposret === false ) {return false;} } if( $(&quot;#&quot;+$.jgrid.jqID(ppos[1][ppos[0]-1])).hasClass('ui-state-disabled')) {return false;} fillData(ppos[1][ppos[0]-1],$t,frmgr); $($t).jqGrid(&quot;setSelection&quot;,ppos[1][ppos[0]-1]); $($t).triggerHandler(&quot;jqGridAddEditAfterClickPgButtons&quot;, ['prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t, 'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]-1]); } updateNav(ppos[0]-1,ppos); } return false; }); } var posInit =getCurrPos(); updateNav(posInit[0],posInit); }); }, viewGridRow : function(rowid, p){ p = $.extend(true, { top : 0, left: 0, width: 0, datawidth: 'auto', height: 'auto', dataheight: 'auto', modal: false, overlay: 30, drag: true, resize: true, jqModal: true, closeOnEscape : false, labelswidth: '30%', closeicon: [], navkeys: [false,38,40], onClose: null, beforeShowForm : null, beforeInitData : null, viewPagerButtons : true }, $.jgrid.view, p || {}); rp_ge[$(this)[0].p.id] = p; return this.each(function(){ var $t = this; if (!$t.grid || !rowid) {return;} var gID = $t.p.id, frmgr = &quot;ViewGrid_&quot;+$.jgrid.jqID( gID ), frmtb = &quot;ViewTbl_&quot; + $.jgrid.jqID( gID ), frmgr_id = &quot;ViewGrid_&quot;+gID, frmtb_id = &quot;ViewTbl_&quot;+gID, IDs = {themodal:'viewmod'+gID,modalhead:'viewhd'+gID,modalcontent:'viewcnt'+gID, scrollelm : frmgr}, onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false, showFrm = true, maxCols = 1, maxRows=0; function focusaref(){ //Sfari 3 issues if(rp_ge[$t.p.id].closeOnEscape===true || rp_ge[$t.p.id].navkeys[0]===true) { setTimeout(function(){$(&quot;.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).focus();},0); } } function createData(rowid,obj,tb,maxcols){ var nm, hc,trdata, cnt=0,tmp, dc, retpos=[], ind=false, i, tdtmpl = &quot;&lt;td class='CaptionTD form-view-label ui-widget-content' width='&quot;+p.labelswidth+&quot;'&gt;&amp;#160;&lt;/td&gt;&lt;td class='DataTD form-view-data ui-helper-reset ui-widget-content'&gt;&amp;#160;&lt;/td&gt;&quot;, tmpl=&quot;&quot;, tdtmpl2 = &quot;&lt;td class='CaptionTD form-view-label ui-widget-content'&gt;&amp;#160;&lt;/td&gt;&lt;td class='DataTD form-view-data ui-widget-content'&gt;&amp;#160;&lt;/td&gt;&quot;, fmtnum = ['integer','number','currency'],max1 =0, max2=0 ,maxw,setme, viewfld; for (i=1;i&lt;=maxcols;i++) { tmpl += i == 1 ? tdtmpl : tdtmpl2; } // find max number align rigth with property formatter $(obj.p.colModel).each( function() { if(this.editrules &amp;&amp; this.editrules.edithidden === true) { hc = false; } else { hc = this.hidden === true ? true : false; } if(!hc &amp;&amp; this.align==='right') { if(this.formatter &amp;&amp; $.inArray(this.formatter,fmtnum) !== -1 ) { max1 = Math.max(max1,parseInt(this.width,10)); } else { max2 = Math.max(max2,parseInt(this.width,10)); } } }); maxw = max1 !==0 ? max1 : max2 !==0 ? max2 : 0; ind = $(obj).jqGrid(&quot;getInd&quot;,rowid); $(obj.p.colModel).each( function(i) { nm = this.name; setme = false; // hidden fields are included in the form if(this.editrules &amp;&amp; this.editrules.edithidden === true) { hc = false; } else { hc = this.hidden === true ? true : false; } dc = hc ? &quot;style='display:none'&quot; : &quot;&quot;; viewfld = (typeof this.viewable !== 'boolean') ? true : this.viewable; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn' &amp;&amp; viewfld) { if(ind === false) { tmp = &quot;&quot;; } else { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).text(); } else { tmp = $(&quot;td:eq(&quot;+i+&quot;)&quot;,obj.rows[ind]).html(); } } setme = this.align === 'right' &amp;&amp; maxw !==0 ? true : false; var frmopt = $.extend({},{rowabove:false,rowcontent:''}, this.formoptions || {}), rp = parseInt(frmopt.rowpos,10) || cnt+1, cp = parseInt((parseInt(frmopt.colpos,10) || 1)*2,10); if(frmopt.rowabove) { var newdata = $(&quot;&lt;tr&gt;&lt;td class='contentinfo' colspan='&quot;+(maxcols*2)+&quot;'&gt;&quot;+frmopt.rowcontent+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;); $(tb).append(newdata); newdata[0].rp = rp; } trdata = $(tb).find(&quot;tr[rowpos=&quot;+rp+&quot;]&quot;); if ( trdata.length===0 ) { trdata = $(&quot;&lt;tr &quot;+dc+&quot; rowpos='&quot;+rp+&quot;'&gt;&lt;/tr&gt;&quot;).addClass(&quot;FormData&quot;).attr(&quot;id&quot;,&quot;trv_&quot;+nm); $(trdata).append(tmpl); $(tb).append(trdata); trdata[0].rp = rp; } $(&quot;td:eq(&quot;+(cp-2)+&quot;)&quot;,trdata[0]).html('&lt;b&gt;'+ (frmopt.label === undefined ? obj.p.colNames[i]: frmopt.label)+'&lt;/b&gt;'); $(&quot;td:eq(&quot;+(cp-1)+&quot;)&quot;,trdata[0]).append(&quot;&lt;span&gt;&quot;+tmp+&quot;&lt;/span&gt;&quot;).attr(&quot;id&quot;,&quot;v_&quot;+nm); if(setme){ $(&quot;td:eq(&quot;+(cp-1)+&quot;) span&quot;,trdata[0]).css({'text-align':'right',width:maxw+&quot;px&quot;}); } retpos[cnt] = i; cnt++; } }); if( cnt &gt; 0) { var idrow = $(&quot;&lt;tr class='FormData' style='display:none'&gt;&lt;td class='CaptionTD'&gt;&lt;/td&gt;&lt;td colspan='&quot;+ (maxcols*2-1)+&quot;' class='DataTD'&gt;&lt;input class='FormElement' id='id_g' type='text' name='id' value='&quot;+rowid+&quot;'/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;); idrow[0].rp = cnt+99; $(tb).append(idrow); } return retpos; } function fillData(rowid,obj){ var nm, hc,cnt=0,tmp, opt,trv; trv = $(obj).jqGrid(&quot;getInd&quot;,rowid,true); if(!trv) {return;} $('td',trv).each( function(i) { nm = obj.p.colModel[i].name; // hidden fields are included in the form if(obj.p.colModel[i].editrules &amp;&amp; obj.p.colModel[i].editrules.edithidden === true) { hc = false; } else { hc = obj.p.colModel[i].hidden === true ? true : false; } if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid' &amp;&amp; nm !== 'rn') { if(nm == obj.p.ExpandColumn &amp;&amp; obj.p.treeGrid === true) { tmp = $(this).text(); } else { tmp = $(this).html(); } opt = $.extend({},obj.p.colModel[i].editoptions || {}); nm = $.jgrid.jqID(&quot;v_&quot;+nm); $(&quot;#&quot;+nm+&quot; span&quot;,&quot;#&quot;+frmtb).html(tmp); if (hc) {$(&quot;#&quot;+nm,&quot;#&quot;+frmtb).parents(&quot;tr:first&quot;).hide();} cnt++; } }); if(cnt&gt;0) {$(&quot;#id_g&quot;,&quot;#&quot;+frmtb).val(rowid);} } function updateNav(cr,posarr){ var totr = posarr[1].length-1; if (cr===0) { $(&quot;#pData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else if( posarr[1][cr-1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr-1])).hasClass('ui-state-disabled')) { $(&quot;#pData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else { $(&quot;#pData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).removeClass('ui-state-disabled'); } if (cr==totr) { $(&quot;#nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else if( posarr[1][cr+1] !== undefined &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(posarr[1][cr+1])).hasClass('ui-state-disabled')) { $(&quot;#nData&quot;,frmtb+&quot;_2&quot;).addClass('ui-state-disabled'); } else { $(&quot;#nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).removeClass('ui-state-disabled'); } } function getCurrPos() { var rowsInGrid = $($t).jqGrid(&quot;getDataIDs&quot;), selrow = $(&quot;#id_g&quot;,&quot;#&quot;+frmtb).val(), pos = $.inArray(selrow,rowsInGrid); return [pos,rowsInGrid]; } if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); if(showFrm === undefined) { showFrm = true; } } if(showFrm === false) {return;} $(&quot;.ui-jqdialog-title&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).html(p.caption); $(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide(); fillData(rowid,$t); if($.isFunction(rp_ge[$t.p.id].beforeShowForm)) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+frmgr));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, jqM: false, overlay: p.overlay, modal:p.modal}); focusaref(); } else { var dh = isNaN(p.dataheight) ? p.dataheight : p.dataheight+&quot;px&quot;, dw = isNaN(p.datawidth) ? p.datawidth : p.datawidth+&quot;px&quot;, frm = $(&quot;&lt;form name='FormPost' id='&quot;+frmgr_id+&quot;' class='FormGrid' style='width:&quot;+dw+&quot;;overflow:auto;position:relative;height:&quot;+dh+&quot;;'&gt;&lt;/form&gt;&quot;), tbl =$(&quot;&lt;table id='&quot;+frmtb_id+&quot;' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+frmgr)); if(showFrm === undefined) { showFrm = true; } } if(showFrm === false) {return;} $($t.p.colModel).each( function() { var fmto = this.formoptions; maxCols = Math.max(maxCols, fmto ? fmto.colpos || 0 : 0 ); maxRows = Math.max(maxRows, fmto ? fmto.rowpos || 0 : 0 ); }); // set the id. $(frm).append(tbl); createData(rowid, $t, tbl, maxCols); var rtlb = $t.p.direction == &quot;rtl&quot; ? true :false, bp = rtlb ? &quot;nData&quot; : &quot;pData&quot;, bn = rtlb ? &quot;pData&quot; : &quot;nData&quot;, // buttons at footer bP = &quot;&lt;a href='javascript:void(0)' id='&quot;+bp+&quot;' class='fm-button ui-state-default ui-corner-left'&gt;&lt;span class='ui-icon ui-icon-triangle-1-w'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bN = &quot;&lt;a href='javascript:void(0)' id='&quot;+bn+&quot;' class='fm-button ui-state-default ui-corner-right'&gt;&lt;span class='ui-icon ui-icon-triangle-1-e'&gt;&lt;/span&gt;&lt;/a&gt;&quot;, bC =&quot;&lt;a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bClose+&quot;&lt;/a&gt;&quot;; if(maxRows &gt; 0) { var sd=[]; $.each($(tbl)[0].rows,function(i,r){ sd[i] = r; }); sd.sort(function(a,b){ if(a.rp &gt; b.rp) {return 1;} if(a.rp &lt; b.rp) {return -1;} return 0; }); $.each(sd, function(index, row) { $('tbody',tbl).append(row); }); } p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID); var bt = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;).append(frm).append(&quot;&lt;table border='0' class='EditTable' id='&quot;+frmtb+&quot;_2'&gt;&lt;tbody&gt;&lt;tr id='Act_Buttons'&gt;&lt;td class='navButton' width='&quot;+p.labelswidth+&quot;'&gt;&quot;+(rtlb ? bN+bP : bP+bN)+&quot;&lt;/td&gt;&lt;td class='EditButton'&gt;&quot;+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;); $.jgrid.createModal(IDs,bt,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id))[0]); if(rtlb) { $(&quot;#pData, #nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).css(&quot;float&quot;,&quot;right&quot;); $(&quot;.EditButton&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).css(&quot;text-align&quot;,&quot;left&quot;); } if(!p.viewPagerButtons) {$(&quot;#pData, #nData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).hide();} bt = null; $(&quot;#&quot;+IDs.themodal).keydown( function( e ) { if(e.which === 27) { if(rp_ge[$t.p.id].closeOnEscape) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:p.gbox,jqm:p.jqModal, onClose: p.onClose});} return false; } if(p.navkeys[0]===true) { if(e.which === p.navkeys[1]){ //up $(&quot;#pData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } if(e.which === p.navkeys[2]){ //down $(&quot;#nData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).trigger(&quot;click&quot;); return false; } } }); p.closeicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-close&quot;],p.closeicon); if(p.closeicon[0]===true) { $(&quot;#cData&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).addClass(p.closeicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.closeicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if($.isFunction(p.beforeShowForm)) {p.beforeShowForm.call($t,$(&quot;#&quot;+frmgr));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal,overlay: p.overlay, modal:p.modal}); $(&quot;.fm-button:not(.ui-state-disabled)&quot;,&quot;#&quot;+frmtb+&quot;_2&quot;).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); focusaref(); $(&quot;#cData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){ $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: p.onClose}); return false; }); $(&quot;#nData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){ $(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide(); var npos = getCurrPos(); npos[0] = parseInt(npos[0],10); if(npos[0] != -1 &amp;&amp; npos[1][npos[0]+1]) { if($.isFunction(p.onclickPgButtons)) { p.onclickPgButtons.call($t,'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]]); } fillData(npos[1][npos[0]+1],$t); $($t).jqGrid(&quot;setSelection&quot;,npos[1][npos[0]+1]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t,'next',$(&quot;#&quot;+frmgr),npos[1][npos[0]+1]); } updateNav(npos[0]+1,npos); } focusaref(); return false; }); $(&quot;#pData&quot;, &quot;#&quot;+frmtb+&quot;_2&quot;).click(function(){ $(&quot;#FormError&quot;,&quot;#&quot;+frmtb).hide(); var ppos = getCurrPos(); if(ppos[0] != -1 &amp;&amp; ppos[1][ppos[0]-1]) { if($.isFunction(p.onclickPgButtons)) { p.onclickPgButtons.call($t,'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]]); } fillData(ppos[1][ppos[0]-1],$t); $($t).jqGrid(&quot;setSelection&quot;,ppos[1][ppos[0]-1]); if($.isFunction(p.afterclickPgButtons)) { p.afterclickPgButtons.call($t,'prev',$(&quot;#&quot;+frmgr),ppos[1][ppos[0]-1]); } updateNav(ppos[0]-1,ppos); } focusaref(); return false; }); } var posInit =getCurrPos(); updateNav(posInit[0],posInit); }); }, delGridRow : function(rowids,p) { p = $.extend(true, { top : 0, left: 0, width: 240, height: 'auto', dataheight : 'auto', modal: false, overlay: 30, drag: true, resize: true, url : '', mtype : &quot;POST&quot;, reloadAfterSubmit: true, beforeShowForm: null, beforeInitData : null, afterShowForm: null, beforeSubmit: null, onclickSubmit: null, afterSubmit: null, jqModal : true, closeOnEscape : false, delData: {}, delicon : [], cancelicon : [], onClose : null, ajaxDelOptions : {}, processing : false, serializeDelData : null, useDataProxy : false }, $.jgrid.del, p ||{}); rp_ge[$(this)[0].p.id] = p; return this.each(function(){ var $t = this; if (!$t.grid ) {return;} if(!rowids) {return;} var onBeforeShow = $.isFunction( rp_ge[$t.p.id].beforeShowForm ), onAfterShow = $.isFunction( rp_ge[$t.p.id].afterShowForm ), onBeforeInit = $.isFunction(rp_ge[$t.p.id].beforeInitData) ? rp_ge[$t.p.id].beforeInitData : false, gID = $t.p.id, onCS = {}, showFrm = true, dtbl = &quot;DelTbl_&quot;+$.jgrid.jqID(gID),postd, idname, opers, oper, dtbl_id = &quot;DelTbl_&quot; + gID, IDs = {themodal:'delmod'+gID,modalhead:'delhd'+gID,modalcontent:'delcnt'+gID, scrollelm: dtbl}; if ($.isArray(rowids)) {rowids = rowids.join();} if ( $(&quot;#&quot;+$.jgrid.jqID(IDs.themodal))[0] !== undefined ) { if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+dtbl)); if(showFrm === undefined) { showFrm = true; } } if(showFrm === false) {return;} $(&quot;#DelData&gt;td&quot;,&quot;#&quot;+dtbl).text(rowids); $(&quot;#DelError&quot;,&quot;#&quot;+dtbl).hide(); if( rp_ge[$t.p.id].processing === true) { rp_ge[$t.p.id].processing=false; $(&quot;#dData&quot;, &quot;#&quot;+dtbl).removeClass('ui-state-active'); } if(onBeforeShow) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+dtbl));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal,jqM: false, overlay: rp_ge[$t.p.id].overlay, modal:rp_ge[$t.p.id].modal}); if(onAfterShow) {rp_ge[$t.p.id].afterShowForm.call($t,$(&quot;#&quot;+dtbl));} } else { var dh = isNaN(rp_ge[$t.p.id].dataheight) ? rp_ge[$t.p.id].dataheight : rp_ge[$t.p.id].dataheight+&quot;px&quot;, dw = isNaN(p.datawidth) ? p.datawidth : p.datawidth+&quot;px&quot;, tbl = &quot;&lt;div id='&quot;+dtbl_id+&quot;' class='formdata' style='width:&quot;+dw+&quot;;overflow:auto;position:relative;height:&quot;+dh+&quot;;'&gt;&quot;; tbl += &quot;&lt;table class='DelTable'&gt;&lt;tbody&gt;&quot;; // error data tbl += &quot;&lt;tr id='DelError' style='display:none'&gt;&lt;td class='ui-state-error'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;; tbl += &quot;&lt;tr id='DelData' style='display:none'&gt;&lt;td &gt;&quot;+rowids+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; tbl += &quot;&lt;tr&gt;&lt;td class=\\&quot;delmsg\\&quot; style=\\&quot;white-space:pre;\\&quot;&gt;&quot;+rp_ge[$t.p.id].msg+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td &gt;&amp;#160;&lt;/td&gt;&lt;/tr&gt;&quot;; // buttons at footer tbl += &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;; var bS = &quot;&lt;a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bSubmit+&quot;&lt;/a&gt;&quot;, bC = &quot;&lt;a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'&gt;&quot;+p.bCancel+&quot;&lt;/a&gt;&quot;; tbl += &quot;&lt;table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='&quot;+dtbl+&quot;_2'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;hr class='ui-widget-content' style='margin:1px'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class='DelButton EditButton'&gt;&quot;+bS+&quot;&amp;#160;&quot;+bC+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;; p.gbox = &quot;#gbox_&quot;+$.jgrid.jqID(gID); $.jgrid.createModal(IDs,tbl,p,&quot;#gview_&quot;+$.jgrid.jqID($t.p.id),$(&quot;#gview_&quot;+$.jgrid.jqID($t.p.id))[0]); if(onBeforeInit) { showFrm = onBeforeInit.call($t,$(&quot;#&quot;+dtbl)); if(showFrm === undefined) { showFrm = true; } } if(showFrm === false) {return;} $(&quot;.fm-button&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).hover( function(){$(this).addClass('ui-state-hover');}, function(){$(this).removeClass('ui-state-hover');} ); p.delicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-scissors&quot;],rp_ge[$t.p.id].delicon); p.cancelicon = $.extend([true,&quot;left&quot;,&quot;ui-icon-cancel&quot;],rp_ge[$t.p.id].cancelicon); if(p.delicon[0]===true) { $(&quot;#dData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).addClass(p.delicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.delicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } if(p.cancelicon[0]===true) { $(&quot;#eData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).addClass(p.cancelicon[1] == &quot;right&quot; ? 'fm-button-icon-right' : 'fm-button-icon-left') .append(&quot;&lt;span class='ui-icon &quot;+p.cancelicon[2]+&quot;'&gt;&lt;/span&gt;&quot;); } $(&quot;#dData&quot;,&quot;#&quot;+dtbl+&quot;_2&quot;).click(function(){ var ret=[true,&quot;&quot;], pk, postdata = $(&quot;#DelData&gt;td&quot;,&quot;#&quot;+dtbl).text(); //the pair is name=val1,val2,... onCS = {}; if( $.isFunction( rp_ge[$t.p.id].onclickSubmit ) ) {onCS = rp_ge[$t.p.id].onclickSubmit.call($t,rp_ge[$t.p.id], postdata) || {};} if( $.isFunction( rp_ge[$t.p.id].beforeSubmit ) ) {ret = rp_ge[$t.p.id].beforeSubmit.call($t,postdata);} if(ret[0] &amp;&amp; !rp_ge[$t.p.id].processing) { rp_ge[$t.p.id].processing = true; opers = $t.p.prmNames; postd = $.extend({},rp_ge[$t.p.id].delData, onCS); oper = opers.oper; postd[oper] = opers.deloper; idname = opers.id; postdata = String(postdata).split(&quot;,&quot;); if(!postdata.length) { return false; } for(pk in postdata) { if(postdata.hasOwnProperty(pk)) { postdata[pk] = $.jgrid.stripPref($t.p.idPrefix, postdata[pk]); } } postd[idname] = postdata.join(); $(this).addClass('ui-state-active'); var ajaxOptions = $.extend({ url: rp_ge[$t.p.id].url || $($t).jqGrid('getGridParam','editurl'), type: rp_ge[$t.p.id].mtype, data: $.isFunction(rp_ge[$t.p.id].serializeDelData) ? rp_ge[$t.p.id].serializeDelData.call($t,postd) : postd, complete:function(data,status){ var i; if(status != &quot;success&quot;) { ret[0] = false; if ($.isFunction(rp_ge[$t.p.id].errorTextFormat)) { ret[1] = rp_ge[$t.p.id].errorTextFormat.call($t,data); } else { ret[1] = status + &quot; Status: '&quot; + data.statusText + &quot;'. Error code: &quot; + data.status; } } else { // data is posted successful // execute aftersubmit with the returned data from server if( $.isFunction( rp_ge[$t.p.id].afterSubmit ) ) { ret = rp_ge[$t.p.id].afterSubmit.call($t,data,postd); } } if(ret[0] === false) { $(&quot;#DelError&gt;td&quot;,&quot;#&quot;+dtbl).html(ret[1]); $(&quot;#DelError&quot;,&quot;#&quot;+dtbl).show(); } else { if(rp_ge[$t.p.id].reloadAfterSubmit &amp;&amp; $t.p.datatype != &quot;local&quot;) { $($t).trigger(&quot;reloadGrid&quot;); } else { if($t.p.treeGrid===true){ try {$($t).jqGrid(&quot;delTreeNode&quot;,$t.p.idPrefix+postdata[0]);} catch(e){} } else { for(i=0;i&lt;postdata.length;i++) { $($t).jqGrid(&quot;delRowData&quot;,$t.p.idPrefix+ postdata[i]); } } $t.p.selrow = null; $t.p.selarrrow = []; } if($.isFunction(rp_ge[$t.p.id].afterComplete)) { setTimeout(function(){rp_ge[$t.p.id].afterComplete.call($t,data,postdata);},500); } } rp_ge[$t.p.id].processing=false; $(&quot;#dData&quot;, &quot;#&quot;+dtbl+&quot;_2&quot;).removeClass('ui-state-active'); if(ret[0]) {$.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose});} } }, $.jgrid.ajaxOptions, rp_ge[$t.p.id].ajaxDelOptions); if (!ajaxOptions.url &amp;&amp; !rp_ge[$t.p.id].useDataProxy) { if ($.isFunction($t.p.dataProxy)) { rp_ge[$t.p.id].useDataProxy = true; } else { ret[0]=false;ret[1] += &quot; &quot;+$.jgrid.errors.nourl; } } if (ret[0]) { if (rp_ge[$t.p.id].useDataProxy) { var dpret = $t.p.dataProxy.call($t, ajaxOptions, &quot;del_&quot;+$t.p.id); if(dpret === undefined) { dpret = [true, &quot;&quot;]; } if(dpret[0] === false ) { ret[0] = false; ret[1] = dpret[1] || &quot;Error deleting the selected row!&quot; ; } else { $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:p.jqModal, onClose: rp_ge[$t.p.id].onClose}); } } else {$.ajax(ajaxOptions);} } } if(ret[0] === false) { $(&quot;#DelError&gt;td&quot;,&quot;#&quot;+dtbl).html(ret[1]); $(&quot;#DelError&quot;,&quot;#&quot;+dtbl).show(); } return false; }); $(&quot;#eData&quot;, &quot;#&quot;+dtbl+&quot;_2&quot;).click(function(){ $.jgrid.hideModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gb:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal, onClose: rp_ge[$t.p.id].onClose}); return false; }); if(onBeforeShow) {rp_ge[$t.p.id].beforeShowForm.call($t,$(&quot;#&quot;+dtbl));} $.jgrid.viewModal(&quot;#&quot;+$.jgrid.jqID(IDs.themodal),{gbox:&quot;#gbox_&quot;+$.jgrid.jqID(gID),jqm:rp_ge[$t.p.id].jqModal, overlay: rp_ge[$t.p.id].overlay, modal:rp_ge[$t.p.id].modal}); if(onAfterShow) {rp_ge[$t.p.id].afterShowForm.call($t,$(&quot;#&quot;+dtbl));} } if(rp_ge[$t.p.id].closeOnEscape===true) { setTimeout(function(){$(&quot;.ui-jqdialog-titlebar-close&quot;,&quot;#&quot;+$.jgrid.jqID(IDs.modalhead)).focus();},0); } }); }, navGrid : function (elem, o, pEdit,pAdd,pDel,pSearch, pView) { o = $.extend({ edit: true, editicon: &quot;ui-icon-pencil&quot;, add: true, addicon:&quot;ui-icon-plus&quot;, del: true, delicon:&quot;ui-icon-trash&quot;, search: true, searchicon:&quot;ui-icon-search&quot;, refresh: true, refreshicon:&quot;ui-icon-refresh&quot;, refreshstate: 'firstpage', view: false, viewicon : &quot;ui-icon-document&quot;, position : &quot;left&quot;, closeOnEscape : true, beforeRefresh : null, afterRefresh : null, cloneToTop : false, alertwidth : 200, alertheight : 'auto', alerttop: null, alertleft: null, alertzIndex : null }, $.jgrid.nav, o ||{}); return this.each(function() { if(this.nav) {return;} var alertIDs = {themodal: 'alertmod_' + this.p.id, modalhead: 'alerthd_' + this.p.id,modalcontent: 'alertcnt_' + this.p.id}, $t = this, twd, tdw; if(!$t.grid || typeof elem !== 'string') {return;} if ($(&quot;#&quot;+alertIDs.themodal)[0] === undefined) { if(!o.alerttop &amp;&amp; !o.alertleft) { if (window.innerWidth !== undefined) { o.alertleft = window.innerWidth; o.alerttop = window.innerHeight; } else if (document.documentElement !== undefined &amp;&amp; document.documentElement.clientWidth !== undefined &amp;&amp; document.documentElement.clientWidth !== 0) { o.alertleft = document.documentElement.clientWidth; o.alerttop = document.documentElement.clientHeight; } else { o.alertleft=1024; o.alerttop=768; } o.alertleft = o.alertleft/2 - parseInt(o.alertwidth,10)/2; o.alerttop = o.alerttop/2-25; } $.jgrid.createModal(alertIDs, &quot;&lt;div&gt;&quot;+o.alerttext+&quot;&lt;/div&gt;&lt;span tabindex='0'&gt;&lt;span tabindex='-1' id='jqg_alrt'&gt;&lt;/span&gt;&lt;/span&gt;&quot;, { gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id), jqModal:true, drag:true, resize:true, caption:o.alertcap, top:o.alerttop, left:o.alertleft, width:o.alertwidth, height: o.alertheight, closeOnEscape:o.closeOnEscape, zIndex: o.alertzIndex }, &quot;#gview_&quot;+$.jgrid.jqID($t.p.id), $(&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id))[0], true ); } var clone = 1, i, onHoverIn = function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass(&quot;ui-state-hover&quot;); } }, onHoverOut = function () { $(this).removeClass(&quot;ui-state-hover&quot;); }; if(o.cloneToTop &amp;&amp; $t.p.toppager) {clone = 2;} for(i = 0; i&lt;clone; i++) { var tbd, navtbl = $(&quot;&lt;table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'&gt;&lt;tbody&gt;&lt;tr&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), sep = &quot;&lt;td class='ui-pg-button ui-state-disabled' style='width:4px;'&gt;&lt;span class='ui-separator'&gt;&lt;/span&gt;&lt;/td&gt;&quot;, pgid, elemids; if(i===0) { pgid = elem; elemids = $t.p.id; if(pgid == $t.p.toppager) { elemids += &quot;_top&quot;; clone = 1; } } else { pgid = $t.p.toppager; elemids = $t.p.id+&quot;_top&quot;; } if($t.p.direction == &quot;rtl&quot;) {$(navtbl).attr(&quot;dir&quot;,&quot;rtl&quot;).css(&quot;float&quot;,&quot;right&quot;);} if (o.add) { pAdd = pAdd || {}; tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.addicon+&quot;'&gt;&lt;/span&gt;&quot;+o.addtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.addtitle || &quot;&quot;,id : pAdd.id || &quot;add_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { if ($.isFunction( o.addfunc )) { o.addfunc.call($t); } else { $($t).jqGrid(&quot;editGridRow&quot;,&quot;new&quot;,pAdd); } } return false; }).hover(onHoverIn, onHoverOut); tbd = null; } if (o.edit) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pEdit = pEdit || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.editicon+&quot;'&gt;&lt;/span&gt;&quot;+o.edittext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.edittitle || &quot;&quot;,id: pEdit.id || &quot;edit_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { var sr = $t.p.selrow; if (sr) { if($.isFunction( o.editfunc ) ) { o.editfunc.call($t, sr); } else { $($t).jqGrid(&quot;editGridRow&quot;,sr,pEdit); } } else { $.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true}); $(&quot;#jqg_alrt&quot;).focus(); } } return false; }).hover(onHoverIn, onHoverOut); tbd = null; } if (o.view) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pView = pView || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.viewicon+&quot;'&gt;&lt;/span&gt;&quot;+o.viewtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.viewtitle || &quot;&quot;,id: pView.id || &quot;view_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { var sr = $t.p.selrow; if (sr) { if($.isFunction( o.viewfunc ) ) { o.viewfunc.call($t, sr); } else { $($t).jqGrid(&quot;viewGridRow&quot;,sr,pView); } } else { $.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true}); $(&quot;#jqg_alrt&quot;).focus(); } } return false; }).hover(onHoverIn, onHoverOut); tbd = null; } if (o.del) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pDel = pDel || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.delicon+&quot;'&gt;&lt;/span&gt;&quot;+o.deltext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.deltitle || &quot;&quot;,id: pDel.id || &quot;del_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { var dr; if($t.p.multiselect) { dr = $t.p.selarrrow; if(dr.length===0) {dr = null;} } else { dr = $t.p.selrow; } if(dr){ if($.isFunction( o.delfunc )){ o.delfunc.call($t, dr); }else{ $($t).jqGrid(&quot;delGridRow&quot;,dr,pDel); } } else { $.jgrid.viewModal(&quot;#&quot;+alertIDs.themodal,{gbox:&quot;#gbox_&quot;+$.jgrid.jqID($t.p.id),jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } return false; }).hover(onHoverIn, onHoverOut); tbd = null; } if(o.add || o.edit || o.del || o.view) {$(&quot;tr&quot;,navtbl).append(sep);} if (o.search) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); pSearch = pSearch || {}; $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.searchicon+&quot;'&gt;&lt;/span&gt;&quot;+o.searchtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.searchtitle || &quot;&quot;,id:pSearch.id || &quot;search_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { if($.isFunction( o.searchfunc )) { o.searchfunc.call($t, pSearch); } else { $($t).jqGrid(&quot;searchGrid&quot;,pSearch); } } return false; }).hover(onHoverIn, onHoverOut); if (pSearch.showOnLoad &amp;&amp; pSearch.showOnLoad === true) { $(tbd,navtbl).click(); } tbd = null; } if (o.refresh) { tbd = $(&quot;&lt;td class='ui-pg-button ui-corner-all'&gt;&lt;/td&gt;&quot;); $(tbd).append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+o.refreshicon+&quot;'&gt;&lt;/span&gt;&quot;+o.refreshtext+&quot;&lt;/div&gt;&quot;); $(&quot;tr&quot;,navtbl).append(tbd); $(tbd,navtbl) .attr({&quot;title&quot;:o.refreshtitle || &quot;&quot;,id: &quot;refresh_&quot;+elemids}) .click(function(){ if (!$(this).hasClass('ui-state-disabled')) { if($.isFunction(o.beforeRefresh)) {o.beforeRefresh.call($t);} $t.p.search = false; try { var gID = $t.p.id; $t.p.postData.filters =&quot;&quot;; $(&quot;#fbox_&quot;+$.jgrid.jqID(gID)).jqFilter('resetFilter'); if($.isFunction($t.clearToolbar)) {$t.clearToolbar.call($t,false);} } catch (e) {} switch (o.refreshstate) { case 'firstpage': $($t).trigger(&quot;reloadGrid&quot;, [{page:1}]); break; case 'current': $($t).trigger(&quot;reloadGrid&quot;, [{current:true}]); break; } if($.isFunction(o.afterRefresh)) {o.afterRefresh.call($t);} } return false; }).hover(onHoverIn, onHoverOut); tbd = null; } tdw = $(&quot;.ui-jqgrid&quot;).css(&quot;font-size&quot;) || &quot;11px&quot;; $('body').append(&quot;&lt;div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:&quot;+tdw+&quot;;visibility:hidden;' &gt;&lt;/div&gt;&quot;); twd = $(navtbl).clone().appendTo(&quot;#testpg2&quot;).width(); $(&quot;#testpg2&quot;).remove(); $(pgid+&quot;_&quot;+o.position,pgid).append(navtbl); if($t.p._nvtd) { if(twd &gt; $t.p._nvtd[0] ) { $(pgid+&quot;_&quot;+o.position,pgid).width(twd); $t.p._nvtd[0] = twd; } $t.p._nvtd[1] = twd; } tdw =null;twd=null;navtbl =null; this.nav = true; } }); }, navButtonAdd : function (elem, p) { p = $.extend({ caption : &quot;newButton&quot;, title: '', buttonicon : 'ui-icon-newwin', onClickButton: null, position : &quot;last&quot;, cursor : 'pointer' }, p ||{}); return this.each(function() { if( !this.grid) {return;} if( typeof elem === &quot;string&quot; &amp;&amp; elem.indexOf(&quot;#&quot;) !== 0) {elem = &quot;#&quot;+$.jgrid.jqID(elem);} var findnav = $(&quot;.navtable&quot;,elem)[0], $t = this; if (findnav) { if( p.id &amp;&amp; $(&quot;#&quot;+$.jgrid.jqID(p.id), findnav)[0] !== undefined ) {return;} var tbd = $(&quot;&lt;td&gt;&lt;/td&gt;&quot;); if(p.buttonicon.toString().toUpperCase() == &quot;NONE&quot;) { $(tbd).addClass('ui-pg-button ui-corner-all').append(&quot;&lt;div class='ui-pg-div'&gt;&quot;+p.caption+&quot;&lt;/div&gt;&quot;); } else { $(tbd).addClass('ui-pg-button ui-corner-all').append(&quot;&lt;div class='ui-pg-div'&gt;&lt;span class='ui-icon &quot;+p.buttonicon+&quot;'&gt;&lt;/span&gt;&quot;+p.caption+&quot;&lt;/div&gt;&quot;); } if(p.id) {$(tbd).attr(&quot;id&quot;,p.id);} if(p.position=='first'){ if(findnav.rows[0].cells.length ===0 ) { $(&quot;tr&quot;,findnav).append(tbd); } else { $(&quot;tr td:eq(0)&quot;,findnav).before(tbd); } } else { $(&quot;tr&quot;,findnav).append(tbd); } $(tbd,findnav) .attr(&quot;title&quot;,p.title || &quot;&quot;) .click(function(e){ if (!$(this).hasClass('ui-state-disabled')) { if ($.isFunction(p.onClickButton) ) {p.onClickButton.call($t,e);} } return false; }) .hover( function () { if (!$(this).hasClass('ui-state-disabled')) { $(this).addClass('ui-state-hover'); } }, function () {$(this).removeClass(&quot;ui-state-hover&quot;);} ); } }); }, navSeparatorAdd:function (elem,p) { p = $.extend({ sepclass : &quot;ui-separator&quot;, sepcontent: '', position : &quot;last&quot; }, p ||{}); return this.each(function() { if( !this.grid) {return;} if( typeof elem === &quot;string&quot; &amp;&amp; elem.indexOf(&quot;#&quot;) !== 0) {elem = &quot;#&quot;+$.jgrid.jqID(elem);} var findnav = $(&quot;.navtable&quot;,elem)[0]; if(findnav) { var sep = &quot;&lt;td class='ui-pg-button ui-state-disabled' style='width:4px;'&gt;&lt;span class='&quot;+p.sepclass+&quot;'&gt;&lt;/span&gt;&quot;+p.sepcontent+&quot;&lt;/td&gt;&quot;; if (p.position === 'first') { if (findnav.rows[0].cells.length === 0) { $(&quot;tr&quot;, findnav).append(sep); } else { $(&quot;tr td:eq(0)&quot;, findnav).before(sep); } } else { $(&quot;tr&quot;, findnav).append(sep); } } }); }, GridToForm : function( rowid, formid ) { return this.each(function(){ var $t = this, i; if (!$t.grid) {return;} var rowdata = $($t).jqGrid(&quot;getRowData&quot;,rowid); if (rowdata) { for(i in rowdata) { if(rowdata.hasOwnProperty(i)) { if ( $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).is(&quot;input:radio&quot;) || $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).is(&quot;input:checkbox&quot;)) { $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).each( function() { if( $(this).val() == rowdata[i] ) { $(this)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); } else { $(this)[$t.p.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); } }); } else { // this is very slow on big table and form. $(&quot;[name=&quot;+$.jgrid.jqID(i)+&quot;]&quot;,formid).val(rowdata[i]); } } } } }); }, FormToGrid : function(rowid, formid, mode, position){ return this.each(function() { var $t = this; if(!$t.grid) {return;} if(!mode) {mode = 'set';} if(!position) {position = 'first';} var fields = $(formid).serializeArray(); var griddata = {}; $.each(fields, function(i, field){ griddata[field.name] = field.value; }); if(mode=='add') {$($t).jqGrid(&quot;addRowData&quot;,rowid,griddata, position);} else if(mode=='set') {$($t).jqGrid(&quot;setRowData&quot;,rowid,griddata);} }); } }); })(jQuery); /*jshint eqeqeq:false, eqnull:true, devel:true */ /*global jQuery */ (function($){ /** * jqGrid extension for manipulating Grid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; $.jgrid.inlineEdit = $.jgrid.inlineEdit || {}; $.jgrid.extend({ //Editing editRow : function(rowid,keys,oneditfunc,successfunc, url, extraparam, aftersavefunc,errorfunc, afterrestorefunc) { // Compatible mode old versions var o={}, args = $.makeArray(arguments).slice(1); if( $.type(args[0]) === &quot;object&quot; ) { o = args[0]; } else { if (keys !== undefined) { o.keys = keys; } if ($.isFunction(oneditfunc)) { o.oneditfunc = oneditfunc; } if ($.isFunction(successfunc)) { o.successfunc = successfunc; } if (url !== undefined) { o.url = url; } if (extraparam !== undefined) { o.extraparam = extraparam; } if ($.isFunction(aftersavefunc)) { o.aftersavefunc = aftersavefunc; } if ($.isFunction(errorfunc)) { o.errorfunc = errorfunc; } if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; } // last two not as param, but as object (sorry) //if (restoreAfterError !== undefined) { o.restoreAfterError = restoreAfterError; } //if (mtype !== undefined) { o.mtype = mtype || &quot;POST&quot;; } } o = $.extend(true, { keys : false, oneditfunc: null, successfunc: null, url: null, extraparam: {}, aftersavefunc: null, errorfunc: null, afterrestorefunc: null, restoreAfterError: true, mtype: &quot;POST&quot; }, $.jgrid.inlineEdit, o ); // End compatible return this.each(function(){ var $t = this, nm, tmp, editable, cnt=0, focus=null, svr={}, ind,cm; if (!$t.grid ) { return; } ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true); if( ind === false ) {return;} editable = $(ind).attr(&quot;editable&quot;) || &quot;0&quot;; if (editable == &quot;0&quot; &amp;&amp; !$(ind).hasClass(&quot;not-editable-row&quot;)) { cm = $t.p.colModel; $('td[role=&quot;gridcell&quot;]',ind).each( function(i) { nm = cm[i].name; var treeg = $t.p.treeGrid===true &amp;&amp; nm == $t.p.ExpandColumn; if(treeg) { tmp = $(&quot;span:first&quot;,this).html();} else { try { tmp = $.unformat.call($t,this,{rowId:rowid, colModel:cm[i]},i); } catch (_) { tmp = ( cm[i].edittype &amp;&amp; cm[i].edittype == 'textarea' ) ? $(this).text() : $(this).html(); } } if ( nm != 'cb' &amp;&amp; nm != 'subgrid' &amp;&amp; nm != 'rn') { if($t.p.autoencode) { tmp = $.jgrid.htmlDecode(tmp); } svr[nm]=tmp; if(cm[i].editable===true) { if(focus===null) { focus = i; } if (treeg) { $(&quot;span:first&quot;,this).html(&quot;&quot;); } else { $(this).html(&quot;&quot;); } var opt = $.extend({},cm[i].editoptions || {},{id:rowid+&quot;_&quot;+nm,name:nm}); if(!cm[i].edittype) { cm[i].edittype = &quot;text&quot;; } if(tmp == &quot;&amp;nbsp;&quot; || tmp == &quot;&amp;#160;&quot; || (tmp.length==1 &amp;&amp; tmp.charCodeAt(0)==160) ) {tmp='';} var elc = $.jgrid.createEl.call($t,cm[i].edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions || {})); $(elc).addClass(&quot;editable&quot;); if(treeg) { $(&quot;span:first&quot;,this).append(elc); } else { $(this).append(elc); } $.jgrid.bindEv( elc, opt, $t); //Again IE if(cm[i].edittype == &quot;select&quot; &amp;&amp; cm[i].editoptions!==undefined &amp;&amp; cm[i].editoptions.multiple===true &amp;&amp; cm[i].editoptions.dataUrl===undefined &amp;&amp; $.jgrid.msie) { $(elc).width($(elc).width()); } cnt++; } } }); if(cnt &gt; 0) { svr.id = rowid; $t.p.savedRow.push(svr); $(ind).attr(&quot;editable&quot;,&quot;1&quot;); $(&quot;td:eq(&quot;+focus+&quot;) input&quot;,ind).focus(); if(o.keys===true) { $(ind).bind(&quot;keydown&quot;,function(e) { if (e.keyCode === 27) { $($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc); if($t.p._inlinenav) { try { $($t).jqGrid('showAddEditButtons'); } catch (eer1) {} } return false; } if (e.keyCode === 13) { var ta = e.target; if(ta.tagName == 'TEXTAREA') { return true; } if( $($t).jqGrid(&quot;saveRow&quot;, rowid, o ) ) { if($t.p._inlinenav) { try { $($t).jqGrid('showAddEditButtons'); } catch (eer2) {} } } return false; } }); } $($t).triggerHandler(&quot;jqGridInlineEditRow&quot;, [rowid, o]); if( $.isFunction(o.oneditfunc)) { o.oneditfunc.call($t, rowid); } } } }); }, saveRow : function(rowid, successfunc, url, extraparam, aftersavefunc,errorfunc, afterrestorefunc) { // Compatible mode old versions var args = $.makeArray(arguments).slice(1), o = {}; if( $.type(args[0]) === &quot;object&quot; ) { o = args[0]; } else { if ($.isFunction(successfunc)) { o.successfunc = successfunc; } if (url !== undefined) { o.url = url; } if (extraparam !== undefined) { o.extraparam = extraparam; } if ($.isFunction(aftersavefunc)) { o.aftersavefunc = aftersavefunc; } if ($.isFunction(errorfunc)) { o.errorfunc = errorfunc; } if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; } } o = $.extend(true, { successfunc: null, url: null, extraparam: {}, aftersavefunc: null, errorfunc: null, afterrestorefunc: null, restoreAfterError: true, mtype: &quot;POST&quot; }, $.jgrid.inlineEdit, o ); // End compatible var success = false; var $t = this[0], nm, tmp={}, tmp2={}, tmp3= {}, editable, fr, cv, ind; if (!$t.grid ) { return success; } ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true); if(ind === false) {return success;} editable = $(ind).attr(&quot;editable&quot;); o.url = o.url || $t.p.editurl; if (editable===&quot;1&quot;) { var cm; $('td[role=&quot;gridcell&quot;]',ind).each(function(i) { cm = $t.p.colModel[i]; nm = cm.name; if ( nm != 'cb' &amp;&amp; nm != 'subgrid' &amp;&amp; cm.editable===true &amp;&amp; nm != 'rn' &amp;&amp; !$(this).hasClass('not-editable-cell')) { switch (cm.edittype) { case &quot;checkbox&quot;: var cbv = [&quot;Yes&quot;,&quot;No&quot;]; if(cm.editoptions ) { cbv = cm.editoptions.value.split(&quot;:&quot;); } tmp[nm]= $(&quot;input&quot;,this).is(&quot;:checked&quot;) ? cbv[0] : cbv[1]; break; case 'text': case 'password': case 'textarea': case &quot;button&quot; : tmp[nm]=$(&quot;input, textarea&quot;,this).val(); break; case 'select': if(!cm.editoptions.multiple) { tmp[nm] = $(&quot;select option:selected&quot;,this).val(); tmp2[nm] = $(&quot;select option:selected&quot;, this).text(); } else { var sel = $(&quot;select&quot;,this), selectedText = []; tmp[nm] = $(sel).val(); if(tmp[nm]) { tmp[nm]= tmp[nm].join(&quot;,&quot;); } else { tmp[nm] =&quot;&quot;; } $(&quot;select option:selected&quot;,this).each( function(i,selected){ selectedText[i] = $(selected).text(); } ); tmp2[nm] = selectedText.join(&quot;,&quot;); } if(cm.formatter &amp;&amp; cm.formatter == 'select') { tmp2={}; } break; case 'custom' : try { if(cm.editoptions &amp;&amp; $.isFunction(cm.editoptions.custom_value)) { tmp[nm] = cm.editoptions.custom_value.call($t, $(&quot;.customelement&quot;,this),'get'); if (tmp[nm] === undefined) { throw &quot;e2&quot;; } } else { throw &quot;e1&quot;; } } catch (e) { if (e==&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose); } if (e==&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose); } else { $.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose); } } break; } cv = $.jgrid.checkValues(tmp[nm],i,$t); if(cv[0] === false) { cv[1] = tmp[nm] + &quot; &quot; + cv[1]; return false; } if($t.p.autoencode) { tmp[nm] = $.jgrid.htmlEncode(tmp[nm]); } if(o.url !== 'clientArray' &amp;&amp; cm.editoptions &amp;&amp; cm.editoptions.NullIfEmpty === true) { if(tmp[nm] === &quot;&quot;) { tmp3[nm] = 'null'; } } } }); if (cv[0] === false){ try { var positions = $.jgrid.findPos($(&quot;#&quot;+$.jgrid.jqID(rowid), $t.grid.bDiv)[0]); $.jgrid.info_dialog($.jgrid.errors.errcap,cv[1],$.jgrid.edit.bClose,{left:positions[0],top:positions[1]}); } catch (e) { alert(cv[1]); } return success; } var idname, opers = $t.p.prmNames, oldRowId = rowid; if ($t.p.keyIndex === false) { idname = opers.id; } else { idname = $t.p.colModel[$t.p.keyIndex + ($t.p.rownumbers === true ? 1 : 0) + ($t.p.multiselect === true ? 1 : 0) + ($t.p.subGrid === true ? 1 : 0)].name; } if(tmp) { tmp[opers.oper] = opers.editoper; if (tmp[idname] === undefined) { tmp[idname] = rowid; } else if (ind.id !== $t.p.idPrefix + tmp[idname]) { // rename rowid var oldid = $.jgrid.stripPref($t.p.idPrefix, rowid); if ($t.p._index[oldid] !== undefined) { $t.p._index[tmp[idname]] = $t.p._index[oldid]; delete $t.p._index[oldid]; } rowid = $t.p.idPrefix + tmp[idname]; $(ind).attr(&quot;id&quot;, rowid); if ($t.p.selrow === oldRowId) { $t.p.selrow = rowid; } if ($.isArray($t.p.selarrrow)) { var i = $.inArray(oldRowId, $t.p.selarrrow); if (i&gt;=0) { $t.p.selarrrow[i] = rowid; } } if ($t.p.multiselect) { var newCboxId = &quot;jqg_&quot; + $t.p.id + &quot;_&quot; + rowid; $(&quot;input.cbox&quot;,ind) .attr(&quot;id&quot;, newCboxId) .attr(&quot;name&quot;, newCboxId); } // TODO: to test the case of frozen columns } if($t.p.inlineData === undefined) { $t.p.inlineData ={}; } tmp = $.extend({},tmp,$t.p.inlineData,o.extraparam); } if (o.url == 'clientArray') { tmp = $.extend({},tmp, tmp2); if($t.p.autoencode) { $.each(tmp,function(n,v){ tmp[n] = $.jgrid.htmlDecode(v); }); } var k, resp = $($t).jqGrid(&quot;setRowData&quot;,rowid,tmp); $(ind).attr(&quot;editable&quot;,&quot;0&quot;); for(k=0;k&lt;$t.p.savedRow.length;k++) { if( $t.p.savedRow[k].id == oldRowId) {fr = k; break;} } if(fr &gt;= 0) { $t.p.savedRow.splice(fr,1); } $($t).triggerHandler(&quot;jqGridInlineAfterSaveRow&quot;, [rowid, resp, tmp, o]); if( $.isFunction(o.aftersavefunc) ) { o.aftersavefunc.call($t, rowid,resp, o); } success = true; $(ind).unbind(&quot;keydown&quot;); } else { $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).show(); tmp3 = $.extend({},tmp,tmp3); tmp3[idname] = $.jgrid.stripPref($t.p.idPrefix, tmp3[idname]); $.ajax($.extend({ url:o.url, data: $.isFunction($t.p.serializeRowData) ? $t.p.serializeRowData.call($t, tmp3) : tmp3, type: o.mtype, async : false, //?!? complete: function(res,stat){ $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide(); if (stat === &quot;success&quot;){ var ret = true, sucret, k; sucret = $($t).triggerHandler(&quot;jqGridInlineSuccessSaveRow&quot;, [res, rowid, o]); if (!$.isArray(sucret)) {sucret = [true, tmp];} if (sucret[0] &amp;&amp; $.isFunction(o.successfunc)) {sucret = o.successfunc.call($t, res);} if($.isArray(sucret)) { // expect array - status, data, rowid ret = sucret[0]; tmp = sucret[1] || tmp; } else { ret = sucret; } if (ret===true) { if($t.p.autoencode) { $.each(tmp,function(n,v){ tmp[n] = $.jgrid.htmlDecode(v); }); } tmp = $.extend({},tmp, tmp2); $($t).jqGrid(&quot;setRowData&quot;,rowid,tmp); $(ind).attr(&quot;editable&quot;,&quot;0&quot;); for(k=0;k&lt;$t.p.savedRow.length;k++) { if( $t.p.savedRow[k].id == rowid) {fr = k; break;} } if(fr &gt;= 0) { $t.p.savedRow.splice(fr,1); } $($t).triggerHandler(&quot;jqGridInlineAfterSaveRow&quot;, [rowid, res, tmp, o]); if( $.isFunction(o.aftersavefunc) ) { o.aftersavefunc.call($t, rowid,res); } success = true; $(ind).unbind(&quot;keydown&quot;); } else { $($t).triggerHandler(&quot;jqGridInlineErrorSaveRow&quot;, [rowid, res, stat, null, o]); if($.isFunction(o.errorfunc) ) { o.errorfunc.call($t, rowid, res, stat, null); } if(o.restoreAfterError === true) { $($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc); } } } }, error:function(res,stat,err){ $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide(); $($t).triggerHandler(&quot;jqGridInlineErrorSaveRow&quot;, [rowid, res, stat, err, o]); if($.isFunction(o.errorfunc) ) { o.errorfunc.call($t, rowid, res, stat, err); } else { var rT = res.responseText || res.statusText; try { $.jgrid.info_dialog($.jgrid.errors.errcap,'&lt;div class=&quot;ui-state-error&quot;&gt;'+ rT +'&lt;/div&gt;', $.jgrid.edit.bClose,{buttonalign:'right'}); } catch(e) { alert(rT); } } if(o.restoreAfterError === true) { $($t).jqGrid(&quot;restoreRow&quot;,rowid, o.afterrestorefunc); } } }, $.jgrid.ajaxOptions, $t.p.ajaxRowOptions || {})); } } return success; }, restoreRow : function(rowid, afterrestorefunc) { // Compatible mode old versions var args = $.makeArray(arguments).slice(1), o={}; if( $.type(args[0]) === &quot;object&quot; ) { o = args[0]; } else { if ($.isFunction(afterrestorefunc)) { o.afterrestorefunc = afterrestorefunc; } } o = $.extend(true, $.jgrid.inlineEdit, o ); // End compatible return this.each(function(){ var $t= this, fr, ind, ares={}, k; if (!$t.grid ) { return; } ind = $($t).jqGrid(&quot;getInd&quot;,rowid,true); if(ind === false) {return;} for(k=0;k&lt;$t.p.savedRow.length;k++) { if( $t.p.savedRow[k].id == rowid) {fr = k; break;} } if(fr &gt;= 0) { if($.isFunction($.fn.datepicker)) { try { $(&quot;input.hasDatepicker&quot;,&quot;#&quot;+$.jgrid.jqID(ind.id)).datepicker('hide'); } catch (e) {} } $.each($t.p.colModel, function(){ if(this.editable === true &amp;&amp; $t.p.savedRow[fr].hasOwnProperty(this.name)) { ares[this.name] = $t.p.savedRow[fr][this.name]; } }); $($t).jqGrid(&quot;setRowData&quot;,rowid,ares); $(ind).attr(&quot;editable&quot;,&quot;0&quot;).unbind(&quot;keydown&quot;); $t.p.savedRow.splice(fr,1); if($(&quot;#&quot;+$.jgrid.jqID(rowid), &quot;#&quot;+$.jgrid.jqID($t.p.id)).hasClass(&quot;jqgrid-new-row&quot;)){ setTimeout(function(){$($t).jqGrid(&quot;delRowData&quot;,rowid);},0); } } $($t).triggerHandler(&quot;jqGridInlineAfterRestoreRow&quot;, [rowid]); if ($.isFunction(o.afterrestorefunc)) { o.afterrestorefunc.call($t, rowid); } }); }, addRow : function ( p ) { p = $.extend(true, { rowID : null, initdata : {}, position :&quot;first&quot;, useDefValues : true, useFormatter : false, addRowParams : {extraparam:{}} },p || {}); return this.each(function(){ if (!this.grid ) { return; } var $t = this; p.rowID = $.isFunction(p.rowID) ? p.rowID.call($t, p) : ( (p.rowID != null) ? p.rowID : $.jgrid.randId()); if(p.useDefValues === true) { $($t.p.colModel).each(function(){ if( this.editoptions &amp;&amp; this.editoptions.defaultValue ) { var opt = this.editoptions.defaultValue, tmp = $.isFunction(opt) ? opt.call($t) : opt; p.initdata[this.name] = tmp; } }); } $($t).jqGrid('addRowData', p.rowID, p.initdata, p.position); p.rowID = $t.p.idPrefix + p.rowID; $(&quot;#&quot;+$.jgrid.jqID(p.rowID), &quot;#&quot;+$.jgrid.jqID($t.p.id)).addClass(&quot;jqgrid-new-row&quot;); if(p.useFormatter) { $(&quot;#&quot;+$.jgrid.jqID(p.rowID)+&quot; .ui-inline-edit&quot;, &quot;#&quot;+$.jgrid.jqID($t.p.id)).click(); } else { var opers = $t.p.prmNames, oper = opers.oper; p.addRowParams.extraparam[oper] = opers.addoper; $($t).jqGrid('editRow', p.rowID, p.addRowParams); $($t).jqGrid('setSelection', p.rowID); } }); }, inlineNav : function (elem, o) { o = $.extend({ edit: true, editicon: &quot;ui-icon-pencil&quot;, add: true, addicon:&quot;ui-icon-plus&quot;, save: true, saveicon:&quot;ui-icon-disk&quot;, cancel: true, cancelicon:&quot;ui-icon-cancel&quot;, addParams : {}, editParams : {}, restoreAfterSelect : true }, $.jgrid.nav, o ||{}); return this.each(function(){ if (!this.grid ) { return; } var $t = this, onSelect, gID = $.jgrid.jqID($t.p.id); $t.p._inlinenav = true; // detect the formatactions column if(o.addParams.useFormatter === true) { var cm = $t.p.colModel,i; for (i = 0; i&lt;cm.length; i++) { if(cm[i].formatter &amp;&amp; cm[i].formatter === &quot;actions&quot; ) { if(cm[i].formatoptions) { var defaults = { keys:false, onEdit : null, onSuccess: null, afterSave:null, onError: null, afterRestore: null, extraparam: {}, url: null }, ap = $.extend( defaults, cm[i].formatoptions ); o.addParams.addRowParams = { &quot;keys&quot; : ap.keys, &quot;oneditfunc&quot; : ap.onEdit, &quot;successfunc&quot; : ap.onSuccess, &quot;url&quot; : ap.url, &quot;extraparam&quot; : ap.extraparam, &quot;aftersavefunc&quot; : ap.afterSavef, &quot;errorfunc&quot;: ap.onError, &quot;afterrestorefunc&quot; : ap.afterRestore }; } break; } } } if(o.add) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.addtext, title : o.addtitle, buttonicon : o.addicon, id : $t.p.id+&quot;_iladd&quot;, onClickButton : function () { $($t).jqGrid('addRow', o.addParams); if(!o.addParams.useFormatter) { $(&quot;#&quot;+gID+&quot;_ilsave&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iladd&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iledit&quot;).addClass('ui-state-disabled'); } } }); } if(o.edit) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.edittext, title : o.edittitle, buttonicon : o.editicon, id : $t.p.id+&quot;_iledit&quot;, onClickButton : function () { var sr = $($t).jqGrid('getGridParam','selrow'); if(sr) { $($t).jqGrid('editRow', sr, o.editParams); $(&quot;#&quot;+gID+&quot;_ilsave&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iladd&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iledit&quot;).addClass('ui-state-disabled'); } else { $.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } }); } if(o.save) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.savetext || '', title : o.savetitle || 'Save row', buttonicon : o.saveicon, id : $t.p.id+&quot;_ilsave&quot;, onClickButton : function () { var sr = $t.p.savedRow[0].id; if(sr) { var opers = $t.p.prmNames, oper = opers.oper; if(!o.editParams.extraparam) { o.editParams.extraparam = {}; } if($(&quot;#&quot;+$.jgrid.jqID(sr), &quot;#&quot;+gID ).hasClass(&quot;jqgrid-new-row&quot;)) { o.editParams.extraparam[oper] = opers.addoper; } else { o.editParams.extraparam[oper] = opers.editoper; } if( $($t).jqGrid('saveRow', sr, o.editParams) ) { $($t).jqGrid('showAddEditButtons'); } } else { $.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } }); $(&quot;#&quot;+gID+&quot;_ilsave&quot;).addClass('ui-state-disabled'); } if(o.cancel) { $($t).jqGrid('navButtonAdd', elem,{ caption : o.canceltext || '', title : o.canceltitle || 'Cancel row editing', buttonicon : o.cancelicon, id : $t.p.id+&quot;_ilcancel&quot;, onClickButton : function () { var sr = $t.p.savedRow[0].id; if(sr) { $($t).jqGrid('restoreRow', sr, o.editParams); $($t).jqGrid('showAddEditButtons'); } else { $.jgrid.viewModal(&quot;#alertmod&quot;,{gbox:&quot;#gbox_&quot;+gID,jqm:true});$(&quot;#jqg_alrt&quot;).focus(); } } }); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).addClass('ui-state-disabled'); } if(o.restoreAfterSelect === true) { if($.isFunction($t.p.beforeSelectRow)) { onSelect = $t.p.beforeSelectRow; } else { onSelect = false; } $t.p.beforeSelectRow = function(id, stat) { var ret = true; if($t.p.savedRow.length &gt; 0 &amp;&amp; $t.p._inlinenav===true &amp;&amp; ( id !== $t.p.selrow &amp;&amp; $t.p.selrow !==null) ) { if($t.p.selrow == o.addParams.rowID ) { $($t).jqGrid('delRowData', $t.p.selrow); } else { $($t).jqGrid('restoreRow', $t.p.selrow, o.editParams); } $($t).jqGrid('showAddEditButtons'); } if(onSelect) { ret = onSelect.call($t, id, stat); } return ret; }; } }); }, showAddEditButtons : function() { return this.each(function(){ if (!this.grid ) { return; } var gID = $.jgrid.jqID(this.p.id); $(&quot;#&quot;+gID+&quot;_ilsave&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_ilcancel&quot;).addClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iladd&quot;).removeClass('ui-state-disabled'); $(&quot;#&quot;+gID+&quot;_iledit&quot;).removeClass('ui-state-disabled'); }); } //end inline edit }); })(jQuery); /*jshint eqeqeq:false */ /*global jQuery */ (function($){ /* ** * jqGrid extension for cellediting Grid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ /** * all events and options here are aded anonynous and not in the base grid * since the array is to big. Here is the order of execution. * From this point we use jQuery isFunction * formatCell * beforeEditCell, * onSelectCell (used only for noneditable cels) * afterEditCell, * beforeSaveCell, (called before validation of values if any) * beforeSubmitCell (if cellsubmit remote (ajax)) * afterSubmitCell(if cellsubmit remote (ajax)), * afterSaveCell, * errorCell, * serializeCellData - new * Options * cellsubmit (remote,clientArray) (added in grid options) * cellurl * ajaxCellOptions * */ &quot;use strict&quot;; $.jgrid.extend({ editCell : function (iRow,iCol, ed){ return this.each(function (){ var $t = this, nm, tmp,cc, cm; if (!$t.grid || $t.p.cellEdit !== true) {return;} iCol = parseInt(iCol,10); // select the row that can be used for other methods $t.p.selrow = $t.rows[iRow].id; if (!$t.p.knv) {$($t).jqGrid(&quot;GridNav&quot;);} // check to see if we have already edited cell if ($t.p.savedRow.length&gt;0) { // prevent second click on that field and enable selects if (ed===true ) { if(iRow == $t.p.iRow &amp;&amp; iCol == $t.p.iCol){ return; } } // save the cell $($t).jqGrid(&quot;saveCell&quot;,$t.p.savedRow[0].id,$t.p.savedRow[0].ic); } else { window.setTimeout(function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0); } cm = $t.p.colModel[iCol]; nm = cm.name; if (nm=='subgrid' || nm=='cb' || nm=='rn') {return;} cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]); if (cm.editable===true &amp;&amp; ed===true &amp;&amp; !cc.hasClass(&quot;not-editable-cell&quot;)) { if(parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) { $(&quot;td:eq(&quot;+$t.p.iCol+&quot;)&quot;,$t.rows[$t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[$t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;); } $(cc).addClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[iRow]).addClass(&quot;selected-row ui-state-hover&quot;); try { tmp = $.unformat.call($t,cc,{rowId: $t.rows[iRow].id, colModel:cm},iCol); } catch (_) { tmp = ( cm.edittype &amp;&amp; cm.edittype == 'textarea' ) ? $(cc).text() : $(cc).html(); } if($t.p.autoencode) { tmp = $.jgrid.htmlDecode(tmp); } if (!cm.edittype) {cm.edittype = &quot;text&quot;;} $t.p.savedRow.push({id:iRow,ic:iCol,name:nm,v:tmp}); if(tmp === &quot;&amp;nbsp;&quot; || tmp === &quot;&amp;#160;&quot; || (tmp.length===1 &amp;&amp; tmp.charCodeAt(0)===160) ) {tmp='';} if($.isFunction($t.p.formatCell)) { var tmp2 = $t.p.formatCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); if(tmp2 !== undefined ) {tmp = tmp2;} } var opt = $.extend({}, cm.editoptions || {} ,{id:iRow+&quot;_&quot;+nm,name:nm}); var elc = $.jgrid.createEl.call($t,cm.edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions || {})); $($t).triggerHandler(&quot;jqGridBeforeEditCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]); if ($.isFunction($t.p.beforeEditCell)) { $t.p.beforeEditCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); } $(cc).html(&quot;&quot;).append(elc).attr(&quot;tabindex&quot;,&quot;0&quot;); $.jgrid.bindEv( elc, opt, $t); window.setTimeout(function () { $(elc).focus();},0); $(&quot;input, select, textarea&quot;,cc).bind(&quot;keydown&quot;,function(e) { if (e.keyCode === 27) { if($(&quot;input.hasDatepicker&quot;,cc).length &gt;0) { if( $(&quot;.ui-datepicker&quot;).is(&quot;:hidden&quot;) ) { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } else { $(&quot;input.hasDatepicker&quot;,cc).datepicker('hide'); } } else { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } //ESC if (e.keyCode === 13) { $($t).jqGrid(&quot;saveCell&quot;,iRow,iCol); // Prevent default action return false; } //Enter if (e.keyCode === 9) { if(!$t.grid.hDiv.loading ) { if (e.shiftKey) {$($t).jqGrid(&quot;prevCell&quot;,iRow,iCol);} //Shift TAb else {$($t).jqGrid(&quot;nextCell&quot;,iRow,iCol);} //Tab } else { return false; } } e.stopPropagation(); }); $($t).triggerHandler(&quot;jqGridAfterEditCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]); if ($.isFunction($t.p.afterEditCell)) { $t.p.afterEditCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); } } else { if (parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) { $(&quot;td:eq(&quot;+$t.p.iCol+&quot;)&quot;,$t.rows[$t.p.iRow]).removeClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[$t.p.iRow]).removeClass(&quot;selected-row ui-state-hover&quot;); } cc.addClass(&quot;edit-cell ui-state-highlight&quot;); $($t.rows[iRow]).addClass(&quot;selected-row ui-state-hover&quot;); tmp = cc.html().replace(/\\&amp;#160\\;/ig,''); $($t).triggerHandler(&quot;jqGridSelectCell&quot;, [$t.rows[iRow].id, nm, tmp, iRow, iCol]); if ($.isFunction($t.p.onSelectCell)) { $t.p.onSelectCell.call($t, $t.rows[iRow].id,nm,tmp,iRow,iCol); } } $t.p.iCol = iCol; $t.p.iRow = iRow; }); }, saveCell : function (iRow, iCol){ return this.each(function(){ var $t= this, fr; if (!$t.grid || $t.p.cellEdit !== true) {return;} if ( $t.p.savedRow.length &gt;= 1) {fr = 0;} else {fr=null;} if(fr !== null) { var cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]),v,v2, cm = $t.p.colModel[iCol], nm = cm.name, nmjq = $.jgrid.jqID(nm) ; switch (cm.edittype) { case &quot;select&quot;: if(!cm.editoptions.multiple) { v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq+&quot; option:selected&quot;,$t.rows[iRow]).val(); v2 = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq+&quot; option:selected&quot;,$t.rows[iRow]).text(); } else { var sel = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]), selectedText = []; v = $(sel).val(); if(v) { v.join(&quot;,&quot;);} else { v=&quot;&quot;; } $(&quot;option:selected&quot;,sel).each( function(i,selected){ selectedText[i] = $(selected).text(); } ); v2 = selectedText.join(&quot;,&quot;); } if(cm.formatter) { v2 = v; } break; case &quot;checkbox&quot;: var cbv = [&quot;Yes&quot;,&quot;No&quot;]; if(cm.editoptions){ cbv = cm.editoptions.value.split(&quot;:&quot;); } v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]).is(&quot;:checked&quot;) ? cbv[0] : cbv[1]; v2=v; break; case &quot;password&quot;: case &quot;text&quot;: case &quot;textarea&quot;: case &quot;button&quot; : v = $(&quot;#&quot;+iRow+&quot;_&quot;+nmjq,$t.rows[iRow]).val(); v2=v; break; case 'custom' : try { if(cm.editoptions &amp;&amp; $.isFunction(cm.editoptions.custom_value)) { v = cm.editoptions.custom_value.call($t, $(&quot;.customelement&quot;,cc),'get'); if (v===undefined) { throw &quot;e2&quot;;} else { v2=v; } } else { throw &quot;e1&quot;; } } catch (e) { if (e==&quot;e1&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.nodefined,$.jgrid.edit.bClose); } if (e==&quot;e2&quot;) { $.jgrid.info_dialog($.jgrid.errors.errcap,&quot;function 'custom_value' &quot;+$.jgrid.edit.msg.novalue,$.jgrid.edit.bClose); } else {$.jgrid.info_dialog($.jgrid.errors.errcap,e.message,$.jgrid.edit.bClose); } } break; } // The common approach is if nothing changed do not do anything if (v2 !== $t.p.savedRow[fr].v){ var vvv = $($t).triggerHandler(&quot;jqGridBeforeSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]); if (vvv) {v = vvv; v2=vvv;} if ($.isFunction($t.p.beforeSaveCell)) { var vv = $t.p.beforeSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); if (vv) {v = vv; v2=vv;} } var cv = $.jgrid.checkValues(v,iCol,$t); if(cv[0] === true) { var addpost = $($t).triggerHandler(&quot;jqGridBeforeSubmitCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]) || {}; if ($.isFunction($t.p.beforeSubmitCell)) { addpost = $t.p.beforeSubmitCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); if (!addpost) {addpost={};} } if( $(&quot;input.hasDatepicker&quot;,cc).length &gt;0) { $(&quot;input.hasDatepicker&quot;,cc).datepicker('hide'); } if ($t.p.cellsubmit == 'remote') { if ($t.p.cellurl) { var postdata = {}; if($t.p.autoencode) { v = $.jgrid.htmlEncode(v); } postdata[nm] = v; var idname,oper, opers; opers = $t.p.prmNames; idname = opers.id; oper = opers.oper; postdata[idname] = $.jgrid.stripPref($t.p.idPrefix, $t.rows[iRow].id); postdata[oper] = opers.editoper; postdata = $.extend(addpost,postdata); $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).show(); $t.grid.hDiv.loading = true; $.ajax( $.extend( { url: $t.p.cellurl, data :$.isFunction($t.p.serializeCellData) ? $t.p.serializeCellData.call($t, postdata) : postdata, type: &quot;POST&quot;, complete: function (result, stat) { $(&quot;#lui_&quot;+$t.p.id).hide(); $t.grid.hDiv.loading = false; if (stat == 'success') { var ret = $($t).triggerHandler(&quot;jqGridAfterSubmitCell&quot;, [$t, result, postdata.id, nm, v, iRow, iCol]) || [true, '']; if (ret[0] === true &amp;&amp; $.isFunction($t.p.afterSubmitCell)) { ret = $t.p.afterSubmitCell.call($t, result,postdata.id,nm,v,iRow,iCol); } if(ret[0] === true){ $(cc).empty(); $($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id, iCol, v2, false, false, true); $(cc).addClass(&quot;dirty-cell&quot;); $($t.rows[iRow]).addClass(&quot;edited&quot;); $($t).triggerHandler(&quot;jqGridAfterSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]); if ($.isFunction($t.p.afterSaveCell)) { $t.p.afterSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); } $t.p.savedRow.splice(0,1); } else { $.jgrid.info_dialog($.jgrid.errors.errcap,ret[1],$.jgrid.edit.bClose); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } }, error:function(res,stat,err) { $(&quot;#lui_&quot;+$.jgrid.jqID($t.p.id)).hide(); $t.grid.hDiv.loading = false; $($t).triggerHandler(&quot;jqGridErrorCell&quot;, [res, stat, err]); if ($.isFunction($t.p.errorCell)) { $t.p.errorCell.call($t, res,stat,err); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } else { $.jgrid.info_dialog($.jgrid.errors.errcap,res.status+&quot; : &quot;+res.statusText+&quot;&lt;br/&gt;&quot;+stat,$.jgrid.edit.bClose); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } }, $.jgrid.ajaxOptions, $t.p.ajaxCellOptions || {})); } else { try { $.jgrid.info_dialog($.jgrid.errors.errcap,$.jgrid.errors.nourl,$.jgrid.edit.bClose); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } catch (e) {} } } if ($t.p.cellsubmit == 'clientArray') { $(cc).empty(); $($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id,iCol, v2, false, false, true); $(cc).addClass(&quot;dirty-cell&quot;); $($t.rows[iRow]).addClass(&quot;edited&quot;); $($t).triggerHandler(&quot;jqGridAfterSaveCell&quot;, [$t.rows[iRow].id, nm, v, iRow, iCol]); if ($.isFunction($t.p.afterSaveCell)) { $t.p.afterSaveCell.call($t, $t.rows[iRow].id,nm, v, iRow,iCol); } $t.p.savedRow.splice(0,1); } } else { try { window.setTimeout(function(){$.jgrid.info_dialog($.jgrid.errors.errcap,v+&quot; &quot;+cv[1],$.jgrid.edit.bClose);},100); $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } catch (e) {} } } else { $($t).jqGrid(&quot;restoreCell&quot;,iRow,iCol); } } window.setTimeout(function () { $(&quot;#&quot;+$.jgrid.jqID($t.p.knv)).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0); }); }, restoreCell : function(iRow, iCol) { return this.each(function(){ var $t= this, fr; if (!$t.grid || $t.p.cellEdit !== true ) {return;} if ( $t.p.savedRow.length &gt;= 1) {fr = 0;} else {fr=null;} if(fr !== null) { var cc = $(&quot;td:eq(&quot;+iCol+&quot;)&quot;,$t.rows[iRow]); // datepicker fix if($.isFunction($.fn.datepicker)) { try { $(&quot;input.hasDatepicker&quot;,cc).datepicker('hide'); } catch (e) {} } $(cc).empty().attr(&quot;tabindex&quot;,&quot;-1&quot;); $($t).jqGrid(&quot;setCell&quot;,$t.rows[iRow].id, iCol, $t.p.savedRow[fr].v, false, false, true); $($t).triggerHandler(&quot;jqGridAfterRestoreCell&quot;, [$t.rows[iRow].id, $t.p.savedRow[fr].v, iRow, iCol]); if ($.isFunction($t.p.afterRestoreCell)) { $t.p.afterRestoreCell.call($t, $t.rows[iRow].id, $t.p.savedRow[fr].v, iRow, iCol); } $t.p.savedRow.splice(0,1); } window.setTimeout(function () { $(&quot;#&quot;+$t.p.knv).attr(&quot;tabindex&quot;,&quot;-1&quot;).focus();},0); }); }, nextCell : function (iRow,iCol) { return this.each(function (){ var $t = this, nCol=false, i; if (!$t.grid || $t.p.cellEdit !== true) {return;} // try to find next editable cell for (i=iCol+1; i&lt;$t.p.colModel.length; i++) { if ( $t.p.colModel[i].editable ===true) { nCol = i; break; } } if(nCol !== false) { $($t).jqGrid(&quot;editCell&quot;,iRow,nCol,true); } else { if ($t.p.savedRow.length &gt;0) { $($t).jqGrid(&quot;saveCell&quot;,iRow,iCol); } } }); }, prevCell : function (iRow,iCol) { return this.each(function (){ var $t = this, nCol=false, i; if (!$t.grid || $t.p.cellEdit !== true) {return;} // try to find next editable cell for (i=iCol-1; i&gt;=0; i--) { if ( $t.p.colModel[i].editable ===true) { nCol = i; break; } } if(nCol !== false) { $($t).jqGrid(&quot;editCell&quot;,iRow,nCol,true); } else { if ($t.p.savedRow.length &gt;0) { $($t).jqGrid(&quot;saveCell&quot;,iRow,iCol); } } }); }, GridNav : function() { return this.each(function () { var $t = this; if (!$t.grid || $t.p.cellEdit !== true ) {return;} // trick to process keydown on non input elements $t.p.knv = $t.p.id + &quot;_kn&quot;; var selection = $(&quot;&lt;div style='position:fixed;top:-1000000px;width:1px;height:1px;' tabindex='0'&gt;&lt;div tabindex='-1' style='width:1px;height:1px;' id='&quot;+$t.p.knv+&quot;'&gt;&lt;/div&gt;&lt;/div&gt;&quot;), i, kdir; function scrollGrid(iR, iC, tp){ if (tp.substr(0,1)=='v') { var ch = $($t.grid.bDiv)[0].clientHeight, st = $($t.grid.bDiv)[0].scrollTop, nROT = $t.rows[iR].offsetTop+$t.rows[iR].clientHeight, pROT = $t.rows[iR].offsetTop; if(tp == 'vd') { if(nROT &gt;= ch) { $($t.grid.bDiv)[0].scrollTop = $($t.grid.bDiv)[0].scrollTop + $t.rows[iR].clientHeight; } } if(tp == 'vu'){ if (pROT &lt; st ) { $($t.grid.bDiv)[0].scrollTop = $($t.grid.bDiv)[0].scrollTop - $t.rows[iR].clientHeight; } } } if(tp=='h') { var cw = $($t.grid.bDiv)[0].clientWidth, sl = $($t.grid.bDiv)[0].scrollLeft, nCOL = $t.rows[iR].cells[iC].offsetLeft+$t.rows[iR].cells[iC].clientWidth, pCOL = $t.rows[iR].cells[iC].offsetLeft; if(nCOL &gt;= cw+parseInt(sl,10)) { $($t.grid.bDiv)[0].scrollLeft = $($t.grid.bDiv)[0].scrollLeft + $t.rows[iR].cells[iC].clientWidth; } else if (pCOL &lt; sl) { $($t.grid.bDiv)[0].scrollLeft = $($t.grid.bDiv)[0].scrollLeft - $t.rows[iR].cells[iC].clientWidth; } } } function findNextVisible(iC,act){ var ind, i; if(act == 'lft') { ind = iC+1; for (i=iC;i&gt;=0;i--){ if ($t.p.colModel[i].hidden !== true) { ind = i; break; } } } if(act == 'rgt') { ind = iC-1; for (i=iC; i&lt;$t.p.colModel.length;i++){ if ($t.p.colModel[i].hidden !== true) { ind = i; break; } } } return ind; } $(selection).insertBefore($t.grid.cDiv); $(&quot;#&quot;+$t.p.knv) .focus() .keydown(function (e){ kdir = e.keyCode; if($t.p.direction == &quot;rtl&quot;) { if(kdir===37) { kdir = 39;} else if (kdir===39) { kdir = 37; } } switch (kdir) { case 38: if ($t.p.iRow-1 &gt;0 ) { scrollGrid($t.p.iRow-1,$t.p.iCol,'vu'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow-1,$t.p.iCol,false); } break; case 40 : if ($t.p.iRow+1 &lt;= $t.rows.length-1) { scrollGrid($t.p.iRow+1,$t.p.iCol,'vd'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow+1,$t.p.iCol,false); } break; case 37 : if ($t.p.iCol -1 &gt;= 0) { i = findNextVisible($t.p.iCol-1,'lft'); scrollGrid($t.p.iRow, i,'h'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow, i,false); } break; case 39 : if ($t.p.iCol +1 &lt;= $t.p.colModel.length-1) { i = findNextVisible($t.p.iCol+1,'rgt'); scrollGrid($t.p.iRow,i,'h'); $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow,i,false); } break; case 13: if (parseInt($t.p.iCol,10)&gt;=0 &amp;&amp; parseInt($t.p.iRow,10)&gt;=0) { $($t).jqGrid(&quot;editCell&quot;,$t.p.iRow,$t.p.iCol,true); } break; default : return true; } return false; }); }); }, getChangedCells : function (mthd) { var ret=[]; if (!mthd) {mthd='all';} this.each(function(){ var $t= this,nm; if (!$t.grid || $t.p.cellEdit !== true ) {return;} $($t.rows).each(function(j){ var res = {}; if ($(this).hasClass(&quot;edited&quot;)) { $('td',this).each( function(i) { nm = $t.p.colModel[i].name; if ( nm !== 'cb' &amp;&amp; nm !== 'subgrid') { if (mthd=='dirty') { if ($(this).hasClass('dirty-cell')) { try { res[nm] = $.unformat.call($t,this,{rowId:$t.rows[j].id, colModel:$t.p.colModel[i]},i); } catch (e){ res[nm] = $.jgrid.htmlDecode($(this).html()); } } } else { try { res[nm] = $.unformat.call($t,this,{rowId:$t.rows[j].id,colModel:$t.p.colModel[i]},i); } catch (e) { res[nm] = $.jgrid.htmlDecode($(this).html()); } } } }); res.id = this.id; ret.push(res); } }); }); return ret; } /// end cell editing }); })(jQuery); /*jshint eqeqeq:false */ /*global jQuery */ (function($){ /** * jqGrid extension for SubGrid Data * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; $.jgrid.extend({ setSubGrid : function () { return this.each(function (){ var $t = this, cm, i, suboptions = { plusicon : &quot;ui-icon-plus&quot;, minusicon : &quot;ui-icon-minus&quot;, openicon: &quot;ui-icon-carat-1-sw&quot;, expandOnLoad: false, delayOnLoad : 50, selectOnExpand : false, reloadOnExpand : true }; $t.p.subGridOptions = $.extend(suboptions, $t.p.subGridOptions || {}); $t.p.colNames.unshift(&quot;&quot;); $t.p.colModel.unshift({name:'subgrid',width: $.jgrid.cell_width ? $t.p.subGridWidth+$t.p.cellLayout : $t.p.subGridWidth,sortable: false,resizable:false,hidedlg:true,search:false,fixed:true}); cm = $t.p.subGridModel; if(cm[0]) { cm[0].align = $.extend([],cm[0].align || []); for(i=0;i&lt;cm[0].name.length;i++) { cm[0].align[i] = cm[0].align[i] || 'left';} } }); }, addSubGridCell :function (pos,iRow) { var prp='',ic,sid; this.each(function(){ prp = this.formatCol(pos,iRow); sid= this.p.id; ic = this.p.subGridOptions.plusicon; }); return &quot;&lt;td role=\\&quot;gridcell\\&quot; aria-describedby=\\&quot;&quot;+sid+&quot;_subgrid\\&quot; class=\\&quot;ui-sgcollapsed sgcollapsed\\&quot; &quot;+prp+&quot;&gt;&lt;a href='javascript:void(0);'&gt;&lt;span class='ui-icon &quot;+ic+&quot;'&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;&quot;; }, addSubGrid : function( pos, sind ) { return this.each(function(){ var ts = this; if (!ts.grid ) { return; } //------------------------- var subGridCell = function(trdiv,cell,pos) { var tddiv = $(&quot;&lt;td align='&quot;+ts.p.subGridModel[0].align[pos]+&quot;'&gt;&lt;/td&gt;&quot;).html(cell); $(trdiv).append(tddiv); }; var subGridXml = function(sjxml, sbid){ var tddiv, i, sgmap, dummy = $(&quot;&lt;table cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), trdiv = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); for (i = 0; i&lt;ts.p.subGridModel[0].name.length; i++) { tddiv = $(&quot;&lt;th class='ui-state-default ui-th-subgrid ui-th-column ui-th-&quot;+ts.p.direction+&quot;'&gt;&lt;/th&gt;&quot;); $(tddiv).html(ts.p.subGridModel[0].name[i]); $(tddiv).width( ts.p.subGridModel[0].width[i]); $(trdiv).append(tddiv); } $(dummy).append(trdiv); if (sjxml){ sgmap = ts.p.xmlReader.subgrid; $(sgmap.root+&quot; &quot;+sgmap.row, sjxml).each( function(){ trdiv = $(&quot;&lt;tr class='ui-widget-content ui-subtblcell'&gt;&lt;/tr&gt;&quot;); if(sgmap.repeatitems === true) { $(sgmap.cell,this).each( function(i) { subGridCell(trdiv, $(this).text() || '&amp;#160;',i); }); } else { var f = ts.p.subGridModel[0].mapping || ts.p.subGridModel[0].name; if (f) { for (i=0;i&lt;f.length;i++) { subGridCell(trdiv, $(f[i],this).text() || '&amp;#160;',i); } } } $(dummy).append(trdiv); }); } var pID = $(&quot;table:first&quot;,ts.grid.bDiv).attr(&quot;id&quot;)+&quot;_&quot;; $(&quot;#&quot;+$.jgrid.jqID(pID+sbid)).append(dummy); ts.grid.hDiv.loading = false; $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); return false; }; var subGridJson = function(sjxml, sbid){ var tddiv,result,i,cur, sgmap,j, dummy = $(&quot;&lt;table cellspacing='0' cellpadding='0' border='0'&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;), trdiv = $(&quot;&lt;tr&gt;&lt;/tr&gt;&quot;); for (i = 0; i&lt;ts.p.subGridModel[0].name.length; i++) { tddiv = $(&quot;&lt;th class='ui-state-default ui-th-subgrid ui-th-column ui-th-&quot;+ts.p.direction+&quot;'&gt;&lt;/th&gt;&quot;); $(tddiv).html(ts.p.subGridModel[0].name[i]); $(tddiv).width( ts.p.subGridModel[0].width[i]); $(trdiv).append(tddiv); } $(dummy).append(trdiv); if (sjxml){ sgmap = ts.p.jsonReader.subgrid; result = $.jgrid.getAccessor(sjxml, sgmap.root); if ( result !== undefined ) { for (i=0;i&lt;result.length;i++) { cur = result[i]; trdiv = $(&quot;&lt;tr class='ui-widget-content ui-subtblcell'&gt;&lt;/tr&gt;&quot;); if(sgmap.repeatitems === true) { if(sgmap.cell) { cur=cur[sgmap.cell]; } for (j=0;j&lt;cur.length;j++) { subGridCell(trdiv, cur[j] || '&amp;#160;',j); } } else { var f = ts.p.subGridModel[0].mapping || ts.p.subGridModel[0].name; if(f.length) { for (j=0;j&lt;f.length;j++) { subGridCell(trdiv, cur[f[j]] || '&amp;#160;',j); } } } $(dummy).append(trdiv); } } } var pID = $(&quot;table:first&quot;,ts.grid.bDiv).attr(&quot;id&quot;)+&quot;_&quot;; $(&quot;#&quot;+$.jgrid.jqID(pID+sbid)).append(dummy); ts.grid.hDiv.loading = false; $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).hide(); return false; }; var populatesubgrid = function( rd ) { var sid,dp, i, j; sid = $(rd).attr(&quot;id&quot;); dp = {nd_: (new Date().getTime())}; dp[ts.p.prmNames.subgridid]=sid; if(!ts.p.subGridModel[0]) { return false; } if(ts.p.subGridModel[0].params) { for(j=0; j &lt; ts.p.subGridModel[0].params.length; j++) { for(i=0; i&lt;ts.p.colModel.length; i++) { if(ts.p.colModel[i].name === ts.p.subGridModel[0].params[j]) { dp[ts.p.colModel[i].name]= $(&quot;td:eq(&quot;+i+&quot;)&quot;,rd).text().replace(/\\&amp;#160\\;/ig,''); } } } } if(!ts.grid.hDiv.loading) { ts.grid.hDiv.loading = true; $(&quot;#load_&quot;+$.jgrid.jqID(ts.p.id)).show(); if(!ts.p.subgridtype) { ts.p.subgridtype = ts.p.datatype; } if($.isFunction(ts.p.subgridtype)) { ts.p.subgridtype.call(ts, dp); } else { ts.p.subgridtype = ts.p.subgridtype.toLowerCase(); } switch(ts.p.subgridtype) { case &quot;xml&quot;: case &quot;json&quot;: $.ajax($.extend({ type:ts.p.mtype, url: ts.p.subGridUrl, dataType:ts.p.subgridtype, data: $.isFunction(ts.p.serializeSubGridData)? ts.p.serializeSubGridData.call(ts, dp) : dp, complete: function(sxml) { if(ts.p.subgridtype === &quot;xml&quot;) { subGridXml(sxml.responseXML, sid); } else { subGridJson($.jgrid.parse(sxml.responseText),sid); } sxml=null; } }, $.jgrid.ajaxOptions, ts.p.ajaxSubgridOptions || {})); break; } } return false; }; var _id, pID,atd, nhc=0, bfsc, r; $.each(ts.p.colModel,function(){ if(this.hidden === true || this.name === 'rn' || this.name === 'cb') { nhc++; } }); var len = ts.rows.length, i=1; if( sind !== undefined &amp;&amp; sind &gt; 0) { i = sind; len = sind+1; } while(i &lt; len) { if($(ts.rows[i]).hasClass('jqgrow')) { $(ts.rows[i].cells[pos]).bind('click', function() { var tr = $(this).parent(&quot;tr&quot;)[0]; r = tr.nextSibling; if($(this).hasClass(&quot;sgcollapsed&quot;)) { pID = ts.p.id; _id = tr.id; if(ts.p.subGridOptions.reloadOnExpand === true || ( ts.p.subGridOptions.reloadOnExpand === false &amp;&amp; !$(r).hasClass('ui-subgrid') ) ) { atd = pos &gt;=1 ? &quot;&lt;td colspan='&quot;+pos+&quot;'&gt;&amp;#160;&lt;/td&gt;&quot;:&quot;&quot;; bfsc = $(ts).triggerHandler(&quot;jqGridSubGridBeforeExpand&quot;, [pID + &quot;_&quot; + _id, _id]); bfsc = (bfsc === false || bfsc === 'stop') ? false : true; if(bfsc &amp;&amp; $.isFunction(ts.p.subGridBeforeExpand)) { bfsc = ts.p.subGridBeforeExpand.call(ts, pID+&quot;_&quot;+_id,_id); } if(bfsc === false) {return false;} $(tr).after( &quot;&lt;tr role='row' class='ui-subgrid'&gt;&quot;+atd+&quot;&lt;td class='ui-widget-content subgrid-cell'&gt;&lt;span class='ui-icon &quot;+ts.p.subGridOptions.openicon+&quot;'&gt;&lt;/span&gt;&lt;/td&gt;&lt;td colspan='&quot;+parseInt(ts.p.colNames.length-1-nhc,10)+&quot;' class='ui-widget-content subgrid-data'&gt;&lt;div id=&quot;+pID+&quot;_&quot;+_id+&quot; class='tablediv'&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&quot; ); $(ts).triggerHandler(&quot;jqGridSubGridRowExpanded&quot;, [pID + &quot;_&quot; + _id, _id]); if( $.isFunction(ts.p.subGridRowExpanded)) { ts.p.subGridRowExpanded.call(ts, pID+&quot;_&quot;+ _id,_id); } else { populatesubgrid(tr); } } else { $(r).show(); } $(this).html(&quot;&lt;a href='javascript:void(0);'&gt;&lt;span class='ui-icon &quot;+ts.p.subGridOptions.minusicon+&quot;'&gt;&lt;/span&gt;&lt;/a&gt;&quot;).removeClass(&quot;sgcollapsed&quot;).addClass(&quot;sgexpanded&quot;); if(ts.p.subGridOptions.selectOnExpand) { $(ts).jqGrid('setSelection',_id); } } else if($(this).hasClass(&quot;sgexpanded&quot;)) { bfsc = $(ts).triggerHandler(&quot;jqGridSubGridRowColapsed&quot;, [pID + &quot;_&quot; + _id, _id]); bfsc = (bfsc === false || bfsc === 'stop') ? false : true; if( bfsc &amp;&amp; $.isFunction(ts.p.subGridRowColapsed)) { _id = tr.id; bfsc = ts.p.subGridRowColapsed.call(ts, pID+&quot;_&quot;+_id,_id ); } if(bfsc===false) {return false;} if(ts.p.subGridOptions.reloadOnExpand === true) { $(r).remove(&quot;.ui-subgrid&quot;); } else if($(r).hasClass('ui-subgrid')) { // incase of dynamic deleting $(r).hide(); } $(this).html(&quot;&lt;a href='javascript:void(0);'&gt;&lt;span class='ui-icon &quot;+ts.p.subGridOptions.plusicon+&quot;'&gt;&lt;/span&gt;&lt;/a&gt;&quot;).removeClass(&quot;sgexpanded&quot;).addClass(&quot;sgcollapsed&quot;); } return false; }); } i++; } if(ts.p.subGridOptions.expandOnLoad === true) { $(ts.rows).filter('.jqgrow').each(function(index,row){ $(row.cells[0]).click(); }); } ts.subGridXml = function(xml,sid) {subGridXml(xml,sid);}; ts.subGridJson = function(json,sid) {subGridJson(json,sid);}; }); }, expandSubGridRow : function(rowid) { return this.each(function () { var $t = this; if(!$t.grid &amp;&amp; !rowid) {return;} if($t.p.subGrid===true) { var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true); if(rc) { var sgc = $(&quot;td.sgcollapsed&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } } } }); }, collapseSubGridRow : function(rowid) { return this.each(function () { var $t = this; if(!$t.grid &amp;&amp; !rowid) {return;} if($t.p.subGrid===true) { var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true); if(rc) { var sgc = $(&quot;td.sgexpanded&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } } } }); }, toggleSubGridRow : function(rowid) { return this.each(function () { var $t = this; if(!$t.grid &amp;&amp; !rowid) {return;} if($t.p.subGrid===true) { var rc = $(this).jqGrid(&quot;getInd&quot;,rowid,true); if(rc) { var sgc = $(&quot;td.sgcollapsed&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } else { sgc = $(&quot;td.sgexpanded&quot;,rc)[0]; if(sgc) { $(sgc).trigger(&quot;click&quot;); } } } } }); } }); })(jQuery); /** * jqGrid extension - Tree Grid * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl.html **/ /*jshint eqeqeq:false */ /*global jQuery */ (function($) { &quot;use strict&quot;; $.jgrid.extend({ setTreeNode : function(i, len){ return this.each(function(){ var $t = this; if( !$t.grid || !$t.p.treeGrid ) {return;} var expCol = $t.p.expColInd, expanded = $t.p.treeReader.expanded_field, isLeaf = $t.p.treeReader.leaf_field, level = $t.p.treeReader.level_field, icon = $t.p.treeReader.icon_field, loaded = $t.p.treeReader.loaded, lft, rgt, curLevel, ident,lftpos, twrap, ldat, lf; while(i&lt;len) { var ind = $t.rows[i].id, dind = $t.p._index[ind], expan; ldat = $t.p.data[dind]; //$t.rows[i].level = ldat[level]; if($t.p.treeGridModel == 'nested') { if(!ldat[isLeaf]) { lft = parseInt(ldat[$t.p.treeReader.left_field],10); rgt = parseInt(ldat[$t.p.treeReader.right_field],10); // NS Model ldat[isLeaf] = (rgt === lft+1) ? 'true' : 'false'; $t.rows[i].cells[$t.p._treeleafpos].innerHTML = ldat[isLeaf]; } } //else { //row.parent_id = rd[$t.p.treeReader.parent_id_field]; //} if (ldat===undefined){i++,len++;continue;} curLevel = parseInt(ldat[level],10); if($t.p.tree_root_level === 0) { ident = curLevel+1; lftpos = curLevel; } else { ident = curLevel; lftpos = curLevel -1; } twrap = &quot;&lt;div class='tree-wrap tree-wrap-&quot;+$t.p.direction+&quot;' style='width:&quot;+(ident*18)+&quot;px;'&gt;&quot;; twrap += &quot;&lt;div style='&quot;+($t.p.direction==&quot;rtl&quot; ? &quot;right:&quot; : &quot;left:&quot;)+(lftpos*18)+&quot;px;' class='ui-icon &quot;; if(ldat[loaded] !== undefined) { if(ldat[loaded]==&quot;true&quot; || ldat[loaded]===true) { ldat[loaded] = true; } else { ldat[loaded] = false; } } if(ldat[isLeaf] == &quot;true&quot; || ldat[isLeaf] === true) { twrap += ((ldat[icon] !== undefined &amp;&amp; ldat[icon] !== &quot;&quot;) ? ldat[icon] : $t.p.treeIcons.leaf)+&quot; tree-leaf treeclick&quot;; ldat[isLeaf] = true; lf=&quot;leaf&quot;; } else { ldat[isLeaf] = false; lf=&quot;&quot;; } ldat[expanded] = ((ldat[expanded] == &quot;true&quot; || ldat[expanded] === true) ? true : false) &amp;&amp; (ldat[loaded] || ldat[loaded] === undefined); if(ldat[expanded] === false) { twrap += ((ldat[isLeaf] === true) ? &quot;'&quot; : $t.p.treeIcons.plus+&quot; tree-plus treeclick'&quot;); } else { twrap += ((ldat[isLeaf] === true) ? &quot;'&quot; : $t.p.treeIcons.minus+&quot; tree-minus treeclick'&quot;); } twrap += &quot;&gt;&lt;/div&gt;&lt;/div&gt;&quot;; $($t.rows[i].cells[expCol]).wrapInner(&quot;&lt;span class='cell-wrapper&quot;+lf+&quot;'&gt;&lt;/span&gt;&quot;).prepend(twrap); if(curLevel !== parseInt($t.p.tree_root_level,10)) { var pn = $($t).jqGrid('getNodeParent',ldat); expan = pn &amp;&amp; pn.hasOwnProperty(expanded) ? pn[expanded] : true; if( !expan ){ $($t.rows[i]).css(&quot;display&quot;,&quot;none&quot;); } } $($t.rows[i].cells[expCol]) .find(&quot;div.treeclick&quot;) .bind(&quot;click&quot;,function(e){ var target = e.target || e.srcElement, ind2 =$(target,$t.rows).closest(&quot;tr.jqgrow&quot;)[0].id, pos = $t.p._index[ind2]; if(!$t.p.data[pos][isLeaf]){ if($t.p.data[pos][expanded]){ $($t).jqGrid(&quot;collapseRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;collapseNode&quot;,$t.p.data[pos]); } else { $($t).jqGrid(&quot;expandRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;expandNode&quot;,$t.p.data[pos]); } } return false; }); if($t.p.ExpandColClick === true) { $($t.rows[i].cells[expCol]) .find(&quot;span.cell-wrapper&quot;) .css(&quot;cursor&quot;,&quot;pointer&quot;) .bind(&quot;click&quot;,function(e) { var target = e.target || e.srcElement, ind2 =$(target,$t.rows).closest(&quot;tr.jqgrow&quot;)[0].id, pos = $t.p._index[ind2]; if(!$t.p.data[pos][isLeaf]){ if($t.p.data[pos][expanded]){ $($t).jqGrid(&quot;collapseRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;collapseNode&quot;,$t.p.data[pos]); } else { $($t).jqGrid(&quot;expandRow&quot;,$t.p.data[pos]); $($t).jqGrid(&quot;expandNode&quot;,$t.p.data[pos]); } } $($t).jqGrid(&quot;setSelection&quot;,ind2); return false; }); } i++; } }); }, setTreeGrid : function() { return this.each(function (){ var $t = this, i=0, pico, ecol = false, nm, key, tkey, dupcols=[]; if(!$t.p.treeGrid) {return;} if(!$t.p.treedatatype ) {$.extend($t.p,{treedatatype: $t.p.datatype});} $t.p.subGrid = false;$t.p.altRows =false; $t.p.pgbuttons = false;$t.p.pginput = false; $t.p.gridview = true; if($t.p.rowTotal === null ) { $t.p.rowNum = 10000; } $t.p.multiselect = false;$t.p.rowList = []; $t.p.expColInd = 0; pico = 'ui-icon-triangle-1-' + ($t.p.direction==&quot;rtl&quot; ? 'w' : 'e'); $t.p.treeIcons = $.extend({plus:pico,minus:'ui-icon-triangle-1-s',leaf:'ui-icon-radio-off'},$t.p.treeIcons || {}); if($t.p.treeGridModel == 'nested') { $t.p.treeReader = $.extend({ level_field: &quot;level&quot;, left_field:&quot;lft&quot;, right_field: &quot;rgt&quot;, leaf_field: &quot;isLeaf&quot;, expanded_field: &quot;expanded&quot;, loaded: &quot;loaded&quot;, icon_field: &quot;icon&quot; },$t.p.treeReader); } else if($t.p.treeGridModel == 'adjacency') { $t.p.treeReader = $.extend({ level_field: &quot;level&quot;, parent_id_field: &quot;parent&quot;, leaf_field: &quot;isLeaf&quot;, expanded_field: &quot;expanded&quot;, loaded: &quot;loaded&quot;, icon_field: &quot;icon&quot; },$t.p.treeReader ); } for ( key in $t.p.colModel){ if($t.p.colModel.hasOwnProperty(key)) { nm = $t.p.colModel[key].name; if( nm == $t.p.ExpandColumn &amp;&amp; !ecol ) { ecol = true; $t.p.expColInd = i; } i++; // for(tkey in $t.p.treeReader) { if($t.p.treeReader.hasOwnProperty(tkey) &amp;&amp; $t.p.treeReader[tkey] == nm) { dupcols.push(nm); } } } } $.each($t.p.treeReader,function(j,n){ if(n &amp;&amp; $.inArray(n, dupcols) === -1){ if(j==='leaf_field') { $t.p._treeleafpos= i; } i++; $t.p.colNames.push(n); $t.p.colModel.push({name:n,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false}); } }); }); }, expandRow: function (record){ this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var childern = $($t).jqGrid(&quot;getNodeChildren&quot;,record), //if ($($t).jqGrid(&quot;isVisibleNode&quot;,record)) { expanded = $t.p.treeReader.expanded_field, rows = $t.rows; $(childern).each(function(){ var id = $.jgrid.getAccessor(this,$t.p.localReader.id); $(rows.namedItem(id)).css(&quot;display&quot;,&quot;&quot;); if(this[expanded]) { $($t).jqGrid(&quot;expandRow&quot;,this); } }); //} }); }, collapseRow : function (record) { this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var childern = $($t).jqGrid(&quot;getNodeChildren&quot;,record), expanded = $t.p.treeReader.expanded_field, rows = $t.rows; $(childern).each(function(){ var id = $.jgrid.getAccessor(this,$t.p.localReader.id); $(rows.namedItem(id)).css(&quot;display&quot;,&quot;none&quot;); if(this[expanded]){ $($t).jqGrid(&quot;collapseRow&quot;,this); } }); }); }, // NS ,adjacency models getRootNodes : function() { var result = []; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var level = $t.p.treeReader.level_field; $($t.p.data).each(function(){ if(parseInt(this[level],10) === parseInt($t.p.tree_root_level,10)) { result.push(this); } }); break; case 'adjacency' : var parent_id = $t.p.treeReader.parent_id_field; $($t.p.data).each(function(){ if(this[parent_id] === null || String(this[parent_id]).toLowerCase() == &quot;null&quot;) { result.push(this); } }); break; } }); return result; }, getNodeDepth : function(rc) { var ret = null; this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var $t = this; switch ($t.p.treeGridModel) { case 'nested' : var level = $t.p.treeReader.level_field; ret = parseInt(rc[level],10) - parseInt($t.p.tree_root_level,10); break; case 'adjacency' : ret = $($t).jqGrid(&quot;getNodeAncestors&quot;,rc).length; break; } }); return ret; }, getNodeParent : function(rc) { var result = null; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var lftc = $t.p.treeReader.left_field, rgtc = $t.p.treeReader.right_field, levelc = $t.p.treeReader.level_field, lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10); $(this.p.data).each(function(){ if(parseInt(this[levelc],10) === level-1 &amp;&amp; parseInt(this[lftc],10) &lt; lft &amp;&amp; parseInt(this[rgtc],10) &gt; rgt) { result = this; return false; } }); break; case 'adjacency' : var parent_id = $t.p.treeReader.parent_id_field, dtid = $t.p.localReader.id; $(this.p.data).each(function(){ if(this[dtid] == rc[parent_id] ) { result = this; return false; } }); break; } }); return result; }, getNodeChildren : function(rc) { var result = []; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var lftc = $t.p.treeReader.left_field, rgtc = $t.p.treeReader.right_field, levelc = $t.p.treeReader.level_field, lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10); $(this.p.data).each(function(){ if(parseInt(this[levelc],10) === level+1 &amp;&amp; parseInt(this[lftc],10) &gt; lft &amp;&amp; parseInt(this[rgtc],10) &lt; rgt) { result.push(this); } }); break; case 'adjacency' : var parent_id = $t.p.treeReader.parent_id_field, dtid = $t.p.localReader.id; $(this.p.data).each(function(){ if(this[parent_id] == rc[dtid]) { result.push(this); } }); break; } }); return result; }, getFullTreeNode : function(rc) { var result = []; this.each(function(){ var $t = this, len; if(!$t.grid || !$t.p.treeGrid) {return;} switch ($t.p.treeGridModel) { case 'nested' : var lftc = $t.p.treeReader.left_field, rgtc = $t.p.treeReader.right_field, levelc = $t.p.treeReader.level_field, lft = parseInt(rc[lftc],10), rgt = parseInt(rc[rgtc],10), level = parseInt(rc[levelc],10); $(this.p.data).each(function(){ if(parseInt(this[levelc],10) &gt;= level &amp;&amp; parseInt(this[lftc],10) &gt;= lft &amp;&amp; parseInt(this[lftc],10) &lt;= rgt) { result.push(this); } }); break; case 'adjacency' : if(rc) { result.push(rc); var parent_id = $t.p.treeReader.parent_id_field, dtid = $t.p.localReader.id; $(this.p.data).each(function(i){ len = result.length; for (i = 0; i &lt; len; i++) { if (result[i][dtid] == this[parent_id]) { result.push(this); break; } } }); } break; } }); return result; }, // End NS, adjacency Model getNodeAncestors : function(rc) { var ancestors = []; this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var parent = $(this).jqGrid(&quot;getNodeParent&quot;,rc); while (parent) { ancestors.push(parent); parent = $(this).jqGrid(&quot;getNodeParent&quot;,parent); } }); return ancestors; }, isVisibleNode : function(rc) { var result = true; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var ancestors = $($t).jqGrid(&quot;getNodeAncestors&quot;,rc), expanded = $t.p.treeReader.expanded_field; $(ancestors).each(function(){ result = result &amp;&amp; this[expanded]; if(!result) {return false;} }); }); return result; }, isNodeLoaded : function(rc) { var result; this.each(function(){ var $t = this; if(!$t.grid || !$t.p.treeGrid) {return;} var isLeaf = $t.p.treeReader.leaf_field; if(rc !== undefined ) { if(rc.loaded !== undefined) { result = rc.loaded; } else if( rc[isLeaf] || $($t).jqGrid(&quot;getNodeChildren&quot;,rc).length &gt; 0){ result = true; } else { result = false; } } else { result = false; } }); return result; }, expandNode : function(rc) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var expanded = this.p.treeReader.expanded_field, parent = this.p.treeReader.parent_id_field, loaded = this.p.treeReader.loaded, level = this.p.treeReader.level_field, lft = this.p.treeReader.left_field, rgt = this.p.treeReader.right_field; if(!rc[expanded]) { var id = $.jgrid.getAccessor(rc,this.p.localReader.id); var rc1 = $(&quot;#&quot;+$.jgrid.jqID(id),this.grid.bDiv)[0]; var position = this.p._index[id]; if( $(this).jqGrid(&quot;isNodeLoaded&quot;,this.p.data[position]) ) { rc[expanded] = true; $(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.plus+&quot; tree-plus&quot;).addClass(this.p.treeIcons.minus+&quot; tree-minus&quot;); } else if (!this.grid.hDiv.loading) { rc[expanded] = true; $(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.plus+&quot; tree-plus&quot;).addClass(this.p.treeIcons.minus+&quot; tree-minus&quot;); this.p.treeANode = rc1.rowIndex; this.p.datatype = this.p.treedatatype; if(this.p.treeGridModel == 'nested') { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:id,n_left:rc[lft],n_right:rc[rgt],n_level:rc[level]}}); } else { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:id,parentid:rc[parent],n_level:rc[level]}} ); } $(this).trigger(&quot;reloadGrid&quot;); rc[loaded] = true; if(this.p.treeGridModel == 'nested') { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:'',n_left:'',n_right:'',n_level:''}}); } else { $(this).jqGrid(&quot;setGridParam&quot;,{postData:{nodeid:'',parentid:'',n_level:''}}); } } } }); }, collapseNode : function(rc) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var expanded = this.p.treeReader.expanded_field; if(rc[expanded]) { rc[expanded] = false; var id = $.jgrid.getAccessor(rc,this.p.localReader.id); var rc1 = $(&quot;#&quot;+$.jgrid.jqID(id),this.grid.bDiv)[0]; $(&quot;div.treeclick&quot;,rc1).removeClass(this.p.treeIcons.minus+&quot; tree-minus&quot;).addClass(this.p.treeIcons.plus+&quot; tree-plus&quot;); } }); }, SortTree : function( sortname, newDir, st, datefmt) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var i, len, rec, records = [], $t = this, query, roots, rt = $(this).jqGrid(&quot;getRootNodes&quot;); // Sorting roots query = $.jgrid.from(rt); query.orderBy(sortname,newDir,st, datefmt); roots = query.select(); // Sorting children for (i = 0, len = roots.length; i &lt; len; i++) { rec = roots[i]; records.push(rec); $(this).jqGrid(&quot;collectChildrenSortTree&quot;,records, rec, sortname, newDir,st, datefmt); } $.each(records, function(index) { var id = $.jgrid.getAccessor(this,$t.p.localReader.id); $('#'+$.jgrid.jqID($t.p.id)+ ' tbody tr:eq('+index+')').after($('tr#'+$.jgrid.jqID(id),$t.grid.bDiv)); }); query = null;roots=null;records=null; }); }, collectChildrenSortTree : function(records, rec, sortname, newDir,st, datefmt) { return this.each(function(){ if(!this.grid || !this.p.treeGrid) {return;} var i, len, child, ch, query, children; ch = $(this).jqGrid(&quot;getNodeChildren&quot;,rec); query = $.jgrid.from(ch); query.orderBy(sortname, newDir, st, datefmt); children = query.select(); for (i = 0, len = children.length; i &lt; len; i++) { child = children[i]; records.push(child); $(this).jqGrid(&quot;collectChildrenSortTree&quot;,records, child, sortname, newDir, st, datefmt); } }); }, // experimental setTreeRow : function(rowid, data) { var success=false; this.each(function(){ var t = this; if(!t.grid || !t.p.treeGrid) {return;} success = $(t).jqGrid(&quot;setRowData&quot;,rowid,data); }); return success; }, delTreeNode : function (rowid) { return this.each(function () { var $t = this, rid = $t.p.localReader.id, i, left = $t.p.treeReader.left_field, right = $t.p.treeReader.right_field, myright, width, res, key; if(!$t.grid || !$t.p.treeGrid) {return;} var rc = $t.p._index[rowid]; if (rc !== undefined) { // nested myright = parseInt($t.p.data[rc][right],10); width = myright - parseInt($t.p.data[rc][left],10) + 1; var dr = $($t).jqGrid(&quot;getFullTreeNode&quot;,$t.p.data[rc]); if(dr.length&gt;0){ for (i=0;i&lt;dr.length;i++){ $($t).jqGrid(&quot;delRowData&quot;,dr[i][rid]); } } if( $t.p.treeGridModel === &quot;nested&quot;) { // ToDo - update grid data res = $.jgrid.from($t.p.data) .greater(left,myright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][left] = parseInt(res[key][left],10) - width ; } } } res = $.jgrid.from($t.p.data) .greater(right,myright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][right] = parseInt(res[key][right],10) - width ; } } } } } }); }, addChildNode : function( nodeid, parentid, data, expandData ) { //return this.each(function(){ var $t = this[0]; if(data) { // we suppose tha the id is autoincremet and var expanded = $t.p.treeReader.expanded_field, isLeaf = $t.p.treeReader.leaf_field, level = $t.p.treeReader.level_field, //icon = $t.p.treeReader.icon_field, parent = $t.p.treeReader.parent_id_field, left = $t.p.treeReader.left_field, right = $t.p.treeReader.right_field, loaded = $t.p.treeReader.loaded, method, parentindex, parentdata, parentlevel, i, len, max=0, rowind = parentid, leaf, maxright; if(expandData===undefined) {expandData = false;} if ( nodeid === undefined || nodeid === null ) { i = $t.p.data.length-1; if( i&gt;= 0 ) { while(i&gt;=0){max = Math.max(max, parseInt($t.p.data[i][$t.p.localReader.id],10)); i--;} } nodeid = max+1; } var prow = $($t).jqGrid('getInd', parentid); leaf = false; // if not a parent we assume root if ( parentid === undefined || parentid === null || parentid===&quot;&quot;) { parentid = null; rowind = null; method = 'last'; parentlevel = $t.p.tree_root_level; i = $t.p.data.length+1; } else { method = 'after'; parentindex = $t.p._index[parentid]; parentdata = $t.p.data[parentindex]; parentid = parentdata[$t.p.localReader.id]; parentlevel = parseInt(parentdata[level],10)+1; var childs = $($t).jqGrid('getFullTreeNode', parentdata); // if there are child nodes get the last index of it if(childs.length) { i = childs[childs.length-1][$t.p.localReader.id]; rowind = i; i = $($t).jqGrid('getInd',rowind)+1; } else { i = $($t).jqGrid('getInd', parentid)+1; } // if the node is leaf if(parentdata[isLeaf]) { leaf = true; parentdata[expanded] = true; //var prow = $($t).jqGrid('getInd', parentid); $($t.rows[prow]) .find(&quot;span.cell-wrapperleaf&quot;).removeClass(&quot;cell-wrapperleaf&quot;).addClass(&quot;cell-wrapper&quot;) .end() .find(&quot;div.tree-leaf&quot;).removeClass($t.p.treeIcons.leaf+&quot; tree-leaf&quot;).addClass($t.p.treeIcons.minus+&quot; tree-minus&quot;); $t.p.data[parentindex][isLeaf] = false; parentdata[loaded] = true; } } len = i+1; if( data[expanded]===undefined) {data[expanded]= false;} if( data[loaded]===undefined ) { data[loaded] = false;} data[level] = parentlevel; if( data[isLeaf]===undefined) {data[isLeaf]= true;} if( $t.p.treeGridModel === &quot;adjacency&quot;) { data[parent] = parentid; } if( $t.p.treeGridModel === &quot;nested&quot;) { // this method requiere more attention var query, res, key; //maxright = parseInt(maxright,10); // ToDo - update grid data if(parentid !== null) { maxright = parseInt(parentdata[right],10); query = $.jgrid.from($t.p.data); query = query.greaterOrEquals(right,maxright,{stype:'integer'}); res = query.select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][left] = res[key][left] &gt; maxright ? parseInt(res[key][left],10) +2 : res[key][left]; res[key][right] = res[key][right] &gt;= maxright ? parseInt(res[key][right],10) +2 : res[key][right]; } } } data[left] = maxright; data[right]= maxright+1; } else { maxright = parseInt( $($t).jqGrid('getCol', right, false, 'max'), 10); res = $.jgrid.from($t.p.data) .greater(left,maxright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][left] = parseInt(res[key][left],10) +2 ; } } } res = $.jgrid.from($t.p.data) .greater(right,maxright,{stype:'integer'}) .select(); if(res.length) { for( key in res) { if(res.hasOwnProperty(key)) { res[key][right] = parseInt(res[key][right],10) +2 ; } } } data[left] = maxright+1; data[right] = maxright + 2; } } if( parentid === null || $($t).jqGrid(&quot;isNodeLoaded&quot;,parentdata) || leaf ) { $($t).jqGrid('addRowData', nodeid, data, method, rowind); $($t).jqGrid('setTreeNode', i, len); } if(parentdata &amp;&amp; !parentdata[expanded] &amp;&amp; expandData) { $($t.rows[prow]) .find(&quot;div.treeclick&quot;) .click(); } } //}); } }); })(jQuery); /*jshint eqeqeq:false, eqnull:true */ /*global jQuery */ // Grouping module (function($){ &quot;use strict&quot;; $.extend($.jgrid,{ template : function(format){ //jqgformat var args = $.makeArray(arguments).slice(1), j, al = args.length; if(format==null) { format = &quot;&quot;; } return format.replace(/\\{([\\w\\-]+)(?:\\:([\\w\\.]*)(?:\\((.*?)?\\))?)?\\}/g, function(m,i){ if(!isNaN(parseInt(i,10))) { return args[parseInt(i,10)]; } for(j=0; j &lt; al;j++) { if($.isArray(args[j])) { var nmarr = args[ j ], k = nmarr.length; while(k--) { if(i===nmarr[k].nm) { return nmarr[k].v; } } } } }); } }); $.jgrid.extend({ groupingSetup : function () { return this.each(function (){ var $t = this, i, j, cml, cm = $t.p.colModel, grp = $t.p.groupingView; if(grp !== null &amp;&amp; ( (typeof grp === 'object') || $.isFunction(grp) ) ) { if(!grp.groupField.length) { $t.p.grouping = false; } else { if (grp.visibiltyOnNextGrouping === undefined) { grp.visibiltyOnNextGrouping = []; } grp.lastvalues=[]; grp.groups =[]; grp.counters =[]; for(i=0;i&lt;grp.groupField.length;i++) { if(!grp.groupOrder[i]) { grp.groupOrder[i] = 'asc'; } if(!grp.groupText[i]) { grp.groupText[i] = '{0}'; } if( typeof grp.groupColumnShow[i] !== 'boolean') { grp.groupColumnShow[i] = true; } if( typeof grp.groupSummary[i] !== 'boolean') { grp.groupSummary[i] = false; } if(grp.groupColumnShow[i] === true) { grp.visibiltyOnNextGrouping[i] = true; $($t).jqGrid('showCol',grp.groupField[i]); } else { grp.visibiltyOnNextGrouping[i] = $(&quot;#&quot;+$.jgrid.jqID($t.p.id+&quot;_&quot;+grp.groupField[i])).is(&quot;:visible&quot;); $($t).jqGrid('hideCol',grp.groupField[i]); } } grp.summary =[]; for(j=0, cml = cm.length; j &lt; cml; j++) { if(cm[j].summaryType) { grp.summary.push({nm:cm[j].name,st:cm[j].summaryType, v: '', sr: cm[j].summaryRound, srt: cm[j].summaryRoundType || 'round'}); } } } } else { $t.p.grouping = false; } }); }, groupingPrepare : function (rData, gdata, record, irow) { this.each(function(){ var grp = this.p.groupingView, $t= this, i, grlen = grp.groupField.length, fieldName, v, displayName, displayValue, changed = 0; for(i=0;i&lt;grlen;i++) { fieldName = grp.groupField[i]; displayName = grp.displayField[i]; v = record[fieldName]; displayValue = displayName == null ? null : record[displayName]; if( displayValue == null ) { displayValue = v; } if( v !== undefined ) { if(irow === 0 ) { // First record always starts a new group grp.groups.push({idx:i,dataIndex:fieldName,value:v, displayValue: displayValue, startRow: irow, cnt:1, summary : [] } ); grp.lastvalues[i] = v; grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)}; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } else { if( typeof v !== &quot;object&quot; &amp;&amp; grp.lastvalues[i] !== v ) { // This record is not in same group as previous one grp.groups.push({idx:i,dataIndex:fieldName,value:v, displayValue: displayValue, startRow: irow, cnt:1, summary : [] } ); grp.lastvalues[i] = v; changed = 1; grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)}; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } else { if (changed === 1) { // This group has changed because an earlier group changed. grp.groups.push({idx:i,dataIndex:fieldName,value:v, displayValue: displayValue, startRow: irow, cnt:1, summary : [] } ); grp.lastvalues[i] = v; grp.counters[i] = {cnt:1, pos:grp.groups.length-1, summary: $.extend(true,[],grp.summary)}; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } else { grp.counters[i].cnt += 1; grp.groups[grp.counters[i].pos].cnt = grp.counters[i].cnt; $.each(grp.counters[i].summary,function() { if ($.isFunction(this.st)) { this.v = this.st.call($t, this.v, this.nm, record); } else { this.v = $($t).jqGrid('groupingCalculations.handler',this.st, this.v, this.nm, this.sr, this.srt, record); } }); grp.groups[grp.counters[i].pos].summary = grp.counters[i].summary; } } } } } gdata.push( rData ); }); return gdata; }, groupingToggle : function(hid){ this.each(function(){ var $t = this, grp = $t.p.groupingView, strpos = hid.split('_'), //uid = hid.substring(0,strpos+1), num = parseInt(strpos[strpos.length-2], 10); strpos.splice(strpos.length-2,2); var uid = strpos.join(&quot;_&quot;), minus = grp.minusicon, plus = grp.plusicon, tar = $(&quot;#&quot;+$.jgrid.jqID(hid)), r = tar.length ? tar[0].nextSibling : null, tarspan = $(&quot;#&quot;+$.jgrid.jqID(hid)+&quot; span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction), collapsed = false, tspan; if( tarspan.hasClass(minus) ) { if(grp.showSummaryOnHide) { if(r){ while(r) { if($(r).hasClass('jqfoot') ) { var lv = parseInt($(r).attr(&quot;jqfootlevel&quot;),10); if( lv &lt;= num) { break; } } $(r).hide(); r = r.nextSibling; } } } else { if(r){ while(r) { if( $(r).hasClass(uid+&quot;_&quot;+String(num) ) || $(r).hasClass(uid+&quot;_&quot;+String(num-1))) { break; } $(r).hide(); r = r.nextSibling; } } } tarspan.removeClass(minus).addClass(plus); collapsed = true; } else { if(r){ while(r) { if($(r).hasClass(uid+&quot;_&quot;+String(num)) || $(r).hasClass(uid+&quot;_&quot;+String(num-1)) ) { break; } $(r).show(); tspan = $(r).find(&quot;span.&quot;+&quot;tree-wrap-&quot;+$t.p.direction); if( tspan &amp;&amp; $(tspan).hasClass(plus) ) { $(tspan).removeClass(plus).addClass(minus); } r = r.nextSibling; } } tarspan.removeClass(plus).addClass(minus); } $($t).triggerHandler(&quot;jqGridGroupingClickGroup&quot;, [hid , collapsed]); if( $.isFunction($t.p.onClickGroup)) { $t.p.onClickGroup.call($t, hid , collapsed); } }); return false; }, groupingRender : function (grdata, colspans ) { return this.each(function(){ var $t = this, grp = $t.p.groupingView, str = &quot;&quot;, icon = &quot;&quot;, hid, clid, pmrtl = grp.groupCollapse ? grp.plusicon : grp.minusicon, gv, cp=[], len =grp.groupField.length; pmrtl += &quot; tree-wrap-&quot;+$t.p.direction; $.each($t.p.colModel, function (i,n){ var ii; for(ii=0;ii&lt;len;ii++) { if(grp.groupField[ii] === n.name ) { cp[ii] = i; break; } } }); var toEnd = 0; function findGroupIdx( ind , offset, grp) { var ret = false, i; if(offset===0) { ret = grp[ind]; } else { var id = grp[ind].idx; if(id===0) { ret = grp[ind]; } else { for(i=ind;i &gt;= 0; i--) { if(grp[i].idx === id-offset) { ret = grp[i]; break; } } } } return ret; } var sumreverse = $.makeArray(grp.groupSummary); sumreverse.reverse(); $.each(grp.groups,function(i,n){ toEnd++; clid = $t.p.id+&quot;ghead_&quot;+n.idx; hid = clid+&quot;_&quot;+i; icon = &quot;&lt;span style='cursor:pointer;' class='ui-icon &quot;+pmrtl+&quot;' onclick=\\&quot;jQuery('#&quot;+$.jgrid.jqID($t.p.id)+&quot;').jqGrid('groupingToggle','&quot;+hid+&quot;');return false;\\&quot;&gt;&lt;/span&gt;&quot;; try { gv = $t.formatter(hid, n.displayValue, cp[n.idx], n.value ); } catch (egv) { gv = n.displayValue; } str += &quot;&lt;tr id=\\&quot;&quot;+hid+&quot;\\&quot; role=\\&quot;row\\&quot; class= \\&quot;ui-widget-content jqgroup ui-row-&quot;+$t.p.direction+&quot; &quot;+clid+&quot;\\&quot;&gt;&lt;td style=\\&quot;padding-left:&quot;+(n.idx * 12) + &quot;px;&quot;+&quot;\\&quot; colspan=\\&quot;&quot;+colspans+&quot;\\&quot;&gt;&quot;+icon+$.jgrid.template(grp.groupText[n.idx], gv, n.cnt, n.summary)+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; var leaf = len-1 === n.idx; if( leaf ) { var gg = grp.groups[i+1], k, kk, ik; var end = gg !== undefined ? grp.groups[i+1].startRow : grdata.length; for(kk=n.startRow;kk&lt;end;kk++) { str += grdata[kk].join(''); } var jj; if (gg !== undefined) { for (jj = 0; jj &lt; grp.groupField.length; jj++) { if (gg.dataIndex === grp.groupField[jj]) { break; } } toEnd = grp.groupField.length - jj; } for (ik = 0; ik &lt; toEnd; ik++) { if(!sumreverse[ik]) { continue; } var hhdr = &quot;&quot;; if(grp.groupCollapse &amp;&amp; !grp.showSummaryOnHide) { hhdr = &quot; style=\\&quot;display:none;\\&quot;&quot;; } str += &quot;&lt;tr&quot;+hhdr+&quot; jqfootlevel=\\&quot;&quot;+(n.idx-ik)+&quot;\\&quot; role=\\&quot;row\\&quot; class=\\&quot;ui-widget-content jqfoot ui-row-&quot;+$t.p.direction+&quot;\\&quot;&gt;&quot;; var fdata = findGroupIdx(i, ik, grp.groups), cm = $t.p.colModel, vv, grlen = fdata.cnt; for(k=0; k&lt;colspans;k++) { var tmpdata = &quot;&lt;td &quot;+$t.formatCol(k,1,'')+&quot;&gt;&amp;#160;&lt;/td&gt;&quot;, tplfld = &quot;{0}&quot;; $.each(fdata.summary,function(){ if(this.nm === cm[k].name) { if(cm[k].summaryTpl) { tplfld = cm[k].summaryTpl; } if(typeof this.st === 'string' &amp;&amp; this.st.toLowerCase() === 'avg') { if(this.v &amp;&amp; grlen &gt; 0) { this.v = (this.v/grlen); } } try { vv = $t.formatter('', this.v, k, this); } catch (ef) { vv = this.v; } tmpdata= &quot;&lt;td &quot;+$t.formatCol(k,1,'')+&quot;&gt;&quot;+$.jgrid.format(tplfld,vv)+ &quot;&lt;/td&gt;&quot;; return false; } }); str += tmpdata; } str += &quot;&lt;/tr&gt;&quot;; } toEnd = jj; } }); $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).append(str); // free up memory str = null; }); }, groupingGroupBy : function (name, options ) { return this.each(function(){ var $t = this; if(typeof name === &quot;string&quot;) { name = [name]; } var grp = $t.p.groupingView; $t.p.grouping = true; //Set default, in case visibilityOnNextGrouping is undefined if (grp.visibiltyOnNextGrouping === undefined) { grp.visibiltyOnNextGrouping = []; } var i; // show previous hidden groups if they are hidden and weren't removed yet for(i=0;i&lt;grp.groupField.length;i++) { if(!grp.groupColumnShow[i] &amp;&amp; grp.visibiltyOnNextGrouping[i]) { $($t).jqGrid('showCol',grp.groupField[i]); } } // set visibility status of current group columns on next grouping for(i=0;i&lt;name.length;i++) { grp.visibiltyOnNextGrouping[i] = $(&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot;_&quot;+$.jgrid.jqID(name[i])).is(&quot;:visible&quot;); } $t.p.groupingView = $.extend($t.p.groupingView, options || {}); grp.groupField = name; $($t).trigger(&quot;reloadGrid&quot;); }); }, groupingRemove : function (current) { return this.each(function(){ var $t = this; if(current === undefined) { current = true; } $t.p.grouping = false; if(current===true) { var grp = $t.p.groupingView, i; // show previous hidden groups if they are hidden and weren't removed yet for(i=0;i&lt;grp.groupField.length;i++) { if (!grp.groupColumnShow[i] &amp;&amp; grp.visibiltyOnNextGrouping[i]) { $($t).jqGrid('showCol', grp.groupField); } } $(&quot;tr.jqgroup, tr.jqfoot&quot;,&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).remove(); $(&quot;tr.jqgrow:hidden&quot;,&quot;#&quot;+$.jgrid.jqID($t.p.id)+&quot; tbody:first&quot;).show(); } else { $($t).trigger(&quot;reloadGrid&quot;); } }); }, groupingCalculations : { handler: function(fn, v, field, round, roundType, rc) { var funcs = { sum: function() { return parseFloat(v||0) + parseFloat((rc[field]||0)); }, min: function() { if(v===&quot;&quot;) { return parseFloat(rc[field]||0); } return Math.min(parseFloat(v),parseFloat(rc[field]||0)); }, max: function() { if(v===&quot;&quot;) { return parseFloat(rc[field]||0); } return Math.max(parseFloat(v),parseFloat(rc[field]||0)); }, count: function() { if(v===&quot;&quot;) {v=0;} if(rc.hasOwnProperty(field)) { return v+1; } return 0; }, avg: function() { // the same as sum, but at end we divide it // so use sum instead of duplicating the code (?) return funcs.sum(); } }; if(!funcs[fn]) { throw (&quot;jqGrid Grouping No such method: &quot; + fn); } var res = funcs[fn](); if (round != null) { if (roundType == 'fixed') { res = res.toFixed(round); } else { var mul = Math.pow(10, round); res = Math.round(res * mul) / mul; } } return res; } } }); })(jQuery); /*jshint eqeqeq:false, eqnull:true, devel:true */ /*global jQuery, xmlJsonClass */ (function($){ /* * jqGrid extension for constructing Grid Data from external file * Tony Tomov tony@trirand.com * http://trirand.com/blog/ * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html **/ &quot;use strict&quot;; $.jgrid.extend({ jqGridImport : function(o) { o = $.extend({ imptype : &quot;xml&quot;, // xml, json, xmlstring, jsonstring impstring: &quot;&quot;, impurl: &quot;&quot;, mtype: &quot;GET&quot;, impData : {}, xmlGrid :{ config : &quot;roots&gt;grid&quot;, data: &quot;roots&gt;rows&quot; }, jsonGrid :{ config : &quot;grid&quot;, data: &quot;data&quot; }, ajaxOptions :{} }, o || {}); return this.each(function(){ var $t = this; var xmlConvert = function (xml,o) { var cnfg = $(o.xmlGrid.config,xml)[0]; var xmldata = $(o.xmlGrid.data,xml)[0], jstr, jstr1, key; if(xmlJsonClass.xml2json &amp;&amp; $.jgrid.parse) { jstr = xmlJsonClass.xml2json(cnfg,&quot; &quot;); jstr = $.jgrid.parse(jstr); for(key in jstr) { if(jstr.hasOwnProperty(key)) { jstr1=jstr[key]; } } if(xmldata) { // save the datatype var svdatatype = jstr.grid.datatype; jstr.grid.datatype = 'xmlstring'; jstr.grid.datastr = xml; $($t).jqGrid( jstr1 ).jqGrid(&quot;setGridParam&quot;,{datatype:svdatatype}); } else { $($t).jqGrid( jstr1 ); } jstr = null;jstr1=null; } else { alert(&quot;xml2json or parse are not present&quot;); } }; var jsonConvert = function (jsonstr,o){ if (jsonstr &amp;&amp; typeof jsonstr == 'string') { var _jsonparse = false; if($.jgrid.useJSON) { $.jgrid.useJSON = false; _jsonparse = true; } var json = $.jgrid.parse(jsonstr); if(_jsonparse) { $.jgrid.useJSON = true; } var gprm = json[o.jsonGrid.config]; var jdata = json[o.jsonGrid.data]; if(jdata) { var svdatatype = gprm.datatype; gprm.datatype = 'jsonstring'; gprm.datastr = jdata; $($t).jqGrid( gprm ).jqGrid(&quot;setGridParam&quot;,{datatype:svdatatype}); } else { $($t).jqGrid( gprm ); } } }; switch (o.imptype){ case 'xml': $.ajax($.extend({ url:o.impurl, type:o.mtype, data: o.impData, dataType:&quot;xml&quot;, complete: function(xml,stat) { if(stat == 'success') { xmlConvert(xml.responseXML,o); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [xml, o]); if($.isFunction(o.importComplete)) { o.importComplete(xml); } } xml=null; } }, o.ajaxOptions)); break; case 'xmlstring' : // we need to make just the conversion and use the same code as xml if(o.impstring &amp;&amp; typeof o.impstring == 'string') { var xmld = $.jgrid.stringToDoc(o.impstring); if(xmld) { xmlConvert(xmld,o); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [xmld, o]); if($.isFunction(o.importComplete)) { o.importComplete(xmld); } o.impstring = null; } xmld = null; } break; case 'json': $.ajax($.extend({ url:o.impurl, type:o.mtype, data: o.impData, dataType:&quot;json&quot;, complete: function(json) { try { jsonConvert(json.responseText,o ); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [json, o]); if($.isFunction(o.importComplete)) { o.importComplete(json); } } catch (ee){} json=null; } }, o.ajaxOptions )); break; case 'jsonstring' : if(o.impstring &amp;&amp; typeof o.impstring == 'string') { jsonConvert(o.impstring,o ); $($t).triggerHandler(&quot;jqGridImportComplete&quot;, [o.impstring, o]); if($.isFunction(o.importComplete)) { o.importComplete(o.impstring); } o.impstring = null; } break; } }); }, jqGridExport : function(o) { o = $.extend({ exptype : &quot;xmlstring&quot;, root: &quot;grid&quot;, ident: &quot;\\t&quot; }, o || {}); var ret = null; this.each(function () { if(!this.grid) { return;} var key, gprm = $.extend(true, {},$(this).jqGrid(&quot;getGridParam&quot;)); // we need to check for: // 1.multiselect, 2.subgrid 3. treegrid and remove the unneded columns from colNames if(gprm.rownumbers) { gprm.colNames.splice(0,1); gprm.colModel.splice(0,1); } if(gprm.multiselect) { gprm.colNames.splice(0,1); gprm.colModel.splice(0,1); } if(gprm.subGrid) { gprm.colNames.splice(0,1); gprm.colModel.splice(0,1); } gprm.knv = null; if(gprm.treeGrid) { for (key in gprm.treeReader) { if(gprm.treeReader.hasOwnProperty(key)) { gprm.colNames.splice(gprm.colNames.length-1); gprm.colModel.splice(gprm.colModel.length-1); } } } switch (o.exptype) { case 'xmlstring' : ret = &quot;&lt;&quot;+o.root+&quot;&gt;&quot;+xmlJsonClass.json2xml(gprm,o.ident)+&quot;&lt;/&quot;+o.root+&quot;&gt;&quot;; break; case 'jsonstring' : ret = &quot;{&quot;+ xmlJsonClass.toJson(gprm,o.root,o.ident,false)+&quot;}&quot;; if(gprm.postData.filters !== undefined) { ret=ret.replace(/filters&quot;:&quot;/,'filters&quot;:'); ret=ret.replace(/}]}&quot;/,'}]}'); } break; } }); return ret; }, excelExport : function(o) { o = $.extend({ exptype : &quot;remote&quot;, url : null, oper: &quot;oper&quot;, tag: &quot;excel&quot;, exportOptions : {} }, o || {}); return this.each(function(){ if(!this.grid) { return;} var url; if(o.exptype == &quot;remote&quot;) { var pdata = $.extend({},this.p.postData); pdata[o.oper] = o.tag; var params = jQuery.param(pdata); if(o.url.indexOf(&quot;?&quot;) != -1) { url = o.url+&quot;&amp;&quot;+params; } else { url = o.url+&quot;?&quot;+params; } window.location = url; } }); } }); })(jQuery); /*jshint evil:true, eqeqeq:false, eqnull:true, devel:true */ /*global jQuery */ (function($){ /* ** * jqGrid addons using jQuery UI * Author: Mark Williams * Dual licensed under the MIT and GPL licenses: * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl-2.0.html * depends on jQuery UI **/ &quot;use strict&quot;; if ($.jgrid.msie &amp;&amp; $.jgrid.msiever()==8) { $.expr[&quot;:&quot;].hidden = function(elem) { return elem.offsetWidth === 0 || elem.offsetHeight === 0 || elem.style.display == &quot;none&quot;; }; } // requiere load multiselect before grid $.jgrid._multiselect = false; if($.ui) { if ($.ui.multiselect ) { if($.ui.multiselect.prototype._setSelected) { var setSelected = $.ui.multiselect.prototype._setSelected; $.ui.multiselect.prototype._setSelected = function(item,selected) { var ret = setSelected.call(this,item,selected); if (selected &amp;&amp; this.selectedList) { var elt = this.element; this.selectedList.find('li').each(function() { if ($(this).data('optionLink')) { $(this).data('optionLink').remove().appendTo(elt); } }); } return ret; }; } if($.ui.multiselect.prototype.destroy) { $.ui.multiselect.prototype.destroy = function() { this.element.show(); this.container.remove(); if ($.Widget === undefined) { $.widget.prototype.destroy.apply(this, arguments); } else { $.Widget.prototype.destroy.apply(this, arguments); } }; } $.jgrid._multiselect = true; } } $.jgrid.extend({ sortableColumns : function (tblrow) { return this.each(function (){ var ts = this, tid= $.jgrid.jqID( ts.p.id ); function start() {ts.p.disableClick = true;} var sortable_opts = { &quot;tolerance&quot; : &quot;pointer&quot;, &quot;axis&quot; : &quot;x&quot;, &quot;scrollSensitivity&quot;: &quot;1&quot;, &quot;items&quot;: '&gt;th:not(:has(#jqgh_'+tid+'_cb'+',#jqgh_'+tid+'_rn'+',#jqgh_'+tid+'_subgrid),:hidden)', &quot;placeholder&quot;: { element: function(item) { var el = $(document.createElement(item[0].nodeName)) .addClass(item[0].className+&quot; ui-sortable-placeholder ui-state-highlight&quot;) .removeClass(&quot;ui-sortable-helper&quot;)[0]; return el; }, update: function(self, p) { p.height(self.currentItem.innerHeight() - parseInt(self.currentItem.css('paddingTop')||0, 10) - parseInt(self.currentItem.css('paddingBottom')||0, 10)); p.width(self.currentItem.innerWidth() - parseInt(self.currentItem.css('paddingLeft')||0, 10) - parseInt(self.currentItem.css('paddingRight')||0, 10)); } }, &quot;update&quot;: function(event, ui) { var p = $(ui.item).parent(), th = $(&quot;&gt;th&quot;, p), colModel = ts.p.colModel, cmMap = {}, tid= ts.p.id+&quot;_&quot;; $.each(colModel, function(i) { cmMap[this.name]=i; }); var permutation = []; th.each(function() { var id = $(&quot;&gt;div&quot;, this).get(0).id.replace(/^jqgh_/, &quot;&quot;).replace(tid,&quot;&quot;); if (cmMap.hasOwnProperty(id)) { permutation.push(cmMap[id]); } }); $(ts).jqGrid(&quot;remapColumns&quot;,permutation, true, true); if ($.isFunction(ts.p.sortable.update)) { ts.p.sortable.update(permutation); } setTimeout(function(){ts.p.disableClick=false;}, 50); } }; if (ts.p.sortable.options) { $.extend(sortable_opts, ts.p.sortable.options); } else if ($.isFunction(ts.p.sortable)) { ts.p.sortable = { &quot;update&quot; : ts.p.sortable }; } if (sortable_opts.start) { var s = sortable_opts.start; sortable_opts.start = function(e,ui) { start(); s.call(this,e,ui); }; } else { sortable_opts.start = start; } if (ts.p.sortable.exclude) { sortable_opts.items += &quot;:not(&quot;+ts.p.sortable.exclude+&quot;)&quot;; } tblrow.sortable(sortable_opts).data(&quot;sortable&quot;).floating = true; }); }, columnChooser : function(opts) { var self = this; if($(&quot;#colchooser_&quot;+$.jgrid.jqID(self[0].p.id)).length ) { return; } var selector = $('&lt;div id=&quot;colchooser_'+self[0].p.id+'&quot; style=&quot;position:relative;overflow:hidden&quot;&gt;&lt;div&gt;&lt;select multiple=&quot;multiple&quot;&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;'); var select = $('select', selector); function insert(perm,i,v) { if(i&gt;=0){ var a = perm.slice(); var b = a.splice(i,Math.max(perm.length-i,i)); if(i&gt;perm.length) { i = perm.length; } a[i] = v; return a.concat(b); } } opts = $.extend({ &quot;width&quot; : 420, &quot;height&quot; : 240, &quot;classname&quot; : null, &quot;done&quot; : function(perm) { if (perm) { self.jqGrid(&quot;remapColumns&quot;, perm, true); } }, /* msel is either the name of a ui widget class that extends a multiselect, or a function that supports creating a multiselect object (with no argument, or when passed an object), and destroying it (when passed the string &quot;destroy&quot;). */ &quot;msel&quot; : &quot;multiselect&quot;, /* &quot;msel_opts&quot; : {}, */ /* dlog is either the name of a ui widget class that behaves in a dialog-like way, or a function, that supports creating a dialog (when passed dlog_opts) or destroying a dialog (when passed the string &quot;destroy&quot;) */ &quot;dlog&quot; : &quot;dialog&quot;, &quot;dialog_opts&quot; : { &quot;minWidth&quot;: 470 }, /* dlog_opts is either an option object to be passed to &quot;dlog&quot;, or (more likely) a function that creates the options object. The default produces a suitable options object for ui.dialog */ &quot;dlog_opts&quot; : function(opts) { var buttons = {}; buttons[opts.bSubmit] = function() { opts.apply_perm(); opts.cleanup(false); }; buttons[opts.bCancel] = function() { opts.cleanup(true); }; return $.extend(true, { &quot;buttons&quot;: buttons, &quot;close&quot;: function() { opts.cleanup(true); }, &quot;modal&quot; : opts.modal || false, &quot;resizable&quot;: opts.resizable || true, &quot;width&quot;: opts.width+20 }, opts.dialog_opts || {}); }, /* Function to get the permutation array, and pass it to the &quot;done&quot; function */ &quot;apply_perm&quot; : function() { $('option',select).each(function() { if (this.selected) { self.jqGrid(&quot;showCol&quot;, colModel[this.value].name); } else { self.jqGrid(&quot;hideCol&quot;, colModel[this.value].name); } }); var perm = []; //fixedCols.slice(0); $('option:selected',select).each(function() { perm.push(parseInt(this.value,10)); }); $.each(perm, function() { delete colMap[colModel[parseInt(this,10)].name]; }); $.each(colMap, function() { var ti = parseInt(this,10); perm = insert(perm,ti,ti); }); if (opts.done) { opts.done.call(self, perm); } }, /* Function to cleanup the dialog, and select. Also calls the done function with no permutation (to indicate that the columnChooser was aborted */ &quot;cleanup&quot; : function(calldone) { call(opts.dlog, selector, 'destroy'); call(opts.msel, select, 'destroy'); selector.remove(); if (calldone &amp;&amp; opts.done) { opts.done.call(self); } }, &quot;msel_opts&quot; : {} }, $.jgrid.col, opts || {}); if($.ui) { if ($.ui.multiselect ) { if(opts.msel == &quot;multiselect&quot;) { if(!$.jgrid._multiselect) { // should be in language file alert(&quot;Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!&quot;); return; } opts.msel_opts = $.extend($.ui.multiselect.defaults,opts.msel_opts); } } } if (opts.caption) { selector.attr(&quot;title&quot;, opts.caption); } if (opts.classname) { selector.addClass(opts.classname); select.addClass(opts.classname); } if (opts.width) { $(&quot;&gt;div&quot;,selector).css({&quot;width&quot;: opts.width,&quot;margin&quot;:&quot;0 auto&quot;}); select.css(&quot;width&quot;, opts.width); } if (opts.height) { $(&quot;&gt;div&quot;,selector).css(&quot;height&quot;, opts.height); select.css(&quot;height&quot;, opts.height - 10); } var colModel = self.jqGrid(&quot;getGridParam&quot;, &quot;colModel&quot;); var colNames = self.jqGrid(&quot;getGridParam&quot;, &quot;colNames&quot;); var colMap = {}, fixedCols = []; select.empty(); $.each(colModel, function(i) { colMap[this.name] = i; if (this.hidedlg) { if (!this.hidden) { fixedCols.push(i); } return; } select.append(&quot;&lt;option value='&quot;+i+&quot;' &quot;+ (this.hidden?&quot;&quot;:&quot;selected='selected'&quot;)+&quot;&gt;&quot;+$.jgrid.stripHtml(colNames[i])+&quot;&lt;/option&gt;&quot;); }); function call(fn, obj) { if (!fn) { return; } if (typeof fn == 'string') { if ($.fn[fn]) { $.fn[fn].apply(obj, $.makeArray(arguments).slice(2)); } } else if ($.isFunction(fn)) { fn.apply(obj, $.makeArray(arguments).slice(2)); } } var dopts = $.isFunction(opts.dlog_opts) ? opts.dlog_opts.call(self, opts) : opts.dlog_opts; call(opts.dlog, selector, dopts); var mopts = $.isFunction(opts.msel_opts) ? opts.msel_opts.call(self, opts) : opts.msel_opts; call(opts.msel, select, mopts); }, sortableRows : function (opts) { // Can accept all sortable options and events return this.each(function(){ var $t = this; if(!$t.grid) { return; } // Currently we disable a treeGrid sortable if($t.p.treeGrid) { return; } if($.fn.sortable) { opts = $.extend({ &quot;cursor&quot;:&quot;move&quot;, &quot;axis&quot; : &quot;y&quot;, &quot;items&quot;: &quot;.jqgrow&quot; }, opts || {}); if(opts.start &amp;&amp; $.isFunction(opts.start)) { opts._start_ = opts.start; delete opts.start; } else {opts._start_=false;} if(opts.update &amp;&amp; $.isFunction(opts.update)) { opts._update_ = opts.update; delete opts.update; } else {opts._update_ = false;} opts.start = function(ev,ui) { $(ui.item).css(&quot;border-width&quot;,&quot;0px&quot;); $(&quot;td&quot;,ui.item).each(function(i){ this.style.width = $t.grid.cols[i].style.width; }); if($t.p.subGrid) { var subgid = $(ui.item).attr(&quot;id&quot;); try { $($t).jqGrid('collapseSubGridRow',subgid); } catch (e) {} } if(opts._start_) { opts._start_.apply(this,[ev,ui]); } }; opts.update = function (ev,ui) { $(ui.item).css(&quot;border-width&quot;,&quot;&quot;); if($t.p.rownumbers === true) { $(&quot;td.jqgrid-rownum&quot;,$t.rows).each(function( i ){ $(this).html( i+1+(parseInt($t.p.page,10)-1)*parseInt($t.p.rowNum,10) ); }); } if(opts._update_) { opts._update_.apply(this,[ev,ui]); } }; $(&quot;tbody:first&quot;,$t).sortable(opts); $(&quot;tbody:first&quot;,$t).disableSelection(); } }); }, gridDnD : function(opts) { return this.each(function(){ var $t = this, i, cn; if(!$t.grid) { return; } // Currently we disable a treeGrid drag and drop if($t.p.treeGrid) { return; } if(!$.fn.draggable || !$.fn.droppable) { return; } function updateDnD () { var datadnd = $.data($t,&quot;dnd&quot;); $(&quot;tr.jqgrow:not(.ui-draggable)&quot;,$t).draggable($.isFunction(datadnd.drag) ? datadnd.drag.call($($t),datadnd) : datadnd.drag); } var appender = &quot;&lt;table id='jqgrid_dnd' class='ui-jqgrid-dnd'&gt;&lt;/table&gt;&quot;; if($(&quot;#jqgrid_dnd&quot;)[0] === undefined) { $('body').append(appender); } if(typeof opts == 'string' &amp;&amp; opts == 'updateDnD' &amp;&amp; $t.p.jqgdnd===true) { updateDnD(); return; } opts = $.extend({ &quot;drag&quot; : function (opts) { return $.extend({ start : function (ev, ui) { var i, subgid; // if we are in subgrid mode try to collapse the node if($t.p.subGrid) { subgid = $(ui.helper).attr(&quot;id&quot;); try { $($t).jqGrid('collapseSubGridRow',subgid); } catch (e) {} } // hack // drag and drop does not insert tr in table, when the table has no rows // we try to insert new empty row on the target(s) for (i=0;i&lt;$.data($t,&quot;dnd&quot;).connectWith.length;i++){ if($($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid('getGridParam','reccount') == &quot;0&quot; ){ $($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid('addRowData','jqg_empty_row',{}); } } ui.helper.addClass(&quot;ui-state-highlight&quot;); $(&quot;td&quot;,ui.helper).each(function(i) { this.style.width = $t.grid.headers[i].width+&quot;px&quot;; }); if(opts.onstart &amp;&amp; $.isFunction(opts.onstart) ) { opts.onstart.call($($t),ev,ui); } }, stop :function(ev,ui) { var i, ids; if(ui.helper.dropped &amp;&amp; !opts.dragcopy) { ids = $(ui.helper).attr(&quot;id&quot;); if(ids === undefined) { ids = $(this).attr(&quot;id&quot;); } $($t).jqGrid('delRowData',ids ); } // if we have a empty row inserted from start event try to delete it for (i=0;i&lt;$.data($t,&quot;dnd&quot;).connectWith.length;i++){ $($.data($t,&quot;dnd&quot;).connectWith[i]).jqGrid('delRowData','jqg_empty_row'); } if(opts.onstop &amp;&amp; $.isFunction(opts.onstop) ) { opts.onstop.call($($t),ev,ui); } } },opts.drag_opts || {}); }, &quot;drop&quot; : function (opts) { return $.extend({ accept: function(d) { if (!$(d).hasClass('jqgrow')) { return d;} var tid = $(d).closest(&quot;table.ui-jqgrid-btable&quot;); if(tid.length &gt; 0 &amp;&amp; $.data(tid[0],&quot;dnd&quot;) !== undefined) { var cn = $.data(tid[0],&quot;dnd&quot;).connectWith; return $.inArray('#'+$.jgrid.jqID(this.id),cn) != -1 ? true : false; } return false; }, drop: function(ev, ui) { if (!$(ui.draggable).hasClass('jqgrow')) { return; } var accept = $(ui.draggable).attr(&quot;id&quot;); var getdata = ui.draggable.parent().parent().jqGrid('getRowData',accept); if(!opts.dropbyname) { var j =0, tmpdata = {}, nm, key; var dropmodel = $(&quot;#&quot;+$.jgrid.jqID(this.id)).jqGrid('getGridParam','colModel'); try { for (key in getdata) { if (getdata.hasOwnProperty(key)) { nm = dropmodel[j].name; if( !(nm == 'cb' || nm =='rn' || nm == 'subgrid' )) { if(getdata.hasOwnProperty(key) &amp;&amp; dropmodel[j]) { tmpdata[nm] = getdata[key]; } } j++; } } getdata = tmpdata; } catch (e) {} } ui.helper.dropped = true; if(opts.beforedrop &amp;&amp; $.isFunction(opts.beforedrop) ) { //parameters to this callback - event, element, data to be inserted, sender, reciever // should return object which will be inserted into the reciever var datatoinsert = opts.beforedrop.call(this,ev,ui,getdata,$('#'+$.jgrid.jqID($t.p.id)),$(this)); if (datatoinsert !== undefined &amp;&amp; datatoinsert !== null &amp;&amp; typeof datatoinsert == &quot;object&quot;) { getdata = datatoinsert; } } if(ui.helper.dropped) { var grid; if(opts.autoid) { if($.isFunction(opts.autoid)) { grid = opts.autoid.call(this,getdata); } else { grid = Math.ceil(Math.random()*1000); grid = opts.autoidprefix+grid; } } // NULL is interpreted as undefined while null as object $(&quot;#&quot;+$.jgrid.jqID(this.id)).jqGrid('addRowData',grid,getdata,opts.droppos); } if(opts.ondrop &amp;&amp; $.isFunction(opts.ondrop) ) { opts.ondrop.call(this,ev,ui, getdata); } }}, opts.drop_opts || {}); }, &quot;onstart&quot; : null, &quot;onstop&quot; : null, &quot;beforedrop&quot;: null, &quot;ondrop&quot; : null, &quot;drop_opts&quot; : { &quot;activeClass&quot;: &quot;ui-state-active&quot;, &quot;hoverClass&quot;: &quot;ui-state-hover&quot; }, &quot;drag_opts&quot; : { &quot;revert&quot;: &quot;invalid&quot;, &quot;helper&quot;: &quot;clone&quot;, &quot;cursor&quot;: &quot;move&quot;, &quot;appendTo&quot; : &quot;#jqgrid_dnd&quot;, &quot;zIndex&quot;: 5000 }, &quot;dragcopy&quot;: false, &quot;dropbyname&quot; : false, &quot;droppos&quot; : &quot;first&quot;, &quot;autoid&quot; : true, &quot;autoidprefix&quot; : &quot;dnd_&quot; }, opts || {}); if(!opts.connectWith) { return; } opts.connectWith = opts.connectWith.split(&quot;,&quot;); opts.connectWith = $.map(opts.connectWith,function(n){return $.trim(n);}); $.data($t,&quot;dnd&quot;,opts); if($t.p.reccount != &quot;0&quot; &amp;&amp; !$t.p.jqgdnd) { updateDnD(); } $t.p.jqgdnd = true; for (i=0;i&lt;opts.connectWith.length;i++){ cn =opts.connectWith[i]; $(cn).droppable($.isFunction(opts.drop) ? opts.drop.call($($t),opts) : opts.drop); } }); }, gridResize : function(opts) { return this.each(function(){ var $t = this, gID = $.jgrid.jqID($t.p.id); if(!$t.grid || !$.fn.resizable) { return; } opts = $.extend({}, opts || {}); if(opts.alsoResize ) { opts._alsoResize_ = opts.alsoResize; delete opts.alsoResize; } else { opts._alsoResize_ = false; } if(opts.stop &amp;&amp; $.isFunction(opts.stop)) { opts._stop_ = opts.stop; delete opts.stop; } else { opts._stop_ = false; } opts.stop = function (ev, ui) { $($t).jqGrid('setGridParam',{height:$(&quot;#gview_&quot;+gID+&quot; .ui-jqgrid-bdiv&quot;).height()}); $($t).jqGrid('setGridWidth',ui.size.width,opts.shrinkToFit); if(opts._stop_) { opts._stop_.call($t,ev,ui); } }; if(opts._alsoResize_) { var optstest = &quot;{\\'#gview_&quot;+gID+&quot; .ui-jqgrid-bdiv\\':true,'&quot; +opts._alsoResize_+&quot;':true}&quot;; opts.alsoResize = eval('('+optstest+')'); // the only way that I found to do this } else { opts.alsoResize = $(&quot;.ui-jqgrid-bdiv&quot;,&quot;#gview_&quot;+gID); } delete opts._alsoResize_; $(&quot;#gbox_&quot;+gID).resizable(opts); }); } }); })(jQuery); /* Transform a table to a jqGrid. Peter Romianowski &lt;peter.romianowski@optivo.de&gt; If the first column of the table contains checkboxes or radiobuttons then the jqGrid is made selectable. */ // Addition - selector can be a class or id function tableToGrid(selector, options) { jQuery(selector).each(function() { if(this.grid) {return;} //Adedd from Tony Tomov // This is a small &quot;hack&quot; to make the width of the jqGrid 100% jQuery(this).width(&quot;99%&quot;); var w = jQuery(this).width(); // Text whether we have single or multi select var inputCheckbox = jQuery('tr td:first-child input[type=checkbox]:first', jQuery(this)); var inputRadio = jQuery('tr td:first-child input[type=radio]:first', jQuery(this)); var selectMultiple = inputCheckbox.length &gt; 0; var selectSingle = !selectMultiple &amp;&amp; inputRadio.length &gt; 0; var selectable = selectMultiple || selectSingle; //var inputName = inputCheckbox.attr(&quot;name&quot;) || inputRadio.attr(&quot;name&quot;); // Build up the columnModel and the data var colModel = []; var colNames = []; jQuery('th', jQuery(this)).each(function() { if (colModel.length === 0 &amp;&amp; selectable) { colModel.push({ name: '__selection__', index: '__selection__', width: 0, hidden: true }); colNames.push('__selection__'); } else { colModel.push({ name: jQuery(this).attr(&quot;id&quot;) || jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'), index: jQuery(this).attr(&quot;id&quot;) || jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'), width: jQuery(this).width() || 150 }); colNames.push(jQuery(this).html()); } }); var data = []; var rowIds = []; var rowChecked = []; jQuery('tbody &gt; tr', jQuery(this)).each(function() { var row = {}; var rowPos = 0; jQuery('td', jQuery(this)).each(function() { if (rowPos === 0 &amp;&amp; selectable) { var input = jQuery('input', jQuery(this)); var rowId = input.attr(&quot;value&quot;); rowIds.push(rowId || data.length); if (input.is(&quot;:checked&quot;)) { rowChecked.push(rowId); } row[colModel[rowPos].name] = input.attr(&quot;value&quot;); } else { row[colModel[rowPos].name] = jQuery(this).html(); } rowPos++; }); if(rowPos &gt;0) { data.push(row); } }); // Clear the original HTML table jQuery(this).empty(); // Mark it as jqGrid jQuery(this).addClass(&quot;scroll&quot;); jQuery(this).jqGrid(jQuery.extend({ datatype: &quot;local&quot;, width: w, colNames: colNames, colModel: colModel, multiselect: selectMultiple //inputName: inputName, //inputValueCol: imputName != null ? &quot;__selection__&quot; : null }, options || {})); // Add data var a; for (a = 0; a &lt; data.length; a++) { var id = null; if (rowIds.length &gt; 0) { id = rowIds[a]; if (id &amp;&amp; id.replace) { // We have to do this since the value of a checkbox // or radio button can be anything id = encodeURIComponent(id).replace(/[.\\-%]/g, &quot;_&quot;); } } if (id === null) { id = a + 1; } jQuery(this).jqGrid(&quot;addRowData&quot;,id, data[a]); } // Set the selection for (a = 0; a &lt; rowChecked.length; a++) { jQuery(this).jqGrid(&quot;setSelection&quot;,rowChecked[a]); } }); }; × Search results Close "},"rup_table_rup.table.contextMenu.js.html":{"id":"rup_table_rup.table.contextMenu.js.html","title":"Source: rup_table/rup.table.contextMenu.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.contextMenu.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;contextMenu&quot;,{ loadOrder:4, preConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;preConfigureContextMenu&quot;, settings); }, postConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;postConfigureContextMenu&quot;, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Extensión del componente rup_table para permitir la gestión del diseño líquido del componente. * * Los métodos implementados son: * * postConfigureFilter(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * * Se almacena la referencia de los diferentes componentes: * * settings.$fluidBaseLayer : Referencia a la capa que se tomará como base para aplicar el diseño líquido. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ preConfigureContextMenu: function(settings){ var $self = this, contextMenuSettings = settings.contextMenu; // Se unifican los parámetros de configuración de mostrar/ocultar los botones de la toolbar if (contextMenuSettings.createDefaultRowOperations===true) { contextMenuSettings.showOperations = jQuery.extend(true, {}, contextMenuSettings.defaultRowOperations, settings.core.showOperations, contextMenuSettings.showOperations); } }, postConfigureContextMenu: function(settings){ var $self = this, contextMenuSettings = settings.contextMenu; function getTdIndex(thArray, name){ for(var i=0;i&lt;thArray.length;i++){ if (jQuery(thArray[i]).attr(&quot;id&quot;)===settings.id+&quot;_&quot;+name){ return i+1; } } return -1; } $self.one({ &quot;jqGridLoadComplete.rupTable.contextMenu&quot;: function(data){ var $tbodyTr = jQuery(settings.contextMenu.tbodySelector, $self), contextRowItems={}, cellLevelContextMenu=false, globalCellLevelContextMenu = jQuery.isArray(settings.contextMenu.colNames), itemsPerColumn={}, colItem, thArray; // jQuery.each(settings.contextMenu.defaultRowOperations, function(buttonId, value){ jQuery.each(settings.contextMenu.showOperations, function(buttonId, value){ var operationCfg; if (value!==false){ operationCfg = settings.core.operations[buttonId]; if (operationCfg!==undefined){ contextRowItems[buttonId]={ name: operationCfg.name, id:settings.id+&quot;_contextMenu_&quot;+buttonId, cssSprite:operationCfg.icon, disabled: function(){ return !jQuery.proxy(operationCfg.enabled,$self)(); }, callback: function(key, options){ jQuery.proxy(operationCfg.callback,$self)(key, options); }, className:operationCfg.className }; if (jQuery.isArray(value)===true){ cellLevelContextMenu=true; contextRowItems[buttonId].colNames=value; } } } }); jQuery.each(settings.contextMenu.items,function(index, oper){ if (jQuery.isArray(oper.colNames)){ cellLevelContextMenu=true; } }); jQuery.extend(true, contextRowItems, settings.contextMenu.items); // En caso de especificar solo para unas columnas thArray = jQuery(settings.contextMenu.theadThSelector, &quot;#gview_&quot;+settings.id); // Eliminamos los contextMenu creados previamente $(&quot;ul.context-menu-list&quot;, $tbodyTr).remove(); if (globalCellLevelContextMenu &amp;&amp; !cellLevelContextMenu){ for (var i=0;i&lt; contextMenuSettings.colNames.length;i++){ jQuery(contextMenuSettings.tbodyTdSelector+&quot;:nth-child(&quot;+getTdIndex(thArray, contextMenuSettings.colNames[i])+&quot;)&quot;, $self).rup_contextMenu({ items: contextRowItems }); } }else if (cellLevelContextMenu){ // // En caso de no especificarse un valor de colnames para indicar sobre cuales se debe de mostrar el menú contextual, se toman todas las visibles. if (!jQuery.isArray(contextMenuSettings.colNames)){ contextMenuSettings.colNames = jQuery.map(settings.colModel, function(elem, index){ if (elem.hidden!==true){ return elem.name; } }); } jQuery.each(contextRowItems, function(index, item){ var colNamesAux; if (jQuery.isArray(item.colNames)){ colNamesAux = item.colNames; }else{ colNamesAux = contextMenuSettings.colNames; } for (var i=0;i&lt;colNamesAux.length;i++){ colItem={}; colItem[colNamesAux[i]]={}; jQuery.extend(true, itemsPerColumn, colItem); var itemAux = {}; itemAux[index] = item; jQuery.extend(true, itemsPerColumn[colNamesAux[i]], itemAux); } }); jQuery.each(itemsPerColumn, function(index, item){ jQuery(contextMenuSettings.tbodyTdSelector+&quot;:nth-child(&quot;+getTdIndex(thArray, index)+&quot;)&quot;, $self).rup_contextMenu({ items: item }); }); }else{ $tbodyTr.rup_contextMenu({ items: contextRowItems }); } } }); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Parámetros de configuración por defecto para el plugin fluid. * */ jQuery.fn.rup_table.plugins.contextMenu = {}; jQuery.fn.rup_table.plugins.contextMenu.defaults = { contextMenu:{ colNames: null, createDefaultRowOperations:true, defaultRowOperations:{}, rowOperations:{}, tbodySelector:&quot;tbody:first tr[role='row'].jqgrow&quot;, tbodyTdSelector:&quot;tbody:first tr.jqgrow td&quot;, theadThSelector:&quot;thead:first th&quot;, items:{} } }; })(jQuery); × Search results Close "},"rup_table_rup.table.feedback.js.html":{"id":"rup_table_rup.table.feedback.js.html","title":"Source: rup_table/rup.table.feedback.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.feedback.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * preConfiguration: Método que se ejecuta antes de la invocación del componente jqGrid. * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;feedback&quot;,{ loadOrder:2, preConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;preConfigureFeedback&quot;, settings); }, postConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;postConfigureFeedback&quot;, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Extensión del componente rup_table para permitir la gestión de la botonera asociada a la tabla. * * Los métodos implementados son: * * preConfigureFeedback(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * postConfigureFeedback(settings): Método que define la postconfiguración necesaria para el correcto funcionamiento del componente. * * settings.$feedback : Referencia al componente feedback. * settings.$$internalFeedback : Referencia al feedback interno. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ /* * Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * * TODO: internacionalizar mensajes de error. */ preConfigureFeedback: function(settings){ var $self = this, feedbackId, feedbackSettings = settings.feedback, $feedback; /* * Inicialización de los identificadores por defecto de los componentes del toolbar */ feedbackSettings.id = feedbackSettings.id!==null?feedbackSettings.id:settings.id+&quot;_feedback&quot;; feedbackId = (feedbackSettings.id[0]===&quot;#&quot;?feedbackSettings.id:&quot;#&quot;+feedbackSettings.id); $feedback = jQuery(feedbackId); if ($feedback.length === 0){ alert(&quot;El identificador especificado para el feedback no existe.&quot;); }else{ settings.$feedback = $feedback; settings.$feedback.rup_feedback(feedbackSettings.config).attr(&quot;ruptype&quot;,&quot;feedback&quot;); } if (!jQuery.isFunction(settings.loadError)){ settings.loadError = function(xhr,st,err){ $self.rup_table(&quot;showFeedback&quot;, settings.$feedback, xhr.responseText, &quot;error&quot;); }; } }, /* * Método que define la postconfiguración necesaria para el correcto funcionamiento del componente. * */ postConfigureFeedback: function(settings){ // Definición del feedback interno settings.$internalFeedback = $(&quot;&lt;div/&gt;&quot;).attr(&quot;id&quot;, &quot;rup_feedback_&quot; + settings.id).insertBefore('#gbox_' + settings.id); settings.$internalFeedback.rup_feedback(settings.feedback.internalFeedbackConfig); } }); jQuery.fn.rup_table(&quot;extend&quot;,{ showFeedback: function($feedback, msg, type, options){ var $self = this, settings = $self.data(&quot;settings&quot;), options_backup, default_options; if (options === false){ // Muestra el feedback con las opciones con las que se ha creado $feedback.rup_feedback(&quot;set&quot;, msg, type); }else if (jQuery.isPlainObject(options)){ // Se aplicam las opciones de configuración indicadas sin modificar las del feedback $feedback.rup_feedback(&quot;option&quot;, options); $feedback.rup_feedback(&quot;set&quot;, msg, type); }else{ // Se utilizan las opciones de configuración por defecto del componente table default_options = (settings.feedback[type+&quot;FeedbackConfig&quot;]!==undefined?settings.feedback[type+&quot;FeedbackConfig&quot;]:settings.feedback.okFeedbackConfig); $feedback.rup_feedback(&quot;option&quot;, default_options); $feedback.rup_feedback(&quot;set&quot;, msg, type); } } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Parámetros de configuración por defecto para el feedback. * * feedback.config: Configuración por defecto del feedback principal. * feedback.internalFeedbackConfig: Configuración por defecto del feedback interno. */ jQuery.fn.rup_table.plugins.feedback = {}; jQuery.fn.rup_table.plugins.feedback.defaults = { loadError : function(xhr,st,err){ var $self = $(this), settings = $self.data(&quot;settings&quot;); $self.rup_table(&quot;showFeedback&quot;, settings.$feedback, xhr.responseText, &quot;error&quot;); }, feedback:{ okFeedbackConfig:{ closeLink: true, gotoTop: false, delay:1000 }, errorFeedbackConfig:{ closeLink: true, gotoTop: false, delay:null }, alertFeedbackConfig:{ closeLink: true, gotoTop: false, delay:null }, id: null, config:{ type: &quot;ok&quot;, closeLink: true, gotoTop: false, block: true }, internalFeedbackConfig:{ type: &quot;ok&quot;, closeLink: true, gotoTop: false, block: false } } }; })(jQuery); × Search results Close "},"rup_table_rup.table.filter.js.html":{"id":"rup_table_rup.table.filter.js.html","title":"Source: rup_table/rup.table.filter.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.filter.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;filter&quot;,{ loadOrder:1, preConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;preConfigureFilter&quot;, settings); }, postConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;postConfigureFilter&quot;, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Extensión del componente rup_table para permitir la gestión del filtrado de registros de la tabla. * * Los métodos implementados son: * * postConfigureFilter(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * * Se almacena la referencia de los diferentes componentes: * * settings.filter.$filterContainer : Contenedor del formulario de filtrado * settings.filter.$filterButton : Botón que realiza el filtrado * settings.filter.$cleanLink : Enlace para limpiar el formulario * settings.filter.$collapsableLayer : Capa que puede ser ocultada/mostrada * settings.filter.$toggleIcon1Id : Control que oculta muestra el fomulario * settings.filter.$filterSummary : Contenedor donde se especifican los criterios de filtrado * */ jQuery.fn.rup_table(&quot;extend&quot;,{ preConfigureFilter: function(settings){ var $self = this, tableId = settings.id, filterSettings = settings.filter, filterFormId, toggleIcon1Tmpl,toggleLabelTmpl,filterSummaryTmpl,toggleIcon2Tmpl,$toggleIcon1,$toggleLabel,$filterSummary,$toggleIcon2; /* * Inicialización de los identificadores y componentes por defecto de los componentes de filtrado */ filterSettings.id = (filterSettings.id!==undefined?filterSettings.id:tableId+&quot;_filter_form&quot;); filterSettings.filterToolbarId = (filterSettings.filterToolbar!==undefined?filterSettings.filterToolbar:tableId+&quot;_filter_toolbar&quot;); filterSettings.filterButtonId = (filterSettings.filterButtonId!==undefined?filterSettings.filterButtonId:tableId+&quot;_filter_filterButton&quot;); filterSettings.cleanLinkId = (filterSettings.cleanLinkId!==undefined?filterSettings.cleanLinkId:tableId+&quot;_filter_cleanLink&quot;); filterSettings.collapsableLayerId = (filterSettings.collapsableLayerId!==undefined?filterSettings.collapsableLayerId:tableId+&quot;_filter_fieldset&quot;); filterSettings.toggleIcon1Id = (filterSettings.toggleIcon1!==undefined?filterSettings.toggleIcon1:tableId+&quot;_filter_toggle_icon1&quot;); filterSettings.toggleLabelId = (filterSettings.toggleLabelId!==undefined?filterSettings.toggleLabelId:tableId+&quot;_filter_toggle_label&quot;); filterSettings.filterSummaryId = (filterSettings.filterSummaryId!==undefined?filterSettings.filterSummaryId:tableId+&quot;_filter_summary&quot;); filterSettings.toggleIcon2Id = (filterSettings.toggleIcon2!==undefined?filterSettings.toggleIcon2:tableId+&quot;_filter_toggle_icon2&quot;); filterSettings.$filterContainer = jQuery(&quot;#&quot;+filterSettings.id); filterSettings.$filterToolbar = jQuery(&quot;#&quot;+filterSettings.filterToolbarId); if (filterSettings.$filterContainer.length===0){ alert(&quot;El identificador especificado para el fomulario de búsqueda no existe.&quot;); }else if (filterSettings.$filterToolbar.length===0){ alert(&quot;El identificador especificado para la barra de controles del formulario de filtrado no existe.&quot;); }else{ /* * Se almacena la referencia de los diferentes componentes * * $filterContainer : Contenedor del formulario de filtrado * $filterButton : Botón que realiza el filtrado * $cleanLink : Enlace para limpiar el formulario * $collapsableLayer : Capa que puede ser ocultada/mostrada * $toggleIcon1Id : Control que oculta muestra el fomulario * $filterSummary : Contenedor donde se especifican los criterios de filtrado */ toggleIcon1Tmpl = jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_table.templates.filter.toggleIcon1&quot;); toggleLabelTmpl = jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_table.templates.filter.toggleLabel&quot;); filterSummaryTmpl = jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_table.templates.filter.filterSummary&quot;); toggleIcon2Tmpl = jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_table.templates.filter.toggleIcon2&quot;); $toggleIcon1 = $(jQuery.jgrid.format(toggleIcon1Tmpl, filterSettings.toggleIcon1Id)); $toggleLabel = $(jQuery.jgrid.format(toggleLabelTmpl, filterSettings.toggleLabelId, $.rup.i18n.base.rup_table.plugins.filter.filterCriteria)); $filterSummary = $(jQuery.jgrid.format(filterSummaryTmpl, filterSettings.filterSummaryId)); $toggleIcon2 = $(jQuery.jgrid.format(toggleIcon2Tmpl, filterSettings.toggleIcon2Id)); filterSettings.$filterToolbar.append($toggleIcon1).append($toggleLabel).append($filterSummary).append($toggleIcon2); filterSettings.$filterContainer = jQuery(&quot;#&quot;+filterSettings.id); filterSettings.$filterButton = jQuery(&quot;#&quot;+filterSettings.filterButtonId); //Creacion del boton de filtrado //filterSettings.$filterButton.addClass(&quot;dropdownButton&quot;); //filterSettings.$filterButton.append('&lt;ul&gt;&lt;li class=&quot;dropdownButton-list&quot;&gt;&lt;a class=&quot;dropdownButton-trigger&quot; href=&quot;#&quot;&gt;Filtro&lt;/a&gt;&lt;div class=&quot;dropdownButton-content&quot;&gt;&lt;form&gt;&lt;fieldset class=&quot;dropdownButton-inputs&quot;&gt;&lt;div id=&quot;dropdownButton-combo&quot;&gt;&lt;/div&gt;&lt;/fieldset&gt; &lt;fieldset class=&quot;dropdownButton-actions&quot;&gt;&lt;input class=&quot;ui-button ui-widget ui-state-default ui-corner-all&quot; value=&quot;Guardar&quot; type=&quot;submit&quot;&gt;&lt;input class=&quot;ui-button ui-widget ui-state-default ui-corner-all&quot; value=&quot;Aplicar&quot; type=&quot;submit&quot;&gt; &lt;input class=&quot;ui-button ui-widget ui-state-default ui-corner-all&quot; value=&quot;Eliminar&quot; type=&quot;submit&quot;&gt;&lt;/fieldset&gt; &lt;/form&gt; &lt;/div&gt;&lt;/li&gt; &lt;li class=&quot;dropdownButton-menu&quot;&gt;&lt;a class=&quot;dropdownButton-lanzador&quot; href=&quot;#&quot;&gt;&lt;span&gt;▼&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt;'); filterSettings.$cleanLink = jQuery(&quot;#&quot;+filterSettings.cleanLinkId); filterSettings.$collapsableLayer = jQuery(&quot;#&quot;+filterSettings.collapsableLayerId); filterSettings.$toggleIcon1 = $toggleIcon1; filterSettings.$toggleLabel = $toggleLabel; filterSettings.$filterSummary = $filterSummary; filterSettings.$toggleIcon2 = $toggleIcon2; /* * TODO: Comprobar que la configruación es correcta */ if (filterSettings.$filterContainer.prop(&quot;tagName&quot;)===&quot;FORM&quot;){ filterSettings.$filterContainer.ajaxForm(); } // Se utiliza el plugin ajaxForm de jQuery para configurar el formualario de busqueda como AJAX. // Se redimensiona el formulario de busqueda al tamanyo del grid. filterSettings.$filterContainer.parent().css(&quot;width&quot;,$self.rup_table(&quot;getGridParam&quot;, &quot;width&quot;)); // Se configura la url de filtrado if (settings.filter.url === null){ settings.filter.url = settings.baseUrl +&quot;/filter&quot;; } settings.url = settings.filter.url; // Se almacena en las propiedades la url utilizada para la busqueda a partir de la especificada en el grid. settings.searchURL = $self.rup_table(&quot;getGridParam&quot;, &quot;url&quot;); // Se asigna a la tecla ENTER la funcion de busqueda. filterSettings.$filterContainer.bind(&quot;keydown&quot;, function(evt) { if (evt.keyCode == 13) { // TODO : poner como evento //$self.rup_table(&quot;showSearchCriteria&quot;); $self.rup_table(&quot;filter&quot;); } }); // Creacion del boton de busqueda. filterSettings.$filterButton.bind(&quot;click&quot;, function () { // TODO: Control cambios // TODO : poner como evento //Deshabilitar el nombre del filtro en el filterSummary una vez que ha terminado el filtro por defecto if (settings.$firstStartUp){ settings.$firstStartUp=false; } //$self.rup_table(&quot;showSearchCriteria&quot;); $self.rup_table(&quot;filter&quot;); }); // Creacion del enlace de limpiar formulario. filterSettings.$cleanLink.bind(&quot;click&quot;, function () { // TODO : poner como evento if (settings.$firstStartUp){ settings.$firstStartUp=false; } $self.rup_table(&quot;cleanFilterForm&quot;).rup_table(&quot;filter&quot;); if (filterSettings.validate!==undefined){ jQuery(&quot;.rup-maint_validateIcon&quot;, filterSettings.$filterContainer).remove(); } //$self.rup_table(&quot;showSearchCriteria&quot;); }); filterSettings.$toggleIcon1.add(filterSettings.$toggleLabel).add(filterSettings.$toggleIcon2) .attr(&quot;tabindex&quot;,&quot;0&quot;) .on({ &quot;keydown&quot;:function(evt) { if (evt.keyCode == 13) { $self.rup_table(&quot;toggleFilterForm&quot;); } } }); filterSettings.$filterToolbar.addClass(&quot;cursor_pointer&quot;).on({ &quot;click&quot;:function(){ $self.rup_table(&quot;toggleFilterForm&quot;); } }); if (settings.filter.showHidden === true){ filterSettings.$collapsableLayer.hide(); // filterSettings.$collapsableRowShow.show(); filterSettings.$toggleIcon1.removeClass(&quot;ui-icon-triangle-1-n&quot;).addClass(&quot;ui-icon-triangle-1-s&quot;); filterSettings.$filterSummary.parent().addClass(&quot;rup-maint_searchCriteria&quot;); } // Configuración de validaciones if (filterSettings.validate!==undefined){ filterSettings.$filterContainer.rup_validate(filterSettings.validate); $self.on({ &quot;rupTable_beforeFilter.filter.validate&quot;: function(){ //filterSettings.$filterContainer.rup_validate(&quot;resetForm&quot;); if (multifilterSettings!==undefined){ if(!settings.$firstStartUp){ return filterSettings.$filterContainer.valid(); }else{ return null; } }else{ return filterSettings.$filterContainer.valid(); } } }); } } $self.on({ &quot;rupTable_serializeGridData.filter&quot;: function(events, postData){ var filterParams = form2object(settings.filter.$filterContainer[0]), queryStrFilterParams = jQuery.param(filterParams), lastFilterParams = $self.data(&quot;tmp.lastFilterParams&quot;); var filtro; if (settings.$firstStartUp==true){ var filtro= multifilterSettings.$filterDefaultValue; } if (filtro==undefined){ jQuery.extend(postData, {&quot;filter&quot;:filterParams}); }else{ jQuery.extend(postData, {&quot;filter&quot;:filtro}); } if (lastFilterParams === undefined || lastFilterParams !== queryStrFilterParams){ jQuery.extend(postData, {page:($self.data(&quot;tmp.firstLoad&quot;)===true &amp;&amp; settings.core.startOnPage!==null?settings.core.startOnPage:&quot;1&quot;)}); $self.data(&quot;tmp.lastFilterParams&quot;, queryStrFilterParams); } } }); $self.on(&quot;jqGridGridComplete&quot;,function(event){ if ($self.data(&quot;settings&quot;)!==undefined){ $self.rup_table(&quot;showSearchCriteria&quot;); } }); // gestion de evento por defecto Multifiltro if (settings.multifilter != undefined &amp;&amp; settings.multifilter != null) { var $filterForm, $filterDefaultName,$firstStartUp; var multifilterSettings = settings.multifilter; settings.filter.$filterForm = $(&quot;#&quot; + settings.id + &quot;_filter_form&quot;); var selector; settings.$firstStartUp=true; if (multifilterSettings.idFilter != null) { selector = multifilterSettings.idFilter; } else { selector = settings.id; } var usuario; if (multifilterSettings.userFilter != null) { usuario = multifilterSettings.userFilter; } else { usuario = LOGGED_USER; } var getDefault; if (multifilterSettings.getDefault!=null){ getDefault = multifilterSettings.getDefault; }else{ getDefault = true; } // getDefault if (getDefault){ $.rup_ajax({ url : settings.baseUrl + &quot;/multiFilter/getDefault?filterSelector=&quot; + selector + &quot;&amp;user=&quot; + usuario, type : &quot;GET&quot;, dataType : 'json', showLoading : false, contentType : 'application/json', //async : false, complete : function(jqXHR, textStatus) { if (settings.loadOnStartUp){ $self.rup_table(&quot;filter&quot;); } $self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,$self.data.filterData); // $self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,form2object(settings.filter.$filterContainer[0])); }, success : function(data, status, xhr) { if (data != null) { var valorFiltro = $ .parseJSON(data.filterValue); $self._fillForm(valorFiltro); //settings.filter.$filterSummary.html(&quot;&lt;i&gt;&quot;+data.filterName+&quot;&lt;/i&gt;&quot;); multifilterSettings.$filterDefaultName = data.filterName; multifilterSettings.$filterDefaultValue = valorFiltro; $self.data.filterData=valorFiltro; } }, error : function(xhr, ajaxOptions, thrownError) { } }); } } }, /* * Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * * TODO: internacionalizar mensajes de error. */ postConfigureFilter: function(settings){ var $self = this, filterFormId, filterSettings; } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Métodos públicos del plugin filter. * * cleanFilterForm: Realiza una limpieza de los campos del formulario. * filter: Lanza el filtrado de la tabla de acuerdo a los criterios indicados en el formulario. * toggleFilterForm: Método encargado de ocultar y mostrar el formulario de filtrado. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ cleanFilterForm : function () { var $self = this, settings = $self.data(&quot;settings&quot;); $self.triggerHandler(&quot;rupTable_filter_beforeCleanFilterForm&quot;); $self.rup_table(&quot;resetForm&quot;, settings.filter.$filterContainer); $self.triggerHandler(&quot;rupTable_filter_afterCleanFilterForm&quot;); return $self; }, filter : function(async){ var $self = this, settings = $self.data(&quot;settings&quot;); var bfr = $self.triggerHandler(&quot;rupTable_beforeFilter&quot;); if (bfr === false || bfr === 'stop') { return; } if ($.isFunction(settings.filter.beforeFilter)) { bfr = settings.filter.beforeFilter.call($self); if(bfr === undefined) { bfr = true; } if ( bfr === false ) { return; } } $self.rup_table(&quot;setGridParam&quot;,{page:&quot;1&quot;}); $self.trigger(&quot;reloadGrid&quot;); }, getFilterParams : function(){ var $self = this, settings = $self.data(&quot;settings&quot;); return form2object(settings.filter.$filterContainer[0]); }, hideFilterForm: function(){ var $self = $(this), settings = $self.data(&quot;settings&quot;), filterSettings = settings.filter; filterSettings.$collapsableLayer.hide(settings.filter.transitionConfig); // filterSettings.$collapsableRowShow.show(settings.filter.transitionConfig); filterSettings.$toggleIcon2.removeClass(&quot;ui-icon-circle-triangle-n&quot;).addClass(&quot;ui-icon-circle-triangle-s&quot;); filterSettings.$toggleIcon1.removeClass(&quot;ui-icon-triangle-1-s&quot;).addClass(&quot;ui-icon-triangle-1-e&quot;); filterSettings.$filterSummary.parent().addClass(&quot;rup-maint_searchCriteria&quot;); }, showFilterForm: function(){ var $self = $(this), settings = $self.data(&quot;settings&quot;), filterSettings = settings.filter; // Se muestra el formulario de búsqueda filterSettings.$collapsableLayer.show($.extend({},settings.filter.transitionConfig,{ complete: function(){ // Anadido el foco al primer campo del formulario jQuery(&quot;input:first&quot;, filterSettings.$filterContainer).focus(); } })); filterSettings.$toggleIcon2.removeClass(&quot;ui-icon-circle-triangle-s&quot;).addClass(&quot;ui-icon-circle-triangle-n&quot;); filterSettings.$toggleIcon1.removeClass(&quot;ui-icon-triangle-1-e&quot;).addClass(&quot;ui-icon-triangle-1-s&quot;); filterSettings.$filterSummary.parent().removeClass(&quot;rup-maint_searchCriteria&quot;); //Eliminar tooltip // $titleSearch.rup_tooltip(&quot;destroy&quot;); // filterSettings.$collapsableRowShow.hide(settings.filter.transitionConfig); }, toggleFilterForm: function(filterCriteriaLoad){ var $self = $(this), settings = $self.data(&quot;settings&quot;), filterSettings = settings.filter; if (filterSettings.$collapsableLayer.is(&quot;:hidden&quot;)) { //MOSTRAR $self.rup_table(&quot;showFilterForm&quot;); }else{ // OCULTAR $self.rup_table(&quot;hideFilterForm&quot;); } return $self; }, showSearchCriteria: function(){ var $self = this, settings = $self.data(&quot;settings&quot;), searchString = &quot; &quot;, temp = &quot;&quot;, aux, searchForm, field, fieldId, fieldName, fieldValue, aux = settings.filter.$filterContainer.serializeArray(); searchForm = settings.filter.$filterContainer, filterMulticombo = new Array(); var obj; //añadir arbol var nombreArbol=$('.jstree',settings.filter.$filterContainer) var arboles= $('.jstree',settings.filter.$filterContainer); $.each(arboles,function( index,item ){ obj= new Object(); obj.name=$(item).attr(&quot;name&quot;) obj.value=$(item).rup_tree(&quot;getRupValue&quot;).length; obj.type=&quot;rup_tree&quot;; aux.push(obj); }); for (var i = 0; i &lt; aux.length; i++) { if (aux[i].value !== &quot;&quot; &amp;&amp; $.inArray(aux[i].name,settings.filter.excludeSummary)!=0) { //CAMPO a tratar field = $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm); //Comprobar si se debe excluir el campo if ($.inArray(field.attr(&quot;id&quot;), settings.filter.filterExclude) !== -1){ continue; } //Seleccionar radio if (field.length &gt; 1){ field = $(&quot;[name='&quot; + aux[i].name + &quot;']:checked&quot;,searchForm); } //Omitir campos hidden if ($(field).attr(&quot;type&quot;) === &quot;hidden&quot;){ continue; } //ID del campo fieldId = $(field).attr(&quot;id&quot;); //ID para elementos tipo rup.combo if ($(field).attr(&quot;ruptype&quot;) === &quot;combo&quot;){ if (field.next(&quot;.ui-multiselect&quot;).length==0){ fieldId += &quot;-button&quot;; } } //ID para elementos tipo rup.autocomplete if ($(field).attr(&quot;ruptype&quot;) === &quot;autocomplete&quot;){ fieldId = fieldId.substring(0, fieldId.indexOf(&quot;_label&quot;)); } //NAME label = $(&quot;label[for^='&quot; + fieldId + &quot;']&quot;,searchForm); if (label.length&gt;0){ // &lt;label for='xxx' /&gt; fieldName = label.html(); } else { // &lt;div /&gt; // &lt;div /&gt; if ($(field).attr(&quot;ruptype&quot;) !== &quot;combo&quot;){ //fieldName= $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm).prev('div').html(); fieldName= $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm).prev('div').find('label').first().html(); } else { //fieldName= $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm).parent().prev('div').html(); // Buscamos el label asociado al combo // Primero por id var $auxField = $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm), $labelField; $labelField = jQuery(&quot;[for='&quot;+$auxField.attr(&quot;id&quot;)+&quot;']&quot;); if ($labelField.length&gt;0){ fieldName = $labelField.first().text(); }else{ fieldName= $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm).parent().prev('div').find('label').first().html(); } } } if (fieldName === null || fieldName === undefined){ fieldName = &quot;&quot;; } //VALUE fieldValue = &quot; = &quot;; switch($(field)[0].tagName){ case &quot;INPUT&quot;: fieldValue = fieldValue + $(field).val(); if ($(field)[0].type === &quot;checkbox&quot; || $(field)[0].type === &quot;radio&quot;){ fieldValue = &quot;&quot;; } break; //Rup-tree case &quot;DIV&quot;: $.each(aux,function( index,item ){ if (item.name==field.attr('id')){ if (item.value!=0){ fieldValue +=&quot; = &quot;+ item.value; } } else { fieldValue = &quot;&quot;; } }); if (fieldValue==&quot;&quot;){ fieldName = &quot;&quot;; } break; case &quot;SELECT&quot;: if (field.next(&quot;.ui-multiselect&quot;).length==0){ fieldValue = fieldValue + $(&quot;option[value='&quot;+aux[i].value+&quot;']&quot;,field).html(); } else { if ($.inArray($(field).attr(&quot;id&quot;), filterMulticombo)===-1){ numSelected = field.rup_combo(&quot;value&quot;).length; if (numSelected !== 0){ fieldValue += numSelected; } else { fieldName = &quot;&quot;; fieldValue = &quot;&quot;; } filterMulticombo.push($(field).attr(&quot;id&quot;)); } else { fieldName = &quot;&quot;; fieldValue = &quot;&quot;; } } break; } //Parsear NAME var parseableChars = new Array(&quot;:&quot;,&quot;=&quot;); for (var j=0; j&lt;parseableChars.length; j++){ if (fieldName !== &quot;&quot; &amp;&amp; fieldName.indexOf(parseableChars[j])!== -1){ fieldName = fieldName.substring(0,fieldName.indexOf(parseableChars[j])); break; } } //Controlar rup.combo con valor vacío while (fieldValue.indexOf(&quot;&amp;amp;nbsp;&quot;)!==-1){ fieldValue = fieldValue.replace (&quot;&amp;amp;nbsp;&quot;,&quot;&quot;); } //Si no tiene NAME sacar solo el valor if (fieldName === &quot;&quot; &amp;&amp; fieldValue.indexOf(&quot; = &quot;)!==-1){ fieldValue = fieldValue.substring(2, fieldValue.length); } //Si no tiene NAME ni VALUE omitir if (fieldName === &quot;&quot; &amp;&amp; $.trim(fieldValue) === &quot;&quot;){ continue; } searchString = searchString + fieldName + fieldValue + &quot;, &quot;; } } if (jQuery.isFunction(settings.filter.fncSearchCriteria)){ searchString = jQuery.proxy(settings.filter.fncSearchCriteria, $self, searchString)(); } if ($.trim(searchString).length-1==$.trim(searchString).lastIndexOf(&quot;,&quot;)) { searchString=searchString.substr(0,searchString.lastIndexOf(','))+&quot; &quot;; } if (settings.multifilter) { if (jQuery.isFunction(settings.multifilter.fncFilterName)){ searchString = jQuery.proxy(settings.multifilter.fncFilterName, $self, searchString)(); } } //Contiene criterios // if (searchString.length&gt;1){ //searchString = searchString.substring(0, searchString.length-2); var initialHeight = $('#titleSearch_' + settings.id.name).css(&quot;height&quot;), height, tmp = searchString, tooltip = false; //Añadir criterios while(true){ settings.filter.$filterSummary.html(&quot; &lt;i&gt;&quot; + tmp + &quot;&lt;/i&gt;&quot;); height = $('#titleSearch_' + settings.id.name).css(&quot;height&quot;); if (height === initialHeight){ break; } tmp = tmp.substring(0, tmp.lastIndexOf(&quot;,&quot;)) + &quot; &lt;b&gt;...&lt;/b&gt;&quot;; tooltip = true; } //Tooltip con criterios if (tooltip){ settings.filter.$filterSummary .rup_tooltip({ content: { text: searchString.substring(1) }, position: { my: 'bottom center', at: 'top center' } }); } } // } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* jQuery.fn.rup_table(&quot;extend&quot;,{ _getSearchFormFieldLabel: function($field, $form){ var fieldId = $field.attr(&quot;id&quot;), $label, formFieldLabel=&quot;&quot;, rupType = $field.attr(&quot;ruptype&quot;); if (rupType !== &quot;combo&quot;){ $label = jQuery(&quot;label[for='&quot;+fieldId+&quot;']&quot;, $form); }else{ $label = jQuery(&quot;label[for='&quot;+fieldId+&quot;-button']&quot;, $form); } if ($label.length&gt;0){ // &lt;label for='xxx' /&gt; formFieldLabel = $label.html(); } else { // &lt;div /&gt; // &lt;div /&gt; if ($field.attr(&quot;ruptype&quot;) !== &quot;combo&quot;){ //fieldName= $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm).prev('div').html(); formFieldLabel= $(&quot;[name='&quot; + name + &quot;']&quot;, $form).prev('div').find('label').first().html(); } else { //fieldName= $(&quot;[name='&quot; + aux[i].name + &quot;']&quot;,searchForm).parent().prev('div').html(); formFieldLabel= $(&quot;[name='&quot; + name + &quot;']&quot;, $form).parent().prev('div').find('label').first().html(); } } // Eliminamos los caracteres ':' y '=' que puedan existir en el label formFieldLabel = formFieldLabel.replace(/[:=]/g,&quot;&quot;);; return formFieldLabel; }, _getSearchFormFieldValue: function($field, $form){ var fieldValue = &quot; = &quot;, filterMulticombo = [], numSelected; //VALUE switch($field.prop(&quot;tagName&quot;)){ case &quot;INPUT&quot;: fieldValue = fieldValue + $field.val(); if ($field.attr(&quot;type&quot;) === &quot;checkbox&quot; || $field.attr(&quot;type&quot;) === &quot;radio&quot;){ fieldValue = &quot;&quot;; } break; case &quot;SELECT&quot;: if ($field.next(&quot;.ui-multiselect&quot;).length==0){ fieldValue = fieldValue + $(&quot;option[value='&quot;+$field.rup_combo(&quot;getRupValue&quot;)+&quot;']&quot;, $field).html(); } else { if ($.inArray($field.attr(&quot;id&quot;), filterMulticombo)===-1){ numSelected = $field.rup_combo(&quot;value&quot;).length; if (numSelected !== 0){ fieldValue += numSelected; } else { fieldName = &quot;&quot;; fieldValue = &quot;&quot;; } filterMulticombo.push($field.attr(&quot;id&quot;)); } else { fieldName = &quot;&quot;; fieldValue = &quot;&quot;; } } break; } //Controlar rup.combo con valor vacío while (fieldValue.indexOf(&quot;&amp;amp;nbsp;&quot;)!==-1){ fieldValue = fieldValue.replace (&quot;&amp;amp;nbsp;&quot;,&quot;&quot;); } return fieldValue; } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Parámetros de configuración por defecto para el plugin filter. * */ jQuery.fn.rup_table.plugins.filter = {}; jQuery.fn.rup_table.plugins.filter.defaults = { core:{ startOnPage :null }, filter:{ url: null, showHidden:false, transitionConfig:{ duration: &quot;slow&quot;, effect: &quot;blind&quot; } } }; })(jQuery); × Search results Close "},"rup_table_rup.table.fluid.js.html":{"id":"rup_table_rup.table.fluid.js.html","title":"Source: rup_table/rup.table.fluid.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.fluid.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;fluid&quot;,{ loadOrder:5, postConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;postConfigureFluid&quot;, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Extensión del componente rup_table para permitir la gestión del diseño líquido del componente. * * Los métodos implementados son: * * postConfigureFilter(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * * Se almacena la referencia de los diferentes componentes: * * settings.$fluidBaseLayer : Referencia a la capa que se tomará como base para aplicar el diseño líquido. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ /* * Realiza la configuración interna necesaria para la gestión correcta de la edición mediante un formulario. * * TODO: internacionalizar mensajes de error. */ postConfigureFluid: function(settings){ var $self = this, $fluidBaseLayer; settings.fluid.baseLayer = $.rup_utils.getJQueryId(settings.fluid.baseLayer!==null?settings.fluid.baseLayer:settings.id+&quot;_div&quot;); settings.fluid.$baseLayer = jQuery(settings.fluid.baseLayer); if (settings.fluid.$baseLayer.length===0){ alert(&quot;El identificador &quot;+settings.baseLayer+&quot; especificado para la capa sobre la que se va a aplicar el diseño líquido no existe.&quot;); return; } $fluidBaseLayer = settings.fluid.fluidBaseLayer = settings.fluid.$baseLayer; // Tratamiento del evento de redimiensionado del diseño líquido de la tabla $self.bind(&quot;fluidWidth.resize&quot;, function(event, previousWidth, currentWidth){ if ($self.is(&quot;:visible&quot;)){ var feedBackPaddingLeft, feedBackPaddingRight, toolbarPaddingLeft, toolbarPaddingRight; $self.setGridWidth(currentWidth); // Se redimensionan las capas contenidas en el mantenimiento $fluidBaseLayer.children().width(currentWidth); // prop.searchForm.parent().width(currentWidth+3) // Se redimensiona el feedback if (settings.$feedback){ feedBackPaddingLeft = parseInt(settings.$feedback.css(&quot;padding-left&quot;)); feedBackPaddingRight = parseInt(settings.$feedback.css(&quot;padding-right&quot;)); settings.$feedback.width(currentWidth - (feedBackPaddingLeft+feedBackPaddingRight)); } // Se redimensiona la toolbar if (settings.$toolbar){ toolbarPaddingLeft = parseInt(settings.$toolbar.css(&quot;padding-left&quot;)); toolbarPaddingRight = parseInt(settings.$toolbar.css(&quot;padding-right&quot;)); settings.$toolbar.width(currentWidth - (toolbarPaddingLeft+toolbarPaddingRight)); settings.$toolbar.css(&quot;width&quot;, currentWidth - (toolbarPaddingLeft+toolbarPaddingRight)); } } }); // $self.fluidWidth({ // fluidBaseLayer:settings.fluid.baseLayer, // minWidth: 100, // maxWidth: 2000, // fluidOffset : 0 // }); $self.fluidWidth(settings.fluid); $self.on(&quot;rupTable_fluidUpdate&quot;, function(event){ $self.fluidWidth(settings.fluid); }); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Parámetros de configuración por defecto para el plugin fluid. * */ jQuery.fn.rup_table.plugins.fluid = {}; jQuery.fn.rup_table.plugins.fluid.defaults = { fluid:{ baseLayer:null, minWidth: 100, maxWidth: 2000, fluidOffset : 0 } }; })(jQuery); × Search results Close "},"rup_table_rup.table.inlineEdit.js.html":{"id":"rup_table_rup.table.inlineEdit.js.html","title":"Source: rup_table/rup.table.inlineEdit.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.inlineEdit.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * preConfiguration: Método que se ejecuta antes de la invocación del componente jqGrid. * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;inlineEdit&quot;,{ loadOrder:7, preConfiguration: function(settings){ var $self = this; $self.rup_table(&quot;preConfigureInlineEdit&quot;,settings); }, postConfiguration: function(settings){ var $self = this; $self.rup_table(&quot;postConfigureInlineEdit&quot;,settings); } }); /** * Extensión del componente rup_table para permitir la edición en línea de los registros visualizados. * * Los métodos implementados son: * * configureInlineEdit(settings): Realiza la configuración interna necesaria para la gestión correcta de la edición en línea. * editRow(rowId, options): Activa el modo edicón en línea para un registro determinado. * saveRow(rowId, options): Realiza el guardado de un registo modificado mediante la edición en línea. * * Las propiedades de esta extensión almacenadas en el settings son las siguientes: * * settings.$inlineForm : Referencia al formulario utilizado para enviar los datos del registro que está siendo editado. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ preConfigureInlineEdit: function(settings){ var $self = $(this), // formId = &quot;inlineForm_&quot; + settings.id, userBeforeSend; // $inlineForm =$(&quot;&lt;form&gt;&quot;).attr({&quot;id&quot;:&quot;inlineForm_&quot; + settings.id}); settings.editable = true; // // Arropamos la estructura de la tabla en un formulario para poder realizar el envío de los campos // $self.wrap($inlineForm); // // Almacenamos la referencia al formulario. // settings.inlineEdit.$inlineForm = $(&quot;#&quot;+formId); if (settings.inlineEdit.addEditOptions.url===undefined){ settings.inlineEdit.addEditOptions.url=settings.baseUrl; } settings.inlineEdit.deleteOptions.ajaxDelOptions = $.extend(true, settings.inlineEdit.deleteOptions.ajaxDelOptions, { success: function(data,st, xhr){ $self.triggerHandler(&quot;rupTableAfterDelete&quot;, [data,st, xhr]); $self.rup_table(&quot;showFeedback&quot;, settings.$feedback, $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.deletedOK&quot;), &quot;ok&quot;); } }); /* * Configuración del evetno beforeSend. Se sustituye el existente (en caso de haber) * por el implementado a continuación. El objetivo es realizar la operación AJAX medainte * el componente rup_formulario en vez del sistema por defecto del jqGrid. * * El método beforeSend indicado por el usuario se seguirá ejecutanto de manera normal. */ // Se almancena en una variable temporal el método beforeSend especificado por el usuario userBeforeSend = settings.inlineEdit.beforeSend; settings.inlineEdit.addEditOptions.restoreAfterError = false; settings.inlineEdit.addEditOptions.errorfunc = function(rowid, data, stat, err, o){ var responseJSON; if (data.status === 406 &amp;&amp; data.responseText!== &quot;&quot;){ try{ responseJSON = jQuery.parseJSON(data.responseText); if (responseJSON.rupErrorFields){ $self.rup_table(&quot;showServerValidationFieldErrors&quot;,settings.inlineEdit.$inlineForm, responseJSON); } }catch(e){ // El mensaje JSON $self.rup_table(&quot;showFeedback&quot;, settings.$feedback, data.responseText, &quot;error&quot;); } } }; settings.inlineEdit.addEditOptions.ajaxRowOptions.beforeSend = function(jqXHR, ajaxOptions){ // Se añade la configuración de validaciones, la función userBeforeSend indicada por el usuario y el feedback utilzado por el compoennte. jQuery.extend(true, ajaxOptions, { validate: settings.validate, beforeSend:(jQuery.isFunction(userBeforeSend)?userBeforeSend:null), feedback: settings.$feedback }); // Handler del evento rupValidate_formValidationError. Se lanza cuando se produce un error de validación en el formulario. settings.inlineEdit.$inlineForm.on(&quot;rupValidate_formValidationError.inlineEditing&quot;, function(event, obj){ $self.off(&quot;rupValidate_formValidationError.inlineEditing&quot;); // Se elimina la capa de bloqueo de la tabla. $(&quot;#lui_&quot;+$.jgrid.jqID(settings.id)).hide(); }); // Se realiza el envío del fomulario settings.inlineEdit.$inlineForm.rup_form(&quot;ajaxSubmit&quot;, ajaxOptions); // Se retorna false para evitar que se realice la petición AJAX del plugin subyacente. return false; }; // Configuración de edit/add // Se procede a añadir sobre los settings de configuración los correspondientes a la edición en línea. settings.inlineEdit.addOptions = $.extend(true,{}, settings.inlineEdit.addEditOptions, settings.inlineEdit.addOptions); settings.inlineEdit.editOptions = $.extend(true,{}, settings.inlineEdit.addEditOptions, settings.inlineEdit.editOptions); // Fuerza la configuración para que solo se pueda seleccionar mediante el checkbox settings.multiboxonly = true; settings.getRowForEditing = function(){ var $self = this, selrow=$self.jqGrid('getGridParam','selrow'); return (selrow===null?false:selrow); }; /* DEFINICION DE OPERACIONES BASICAS CON LOS REGISTROS */ settings.core.operations = { &quot;add&quot;: { name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.new&quot;), icon: &quot;rup-icon rup-icon-new&quot;, enabled: function(){ var $self = this; return jQuery(&quot;tr[editable='1']&quot;, $self).length===0; }, callback: function(key, options){ var $self = this; $self.rup_table(&quot;addRow&quot;); } }, &quot;edit&quot;: { name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.modify&quot;), icon: &quot;rup-icon rup-icon-edit&quot;, enabled: function(){ var $self = this, selrow=$self.jqGrid('getGridParam','selrow'), newRow; // Existe una fila seleccionada? selrow = (selrow===null?false:selrow); selrow = selrow &amp;&amp; (selrow.indexOf(&quot;jqg&quot;)===-1); // Existe una fila en modo nuevo? newRow = jQuery(&quot;tr[editable='1'].jqgrid-new-row&quot;, $self).length===0; return selrow &amp;&amp; newRow; }, callback: function(key, options){ $self.rup_table(&quot;editRow&quot;, jQuery.proxy(settings.getRowForEditing,$self)()); } }, &quot;save&quot;: { name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.save&quot;), icon: &quot;rup-icon rup-icon-save&quot;, enabled: function(){ var $self = this; return jQuery(&quot;tr[editable='1']&quot;, $self).length&gt;0; }, callback: function(key, options){ $self.rup_table(&quot;saveRow&quot;); } }, &quot;clone&quot;: { name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.clone&quot;), icon: &quot;rup-icon rup-icon-clone&quot;, enabled: function(){ var $self = this, selrow=$self.jqGrid('getGridParam','selrow'), newRow; // Existe una fila seleccionada? selrow = (selrow===null?false:selrow); selrow = selrow &amp;&amp; (selrow.indexOf(&quot;jqg&quot;)===-1); // Existe una fila en modo nuevo? newRow = jQuery(&quot;tr[editable='1'].jqgrid-new-row&quot;, $self).length===0; return selrow &amp;&amp; newRow; // if (settings.inlineEdit.autoEditRow===true){ // return $self.rup_table(&quot;getSelectedRows&quot;).length === 1; // }else{ // return $self.rup_table(&quot;getSelectedRows&quot;).length === 1 &amp;&amp; jQuery(&quot;tr[editable='1']&quot;, $self).length===0; // } }, callback: function(key, options){ if (jQuery(&quot;tr[editable='1']&quot;, $self).length&gt;0){ $self.rup_table(&quot;restoreRow&quot;); } $self.rup_table(&quot;cloneRow&quot;); } }, &quot;cancel&quot;: { name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.cancel&quot;), icon: &quot;rup-icon rup-icon-cancel&quot;, enabled: function(){ var $self = this; return jQuery(&quot;tr[editable='1']&quot;, $self).length&gt;0; }, callback: function(key, options){ $self.rup_table(&quot;restoreRow&quot;); } }, &quot;delete&quot;: { name: $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.delete&quot;), icon: &quot;rup-icon rup-icon-delete&quot;, enabled: function(){ var $self = this, selrow=$self.jqGrid('getGridParam','selrow'); selrow = (selrow===null || selrow.indexOf(&quot;jqg&quot;)!==-1?false:selrow); return jQuery(&quot;tr[editable='1']:not(.jqgrid-new-row)&quot;, $self).length&gt;0 || selrow; }, callback: function(key, options){ $self.rup_table(&quot;deleteRow&quot;); } } }; /* ======= * EVENTOS * ======= */ // Campturador del evento jqGridInlineAfterSaveRow. $self.on({ // &quot;jqGridAfterInsertRow.rupTable.inlineEditing&quot;: function(event, rowid, data, data){ // jQuery($self.getInd(rowid, true)).attr(&quot;editmode&quot;,&quot;add&quot;); // // }, &quot;jqGridInlineErrorSaveRow.rupTable.inlineEditing&quot;: function(event, rowid, data){ jQuery($self.getInd(rowid,true)).attr(&quot;id&quot;,settings.inlineEditingRow); $self.rup_table(&quot;setSelection&quot;,settings.inlineEditingRow); }, &quot;jqGridInlineAfterSaveRow.rupTable.inlineEditing&quot;: function(event, rowid, res, tmp, options){ // Una vez introducida la fila se elimina el estilo jqgrid-new-row para evitar que se elimine al utilizar el cancelar sobre esa fila. jQuery(&quot;#&quot;+jQuery.jgrid.jqID(rowid)+&quot;.jqgrid-new-row&quot;, $self).removeClass(&quot;jqgrid-new-row&quot;); // Una vez se haya realizado el guardado del registro se muestra el mensaje correspondiente en el feedback dependiendo del modo en el que se encuentra. if (options.oper === 'edit') { $self.rup_table(&quot;showFeedback&quot;, settings.$feedback, $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.modifyOK&quot;), &quot;ok&quot;); } else { $self.rup_table(&quot;showFeedback&quot;, settings.$feedback, $.rup.i18nParse($.rup.i18n.base,&quot;rup_table.insertOK&quot;), &quot;ok&quot;); } }, &quot;jqGridInlineEditRow.rupTable.inlineEditing&quot;: function oneditfunc_default(event, rowId){ var self = this, $self = $(self), settings = $self.data(&quot;settings&quot;), colModel = self.p.colModel, ind = $self.jqGrid('getInd', rowId, true), cellColModel, colModelName, editOptions, $elem; // Se procesan las celdas editables $(&quot;td[role='gridcell']&quot;,ind).each( function(i) { cellColModel = colModel[i]; if(cellColModel.editable===true){ colModelName = cellColModel.name; $elem = $(&quot;[name='&quot;+colModelName+&quot;']&quot;,ind); // Se añade el title de los elementos de acuerdo al colname $elem.attr({ &quot;title&quot;: self.p.colNames[i], &quot;class&quot;: &quot;editable customelement&quot; }); // En caso de tratarse de un componente rup, se inicializa de acuerdo a la configuracón especificada en el colModel if(cellColModel.rupType!==undefined) { editOptions = cellColModel.editoptions; /* * PRE Configuración de los componentes RUP */ switch(cellColModel.rupType){ case &quot;combo&quot;: editOptions = $.extend({menuWidth:$elem.width()}, editOptions, {width:&quot;100%&quot;}); break; } // Invocación al componente RUP $elem[&quot;rup_&quot;+cellColModel.rupType](editOptions); /* * POST Configuración de los componentes RUP */ switch(cellColModel.rupType){ case &quot;date&quot;: // TODO: Aplicarlo con estilos $elem.css(&quot;width&quot;,&quot;88%&quot;); break; } } } }); settings.inlineEditingRow = rowId; function addNextRow (rowId, iCol){ $self.on(&quot;jqGridInlineAfterSaveRow.inlineEditing.addNextRow&quot;, function(event){ $self.rup_table(&quot;addRow&quot;); jQuery($self.getInd($self[0].p.selrow, true)).find(&quot;:not([readonly]):focusable:first&quot;).focus(); $self.off(&quot;jqGridInlineAfterSaveRow.inlineEditing.addNextRow&quot;); }); $self.rup_table(&quot;saveRow&quot;, rowId); return true; }; function editNextRow (rowId, iCol){ var idsArray, rowIndex, rowsPerPage, page, lastPage, $focusableElem; idsArray = $self.getDataIDs(); rowIndex = $self.getInd(rowId)-1; rowsPerPage = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;),10); if (rowIndex===rowsPerPage-1){ // Cambio de página page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10); lastPage = parseInt(Math.ceil($self.rup_table(&quot;getGridParam&quot;, &quot;records&quot;)/$self.rup_table(&quot;getGridParam&quot;, &quot;rowNum&quot;)),10); if (page&lt;lastPage){ $self.trigger(&quot;reloadGrid&quot;,[{page: page+1}]); $self.on(&quot;jqGridAfterLoadComplete.rupTable.inlineEdit&quot;,function(event,data){ idsArray = $self.getDataIDs(); $self.on(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;, function (event, rId){ if (iCol === undefined || iCol === -1){ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td :not([readonly]):focusable:first&quot;); }else{ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td:eq(&quot;+iCol+&quot;) :not([readonly]):focusable:first&quot;); } $focusableElem.trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;); }); jQuery($self.getInd(idsArray[0],true)).trigger(&quot;click&quot;); $self.off(&quot;jqGridAfterLoadComplete.rupTable.inlineEdit&quot;); }); return false; } }else{ $self.on(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;, function (event, rId){ if (iCol === undefined || iCol === -1){ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td :not([readonly]):focusable:first&quot;); }else{ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td:eq(&quot;+iCol+&quot;) :not([readonly]):focusable:first&quot;); } $focusableElem.trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;); }); jQuery($self.getInd(idsArray[rowIndex+1],true)).trigger(&quot;click&quot;); return false; } return true; }; function editPreviousRow (rowId, iCol){ var idsArray, rowIndex, page, $focusableElem; idsArray = $self.getDataIDs(); rowIndex = $self.getInd(rowId)-1; if (rowIndex===0){ // Cambio de página page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10); if (page&gt;1){ $self.trigger(&quot;reloadGrid&quot;,[{page: page-1}]); $self.on(&quot;jqGridAfterLoadComplete.rupTable.inlineEdit&quot;,function(event,data){ idsArray = $self.getDataIDs(); $self.on(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;, function (event, rId){ if (iCol === undefined || iCol === -1){ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td :not([readonly]):focusable:last&quot;); }else{ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td:eq(&quot;+iCol+&quot;) :not([readonly]):focusable:last&quot;); } $focusableElem.trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;); }); jQuery($self.getInd(idsArray[idsArray.length-1],true)).trigger(&quot;click&quot;); $self.off(&quot;jqGridAfterLoadComplete.rupTable.inlineEdit&quot;); }); return false; } }else{ $self.on(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;, function (event, rId){ if (iCol === undefined || iCol === -1){ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td :not([readonly]):focusable:last&quot;); }else{ $focusableElem = jQuery($self.jqGrid(&quot;getInd&quot;,rId, true)).find(&quot;td:eq(&quot;+iCol+&quot;) :not([readonly]):focusable:last&quot;); } $focusableElem.trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;); }); jQuery($self.getInd(idsArray[rowIndex-1],true)).trigger(&quot;click&quot;); return false; } } // Se almacena el contenido del los campos de la línea editable // TODO: Externalizar la obtención de los datos para comprobar los cambios $self.data(&quot;initialFormData&quot;,settings.inlineEdit.$inlineForm.rup_form(&quot;formSerialize&quot;)); // Se añaden los eventos de teclado jQuery(ind).on({ &quot;keydown&quot;: function(event) { if (event.keyCode === 27) { $self.rup_table(&quot;restoreRow&quot;,$(this).attr(&quot;id&quot;), settings.afterrestorefunc); return false; } if (event.keyCode === 13) { var ta = event.target; if(ta.tagName == 'TEXTAREA') { return true; } $self.rup_table(&quot;saveRow&quot;); return false; } } }); jQuery(&quot;td&quot;, jQuery(ind)).on({ &quot;keydown&quot;: function(event) { var iCol, nameArray; if (event.keyCode === 38) { nameArray = $.map($self.rup_table(&quot;getColModel&quot;),function(elem, index){ return elem.name; }); iCol = jQuery.inArray($(this).attr(&quot;aria-describedby&quot;).split(settings.id+&quot;_&quot;)[1], nameArray); editPreviousRow($(ind).attr(&quot;id&quot;), iCol); return false; } if (event.keyCode === 40) { nameArray = $.map($self.rup_table(&quot;getColModel&quot;),function(elem, index){ return elem.name; }); iCol = jQuery.inArray($(this).attr(&quot;aria-describedby&quot;).split(settings.id+&quot;_&quot;)[1], nameArray); editNextRow($(ind).attr(&quot;id&quot;), iCol); return false; } } }); jQuery(&quot;input,select&quot;, jQuery(ind)).on({ &quot;focus&quot;: function(event){ // var $row = $(this).parent().parent(); // // settings.inlineEditingRow = $row.attr(&quot;id&quot;); // $self.rup_table(&quot;setSelection&quot;,$row.attr(&quot;id&quot;)); } }); jQuery(&quot;input, textarea, select,a.rup_combo&quot;, jQuery(ind)).filter(&quot;.editable:visible:last&quot;).on({ &quot;keydown&quot;: function(event){ if (event.keyCode == 9 &amp;&amp; !event.shiftKey) { if (jQuery(ind).attr(&quot;id&quot;).indexOf(&quot;jqg&quot;)!==-1){ if(addNextRow(jQuery(ind).attr(&quot;id&quot;))===false){ return false; } }else{ if(editNextRow(jQuery(ind).attr(&quot;id&quot;))===false){ return false; } } } } }); jQuery(&quot;input, textarea, select,a.rup_combo&quot;, jQuery(ind)).filter(&quot;.editable:visible:first&quot;).on({ &quot;keydown&quot;: function(event){ var idsArray, rowIndex, page; if (event.keyCode == 9) { if (event.shiftKey) { idsArray = $self.getDataIDs(); rowIndex = $self.getInd(rowId)-1; if (rowIndex===0){ // Cambio de página page = parseInt($self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;),10); if (page&gt;1){ $self.trigger(&quot;reloadGrid&quot;,[{page: page-1}]); $self.on(&quot;jqGridAfterLoadComplete.rupTable.inlineEdit&quot;,function(event,data){ idsArray = $self.getDataIDs(); $self.on(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;, function (event, rowId){ jQuery($self.jqGrid(&quot;getInd&quot;,rowId, true)).find(&quot;td :focusable:last&quot;).trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;); }); jQuery($self.getInd(idsArray[idsArray.length-1],true)).trigger(&quot;click&quot;); $self.off(&quot;jqGridAfterLoadComplete.rupTable.inlineEdit&quot;); }); return false; } }else{ $self.on(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;, function (event, rowId){ jQuery($self.jqGrid(&quot;getInd&quot;,rowId, true)).find(&quot;td :focusable:last&quot;).trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.tabKeyNav.cellSelected&quot;); }); jQuery($self.getInd(idsArray[rowIndex-1],true)).trigger(&quot;click&quot;); return false; } } } } }); }, &quot;jqGridDblClickRow.rupTable.inlineEdit&quot;: function (rowid, iRow, iCol, e){ if (!settings.inlineEdit.autoEditRow){ $self.rup_table('editRow', iRow); }else{ return false; } }, &quot;jqGridInlineAfterRestoreRow.inlineEditing.processRupObjects&quot;: function(event, rowid){ var self = this, $self = $(this), json = self.p.savedRow[0]; $self.rup_table(&quot;restoreInlineRupFields&quot;, rowid, json); }, &quot;rupTable_beforeSaveRow.inlineEditing.processRupObjects&quot;: function(event, rowid, options){ var self = this, $self = $(this), $row, $cell, ruptypeObj; $(self.p.colModel).each(function(i){ $row= $(self.rows.namedItem(rowid)); $cell = $row.find(&quot;td:eq(&quot;+i+&quot;)&quot;); ruptypeObj = $cell.find(&quot;[ruptype]&quot;); if (ruptypeObj.attr(&quot;ruptype&quot;)===&quot;combo&quot;){ if ($self.data(&quot;rup.table.formatter&quot;)!==undefined){ $self.data(&quot;rup.table.formatter&quot;)[rowid][this.name][&quot;rup_&quot;+ruptypeObj.attr(&quot;rupType&quot;)]= { &quot;label&quot;:ruptypeObj.rup_combo(&quot;label&quot;), &quot;value&quot;:ruptypeObj.rup_combo(&quot;getRupValue&quot;) }; } } }); }, &quot;jqGridInlineSuccessSaveRow.rupTable.inlineEditing.processRupObjects&quot;: function(event, res, rowid, o){ var json = jQuery.parseJSON(res.responseText), self = this, $self = $(self); $self.rup_table(&quot;restoreInlineRupFields&quot;, rowid, json); return [true, json, rowid]; }, &quot;jqGridBeforeSelectRow.rupTable.inlineEditing&quot;: function(event, rowid, obj){ var $self = $(this), settings = $self.data(&quot;settings&quot;), editableRows = $(&quot;tr[editable=1]&quot;, $self); /* * Se comprueba si existen registros que estén siendo editados en línea. * Del mismo modo se comprueba si el registro seleccionado es diferente del que se está editando en ese momento. */ if (editableRows.length &gt; 0 &amp;&amp; (settings.inlineEditingRow!== undefined &amp;&amp; settings.inlineEditingRow !== rowid)){ // Se comprueba si se han realizado cambios en el registro en edición // TODO: Utilizar un método para comprobar los cambios en el formulario if ($self.data(&quot;initialFormData&quot;) !== settings.inlineEdit.$inlineForm.rup_form(&quot;formSerialize&quot;)){ // En caso de que se hayan realizado cambios se debera de realizar el guardado de los mismos. // Se confiura un handler para el evento jqGridInlineSuccessSaveRow que indica que se ha completado con exito el guardado del registro modificado. $self.on(&quot;jqGridInlineSuccessSaveRow.inlineEditing_beforeSelectRow&quot;, function(event){ // Una vez se haya realizado correctamente el guardado del registo se procede a seleccionar el registro solicitado por el usuario. $self.rup_table(&quot;setSelection&quot;,rowid); // Se elimina el handler del evento para evitar duplicidades $self.off(&quot;jqGridInlineSuccessSaveRow.inlineEditing_beforeSelectRow&quot;); }); // Se procede a realizar el guardado de los registros editados for (var i=0; i&lt;editableRows.length;i++){ $self.rup_table(&quot;saveRow&quot;, editableRows[0].id); } // Se retorna un false para deterner la selección del registro y permitir que se realice antes la gestión del guardado. return false; } } // En caso de no necesitarse guardar el registro en edición se continúa con la gestión de la selección de manera normal. return true; }, &quot;jqGridSelectRow.rupTable.inlineEditing&quot;: function (event, rowid, status, obj){ var $self = $(this), editableRows; editableRows = $(&quot;tr[editable=1]&quot;, $self); // En caso de que existan registros en modo edición se restauran if (editableRows.length &gt; 0){ jQuery.each($(&quot;tr[editable=1]&quot;, $self), function(index, elem){ if ($(elem).attr(&quot;id&quot;)!==rowid){ $self.jqGrid(&quot;restoreRow&quot;, $(elem).attr(&quot;id&quot;)); } }); } if (settings.inlineEdit.autoEditRow){ // Se procede a entrar en modo edición en la línea seleccionada. $self.rup_table(&quot;editRow&quot;, rowid); } }, &quot;rupTable_checkOutOfGrid.rupTable.inlineEditing&quot;: function(event, $target){ var $self = $(this), settings = $self.data(&quot;settings&quot;), operationCfg = settings.core.operations[&quot;save&quot;]; if (jQuery.proxy(operationCfg.enabled, $self)()){ jQuery.proxy(operationCfg.callback,$self)($self, event); } } }); if (settings.inlineEdit.autoEditRow){ $self.on({ &quot;jqGridCellSelect.rupTable.inlineEditing&quot;: function (event, rowid, iCol, cellcontent, obj){ var $self = $(this); if (iCol!==-1){ $self.on( &quot;jqGridInlineEditRow.rupTable.inlineEditing.cellSelected&quot;, function (event, rowId){ jQuery($self.jqGrid(&quot;getInd&quot;,rowid, true)).find(&quot;td:eq(&quot;+iCol+&quot;) :focusable:first&quot;).trigger(&quot;focus&quot;); $self.off(&quot;jqGridInlineEditRow.rupTable.inlineEditing.cellSelected&quot;); } ); } } }); } }, postConfigureInlineEdit:function(settings){ var $self = this, formId = &quot;inlineForm_&quot; + settings.id, $inlineForm =$(&quot;&lt;form&gt;&quot;).attr({&quot;id&quot;:&quot;inlineForm_&quot; + settings.id}); // Arropamos la estructura de la tabla en un formulario para poder realizar el envío de los campos $self.wrap($inlineForm); // Almacenamos la referencia al formulario. settings.inlineEdit.$inlineForm = $(&quot;#&quot;+formId); settings.inlineEdit.$inlineForm.on(&quot;rupValidate_formValidationError.inlineEditing&quot;, function(event, obj){ var rowid = $self.jqGrid('getGridParam','selrow'); jQuery($self.getInd(rowid,true)).attr(&quot;id&quot;,settings.inlineEditingRow); $self.rup_table(&quot;setSelection&quot;,settings.inlineEditingRow); }); $self.on({ &quot;jqGridLoadComplete.rupTable.formEditing&quot;: function(data){ var $self = $(this), settings = $self.data(&quot;settings&quot;), nPos; if (settings.inlineEdit.autoselectFirstRecord){ nPos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(); $self.rup_table(&quot;highlightRowAsSelected&quot;, jQuery($self.jqGrid(&quot;getInd&quot;, nPos[1][0],true))); } } }); } }); /** * Métodos públicos del plugin inlineEdit. * * Los métodos implementados son: * * addRow(options): Muestra una nueva línea para inserción. * editRow(rowId, options): Activa el modo edicón en línea para un registro determinado. * deleteRow(rowId, options): Realiza el borrado de un registro. * saveRow(rowId, options): Realiza el guardado de un registo modificado mediante la edición en línea. * restoreRow(rowId): Restaura la línea indicada * * Las propiedades de esta extensión almacenadas en el settings son las siguientes: * * settings.$inlineForm : Referencia al formulario utilizado para enviar los datos del registro que está siendo editado. * */ jQuery.fn.rup_table(&quot;extend&quot;,{ addRow: function(options){ var $self = this, settings = $self.data(&quot;settings&quot;), colModel = $self[0].p.colModel; /* * TODO: Ajustar el paso de parámetros */ var auxOptions = {addRowParams:$.extend({},settings.inlineEdit.addOptions,options)}; // Controlar los campos editables en modo nuevo for (var i=0;i&lt;colModel.length;i++){ if (colModel[i].editable === true &amp;&amp; colModel[i].editableOnAdd!==false){ if (colModel[i].editable === true &amp;&amp; colModel[i].editableOnAdd===false){ if (colModel[i].editoptions=== undefined){ colModel[i].editoptions={}; } colModel[i].editoptions.readonly=&quot;readonly&quot;; }else { if (colModel[i].editoptions !== undefined &amp;&amp; colModel[i].editoptions.readonly !== undefined){ delete colModel[i].editoptions.readonly; } } } } if ($self.triggerHandler(&quot;rupTable_beforeAddRow&quot;, [auxOptions])!==false){ $self.jqGrid('addRow', $.extend({},auxOptions)); } return $self; }, cloneRow: function(rowId, options){ var $self = this, settings = $self.data(&quot;settings&quot;), selectedRow = (rowId===undefined?$self.jqGrid('getGridParam','selrow'):rowId), colModel = $self[0].p.colModel, rowdata, clonedRowId; if ($self.triggerHandler(&quot;rupTable_beforeCloneRow&quot;,[settings, rowId])!==false){ rowdata = $self.jqGrid(&quot;getRowData&quot;,selectedRow); $self.rup_table(&quot;addRow&quot;); clonedRowId = jQuery(&quot;tbody:first tr[id*='jqg']&quot;,$self).attr(&quot;id&quot;); $self.jqGrid(&quot;setRowData&quot;,clonedRowId, rowdata); jQuery($self.jqGrid(&quot;getInd&quot;,clonedRowId,true)).attr(&quot;editable&quot;,&quot;0&quot;); // Controlar los campos editables en modo nuevo for (var i=0;i&lt;colModel.length;i++){ if (colModel[i].editable === true &amp;&amp; colModel[i].editableOnAdd!==false){ if (colModel[i].editable === true &amp;&amp; colModel[i].editableOnAdd===false){ if (colModel[i].editoptions=== undefined){ colModel[i].editoptions={}; } colModel[i].editoptions.readonly=&quot;readonly&quot;; }else { if (colModel[i].editoptions !== undefined &amp;&amp; colModel[i].editoptions.readonly !== undefined){ delete colModel[i].editoptions.readonly; } } } } $self.rup_table(&quot;editRow&quot;, clonedRowId, {}, true); } }, editRow: function (rowId, options, skipFieldCheck){ var $self = this, settings = $self.data(&quot;settings&quot;), selectedRow = (rowId===undefined?$self.jqGrid('getGridParam','selrow'):rowId), colModel = $self[0].p.colModel; if (skipFieldCheck!==true){ // Controlar los campos editables en modo edición for (var i=0;i&lt;colModel.length;i++){ if (colModel[i].editable === true &amp;&amp; colModel[i].editableOnEdit===false){ if (colModel[i].editoptions=== undefined){ colModel[i].editoptions={}; } colModel[i].editoptions.readonly=&quot;readonly&quot;; }else { if (colModel[i].editoptions !== undefined &amp;&amp; colModel[i].editoptions.readonly !== undefined){ delete colModel[i].editoptions.readonly; } } } } if ($self.triggerHandler(&quot;rupTable_beforeEditRow&quot;,[settings.inlineEdit.editOptions, selectedRow])!==false){ $self.jqGrid('editRow', selectedRow, $.extend({},settings.inlineEdit.editOptions,options)); } return $self; }, deleteRow: function (rowId, options){ var $self = this, settings = $self.data(&quot;settings&quot;), // deleteOptions = jQuery.extend(true, {}, jQuery.fn.rup_table.defaults.deleteOptions, options), deleteOptions = jQuery.extend(true, {}, settings.inlineEdit.deleteOptions, options), selectedRow = (rowId===undefined?$self.rup_table('getSelectedRows'):rowId); // En caso de especificarse el uso del método HTTP DELETE, se anyade el identificador como PathParameter if (selectedRow.length===1){ if (deleteOptions.mtype===&quot;DELETE&quot;){ deleteOptions.url = settings.baseUrl+&quot;/&quot;+$self.rup_table(&quot;getPkUrl&quot;,selectedRow); } }else{ deleteOptions.mtype = &quot;POST&quot;; deleteOptions.ajaxDelOptions.contentType = 'application/json'; deleteOptions.ajaxDelOptions.type = &quot;POST&quot;; deleteOptions.ajaxDelOptions.dataType = 'json'; deleteOptions.url = settings.baseUrl+&quot;/deleteAll&quot;; deleteOptions.serializeDelData = function(ts,postData){ // $self.rup_table(&quot;getFilterParams&quot;) return jQuery.toJSON({ &quot;core&quot;:{ &quot;pkToken&quot;:settings.multiplePkToken, &quot;pkNames&quot;:settings.primaryKey }, &quot;multiselection&quot;:$self.rup_table('getSelectedIds') }); }; } deleteOptions.afterSubmit = function(data, postd){ $self.triggerHandler(&quot;rupTable_deleteAfterSubmit&quot;, [data, postd]); return [true]; }; deleteOptions.afterComplete = function(data, postd){ $self.triggerHandler(&quot;rupTable_deleteAfterComplete&quot;, [data, postd]); }; if ($self.triggerHandler(&quot;rupTable_beforeDeleteRow&quot;,[deleteOptions, selectedRow])!==false){ $self.jqGrid('delGridRow',selectedRow, deleteOptions); } return $self; // var $self = this, // settings = $self.data(&quot;settings&quot;), //// deleteOptions = jQuery.extend(true, {}, jQuery.fn.rup_table.defaults.deleteOptions, options), // deleteOptions = jQuery.extend(true, {}, settings.inlineEdit.deleteOptions, options), // selectedRow = (rowId===undefined?$self.jqGrid('getGridParam','selrow'):rowId); // // // En caso de especificarse el uso del método HTTP DELETE, se anyade el identificador como PathParameter // if (deleteOptions.mtype===&quot;DELETE&quot;){ // deleteOptions.url = settings.baseUrl+&quot;/&quot;+selectedRow; // } // // // // $self.jqGrid('delGridRow',selectedRow, deleteOptions); // // return $self; }, saveRow : function(rowId, options){ var $self = this, settings = $self.data(&quot;settings&quot;), selectedRow = (rowId===undefined?$self.jqGrid('getGridParam','selrow'):rowId); // var userBeforeSend = settings.ajaxRowOptions.beforeSend; // self.p.ajaxRowOptions.beforeSend = function(jqXHR, ajaxOptions){ // var rupFormSettings = {}; // jQuery.extend(true, rupFormSettings, ajaxOptions, {validate: settings.validation}); // if (jQuery.isFunction(userBeforeSend)){ // rupFormSettings.beforeSend = userBeforeSend; // }else{ // rupFormSettings.beforeSend = null; // } // settings.$inlineForm.rup_form(&quot;ajaxSubmit&quot;, rupFormSettings); // return false; // }; $self.triggerHandler(&quot;rupTable_beforeSaveRow&quot;, [selectedRow, options]); if(selectedRow.indexOf(&quot;jqg&quot;)!==-1){ $self[0].p.ajaxRowOptions = settings.inlineEdit.addOptions.ajaxRowOptions; $self.jqGrid('saveRow', selectedRow, settings.inlineEdit.addOptions); }else{ $self[0].p.ajaxRowOptions = settings.inlineEdit.editOptions.ajaxRowOptions; $self.jqGrid('saveRow', selectedRow, settings.inlineEdit.editOptions); } return $self; }, restoreRow: function(rowId, afterrestorefunc){ var $self = this, rowToRestore = (rowId===undefined?$self.jqGrid('getGridParam','selrow'):rowId); $self.triggerHandler(&quot;rupTable_beforeRestoreRow&quot;, [rowId]); $self.jqGrid(&quot;restoreRow&quot;, rowToRestore, afterrestorefunc); }, restoreInlineRupFields: function (rowid, json){ var $self = this, self = this[0], $row, $cell, ruptypeObj; $(self.p.colModel).each(function(i){ $row= $(self.rows.namedItem(rowid)); $cell = $row.find(&quot;td:eq(&quot;+i+&quot;)&quot;); //ruptypeObj = $cell.find(&quot;[ruptype]&quot;); // ruptypeObj = this.editoptions.ruptype; if ( this.rupType){ if (this.rupType===&quot;combo&quot;){ if ($self.data(&quot;rup.table.formatter&quot;)!==undefined){ var val = $self.data(&quot;rup.table.formatter&quot;)[rowid][this.name][&quot;rup_&quot;+this.rupType][&quot;label&quot;]; $cell.html(val); } } } }); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Parametros de configuración de los settings para el caso particular de configuración del componente en el caso de funcionar en modo edición en linea. * * Los métodos para los que se proporciona una implementación son los siguientes. * * beforeSelectRow: * onCellSelect: * onSelectRow: */ jQuery.fn.rup_table.plugins.inlineEdit = {}; jQuery.fn.rup_table.plugins.inlineEdit.defaults = { toolbar:{ defaultButtons:{ add : true, edit : true, cancel : true, save : true, clone : true, &quot;delete&quot; : true, filter : false } }, contextMenu:{ defaultRowOperations:{ add : true, edit : true, cancel : true, save : true, clone : true, &quot;delete&quot; : true, filter : false } }, inlineEdit:{ autoselectFirstRecord: true, autoEditRow:false }, formEdit:{ } }; // Parámetros de configruación comunes para las acciónes de añadir y editar un registro jQuery.fn.rup_table.plugins.inlineEdit.defaults.inlineEdit.addEditOptions = { contentType: 'application/json', type:&quot;PUT&quot;, dataType: 'json', ajaxRowOptions:{ contentType: 'application/json', dataType: 'json', processData:false } }; // Parámetros de configruación específicos para la acción de añadir un registro jQuery.fn.rup_table.plugins.inlineEdit.defaults.inlineEdit.addOptions = { mtype: &quot;POST&quot;, ajaxRowOptions:{ type:&quot;POST&quot; } }; // Parámetros de configruación específicos para la acción de editar un registro jQuery.fn.rup_table.plugins.inlineEdit.defaults.inlineEdit.editOptions = { mtype: &quot;PUT&quot;, ajaxRowOptions:{ type:&quot;PUT&quot; } }; // Parámetros de configruación específicos para la acción de eliminar un registro jQuery.fn.rup_table.plugins.inlineEdit.defaults.inlineEdit.deleteOptions = { bSubmit: jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_message.aceptar&quot;), cancelicon:[true, &quot;left&quot;, &quot;icono_cancelar&quot;], delicon:[false], linkStyleButtons: [&quot;#eData&quot;], msg: '&lt;div id=&quot;rup_msgDIV_msg_icon&quot; class=&quot;rup-message_icon-confirm&quot;&gt;&lt;/div&gt;&lt;div id=&quot;rup_msgDIV_msg&quot; class=&quot;rup-message_msg-confirm white-space-normal&quot;&gt;'+jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_table.deleteAll&quot;)+'&lt;/div&gt;', mtype:&quot;DELETE&quot;, width: 320, reloadAfterSubmit:false, resize:false }; /** * Extensión de las propiedades por defecto del jqGrid para el modo de edición en línea */ jQuery.jgrid.inlineEdit = { keys:false }; })(jQuery); × Search results Close "},"rup_table_rup.table.multifilter.js.html":{"id":"rup_table_rup.table.multifilter.js.html","title":"Source: rup_table/rup.table.multifilter.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.multifilter.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function($) { /** * Definición de los métodos principales que configuran la inicialización * del plugin. * * postConfiguration: Método que se ejecuta después de la invocación del * componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;multifilter&quot;, { loadOrder : 15, preConfiguration : function(settings) { var $self = this; return $self.rup_table(&quot;preConfigureMultifilter&quot;, settings); }, postConfiguration : function(settings) { var $self = this; return $self.rup_table(&quot;postConfigureMultifilter&quot;, settings); } }); // ******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS // ******************************** /** * Extensión del componente rup_table para permitir la gestión del filtrado * de registros de la tabla. * * Los métodos implementados son: * * postConfigureFilter(settings): Método que define la preconfiguración * necesaria para el correcto funcionamiento del componente. * * Se almacena la referencia de los diferentes componentes: * * settings.filter.$filterContainer : Contenedor del formulario de filtrado * settings.filter.$filterButton : Botón que realiza el filtrado * settings.filter.$cleanLink : Enlace para limpiar el formulario * settings.filter.$collapsableLayer : Capa que puede ser ocultada/mostrada * settings.filter.$toggleIcon1Id : Control que oculta muestra el fomulario * settings.filter.$filterSummary : Contenedor donde se especifican los * criterios de filtrado * */ jQuery.fn .rup_table( &quot;extend&quot;, { preConfigureMultifilter : function(settings) { var $self = this, tableId = settings.id, multifilterSettings = settings.multifilter, dropdownDialogId, $dropdownDialog, $dropdownDiaglogTemplate; //definincion de variables con los selectores multifilterSettings.$dropdownDialog=$(&quot;#&quot;+settings.id+&quot;_multifilter_dropdownDialog&quot;); //definicion de variables con ids multifilterSettings.dropdownDialogId = settings.id+&quot;_multifilter_dropdownDialog&quot;; $dropdownDiaglogTemplate = $self.rup_table(&quot;getMultifilterDialogTemplate&quot;, settings); settings.filter.$filterContainer .after($dropdownDiaglogTemplate); $self.rup_table(&quot;configureMultifilter&quot;, settings); // configuracion del resumen del filtro para que // apareza el nombre del filtro settings.multifilter.fncFilterName = function(searchString) { if (multifilterSettings.$comboLabel==undefined){ //&amp;&amp; settings.$firstStartUp &amp;&amp; multifilterSettings.$filterDefaultName!=undefined){ if (multifilterSettings.$filterDefaultName!==undefined) searchString = multifilterSettings.$filterDefaultName+ &quot; {&quot; + searchString + &quot;} &quot;; } else if (multifilterSettings.$comboLabel!=undefined &amp;&amp; settings.$firstStartUp){ if(multifilterSettings.$comboLabel.val()==&quot;&quot; &amp;&amp; multifilterSettings.$filterDefaultName!=undefined){ if (multifilterSettings.$filterDefaultName!==undefined) searchString = multifilterSettings.$filterDefaultName+ &quot; {&quot; + searchString + &quot;} &quot;; } }else if (multifilterSettings.$comboLabel.val()!=&quot;&quot; &amp;&amp; multifilterSettings.$filterWithName){ multifilterSettings.$filterWithName=false; searchString = multifilterSettings.$comboLabel.val()+ &quot; {&quot; + searchString + &quot;} &quot;; } return searchString; } }, /* * Método que define la preconfiguración necesaria para * el correcto funcionamiento del componente. * * */ postConfigureMultifilter : function(settings) { var $self = this, multifilterSettings = settings.multifilter, filterSettings,$dropdownButton, $combo,$comboLabel ,$defaultCheck,$feedback,$comboButton,$closeDialog; /* * $(&quot;#&quot;+settings.id+&quot;_multifilter_combo_label&quot;).on(&quot;change&quot;, * function(){ * * if * ($(&quot;#&quot;+settings.id+&quot;_multifilter_combo_label&quot;).val()==&quot;&quot;){ * $self._toggleButtons(settings.id,false); }else{ * $self._toggleButtons(settings.id,true); } }); */ settings.filter.$filterButton .rup_button({ dropdown : { dropdownIcon : &quot;ui-icon-gear&quot;, dropdownDialog : multifilterSettings.dropdownDialogId, dropdownDialogConfig : { title : &quot;&lt;span class='rup-icon rup-icon-filter'/&gt;&quot; + $.rup.i18n.base.rup_table.plugins.multifilter.tittle, width : &quot;450px&quot;, buttons : [ { id : settings.id+ &quot;_multifilter_BtnSave&quot;, text : $.rup.i18n.base.rup_table.plugins.multifilter.save, click : function() { if ($self._checkLabel(settings)) { // creo objeto Filter con los datos del formulario del filtro var filter = $self._createFilterFromForm(settings); var bfr = $self.triggerHandler(&quot;rupTable_beforeAdd&quot;); if (bfr === false || bfr === 'stop') { multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.errorValidate,&quot;error&quot;); return; } // añado el filtro $self.rup_table(&quot;addFilter&quot;,filter); } } }, { id : settings.id+ &quot;_multifilter_BtnApply&quot;, text : $.rup.i18n.base.rup_table.plugins.multifilter.apply, click : function() { //Deshabilitar el nombre del filtro en el filterSummary una vez que ha terminado el filtro por defecto if (settings.$firstStartUp){ settings.$firstStartUp=false; } if ($self._checkLabel(settings)) { multifilterSettings.$filterWithName=true; var valorFiltro= $self._searchFilterInCombo(settings); if (valorFiltro!=undefined){ //limpiamos el filtro $self.rup_table(&quot;cleanFilterForm&quot;); //Cargamos de nuevo el filtro en el formulario del filtro // rellenar el formulario del filtro $self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,valorFiltro); $self._fillForm(valorFiltro); $self.rup_table(&quot;filter&quot;); multifilterSettings.$closeDialog.click(); } else{ multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.errorNoexiste,&quot;error&quot;); } // //$self.rup_table(&quot;filter&quot;); // crea el tooptip del resumen del filtro //var filterCriteria = $self._createTooltip(); } } }, { id : settings.id+ &quot;_multifilter_BtnRemove&quot;, text : $.rup.i18n.base.rup_table.plugins.multifilter.remove, click : function() { if ($self._checkLabel(settings)) { // creo objeto Filter con los datos del formulario del filtro var filter = $self._createFilterFromForm(settings); // borro el filtro $self.rup_table(&quot;deleteFilter&quot;,filter); } } }, { text : $.rup.i18n.base.rup_table.plugins.multifilter.cancel, click : function() { var filtroAnterior= $self.data(&quot;filtroAnterior&quot;); if (filtroAnterior!=null){ //var xhrArray=$.rup_utils.jsontoarray(filtroAnterior); $self.rup_table(&quot;cleanFilterForm&quot;); //$.rup_utils.populateForm(filtroAnterior,settings.filter.$filterForm); $self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,filtroAnterior); $self._fillForm(filtroAnterior); } //limpio el filtro del dropdownDIalog multifilterSettings.$comboLabel.val(&quot;&quot;); multifilterSettings.$closeDialog.click(); }, btnType : $.rup.dialog.LINK } ] } } }); //Deshabilitar el nombre del filtro en el filterSummary una vez que ha terminado el filtro por defecto $self.on(&quot;rupTable_beforeFilter&quot;, function(event){ /*if (settings.$firstStartUp){ settings.$firstStartUp=false; }*/ }); //definincion de variables con los selectores multifilterSettings.$dropdownButton=$('#'+settings.id+&quot;_filter_filterButton_dropdown&quot;); multifilterSettings.$combo=$(&quot;#&quot; + settings.id + &quot;_multifilter_combo&quot;); multifilterSettings.$comboLabel=$(&quot;#&quot; + settings.id + &quot;_multifilter_combo_label&quot;); multifilterSettings.$comboButton=$(&quot;#&quot; + settings.id+&quot;_multifilter_dropdownDialog .rup-combobox-toggle&quot;); multifilterSettings.$defaultCheck=$(&quot;#&quot; + settings.id + &quot;_multifilter_defaultFilter&quot;); multifilterSettings.$feedback=$(&quot;#&quot; + settings.id + &quot;_multifilter_dropdownDialog_feedback&quot;); multifilterSettings.$closeDialog=$('#closeText_'+settings.id+'_multifilter_dropdownDialog') // dialog modal para no cambiar el filtro mientras // se gestionan los mismos $('#' + multifilterSettings.dropdownDialogId).rup_dialog(&quot;setOption&quot;, &quot;modal&quot;, true); $('#' + multifilterSettings.dropdownDialogId).rup_dialog(&quot;setOption&quot;, &quot;draggable&quot;, false); $('#' + multifilterSettings.dropdownDialogId).rup_dialog(&quot;setOption&quot;, &quot;resizable&quot;, false); // $('#'+multifilterSettings.dropdownDialogId).parent().addClass(&quot;rup_multifilter_container&quot;); $('#' + multifilterSettings.dropdownDialogId).parent().css(&quot;width&quot;, &quot;500px&quot;); multifilterSettings.$dropdownButton.on(&quot;click&quot;, function(){ //guardo el filtroAnterior var valorFiltro= form2object(settings.filter.$filterContainer[0]); var xhrArray=$.rup_utils.jsontoarray(valorFiltro); $self.data(&quot;filtroAnterior&quot;,valorFiltro); //Foco al label al entrar al dialog multifilterSettings.$comboLabel.focus(); }); $self._configCombo(settings); multifilterSettings.$feedback.rup_feedback({ block : false }); //gesión por filtroPorDefecto //$self.rup_table(&quot;showSearchCriteria&quot;); //if(filtroDefault!=null) //$(&quot;#&quot;+settings.id+&quot;_filter_summary&quot;).prepend(filtroDefault.filterName +&quot; &quot;+ $(&quot;#&quot;+settings.id+&quot;_filter_summary&quot;).val() ); //bug IE que al cerrar el dialog con el combo desplegado , la lista del combo sigue abierta $('.rup-dropdown-dialog').on(&quot;dialogclose&quot;,function (){ multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).hide(); }); //la primera vez que cancelas el filtroAnterior es el filtroPorDefecto var valorFiltro=form2object(settings.filter.$filterContainer[0]); xhrArray=$.rup_utils.jsontoarray(valorFiltro); $self.data(&quot;filtroAnterior&quot;,valorFiltro); //$self.rup_table(&quot;filter&quot;); //settings.filter.$filterButton.trigger(&quot;click&quot;); //$self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,form2object(settings.filter.$filterContainer[0])); $self.on({ &quot;rupTable_beforeAdd.multifilter.validate&quot;: function(){ //filterSettings.$filterContainer.rup_validate(&quot;resetForm&quot;); if (multifilterSettings!==undefined){ if(!settings.$firstStartUp){ return settings.filter.$filterContainer.valid(); }else{ return null; } }else{ return settings.filter.$filterContainer.valid(); } } }); } }); // ******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS // ******************************** /** * Métodos públicos del plugin filter. * * cleanFilterForm: Realiza una limpieza de los campos del formulario. * filter: Lanza el filtrado de la tabla de acuerdo a los criterios * indicados en el formulario. toggleFilterForm: Método encargado de ocultar * y mostrar el formulario de filtrado. * */ jQuery.fn .rup_table( &quot;extend&quot;, { getMultifilterDialogTemplate : function(settings) { var $self = this, multifilterSettings = settings.multifilter; var $dropdownDiaglogTemplate = jQuery(&quot;&lt;div id=\\&quot;&quot; + multifilterSettings.dropdownDialogId + &quot;\\&quot; style=\\&quot;display:none\\&quot; class=\\&quot;rup_multifilter_dropdown\\&quot;&gt;&quot; + &quot;&lt;div id=\\&quot;&quot; + multifilterSettings.dropdownDialogId + &quot;_feedback\\&quot;&gt;&lt;/div&gt;&quot; + &quot;&lt;form&gt;&quot; + &quot;&lt;fieldset class=\\&quot;dropdownButton-inputs\\&quot;&gt;&quot; + &quot;&lt;div id=\\&quot;&quot; + multifilterSettings.dropdownDialogId + &quot;_columna_cnt\\&quot; class=\\&quot;formulario_columna_cnt\\&quot;&gt;&quot; + &quot;&lt;div id=\\&quot;&quot; + multifilterSettings.dropdownDialogId + &quot;_lineaCombo\\&quot; class=\\&quot;formulario_linea_izda_float\\&quot;&gt;&quot; + &quot;&lt;label for=\\&quot;&quot; + settings.id + &quot;_multifilter_combo\\&quot;&gt;&quot; + $.rup.i18n.base.rup_table.plugins.multifilter.filters + &quot;&lt;/label&gt;&quot; + &quot;&lt;input id=\\&quot;&quot; + settings.id + &quot;_multifilter_combo\\&quot; class=\\&quot;rup_multifilter_selector\\&quot; /&gt;&quot; + &quot;&lt;/div&gt;&quot; + &quot;&lt;div id=\\&quot;&quot; + multifilterSettings.dropdownDialogId + &quot;_lineaDefault\\&quot; class=\\&quot;formulario_linea_izda_float\\&quot;&gt;&quot; + &quot;&lt;input type=\\&quot;checkbox\\&quot; id=\\&quot;&quot; + settings.id + &quot;_multifilter_defaultFilter\\&quot;/&gt;&quot; + &quot;&lt;label for=\\&quot;&quot; + settings.id + &quot;_multifilter_defaultFilter\\&quot;&gt;&quot; + $.rup.i18n.base.rup_table.plugins.multifilter.defaultFilter + &quot;&lt;/label&gt;&quot; + &quot;&lt;/div&gt;&quot; + &quot;&lt;/div&gt;&quot; + &quot;&lt;/fieldset&gt;&quot; + &quot;&lt;/form&gt;&quot; + &quot;&lt;/div&gt;&quot;); return $dropdownDiaglogTemplate; }, configureMultifilter : function(settings) { var $self = this, multifilterSettings = settings.multifilter,$filterForm ; $self.data(&quot;settings&quot;, settings); settings.filter.$filterForm = $(&quot;#&quot; + settings.id + &quot;_filter_form&quot;); var options_ejie_combo = { source : [ { label : &quot;Si&quot;, value : &quot;0&quot; }, { label : &quot;No&quot;, value : &quot;1&quot; } ], width : 120, blank : &quot;&quot; }; // jQuery(&quot;#&quot;+settings.id+&quot;_multifilter_combo&quot;).rup_combo(options_ejie_combo); var selector; if (multifilterSettings.idFilter != null) { selector = multifilterSettings.idFilter; } else { selector = settings.id; } var usuario; if (multifilterSettings.userFilter!=null){ usuario=multifilterSettings.userFilter; }else{ usuario=LOGGED_USER; } var getDefault; if (multifilterSettings.getDefault!=null){ getDefault = multifilterSettings.getDefault; }else{ getDefault = true; } jQuery(&quot;#&quot; + settings.id + &quot;_multifilter_combo&quot;).rup_autocomplete( { source : settings.baseUrl + &quot;/multiFilter/getAll?filterSelector=&quot; + selector + &quot;&amp;user=&quot; + usuario, sourceParam : { label : &quot;filterName&quot;, value : &quot;filterDefault&quot;, data : &quot;filterValue&quot; }, method : 'GET', contains : false, combobox : true, menuAppendTo : $('#' + multifilterSettings.dropdownDialogId).parent(), select : function() { var valorFiltro=$self._searchFilterInCombo(settings); //limpiar Filtro //$self.rup_table(&quot;resetForm&quot;,settings.filter.$filterForm); $self.rup_table(&quot;cleanFilterForm&quot;); // rellenar el formulario del filtro //$.rup_utils.populateForm(xhrArray,settings.filter.$filterForm); $self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,valorFiltro); $self._fillForm(valorFiltro); // } }); $('.jstree').on(&quot;rup_filter_treeLoaded&quot;,function(event,data){ $(this).rup_tree(&quot;setRupValue&quot;,data); //$self.rup_table(&quot;showSearchCriteria&quot;); }); settings.filter.$cleanLink.on(&quot;click&quot;,function() { multifilterSettings.$combo.rup_autocomplete(&quot;set&quot;, &quot;&quot;, &quot;&quot;); settings.filter.$filterSummary.html(&quot;&lt;i&gt;&lt;/i&gt;&quot;); }); }, addFilter : function(filter) { var $self=this; var settings = $self.data(&quot;settings&quot;); var multifilterSettings= settings.multifilter; // self.data(&quot;settings&quot;); if (multifilterSettings.idFilter != null) { filter.filtro.filterSelector = multifilterSettings.idFilter; } // add Filter $.rup_ajax({ url : settings.baseUrl+ &quot;/multiFilter/add&quot;, type : &quot;POST&quot;, data : $.toJSON(filter), dataType : 'json', showLoading : false, contentType : 'application/json', async : false, beforeSend : function(xhr, options) { return $self.triggerHandler(&quot;rupTable_multifilter_beforeAdd&quot;,[xhr, options]); }, success : function(data, status, xhr) { multifilterSettings.$savedFilterName=data.filterName; multifilterSettings.$savedFilterValue=data.filterValue; multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.ok,&quot;ok&quot;); //multifilterSettings.$combo.rup_autocomplete(&quot;set&quot;,&quot;&quot;, &quot;&quot;); multifilterSettings.$comboLabel.data(&quot;tmp.loadObjects.term&quot;,null); multifilterSettings.$comboLabel.data(&quot;loadObjects&quot;, {}); // $(&quot;#&quot;+settings.id+&quot;_multifilter_combo_label&quot;).data(&quot;tmp.loadObjects.term&quot;,term); multifilterSettings.$comboLabel.data(&quot;tmp.data&quot;, {}); if (multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).is(&quot;:visible&quot;)) { multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).hide(); } }, error : function(xhr, ajaxOptions,thrownError) { multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.error,&quot;error&quot;); } }); }, deleteFilter : function(filter) { var $self=this; var settings = $self.data(&quot;settings&quot;); var multifilterSettings = settings.multifilter; //reiniciar filter salvado multifilterSettings.$savedFilterName =undefined; multifilterSettings.$savedFilterValue =undefined; if (multifilterSettings.idFilter != null) { filter.filtro.filterSelector = multifilterSettings.idFilter; } // delete $.rup_ajax({ url : settings.baseUrl+ &quot;/multiFilter/delete&quot;, type : &quot;POST&quot;, data : $.toJSON(filter), dataType : 'json', showLoading : false, contentType : 'application/json', async : false, success : function(data, status, xhr) { multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.ok,&quot;ok&quot;); multifilterSettings.$combo.rup_autocomplete(&quot;set&quot;,&quot;&quot;, &quot;&quot;); multifilterSettings.$comboLabel.data(&quot;tmp.loadObjects.term&quot;,null); multifilterSettings.$comboLabel.data(&quot;loadObjects&quot;, {}); // $(&quot;#&quot;+settings.id+&quot;_multifilter_combo_label&quot;).data(&quot;tmp.loadObjects.term&quot;,term); multifilterSettings.$comboLabel.data(&quot;tmp.data&quot;, {}); if (multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).is(&quot;:visible&quot;)) { multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).hide(); } if (data.filterFeedback == 'no_records') { multifilterSettings.$feedback.rup_feedback(&quot;set&quot;, $.rup.i18n.base.rup_table.plugins.multifilter.noRecords,&quot;error&quot;); } }, error : function(xhr, ajaxOptions, thrownError) { multifilterSettings.$feedback.rup_feedback( &quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.error,&quot;error&quot;); } }); } }); // ******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS // ******************************* jQuery.fn .rup_table( &quot;extend&quot;, { _createFilterFromForm : function(settings) { var multifilterSettings= settings.multifilter; var dataForm = form2object(settings.filter.$filterContainer[0]); //cambiar la fecha a milisegundos para guardar en bd var fecha ; $.each($(&quot;[ruptype='date']&quot;, settings.filter.$filterContainer), function(index,item){ fecha = $(item).datepicker(&quot;getDate&quot;); if (fecha!=null) dataForm[item.name]=fecha.getTime().toString(); }); var dataFormJson = $.toJSON(dataForm); var usuario; if (multifilterSettings.userFilter!=null){ usuario=multifilterSettings.userFilter; }else{ usuario=LOGGED_USER; } var filter = { filtro : { filterSelector : settings.id, filterName :multifilterSettings.$comboLabel.val(), filterValue : dataFormJson, filterDefault : multifilterSettings.$defaultCheck.is(':checked'), filterUser : usuario } }; return filter; }, _configCombo: function (settings){ var multifilterSettings= settings.multifilter; multifilterSettings.$comboLabel.on(&quot;change&quot;,function() { settings.filter.$filterSummary.html(&quot;&lt;i&gt;&lt;/i&gt;&quot;); }); // si el filtro es el predefinido que aparezca en negrita multifilterSettings.$comboLabel.data(&quot;autocomplete&quot;)._renderItem = function(ul, item) { if (item.value) { return $(&quot;&lt;li&gt;&lt;/li&gt;&quot;).data( &quot;item.autocomplete&quot;, item).append( &quot;&lt;a&gt;&lt;b&gt;&quot; + item.label + &quot;&lt;/b&gt;&lt;/a&gt;&quot;) .appendTo(ul); } else { return $(&quot;&lt;li&gt;&lt;/li&gt;&quot;).data( &quot;item.autocomplete&quot;, item).append( &quot;&lt;a&gt;&quot; + item.label + &quot;&lt;/a&gt;&quot;) .appendTo(ul); } }; multifilterSettings.$comboLabel.off(&quot;blur click&quot;); multifilterSettings.$comboLabel.attr(&quot;placeholder&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.input); multifilterSettings.$comboLabel.on(&quot;blur&quot;,function(event) { // Obtener datos de si viene de // seleccionar elemento o si el // menú de selección está // desplegado var selected = multifilterSettings.$combo.data(&quot;selected&quot;), isShowingMenu = $(&quot;.ui-autocomplete:visible&quot;).length &gt; 0 ? true : false; // Borrar índicador de que viene // de seleccionar elemento multifilterSettings.$combo.data(&quot;selected&quot;, false); // Si es un evento de teclado // pero no es ENTER, omitir esta // función if (event.type === &quot;keydown&quot; &amp;&amp; event.keyCode !== 13) { return true; } if (isShowingMenu === true &amp;&amp; event.type === &quot;keydown&quot;) { multifilterSettings.$combo .focus(); event.stopPropagation(); return true; } var autoCompObject = $(event.currentTarget), loadObjects = multifilterSettings.$comboLabel.data(&quot;loadObjects&quot;); if (settings.getText == true) { if (loadObjects[autoCompObject.val()] !== undefined) { multifilterSettings.$combo.val(autoCompObject.val()); multifilterSettings.$combo.attr(&quot;rup_autocomplete_label&quot;,autoCompObject.val()); } else { multifilterSettings.$combo.val(autoCompObject.val()); multifilterSettings.$combo.attr(&quot;rup_autocomplete_label&quot;,autoCompObject.val()); } } else { if (loadObjects[autoCompObject.val()] !== undefined) { multifilterSettings.$combo.val(loadObjects[autoCompObject.val()]); multifilterSettings.$combo.attr(&quot;rup_autocomplete_label&quot;,loadObjects[autoCompObject.val()]); } else { autoCompObject.autocomplete(&quot;close&quot;); } } // Si el evento es ENTER y viene // de seleccionar un elemento o // el menú se estaba mostrando, // omitir resto de funciones // (ej. buscar) if (event.type === &quot;keydown&quot; &amp;&amp; event.keyCode === 13 &amp;&amp; (selected || isShowingMenu)) { return false; } }); multifilterSettings.$comboButton.off(&quot;click mousedown&quot;); multifilterSettings.$comboButton.on(&quot;blur&quot;,function() { if (multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).is(&quot;:visible&quot;)) { multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).hide(); } }); multifilterSettings.$comboButton.on(&quot;click&quot;,function() { if (multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).is(&quot;:visible&quot;)) { multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).hide(); } else { multifilterSettings.$comboLabel.autocomplete(&quot;search&quot;,&quot;&quot;); multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).show(); multifilterSettings.$comboLabel.autocomplete(&quot;widget&quot;).trigger('focus'); } }); }, // _toggleButtons : function(id, visibles) { // // if (visibles == false) { // $(&quot;#&quot; + id + &quot;_multifilter_BtnSave&quot;).button( // &quot;disable&quot;); // $(&quot;#&quot; + id + &quot;_multifilter_BtnApply&quot;).button( // &quot;disable&quot;); // $(&quot;#&quot; + id + &quot;_multifilter_BtnRemove&quot;).button( // &quot;disable&quot;); // // } else { // $(&quot;#&quot; + id + &quot;_multifilter_BtnSave&quot;).button( // &quot;enable&quot;); // $(&quot;#&quot; + id + &quot;_multifilter_BtnApply&quot;).button( // &quot;enable&quot;); // $(&quot;#&quot; + id + &quot;_multifilter_BtnRemove&quot;).button( // &quot;enable&quot;); // } // }, _checkLabel : function(settings) { var multifilterSettings= settings.multifilter; if ($.trim(multifilterSettings.$comboLabel.val()) == &quot;&quot;) { multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.emptyName,&quot;error&quot;); return false; } else if (multifilterSettings.$comboLabel.val().length &gt; settings.multifilter.labelSize) { multifilterSettings.$feedback.rup_feedback(&quot;set&quot;,$.rup.i18n.base.rup_table.plugins.multifilter.tooLong, &quot;error&quot;); return false; } return true; }, _searchFilterInCombo : function(settings) { var multifilterSettings = settings.multifilter; var name = $(&quot;#&quot; + settings.id + &quot;_multifilter_combo_label&quot;).val(); // var listaFiltros = $(&quot;#&quot; + this.id+ // &quot;_label&quot;).data(&quot;tmp.data&quot;); var listaFiltros = $(&quot;#&quot; + settings.id+ &quot;_multifilter_combo_label&quot;).data(&quot;tmp.data&quot;); // Busco el valor del filtro var objFiltro = $.grep(listaFiltros, function(obj,i) { if (obj.label == name) return obj }); // si es filtro por defecto, // checkeo el check &quot;Filtro // por defecto&quot; if (objFiltro.length != 0) { multifilterSettings.$defaultCheck.attr('checked', objFiltro[0].value); var valorFiltro = $.parseJSON(objFiltro[0].data); var xhrArray = []; // $.map(valorFiltro,function(item) { // xhrArray[item.name] = item.value; // }); xhrArray = $.rup_utils.jsontoarray(valorFiltro); } if (valorFiltro==undefined &amp;&amp; multifilterSettings.$savedFilterName!=undefined){ if (multifilterSettings.$savedFilterName===name) var valorFiltro = $.parseJSON(multifilterSettings.$savedFilterValue); } return valorFiltro; }, _fillForm : function(filtroNuevo) { var $self = this; var settings= $self.data(&quot;settings&quot;); //cambiar milisengudos a fecha (el formato de bd del fecha es milisegundos) $(&quot;[ruptype='date']&quot;, settings.filter.$filterContainer).each(function(index, elem){ var $campo = jQuery(elem); var fechaString; var jsonFecha = filtroNuevo[elem.name]; if (jsonFecha!=undefined){ if( jsonFecha.search(&quot;/&quot;)==-1){ var dateFromJson = new Date(parseInt(jsonFecha)); var dateFormat = $campo.data(&quot;datepicker&quot;).settings.dateFormat; if ($campo.data(&quot;datepicker&quot;).settings.datetimepicker){ // Cuando es fecha-hora var dateObj={hour:dateFromJson.getHours(),minute:dateFromJson.getMinutes(),second:dateFromJson.getSeconds()}; fechaString = $.datepicker.formatDate(dateFormat, dateFromJson)+&quot; &quot;+$.timepicker._formatTime(dateObj, &quot;hh:mm:ss&quot;); }else{ // Solo fecha fechaString = $.datepicker.formatDate(dateFormat, dateFromJson); } filtroNuevo[elem.name]=fechaString; } } }); // Formatear datos // var valorFiltro = $.parseJSON(filtroNuevo); var xhrArray = $.rup_utils.jsontoarray(filtroNuevo); // evento antes de rellenar el form // $self.triggerHandler(&quot;rupTable_multifilter_fillForm&quot;,filtroNuevo); // rellenar el formulario $.rup_utils.populateForm(xhrArray, $(this.selector+ &quot;_filter_form&quot;)); // $self._fillForm(filtroNuevo); // $self.rup_table(&quot;filter&quot;); } }); // ******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON // ******************************************************* /** * Parámetros de configuración por defecto para el plugin filter. * */ jQuery.fn.rup_table.plugins.multifilter = {}; jQuery.fn.rup_table.plugins.multifilter.defaults = { multifilter : {} }; })(jQuery); × Search results Close "},"rup_table_rup.table.report.js.html":{"id":"rup_table_rup.table.report.js.html","title":"Source: rup_table/rup.table.report.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.report.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ (function ($) { /** * Definición de los métodos principales que configuran la inicialización del plugin. * * postConfiguration: Método que se ejecuta después de la invocación del componente jqGrid. * */ jQuery.rup_table.registerPlugin(&quot;report&quot;,{ loadOrder:11, preConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;preConfigureReport&quot;, settings); }, postConfiguration: function(settings){ var $self = this; return $self.rup_table(&quot;postConfigureReport&quot;, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Extensión del componente rup_table para permitir la gestión de la generaciónd de informes. * * Los métodos implementados son: * * preConfigureReport(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. * * postConfigureReport(settings): Método que define la preconfiguración necesaria para el correcto funcionamiento del componente. */ jQuery.fn.rup_table(&quot;extend&quot;,{ preConfigureReport: function(settings){ var $self = this; }, postConfigureReport: function(settings){ var $self = this, colModel = $self.rup_table(&quot;getColModel&quot;), reportsColums, reportSettings = settings.report; reportsColums = $self._getReportColumns(colModel, settings); /* * INICIALIZACION DE VALORES POR DEFECTO */ // Inicialización de la toolbar del componente table en caso de que no se especifique if (reportSettings.appendTo===undefined){ reportSettings.appendTo = settings.toolbar.id; } // Se toman los parámetros columns globales como base para los específicos jQuery.each(reportSettings.buttons[0].buttons, function(index, element){ element.columns = $.extend(true, {}, reportSettings.columns, element.columns); if (element.columns.grid===undefined){ element.columns.grid = settings.id; } if (element.columns.customNames===undefined){ element.columns.customNames = reportsColums; } if (element.columns.click===undefined){ element.columns.click = function(){}; } }); reportSettings.fncGetGridParam = function(){ var $self = this, settings = $self.data(&quot;settings&quot;), data={}, filterData = {}; jQuery.each($self.jqGrid(&quot;getGridParam&quot;, &quot;postData&quot;), function(index, elem){ if (jQuery.inArray(index, settings.report.sendPostDataParams)!==-1){ data[index] = elem; } }); if (settings.filter !== undefined &amp;&amp; settings.filter.$filterContainer!== undefined){ filterData = $self.rup_table(&quot;getFilterParams&quot;); } jQuery.extend(true, data, filterData); $self.triggerHandler(&quot;rupTable_serializeReportData&quot;, [data]); return $.rup_utils.unnestjson(data); }; /* * FIN DE INICIALIZACION DE VALORES POR DEFECTO */ jQuery.rup_report(reportSettings); } }); jQuery.fn.rup_table(&quot;extend&quot;,{ _getReportColumns: function(colModel, settings){ return jQuery.map(colModel, function(elem, index){ if (jQuery.inArray(elem.name, settings.report.excludeColumns) === -1){ return elem.name; }else{ return null; } }); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Parámetros de configuración por defecto para el plugin report. * */ jQuery.fn.rup_table.plugins.report = {}; jQuery.fn.rup_table.plugins.report.defaults = { report:{ columns:{}, excludeColumns:['rupInfoCol','cb'], sendPostDataParams: [&quot;_search&quot;,&quot;core&quot;,&quot;nd&quot;,&quot;page&quot;,&quot;rows&quot;,&quot;sidx&quot;,&quot;sord&quot;] } }; })(jQuery); × Search results Close "},"rup.accordion.js.html":{"id":"rup.accordion.js.html","title":"Source: rup.accordion.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.accordion.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Accordion. * @author EJIE * @version 2.4.10 */ (function ($) { //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Tiene como objetivo presentar un contenido donde conceptos relacionados pueden agruparse (ej. secciones) de manera que el usuario puede mostrar u ocultar información sin perder el contexto del contenido principal. * * @summary Componente RUP Accordion. * @namespace jQuery.rup_accordion * @memberOf jQuery * @tutorial rup_accordion * @example * $(&quot;.rup_accordion&quot;).rup_accordion({ * animated: &quot;bounceslide&quot;, * active: false, * autoHeight: false, * collapsible: true * }); */ var rup_accordion = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_accordion&quot;, rup_accordion)); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** $.fn.rup_accordion(&quot;extend&quot;,{ /** * Elimina completamente la funcionalidad del Accordion. Como resultado, se devuelven los objetos html, tal y como estaban, antes de aplicar el componente Accordion. * * @name jQuery.rup_accordion#destroy * @function * @example * $(&quot;#idAccordion&quot;).rup_accordion(&quot;destroy&quot;); */ destroy : function(){ $(this).removeData(&quot;settings&quot;); $(this).accordion(&quot;destroy&quot;); }, /** * Deshabilita el componente Accordion. * * @name jQuery.rup_accordion#disable * @function * @example * $(&quot;#idAccordion&quot;).rup_accordion(&quot;disable&quot;); */ disable : function(){ $(this).accordion(&quot;disable&quot;); }, /** * Habilita el componente Accordion. * * @name jQuery.rup_accordion#enable * @function * @example * $(&quot;#idAccordion&quot;).rup_accordion(&quot;enable&quot;); */ enable : function(){ $(this).accordion(&quot;enable&quot;); }, /** * Dependiendo de si se informa un valor asociado a una parámetro o se introduce un json con relaciones variable-valor o no se pasan parámetros asociados a la opción especificada, la función asigna el nuevo valor al parámetro asociado o asigna el nuevo conjunto de valores a los parámetros asociados o devuelve el valor actual del parámetro especificado (actuando como un get), respectivamente.. * * @name jQuery.rup_accordion#option * @function * @param {String | Object} opt - Nombre de la propiedad u objeto con varias propiedades. * @param {*} [value] - Valor a asignar a la propiedad especificada por su nombre en el primer parámetro. * @example * // Asignar el valor &quot;bounceslide&quot; a la propiedad &quot;animated&quot; * $(&quot;#idAccordion&quot;).rup_accordion(&quot;option&quot;, &quot;animated&quot;, &quot;bounceslide&quot;); * // Se asignan valores a varias propiedades por medio de un objeto json. * $(&quot;#idAccordion&quot;).rup_accordion(&quot;option&quot;,{active: false, collapsible : true}); * // Se recupera el valor de la propiedad &quot;animated&quot; * $(&quot;#idAccordion&quot;).rup_accordion(&quot;option&quot;, &quot;animated&quot;); */ option : function(opt, value){//Se establecen la propiedad o propiedades que reciben como parametro y se leen las que no vienen con una asignación. if (value !== undefined){ $(this).accordion(&quot;option&quot;, opt, value); } else { if (opt !== undefined){ return $(this).accordion(&quot;option&quot;, opt); }else{ return $(this).accordion(&quot;option&quot;); } } }, /** * Devuelve el elemento .ui-accordion:. * * @name jQuery.rup_accordion#widget * @function * @returns {object} - Objeto jQuery que contiene el accordion. * @example * $(&quot;#idAccordion&quot;).rup_accordion(&quot;widget&quot;); */ widget : function(){ return $(this).accordion(&quot;widget&quot;); }, /** * Activación programática de la sección especificada por parámetro. * * @name jQuery.rup_accordion#activate * @function * @param {number | object | boolean} - Valor numérico diferente de cero que indique la sección seleccionada o un selector que determine el elemento activado. En caso de tener el collapsible activado, es posible pasar el valor false para que se cierren todas las secciones. * @example * // Activar la seción tercera. * $(&quot;#idAccordion&quot;).rup_accordion(&quot;activate&quot;, 3); * // Activar la seción identificada con el selector seccion3. * $(&quot;#idAccordion&quot;).rup_accordion(&quot;activate&quot;, &quot;#seccion3&quot;); * // Colapsar todas las secciones. * $(&quot;#idAccordion&quot;).rup_accordion(&quot;activate&quot;, false); */ activate : function(index){ $(this).accordion(&quot;activate&quot;,index); }, /** * La función provoca el reajuste de los height (tamaño vertical) de las distintas secciones del Accordion. La ejecución de esta función solo tiene sentido si la opción fillSpace está activada y el height del contenedor cambia. * * @name jQuery.rup_accordion#resize * @function * @deprecated desde la version 2.5.0. Utilizar en su lugar el método refresh. * @example * $(&quot;#idAccordion&quot;).rup_accordion(&quot;resize&quot;); */ resize : function(){ $(this).accordion(&quot;resize&quot;); } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** $.fn.rup_accordion(&quot;extend&quot;, { _init : function(args) { if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18n.base.rup_global.initError + $(this).attr(&quot;id&quot;)); } else { var elements = this.children(), elementsNum = (elements.length)/2, settings = $.extend({}, $.fn.rup_accordion.defaults, args[0]); //Se recogen y cruzan las paremetrizaciones del objeto //Se tapa la creación del accordion para evitar visualizaciones inapropiadas //Se recomienda que el componente, inicialmente, sea invisible. Para ello se dispone del estilo rup_accordion this.removeClass(&quot;rup_accordion&quot;); //Se almacenan los settings en el data del objeto this.data(&quot;settings&quot;,settings); //Se sobreescribe uno de los eventos para hacer reaparecer, una vez creado, el accordion createUserEvent = settings.create; settings.create = function (event, ui) { if (createUserEvent !== undefined) { if (createUserEvent(event, ui) === false) { return false; } } //Comportamiento por defecto del evento create_default(event, ui); }; function create_default(event, ui){ $(event.target).addClass(&quot;rup_accordion_create&quot;); } //Se comprueba la corrección del html con el que se creara el accordion if(settings.validation){ if(parseInt(elementsNum) !== elementsNum){ $.rup.errorGestor($.rup.i18n.base.rup_accordion.strucPairError); return false; } else { elements.each(function(index,object){ if ((parseInt(index/2) === index/2) &amp;&amp; ($(object).find(&quot;a&quot;).length === 0)){ $.rup.errorGestor($.rup.i18n.base.rup_accordion.headFormatError); return false; } }); } } //Se invoca la creacion del accordion this.accordion(settings); } } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * @description Opciones por defecto de configuración del componente. * * @name jQuery.rup_accordion#defaults * * @property {boolean} [validation=true] - Parámetro de configuración que determina la aplicación de la validación estructural asociada a las necesidades estructurales del Accordion. */ $.fn.rup_accordion.defaults = { validation: true }; })(jQuery); × Search results Close "},"rup.autocomplete.js.html":{"id":"rup.autocomplete.js.html","title":"Source: rup.autocomplete.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.autocomplete.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Autocomplete. * @author EJIE * @version 2.4.10 */ (function ($) { //**************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //**************************************************************************************************************** /** * Permite al usuario recuperar un elemento de una gran lista de elementos o de varias listas dependientes de forma sencilla y ocupando poco espacio en la interfaz. * * @summary Componente RUP Autocomplete. * @namespace jQuery.rup_autocomplete * @memberOf jQuery * @tutorial rup_autocomplete * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete({ * source : &quot;autocomplete/remote&quot;, * sourceParam : {label:&quot;desc&quot;+$.rup_utils.capitalizedLang(), value:&quot;code&quot;} * }); */ var rup_autocomplete = {}; $.extend( $.ui.autocomplete.prototype, { _renderMenu: function(ul, items ){ var settings =this.options; if (settings.category){ //categorización de los resultados var that = this, currentCategory = &quot;&quot;; $.each( items, function( index, item ) { var li; if ( item.category != currentCategory ) { ul.append( &quot;&lt;li class='ui-autocomplete-category'&gt;&quot; + item.category + &quot;&lt;/li&gt;&quot; ); currentCategory = item.category; } li = that._renderItem( ul, item ); if ( item.category ) { li.attr( &quot;aria-label&quot;, item.category + &quot; : &quot; + item.label ); } }); } else{ var self = this; $.each( items, function( index, item ) { self._renderItem( ul, item ); }); } } }); //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_autocomplete&quot;, rup_autocomplete)); //******************************* // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************* $.fn.rup_autocomplete(&quot;extend&quot;,{ /** * Método utilizado para obtener el valor del componente. Este método es el utilizado por el resto de componentes RUP para estandarizar la obtención del valor del Autocomplete. * * @name jQuery.rup_autocomplete#getRupValue * @function * @return {string | number} - Devuelve el valor actual del componente seleccionado por el usuario. * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;getRupValue&quot;); */ getRupValue : function(){ return $(this).val(); }, /** * Método utilizado para asignar el valor al componente. Este método es el utilizado por el resto de componentes RUP para estandarizar la asignación del valor al Autocomplete. * * @name jQuery.rup_autocomplete#setRupValue * @function * @param {string | number} param - Valor que se va a asignar al componente. * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;setRupValue&quot;, &quot;Si&quot;); */ setRupValue : function(value){ var $self = this, data = $self.data(&quot;rup.autocomplete&quot;), $hidden, loadObjects, newObject = {}; if(data){ // Comprobamos si tiene la referencia al campo hidden if (data.$hiddenField){ data.$hiddenField.attr(&quot;rup_autocomplete_label&quot;,value); loadObjects = $self.data(&quot;loadObjects&quot;); newObject[value]=data.$hiddenField.val(); $self.data(&quot;loadObjects&quot;, jQuery.extend(true, {}, loadObjects, newObject)); } if (data.$labelField){ loadObjects = data.$labelField.data(&quot;loadObjects&quot;); newObject[$self.attr(&quot;rup_autocomplete_label&quot;)]=value; data.$labelField.data(&quot;loadObjects&quot;, jQuery.extend(true, {}, loadObjects, newObject)); } } $(this).val(value); }, /** * Elimina el autocomplete. * * @name jQuery.rup_autocomplete#destroy * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;destroy&quot;); */ destroy:function(){ var self; if ($(this).attr(&quot;id&quot;).indexOf(&quot;_label&quot;) &gt;= 0){ self = $(this); } else { self = $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;_label&quot;); } self.autocomplete(&quot;destroy&quot;); }, /** * Deshabilita el autocomplete (solo la parte de sugerencias, el input sigue habilitado). * * @name jQuery.rup_autocomplete#off * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;off&quot;); */ off:function(){ var self; if ($(this).attr(&quot;id&quot;).indexOf(&quot;_label&quot;) &gt;= 0){ self = $(this); } else { self = $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;_label&quot;); } self.storeEvents(); }, /** * Habilita el autocomplete (solo la parte de sugerencias). * * @name jQuery.rup_autocomplete#on * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;on&quot;); */ on:function(){ var self; if ($(this).attr(&quot;id&quot;).indexOf(&quot;_label&quot;) &gt;= 0){ self = $(this); } else { self = $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;_label&quot;); } self.restoreEvents(); }, /** * Deshabilita el autocomplete. Internamente invoca al método {@link jQuery.rup_autocomplete#off}. * * @name jQuery.rup_autocomplete#disable * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;disable&quot;); */ disable:function(){ var self, settings; if ($(this).attr(&quot;id&quot;).indexOf(&quot;_label&quot;) &gt;= 0){ self = $(this); } else { self = $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;_label&quot;); } settings = self.data(&quot;settings&quot;); if (settings.combobox){ settings.$comboboxToogle.button(&quot;disable&quot;) } self.attr(&quot;disabled&quot;,&quot;disabled&quot;); }, /** * Habilita el autocomplete. Internamente invoca al método {@link jQuery.rup_autocomplete#on}. * * @name jQuery.rup_autocomplete#enable * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;enable&quot;); */ enable:function(){ var self, settings; if ($(this).attr(&quot;id&quot;).indexOf(&quot;_label&quot;) &gt;= 0){ self = $(this); } else { self = $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;_label&quot;); } settings = self.data(&quot;settings&quot;); if (settings.combobox){ settings.$comboboxToogle.button(&quot;enable&quot;) } self.removeAttr(&quot;disabled&quot;); }, /** * Permite consultar y modificar la configuración del componente. * * @name jQuery.rup_autocomplete#option * @param {string | object} optionName - Nombre de la propiedad que se desea gestionar o objeto de compuesto de varias propiedades. * @param {*} [value] - Corresponde al valor de la propiedad en caso de haberse especificado el nombre de la misma en el primér parámetro. * @param {*} aux - Parámetro extra de confirguración para la propiedad &quot;source&quot;. * @function * @example * // Establecer una propiedad * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;option&quot;, &quot;minLegth&quot;, 2); * // Establecer varias propiedad * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;option&quot;, {minLegth:2, delay:1000}); */ option: function (optionName, value, aux){ var self; if ($(this).attr(&quot;id&quot;).indexOf(&quot;_label&quot;) &gt;= 0){ self = $(this); } else { self = $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;_label&quot;); } var settings = self.data(&quot;settings&quot;); if (optionName === &quot;source&quot;){ if (typeof value === &quot;object&quot;){ //LOCAL if (aux !== undefined){ settings.i18nId = aux; } else { settings.i18nId = settings.id ; } self.autocomplete(&quot;option&quot; , optionName , this._sourceLOCAL); self.autocomplete(&quot;option&quot; , &quot;minLength&quot; , settings.minLength !== undefined?settings.minLength:0); } else { if (aux !== undefined){ if (optionName==&quot;data&quot;){ self.autocomplete(&quot;option&quot; , &quot;data&quot; , aux); }else{ //REMOTO settings.sourceParam = aux; //Nos aseguramos que el número mínimo de teclas para búsquedas sea 3 self.autocomplete(&quot;option&quot; , optionName , this._sourceREMOTE); self.autocomplete(&quot;option&quot; , &quot;minLength&quot; , settings.minLength&gt;3?settings.minLength:3); } } else { return undefined; } } settings.data = value; self.data(&quot;settings&quot;,settings); } else { settings[optionName] = value; self.data(&quot;settings&quot;,settings); self.autocomplete(&quot;option&quot; , optionName , value); } }, /** * Lanza una búsqueda en el autocomplete con el parámetro indicado y el foco va a parar al input. * * @name jQuery.rup_autocomplete#search * @param {string} term - Cadena de texto utilizada para realizar la búsqueda. * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;search&quot;, &quot;java&quot;); */ search: function(term){ //Si tiene eventos (no está deshabilitado) se hace búsqueda if ($._data($(this)[0], &quot;events&quot;) !== undefined){ $(this).focus(); $(this).val(term); $(this).autocomplete(&quot;search&quot;,term); } }, /** * Oculta el autocomplete. * * @name jQuery.rup_autocomplete#close * @function * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;close&quot;); */ close:function(){ $(this).autocomplete(&quot;close&quot;); }, /** * Devuelve el valor del autocomplete. Este es el valor que se guarda en el campo oculto antes descrito al final del apartado 7.Para obtener la descripción (dato que se muestra en el input) se invocará a la función estándar de jQuery. * * @name jQuery.rup_autocomplete#val * @function * @example * // Recuperar el valor * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;val&quot;); * // Recuperar la descripción * $(&quot;#idAutocomplete&quot;).val(); */ val:function(){ return $(&quot;#&quot;+$(this).attr(&quot;id&quot;)).val(); }, /** * Método utilizado para asignar el valor y el literal al componente. El valor se almacena en el campo hidden creado por el componente. El contenido indicado en la propiedad label se mostrará en el campo input del componente. * * @name jQuery.rup_autocomplete#set * @function * @param {string | number} value - Valor que se va a almacenar en el campo hidden y que se corresponde con el value seleccionado. * @param {string} label - Texto que se va a mostrar en el campo de texto del componente. * @example * $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;set&quot;, &quot;48&quot;, &quot;Bizkaia&quot;); */ set:function(value, label){ var $self = $(this), $selfLabel = jQuery(&quot;[id='&quot;+$self.attr(&quot;id&quot;)+&quot;_label']&quot;), loadObjects, newObject={}; $self.val(value); $self.attr(&quot;rup_autocomplete_label&quot;,label); $selfLabel.val(label); loadObjects = $selfLabel.data(&quot;loadObjects&quot;); newObject[label]=value; $selfLabel.data(&quot;loadObjects&quot;, jQuery.extend(true, {}, loadObjects, newObject)); } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* $.fn.rup_autocomplete(&quot;extend&quot;, { /** * Procesa los elementos recibidos en la respuesta de la petición de búsqueda realizada. * * @name jQuery.rup_autocomplete#_parseResponse * @function * @private * @param {string} term - Cadena de texto empleada para realizar la búsqueda. * @param {string} label - Texto a mostrar del elemento enviado en la respuesta. * @param {string | number} value - Valor del elemento enviado en la respuesta. * @param {string} [category] - Texto identificador de la categoría del elemento en el caso de que exista. */ _parseResponse : function(term, label, value, category) { if (category===undefined){ return { label: label.replace( new RegExp(&quot;(?![^&amp;;]+;)(?!&lt;[^&lt;&gt;]*)(&quot; +$.ui.autocomplete.escapeRegex(term) + &quot;)(?![^&lt;&gt;]*&gt;)(?![^&amp;;]+;)&quot;, &quot;gi&quot;), &quot;&lt;strong&gt;$1&lt;/strong&gt;&quot; ), value: value }; }else{ return { label: label.replace( new RegExp(&quot;(?![^&amp;;]+;)(?!&lt;[^&lt;&gt;]*)(&quot; +$.ui.autocomplete.escapeRegex(term) + &quot;)(?![^&lt;&gt;]*&gt;)(?![^&amp;;]+;)&quot;, &quot;gi&quot;), &quot;&lt;strong&gt;$1&lt;/strong&gt;&quot; ), value: value, category: category }; } }, /** * Procesa la respuesta a partir de una petición de búsqueda sobre una fuente de datos local. * * @name jQuery.rup_autocomplete#_sourceLOCAL * @function * @private * @param {object} request - Objeto que contiene la petición de búsqueda. * @param {object} response - Objeto que contiene la respuesta a partir de la fuente de datos local. */ _sourceLOCAL : function (request, response) { var settings, loadObjects = {}, returnValue, stock; if (this.element.data(&quot;settings&quot;) !== undefined){ settings = this.element.data(&quot;settings&quot;); }else{ settings = this.options; } if (settings.loadObjects !== undefined){ stock = settings.loadObjects; } else { stock = settings.id; } var matcher = settings.contains?$.ui.autocomplete.escapeRegex(request.term):&quot;^&quot; +$.ui.autocomplete.escapeRegex(request.term), json_i18n = $.rup.i18n.app[settings.i18nId]; matcher = new RegExp(matcher, &quot;i&quot;); data = $.map(settings.data,function(item) { var label=item, value=item, category; if (typeof item === &quot;object&quot;){ //multi-idioma if(item[&quot;i18nCaption&quot;] !== undefined){ label = $.rup.i18nParse(json_i18n,item[&quot;i18nCaption&quot;]); } else if (item[&quot;label&quot;] !== undefined){ label = item[&quot;label&quot;]; } else { label = item[&quot;value&quot;]; } value = item[&quot;value&quot;]; if (settings.category) category=item[&quot;category&quot;]; } if (!request.term || matcher.test(label)) { if (settings.category) returnValue = settings._parseResponse(request.term, label, value, category); else returnValue = settings._parseResponse(request.term, label, value); loadObjects[returnValue.label.replace(/&lt;strong&gt;/g,&quot;&quot;).replace(/&lt;\\/strong&gt;/g,&quot;&quot;)] = returnValue.value ; return returnValue; }; }); //Se almacenan los datos cargados $(&quot;#&quot;+stock).data(&quot;loadObjects&quot;,loadObjects); //Eliminar elementos vacíos data = $.grep(data, function(value) { return value != undefined; }); response(data); }, /** * Procesa la respuesta a partir de una petición de búsqueda sobre una fuente de datos remota. * * @name jQuery.rup_autocomplete#_sourceREMOTE * @function * @private * @param {object} request - Objeto que contiene la petición de búsqueda. * @param {object} response - Objeto que contiene la respuesta a partir de la fuente de datos remota. */ _sourceREMOTE : function (request, response){ //Se escapan los comodines/wildcards de BD var $self = this.element ,settings, loadObjects = {}, returnValue, stock, term, data, lastTerm, bckData, $stock; if (this.element.data(&quot;settings&quot;) !== undefined){ settings = this.element.data(&quot;settings&quot;); }else{ settings = this.options; } if (settings.loadObjects !== undefined){ stock = settings.loadObjects; } else { stock = settings.id; } $stock = jQuery(&quot;#&quot;+stock); term = request.term.replace(/%/g,&quot;\\\\%&quot;).replace(/_/g,&quot;\\\\_&quot;); data = $.extend({q:term,c:this.options.contains},this.options.extraParams); // Comprobar si se puede cachear lastTerm = $stock.data(&quot;tmp.loadObjects.term&quot;); if (term.indexOf(lastTerm)===0){ $stock.data(&quot;tmp.loadObjects.term&quot;,term); bckData = settings.data; settings.data = $stock.data(&quot;tmp.data&quot;); jQuery.proxy(settings.$self._sourceLOCAL, this, request, response)(); settings.data = bckData; }else{ $.rup_ajax({ url: settings.data, data : data, dataType: 'json', contentType: 'application/json', //Cabecera RUP beforeSend: function (xhr){ //LOADING... $(&quot;#&quot;+settings.id+&quot;_label&quot;).addClass(&quot;rup-autocomplete_loading&quot;); xhr.setRequestHeader(&quot;RUP&quot;, $.toJSON(settings.sourceParam)); }, success: function(data) { $self.triggerHandler(&quot;rupAutocomplete_beforeLoadComplete&quot;, [data]); //Si no hay datos en el autocomplete que se cierre if (data.length==0){ jQuery(&quot;#&quot;+settings.id+&quot;_label&quot;).autocomplete(&quot;close&quot;); return null; } response($.map(data, function(item) { if (settings.category==true) returnValue = settings._parseResponse(request.term, item[&quot;label&quot;], item[&quot;value&quot;], item[&quot;category&quot;]); else returnValue = settings._parseResponse(request.term, item[&quot;label&quot;], item[&quot;value&quot;]); loadObjects[returnValue.label.replace(/&lt;strong&gt;/g,&quot;&quot;).replace(/&lt;\\/strong&gt;/g,&quot;&quot;)] = returnValue.value ; return returnValue; })); //se almacenan los datos cargados $stock.data(&quot;loadObjects&quot;,loadObjects); $stock.data(&quot;tmp.loadObjects.term&quot;,term); $stock.data(&quot;tmp.data&quot;,data); $self.triggerHandler(&quot;rupAutocomplete_loadComplete&quot;, [data]); }, error: function (xhr, textStatus, errorThrown){ if (settings.onLoadError!==null &amp;&amp; typeof settings.onLoadError === &quot;function&quot;){ jQuery(settings.onLoadError(xhr, textStatus, errorThrown)); }else{ $.rup.showErrorToUser($.rup.i18n.base.rup_autocomplete.ajaxError); } }, complete: function(xhr, textStatus) { //UNLOADING... $(&quot;#&quot;+settings.id+&quot;_label&quot;).removeClass(&quot;rup-autocomplete_loading&quot;); } }); } }, /** * Función encargada de crear el control encargado de mostrar todos los resultados cuando el componente tiene activado el modo de funcionamiento combobox. * * @name jQuery.rup_autocomplete#_createShowAllButton * @function * @private */ _createShowAllButton : function(settings) { var input = this, wasOpen = false; input.wrap(jQuery(&quot;&lt;span&gt;&quot;).addClass(&quot;rup-combobox&quot;)); var $wrapper = input.parent(); var $button = $(&quot;&lt;a&gt;&quot;).attr(&quot;tabIndex&quot;, -1).attr(&quot;title&quot;, $.rup.i18n.base.rup_autocomplete.showAllItems).rup_tooltip().rup_button({ icons : { primary : &quot;ui-icon-triangle-1-s&quot; }, text : false }).removeClass(&quot;ui-corner-all&quot;).addClass( &quot;rup-combobox-toggle ui-corner-right&quot;) .mousedown( function() { wasOpen = input.autocomplete( &quot;widget&quot;) .is(&quot;:visible&quot;); }).click(function() { input.focus(); // Close if already visible if (wasOpen) { return true; } // Pass empty string as value to search // for, displaying all results input.autocomplete(&quot;search&quot;, &quot;&quot;); }); $button.appendTo($wrapper); settings.$comboboxToogle = $button; }, /** * Método de inicialización del componente. * * @name jQuery.rup_autocomplete#_init * @function * @private */ _init : function(args){ if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.initError&quot;) + $(this).attr(&quot;id&quot;)); } else { //Se recogen y cruzan las paremetrizaciones del objeto var $self = $(this), settings = $.extend({}, $.fn.rup_autocomplete.defaults, args[0]), name = $(this).attr(&quot;name&quot;), selected_value; $(this).attr(&quot;ruptype&quot;,&quot;autocomplete&quot;); //Recopilar datos necesarios settings.id = $(this).attr(&quot;id&quot;); settings.loadObjects = settings.id; settings.data = settings.source; //Guardar los datos en &quot;data&quot; ya que source la emplea autocomplete internamente settings._parseResponse = this._parseResponse; //Guardar referencia a rup.autocomplete para invocar las funciones privadas settings._sourceLOCAL = this._sourceLOCAL; //Guardar referencia a rup.autocomplete para invocar las funciones privadas settings.$self = this; //Guardar referencia a rup.autocomplete para invocar las funciones privadas //Guardar valor del INPUT settings.loadValue = $(&quot;#&quot;+settings.id).attr('value'); //Si no se recibe identificador para el acceso a literales se usa el ID del objeto if (!settings.i18nId){ settings.i18nId = settings.id; } //Eventos //******* //Guardar referencia settings._change = settings.change; settings._select = settings.select; settings._focus = settings.focus; //Sobrecargar tratamiento settings.change = function(event, ui) { if(selected_value != null){//Puede que se ejecute este evento sin ejecutarse el select. Con esta condición nos aseguramos $(&quot;#&quot;+event.target.id).val(selected_value); $(&quot;#&quot;+event.target.id).focus(); } selected_value = null; if (settings._change!==undefined){settings._change(event,ui);} $self.triggerHandler('rupAutocomplete_change'); }; settings.select = function(event, ui) { selected_value = ui.item[&quot;label&quot;].replace(/&lt;strong&gt;/g,&quot;&quot;).replace(/&lt;\\/strong&gt;/g,&quot;&quot;); if (settings._select!==undefined){settings._select(event, ui);} $(&quot;#&quot;+settings.id).attr(&quot;rup_autocomplete_label&quot;,selected_value); $(&quot;#&quot;+settings.id).data(&quot;selected&quot;,true); $self.triggerHandler(&quot;rupAutocomplete_select&quot;, [ui]); }; settings.focus = function(event, ui) { $(&quot;#&quot;+event.target.id).val(ui.item[&quot;label&quot;].replace(/&lt;strong&gt;/g,&quot;&quot;).replace(/&lt;\\/strong&gt;/g,&quot;&quot;)); if (settings._focus!==undefined){settings._focus(event, ui);} return false; //Evitar acciones jquery.autocomplete.js }; //Generación de campo oculto para almacenar 'value' (en el input definido se guarda el 'label') var $hidden = $(&quot;&lt;input&gt;&quot;).attr({ type:&quot;hidden&quot;, id: settings.id+&quot;_value&quot;, name: (settings.valueName===null?name:settings.valueName), ruptype:&quot;autocomplete&quot; }); $(&quot;#&quot;+settings.id).after($hidden) .attr(&quot;name&quot;, (settings.labelName===null?name+&quot;_label&quot;:settings.labelName)) .addClass(&quot;rup-autocomplete_label&quot;); // settings.$hidden = $hidden; if (typeof settings.source === &quot;object&quot;){ //LOCAL settings.source = this._sourceLOCAL; } else { //REMOTO //Nos aseguramos que el número mínimo de teclas para búsquedas sea 3 settings.minLength = settings.minLength&gt;3?settings.minLength:3; settings.source = this._sourceREMOTE; } //Se prepara el almacenaje de datos $(&quot;#&quot;+settings.id).data(&quot;loadObjects&quot;,{}); if (settings.combobox===true){ $(&quot;#&quot;+settings.id).addClass(&quot;rup-combobox-input ui-corner-left&quot;); settings.minLength = 0; } jQuery(settings.appendTo).addClass(&quot;ui-front&quot;); //Invocación al componente subyacente jQuery(&quot;#&quot;+settings.id).autocomplete(settings); //Se anyade un id al menu desplegable del autocomplete settings.$menu = jQuery(&quot;#&quot;+settings.id).data(&quot;autocomplete&quot;).menu.element.attr(&quot;id&quot;,settings.id+&quot;_menu&quot;); //override mousedown para corregir el fallo del scrollbar en IE (bug 5610) settings.$menu.off(&quot;mousedown&quot;); // prevent the close-on-blur in case of a &quot;slow&quot; click on the menu (long mousedown) y corrección del bug 5610 (scrollbar en IE) settings.$menu.on(&quot;mousedown&quot;,function(event) { var menuElement =jQuery(&quot;#&quot;+settings.id+&quot;_menu&quot;)[0]; if ( !$( event.target ).closest( &quot;.ui-menu-item&quot; ).length ) { setTimeout(function() { $( document ).one( 'mousedown', function( event ) { if ( event.target !== jQuery(&quot;#&quot;+settings.id+&quot;_label&quot;) &amp;&amp; event.target !== menuElement &amp;&amp; !$.ui.contains( menuElement, event.target ) ) { jQuery(&quot;#&quot;+settings.id+&quot;_label&quot;).autocomplete(&quot;close&quot;); } }); }, 1 ); }else{ $(&quot;#&quot;+settings.id+&quot;_label&quot;).triggerHandler(&quot;blur&quot;); } // use another timeout to make sure the blur-event-handler on the input was already triggered setTimeout(function() { clearTimeout($(&quot;#&quot;+settings.id+&quot;_label&quot;).data(&quot;autocomplete&quot;).closing ); }, 13); }) if (settings.combobox===true){ this._createShowAllButton(settings); } // Altura del menu desplegable if (settings.menuMaxHeight!==false){ jQuery(&quot;#&quot;+settings.id).on(&quot;autocompleteopen&quot;,function(){ settings.$menu.css(&quot;overflow-y&quot;,&quot;auto&quot;) .css(&quot;overflow-x&quot;,&quot;hidden&quot;) .css(&quot;max-height&quot;,settings.menuMaxHeight) .css(&quot;width&quot;,jQuery('#'+settings.id+&quot;_label&quot;).innerWidth()); }); } //Buscar el UL del autocomplete y colocarlo tras el elemento sobre el que debe ir //$(&quot;#&quot;+settings.id).after($(&quot;body &gt; .ui-autocomplete&quot;)); //Buscar el UL del autocomplete y colocarlo tras el elemento sobre el que debe ir if (settings.menuAppendTo!==null){ if (jQuery(settings.menuAppendTo).length===0){ alert(&quot;Es necesario especificar un selector válido para la propiedad menuAppendTo&quot;); }else{ jQuery(settings.menuAppendTo).append(settings.$menu); } }else{ if($.rup_utils.aplicatioInPortal()){ // $(&quot;div.r01gContainer&quot;).append($(&quot;body &gt; .ui-autocomplete&quot;)); $(&quot;div.r01gContainer&quot;).append(settings.$menu); } } //Valor por defecto if (settings.defaultValue) { $(&quot;#&quot;+settings.id).rup_autocomplete(&quot;search&quot;, settings.defaultValue); } //Valor pre-cargado if(settings.loadValue) { $(&quot;#&quot;+settings.id).val(settings.loadValue); $(&quot;#&quot;+settings.id+&quot;_value&quot;).val(settings.loadValue); } // Modificar identificadores settings.loadObjects = settings.id+&quot;_label&quot;; $(&quot;#&quot;+settings.id).attr(&quot;id&quot;, settings.id+&quot;_label&quot;); $(&quot;#&quot;+settings.id+&quot;_value&quot;).attr(&quot;id&quot;, settings.id); //eventos internos de borrado y perdida de foco $(&quot;#&quot;+settings.id+&quot;_menu&quot;).on('mousedown',function (event){ var selected = $(&quot;#&quot;+settings.id).data(&quot;selected&quot;), isShowingMenu = $(&quot;.ui-autocomplete:visible&quot;).length&gt;0?true:false; if(!selected &amp;&amp; isShowingMenu){ $(&quot;#&quot;+settings.id).data(&quot;ieIssueScrollVisible&quot;,true); event.preventDefault(); } }); $(&quot;#&quot;+settings.id+&quot;_label&quot;).bind(&quot;keydown&quot;, function(event){ $(&quot;#&quot;+settings.id).data(&quot;ieIssueScrollVisible&quot;,false); }); $(&quot;#&quot;+settings.id+&quot;_label&quot;).bind(&quot;blur&quot;, function(event){ //Obtener datos de si viene de seleccionar elemento o si el menú de selección está desplegado var selected = $(&quot;#&quot;+settings.id).data(&quot;selected&quot;), isShowingMenu = $(&quot;.ui-autocomplete:visible&quot;).length&gt;0?true:false; //Borrar índicador de que viene de seleccionar elemento $(&quot;#&quot;+settings.id).data(&quot;selected&quot;,false); //Si es un evento de teclado pero no es ENTER, omitir esta función if (event.type===&quot;keydown&quot; &amp;&amp; event.keyCode!==13){return true;} if ($(&quot;#&quot;+settings.id).data(&quot;ieIssueScrollVisible&quot;)===true) { $(&quot;#&quot;+settings.id).focus(); event.stopPropagation(); $(&quot;#&quot;+settings.id).data(&quot;ieIssueScrollVisible&quot;,false); return true; } var autoCompObject = $(event.currentTarget), loadObjects = $(&quot;#&quot;+settings.loadObjects).data(&quot;loadObjects&quot;); if (settings.getText==true){ if(loadObjects[autoCompObject.val()] !== undefined){ $(&quot;#&quot;+settings.id).val(autoCompObject.val()); $(&quot;#&quot;+settings.id).attr(&quot;rup_autocomplete_label&quot;,autoCompObject.val()); } else { $(&quot;#&quot;+settings.id).val(autoCompObject.val()); $(&quot;#&quot;+settings.id).attr(&quot;rup_autocomplete_label&quot;,autoCompObject.val()); } }else{ if(loadObjects[autoCompObject.val()] !== undefined){ $(&quot;#&quot;+settings.id).val(loadObjects[autoCompObject.val()]); $(&quot;#&quot;+settings.id).attr(&quot;rup_autocomplete_label&quot;,loadObjects[autoCompObject.val()]); } else { $(&quot;#&quot;+settings.id).val(&quot;&quot;); $(&quot;#&quot;+settings.id).attr(&quot;rup_autocomplete_label&quot;,&quot;&quot;); autoCompObject.val(&quot;&quot;); autoCompObject.autocomplete(&quot;close&quot;); } } //Si el evento es ENTER y viene de seleccionar un elemento o el menú se estaba mostrando, omitir resto de funciones (ej. buscar) if (event.type===&quot;keydown&quot; &amp;&amp; event.keyCode===13 &amp;&amp; (selected || isShowingMenu)){return false;} }); //se guarda la configuracion general (settings) del componente $(&quot;#&quot;+settings.id+&quot;_label&quot;).data(&quot;settings&quot;,settings); $(&quot;#&quot;+settings.id+&quot;_label&quot;).data(&quot;rup.autocomplete&quot;,{ $hiddenField: $(&quot;#&quot;+settings.id) }); $(&quot;#&quot;+settings.id).data(&quot;rup.autocomplete&quot;,{ $labelField: $(&quot;#&quot;+settings.id+&quot;_label&quot;) }); //Deshabilitar if (settings.disabled===true) { $(&quot;#&quot;+settings.id).rup_autocomplete(&quot;disable&quot;); }else if (settings.disabled===false){ //habilitar $(&quot;#&quot;+settings.id).rup_autocomplete(&quot;enable&quot;); } } } }); //****************************************************** // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** /** * Función a ejecutar en caso de producirse un error a la hora de obtener los elementos a mostrar. * * @callback jQuery.rup_autocomplete~onLoadError * @param {Object} xhr - Objeto XHR que contiene la respuesta de la petición realizada. * @param {string} textStatus - Texto que identifica el error producido. * @param {Object} errorThrown - Objeto error que contiene las propiedades del error devuelto en la petición. */ /** * @description Opciones por defecto de configuración del componente. * * @name jQuery.rup_autocomplete#defaults * * @property {jQuery.rup_autocomplete~onLoadError} [onLoadError] - Función de callback a ejecutar en caso de que se produzca un error en la petición de obtención de la lista de elementos a mostrar. * @property {boolean} [contains=true] - Valor que determina si la búsqueda debe ser del tipo “contiene” (se buscarán elementos que contengan en cualquier posición el literal introducido) o del tipo “comienza por” (se buscarán elementos que comiencen por el literal introducido). * @property {string} [valueName=null] - Determina el valor de la propiedad name del campo que utilizará internamente el componente para almacenar el identificador del elemento seleccionado por el usuario. En caso de no especificarse, se tomará como valor el valor de la propiedad name del elemento sobre el cual se ha definido el componente. * @property {string} [labelName=null] - Determina el valor de la propiedad name del campo que utilizará internamente el componente para almacenar el texto del elemento seleccionado por el usuario. En caso de no especificarse, se tomará como valor el valor de la propiedad name del elemento sobre el cual se ha definido el componente, añadiéndole el sufijo “_label”. * @property {boolean} [getText=false] - En caso de ser true el componente devolverá como resultado seleccionado el texto en vez del value del elemento. * @property {boolean} [combobox=false] - Habilita/deshabilita el modo de funcionamiento combobox. * @property {number} [menuMaxHeight=false] - Determina la altura máxima que podrá tener la capa del menú desplegable antes de mostrar scroll. * @property {object} [menuAppendTo=null] - Permite especificar mediante un selector de jQuery el elemento del DOM al que se añadirá el menú desplegable. * @property {boolean} [disabled=false] - determina si se deshabilita el componente Autocomplete sobre el input al que se aplica. De tal modo que por mucho que se interactué con el elemento no se hará una búsqueda. */ $.fn.rup_autocomplete.defaults = { onLoadError : null, contains : true, valueName: null, labelName: null, getText: false, combobox: false, menuMaxHeight: false, menuAppendTo:null, disabled:false }; })(jQuery); × Search results Close "},"rup.button.js.html":{"id":"rup.button.js.html","title":"Source: rup.button.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.button.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Button. * @author EJIE * @version 2.4.10 */ (function ($) { //**************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //**************************************************************************************************************** /** * Presenta un control de interación con el usuario. Se trata de extender los botones estandar del HTML para dotarles de mayores funcionalidades con las que mejorar la usabilidad de la aplicación. * * @summary Componente RUP Button. * @namespace jQuery.rup_button * @memberOf jQuery * @tutorial rup_button * @example * // Botón por defecto * $(&quot;#idButton&quot;).rup_button({}); * // Botón desplegable * $(&quot;#idButtonDrop&quot;).rup_button({ * dropdown:{ * dropdownListId:&quot;dropdownHtmlList&quot; * } * }); */ var rup_button = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_button&quot;, rup_button)); //******************************* // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************* $.fn.rup_button(&quot;extend&quot;,{ addButtonToDropdown: function(buttons){ } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* $.fn.rup_button(&quot;extend&quot;,{ _doDropdownListById: function ($dropdownButton, $container, dropdownSettings){ var $dropdownList = jQuery(&quot;#&quot;+dropdownSettings.dropdownListId); dropdownSettings.$dropdownList = $dropdownList; $container.append($dropdownList); $dropdownButton.on(&quot;click.rup_dopdown&quot;, function(event){ $dropdownList.toggleClass(&quot;open&quot;); event.stopPropagation(); }); $dropdownList.on(&quot;click.rup_dopdown&quot;, function(event){ event.stopPropagation(); }); jQuery(document).on(&quot;click.rup_dopdown.close&quot;, function(){ $dropdownList.removeClass(&quot;open&quot;); }); }, _doDropdownByDialog: function($dropdownButton, $container, dropdownSettings){ var $dropdownDialog = jQuery(&quot;#&quot;+dropdownSettings.dropdownDialog).rup_dialog(dropdownSettings.dropdownDialogConfig); jQuery.extend(dropdownSettings.dropdownDialogConfig,{ autoOpen:false, position:{my: &quot;right top&quot;, at: &quot;right bottom&quot;, of: $container} }); // Estilos $dropdownDialog.parent().addClass(&quot;rup-dropdown-dialog&quot;); $dropdownButton.on(&quot;click&quot;, function(){ $dropdownDialog.rup_dialog(&quot;open&quot;); }); }, _doDropdownByButtons: function($dropdownButton, $container, dropdownSettings){ var $self = this, $ul = $(&quot;&lt;ul&gt;&quot;), $li, buttons = dropdownSettings.buttons; $ul.attr({ id: $self.attr(&quot;id&quot;)+&quot;_dropdownList&quot; }).addClass(&quot;rup-dropdown-option-list rup-toolbar_menuButtonContainer&quot;); for(var i=0; i&lt;buttons.length; i++){ $li = $(&quot;&lt;li&gt;&quot;); $self._addButtonToDropdown($li, buttons[i]); $ul.append($li); } $dropdownButton.on(&quot;click.rup_dopdown&quot;, function(event){ $ul.toggleClass(&quot;open&quot;); event.stopPropagation(); }); $ul.on(&quot;click.rup_dropdown&quot;, function(event){ event.stopPropagation(); }); jQuery(document).on(&quot;click.rup_dopdown.close&quot;, function(){ $ul.removeClass(&quot;open&quot;); }); $container.append($ul); }, _addButtonToDropdown : function ($base, obj, json_i18n){ //añade a la toolbar un 'mbutton' (sin botones) var boton = '', buttonId; if (obj.id === undefined) { alert(&quot;El atributo ID es obligatorio en los MButtons.&quot;); boton = null; } else { buttonId = obj.id; // Se comprueba si el id del boton contiene el identificador de la botonera. En caso de no existir se añade al principio. if (buttonId.indexOf($(this).attr(&quot;id&quot;))!==0){ buttonId = $(this).attr(&quot;id&quot;)+&quot;##&quot;+obj.id; } boton = $(&quot;&lt;a/&gt;&quot;).attr(&quot;id&quot;, buttonId).text($.rup.i18nParse(json_i18n,obj.i18nCaption)).addClass(&quot;rup-toolbar_button&quot;); //Si no se define un estilo especial se aplica por defecto if (obj.css === undefined){ obj.css = &quot;rup-toolbar_menuButtonIcon&quot;; } boton.button().button(&quot;option&quot;, &quot;icons&quot;, {primary:obj.css, secondary:null} ); } $base.append(boton); //Añadir evento keydown this._setKeyDown(boton); if (obj.click) { //Añadir eventos boton.click({i18nCaption: obj.i18nCaption}, obj.click); } return boton; }, _setKeyDown : function(boton){ boton.bind(&quot;keydown&quot;, function(event){ var object = $(event.currentTarget), objectParent = object.parent(), nextObject; switch ( event.keyCode ) { case $.ui.keyCode.TAB: if(!event.shiftKey){ if (object.next().attr(&quot;id&quot;) !== objectParent.attr(&quot;id&quot;)+&quot;-rightButtons&quot;){ //Siguiente boton nextObject = object.next(&quot;:focusable&quot;); } else { //Primer botón de los alineados derecha nextObject = object.next().children(&quot;:focusable:first&quot;); } //Navegar entre botones if (nextObject.size() === 1){ nextObject.focus(); $.rup_toolbar.focusedExternally[objectParent.attr(&quot;id&quot;)] = true; return false; } } } }); } }); //******************************* // MÉTODO DE INICIALIZACION //******************************* $.fn.rup_button(&quot;extend&quot;, { /** * Método de inicialización del componente. * * @name jQuery.rup_button#_init * @function * @private */ _init : function(args){ var settings = $.extend(true, {}, $.fn.rup_button.defaults, args[0]), $self = this, $dropdownList, $container, dropdownSettings; // Comprobamos si se hace uso del dropdown if (settings.dropdown=== undefined || settings.dropdown === false){ // Botón normal $self.button(settings); $self.addClass(&quot;rup-button&quot;); }else{ // Inicialización del dropdown $.extend(true, settings.dropdown, $.fn.rup_button.dropdown_defaults, args[0].dropdown); dropdownSettings = settings.dropdown; $self.addClass(&quot;rup-button rup-dropdown&quot;); // Wrap into div $container = jQuery(&quot;&lt;div&gt;&quot;).attr(&quot;class&quot;,&quot;rup-dropdown-btn-group&quot;); $container = $self.wrap($container).parent(); dropdownSettings.$container = $container; $self.button({}); $self.addClass(&quot;rup-dropdown&quot;); var $dropdownButton = jQuery(&quot;&lt;button&gt;&quot;).attr({ type: &quot;button&quot;, id: $self.prop(&quot;id&quot;)+&quot;_dropdown&quot; }).text(&quot;Administración de filtros&quot;).button({ icons:{ primary: dropdownSettings.dropdownIcon }, text: false }).addClass(&quot;rup-dropdown-button&quot;); $self.after($dropdownButton); if (dropdownSettings.dropdownListId){ $dropdownList = jQuery(&quot;#&quot;+dropdownSettings.dropdownListId); dropdownSettings.$dropdownList = $dropdownList; $container.append($dropdownList); $dropdownButton.on(&quot;click.rup_dopdown&quot;, function(event){ $dropdownList.toggleClass(&quot;open&quot;); event.stopPropagation(); }); $dropdownList.on(&quot;click.rup_dopdown&quot;, function(event){ event.stopPropagation(); }); jQuery(document).on(&quot;click.rup_dopdown.close&quot;, function(){ $dropdownList.removeClass(&quot;open&quot;); }); }else if (dropdownSettings.dropdownDialog){ // Configuracion del dropdown con un RUP dialog jQuery.extend(dropdownSettings.dropdownDialogConfig,{ autoOpen:false, position:{my: &quot;right top&quot;, at: &quot;right bottom&quot;, of: $container} }); var $dropdownDialog = jQuery(&quot;#&quot;+dropdownSettings.dropdownDialog).rup_dialog(dropdownSettings.dropdownDialogConfig); // Estilos $dropdownDialog.parent().addClass(&quot;rup-dropdown-dialog&quot;); $dropdownButton.on(&quot;click&quot;, function(){ $dropdownDialog.rup_dialog(&quot;open&quot;); }); }else if (dropdownSettings.buttons){ // Configuración del dropdown a partir de buttons $self._doDropdownByButtons($dropdownButton, $container, dropdownSettings); } } // TODO : Invocación al plugin } }); //****************************************************** // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** /** * @description Opciones por defecto de configuración del componente. * * @name jQuery.rup_button#defaults * * @property {boolean | Object} [dropdown=false] - Determina si el botón va a contar con un menú desplegable de acciones secundarias. En caso de mostrar un desplegable esta propiedad contendrá el objeto de configuración del mismo. */ $.fn.rup_button.defaults = { dropdown:false }; /** * @description Opciones por defecto del objeto de configuración del menú desplegable asociado al botón. * * @name jQuery.rup_button#dropdown_defaults * * @property {string} [dropdownIcon=ui-icon-triangle-1-s] - Clase css correspondiente al icono del control que despliega el menú. */ $.fn.rup_button.dropdown_defaults ={ dropdownIcon: &quot;ui-icon-triangle-1-s&quot;, dropdownListId: undefined, dropdownDialog: undefined, dropdownDialogConfig:{ type: $.rup.dialog.DIV } }; })(jQuery); × Search results Close "},"rup.combo.js.html":{"id":"rup.combo.js.html","title":"Source: rup.combo.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.combo.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ //Modificado &quot;jquery.ui.selectmenu.js&quot; línea 70 //Modificado &quot;jquery.ui.selectmenu.js&quot; línea 438-442 //Modificado &quot;jquery.ui.selectmenu.js&quot; línea 270 [jQuery 1.8 compatible] //Modificado &quot;jquery.multiselect.js&quot; línea 53 [Estilo flecha como combos //Añadido &quot;jquery.multiselect.js&quot; línea 65 [Id al componete] //Modificado &quot;jquery.multiselect.js&quot; línea 581 [jQuery 1.8 compatible] //Modificadro &quot;IE Fixes&quot; (evitar problemas con elementos deshabilitados en IE) //Arregos para resaltado con el teclado (UDA - focus): líneas 446-448, 494-496, 519-522 /** * @fileOverview Implementa el patrón RUP Combo. * @author EJIE * @version 2.4.10 */ (function ($) { //**************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÁN (definición de la variable privada que contendrá los métodos y la función de jQuery) //**************************************************************************************************************** /** * Permite al usuario recuperar un elemento de una gran lista de elementos o de varias listas dependientes de forma sencilla y ocupando poco espacio en la interfaz. * * @summary Componente RUP Combo. * @namespace jQuery.rup_combo * @memberOf jQuery * @tutorial rup_combo * @example * $(&quot;#idCombo&quot;).rup_combo({ * source : &quot;comboSimple/remote&quot;, * sourceParam : {label:&quot;desc&quot;+$.rup_utils.capitalizedLang(), value:&quot;code&quot;, style:&quot;css&quot;} * }); */ var rup_combo = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_combo&quot;, rup_combo)); //******************************* // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************* $.fn.rup_combo(&quot;extend&quot;,{ /** * Método utilizado para obtener el valor del componente. Este método es el utilizado por el resto de componentes RUP para estandarizar la obtención del valor del Combo. * * @name jQuery.rup_combo#getRupValue * @function * @return {string | number} - Devuelve el valor actual del componente seleccionado por el usuario. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;getRupValue&quot;); */ getRupValue : function(param){ var $self = $(this), settings = $self.data(&quot;settings&quot;), retObj, arrayTMP, prop, valueArray, valueArray_length, returnArray, wrapObj={}, name; name = $self.attr(&quot;name&quot;); if (name){ arrayTMP = $self.attr(&quot;name&quot;).split(&quot;.&quot;); } if (settings.submitAsJSON){ // arrayTMP = $self.attr(&quot;name&quot;).split(&quot;.&quot;); // prop = arrayTMP[arrayTMP.length-1]; // valueArray = $self.rup_combo(&quot;value&quot;); // valueArray_length = valueArray.length; // returnArray = []; // for(var i=0; i&lt;valueArray_length; i++){ // var map = {}; // map[prop] = valueArray[i]; // returnArray.push(map); // } return jQuery.rup_utils.getRupValueAsJson(name, $self.rup_combo(&quot;value&quot;)); } retObj = settings.submitAsString?$self.rup_combo(&quot;value&quot;).toString():$self.rup_combo(&quot;value&quot;); if (arrayTMP !== undefined &amp;&amp; arrayTMP !== null &amp;&amp; settings.multiselect){ wrapObj[arrayTMP[arrayTMP.length-1]] = retObj; } return (settings.multiselect===true &amp;&amp; arrayTMP!== undefined &amp;&amp; arrayTMP.length&gt;1) &amp;&amp; settings.legacyWrapMode===false?wrapObj:retObj; }, /** * Método utilizado para asignar el valor al componente. Este método es el utilizado por el resto de componentes RUP para estandarizar la asignación del valor al Combo. * * @name jQuery.rup_combo#setRupValue * @function * @param {string | number} param - Valor que se va a asignar al componente. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;setRupValue&quot;, &quot;Si&quot;); */ setRupValue : function(param){ var $self = $(this), settings = $self.data(&quot;settings&quot;); //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu $.data(this[0],&quot;setRupValue&quot;,param.toString()); $(this).rup_combo(&quot;select&quot;,param.toString()); } else { //Multiple &gt; multiselect $(this).rup_combo(&quot;select&quot;,(settings.readAsString===true?param.split(&quot;,&quot;):param)); } }, /** * Método que limpia el valor seleccionado en el combo. En el caso de selección múltiple los valores seleccionados. * * @name jQuery.rup_combo#clear * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;clear&quot;); */ clear : function(){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu $(this).rup_combo(&quot;select&quot;); } else { //Multiple &gt; multiselect $(this).multiselect(&quot;uncheckAll&quot;); } }, /** * Realiza una reinicizalización del estado del componente. * * @name jQuery.rup_combo#reset * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;reset&quot;); */ reset : function(){ var $self = $(this); $self.rup_combo(&quot;select&quot;, $self.find(&quot;option[selected]&quot;).attr(&quot;value&quot;)); }, /** * Selecciona todos los elementos en el caso de tratarse de un combo multilesección. * * @name jQuery.rup_combo#checkAll * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;checkAll&quot;); */ checkAll : function(){ //Tipo de combo if ($(this).data(&quot;settings&quot;).multiselect){ //Multiple &gt; multiselect $(this).multiselect(&quot;checkAll&quot;); } else { //Simple &gt; selectmenu alert('Función no soportada.'); } }, /** * Selecciona el elemento enviado como parámetro. En caso de ser un numérico se selecciona por la posición (comenzando en 0) y si es un literal se selecciona por el valor. En el caso de selección múltiple el parámetro será un array. * * @name jQuery.rup_combo#select * @function * @param {string | number | string[] | number[]} param - Parámetro utilzado para determinar los elementos a seleccionar. * @example * // Simple * $(&quot;#idCombo&quot;).rup_combo(&quot;select&quot;, 2); * // Multiple * $(&quot;#idCombo&quot;).rup_combo(&quot;select&quot;, [0,2]); */ select : function(param){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu var elementSet = this._setElement($(this), param);//Cargar elemento //Si se ha cargado un elemento válido if (elementSet){ //Lanzar cambio para que se recarguen hijos var hijos = $(this).data(&quot;childs&quot;); if(hijos !== undefined){ for (var i=0;i&lt;hijos.length;i=i+1){ $(&quot;#&quot;+hijos[i]).rup_combo('reload',hijos[i]); } } } } else { //Multiple &gt; multiselect this._setElement($(this), param, true); } }, /** * Selecciona el elemento del combo que contiene como texto el indicado. En caso de no existir el texto a buscar el combo no sufrirá cambios En el caso de selección múltiple el parámetro será un array. * * @name jQuery.rup_combo#selectLabel * @function * @param {string | string[]} param - Parámetro utilzado para determinar los elementos a seleccionar. * @example * // Simple * $(&quot;#idCombo&quot;).rup_combo(&quot;selectLabel&quot;, &quot;No&quot;); * // Multiple * $(&quot;#idCombo&quot;).rup_combo(&quot;selectLabel&quot;, [&quot;No&quot;,&quot;Si&quot;]); */ selectLabel : function(param){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu var elementSet = this._selectLabel($(this), param, true);//Cargar elemento //Si se ha cargado un elemento válido if (elementSet){ //Lanzar cambio para que se recarguen hijos var hijos = $(this).data(&quot;childs&quot;); if(hijos !== undefined){ for (var i=0;i&lt;hijos.length;i=i+1){ $(&quot;#&quot;+hijos[i]).rup_combo('reload',hijos[i]); } } } } else { //Multiple &gt; multiselect for (var i=0; i&lt;param.length; i++){ $(&quot;input[name='multiselect_&quot; + $(this).attr(&quot;id&quot;) + &quot;'][title='&quot; + param[i] + &quot;']&quot;).attr('checked', true); } //Actualizar literal de elementos seleccionados $(this).multiselect(&quot;update&quot;); } }, /** * Método que devuelve el valor seleccionado en el combo. En caso de ser el valor vació, o sin selección, el valor devuelto es el asociado al “blank”. En el caso de la selección múltiple se devolverá un array. * * @name jQuery.rup_combo#value * @function * @return {string | string[]} - Valor del elemento o elementos seleccionados. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;value&quot;); */ value : function(){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu return ($(this).selectmenu(&quot;value&quot;)); } else { //Multiple &gt; multiselect var retorno = new Array(), checked = $(this).multiselect(&quot;getChecked&quot;); for (var i=0; i &lt; checked.size(); i++){ retorno.push($(checked[i]).val()); } return retorno; } }, /** * Método que devuelve el label asociado al valor seleccionado en el combo. En el caso de la selección múltiple se devolverá un array. * * @name jQuery.rup_combo#label * @function * @return {string | string[]} - Texto del elemento o elementos seleccionado. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;label&quot;); */ label : function(){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ return (this[0].options[$(this).selectmenu(&quot;index&quot;)].text); } else { //Multiple &gt; multiselect var retorno = new Array(), checked = $(this).multiselect(&quot;getChecked&quot;); for (var i=0; i &lt; checked.size(); i++){ retorno.push($(checked[i]).next().text()); } return retorno; } }, /** * Devuelve el índice de la opción seleccionada en el combo (empezando en 0). En el caso de la selección múltiple se devolverá un array. * * @name jQuery.rup_combo#index * @function * @return {number | number[]} - Índice del elemento o elementos seleccionados. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;index&quot;); */ index : function(){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu return ($(this).selectmenu(&quot;index&quot;)); } else { //Multiple &gt; multiselect var retorno = new Array(), checked = $(this).rup_combo(&quot;value&quot;), options = $(this).find(&quot;option&quot;); for (var i=0; i &lt; options.size(); i++){ if ($.inArray($(options[i]).val(), checked) !== -1){ retorno.push(i); } } return retorno; } }, /** * Deshabilita el combo. * * @name jQuery.rup_combo#disable * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;disable&quot;); */ disable : function(){ //Tipo de combo var $self = $(this); $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;-button&quot;).attr(&quot;tabindex&quot;,-1); // Añadimos el handler del evento focus para evitar que adquiera el foco cuando está deshabilitado $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;-button&quot;).on(&quot;focus.rup_combo&quot;, function(event){ $(&quot;#&quot;+$self.attr(&quot;id&quot;)+&quot;-button&quot;).blur(); return false; }); if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu $(this).selectmenu(&quot;disable&quot;); } else { //Multiple &gt; multiselect $(this).multiselect(&quot;disable&quot;); } }, /** * Habilita el combo. * * @name jQuery.rup_combo#enable * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;enable&quot;); */ enable : function(){ //Tipo de combo var $self = $(this), settings = $(this).data(&quot;settings&quot;); // Eliminamos el handler del evento focus para evitar que adquiera el foco cuando está deshabilitado $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;-button&quot;).off(&quot;focus.rup_combo&quot;); $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;-button&quot;).attr(&quot;tabindex&quot;,(settings.tabindex ? settings.tabindex : 0)); if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu $(this).selectmenu(&quot;enable&quot;); } else { //Multiple &gt; multiselect $(this).multiselect(&quot;enable&quot;); } }, /** * Indica si el combo está deshabilitado o no. * * @name jQuery.rup_combo#isDisabled * @function * @param {boolean} - Devuelve si el combo está deshabilitado o no. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;isDisabled&quot;); */ isDisabled : function(){ if ($(this).attr('aria-disabled') === 'false'){ return false; } else { return true; } }, /** * Vacía y deshabilita el combo sobre el que se aplica así como todos los combos que depende de él. Su uso principalmente es interno para las peticiones remotas. * * @name jQuery.rup_combo#disableChild * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;disableChild&quot;); */ disableChild : function(){ //Vaciar combo, deshabilitarlo $(this).empty().append(&quot;&lt;option&gt;&lt;/option&gt;&quot;).selectmenu(&quot;disable&quot;); //Eliminar texto que se muestra $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot;-button span:first-child&quot;).text(&quot;&quot;); //Propagar evento de selección a hijos (recursivo) var hijos = $(this).data(&quot;childs&quot;); if (hijos!==undefined){ for(var i=0;i&lt;hijos.length;i=i+1){ $(&quot;#&quot;+hijos[i]).rup_combo(&quot;disableChild&quot;); } } }, /** * Deshabilita una opción de un combo multiselección. * * @name jQuery.rup_combo#disableOpt * @param {string} optValue - Value del option que queremos deshabilitar. * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;disableOpt&quot;, &quot;opt1&quot;); */ disableOpt : function (optValue){ if ($(this).data(&quot;settings&quot;).multiselect){ //Deshabilitar select this.find(&quot;[value='&quot; + optValue + &quot;']&quot;).attr('disabled','disabled'); var obj = $(&quot;#rup-multiCombo_&quot;+ $(this).attr(&quot;id&quot;)).find(&quot;[value='&quot; + optValue + &quot;']&quot;); //Deshabilitar input obj.attr('disabled','disabled'); //Estilos línea (label) obj.parent().css(&quot;color&quot;,&quot;grey&quot;); //Si pertenece a OptGroup y es el último en deshabilitarse &gt; Cambiar estilos optGroupLabel if ($(this).data(&quot;settings&quot;).sourceGroup != undefined){ //Obtener inicio optGroup var li = obj.parentsUntil(&quot;ul&quot;).last().prevAll('li.ui-multiselect-optgroup-label').first(), inputs = li.nextUntil('li.ui-multiselect-optgroup-label').find('input'), allDisabled = true; for (var i=0; i&lt;inputs.length; i++){ if (!inputs[i].disabled){ allDisabled = false; break; } }; if (allDisabled){ //Estilos optGroup li.css(&quot;color&quot;,&quot;grey&quot;); li.children(&quot;a&quot;).remove(); li.children(&quot;span&quot;).not(&quot;.rup-combo_multiOptgroupLabel&quot;).remove(); } } } else { alert('Función no soportada.'); } }, /** * Deshabilita varias opciones del combo. Las opciones se identifican mediante un array. * * @name jQuery.rup_combo#disableOptArr * @param {string[]} optValueArr - Array en el que se indican los values de las opciones a deshabilitar. * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;disableOptArr&quot;, [&quot;opt1&quot;,&quot;opt2&quot;]); */ disableOptArr : function (optValueArr){ if ($(this).data(&quot;settings&quot;).multiselect){ for (var i=0; i&lt;optValueArr.length; i++){ $(this).rup_combo(&quot;disableOpt&quot;, optValueArr[i]); }; } else { alert('Función no soportada.'); } }, /** * Habilita una opción de un combo multiselección. * * @name jQuery.rup_combo#enableOpt * @param {string} enableOpt - Value del option que queremos habilitar. * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;enableOpt&quot;, &quot;opt1&quot;); */ enableOpt : function (optValue){ if ($(this).data(&quot;settings&quot;).multiselect){ //Habilitar select this.find(&quot;[value='&quot; + optValue + &quot;']&quot;).removeAttr('disabled'); var obj = $(&quot;#rup-multiCombo_&quot;+ $(this).attr(&quot;id&quot;)).find(&quot;[value='&quot; + optValue + &quot;']&quot;); //Habilitar input obj.removeAttr('disabled'); //Estilos línea (label) obj.parent().css(&quot;color&quot;,&quot;black&quot;); //Si pertenece a OptGroup y es el primero en habilitarse &gt; Cambiar estilos optGroupLabel if ($(this).data(&quot;settings&quot;).sourceGroup != undefined){ //Obtener inicio optGroup var li = obj.parentsUntil(&quot;ul&quot;).last().prevAll('li.ui-multiselect-optgroup-label').first(); //Estilos optGroup if (li.children(&quot;a&quot;).length===0){ li.css(&quot;color&quot;,&quot;black&quot;); this._generateOptGroupLabel(li, $(this).data(&quot;settings&quot;).multiOptgroupIconText); } } } else { alert('Función no soportada.'); } }, /** * Habilita varias opciones del combo. Las opciones se identifican mediante un array. * * @name jQuery.rup_combo#enableOptArr * @param {string[]} optValueArr - Array en el que se indican los values de las opciones a habilitar. * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;enableOptArr&quot;, [&quot;opt1&quot;,&quot;opt2&quot;]); */ enableOptArr : function (optValueArr){ if ($(this).data(&quot;settings&quot;).multiselect){ for (var i=0; i&lt;optValueArr.length; i++){ $(this).rup_combo(&quot;enableOpt&quot;, optValueArr[i]); }; } else { alert('Función no soportada.'); } }, /** * Refresca los valores asociados al combo. * * @name jQuery.rup_combo#refresh * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;refresh&quot;); */ refresh : function(){ //Tipo de combo if (this.length===0 || !$(this).data(&quot;settings&quot;).multiselect){ //Simple &gt; selectmenu return $(this).selectmenu(); } else { //Multiple &gt; multiselect $(this).multiselect(&quot;refresh&quot;); //Modificar literal en optgroups y asociarle el evento de &quot;seleccionar/deseleccionar&quot; var multiOptgroupIconText = $(this).data(&quot;settings&quot;).multiOptgroupIconText, self = this; $.each ($(&quot;#rup-multiCombo_&quot;+ $(this).attr(&quot;id&quot;)).find(&quot;.ui-multiselect-optgroup-label&quot;), function(index, object){ self._generateOptGroupLabel(object, multiOptgroupIconText); }); //Titles de botones por defecto $(&quot;#rup-multiCombo_&quot;+ $(this).attr(&quot;id&quot;)).find(&quot;.ui-multiselect-all&quot;).attr(&quot;title&quot;, $.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;][&quot;checkAllTitle&quot;]).rup_tooltip(); $(&quot;#rup-multiCombo_&quot;+ $(this).attr(&quot;id&quot;)).find(&quot;.ui-multiselect-none&quot;).attr(&quot;title&quot;, $.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;][&quot;uncheckAllTitle&quot;]).rup_tooltip(); //Deseleccionar todos return $(this).multiselect(&quot;uncheckAll&quot;); } }, /** * Realiza una recarga de los combos. * * @name jQuery.rup_combo#reload * @function * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;reload&quot;); */ reload: function (id){ if (this.length!==0){ var settings = $(this).data(&quot;settings&quot;), source, setRupValue; //Vaciar combo, quitarle valor y deshabilitar $(&quot;#&quot;+settings.id).rup_combo(&quot;disableChild&quot;); if (typeof settings.source === &quot;object&quot; || typeof settings.sourceGroup === &quot;object&quot;){ //LOCAL source = settings.source[this._getParentsValues(settings.parent, false, settings.multiValueToken)]; if (source!==undefined){ //Parsear datos this._parseLOCAL(source, settings, $(&quot;#&quot;+settings.id)); //Crear combo this._makeCombo(settings); // Evento de finalizacion de carga (necesario para trabajar con el manteniminto) if(settings.onLoadSuccess!==null){ jQuery(settings.onLoadSuccess($(&quot;#&quot;+settings.id))); } //Lanzar cambio para que se recarguen hijos $(&quot;#&quot;+settings.id).selectmenu(&quot;change&quot;); setRupValue = $.data($(&quot;#&quot;+settings.id)[0],&quot;setRupValue&quot;); if (setRupValue){ //Vaciar combo, quitarle valor y deshabilitar $(&quot;#&quot;+settings.id).rup_combo(&quot;select&quot;,setRupValue); } } } else if (typeof settings.source === &quot;string&quot; || typeof settings.sourceGroup === &quot;string&quot;){ //REMOTO var data = this._getParentsValues(settings.parent, true), rupCombo = this; if (data===null){ return false; } //Se para la petición porque algún padre no tiene el dato cargado $.rup_ajax({ url: settings.source?settings.source:settings.sourceGroup, data : data, dataType: 'json', contentType: 'application/json', beforeSend: function (xhr){ rupCombo._ajaxBeforeSend(xhr, settings); }, success: function (data, textStatus, jqXHR){ rupCombo._ajaxSuccess(data, settings, $(&quot;#&quot;+settings.id)); // Evento de finalizacion de carga (necesario para trabajar con el manteniminto) if(settings.onLoadSuccess!==null){ jQuery(settings.onLoadSuccess($(&quot;#&quot;+settings.id))); } }, error: function(xhr, textStatus, errorThrown){ if(settings.onLoadError!==null){ jQuery(settings.onLoadError(xhr, textStatus, errorThrown)); }else{ self._ajaxError(xhr, textStatus, errorThrown); } } }); //delete rupCombo; } else if (typeof settings.source === &quot;function&quot; || typeof settings.sourceGroup === &quot;function&quot;){ //Se lanza la funcion que obtiene los valores a mostrar jQuery(settings.source); this._makeCombo(settings); } } }, /** * Ordena alfanumericamente y en orden ascendente el combo sobre el que se aplica. Se invoca por defecto al cargarse los combos a no se que se cambie el valor del atributo ordered en la creación. * * @name jQuery.rup_combo#order * @function * @param {boolean} orderedByValue - Indica si la búsqueda es por texto (por defecto) o si la búsqueda es por el valor. * @param {boolean} orderAsNumber - Indica si se debe den de ordenar como valores numéricos en vez de alfabéticos. * @param {boolean} skipFirst - Determina si se debe de obviar el primer elemento. * @example * $(&quot;#idCombo&quot;).rup_combo(&quot;reload&quot;); */ order: function (orderedByValue, orderAsNumber, skipFirst){ var combo = $(this), options = $('option', combo), arrVals = [], skippedValue = null; //Comprobar que se ha obtenido el combo deseado if (combo.length&gt;0){ //Guardar elemento seleccionado var selectedVal = combo.rup_combo(&quot;value&quot;); //Obtener elementos combo options.each(function(){ //Omitir posible opción vacía if (skipFirst){ skipFirst = false; skippedValue = { val: $(this).val(), text: $(this).text() }; return true; } arrVals.push({ val: $(this).val(), text: $(this).text(), clazz: $(this).attr('class') }); }); //Ordenar elementos (segun parametros, por defecto de texto) if (!orderedByValue){ if (!orderAsNumber){ arrVals.sort(function(a, b){ return a.text.localeCompare(b.text); }); } else { arrVals.sort(function(a, b){ return a.text-b.text; }); } } else { if (!orderAsNumber){ arrVals.sort(function(a, b){ if(a.val&gt;b.val){ return 1; } else if (a.val==b.val){ return 0; } else { return -1; } }); } else { arrVals.sort(function(a, b){ return a.val-b.val; }); } } //Actualizar combo con elementos ordenados for (var i = 0, l = arrVals.length; i &lt; l; i++) { $(options[i]).val(arrVals[i].val).text(arrVals[i].text); if (arrVals[i].clazz){ $(options[i]).attr('class', arrVals[i].clazz); } } //Añadir opción vacía al inicio if (skippedValue){ combo.prepend($(&quot;&lt;option&gt;&quot;).attr(&quot;value&quot;, skippedValue.val).text(skippedValue.text));//Añadir opción vacía $(options[arrVals.length]).remove();//Eliminar ultimo elemento } //Regenerar combo combo.rup_combo(&quot;refresh&quot;); //Restaurar elemento seleccionado this._setElement($(this), selectedVal, $(this).data(&quot;settings&quot;).multiselect); //Eliminar referencias // delete combo; // delete options; // delete arrVals; } } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* $.fn.rup_combo(&quot;extend&quot;, { /** * Establece un elemento del combo por posición o valor. * * @name jQuery.rup_combo#_setElement * @function * @private * @param {object} selector - Referencia al objeto jQuery del combo. * @param {object} param - Value correspondiente. * @param {boolean} multicombo - Indica si el combo permite la multiselección. * @param {boolean} markOptSelected - Determina si se debe marcar como seleccionado el elemento. */ _setElement : function(selector, param, multicombo, markOptSelected){ if (multicombo!==true){ //Simple &gt; selectmenu if (typeof param === &quot;string&quot; ){ if ($(&quot;option[value='&quot;+param+&quot;']&quot;, selector).length&gt;0){//Controlamos que se intenten seleccionar un valor existente if (markOptSelected===true){ $(&quot;option[value='&quot;+param+&quot;']&quot;, selector).attr(&quot;selected&quot;,&quot;selected&quot;); } $(selector).selectmenu(&quot;value&quot;, param).trigger('_setElement'); } else { return false; } } else if(typeof param === &quot;number&quot; ){ if ($('option', selector).length &gt;= param){//Controlamos que se intenten seleccionar una posición existente if (markOptSelected===true){ $(&quot;option:eq(&quot;+param+&quot;)&quot;, selector).attr(&quot;selected&quot;,&quot;selected&quot;); } $(selector).selectmenu(&quot;index&quot;, param).trigger('_setElement'); } else { return false; } } else { $(selector).selectmenu(&quot;index&quot;, 0).trigger('_setElement'); } return true; } else { //Multiple &gt; multiselect if (param!==null &amp;&amp; typeof param === &quot;object&quot;){ //Recorrer array parametros for (var i=0; i&lt;param.length; i++){ if (typeof param[i] === &quot;number&quot;){ //Acceso por posición $($(&quot;input[name='multiselect_&quot; + $(this).attr(&quot;id&quot;) + &quot;']&quot;)[param[i]]).attr('checked', true); } else if (typeof param[i] === &quot;string&quot;){ //Acceso por valor $(&quot;input[name='multiselect_&quot; + $(this).attr(&quot;id&quot;) + &quot;'][value='&quot;+param[i]+&quot;']&quot;).attr('checked', true); } } // Se altualiza el valor almacenado en el objeto HTML select. $(selector).val(param).trigger('_setElement'); //Actualizar literal de elementos seleccionados $(selector).multiselect(&quot;update&quot;); } return true; } }, /** * Selecciona el elemento correspondiente al label indicado * * @name jQuery.rup_combo#_selectLabel * @function * @private * @param {object} selector - Referencia al objeto jQuery del combo. * @param {object} param - Value correspondiente. */ _selectLabel : function(selector, param){ var $option; for(var i = 0; i&lt;$(&quot;option&quot;, selector).length; i=i+1){ $option = jQuery(&quot;option:eq(&quot;+i+&quot;)&quot;, selector); if(jQuery(&quot;option:eq(&quot;+i+&quot;)&quot;, selector).text() === param){ $(selector).selectmenu(&quot;index&quot;, $option.prop(&quot;index&quot;)); return true; } } return false; }, /** * Obtener la opción vacía a partir del fichero de internacionalización de la aplicación o del fichero por defecto. * * @name jQuery.rup_combo#_getBlankLabel * @function * @private * @param {string} id - Identificador del fichero */ _getBlankLabel : function (id){ var app = $.rup.i18n.app; if (app[id] &amp;&amp; app[id][&quot;_blank&quot;]){ return app[id][&quot;_blank&quot;]; } return $.rup.i18n.base[&quot;rup_combo&quot;][&quot;blankNotDefined&quot;]; }, /** * Realiza el formateo de los registros que se muestran en la lista desplegable del combo. * * @name jQuery.rup_combo#_defaultFormatting * @function * @private */ _defaultFormatting : function(text){ var findreps = [ {find:/^([^\\-]+) \\- /g, rep: '&lt;span class=&quot;ui-selectmenu-item-header&quot;&gt;$1&lt;/span&gt;'}, {find:/([^\\|&gt;&lt;]+) \\| /g, rep: '&lt;span class=&quot;ui-selectmenu-item-content&quot;&gt;$1&lt;/span&gt;'}, {find:/([^\\|&gt;&lt;\\(\\)]+) (\\()/g, rep: '&lt;span class=&quot;ui-selectmenu-item-content&quot;&gt;$1&lt;/span&gt;$2'}, {find:/([^\\|&gt;&lt;\\(\\)]+)$/g, rep: '&lt;span class=&quot;ui-selectmenu-item-content&quot;&gt;$1&lt;/span&gt;'}, {find:/(\\([^\\|&gt;&lt;]+\\))$/g, rep: '&lt;span class=&quot;ui-selectmenu-item-footer&quot;&gt;$1&lt;/span&gt;'} ]; for(var i in findreps){ text = text.replace(findreps[i].find, findreps[i].rep); } return text; }, /** * Obtener valores de los combos padres (si no están cargados o valores 'vacíos' devuelve null). En caso de disponer de varios combos padres se devolverán separados por un caracter delimitador. * * @name jQuery.rup_combo#_getParentsValues * @function * @private * @param {object[]} array - Array con los elementos a mostrar. * @param {boolean} remote - Determina si la fuente de datos es remota o no. * @param {string} multiValueToken - Caracter separador en el caso de devolver varios elementos. * @return {string} - Devuelve los values seleccionados de los combos padres. */ _getParentsValues : function(array, remote, multiValueToken){ var retorno=&quot;&quot;, id, texto, multiValueToken=multiValueToken!=null?multiValueToken:&quot;&quot;, parentBlankValue; //Puede que se lance una recarga de un combo sin padres if (array===undefined){ return retorno; } for (var i=0; i&lt;array.length;i=i+1){ id = array[i]; //Si tiene seleccionado la primera opción puede que está seleccionada opción vacia if ($(&quot;#&quot;+id).rup_combo(&quot;index&quot;) === 0){ texto = $(&quot;#&quot;+id+&quot;-button span:first-child&quot;).text(); //Comprobar si tiene valor por defecto (bien propio o valor base por no haberlo definido) if ( texto === $.rup.i18n.base[&quot;rup_combo&quot;][&quot;blankNotDefined&quot;] || (($.rup.i18n.app[id] !== undefined) &amp;&amp; (texto === $.rup.i18n.app[array[i]][&quot;_blank&quot;])) ){ return null; } } //Si el valor de algún padre es null (no se ha cargado aún) if ($(&quot;#&quot;+id).data(&quot;settings&quot;).blank!==undefined &amp;&amp; $(&quot;#&quot;+id).data(&quot;settings&quot;).blank!==null){ parentBlankValue = $(&quot;#&quot;+id).data(&quot;settings&quot;).blank; }else{ parentBlankValue = &quot;&quot;; } if ($(&quot;#&quot;+id).val()=== null || $(&quot;#&quot;+id).val() === parentBlankValue){ return null; }; if (remote){ retorno += $(&quot;#&quot;+id).attr(&quot;name&quot;) + &quot;=&quot; + $(&quot;#&quot;+id).val() + &quot;&amp;&quot;; } else { retorno += $(&quot;#&quot;+id).val() + multiValueToken; } } //Evitar &amp; o multiValueToken finales if (retorno!==&quot;&quot;) { if (remote){ retorno = retorno.substring(0, retorno.length-1); } else { retorno = retorno.substring(0, retorno.length-multiValueToken.length); } } return retorno; }, /** * Función principal en el proceso de crear un combo. Genera todos los elementos html y objetos js internos necesarios para el funcionamiento del mismo. * * @name jQuery.rup_combo#_makeCombo * @function * @private * @param {object} settings - Parametros de configuración con los que se ha inicializado el combo. */ _makeCombo : function(settings) { //Opción vacía if (settings.blank!=null){ $(&quot;#&quot;+settings.id).prepend($(&quot;&lt;option&gt;&quot;).attr(&quot;value&quot;, settings.blank).text(this._getBlankLabel(settings.id))); } //Gestionar Imagenes if (settings.imgs) { var icons = [], values = []; $.map(settings.imgs,function(item) { $.each(item, function(key, elemImg){ if (key.indexOf(&quot;###&quot;)==-1){ $(&quot;#&quot;+settings.id+&quot; [value='&quot;+key+&quot;']&quot;).addClass(elemImg); icons[icons.length] = { find: '.'+elemImg }; } else { values = key.split(&quot;###&quot;); $(&quot;#&quot;+settings.id+&quot; &gt; [label='&quot;+values[0]+&quot;'] &gt; [value='&quot;+values[1]+&quot;']&quot;).addClass(item[values[0]+&quot;###&quot;+values[1]]); icons[icons.length] = { find: '.'+item[values[0]+&quot;###&quot;+values[1]] }; } }); }); settings.icons = icons; } //Formato texto settings.format = settings.format===&quot;default&quot;?this._defaultFormatting:settings.format; //Almacenar los settings $(&quot;#&quot;+settings.id).data(&quot;settings&quot;, settings); //Tipo de combo if (!settings.multiselect){ //Simple &gt; selectmenu $(&quot;#&quot;+settings.id).selectmenu(settings); } else { //Multiple &gt; multiselect $(&quot;#&quot;+settings.id).width(&quot;0&quot;); //Iniciar a tamaño cero para que el multiselect calcule el tamaño settings.minWidth = settings.width; $(&quot;#&quot;+settings.id).multiselect(settings); $(&quot;#&quot;+settings.id).data(&quot;multiselect&quot;).button.attr(&quot;id&quot;,settings.id+&quot;-button&quot;); $(&quot;#&quot;+settings.id).rup_combo(&quot;refresh&quot;); //Actualizar cambios (remotos) $(&quot;#&quot;+settings.id).attr(&quot;multiple&quot;, &quot;multiple&quot;); // Asignaci�n de eventos de teclado var self = this; $(&quot;#&quot;+settings.id).data(&quot;multiselect&quot;).button.on('keypress.selectmenu', function(event) { if (event.which &gt; 0) { self._typeAheadMultiselect(event.which, 'focus', settings); } return true; }); // $(&quot;#rup-multiCombo_remoteGroup_comboHijo&quot;).on('keypress', function(event) { $(&quot;#&quot;+settings.id).data(&quot;multiselect&quot;).menu.delegate('label', 'keydown.multiselect', function( event ){ if (event.which &gt; 0) { self._typeAheadMultiselect(event.which, 'focus', settings); } return true; }); } //Buscar el UL del combo y colocarlo tras el elemento sobre el que debe ir if($.rup_utils.aplicatioInPortal()){ if (!settings.multiselect){ //Simple &gt; selectmenu $(&quot;div.r01gContainer&quot;).append($(&quot;#&quot;+settings.id+&quot;-menu&quot;)); } else { //Multiple &gt; multiselect $(&quot;div.r01gContainer&quot;).append($(&quot;#rup-multiCombo_&quot;+ settings.id)); } } //Ordenar elementos del combo if (settings.ordered){ $(&quot;#&quot;+settings.id).rup_combo(&quot;order&quot;, settings.orderedByValue, settings.orderAsNumber, settings.blank); } //Seleccionar elemento (valor del input, valor settings combo) if (!settings.loadFromSelect &amp;&amp; (settings.inputValue === undefined || settings.inputValue === &quot;&quot;) || settings.loadFromSelect &amp;&amp; settings.selected !== undefined){ this._setElement($(&quot;#&quot;+settings.id), settings.selected, settings.multiselect, true); } else { if (settings.multiselect){ //Convertir inputValue en array if (jQuery.isArray(settings.inputValue)===false){ settings.inputValue = settings.inputValue.split(&quot;##&quot;); } } this._setElement($(&quot;#&quot;+settings.id), settings.inputValue, settings.multiselect, true); } //Habilitar/Deshabilitar combo if (!settings.disabled) { $(&quot;#&quot;+settings.id).rup_combo(&quot;enable&quot;); } else { $(&quot;#&quot;+settings.id).rup_combo(&quot;disable&quot;); } //Habilitar/Deshabilitar elementos (multicombo) if (settings.multiselect){ if (settings.disabledOpts!==undefined){ $(&quot;#&quot;+settings.id).rup_combo(&quot;disableOptArr&quot;, settings.disabledOpts); } if (settings.enabledOpts!==undefined){ $(&quot;#&quot;+settings.id).rup_combo(&quot;enableOptArr&quot;, settings.enabledOpts); } } //Si los padres están deshabilitados, se deshabilita el combo var padres = settings.parent; if (padres !== undefined){ $.each(padres, function(index, object) { if($(&quot;#&quot;+object).rup_combo(&quot;isDisabled&quot;)){ $(&quot;#&quot;+settings.id).rup_combo(&quot;disable&quot;); return; } }); } //Clases para el pijama if (settings.rowStriping){ if (!settings.multiselect){ $(&quot;#&quot;+settings.id+&quot;-menu li:nth-child(2n+1):not(.ui-selectmenu-group)&quot;).addClass(&quot;rup-combo_odd&quot;); $(&quot;#&quot;+settings.id+&quot;-menu li:nth-child(2n):not(.ui-selectmenu-group)&quot;).addClass(&quot;rup-combo_even&quot;); $(&quot;#&quot;+settings.id+&quot;-menu li:nth-child(2n+1).ui-selectmenu-group&quot;).addClass(&quot;rup-combo_groupOdd&quot;); $(&quot;#&quot;+settings.id+&quot;-menu li:nth-child(2n).ui-selectmenu-group&quot;).addClass(&quot;rup-combo_groupEven&quot;); } else { $(&quot;#rup-multiCombo_&quot;+settings.id+&quot; .ui-multiselect-checkboxes li:nth-child(2n+1):not(.ui-multiselect-optgroup-label)&quot;).addClass(&quot;rup-combo_odd&quot;); $(&quot;#rup-multiCombo_&quot;+settings.id+&quot; .ui-multiselect-checkboxes li:nth-child(2n):not(.ui-multiselect-optgroup-label)&quot;).addClass(&quot;rup-combo_even&quot;); $.each($(&quot;#rup-multiCombo_&quot;+settings.id+&quot; .ui-multiselect-optgroup-label&quot;), function(index, value) { (index%2 == 0)?$(value).addClass(&quot;rup-combo_groupOdd&quot;):$(value).addClass(&quot;rup-combo_groupEven&quot;); }); } } }, /** * Procesa el conjunto de registros devueltos por una petición sobre un origen de datos local. * * @name jQuery.rup_combo#_parseLOCAL * @function * @private * @param {object[]} array - Array de registros obtenidos a partir del origen de datos. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @param {jQuery} html - Referencia al objeto jQuery que contiene los elementos. */ _parseLOCAL : function (array, settings, html){ var imgs = settings.imgs?settings.imgs:[], label, value; for(var i=0;i&lt;array.length;i=i+1){ label = value = array[i]; if (typeof array[i] === &quot;object&quot;){ //multi-idioma if(array[i][&quot;i18nCaption&quot;]){ label = $.rup.i18nParse($.rup.i18n.app[settings.i18nId],array[i][&quot;i18nCaption&quot;]); }else{ label = array[i][&quot;label&quot;]; } value = array[i][&quot;value&quot;]; } if (array[i]!=undefined &amp;&amp; array[i][&quot;style&quot;]){ imgs[imgs.length] = {}; imgs[imgs.length-1][value] = array[i][&quot;style&quot;]; settings.imgs = imgs; } html.append($(&quot;&lt;option&gt;&quot;).attr(&quot;value&quot;, value).text(settings.showValue?value+settings.token+label:label)); } }, /** * Procesa el conjunto de registros devueltos por una petición sobre un origen de datos local. Este método se emplea en el caso de existir agrupación de los mismos. * * @name jQuery.rup_combo#_parseOptGroupLOCAL * @function * @private * @param {object[]} arrayGroup - Array de registros obtenidos a partir del origen de datos. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @param {jQuery} html - Referencia al objeto jQuery que contiene los elementos. */ _parseOptGroupLOCAL : function(arrayGroup, settings, html){ var optGroup, self = this; for(var i=0;i&lt;arrayGroup.length;i=i+1){ optGroup = arrayGroup[i]; $.each(optGroup, function(key, elemGroup){ if (typeof (elemGroup[0]) !== 'string'){ html.append($(&quot;&lt;optgroup&gt;&quot;).attr(&quot;label&quot;, $.rup.i18nParse($.rup.i18n.app[settings.i18nId],key))); } else { html.append($(&quot;&lt;optgroup&gt;&quot;).attr(&quot;label&quot;,key)); } html = $(html).children(&quot;optgroup:last-child&quot;); self._parseLOCAL(elemGroup, settings, html); html = $(html).parent(); }); } }, /** * Procesa el conjunto de registros devueltos por una petición sobre un origen de datos remoto. * * @name jQuery.rup_combo#_parseREMOTE * @function * @private * @param {object[]} array - Array de registros obtenidos a partir del origen de datos. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @param {jQuery} html - Referencia al objeto jQuery que contiene los elementos. * @param {string} optGroupKey - Identificador del optionGroup al que pertenece. */ _parseREMOTE : function(array, settings, html, optGroupKey){ var remoteImgs = settings.imgs?settings.imgs:[], item, setRupValue; for ( var i = 0; i &lt; array.length; i = i + 1) { item = array[i]; if (item[&quot;style&quot;]){ remoteImgs[remoteImgs.length] = {}; if (optGroupKey==null){ remoteImgs[remoteImgs.length-1][item[&quot;value&quot;]] = item[&quot;style&quot;]; } else { remoteImgs[remoteImgs.length-1][optGroupKey+&quot;###&quot;+item[&quot;value&quot;]] = item[&quot;style&quot;]; } settings.imgs = remoteImgs; } html.append($(&quot;&lt;option&gt;&quot;).attr(&quot;value&quot;, item[&quot;value&quot;]).text(settings.showValue?item[&quot;value&quot;]+settings.token+item[&quot;label&quot;]:item[&quot;label&quot;])); } }, /** * Procesa el conjunto de registros devueltos por una petición sobre un origen de datos remoto. Este método se emplea en el caso de existir agrupación de los mismos. * * @name jQuery.rup_combo#_parseOptGroupREMOTE * @function * @private * @param {object[]} arrayGroup - Array de registros obtenidos a partir del origen de datos. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @param {jQuery} html - Referencia al objeto jQuery que contiene los elementos. */ _parseOptGroupREMOTE : function(arrayGroup, settings, html){ var optGroup, self = this; for(var i=0;i&lt;arrayGroup.length;i=i+1){ optGroup = arrayGroup[i]; $.each(optGroup, function(key, elemGroup){ html.append($(&quot;&lt;optgroup&gt;&quot;).attr(&quot;label&quot;,key)); html = $(html).children(&quot;optgroup:last-child&quot;); self._parseREMOTE(elemGroup, settings, html, key); html = $(html).parent(); }); } }, /** * Prepara la petición AJAX que se va a realizar para obtener los registros a partir de un origen remoto. Se añaden las cabeceras RUP correspondientes para realizar la serialización json de manera correcta. * * @name jQuery.rup_combo#_ajaxBeforeSend * @function * @private * @param {object} xhr - Objeto xhr que se va a enviar en la petición * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @param {jQuery} html - Referencia al objeto jQuery que contiene los elementos. */ _ajaxBeforeSend : function (xhr, settings, html){ //Crear combo (vacío) y deshabilitarlo if (html!==undefined){ $(&quot;#&quot;+settings.id).replaceWith(html); } //Si no es 'reload' se debe inicializar vacío this._makeCombo(settings); $(&quot;#&quot;+settings.id).rup_combo(&quot;disable&quot;); //LOADING... $(&quot;#&quot;+settings.id+&quot;-button span:first-child&quot;).addClass(&quot;rup-combo_loadingText&quot;).text($.rup.i18n.base[&quot;rup_combo&quot;][&quot;loadingText&quot;]); var icon = $(&quot;#&quot;+settings.id+&quot;-button span:last-child&quot;); $(icon).removeClass(&quot;ui-icon-triangle-1-s&quot;); $(icon).addClass(&quot;rup-combo_loading&quot;); //Cabecera RUP xhr.setRequestHeader(&quot;RUP&quot;, $.toJSON(settings.sourceParam)); }, /** * Procesa la respuesta de la petición AJAX en el caso de que esta haya finalizado correctamente. * * @name jQuery.rup_combo#_ajaxSuccess * @function * @private * @param {object} data - Objeto enviado en la respuesta. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @param {jQuery} html - Referencia al objeto jQuery que contiene los elementos. */ _ajaxSuccess : function (data, settings, html){ //UNLOADING... $(&quot;#&quot;+settings.id+&quot;-button span:first-child&quot;).removeClass(&quot;rup-combo_loadingText&quot;).text(&quot;&quot;); var icon = $(&quot;#&quot;+settings.id+&quot;-button span:last-child&quot;); $(icon).removeClass(&quot;rup-combo_loading&quot;); $(icon).addClass(&quot;ui-icon-triangle-1-s&quot;); //Vaciar combo $(&quot;#&quot;+settings.id).empty(); //Cargar combo (si se reciben datos) if (data.length&gt;0){ if (settings.source) { this._parseREMOTE(data, settings, html); } else { settings.ordered = false; this._parseOptGroupREMOTE(data, settings, html); } //Crear combo this._makeCombo(settings); setRupValue = $.data($(&quot;#&quot;+settings.id)[0],&quot;setRupValue&quot;); if (setRupValue){ //Vaciar combo, quitarle valor y deshabilitar $(&quot;#&quot;+settings.id).rup_combo(&quot;select&quot;,setRupValue); }else{ //Lanzar cambio para que se recarguen hijos $(&quot;#&quot;+settings.id).selectmenu(&quot;change&quot;); } }else{ $(&quot;#&quot;+settings.id).append(&quot;&lt;option&gt;&lt;/option&gt;&quot;); } }, /** * Procesa la respuesta de la petición AJAX en el caso de que se haya producido un error en la misma. * * @name jQuery.rup_combo#_ajaxError * @function * @private * @param {object} xhr - Objeto xhr enviado en la respuesta. * @param {string} textStatus - Cadena identificadora del error que se ha producido en la petición. * @param {object} errorThrown - Objeto error correspondiente al que se ha producido en la petición. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. */ _ajaxError : function (xhr, textStatus, errorThrown, settings){ if(xhr.responseText !== null){ $.rup.showErrorToUser(xhr.responseText); } else { $.rup.showErrorToUser($.rup.i18n.base.rup_combo.ajaxError); } }, /** * Crea la etiqueta correspondiente a una agrupación. * * @name jQuery.rup_combo#_generateOptGroupLabel * @function * @private * @param {jQuery} object - Referencia al propio componente. * @param {string} multiOptgroupIconText - Prefijo de los option group. */ _generateOptGroupLabel: function (object, multiOptgroupIconText){ //Texto A &gt; SPAN $(object).append($(&quot;&lt;span /&gt;&quot;) .text($(object).children(&quot;a&quot;).text()) .addClass (&quot;rup-combo_multiOptgroupLabel&quot;) ); $(object).children(&quot;a&quot;).remove(); $(object).append($(&quot;&lt;span /&gt;&quot;).text(&quot; [&quot;)); $(object).append($(&quot;&lt;a /&gt;&quot;) .text(multiOptgroupIconText?$.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;][&quot;optGroupSelect&quot;]:&quot;&quot;) .prepend($(&quot;&lt;span /&gt;&quot;).addClass(&quot;ui-icon ui-icon-check rup-combo_multiOptgroupIcon&quot;)) .attr(&quot;title&quot;,$.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;][&quot;optGroupSelectTitle&quot;]).rup_tooltip({applyToPortal:true}) .click(function (){ var inputs = $(object).nextUntil('li.ui-multiselect-optgroup-label').find('input'); for (var i=0; i&lt;inputs.length; i++){ if (!inputs[i].disabled){ inputs[i].checked = false; } } }) ); $(object).append($(&quot;&lt;span /&gt;&quot;).text(&quot; | &quot;)); $(object).append($(&quot;&lt;a /&gt;&quot;) .text(multiOptgroupIconText?$.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;][&quot;optGroupDeselect&quot;]:&quot;&quot;) .prepend($(&quot;&lt;span /&gt;&quot;).addClass(&quot;ui-icon ui-icon-closethick rup-combo_multiOptgroupIcon&quot;)) .attr(&quot;title&quot;,$.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;][&quot;optGroupDeselectTitle&quot;]).rup_tooltip({applyToPortal:true}) .click(function (){ var inputs = $(object).nextUntil('li.ui-multiselect-optgroup-label').find('input'); for (var i=0; i&lt;inputs.length; i++){ if (!inputs[i].disabled){ inputs[i].checked = true; } } }) ); $(object).append($(&quot;&lt;span /&gt;&quot;).text(&quot; ]&quot;)); }, /** * Devuelve los li de los elementos seleccionados en un combo multiselección. * * @name jQuery.rup_combo#_selectedOptionLiMultiselect * @function * @private * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @return {jQuery | jQuery[]} - Objetos jQuery con referencias a los elementos seleccionados. */ _selectedOptionLiMultiselect: function(settings) { var multiselectSettings = $(&quot;#&quot;+settings.id).data(&quot;multiselect&quot;); return this._optionLis.eq(this._selectedIndex()); }, /** * Devuelve el li del elemento que contiene el foco en un combo multiselección. * * @name jQuery.rup_combo#_focusedOptionLiMultiselect * @function * @private * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. * @return {jQuery} - Objeto jQuery con referencia al elemento que contiene el foco. */ _focusedOptionLiMultiselect: function(settings) { var multiselectSettings = $(&quot;#&quot;+settings.id).data(&quot;multiselect&quot;); // return this.list.find('.' + this.widgetBaseClass + '-item-focus'); var $elem=undefined; jQuery.each(multiselectSettings.inputs, function(index,elem){ if ($(elem).parent().has(&quot;.ui-state-hover&quot;)){ $elem = $(elem); } }); return $elem; }, /** * Procesa los eventos de introducción de caracteres de teclado por parte del usuario. * * @name jQuery.rup_combo#_typeAheadMultiselect * @function * @private * @param {number} code - Código ASCII correspondiente al caracter introducido por el usuario. * @param {object} eventType - Objeto event de jQuery. * @param {object} settings - Objeto de propiedades de configuración con el que se ha inicializado el componente. */ _typeAheadMultiselect: function( code, eventType, settings ) { var self = this, c = String.fromCharCode(code).toLowerCase(), matchee = null, nextIndex = null; // Clear any previous timer if present if ( self._typeAhead_timer ) { window.clearTimeout( self._typeAhead_timer ); self._typeAhead_timer = undefined; } // Store the character typed self._typeAhead_chars = (self._typeAhead_chars === undefined ? &quot;&quot; : self._typeAhead_chars).concat(c); // Detect if we are in cyciling mode or direct selection mode if ( self._typeAhead_chars.length &lt; 2 || (self._typeAhead_chars.substr(-2, 1) === c &amp;&amp; self._typeAhead_cycling) ) { self._typeAhead_cycling = true; // Match only the first character and loop matchee = c; } else { // We won't be cycling anymore until the timer expires self._typeAhead_cycling = false; // Match all the characters typed matchee = self._typeAhead_chars; } // We need to determine the currently active index, but it depends on // the used context: if it's in the element, we want the actual // selected index, if it's in the menu, just the focused one // I copied this code from _moveSelection() and _moveFocus() // respectively --thg2k var selectedIndex = (eventType !== 'focus' ? this._selectedOptionLiMultiselect(settings).data('index') : this._focusedOptionLiMultiselect(settings).data('index')) || 0; var multiselectSettings = $(&quot;#&quot;+settings.id).data(&quot;multiselect&quot;); for (var i = 0; i &lt; multiselectSettings.inputs.length; i++) { var thisText =multiselectSettings.inputs.eq(i).next(&quot;span&quot;).text().substr(0, matchee.length).toLowerCase(); if ( thisText === matchee ) { if ( self._typeAhead_cycling ) { if ( nextIndex === null ) nextIndex = i; if ( i &gt; selectedIndex ) { nextIndex = i; break; } } else { nextIndex = i; } } } if ( nextIndex !== null ) { // Why using trigger() instead of a direct method to select the // index? Because we don't what is the exact action to do, it // depends if the user is typing on the element or on the popped // up menu multiselectSettings.inputs.eq(i).parent().trigger('mouseover'); multiselectSettings.inputs.eq(i).trigger( eventType ); // jQuery.each(multiselectSettings.inputs, function(index, elem){ // if($(elem).parent().has(&quot;.ui-state-hover&quot;) &amp;&amp; index!==i){ // $(elem).parent().removeClass(&quot;ui-state-hover&quot;); // } // }); // multiselectSettings.inputs.eq(i).parent().addClass(&quot;ui-state-hover&quot;); // multiselectSettings.inputs.eq(i).parent().focus(); } self._typeAhead_timer = window.setTimeout(function() { self._typeAhead_timer = undefined; self._typeAhead_chars = undefined; self._typeAhead_cycling = undefined; }, settings.typeAhead); }, /** * Método de inicialización del componente. * * @name jQuery.rup_combo#_init * @function * @private * @param {object} args - Parámetros de inicialización del componente. */ _init : function(args){ if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.initError&quot;) + $(this).attr(&quot;id&quot;)); } else { //Se recogen y cruzan las paremetrizaciones del objeto var settings = $.extend({}, $.fn.rup_combo.defaults, args[0]), html, loadAsLocal = false, isValidableElem = false, attrsJson = {}, attrs; //Se recoge el tabindex indicado en el elemento settings.tabindex = $(this).attr(&quot;tabindex&quot;); //Sobreescribir literales por defecto para multicombo $.extend($.ech.multiselect.prototype.options, $.rup.i18n.base[&quot;rup_combo&quot;][&quot;multiselect&quot;]); //Se carga el identificador del padre del patron settings.id = $.rup_utils.escapeId($(this).attr(&quot;id&quot;)); settings.name = $(this).attr(&quot;name&quot;); //Si no se recibe identificador para el acceso a literales se usa el ID del objeto if (!settings.i18nId){ settings.i18nId = settings.id; } //Guardar valor del INPUT settings.inputValue = $(&quot;#&quot;+settings.id).val()===null?$(&quot;#&quot;+settings.id).prop(&quot;value&quot;):$(&quot;#&quot;+settings.id).val(); attrs = $(this).prop(&quot;attributes&quot;); for (var i=0;i&lt; attrs.length;i++){ attrsJson[attrs[i].name] = attrs[i].value; } $.extend(attrsJson, { name: settings.name, ruptype: &quot;combo&quot; }); //Contenido combo html = $(&quot;&lt;select&gt;&quot;).attr(attrsJson).addClass(&quot;rup_combo&quot;); if ($(this).hasClass(&quot;validableElem&quot;)){ isValidableElem = true; html.addClass(&quot;validableElem&quot;); } if ($(this).hasClass(&quot;customelement&quot;)){ isValidableElem = true; html.addClass(&quot;customelement&quot;); } if(settings.firstLoad===null &amp;&amp; ($(this).is(&quot;select&quot;) &amp;&amp; settings.loadFromSelect)){ loadAsLocal = true; } if (settings.parent){ //DEPENDIENTE //Guardar referencia a hijos en cada uno de los padres (propagación de carga) $.map(settings.parent,function(item){ var childsArray = $('#'+item).data(&quot;childs&quot;)===undefined?[]:$('#'+item).data(&quot;childs&quot;); childsArray[childsArray.length] = settings.id; $('#'+item).data(&quot;childs&quot;, childsArray); }); if (settings.loadFromSelect===false){ if (settings.firstLoad!==null){ this._parseLOCAL(settings.firstLoad, settings, html); } //Crear combo y deshabilitarlo $(&quot;#&quot;+settings.id).replaceWith(html); }else{ $(&quot;#&quot;+settings.id).attr(&quot;ruptype&quot;,&quot;combo&quot;).removeClass().addClass(&quot;rup_combo&quot;); if (isValidableElem){ $(&quot;#&quot;+settings.id).removeClass().addClass(&quot;validableElem&quot;); } } this._makeCombo(settings); if(!($(this).is(&quot;select&quot;) &amp;&amp; settings.loadFromSelect)){ $(&quot;#&quot;+settings.id).rup_combo(&quot;disable&quot;); } else { var options = $(this).find(&quot;option&quot;); var vacio = true; for (var i=0; i&lt;options.size(); i=i+1){ if ($(options[i]).attr(&quot;value&quot;) !== &quot;&quot;){ vacio = false; break; } } if (vacio){ $(&quot;#&quot;+settings.id).rup_combo(&quot;disable&quot;); } } //Almacenar los settings $(&quot;#&quot;+settings.id).data(&quot;settings&quot;, settings); //Comprobar si los padres ya tienen datos seleccionados (si son LOCALES puede suceder) if (this._getParentsValues(settings.parent)!==null &amp;&amp; (settings.firstLoad===null &amp;&amp; settings.loadFromSelect===false)){ $(&quot;#&quot;+settings.id).rup_combo(&quot;reload&quot;, settings.id); } }else if (typeof settings.source === &quot;object&quot; || typeof settings.sourceGroup === &quot;object&quot; || loadAsLocal){ //LOCAL //Parsear datos if (settings.loadFromSelect===false){ if (settings.source) { this._parseLOCAL((settings.firstLoad!==null?settings.firstLoad:settings.source), settings, html); } else { settings.ordered = false; this._parseOptGroupLOCAL((settings.firstLoad!==null?settings.firstLoad:settings.sourceGroup), settings, html); } $(&quot;#&quot;+settings.id).replaceWith(html); }else{ $(&quot;#&quot;+settings.id).attr(&quot;ruptype&quot;,&quot;combo&quot;).removeClass().addClass(&quot;rup_combo&quot;); if (isValidableElem){ $(&quot;#&quot;+settings.id).removeClass().addClass(&quot;validableElem&quot;); } } //Crear combo this._makeCombo(settings); if(settings.onLoadSuccess!==null){ jQuery(settings.onLoadSuccess($(&quot;#&quot;+settings.id))); } //Almacenar los settings $(&quot;#&quot;+settings.id).data(&quot;settings&quot;, settings); } else if (typeof settings.source === &quot;string&quot; || typeof settings.sourceGroup === &quot;string&quot;){ //REMOTO var url = settings.source?settings.source:settings.sourceGroup, rupCombo = this, self = this; $.rup_ajax({ url: url, dataType: 'json', contentType: 'application/json', beforeSend: function (xhr){ rupCombo._ajaxBeforeSend(xhr, settings, html); }, success: function (data, textStatus, jqXHR){ rupCombo._ajaxSuccess(data, settings, html); if(settings.onLoadSuccess!==null){ jQuery(settings.onLoadSuccess($(&quot;#&quot;+settings.id))); } }, error: function(xhr, textStatus, errorThrown){ if(settings.onLoadError!==null){ jQuery(settings.onLoadError(xhr, textStatus, errorThrown)); }else{ self._ajaxError(xhr, textStatus, errorThrown); } } }); // delete rupCombo; //Almacenar los settings $(&quot;#&quot;+settings.id).data(&quot;settings&quot;, settings); } else if (typeof settings.source === &quot;function&quot; || typeof settings.sourceGroup === &quot;function&quot;){ jQuery(settings.source); this._makeCombo(settings); //Almacenar los settings $(&quot;#&quot;+settings.id).data(&quot;settings&quot;, settings); } //Asociar evento CHANGE para propagar cambios a los hijos $(&quot;#&quot;+settings.id).bind(&quot;change&quot;, function(event, ui) { // En caso de modificarse el valor del select, se actualiza el valor del rup.combo (con esta accion se recargan tambien los hijos) if (!settings.multiselect){ $(&quot;#&quot;+settings.id).rup_combo(&quot;select&quot;,$(&quot;#&quot;+settings.id).val()); }else{ $(&quot;#&quot;+settings.id).rup_combo(&quot;select&quot;,$(&quot;#&quot;+settings.id).rup_combo('getRupvalue')); } }); //Borrar referencia // delete html; //Ocultar posibles elementos de fechas/horas $(&quot;#&quot;+settings.id).next(&quot;a&quot;).click(function(event){ $(&quot;#ui-datepicker-div&quot;).hide(); }); } } }); //****************************************************** // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** /** * Función a ejecutar en caso de producirse un error a la hora de obtener los elementos a mostrar. * * @callback jQuery.rup_combo~onLoadError * @param {Object} xhr - Objeto XHR que contiene la respuesta de la petición realizada. * @param {string} textStatus - Texto que identifica el error producido. * @param {Object} errorThrown - Objeto error que contiene las propiedades del error devuelto en la petición. */ /** * Función a ejecutar en caso de producirse un error a la hora de obtener los elementos a mostrar. * * @callback jQuery.rup_combo~onLoadSuccess * @param {jQuery} self - Referencia al objeto jQuery del propio combo. */ /** * @description Opciones por defecto de configuración del componente. * * @name jQuery.rup_combo#defaults * * @property {jQuery.rup_combo~onLoadError} [onLoadError] - Función de callback a ejecutar en caso de que se produzca un error en la petición de obtención de la lista de elementos a mostrar. * @property {number} [width=200] - Determina el tamaño del combo. Su valor por defecto es 200 para la selección simple. En el caso de selección múltiple su declaración es obligatoria. * @property {string} [blank=null] - Se utiliza para declarar un valor independiente de la lógica del negocio. En ocasiones se representa como “Seleccione un elemento. * @property {string} [style=dropdown] - Tipo de visualización de la lista de opciones del combo. * @property {boolean} [showValue=false] - Determina si el combo debe mostrar el valor asociado concatenado al literal (sólo selección simple). * @property {string} [token=&quot;|&quot;] - Define el separador a utilizar cuando se muestra el valor asociado al combo concatenado al literal. * @property {string} [multiValueToken=&quot;##&quot;] - Define el separador a utilizar en combos enlazados locales. * @property {boolean} [ordered=true] - Indica si el combo debe ordenarse. * @property {boolean} [orderedByValue=false] - Indica si el la ordenación del combo debe realizarse por el valor de los elementos en lugar de por el texto. * @property {jQuery.rup_combo~onLoadSuccess} [onLoadSuccess=null] - Función de callback a ejecutar en el caso de que la petición de carga de datos se haya producido correctamente. * @property {boolean} [loadFromSelect=false] - Determina si se debe de utilizar los elementos option del elemento html sobre el que se inicializa el componente para inicializar los datos del elemento. * @property {boolean} [multiselect=false] - Indica si el combo permite la selección múltiple. * @property {boolean} [multiOptgroupIconText=false] - Indica si se desea que en la selección múltiple con grupos, el nombre del grupo tenga descripción en los iconos para seleccionar/deseleccionar los elementos del grupo. * @property {boolean} [submitAsString=false] - Indica si el envío de los elementos seleccionados en la selección múltiple se realiza como un literal separados por coma. * @property {boolean} [submitAsJSON=false] - Indica si el envío de los elementos seleccionados en la selección múltiple se realiza como un array JSON donde el nombre del mapa será el nombre del combo. En el caso de que el nombre contenga notación dot se tomará el último literal. Ej: [{id:1}, {id:2}, …]. * @property {boolean} [readAsString=false] - Determina si la asignación de un valor inicial se va a realizar a partir de un string con los ids de los elementos separados por comas en vez de un array de json. * @property {boolean} [rowStriping=false] - Indica si se debe aplicar un estilo diferente a las filas pares e impares para poder distinguirlas mediante un color diferente. * @property {number} [typeAhead=false] - Especifica en milisegundos el tiempo de espera que toma el componente antes de procesar los eventos de escritura realizados por el usuario. * @property {number} [legacyWrapMode=false] - Determina si se emplea el método obsoleto a la hora de empaquetar en objetos json los elementos seleccionados. Su propósito es mantener la retrocompatibilidad. */ $.fn.rup_combo.defaults = { onLoadError:null, width: 200, blank: null, style: &quot;dropdown&quot;, showValue: false, token: &quot;|&quot;, multiValueToken : &quot;##&quot;, ordered:true, orderedByValue:false, firstLoad:null, onLoadSuccess:null, loadFromSelect:false, multiselect:false, multiOptgroupIconText:true, submitAsString: false, submitAsJSON: false, readAsString: false, rowStriping : false, typeAhead:1000, legacyWrapMode:false }; })(jQuery); × Search results Close "},"rup.contextMenu.js.html":{"id":"rup.contextMenu.js.html","title":"Source: rup.contextMenu.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.contextMenu.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP ContextMenu. * @author EJIE * @version 2.4.10 */ (function ($) { //**************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //**************************************************************************************************************** /** * Un menú contextual consta de un menú dentro de una interfaz gráfica que se muestra a partir de una interacción del usuario. El menú contextual muestra una serie de opciones disponibles en el contexto o estado actual de la aplicación. * * @summary Componente RUP ContextMenu. * @namespace jQuery.rup_contextMenu * @memberOf jQuery * @tutorial rup_contextMenu * @example * var properties = { * items : { * &quot;edit&quot;: {name: &quot;Edit&quot;, icon: &quot;edit&quot;}, * &quot;cut&quot;: {name: &quot;Cut&quot;, icon: &quot;cut&quot;}, * &quot;copy&quot;: {name: &quot;Copy&quot;, icon: &quot;copy&quot;}, * &quot;paste&quot;: {name: &quot;Paste&quot;, icon: &quot;paste&quot;}, * &quot;delete&quot;: {name: &quot;Delete&quot;, icon: &quot;delete&quot;}, * &quot;sep1&quot;: &quot;---------&quot;, * &quot;quit&quot;: {name: &quot;Quit&quot;, icon: &quot;quit&quot;} * } * }; * * $('#contextMenu').rup_contextMenu(properties); */ var rup_contextMenu = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_contextMenu&quot;, rup_contextMenu)); //******************************* // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************* $.fn.rup_contextMenu(&quot;extend&quot;,{ /** * Muestra el menú contextual. * * @name jQuery.rup_contextMenu#show * @function * @example * $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;show&quot;); */ show: function(position){ $(this).contextMenu(position); }, /** * Oculta el menú contextual. * * @name jQuery.rup_contextMenu#hide * @function * @example * $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;hide&quot;); */ hide: function(){ $(this).contextMenu(&quot;hide&quot;); }, /** * Habilita el menú contextual. El menú se mostrará al lanzarse el evento asociado. * * @name jQuery.rup_contextMenu#enable * @function * @example * $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;enable&quot;); */ enable: function(){ $(this).contextMenu(true); }, /** * Deshabilita el menú contextual. El menú no se mostrará aunque se lance el evento asociado. * * @name jQuery.rup_contextMenu#disable * @function * @example * $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;disable&quot;); */ disable: function(){ $(this).contextMenu(false); }, /** * Elimina el menú contextual. * * @name jQuery.rup_contextMenu#destroy * @function * @example * $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;destroy&quot;); */ destroy: function(){ $.contextMenu('destroy', this.selector); } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* $.fn.rup_contextMenu(&quot;extend&quot;, { /** * Método de inicialización del componente. * * @name jQuery.rup_contextMenu#_init * @function * @private * @param {object} args - Parámetros de inicialización del componente. */ _init : function(args){ if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.initError&quot;) + $(this).attr(&quot;id&quot;)); } else { //Se recogen y cruzan las paremetrizaciones del objeto var $self = this, settings = $.extend({}, $.fn.rup_contextMenu.defaults, args[0]), background_image, background_position; //Asociar el selector settings.selector = $self.selector; //TODO:ejemplo de title en el contextMenu //Procesar items para i18n //Lanzar el plugin subyaciente jQuery.contextMenu(settings); /* Añadir el estilo para la modificación del estilo del puntero del ratón */ $self.addClass(&quot;context-menu-cursor&quot;); if (jQuery.rup.browser.isIE){ $self.css(&quot;cursor&quot;, settings.msieCursorCss); } /* Adecuar los cssSprites */ $.each($(&quot;.context-menu-list.context-menu-root&quot;), function(index, elem){ var $elem = jQuery(elem); if ($elem.data(&quot;contextMenuRoot&quot;).selector===settings.selector){ $elem.attr(&quot;id&quot;, $elem.data(&quot;contextMenuRoot&quot;).ns.substring(1)); $.each($(&quot;.context-menu-item&quot;), function(index, item){ var $item = jQuery(item), contextMenuKey = $item.data(&quot;contextMenuKey&quot;), cssSprite, itemCfg; if (contextMenuKey !== undefined){ itemCfg = settings.items[contextMenuKey]; if (itemCfg!==undefined){ cssSprite = itemCfg.cssSprite; if (cssSprite!==undefined &amp;&amp; !$item.hasClass(&quot;rup-css-sprite&quot;)){ $item.addClass(&quot;rup-css-sprite&quot;); $item.prepend($(&quot;&lt;span&gt;&quot;).addClass(cssSprite)); } if (itemCfg.id!==undefined){ $item.attr(&quot;id&quot;, itemCfg.id); } } } }); } }); } } }); //****************************************************** // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** /** * Función de callback a ejecutar cuando se muestra el menú contextual. * * @callback jQuery.rup_contextMenu~onShowEvent * @param {object} opt - Opciones de configuración. * @return {boolean} - En caso de devolver false no se termina mostrando el menú. */ /** * Función de callback a ejecutar cuando se oculta el menú contextual. * * @callback jQuery.rup_contextMenu~onHideEvent * @param {object} opt - Opciones de configuración. * @return {boolean} - En caso de devolver false no se termina ocultando el menú. */ /** * Función de callback a ejecutar a partir de los eventos indicados en la propiedad trigger. * * @callback jQuery.rup_contextMenu~position * @param {jQuery} $menu - Referencia jQuery al objeto propio. * @param {number} x - Coordenada x proporcionada por el evento de mostrar el menú. * @param {number} y - Coordenada y proporcionada por el evento de mostrar el menú. */ /** * Esta propiedad permite especificar una función de callback por defecto para aquellos ítems que no hayan especificado una función propia. * * @callback jQuery.rup_contextMenu~callback * @param {string} key - Key de la opción seleccionada. * @param {number} options - Opciones de configuración con los que se ha inicializado el componente. * @example * callback: function(key, options) { * alert(&quot;clicked: &quot; + key); * } */ /** * Función de callback que devuelve el objeto de configuración del componente. * * @callback jQuery.rup_contextMenu~build * @param {jQuery} $trigger - Referencia jQuery del objeto disparador del callback. * @param {object} e - Objeto event correspondiente al evento que desencadena el callback. * @return {object} - Objeto de configuración del componente. * @example * $(&quot;.contextMenu-other&quot;).rup_contextMenu({ * trigger: 'none', * build: function($trigger, e) { * return { * callback: function(key, options) { * alert(&quot;clicked: &quot; + key); * }, * items: { * &quot;edit&quot;: {name: &quot;Edit&quot;, icon: &quot;edit&quot;}, * &quot;cut&quot;: {name: &quot;Cut&quot;, icon: &quot;cut&quot;}, * &quot;copy&quot;: {name: &quot;Copy&quot;, icon: &quot;copy&quot;}, * &quot;paste&quot;: {name: &quot;Paste&quot;, icon: &quot;paste&quot;}, * &quot;delete&quot;: {name: &quot;Delete&quot;, icon: &quot;delete&quot;}, * &quot;sep1&quot;: &quot;---------&quot;, * &quot;quit&quot;: {name: &quot;Quit&quot;, icon: &quot;quit&quot;} * } * }; * } * }); */ /** * @description Propiedades de configuración del componente. * * @name jQuery.rup_contextMenu#options * @property {object} items - Objeto que define los elementos que van a mostrarse en el menú contextual. En el siguiente apartado se explicará más en detalle como realizar esta definición. * @property {string} [appendTo] - Selector de jQuery que identifica el elemento del DOM a partir del cual se va a añadir el menú contextual generado. * @property {string} [trigger] - Determina el evento que va a lanzar la visualización del menú contextual. (&quot;right&quot;,&quot;left&quot;, &quot;hover&quot;, &quot;none&quot;). * @property {boolean} [reposition] - Determina si un menú debe ser reposicionado (true) o reconstruido (false) en el caso de que el evento que lanza la visualización del menú contextual se ejecute por segunda vez. * @property {number} [delay=200] - Determina el tiempo de retardo antes de mostrar el menú contextual. Solo se aplica sobre el evento “hover”. * @property {boolean} [autoHide=false] - Indica si el menú contextual debe de ocultarse automáticamente cuando el cursor del ratón abandona la posición del menú contextual y el elemento que lo lanza. * @property {number} [zIndex=1] - Especifica el desplazamiento de zIndex que se aplica al calculado. * @property {string} [className] - Nombres de clases adicionales que se van a aplicar al menú contextual. * @property {object} animation - Determina la animación que se va a aplicar a la hora de mostrar/ocultar el menúcontextual. La configuración es la misma que la que utiliza para realizar la de los métodos show y hide de jQuery. * @property {object} [events] - Los eventos show y hide se ejecutan antes de el menú se muestre o se oculte. Mediante esta propiedad es posible indicar funciones de callback para ser ejecutadas en estos casos. Permiten devolver false para evitar continuar con el evento. * @property {jQuery.rup_contextMenu~onShowEvent} events.show - Función a ejecutar antes de que se muestre el menú. * @property {jQuery.rup_contextMenu~onHideEvent} events.hide - Función a ejecutar antes de que se oculte el menú. * @property {jQuery.rup_contextMenu~position} position - Función de callback que se ejecuta a partir de los eventos indicados en la propiedad trigger. * @property {string} determinePosition - Determina la posición del menú contextual de acuerdo al elemento disparador. * @property {jQuery.rup_contextMenu~callback} [callback] - Esta propiedad permite especificar una función de callback por defecto para aquellos ítems que no hayan especificado una función propia. * @property {jQuery.rup_contextMenu~build} [build] - Función de callback que devuelve el objeto de configuración del componente. En caso de especificar una función para la propiedad build la creación del menú no se realiza inicialmente sino que se demora hasta que se ejecuta el evento que lo muestra. * @property {boolean} [showCursor=true] - Determina si se va a modificar el estilo del puntero del ratón al posicionarse sobre el elemento que dispone de menú contextual. El tipo de puntero se determina mediante la clase CSS context-menu-cursor. * @property {string} [msieCursorCss=&quot;url(&quot;+$.rup.RUP+&quot;/basic-theme/cursors/context-menu.cur),default&quot;] - Esta propiedad se emplea para poder modificar la apariencia del cursor en Internet Explorer al posicionarse sobre un elemento que dispone de un menú contextual. Esto es debido a que el modo en el que hay que realizar la asignación del nuevo cursor no se puede realizar mediante un class */ $.fn.rup_contextMenu.defaults = { autoHide: true, showCursor:true, msieCursorCss:&quot;url(&quot;+$.rup.RUP+&quot;/basic-theme/cursors/context-menu.cur),default&quot; }; })(jQuery); × Search results Close "},"rup.dav.js.html":{"id":"rup.dav.js.html","title":"Source: rup.dav.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.dav.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Dav. * @author EJIE * @version 2.4.10 */ (function ($) { //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Permite al usuario editar online documentos almacenados en el servidor de aplicaciones. * * @summary Componente RUP Dav. * @namespace jQuery.rup_dav * @memberOf jQuery * @tutorial rup_dav * @example * jQuery.rup_dav.editOnline({ * url:&quot;webdavServlet/webdav.doc&quot;, * xlnetsAuth:true, * downloadOnError:true, * alternateDownloadURL:&quot;../upload?fileName=webdav.doc&quot; * }); */ jQuery.rup_dav = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón // $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_dav&quot;, rup_dav)); $.extend(jQuery.rup_dav,{ /** * TODO * * @name jQuery.rup_dav#editOnline * @function */ editOnline:function(args){ var url, settings; if (typeof args === &quot;string&quot;){ settings = jQuery.extend({}, jQuery.rup_dav.defaults, {url: args}); }else{ settings = jQuery.extend({}, jQuery.rup_dav.defaults, args); } // Se comprueba y completa la url jQuery.rup_dav._checkUrl(settings); // En caso de necesitarse se aplica if (settings.xlnetsAuth){ jQuery.rup_dav._xlnetsAuth(settings); } if ($.browser.msie === true){ jQuery.rup_dav._editOnlineIE(settings); }else{ jQuery.rup_dav._editOnlineFF(settings); } } }); $.extend(jQuery.rup_dav,{ _checkUrl:function(settings){ var tmpUrl=&quot;&quot;; if (settings.url.indexOf(location.protocol)=== -1){ // Se añade la sección de protocolo (http, https...) tmpUrl+=location.protocol + &quot;//&quot;; if (settings.url.indexOf(location.host)=== -1){ // Se añade la sección del host tmpUrl+=location.host; } if (settings.url.indexOf(CTX_PATH)=== -1){ // Se añade la sección del host tmpUrl+=CTX_PATH; } settings.url = tmpUrl + settings.url; } }, _xlnetsAuth:function(settings){ var n38UidSesionCookie = $.rup_utils.readCookie(&quot;n38UidSesion&quot;), n38DominioUidCookie = $.rup_utils.readCookie(&quot;n38DominioUid&quot;), urlParams = {}; if (n38UidSesionCookie !== undefined &amp;&amp; n38UidSesionCookie !== null &amp;&amp; n38UidSesionCookie !=='' ){ jQuery.extend(true, urlParams, {n38UidSesion: n38UidSesionCookie}); } if (n38DominioUidCookie !== undefined &amp;&amp; n38DominioUidCookie !== null &amp;&amp; n38DominioUidCookie !==''){ jQuery.extend(true, urlParams, {n38DominioUid: n38DominioUidCookie}); } if (!jQuery.isEmptyObject(urlParams)){ settings.url += &quot;?&quot;+settings.xlnetsAuthParam+&quot;=&quot;+jQuery.rup_utils.base64.encode(jQuery.param(urlParams)); } }, _editOnlineIE:function(settings){ var obj; // Gestión para Internet Explorer try{ // Microsoft Office 2007 y superiores obj = new ActiveXObject(&quot;SharePoint.OpenDocuments.3&quot;); obj.EditDocument(encodeURI(settings.url)); }catch(e){ try{ // Microsoft Office 2003 e inferiores obj = new ActiveXObject('Word.Application'); obj.Visible = true; obj.Documents.Open(encodeURI(settings.url)); }catch(e){ if (settings.downloadOnError===true){ // No se puede editar en línea, se descarga el archivo window.open(encodeURI(settings.alternateDownloadURL), '_blank'); } if (jQuery.isFunction(settings.fncErrorOnEditOnline)){ jQuery.proxy(settings.fncErrorOnEditOnline)(settings); } } } }, _editOnlineFF:function(settings){ var hownowPlugin, version; // Gestión para Firefox y Chrome try{ // Microsoft Office 2007 y superiores hownowPlugin = document.getElementById(&quot;winFirefoxPlugin&quot;); version = hownowPlugin.GetOfficeVersion(); hownowPlugin.EditDocument(settings.url, version); }catch(e){ if (settings.downloadOnError===true){ // No se puede editar en línea, se descarga el archivo window.open(encodeURI(settings.alternateDownloadURL), '_blank'); } if (jQuery.isFunction(settings.fncErrorOnEditOnline)){ jQuery.proxy(settings.fncErrorOnEditOnline)(settings); } } } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* $.rup_dav.defaults = { xlnetsAuth: false, xlnetsAuthParam:&quot;c&quot;, downloadOnError: false, alternateDownloadURL:null, fncErrorOnEditOnline:null }; })(jQuery); × Search results Close "},"rup.form.js.html":{"id":"rup.form.js.html","title":"Source: rup.form.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.form.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Form. * @author EJIE * @version 2.4.10 */ (function ($) { //********************************************* // ESPECIFICACÍON DE LOS TIPOS BASE DEL PATRÓN //********************************************* //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Permite al usuario introducir datos en una serie de campos para ser enviados al servidor y ser procesados. * * @summary Componente RUP Form. * @namespace jQuery.rup_form * @memberOf jQuery * @tutorial rup.form * @example * var properties={ * // Propiedades de configuración * }; * * $(&quot;#formulario&quot;).rup_form(properties); */ var rup_form = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_form&quot;, rup_form)); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** $.fn.rup_form(&quot;extend&quot;,{ /** * Realiza la misma función que ajaxSubmit. Se mantiene para asegurar la retrocompatibilidad con versiones anteriores. * * @name jQuery.rup_form#ajaxFormSubmit * @function * @param {object} options - Opciones de configuración. * @example * var options = {}; * jQuery(&quot;#form&quot;).rup_form(&quot;ajaxFormSubmit&quot;, options); */ ajaxFormSubmit:function(options){ var $self = this; // Actiavamos la gestión de las peticiones AJAX mediante la función $.rup_ajax. $.set_uda_ajax_mode_on(); $self.ajaxSubmit(options); }, /** * Realiza el envío del formulario. La configuración de este método es la misma que la de ajaxForm. * * @name jQuery.rup_form#ajaxSubmit * @function * @param {object} argOptions - Opciones de configuración. * @example * var options = {}; * jQuery(&quot;#form&quot;).rup_form(&quot;ajaxSubmit&quot;, options); */ ajaxSubmit:function(argOptions){ var $self = this, options = $.extend(true, {}, $.fn.rup_form.defaults, argOptions); // Actiavamos la gestión de las peticiones AJAX mediante la función $.rup_ajax. $.set_uda_ajax_mode_on(); $self.rup_form(&quot;configureOptions&quot;,options); if (options.formValidationRequired){ $self.rup_validate(options.validate); if ($self.valid()){ $(this).ajaxSubmit(options); } }else{ // Necesario utilizar $(this) para invocar al ajaxSubmit del plugin subyacente $(this).ajaxSubmit(options); } }, /** * Elimina la configuración realizada por el componente sobre el formulario html. * * @name jQuery.rup_form#destroy * @function * @example * var options = {}; * jQuery(&quot;#form&quot;).rup_form(&quot;destroy&quot;); */ destroy:function(){ var $self = this; $.removeData($self[0]); $self.ajaxFormUnbind(); $self.unbind(); }, /** * Serializa el contenido del formulario en un query string. * * @name jQuery.rup_form#formSerialize * @function * @return {string} - Retorna una cadena de texto con el formato nombre1=valor1&amp;nombre2=valor2. * @example * jQuery(&quot;#form&quot;).rup_form(&quot;formSerialize&quot;); */ formSerialize:function(){ var $self = this, fieldArray, element, ruptype, fieldArray = []; $.each($self.formToArray(), function(key, obj){ element = $(&quot;[name='&quot;+obj.name+&quot;']&quot;,self); ruptype = element.attr(&quot;ruptype&quot;); if (ruptype!==undefined){ obj.value=element[&quot;rup_&quot;+ruptype](&quot;getRupValue&quot;); fieldArray.push(obj); }else{ fieldArray.push(obj); } }); return $.param(fieldArray); }, /** * Realiza la serialización de campos del formulario en un objeto json. * * @name jQuery.rup_form#formToJson * @function * @return {string} - Retorna un objeto con el formato {nombre1:valor1, nombre2:valor2…nombreN:valorN}. * @example * jQuery(&quot;#form&quot;).rup_form(&quot;formToJson&quot;); */ formToJson:function(){ return form2object(this[0]); }, /** * Realiza la serialización de campos del formulario en un query string * * @name jQuery.rup_form#fieldSerialize * @function * @return {string} - Retorna una cadena de texto con el formato nombre1=valor1&amp;nombre2=valor2. * @example * jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;fieldSerialize&quot;); */ fieldSerialize:function(){ var a = []; this.each(function() { var n = $(this).attr(&quot;name&quot;); if (!n) { return; } var v = $(this).rup_form(&quot;fieldValue&quot;); if (v &amp;&amp; v.constructor == Array) { for (var i=0,max=v.length; i &lt; max; i++) { a.push({name: n, value: v[i]}); } } else if (v !== null &amp;&amp; typeof v != 'undefined') { a.push({name: $(this).attr(&quot;name&quot;), value: v}); } }); return $.param(a); }, /** * Devuelve un array con el valor de los campos indicados. * * @name jQuery.rup_form#fieldSerialize * @function * @return {string[]} - Retorna una cadena de texto con el formato nombre1=valor1&amp;nombre2=valor2. * @example * jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;fieldValue&quot;); */ fieldValue:function(){ var valuesArray=[], value; this.each(function() { var ruptype = $(this).attr(&quot;ruptype&quot;); if (ruptype!==undefined){ value = $(this)[&quot;rup_&quot;+ruptype](&quot;getRupValue&quot;); valuesArray.push(value); }else{ $.merge(valuesArray,$(this).fieldValue()); } }); return valuesArray; }, /** * Inicializa el formulario con su estado inicial invocando al método reset nativo. * * @name jQuery.rup_form#resetForm * @function * @return {jQuery} - Retorna el propio componente. * @example * jQuery(&quot;#form&quot;).rup_form(&quot;resetForm&quot;); */ resetForm:function(){ return this.each(function() { $(this).resetForm(); }); }, /** * Limpia los elementos del formulario. * * @name jQuery.rup_form#clearForm * @function * @param {boolean} includeHidden - Determina si se deben de limpiar también los elementos hidden que existen en el formulario. * @return {jQuery} - Retorna el propio componente. * @example * // Limpiar los campos del formulario * jQuery(&quot;#form&quot;).rup_form(&quot;clearForm&quot;); * // Limpiar los campos del formulario inlcuyendo los campos hidden * jQuery(&quot;#form&quot;).rup_form(&quot;clearForm&quot;, true); */ clearForm:function(includeHidden){ return this.each(function() { $('input,select,textarea', this).rup_form(&quot;clearFields&quot;,includeHidden); }); }, /** * Limpia los campos especificados mediante el selector de jQuery. * * @name jQuery.rup_form#clearFields * @function * @param {boolean} includeHidden - Determina si se deben de limpiar también los elementos hidden que existen en el formulario. * @return {jQuery} - Retorna el propio componente. * @example * // Limpiar los campos del formulario * jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;clearFields&quot;); * // Limpiar los campos del formulario inlcuyendo los campos hidden * jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;clearFields&quot;, true); */ clearFields:function(includeHidden){ return this.each(function() { var ruptype = $(this).attr(&quot;ruptype&quot;); if (ruptype === undefined || ruptype!==&quot;combo&quot;){ $(this).clearFields(includeHidden); }else{ $(this).rup_combo(&quot;clear&quot;); } }); }, /** * Función de inicialización del componente. Es un método de uso interno. No debería de invocarse de manera directa. * * @name jQuery.rup_form#configureOptions * @function * @param {object} settings - Propiedades de configuración */ configureOptions:function(settings){ var $self = this, hasFileInputs, beforeSendUserEvent, beforeSubmitUserEvent; if (settings.url!==null){ $self.attr(&quot;action&quot;, settings.url); } hasFileInputs = $('input:file', $self).length &gt; 0; if (settings.useJsonIfPossible &amp;&amp; !hasFileInputs){ settings.contentType='application/json'; } // BeforeSend beforeSendUserEvent = settings.beforeSend; settings.beforeSend = function (xhr, ajaxOptions) { var ret = true; if($.isFunction(beforeSendUserEvent)){ ret = beforeSendUserEvent.call(this,xhr, ajaxOptions); } if (ret === false){ return false; }else if (ret !== &quot;skip&quot;){ if(ajaxOptions.contentType.indexOf(&quot;application/json&quot;)!==-1){ var jsonData = $self.rup_form(&quot;formToJson&quot;); if (settings.multimodel!==null){ xhr.setRequestHeader(&quot;RUP_MULTI_ENTITY&quot;, &quot;true&quot;); jsonData[&quot;rupEntityMapping&quot;]=settings.multimodel; } if (ajaxOptions.extraData!==undefined &amp;&amp; ajaxOptions.extraData!==null){ $.extend(jsonData, ajaxOptions.extraData); } ajaxOptions.data=$.toJSON(jsonData); } } }; // BeforeSubmit beforeSubmitUserEvent = settings.beforeSubmit; settings.beforeSubmit = function (arr, $form, options) { var httpMethod, error_user, hasFileInputs; if($.isFunction(beforeSubmitUserEvent)){ if (beforeSubmitUserEvent.call(this,arr, $form, options)===false){ return false; } } hasFileInputs = jQuery('input:file', $form).length &gt; 0; // Implementacion para realizar la emulacion de xhr al utilizar iframes if ((!$.rup.browser.xhrFileUploadSupport &amp;&amp; hasFileInputs) || options.iframe===true){ // Configuracion necesaria para permitir con iframes el uso de metodos http diferentes a GET o POST httpMethod = settings.type!==undefined ? settings.type : options.type; if ($.inArray(httpMethod.toUpperCase(),$.rup.IFRAME_ONLY_SUPPORTED_METHODS) === -1){ options.extraData = $.extend({}, options.extraData, {&quot;_method&quot;:httpMethod.toUpperCase()}); } //Se valida la presencia de portal y, llegados al caso, se adecuan las llamadas ajax para trabajar con portales options.url=$.rup_utils.setNoPortalParam(options.url); // Envio del parametro emulate_iframe_http_status para activar la emulacion en el lado servidor options.extraData = $.extend({}, options.extraData, {&quot;_emulate_iframe_http_status&quot;:&quot;true&quot;}); options.url = options.url + (options.url.match(&quot;\\\\?&quot;) === null ? &quot;?&quot; : &quot;&amp;&quot;) + &quot;_emulate_iframe_http_status=true&quot;; // Callback de error por defecto a ejecutar cuando se produzca un error al utilizar la emulacion error_user = options.error; options.error = function(xhr, textStatus, errorThrown){ var errorText = $.rup.rupAjaxDefaultError(xhr, textStatus, errorThrown); // Si se ha producido un error de los tratados lo mostramos if (error_user!=null){ $(error_user(xhr, textStatus, errorThrown)); }else{ if(errorText){ $.rup.showErrorToUser(errorText); } } }; } }; settings.formValidationRequired = (settings.validate!==undefined); // Configruacion de las validaciones if (settings.formValidationRequired){ if (settings.error===undefined){ settings.error = function(a,b,c,d){ try{ var json = jQuery.parseJSON(a.responseText); $self.validate().invalid=json.rupErrorFields; $self.validate().submited=json.rupErrorFields; $self.validate().showErrors(json.rupErrorFields); if (json.rupFeedback!==undefined &amp;&amp; $self.validate().settings.feedback!==undefined){ $self.validate().settings.feedback.rup_feedback(&quot;set&quot;, $.rup_utils.printMsg(json.rupFeedback.message), (json.rupFeedback.imgClass!==undefined?json.rupFeedback.imgClass:null)); } }catch(ex){ $self.validate().settings.feedback.rup_feedback(&quot;set&quot;, a.responseText, &quot;error&quot;); } }; } settings.validate.submitHandler = function(form) { jQuery(form).ajaxSubmit($(form).data(&quot;ajaxSettings&quot;)); }; settings.validate.feedback=settings.feedback; } $self.data(&quot;ajaxSettings&quot;, settings); $self.data(&quot;settings&quot;, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** $.fn.rup_form(&quot;extend&quot;,{ }); $.fn.rup_form(&quot;extend&quot;,{ /** * Función de inicialización del componente. * * @name jQuery.rup_form#_init * @function * @private * @param {object} args - Propiedades de configuración. */ _init : function(args){ var $self = this, realizarValidacion, settings, ajaxFormSettings={}, userSettings={}; // Determinamos si se ha introducido configuracion para el componente validacion. // Settings de configuracion settings = $.extend(true, {}, $.fn.rup_form.defaults, args[0]); // Anadimos al formulario el class rup_form para identificarlo como componente formulario. $self.addClass(&quot;rup_form&quot;); $self.attr(&quot;ruptype&quot;,&quot;form&quot;); $self.rup_form(&quot;configureOptions&quot;,settings); // En caso de que no sehaya configurado el componente validacion se realiza la llamada al plugin jquery.form. if (settings.formValidationRequired){ $self.rup_validate(settings.validate); }else{ $self.ajaxForm(settings); } } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* /** * Función de callback que será invocada antes de realizarse la serialización del formulario. * * @callback jQuery.rup_form~beforeSerialize * @param {jQuery} $form - Referencia del objeto jQuery del formulario. * @param {object} options - Opciones de configuración con las que se ha inicializado el componente. * @return {boolean} - En caso de devolver false se cancela el envío del formulario. * @example * $(&quot;#form&quot;).rup_form({ * beforeSerialize: function($form, options) { ... } * }); */ /** * Función de callback que será invocada antes de realizarse el envío del formulario. * * @callback jQuery.rup_form~beforeSubmit * @param {object[]} arr - Array que contiene la información introducida en el formulario. El array tiene el siguiente formato : [ { name: 'username', value: 'jresig' }, { name: 'password', value: 'secret' } ] * @param {jQuery} $form - Referencia del objeto jQuery del formulario. * @param {object} options - Opciones de configuración con las que se ha inicializado el componente. * @return {boolean} - En caso de devolver false se cancela el envío del formulario. * @example * $(&quot;#form&quot;).rup_form({ * beforeSubmit: function(arr, $form, options) { ... } * }); */ /** * Función de callback que será invocada cuando se produzca un error. * * @callback jQuery.rup_form~error * @example * $(&quot;#form&quot;).rup_form({ * error: function() { ... } * }); */ /** * Función de callback que será invocado cuando se reciba la respuesta del formulario. * * @callback jQuery.rup_form~suceess * @param {string} responseText - Texto identificador de la respuesta obtenida. * @param {string} statusText - Código de respuesta http. * @param {object} xhr - Objeto xhr con la respuesta enviada del servidor. * @param {jQuery} $form - Referencia jQuery al componente formulario. * @example * $(&quot;#form&quot;).rup_form({ * suceess: function(responseText, statusText, xhr, $form) { ... } * }); */ /** * Función de callback que será invocado cuando se reciba la respuesta del formulario. * * @callback jQuery.rup_form~uploadProgress * @param {Event} event - Objeto Event procedente del navegador. * @param {Integer} position - Numero que determina el contenido enviado. * @param {Integer} total - Numero que identifica el total del contenido a enviar. * @param {Integer} percentComplete - Numero que identifica el porcentaje actual completado en el proceso de envío. * @example * $(&quot;#form&quot;).rup_form({ * uploadProgress: function(event, position, total, percentComplete) { ... } * }); */ /** * Opciones por defecto de configuración del componente. * @name jQuery.rup_form#options * * @property {jQuery.rup_form~beforeSerialize} [beforeSerialize=null] - Función de callback que será invocada antes de realizarse la serialización del formulario. Permite la modificación de los datos del formulario antes de que estos sean recuperados para su procesado por el componente. * @property {jQuery.rup_form~beforeSubmit} [beforeSubmit=null] - Función de callback que será invocada antes de realizarse el envío del formulario. Permite acceder a la información que será enviada al formulario. En caso de retornar false no se realizará en envío. * @property {boolean} [clearForm=null] - Propiedad booleana que determina si el formulario debe de limpiarse después de realizar el envío. * @property {object} [data] - Mediante esta propiedad es posible especificar parámetros extra que sean enviados alservidor. * @property {string} [dataType] - Tipo de datos esperados en la respuesta. Los valores posibles son null, xml, json y script. * @property {jQuery.rup_form~error} [error] - Función de callback que será invocada cuando se produzca un error. * @property {boolean} [forceSync=false] - Propiedad booleana. En caso de ser true elimina la corta espera que se produce antes de enviar el formulario cuando se envían ficheros o se utiliza la opción de iframe. La espera se utiliza para permitir al navegador actualizar modificaciones realizadas en el DOM antes de que se realice el envío de los datos. * @property {boolean} [iframe=false] - Determina si el formulario debe de ser enviado siempre mediante un iframe. * @property {string} [iframeSrc] - Propiedad de texto que deberá ser utlizada siempre en conjunción con la propiedad iframe. Por defecto, about:blank. Por defecto para páginas que utlicen el protocolo https, javascript:false. * @property {string} [iframeTarget=null] - Identifica el iframe que será utilizado como target en la respuesta en los envíos de ficheros. Por defecto, el componente creará un iframe temporal para capturar la respuesta del envío de ficheros. * @property {boolean | object} [multimodel=false] - Permite especificar la configuración que se deberá de aplicar a la hora de realizar el envío de varias entidades en la misma petición. La configuración de este parámetro se detalla en el apartado 9.2. * @property {boolean} [replaceTarget=false] - Opcionalmente se utililiza junto con la opción target. En caso de ser true el elemento identificado en la opción target será reemplazado. En caso de ser false solo su contenido será reemplazado. * @property {boolean} [resetForm=false] - Propiedad booleana que determina si el formulario debe ser inicializado al realizarse el envío del mismo. * @property {bolean} [semantic=false] - Propiedad booleana que determina si los campos del formulario deben ser enviado en estricto orden semántico. Por defecto la serialización normal del formulario se realiza en orden semántico exceptuando los campos img. * @property {jQuery.rup_form~suceess} [suceess] - Método callback que será invocado cuando se reciba la respuesta del formulario. * @property {string | jQuery | Element} [target] - Identifica los elementos de la página que deberán ser actualizados con la respuesta del servidor. El target puede ser indicado mediante un selector de jQuery, un objeto de jQuery o un objeto DOM. * @property {string} [type] - Detemina el método con el que se enviará el formulario, GET o POST. Por defecto el valor de la propiedad method indicada en el formulario o GET en caso de no encontrarse. * @property {jQuery.rup_form~uploadProgress} [uploadProgress=null] - Método que será invocado con información de progreso del envío del formulario (en caso de estar soportado por el navegador). * @property {string} [url] - URL a la cual se realizará en envío del formulario. Por defecto el valor indicado en la propiedad action del formulario. * @property {boolean} [useJsonIfPossible=true] - Mediante este parámetro se especifica al componente que debe de utilizar el formato application/json como prioridad (siempre que sea posible) al realizar el envío del formulario. */ $.fn.rup_form.defaults = { ajaxForm:null, feedback:null, multimodel:null, useJsonIfPossible:true // En caso de ser posible realizar en envío mediante json se enviarán los datos en este formato. }; })(jQuery); × Search results Close "},"rup.lang.js.html":{"id":"rup.lang.js.html","title":"Source: rup.lang.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.lang.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /* Plugin que genera la combo de idiomas con el siguiente formato. &lt;ul&gt; &lt;li id=&quot;idiomaActivo&quot; class=&quot;activo&quot;&gt;Castellano &lt;/li&gt; &lt;li id=&quot;enlace&quot; class=&quot;ultimo cambio_idioma&quot; &gt; &lt;a href=&quot;#&quot;&gt;Cambiar Idioma&lt;/a&gt; &lt;/li&gt; &lt;li id=&quot;listado&quot; class=&quot;ultimo cambio_idioma_desplegado&quot; style=&quot;display: none;&quot;&gt; &lt;div class=&quot;caja_idiomas&quot;&gt; &lt;a id=&quot;caja_listado&quot; class=&quot;opcion_cambio&quot; &gt;Cambiar Idioma&lt;/a&gt; &lt;div class=&quot;listado_idiomas&quot;&gt; &lt;a id=&quot;cerrar&quot; class=&quot;cerrar_idiomas&quot; href=&quot;#&quot; title=&quot;Cerrar&quot;&gt;&lt;span class=&quot;hidden&quot;&gt;Cerrar&lt;/span&gt;&lt;/a&gt; &lt;ul class=&quot;principal&quot;&gt; &lt;li id=&quot;idioma_es&quot; class=&quot;activo&quot;&gt; &lt;a class=&quot;idioma&quot;&gt;Castellano&lt;/a&gt; &lt;/li&gt; &lt;li id=&quot;idioma_eu&quot;&gt; &lt;a class=&quot;idioma&quot;&gt;Euskera&lt;/a&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; */ /** * @fileOverview Implementa el patrón RUP Language. * @author EJIE * @version 2.4.10 */ (function ($) { /** * El componente de idioma esta diseñado para permitir al usuario elegir, de forma intuitiva, el idioma en el que se presenta la aplicación. * * @summary Componente RUP Language. * @namespace jQuery.rup_language * @memberOf jQuery * @tutorial rup.language * @example * var properties={ * // Propiedades de configuración * }; * * $(&quot;#idlanguage&quot;).rup_language(properties); */ $.widget(&quot;$.rup_language&quot;, { options: { languages: null, active: null, modo: &quot;&quot; //portal }, /** * Función encargada de crear en el DOM los elementos necesarios para el componente. * * @name jQuery.rup_language#_create * @function * @private */ _create: function () { this.options.active = $.rup.lang==null?&quot;[lang]&quot;:$.rup.lang, active = this.options.active; this.options.languages = $.rup.AVAILABLE_LANGS.split(&quot;,&quot;); var self = this.element, aChangeLang = $(&quot;&lt;a&gt;&quot;).attr(&quot;id&quot;, &quot;rup_language_choice&quot;).addClass(&quot;rup-language_change_option&quot;).text($.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguage&quot;)); //gestion de estilos de jquery-ui $(self).addClass(&quot;ui-widget&quot;); if (this.options.modo === &quot;portal&quot;){ var ul = $(&quot;&lt;ul&gt;&quot;).addClass(&quot;rup-language_portal&quot;), lng_lenght = $(this.options.languages).size(); $.each(this.options.languages, function (key, value) { value = value.replace(/^\\s*|\\s*$/g,&quot;&quot;); var txt = $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+value+&quot;_short&quot;); if(value !== active){ $(&quot;&lt;li&gt;&quot;).append($(&quot;&lt;a&gt;&quot;).attr(&quot;href&quot;, &quot;?&quot;+$.rup.LOCALE_PARAM_NAME+&quot;=&quot; + value).text(txt).addClass(&quot;rup-language_portal_list ui-corner-all&quot;) .attr(&quot;title&quot;, $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguageLiteral_&quot;+value)+$.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+value))) .appendTo(ul); } else { $(&quot;&lt;li&gt;&quot;).addClass(&quot;ui-state-active&quot;).append($(&quot;&lt;a&gt;&quot;).attr(&quot;href&quot;, &quot;javascript:void(0);&quot;).text(txt).addClass(&quot;rup-language_portal_list_active ui-corner-all&quot;) .attr(&quot;title&quot;, $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguageLiteral&quot;)+$.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+value))) .appendTo(ul); } //div.appendTo(ulPrincipal); if (key &lt; lng_lenght-1){ ul.append($(&quot;&lt;div&gt;&quot;).html(&quot;|&quot;).addClass(&quot;rup-language_portal_separator&quot;)); } }); self.append(ul); } else { // Carga de los valores por defecto para los atributos que no ha introducido el usuario var ul = $(&quot;&lt;ul&gt;&quot;).attr(&quot;id&quot;,&quot;ulGeneral&quot;), timerID, liIdiomaActivo = $(&quot;&lt;li&gt;&quot;).attr(&quot;id&quot;, &quot;rup_active_language&quot;).addClass(&quot;rup-language_active&quot;).text($.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+this.options.active)) .attr(&quot;title&quot;, $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguageLiteral&quot;)+$.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+active)), liEnlace = $(&quot;&lt;li&gt;&quot;).addClass(&quot;rup-language_change&quot;).attr(&quot;id&quot;, &quot;rup_language_link&quot;), liListado = $(&quot;&lt;li&gt;&quot;).attr(&quot;id&quot;, &quot;rup_language_list&quot;).addClass(&quot;rup-language_change_opened&quot;).css(&quot;visibility&quot;, &quot;hidden&quot;), divCajaIdiomas = $(&quot;&lt;div&gt;&quot;), listadoIdiomas = $(&quot;&lt;div&gt;&quot;).addClass(&quot;rup-language_language_list&quot;), cerrarIdioma = $(&quot;&lt;a&gt;&quot;) .addClass(&quot;rup-language_close_languages&quot;) .attr(&quot;id&quot;, &quot;rup_language_close&quot;) .attr(&quot;href&quot;, &quot;#&quot;) .attr(&quot;title&quot;, $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.closingLiteral&quot;)) .html($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.cerrar&quot;)), ulPrincipal = $(&quot;&lt;ul&gt;&quot;); ul.append(liIdiomaActivo); $(&quot;&lt;a&gt;&quot;).attr(&quot;href&quot;, &quot;#&quot;).text($.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguage&quot;)).appendTo(liEnlace); ul.append(liEnlace); divCajaIdiomas.append(aChangeLang); listadoIdiomas.append(cerrarIdioma); $.each(this.options.languages, function (key, value) { value = value.replace(/^\\s*|\\s*$/g,&quot;&quot;); var liIdioma = $(&quot;&lt;li&gt;&quot;).attr(&quot;id&quot;, &quot;rup_language_lng_&quot; + value), txt = $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+value); if(value !== active){ $(&quot;&lt;a&gt;&quot;).appendTo(liIdioma).attr(&quot;href&quot;, &quot;?&quot;+$.rup.LOCALE_PARAM_NAME+&quot;=&quot; + value).text(txt) .attr(&quot;title&quot;, $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguageLiteral_&quot;+value)+$.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+value)); } else { //hacemos que sea el lenguage actual el activo $(&quot;&lt;a&gt;&quot;).appendTo(liIdioma).attr(&quot;href&quot;, &quot;javascript:void(0);&quot;).text(txt) .attr(&quot;title&quot;, $.rup.i18nParse($.rup.i18n.base,&quot;rup_language.changeLanguageLiteral&quot;)+$.rup.i18nParse($.rup.i18n.base,&quot;rup_language.&quot;+value)); } liIdioma.appendTo(ulPrincipal); }); listadoIdiomas.append(ulPrincipal); divCajaIdiomas.append(listadoIdiomas); liListado.append(divCajaIdiomas); ul.append(liListado); self.append(ul); var ajust = listadoIdiomas.css(&quot;width&quot;,&quot;0.8em&quot;).width(); var saveMargin = liEnlace.css(&quot;margin-right&quot;); liEnlace.css(&quot;margin-right&quot;,&quot;0px&quot;); listadoIdiomas.width((liListado.position()).left - ajust); listadoIdiomas.css(&quot;padding-left&quot;,&quot;0.6em&quot;); listadoIdiomas.css(&quot;padding-right&quot;,&quot;0.2em&quot;); listadoIdiomas.css(&quot;top&quot;,liIdiomaActivo.height()-1); liListado.hide(); liListado.css(&quot;visibility&quot;,&quot;&quot;); liEnlace.css(&quot;margin-right&quot;,saveMargin); //se aplica el lenguage actual el activo $(&quot;#rup_language_lng_&quot; + $.rup.lang).addClass(&quot;ui-state-active&quot;); //evento click para mostrar el listado de idiomas liEnlace.click(function () { liEnlace.hide(); liListado.show(); $(&quot;.rup-language_language_list&quot;).find(&quot;li:not(.rup-language_language_list_active)&quot;).first().children(&quot;a&quot;).focus(); }); //evento del enlace de cambio de idioma aChangeLang.click(function () { liListado.hide(); liEnlace.show(); }); //evento del boton de cerrar cerrarIdioma.click(function () { liListado.hide(); liEnlace.show(); }); // gestion de eventos del raton sobre la parte del cambio de idioma liListado.mouseenter(function () { self.one(&quot;mouseleave&quot;, function () { liListado.hide(); liEnlace.show(); }); }); self.bind(&quot;keydown&quot;, function (event) { switch (event.keyCode) { case $.ui.keyCode.UP: if ($(event.target).parent().prevAll(&quot;li:not(.rup-language_language_list_active)&quot;).length &gt; 0) { $(event.target).parent().prevAll(&quot;li:not(.rup-language_language_list_active)&quot;).first().children().focus(); } else { $(event.target).parent().siblings(&quot;li:not(.rup-language_language_list_active)&quot;).last().children().focus(); } break; case $.ui.keyCode.DOWN: if ($(event.target).parent().nextAll(&quot;li:not(.rup-language_language_list_active)&quot;).length &gt; 0) { $(event.target).parent().nextAll(&quot;li:not(.rup-language_language_list_active)&quot;).first().children().focus(); } else { $(event.target).parent().siblings(&quot;li:not(.rup-language_language_list_active)&quot;).first().children().focus(); } break; case $.ui.keyCode.ESCAPE: liListado.hide(); liEnlace.show(); break; default: } }); } // Se aplica el tooltip self.find(&quot;[title]&quot;).rup_tooltip({&quot;applyToPortal&quot;: true}); }, /** * Modifica las opciones de configuración del componente. * * @name jQuery.rup_language#_setOption * @function * @private */ _setOption: function (key, value) { $.Widget.prototype._setOption.apply(this, arguments); }, /** * Elimina el componente. * * @name jQuery.rup_language#destroy * @function * @example * $(&quot;#idlanguage&quot;).rup_language(&quot;destroy&quot;); */ destroy: function () { $.Widget.prototype.destroy.apply(this, arguments); } }); /** * Opciones por defecto de configuración del componente. * @name jQuery.rup_language#options * * @property {object} languages - Conjunto de idiomas que serán gestionados con el componente. El listado de los mismos, por configuración general, se gestiona a través de la variable jQuery “$.rup.AVAILABLE_LANGS_ARRAY”. Para mas información, consultar el documento “Anexo-Gestion_idiomatica.doc” de la documentación de UDA. * @property {string} [modo] - Determina el tipo de maquetación que utilizara el componente para presentar las diferentes opciones idiomáticas. Si el valor especificado es “portal”, los idiomas se presentaran en un listado horizontal separado por barras (ver ejemplo visual del capítulo/Sección “2. Ejemplo”). En cualquier otro caso, se mostrara el modo por defecto (ver ejemplo visual del capítulo/Sección “2. Ejemplo”). */ })(jQuery); × Search results Close "},"rup.message.js.html":{"id":"rup.message.js.html","title":"Source: rup.message.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.message.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Message. * @author EJIE * @version 2.4.10 */ (function ($) { //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Tiene como objetivo mostrar al usuario de forma homogénea, clara y llamativa, los posibles mensajes que pueden desencadenar las acciones en la aplicación. Estos mensajes predefinidos pueden ser de diferente tipología: error, confirmación, aviso o alerta. * * @summary Componente RUP Message. * @namespace jQuery.rup_messages * @memberOf jQuery * @tutorial rup_messages * @example * $.rup_messages(&quot;msgOK&quot;, { * title: &quot;Correcto&quot;, * message: &quot;Todo ha ido OK.&quot; * }); */ var rup_messages = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupObjectConstructor(&quot;rup_messages&quot;, rup_messages)); window.alert = function (text) { $.rup_messages(&quot;msgAlert&quot;, {title: $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.alert&quot;), message: text}); }; //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** /** * Función a ejecutar justo antes de que se cierre la ventana. * * @callback jQuery.rup_messages~beforeCloseCallback * @param {Object} event - Objeto Event de jQuery. */ /** * Función a ejecutar cuando el usuario pulsa el botón de Aceptar. * * @callback jQuery.rup_messages~OKFunctionCallback * @param {Object} event - Objeto Event de jQuery. * @param {Object} ui - Objeto de tipo jQueryUi Dialog. */ /** * Función a ejecutar cuando el usuario pulsa el enlace de Cancelar. * * @callback jQuery.rup_messages~CANCELFunctionCallback * @param {Object} event - Objeto Event de jQuery. * @param {Object} ui - Objeto de tipo jQueryUi Dialog */ $.rup_messages(&quot;extend&quot;, { /** * Muestra un mensaje de error. * * @name jQuery.rup_messages#msgError * @function * @param {Object} properties - Objeto de configuración del mensaje de error. * @param {String} properties.title - Función a ejecutar justo antes de que se cierre la ventana. * @param {String} properties.message - El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. * @param {jQuery.rup_messages~beforeCloseCallback} properties.beforeClose - Texto que aparecerá en la barra del titulo del mensaje. * * @example * // Mostrar un mensaje de error. * $.rup_messages(&quot;msgError&quot;, { * title: &quot;Error grave&quot;, * message: &quot;&lt;p&gt;Se ha producido un error a la hora de intentar guardar el registro.&lt;br&gt;Consulte con el administrador.&lt;/p&gt;&quot; * }); */ msgError : function (properties) { //Se recogen y cruzan las paremetrizaciones del objeto var settings = $.extend({}, $.rup_messages.defaults, properties), docHeight, docWidth, focused = $(document.activeElement); this._rupProperties(settings, $.rup.i18nParse($.rup.i18n.base, &quot;rup_message.tituloError&quot;)); settings._close = settings.close; settings.close = function(event, ui) { focused.focus(); if (settings._close!==undefined){settings._close(event,ui);} }; //parámetros específicos de tipo de mensaje settings.buttons = [{ text: $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.aceptar&quot;), click: function () { self.dialog(&quot;close&quot;); } }]; var self = this._createDiv().appendTo(&quot;body&quot;); self.dialog(settings); this._createCloseLink(self); this._addStyles(self, &quot;error&quot;, settings.message); docHeight = $(document).height(); docWidth = $(document).width(); self.dialog(&quot;open&quot;); this._dialogInPortal(docWidth, docHeight, self, settings); }, /** * Muestra un mensaje de confirmación. * * @name jQuery.rup_messages#msgConfirm * @function * @param {Object} properties - Objeto de configuración del mensaje de error. * @param {String} properties.title - Texto que aparecerá en la barra del titulo del mensaje. * @param {String} properties.message - El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. * @param {jQuery.rup_messages~beforeCloseCallback} properties.beforeClose - Función a ejecutar justo antes de que se cierre la ventana. * @param {jQuery.rup_messages~OKFunctionCallback} properties.OKFunction - Función a ejecutar cuando el usuario pulsa el botón de Aceptar. * @param {jQuery.rup_messages~CANCELFunctionCallback} properties.CANCELFunction - Función a ejecutar cuando el usuario pulsa el enlace de Cancelar. * @example * // funciones de callback. * function acceptClicked() { alert(&quot;Ha pulsado aceptar.&quot;); } * function cancelClicked() { alert(&quot;Ha pulsado cancelar.&quot;); } * * // Mostrar un mensaje de error. * $.rup_messages(&quot;msgConfirm&quot;, { * title: &quot;Confirmación&quot;, * message: &quot;¿Está seguro que desea cancelar?&quot;, * OKFunction : acceptClicked, * CANCELFunction : cancelClicked * }); */ msgConfirm : function (properties) { //Se recogen y cruzan las paremetrizaciones del objeto var settings = $.extend({}, $.rup_messages.defaults, properties), docHeight, docWidth, focused = $(document.activeElement); this._rupProperties(settings, $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.confirmacion&quot;)); settings._close = settings.close; settings.close = function(event, ui) { focused.focus(); if (settings._close!==undefined){settings._close(event,ui);} }; var self = this._createDiv().appendTo(&quot;body&quot;), aceptButton; self.dialog(settings); //parámetros específicos de tipo de mensaje aceptButton = [{ text: $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.aceptar&quot;), click: function () { settings.OKFunction.call(this, self); self.dialog(&quot;close&quot;); } }]; self.dialog(&quot;option&quot;, &quot;buttons&quot;, aceptButton); this._createCloseLink(self); this._addStyles(self, &quot;confirm&quot;, settings.message); this._createLinkButton(self, settings.CANCELFunction); docHeight = $(document).height(); docWidth = $(document).width(); self.dialog(&quot;open&quot;); this._dialogInPortal(docWidth, docHeight, self, settings); //Le ponemos el foco al botón aceptar en vez de al enlace $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-buttonpane button:first').focus(); }, /** * Muestra un mensaje de aviso. * * @name jQuery.rup_messages#msgOK * @function * @param {Object} properties - Objeto de configuración del mensaje de aviso. * @param {String} properties.title - Texto que aparecerá en la barra del titulo del mensaje. * @param {String} properties.message - El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. * @param {jQuery.rup_messages~beforeCloseCallback} properties.beforeClose - Función a ejecutar justo antes de que se cierre la ventana. * @example * // Mostrar un mensaje de aviso. * $.rup_messages(&quot;msgOK&quot;, { * title: &quot;Correcto&quot;, * message: &quot;Todo ha ido OK.&quot; * }); */ msgOK : function (properties) { //Se recogen y cruzan las paremetrizaciones del objeto var settings = $.extend({}, $.rup_messages.defaults, properties), docHeight, docWidth, focused = $(document.activeElement); this._rupProperties(settings, $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.correct&quot;)); settings._close = settings.close; settings.close = function(event, ui) { focused.focus(); if (settings._close!==undefined){settings._close(event,ui);} }; //parámetros específicos de tipo de mensaje settings.buttons = [{ text: $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.aceptar&quot;), click: function () { self.dialog(&quot;close&quot;); } }]; var self = this._createDiv().appendTo(&quot;body&quot;); self.dialog(settings); this._createCloseLink(self); this._addStyles(self, &quot;ok&quot;, settings.message); docHeight = $(document).height(); docWidth = $(document).width(); self.dialog(&quot;open&quot;); this._dialogInPortal(docWidth, docHeight, self, settings); }, /** * Muestra un mensaje de alerta. * * @name jQuery.rup_messages#msgAlert * @function * @param {Object} properties - Objeto de configuración del mensaje de alerta. * @param {String} properties.title - Texto que aparecerá en la barra del titulo del mensaje. * @param {String} properties.message - El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. * @param {jQuery.rup_messages~beforeCloseCallback} properties.beforeClose - Función a ejecutar justo antes de que se cierre la ventana. * @example * // Mostrar un mensaje de aviso. * $.rup_messages(&quot;msgAlert&quot;, { * title: &quot;Alerta&quot;, * message: &quot;Esto es una alerta.&quot; * }); */ msgAlert : function (properties) { //Se recogen y cruzan las paremetrizaciones del objeto var settings = $.extend({}, $.rup_messages.defaults, properties), docHeight, docWidth, focused = $(document.activeElement); this._rupProperties(settings, $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.alert&quot;)); settings._close = settings.close; settings.close = function(event, ui) { focused.focus(); if (settings._close!==undefined){settings._close(event,ui);} }; //parámetros específicos de tipo de mensaje settings.buttons = [{ text: $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.aceptar&quot;), click: function () { self.dialog(&quot;close&quot;); } }]; var self = this._createDiv().appendTo(&quot;body&quot;); self.dialog(settings); this._createCloseLink(self); this._addStyles(self, &quot;alert&quot;, settings.message); docHeight = $(document).height(); docWidth = $(document).width(); self.dialog(&quot;open&quot;); this._dialogInPortal(docWidth, docHeight, self, settings); } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** $.rup_messages(&quot;extend&quot;, { /** * Crea los divs de los mensajes. * * @name jQuery.rup_messages#_createDiv * @function * @private */ _createDiv : function () { //Crea los divs de los mensajes return $(&quot;&lt;div/&gt;&quot;).attr(&quot;id&quot;, &quot;rup_msgDIV_&quot; + new Date().getTime()).attr(&quot;rup_message&quot;, &quot;true&quot;); }, /** * Crea los el enlace de cerrar en el título del mensaje de acuerdo a los estándares de accesibilidad. * * @name jQuery.rup_messages#_createCloseLink * @param {Object} self - Referencia a la propia instancia. * @function * @private */ _createCloseLink : function (self) { //Crea el enlace de cerrar junto a la x de cerrar. var closeSpan = &quot;&lt;span id='closeText_&quot; + self[0].id + &quot;' style='float:right;font-size:0.85em;'&gt;&quot; + $.rup.i18nParse($.rup.i18n.base,&quot;rup_global.cerrar&quot;) + &quot;&lt;/span&gt;&quot;, aClose = $(&quot;&lt;a href='#'&gt;&lt;/a&gt;&quot;) .attr(&quot;role&quot;, &quot;button&quot;) .css(&quot;margin-right&quot;, &quot;0.9em&quot;) .css(&quot;float&quot;, &quot;right&quot;) .addClass(&quot;ui-dialog-title&quot;) .html(closeSpan) .click(function (event) { self.dialog(&quot;close&quot;); return false; }).hover(function (eventObject) { //Evento lanzado para que se cambie el icono de la X a hover, marcado por ARISTA $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-titlebar-close').addClass(&quot;ui-state-hover&quot;); $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-titlebar-close').css(&quot;padding&quot;, &quot;0px&quot;); }, function (eventObject) { $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-titlebar-close').removeClass(&quot;ui-state-hover&quot;); $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-titlebar-close').attr(&quot;style&quot;, &quot;&quot;); }).insertAfter(&quot;#ui-dialog-title-&quot; + self[0].id); $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-titlebar-close').hover( function () { aClose.css(&quot;text-decoration&quot;, &quot;none&quot;); }, function () { aClose.css(&quot;text-decoration&quot;, &quot;&quot;); }); }, /** * Aplica el estilo correspondiente al tipo de mensaje a mostrar así como el contenido del mensaje en sí. * * @name jQuery.rup_messages#_addStyles * @param {Object} self - Referencia a la propia instancia. * @param {string} css - Clase css correspondiente al tipo de mensaje a mostrar. * @param {string} message - Cuerpo del mensaje a visualizar. * @function * @private */ _addStyles : function (self, css, message) { //Le a?ade los divs del mensaje a mostrar y el icono correpondiente var divMessageIcon = $(&quot;&lt;div&gt;&quot;).attr(&quot;id&quot;, &quot;rup_msgDIV_msg_icon&quot;).addClass(&quot;rup-message_icon-&quot; + css), divMessage = $(&quot;&lt;div&gt;&quot;).attr(&quot;id&quot;, &quot;rup_msgDIV_msg&quot;).addClass(&quot;rup-message_msg-&quot; + css).html(message); self.append(divMessageIcon); self.append(divMessage); }, /** * Genera un enlace &quot;Cancelar&quot; para el mensaje de tipo confirmación. * * @name jQuery.rup_messages#_createLinkButton * @param {Object} self - Referencia a la propia instancia. * @param {string} css - Clase css correspondiente al tipo de mensaje a mostrar. * @param {jQuery.rup_messages~CANCELFunctionCallback} CANCELFunction - Función a ejecutar cuando el usuario pulsa el enlace de Cancelar. * @function * @private */ _createLinkButton : function (self, CANCELFunction) { //Creamos un boton como si fuera un //creamos el enlace var clickFnc = CANCELFunction, cancelHREF = $(&quot;&lt;a href='#'&gt;&lt;/a&gt;&quot;) .attr(&quot;role&quot;, &quot;button&quot;) .attr(&quot;id&quot;, self[0].id + &quot;_cancel&quot;) .addClass(&quot;rup-enlaceCancelar&quot;) .html($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.cancel&quot;)) .click(function (event) { self.dialog(&quot;close&quot;); if (clickFnc !== undefined) { clickFnc.call(this, self); } return false; }); $('div[aria-labelledby=ui-dialog-title-' + self[0].id + '] .ui-dialog-buttonset ').prepend(cancelHREF); }, /** * Ajuste en la visualización del mensaje para que se muestre correctamente en aplicaciones integradas en portal. * * @name jQuery.rup_messages#_dialogInPortal * @param {Number} docWidth - Anchura en pixeles del objeto document. * @param {Number} docHeight - Altura en pixeles del objeto document. * @param {Object} $self - Referencia a la propia instancia. * @param {Object} settings - Objeto de configuración del componente. * @function * @private */ _dialogInPortal : function(docWidth, docHeight, $self, settings){ var $overlayEl; if($.rup_utils.aplicatioInPortal()){ if ($self.data(&quot;dialog&quot;).overlay !== null){ $overlayEl = $self.data(&quot;dialog&quot;).overlay.$el; $overlayEl.css(&quot;height&quot;,docHeight).css(&quot;width&quot;,docWidth); $(&quot;.r01gContainer&quot;).append($self.data(&quot;dialog&quot;).uiDialog).append($overlayEl); } if (settings.position === undefined || settings.position === null){ $self.data(&quot;dialog&quot;).uiDialog.css(&quot;position&quot;,&quot;absolute&quot;).css(&quot;top&quot;,(docHeight/2)-($(&quot;.ui-dialog:visible&quot;).height()/2)); } } }, /** * Realiza la inicialización de las propiedades utilizadas para configurar correctamente el plugin jQueryUi Dialog. &lt;/br&gt;&lt;/br&gt; * La inicialización se realiza sobre las propiedades introducidas por el usuario de modo que se garantiza que la visualización del componente es siempre la adecuada. * * @name jQuery.rup_feedback#_rupProperties * @param {Object} properties - Propiedades de configuración sobre las que se va a realizar la inicialización- * @param {string} title - Titulo a mostrar en el mensaje. * @function * @private */ _rupProperties : function(properties, title){ properties.autoOpen= false; properties.modal = true, properties.resizable = false, properties.title = (properties.title === null || properties.title === &quot;&quot; ?title: properties.title); properties.closeText = $.rup.i18nParse($.rup.i18n.base,&quot;rup_message.tituloError.cerrar&quot;), properties.close = function () { $(this).remove(); }; } }); //****************************************************** // DEFINICIN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** /** * @description Opciones por defecto de configuración del componente. * * @name jQuery.rup_messages#defaults * * @property {Number} [minHeight=100] - Altura mínima con la que se va a mostrar el mensaje. */ $.rup_messages.defaults = { minHeight: 100 }; })(jQuery); × Search results Close "},"rup.report.js.html":{"id":"rup.report.js.html","title":"Source: rup.report.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.report.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Report. * @author EJIE * @version 2.4.10 */ (function ($) { //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * El objetivo principal del componente es mejorar la experiencia del usuario a la hora de generar informes mediante la presentación de diálogos de espera. * * @summary Componente RUP Report. * @namespace jQuery.rup_report * @memberOf jQuery * @tutorial rup.report * @example * var properties={ * // Propiedades de configuración * }; * * $.rup_report(properties); */ var rup_report = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupObjectConstructor(&quot;rup_report&quot;, rup_report)); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** $.rup_report(&quot;extend&quot;,{ }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** $.rup_report(&quot;extend&quot;, { /** * Función de inicialización del componente. * * @name jQuery.rup_report#_init * @function * @private * @param {object} args - Propiedades de configuración. */ _init : function(args) { if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18n.base.rup_global.initError + $(this).attr(&quot;id&quot;)); } else { //Se recogen y cruzan las paremetrizaciones del objeto var self = this, settings = $.extend(true, {}, $.rup_report.defaults, args[0]), //Objetos componente (params) buttons = settings.buttons, defaultDialog = settings.dialog, customDialog = settings.customDialog, //Contenedor de botones $container = $.find(&quot;[id='&quot;+settings.appendTo+&quot;']&quot;); //Existe capa contenedora ? if ($.isEmptyObject($container)){ alert('No existe objeto al que añadir el componente'); return false; } $container = $($container[0]); //Guardar settings $container.data(&quot;report&quot;, settings); //Añadir dialogo por defecto var $defaultDialog_wait = $(&quot;&lt;div /&gt;&quot;) .attr(&quot;id&quot;,&quot;reportFileWait&quot;) .attr(&quot;title&quot;,defaultDialog.wait.title) .text(defaultDialog.wait.msg) .addClass(&quot;rup_report&quot;) .hide() //progressbar .append($(&quot;&lt;div /&gt;&quot;).addClass(&quot;ui-progressbar ui-progressbar-value ui-corner-left ui-corner-right&quot;)), $defaultDialog_error = $(&quot;&lt;div /&gt;&quot;) .attr(&quot;id&quot;,&quot;reportFileError&quot;) .attr(&quot;title&quot;,defaultDialog.error.title) .text(defaultDialog.error.msg) .addClass(&quot;rup_report&quot;) .hide(), $defaultDialog = $(&quot;&lt;div /&gt;&quot;) .attr(&quot;id&quot;, &quot;rup_report_dialogsContainer&quot;) .append($defaultDialog_wait) .append($defaultDialog_error); $container.after($defaultDialog); //Guardar datos dialogo por defecto defaultDialog[&quot;waitDiv&quot;] = &quot;reportFileWait&quot;; defaultDialog[&quot;errorDiv&quot;] = &quot;reportFileError&quot;; //El contenedor es un mButton var isMButton = false, $mbutton; if ($container.hasClass(&quot;rup-toolbar_menuButtonContainer&quot;)){ $mbutton = $(&quot;[id='&quot;+$container.attr(&quot;id&quot;).substring(&quot;8&quot;)+&quot;']&quot;); $container = $mbutton.parents(&quot;.rup-toolbar&quot;); isMButton = true; if ($.grep(buttons, function(object, index){ return object.buttons!==undefined; }).length&gt;0){ alert('No se pueden añadir MButtons a un contenedor MButton'); return false; }; } //Recorrer los botones var errors = []; $.each(buttons, function(index, object){ if (object.buttons!==undefined){ //MBUTTON object[&quot;click&quot;] = $container.showMButton; $mbutton = $container.addMButton(object, object[&quot;json_i18n&quot;]); $container.addButtonsToMButton(object.buttons, $mbutton, object[&quot;json_i18n&quot;]); //add click $.each(object.buttons, function(index, object){ self._checkButton(object, errors); self._configureButton(object, defaultDialog, customDialog, settings); }); } else { //BUTTON if (!isMButton){ $container.addButton(object, object[&quot;json_i18n&quot;]); object[&quot;id&quot;] = $container.attr(&quot;id&quot;)+&quot;##&quot;+((object.id)?object.id:object.i18nCaption); } else { //Añadir botones a un MButton ya existente $container.addButtonsToMButton(new Array(object), $mbutton, object[&quot;json_i18n&quot;]); //Mover el botón al final $mbuttonDiv = $(&quot;[id='mbutton_&quot;+$mbutton.attr(&quot;id&quot;)+&quot;']&quot;); $mbuttonDiv.find(&quot;li:first&quot;).appendTo($mbuttonDiv.children(&quot;ul&quot;)); } //add click self._checkButton(object, errors); self._configureButton(object, defaultDialog, customDialog, settings); } }); if (errors.length&gt;0){ var txtErrors = &quot;&quot;; for (var i=0; i&lt;errors.length; i++){ txtErrors += errors[i]+'&lt;br/&gt;'; } alert(txtErrors); } } }, _checkButton: function(button, errors){ var buttonId = button.id.substring(button.id.lastIndexOf(&quot;##&quot;)+2); //Tiene URL? if (button.url===undefined){ errors.push(buttonId+': no tiene URL asociada'); } //Existe grid asociado para columnas ? if (button.columns!==undefined){ //Existe grid asociado ? var $grid = $.find(&quot;#&quot;+button.columns.grid); if ($.isEmptyObject($grid)){ errors.push(buttonId+': no existe el Grid asociado'); } } }, _configureButton: function(button, defaultDialog, customDialog, settings){ var self = this, dialog = {}; $.extend(dialog,defaultDialog); //Copiar el dialogo de por defecto //isInline a false por defecto button.isInline = (button.isInline===undefined)?false:button.isInline; //Si no es inLine if (!button.isInline){ $(&quot;[id='&quot;+button.id+&quot;']&quot;).on(&quot;click&quot;, function (){ //Ocultar MButton var $container = $(this).parents(&quot;div.rup-toolbar_menuButtonContainer&quot;); if ($container.length&gt;0){ $container.showMButton(); $container.removeClass(&quot;rup-toolbar_menuButtonSlided&quot;); } //Controlar columnas var data = {}; if (button.columns!==undefined){ //GridParams var $grid = $($.find(&quot;#&quot;+button.columns.grid)[0]); if (jQuery.isFunction(settings.fncGetGridParam)){ data = jQuery.proxy(settings.fncGetGridParam, $grid)(); }else{ data = $grid.jqGrid(&quot;getGridParam&quot;, &quot;postData&quot;); } data[&quot;columns&quot;] = $.toJSON(self._getColumns($grid, button.columns)); } //Dialogo propio? var standarDialog = true; if (button.customDialog !== undefined){ //Buscar el dialogo correspondiente var actualDialog = customDialog[button.customDialog]; /** WAIT **/ //Sobreescritura del defaultDialog-wait if (actualDialog.waitDiv===undefined){ dialog.wait = actualDialog.wait; //Dialogo propio completo } else { dialog.waitDiv = actualDialog.waitDiv; $(&quot;#&quot;+dialog.waitDiv).addClass(&quot;rup_report&quot;); } /** ERROR **/ //Sobreescritura del defaultDialog-error if (actualDialog.errorDiv===undefined){ dialog.error = actualDialog.error; //Dialogo propio completo } else { dialog.errorDiv = actualDialog.errorDiv; $(&quot;#&quot;+dialog.errorDiv).addClass(&quot;rup_report&quot;); } dialog.successCallback = actualDialog.successCallback; dialog.failCallback = actualDialog.failCallback; } //Dialogo de espera var $reportFileWait = $(&quot;#&quot;+dialog.waitDiv); $reportFileWait.rup_dialog({ type: $.rup.dialog.TEXT, autoOpen: false, modal: true, resizable: false, close: function(event, ui) { if ($.rup.browser.isIE){ //IE document.execCommand('Stop'); } else { //Netscape/Mozilla/Firefox window.stop(); } } }); if (standarDialog){ //Titulo $reportFileWait.rup_dialog(&quot;setOption&quot;, &quot;title&quot;, dialog.wait.title); //Contenido var content = $reportFileWait.html().split($reportFileWait.text()), html = &quot;&quot;; for (var i=0; i&lt;content.length; i++){ if (content[i]===&quot;&quot;){ html += dialog.wait.msg; } else { html += content[i]; } } $reportFileWait.html(html); } $reportFileWait.rup_dialog(&quot;open&quot;); //Lanzar petición $.fileDownload($.rup_utils.setNoPortalParam(button.url), { httpMethod: &quot;POST&quot;, data: jQuery.rup_utils.unnestjson(data), successCallback: function (url) { if (dialog.successCallback!==undefined){ dialog.successCallback(); } $reportFileWait.rup_dialog(&quot;close&quot;); }, failCallback: function (responseHtml, url) { $reportFileWait.rup_dialog(&quot;close&quot;); var $reportFileError = $(&quot;#&quot;+dialog.errorDiv); $reportFileError.rup_dialog({ type: $.rup.dialog.TEXT, autoOpen: false, modal: true, resizable: false }); if (standarDialog){ //Titulo $reportFileError.rup_dialog(&quot;setOption&quot;, &quot;title&quot;, dialog.error.title); //Contenido $reportFileError.rup_dialog(&quot;setOption&quot;, &quot;message&quot;, dialog.error.msg); } $reportFileError.rup_dialog(&quot;open&quot;); if (dialog.failCallback!==undefined){ dialog.failCallback(); } } }); return false; }); } else { $(&quot;[id='&quot;+button.id+&quot;']&quot;).on(&quot;click&quot;, function (){ window.open(button.url+&quot;?isInline=true&quot;,&quot;_blank&quot;); }); } }, _getColumns: function($grid, columns){ //Preparar datos var colModel = $grid.jqGrid(&quot;getGridParam&quot;, &quot;colModel&quot;), colNames = $grid.jqGrid(&quot;getGridParam&quot;, &quot;colNames&quot;), colNumber = colNames.length, columnsArray = [], customNames = columns.customNames, hidden = columns.hidden===true?true:false; //Todas las columnas if (customNames===undefined){ for (var i=0; i&lt;colNumber; i++){ //Omitir columna multiselección if (colNames[i].indexOf(&quot;type='checkbox'&quot;)!==-1){ continue; } //Obtener columna si se requieren todas o si solo se quieren visibles + es visible if (hidden || !hidden &amp;&amp; colModel[i].hidden===false ){ var column = []; column.push(colModel[i].name); column.push(colNames[i]); columnsArray.push(column); } } //Columnas por nombre } else { for (var i=0; i&lt;colNumber; i++){ if ($.inArray(colModel[i].name, customNames)!==-1){ var column = []; column.push(colModel[i].name); column.push(colNames[i]); columnsArray.push(column); } } } return columnsArray; } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* $.rup_report.defaults = { fncGetGridParam:null, dialog: { wait : { title: $.rup.i18nParse($.rup.i18n.base,&quot;rup_report.waitTitle&quot;), msg: $.rup.i18nParse($.rup.i18n.base,&quot;rup_report.waitMsg&quot;) }, error : { title: $.rup.i18nParse($.rup.i18n.base,&quot;rup_report.errorTitle&quot;), msg: $.rup.i18nParse($.rup.i18n.base,&quot;rup_report.errorMsg&quot;) } } }; /** * Opciones por defecto de configuración del componente. * * @name jQuery.rup_report#options * * * */ })(jQuery); × Search results Close "},"rup_table_rup.table.core.js.html":{"id":"rup_table_rup.table.core.js.html","title":"Source: rup_table/rup.table.core.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup_table/rup.table.core.js /*! * Copyright 2013 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Table. * @author EJIE * @version 2.4.10 */ (function ($) { //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Se les presenta a los usuarios los datos tabulados para que la información se visualice de manera ágil y rápida, facilitando así su comprensión y manejo. Además, el componente implementa un nuevo patrón definido para facilitar la lógica necesaria en las acciones básicas, denominadas CRUD (create, read, update y delete), sobre una tabla. * * @summary Componente RUP Table. * @namespace jQuery.rup_table * @memberof jQuery * @example * * var properties = { * url: &quot;../tableUrl&quot;, * colNames: [ * &quot;id&quot;,&quot;nombre&quot;,&quot;...&quot;] * ], * colModel: [ * {name: &quot;id&quot;, label: &quot;id&quot;}, * {name: &quot;nombre&quot;, label: &quot;nombre&quot;}, * {name: &quot;...&quot;, label: &quot;...&quot;} * ], * model:&quot;Usuario&quot;, * usePlugins:[ * &quot;formEdit&quot;, * &quot;feedback&quot;, * &quot;toolbar&quot;, * &quot;contextMenu&quot;, * &quot;fluid&quot;, * &quot;filter&quot;, * &quot;search&quot; * ], * primaryKey: &quot;id&quot; * }; * * $(&quot;#table&quot;).rup_table(properties); */ var rup_table = {}; rup_table.plugins=[]; jQuery.rup_table = jQuery.rup_table || {}; jQuery.extend(jQuery.rup_table,{ registerPlugin: function(name, settings){ if (jQuery.inArray(name, rup_table.plugins)===-1){ rup_table.plugins.push(name); rup_table.plugins[name]=settings; } } }); //Se configura el arranque de UDA para que alberge el nuevo patrón jQuery.extend(jQuery.rup.iniRup, jQuery.rup.rupSelectorObjectConstructor(&quot;rup_table&quot;, rup_table)); $.fn.fmatter.rup_combo = function (cellval, opts, rwd, act) { var labelProp, label; var formatterData = $(this).data(&quot;rup.table.formatter&quot;)!== undefined?$(this).data(&quot;rup.table.formatter&quot;):{}; // Se añade la info del formatter var formatterObj = {}; formatterObj[&quot;rup_combo&quot;] = {value:cellval}; // formatterObj[&quot;rup_combo&quot;] = cellval; // Se añade la info de la columna var colFormatter = {}; colFormatter[opts.colModel.name] = formatterObj; // Se añade el id de la fila var rowObj = {}; rowObj[opts.rowId] = colFormatter; if (opts.colModel.formatoptions &amp;&amp; opts.colModel.formatoptions.labelName){ labelProp = opts.colModel.formatoptions.labelName; label = $.rup_utils.getJson(rwd, labelProp); }else{ if (typeof opts.colModel.editoptions.source === &quot;string&quot;){ // Combo remoto // Obtener la propiedad que corresponde al texto a visualizar if (opts.colModel.name.indexOf(&quot;.&quot;)!==-1){ labelProp = opts.colModel.name.substring(0,opts.colModel.name.lastIndexOf(&quot;.&quot;))+&quot;.&quot;+opts.colModel.editoptions.sourceParam.label; }else{ labelProp = opts.colModel.editoptions.sourceParam.label; } label = $.rup_utils.getJson(rwd, labelProp); }else{ // Combo local var labelArr = $.grep(opts.colModel.editoptions.source, function(elem, index){ if (elem.value === cellval){ return true; } }); if (labelArr.length === 1){ if(labelArr[0].i18nCaption){ label = $.rup.i18nParse($.rup.i18n.app[settings.i18nId], labelArr[0].i18nCaption); }else{ label = labelArr[0].label; } } } } formatterObj[&quot;rup_combo&quot;][&quot;label&quot;] = label; $.extend(true, formatterData, rowObj); $(this).data(&quot;rup.table.formatter&quot;, formatterData); return label || &quot;&quot; }; $.fn.fmatter.rup_combo.unformat = function (cellvalue, options) { var val = $(this).data(&quot;rup.table.formatter&quot;)[options.rowId][options.colModel.name][&quot;rup_combo&quot;][&quot;value&quot;]; return val || &quot;&quot;; }; /* * SOBREESCITURAS * Funciones extendidas (SOBREESCRITAS) del componente jqGrid * * Los métodos aquí indicados han sido extendidos y su implementación sustituida por completo. * La extensión ha sido realizada para ajustar el comportamiento del componente jqGrid a los requisitos exigidos. * * Los métodos extendidos para su modificación son los siguientes: * * - createModal * - hideModal * - viewModal */ jQuery.extend(jQuery.jgrid,{ createModal : function(aIDs, content, p, insertSelector, posSelector, appendsel, css) { // aIDs: Identificadores de la modal // -- aIDs.modalcontent : // -- aIDs.modalhead : // -- aIDs.scrollelm : // -- aIDs.themodal : // content: Contenido HTML del díalogo // p: parámetros de configuración del diálogo // insertSelector: selector que corresponde al elemento despues del que se va a insertar la modal // posSelector: elemento base sobre el que se calcula la posición var $divModal = jQuery(&quot;&lt;div/&gt;&quot;).attr(&quot;id&quot;,aIDs.themodal).append($(content)); var $scrollelm = $divModal.find(&quot;#&quot;+aIDs.scrollelm); $divModal.insertBefore($(insertSelector)); /* TODO : Añadir los parametros de configruación que puedan añadirse al rup_dialog. */ $divModal.rup_dialog({ type: $.rup.dialog.DIV, autoOpen: false, modal: true, resizable: p.resize, title: p.caption, width: p.width, buttons: p.buttons }); // Eliminamos los eventos del boton de cerrar para mostrar el gestor de cambios if (jQuery.isFunction(p.onClose)){ jQuery(&quot;.ui-dialog-titlebar-close, a:has(#closeText_&quot; +$divModal.first()[0].id+&quot;)&quot;, $divModal.parent()).off(&quot;click&quot;).on(&quot;click&quot;, function(event){ p.onClose.call(event); }); // Se elimina el evento de cerrar al texto de cierre del dialogo y se asigna el evento de la gestion de cambios. // prop.detailDiv.parent().find(&quot;#closeText_&quot; + prop.detailDiv.first()[0].id).parent().unbind('click').bind(&quot;click&quot;, function () { // self._checkDetailFormModifications(function(){ // prop.detailDiv.rup_dialog(&quot;close&quot;); // }); // }); // Se elimina el evento de cerrar al icono de cierre del dialogo y se asigna el evento de la gestion de cambios. // prop.detailDiv.parent().find(&quot;.ui-dialog-titlebar-close&quot;).unbind('click').bind(&quot;click&quot;, function () { // self._checkDetailFormModifications(function(){ // prop.detailDiv.rup_dialog(&quot;close&quot;); // }); // }); } jQuery(&quot;#&quot;+aIDs.scrollelm+&quot;_2&quot;).addClass(&quot;botoneraModal&quot;); jQuery(&quot;.fm-button&quot;,&quot;#&quot;+aIDs.scrollelm+&quot;_2&quot;).on({ focusin:function(){jQuery(this).addClass('ui-state-focus');}, focusout:function(){jQuery(this).removeClass('ui-state-focus');} }); if (p.linkStyleButtons!==undefined){ for (var i=0;i&lt;p.linkStyleButtons.length;i++){ jQuery(p.linkStyleButtons[0]).addClass(&quot;botonEnlace&quot;); } } }, hideModal : function (selector,o) { jQuery(selector).rup_dialog(&quot;close&quot;); }, viewModal: function(selector,o){ jQuery(selector).rup_dialog(&quot;open&quot;); } }); jQuery.extend(jQuery.rup_table,{ proxyAjax:function(ajaxOptions, identifier){ jQuery.rup_ajax(ajaxOptions); } }); /* ****************************** * FUNCIONES DE CONFIGURACION * ******************************/ jQuery.fn.rup_table(&quot;extend&quot;,{ /** * Metodo que realiza la pre-configuración del core del componente RUP Table. * Este método se ejecuta antes de la pre-configuración de los plugins y de la invocación al componente jqGrid. * * @name jQuery.rup_table#preConfigureCore * @function * @param {object} settings - Parámetros de configuración del componente. * @fires jQuery.rup_table#rupTable_checkOutOfGrid * @fires jQuery.rup_table#rupTable_serializeGridData * @fires jQuery.rup_table#rupTable_beforeProcessing */ preConfigureCore: function(settings){ var $self = this, colModel, colModelObj; // Configuración del parámetro url settings.baseUrl = settings.url; // Ajuste en caso de no utilizar el plugin de filter if (jQuery.inArray(&quot;filter&quot;,settings.usePlugins) === -1){ settings.url+=&quot;/filter&quot;; } // Se almacena el identificador del objeto en la propiedad settings.id settings.id=$self.attr(&quot;id&quot;); // Se da valor a la propiedad ruptype $self.attr(&quot;ruptype&quot;,&quot;table&quot;); settings.core.tableDiv = settings.id + &quot;_div&quot;; settings.core.$tableDiv = jQuery(&quot;#&quot;+settings.core.tableDiv); jQuery(document).bind(&quot;click&quot;, function(event){ var $originalTarget = jQuery(event.target); if($originalTarget.parents().index(settings.core.$tableDiv)===-1){ $self.triggerHandler(&quot;rupTable_checkOutOfGrid&quot;,[event, $originalTarget]); } }); /* * Configuración de los identificadores por defecto de los componentes del rup_table */ if (settings.pager!==false){ settings.pager = $.rup_utils.getJQueryId(settings.pager!==null?settings.pager:settings.id+&quot;_pager&quot;); settings.$pager = jQuery(settings.pager); if (settings.$pager.length===0){ alert(&quot;El identificador &quot;+settings.pager+&quot; especificado para el paginador no existe.&quot;); } } colModel = settings.colModel; if (settings.loadOnStartUp===false || settings.multifilter!=undefined){ $self.data(&quot;tmp.loadOnStartUp.datatype&quot;, settings.datatype); settings.datatype = &quot;clientSide&quot;; } // Configuración del colModel para los campos sobre los que se debe de configurar un componente RUP for (var i=0;i&lt;colModel.length;i++){ colModelObj = colModel[i]; // Se comprueba para cada uno de las entradas en el colModel si se debe de crear un componente RUP if (colModelObj.rupType!==undefined &amp;&amp; colModelObj.rupType!==null){ // En caso de tratarse de un componente RUP // Se indica como edittype=&quot;custom&quot; para que jqGrid lo trate como un componente personalizado colModelObj.edittype = &quot;custom&quot;; // Si no se ha especificado una funcion custom_element se asigna la función genérica correspondiente a un componente RUP if (!jQuery.isFunction(colModelObj.editoptions.custom_element)){ colModelObj.editoptions.custom_element = function(value, options){ return $(&quot;&lt;input&gt;&quot;).attr({ &quot;type&quot;:&quot;text&quot;, &quot;id&quot;:options.id, &quot;name&quot;:options.name, &quot;class&quot;: &quot;FormElement formulario_linea_input customelement&quot;, &quot;style&quot;: &quot;width:98%&quot;, &quot;value&quot;: value })[0]; }; } // Si no se ha especificado una funcion custom_value se asigna la función genérica correspondiente a un componente RUP if (!jQuery.isFunction(colModelObj.editoptions.custom_value)){ colModelObj.editoptions.custom_value = function($elem, operation, value){ var ruptype = $elem.attr(&quot;ruptype&quot;); if (ruptype!==undefined){ if (operation === &quot;set&quot;){ $elem[&quot;rup_&quot;+ruptype](&quot;setRupValue&quot;,value); }else if (operation === &quot;get&quot;){ return $elem[&quot;rup_&quot;+ruptype](&quot;getRupValue&quot;); } } }; } } } // Configuración de la columna extra utilizada para mostrar el estado de los registros if (settings.showGridInfoCol){ settings.colNames = $.merge([&quot;&quot;], settings.colNames); settings.colModel = $.merge([settings.defaultGridInfoCol], settings.colModel); } // Configuración de las claves compuestas if (settings.primaryKey!==undefined &amp;&amp; typeof settings.primaryKey===&quot;string&quot;){ settings.primaryKey=[settings.primaryKey]; } if (settings.primaryKey!==undefined &amp;&amp; typeof settings.primaryKey===&quot;object&quot;){ // Configuración de la columna extra para gestionar las claves compuestas if (settings.primaryKey.length===1){ settings.primaryKeyCol = settings.primaryKey[0]; // Se configura la propiedad key para la columna correspondiente a a clave primaria for (var i=0;i&lt;colModel.length;i++){ if (colModel[i].name===settings.primaryKeyCol){ colModel[i].key=true; break; } } }else if (settings.primaryKey.length&gt;1){ settings.colNames = $.merge([&quot;&quot;], settings.colNames); var pkColModel = $.extend({},settings.defaultGridMultiplePkCol,{ key: true, formatter: function(cellvalue, options, rowObject){ var $self = $(this), settings = $self.data(&quot;settings&quot;), retValue=&quot;&quot;; for (var i=0;i&lt;settings.primaryKey.length;i++){ retValue+=$.rup_utils.unnestjson(rowObject)[settings.primaryKey[i]]+settings.multiplePkToken; } retValue = retValue.substr(0, retValue.length-1); return retValue; } }); settings.primaryKeyCol = &quot;pkCol&quot;; settings.colModel = $.merge([pkColModel], settings.colModel); } // Se actualiza el nombre de la columna que va a ejercer como clave primaria $.extend(settings, {prmNames:{id:settings.primaryKeyCol}}); } // Configuración del colModel para la gestión de la edición de las claves primarias en los modos add y edit for (var i=0;i&lt;colModel.length;i++){ colModelObj = colModel[i]; if (colModelObj.editable===true){ if (colModelObj.editableOnAdd===undefined){ colModelObj.editableOnAdd=true; } if (colModelObj.editableOnEdit===undefined){ if (jQuery.inArray(colModel[i].name, settings.primaryKey)!==-1){ colModelObj.editableOnEdit=false; }else{ colModelObj.editableOnEdit=true; } } } } // Sobreescritura del método serialize grid data settings.serializeGridData = function(postData){ var newPostData, pageNum = parseInt(postData.page), lastpage = parseInt($self.rup_table(&quot;getGridParam&quot;,&quot;lastpage&quot;)); if (lastpage!==0 &amp;&amp; pageNum&gt;lastpage){ postData.page = lastpage; } if (settings.core.startOnPage!==null){ postData.page = settings.core.startOnPage; $self.data(&quot;tmp.firstLoad&quot;,true); } jQuery.extend(true, postData,{core:{ &quot;pkToken&quot;:settings.multiplePkToken, &quot;pkNames&quot;:settings.primaryKey } }); newPostData = $.extend({},{&quot;filter&quot;:{}}, postData); $self.triggerHandler(&quot;rupTable_serializeGridData&quot;, [newPostData]); delete $self.data(&quot;tmp.firstLoad&quot;); settings.core.startOnPage = null; return jQuery.toJSON(newPostData); }; settings.beforeProcessing = function(data, st, xhr){ if ($self.triggerHandler(&quot;rupTable_beforeProcessing&quot;, [data, st, xhr]===false)){ return false; } if (settings.primaryKey.length&gt;1){ $.each(data.rows, function(index,elem){ var retValue=&quot;&quot;; for (var i=0;i&lt;settings.primaryKey.length;i++){ retValue+=$.rup_utils.unnestjson(elem)[settings.primaryKey[i]]+settings.multiplePkToken; } retValue = retValue.substr(0, retValue.length-1); elem[&quot;pkCol&quot;]=retValue; }); } return true; }; // Gestión de errores por defecto // if (!jQuery.isFunction(settings.loadError)){ // settings.userDefined // settings.loadError = function(xhr,st,err){ // jQuery.rup_messages(&quot;msgError&quot;, { // title: settings.core.defaultLoadErrorTitle, // message: xhr.responseText // }); // }; // } var userLoadError = settings.loadError; settings.loadError = function(xhr,st,err){ var $self = $(this), ret; ret = $self.triggerHandler(&quot;rupTable_loadError&quot;, xhr,st,err); if (ret!==false){ jQuery.proxy(userLoadError, $self)(xhr,st,err); } }; settings.getActiveLineId = function (){ var $self = this, rowsInGrid = $self.jqGrid(&quot;getDataIDs&quot;), selrow = $self.jqGrid('getGridParam','selrow'); return $.inArray(selrow,rowsInGrid); }; settings.getActiveRowId = function (){ var $self = this; return $self.rup_table(&quot;getGridParam&quot;, &quot;selrow&quot;); }; settings.getSelectedRows = function (){ var $self = this, selrow = $self.rup_table(&quot;getGridParam&quot;, &quot;selrow&quot;); return selrow===null ? [] : [selrow]; }; settings.getSelectedLines = function (){ var $self = this, selrow = $self.rup_table(&quot;getGridParam&quot;, &quot;selrow&quot;); return selrow===null ? [] : [$.inArray(selrow, $self.jqGrid(&quot;getDataIDs&quot;))]; }; // Gestión de las operaciones que se pueden realizar sobre los registros // Se unifican las operaciones por defecto con las indicadas por el usaurio jQuery.each(settings.core.operations, function(index, operation){ settings.core.showOperations[index] = true; }); jQuery.extend(true, settings.core.defaultOperations, settings.core.operations); $self.on({ &quot;jqGridBeforeRequest&quot;:function(){ jQuery.set_uda_ajax_mode_on(); }, &quot;jqGridLoadComplete.rup_table.tooltip&quot;: function(event, data){ var $self = $(this); if (data!==undefined){ // Redimensionado del campo de número de página en base al número de página máximo jQuery(&quot;.pagControls input.ui-pg-input&quot;,settings.$pager).attr({ size:data.total.length, maxlength:data.total.length }); } }, &quot;jqGridResizeStart&quot;:function(event, index){ //rup_combo , close the menu of the rup_combo when a column is resized $('#'+$self[0].id+'_search_rowInputs select').each(function(){ $(this).selectmenu('close')}); }, &quot;jqGridResizeStop&quot;:function(event, index){ //rup_combo, adjust the width of the menu to the new width after a column has been resized $('#'+$self[0].id+'_search_rowInputs select').each(function(){ $(&quot;[id='&quot;+this.id+&quot;-menu']&quot;).width($(&quot;[id='&quot;+this.id+&quot;-button']&quot;).width());}); }, &quot;jqGridGridComplete.rup_table.core&quot;: function(event){ var $self = $(this), $tbody; if ($self.rup_table(&quot;getGridParam&quot;,&quot;records&quot;)===0){ // No se han encontrado registros $self.prev().remove(); //Borrar div vacío $($self.jqGrid(&quot;getGridParam&quot;, &quot;pager&quot;)).hide(); var content = '&lt;tr class=&quot;ui-widget-content jqgrow ui-row-ltr&quot; role=&quot;row&quot; id=&quot;' + $self[0].id + '_noRecords&quot; aria-selected=&quot;false&quot;&gt;'; content += '&lt;td aria-describedby=&quot;' + $self[0].id + '_NO_REGISTROS&quot; title=&quot;' + $.rup.i18nParse($.rup.i18n.base,&quot;rup_grid.noRecordsFound&quot;) + '&quot; style=&quot;border:0;padding-left: 0.5em ! important;text-align: left;width:' + $(&quot;#gview_&quot;+$self.attr(&quot;id&quot;)).width() + 'px;background:white;&quot; role=&quot;gridcell&quot;&gt;'; //content += '&lt;div id=&quot;RUP_GRID_' + self[0].id + '_noRecord_ext&quot; class=&quot;cellLayout&quot; style=&quot;padding-left: 0.5em ! important;&quot;&gt;' + $.rup.i18nParse($.rup.i18n.base,&quot;rup_grid.noRecordsFound&quot;); //content += '&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;'; content += $.rup.i18nParse($.rup.i18n.base,&quot;rup_grid.noRecordsFound&quot;); content += '&lt;/td&gt;&lt;/tr&gt;'; $self.before(content); $('[aria-describedby=&quot;' + $self[0].id + '_NO_REGISTROS&quot;]').rup_tooltip({ position: { my: 'center', at: 'center' }}); }else{ jQuery(&quot;#&quot; + $self[0].id + &quot;_noRecords&quot;).remove(); //si tenemos la capa de no hay registros la borramos jQuery($self.jqGrid(&quot;getGridParam&quot;, &quot;pager&quot;)).show(); } }, &quot;jqGridGridComplete.rup_table.tooltip&quot;: function(event){ var $self = $(this), $tbody; // Se han encontrado registros // Tooltips de la tabla // jQuery(&quot;[title]&quot;, $self).rup_tooltip({show:{delay:settings.tooltipDelay}}); //Se le aplica el tooltip de uda $(&quot;#&quot;+$(this).attr(&quot;id&quot;)+&quot; [title]&quot;).each(function(i, elem){ var $elem = $(elem); $elem.attr(&quot;grid_tooltip&quot;,$elem.attr(&quot;title&quot;)).removeAttr(&quot;title&quot;); }); $tbody = jQuery(&quot;tbody:first&quot;, $self); $tbody.on(&quot;mousestop&quot;, {delay:500}, function(event, originalEvent){ var obj = $.rup_utils.elementFromPoint(originalEvent.clientX, originalEvent.clientY, true), $obj = $(obj), toolipTmpId, auxId, auxDescribedBy; if (!$obj.attr(&quot;rup_tooltip&quot;) &amp;&amp; $obj.attr(&quot;grid_tooltip&quot;)){ auxId = $obj.parent().attr(&quot;id&quot;)?$obj.parent().attr(&quot;id&quot;):$obj.parents(&quot;tr[role='row']&quot;).attr(&quot;id&quot;); auxDescribedBy = $obj.attr(&quot;aria-describedby&quot;)?$obj.attr(&quot;aria-describedby&quot;):$obj.parents(&quot;td[role='gridcell']&quot;).attr(&quot;aria-describedby&quot;); $obj.attr(&quot;title&quot;,$obj.attr(&quot;grid_tooltip&quot;)); toolipTmpId = auxId+&quot;_&quot;+auxDescribedBy; $obj.rup_tooltip({ show:{delay:0}, id: toolipTmpId, position:{ viewport:$(window), adjust:{ method:&quot;flip&quot; } } }); $obj.triggerHandler(&quot;mouseenter.qtip-&quot;+toolipTmpId+&quot;-create&quot;); // $obj.triggerHandler(&quot;mouseenter&quot;); $obj.rup_tooltip(&quot;option&quot;,&quot;show.delay&quot;,500); } }); } }); }, /** * Metodo que realiza la post-configuración del core del componente RUP Table. * Este método se ejecuta antes de la post-configuración de los plugins y después de la invocación al componente jqGrid. * * @name jQuery.rup_table#postConfigureCore * @function * @param {object} settings - Parámetros de configuración del componente. */ postConfigureCore: function(settings){ var $self = this; // Se configura la funcionalidad de redimensionado de la tabla. if (settings.resizable !== false){ $self.rup_table('gridResize', (jQuery.isPlainObject(settings.resizable)? settings.resizable:{})); } // Configruación pager if (settings.pager!==false){ $self.rup_table(&quot;configurePager&quot;,settings); } // Se añaden los tooltip a las cabeceras de la tabla $.each($(&quot;#gview_table th:visible&quot;), function(index,elem){ var $elem = $(elem), text = $elem.find(&quot;div&quot;).text(); if (text!==''){ $elem.attr(&quot;title&quot;, text).rup_tooltip({ show:{delay:500}, position:{ viewport:$(window), adjust:{ method:&quot;flip&quot; } } }); } }); // Implementación del ellipsis en las cabeceras de las columnas de la tabla jQuery($self.rup_table(&quot;getGridParam&quot;,&quot;colModel&quot;)).each (function (index, element){ var $headerLabel; //Si la columna define ellipsis... if (element.classes === &quot;ui-ellipsis&quot;){ //Añadirle estilos para ellipsis al div que está dentro de la cabecera jQuery(&quot;[id='jqgh_&quot; + settings.id + &quot;_&quot; + element.name+&quot;']&quot;) .css(&quot;display&quot;, &quot;block&quot;) .css(&quot;text-overflow&quot;, &quot;ellipsis&quot;); } //Sustituir DIV del literal de la cabecera por SPAN (para que funcione ellipsis) $headerLabel = jQuery(&quot;[id='jqgh_&quot; + settings.id + &quot;_&quot; + element.name+&quot;']&quot;).children(&quot;div&quot;); $headerLabel.replaceWith(jQuery(&quot;&lt;span&gt;&quot;).text($headerLabel.text()).css(&quot;cursor&quot;,&quot;pointer&quot;)); }); // Configuración de la columna extra utilizada para mostrar el estado de los registros if (settings.showGridInfoCol){ // jQuery(&quot;#gview_&quot;+settings.id+&quot; table thead th#&quot;+settings.id+&quot;_rupInfoCol&quot;).css(&quot;padding-right&quot;,&quot;0px&quot;).css(&quot;padding-left&quot;,&quot;0px&quot;).css(&quot;border-right&quot;,&quot;0px none&quot;); jQuery(&quot;#gview_&quot;+settings.id+&quot; table thead th#&quot;+settings.id+&quot;_rupInfoCol&quot;).css(&quot;border-right&quot;,&quot;0px none&quot;); } if (settings.loadOnStartUp===false || settings.multifilter!=undefined){ settings.datatype = $self.data(&quot;tmp.loadOnStartUp.datatype&quot;); $self.rup_table(&quot;setGridParam&quot;,{datatype:$self.data(&quot;tmp.loadOnStartUp.datatype&quot;)}); $self.removeData(&quot;tmp.loadOnStartUp.datatype&quot;); } } }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** jQuery.fn.rup_table(&quot;extend&quot;,{ /** * Devuelve la propiedad colModel del jqGrid. * * @name jQuery.rup_table#getColModel * @function * @return {object} - Propiedad colModel del jqGrid. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getColModel&quot;); */ getColModel: function(){ return $(this).jqGrid(&quot;getGridParam&quot;,&quot;colModel&quot;); }, /** * Devuelve el valor del parámetro del grid especificado. * * @name jQuery.rup_table#getGridParam * @function * @param {string} pName - Nombre del parámetro que se desea obtener. * @return {object} - Valor del parámetro. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getGridParam&quot;,&quot;nombreParametro&quot;); */ getGridParam : function (pName) { return $(this).jqGrid(&quot;getGridParam&quot;, pName); }, /** * Permite redimensionar la tabla de acuerdo a los parámetros indicados. * * @name jQuery.rup_table#getGridParam * @function * @param {object} options - Parámetros para configurar la altura y anchura del redimensionado. * @return {jQuery} - Referencia al propio componente. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;gridResize&quot;,{}); */ gridResize : function (options){ return $(this).jqGrid('gridResize', options); }, /** * Devuelve un array con los identificadores de los registros seleccionados. * * @name jQuery.rup_table#getSelectedRows * @function * @return {string[]} - Array con los identificadores de los registros seleccionados. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getSelectedRows&quot;); */ getSelectedRows : function(){ var $self = this, settings = $self.data(&quot;settings&quot;); return jQuery.proxy(settings.getSelectedRows, $self)(); }, /** * Devuelve un array con los índices de las líneas de los registros seleccionados. * * @name jQuery.rup_table#getSelectedLines * @function * @return {number[]} - Array con los índices de las líneas de los registros seleccionados. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getSelectedLines&quot;); */ getSelectedLines : function(){ var $self = this, settings = $self.data(&quot;settings&quot;); return jQuery.proxy(settings.getSelectedLines, $self)(); }, /** * El objetivo de este método es construir una URL mediante la cual se pueda realizar una petición para obtener los datos de un registro concreto. * La URL se genera concatenando los valores de las propiedades que forman la primary key del resgistro a la url base especificada en los settings de inicialización. * * @name jQuery.rup_table#getPkUrl * @function * @param {string} rowId - Identificador del registro. * @return {string} - Url para obtener los valores del registro correspondiente. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getPkUrl&quot;,&quot;0001&quot;); */ getPkUrl : function(rowId){ var $self = this, settings = $self.data(&quot;settings&quot;), tmpRowId; if(jQuery.isArray(rowId)){ tmpRowId = rowId[0]!==undefined?rowId[0]:&quot;&quot;; }else{ tmpRowId = rowId; } return tmpRowId.split(settings.multiplePkToken).join('/'); }, /** * Lanza la recarga de la tabla. * * @name jQuery.rup_table#reloadGrid * @function * @param {boolean} async - Indica si la llamada debe ser asíncrona o síncrona. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;reloadGrid&quot;, true); */ reloadGrid: function(async){ var $self = this, settings = $self.data(&quot;settings&quot;), page = $self.rup_table(&quot;getGridParam&quot;, &quot;page&quot;); var ajaxOptions = $self.jqGrid(&quot;getGridParam&quot;, &quot;ajaxGridOptions&quot;); var ajaxOptionsAsync = ajaxOptions.async; ajaxOptions.async = false; // var ajaxOptions = $self.jqGrid(&quot;setGridParam&quot;, {ajaxGridOptions:ajaxOptions}); $self.jqGrid(&quot;setGridParam&quot;, {ajaxGridOptions:ajaxOptions}); $self.jqGrid(&quot;setGridParam&quot;, {page: 1}); $self.trigger(&quot;reloadGrid&quot;); ajaxOptions.async = true; $self.jqGrid(&quot;setGridParam&quot;, {ajaxGridOptions:ajaxOptions}); var nextPagePos = jQuery.proxy(jQuery.jgrid.getCurrPos, $self[0])(); $self.jqGrid(&quot;setSelection&quot;,nextPagePos[1][0]); }, /** * Resetea el formulario indicado. * * @name jQuery.rup_table#resetForm * @function * @param {jQuery} $form - Objeto jQuery que referencia el formulario que se desea resetear. * @return {jQuery} - Referencia al propio objeto. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;resetForm&quot;, $(&quot;#idFormulario&quot;)); */ resetForm: function($form){ var $self = this, settings = $self.data(&quot;settings&quot;); // Se eliminan los estilos de errores de validacion if ($form.data(&quot;validator&quot;) != undefined){ var errorClass = $form.data(&quot;validator&quot;).settings.errorClass; $(&quot;.&quot;+errorClass,$form).removeClass(errorClass); } // Se realiza el reset de los campos ordinarios //form.resetForm(); jQuery(&quot;input[type!='button'][type!='checkbox'][type!='radio'], textarea&quot;, $form).val(&quot;&quot;); jQuery(&quot;input[type='checkbox']&quot;, $form).not(&quot;[name*='jqg_GRID_']&quot;, $form).not(&quot;[disabled='disabled']&quot;, $form).removeAttr(&quot;checked&quot;); // Se realiza el reset de los rup_combo jQuery.each($(&quot;select.rup_combo&quot;,$form), function(index,elem){ if(settings.filter &amp;&amp; settings.filter.clearSearchFormMode===&quot;reset&quot;){ jQuery(elem).rup_combo(&quot;reset&quot;); }else{ jQuery(elem).rup_combo(&quot;clear&quot;); } }); //Vaciar los autocompletes $(&quot;[ruptype='autocomplete']&quot;, $form).each(function (index, element) { $(element).val(&quot;&quot;); }); //Vaciar los arboles $(&quot;[ruptype='tree']&quot;, $form).each(function (index, element) { $(element).rup_tree(&quot;setRupValue&quot;, &quot;&quot;); }); // Se realiza el reset del fomulario if(settings.filter &amp;&amp; settings.filter.clearSearchFormMode===&quot;reset&quot;){ $form.resetForm(); }else{ $(&quot;input[type='radio']&quot;, $form).removeAttr(&quot;checked&quot;); } return $self; }, /** * Asigna a uno o varios parámetros del grid los valores indicados. * * @name jQuery.rup_table#setGridParam * @function * @param {object} newParams - Objeto que contiene los parámetros y sus valores. * @return {jQuery} - Referencia al propio objeto. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;setGridParam&quot;, {param1:value1, param2:value2}); */ setGridParam : function (newParams) { $(this).jqGrid(&quot;setGridParam&quot;, newParams); return $(this); }, /** * Selecciona o deselecciona los registros indicados. * * @name jQuery.rup_table#setSelection * @function * @param {string | string[]} selectedRows - Identificador o array de identificadores de los registros que se desea seleccionar o deseleccionar. * @param {boolean} status - En caso de ser true se seleccionarán los registros indicados. En caso de ser false se deseleccionarán. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;setSelection&quot;, [&quot;3&quot;,&quot;7&quot;], true); */ setSelection : function (selection, status, e){ var $self = this, settings = $self.data(&quot;settings&quot;), ret; ret = $self.triggerHandler(&quot;rupTable_setSelection&quot;, arguments); if (ret!==false){ $self.jqGrid(&quot;setSelection&quot;, selection, status, e); } }, /** * Muestra en los campos del formulario los errores de validación indicados. * * @name jQuery.rup_table#showServerValidationFieldErrors * @function * @param {jQuery} $form - Objeto jQuery que referencia el formulario que se desea resetear. * @param {object} errors - Objeto json que contiene los errores de validación que se han dado para cada campo. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;showServerValidationFieldErrors &quot;, $(&quot;#idFormulario&quot;), {}); */ showServerValidationFieldErrors: function($form, errors){ var $self = $(this); if(errors.rupErrorFields!==undefined || errors.rupFeedback!==undefined){ $form.validate().submitted=$.extend(true, $form.validate().submitted,errors.rupErrorFields); $form.validate().invalid=errors.rupErrorFields; $form.validate().showErrors(errors.rupErrorFields); }else if(errors.rupFeedback!==undefined){ $self.rup_table(&quot;showFeedback&quot;, $form.validate().settings.feedback, $.rup_utils.printMsg(errors.rupFeedback.message), (errors.rupFeedback.imgClass!==undefined?errors.rupFeedback.imgClass:null)); } }, // search : function(async){ // var $self = this, // props = $self[0].p, // settings = $self.data(&quot;settings&quot;); // // jQuery.extend (props.postData,settings.$searchForm.serializeObject()); // var postDataAux = {}; // jQuery.each (props.postData, function(a,b){ // if (b!==''){ // postDataAux[a]=b; // } // }); // props.postData = postDataAux; // // $self.trigger(&quot;reloadGrid&quot;); // }, /** * Elimina el resaltado de la línea especificada de la tabla. * * @name jQuery.rup_table#rupTableClearHighlightedRowAsSelected * @function * @param {jQuery} $row - Objeto jQuery que referencia a la línea de la tabla. * @fires jQuery.rup_table#rupTableClearHighlightedRowAsSelected * @example * $(&quot;#idComponente&quot;).rup_table(&quot;clearHighlightedRowAsSelected&quot;, $(&quot;#idFila&quot;)); */ clearHighlightedRowAsSelected: function($row){ var $self = this, self = $self[0], internalProps = self.p, row = $row[0], froz = internalProps.frozenColumns === true ? internalProps.id + &quot;_frozen&quot; : &quot;&quot;; if(!$row.hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$row.hasClass('ui-state-disabled')){ $(&quot;#jqg_&quot;+$.jgrid.jqID(internalProps.id)+&quot;_&quot;+$.jgrid.jqID(row.id) )[internalProps.useProp ? 'prop': 'attr'](&quot;checked&quot;, false); $row.removeClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;false&quot;); // emp.push(row.id); if(froz) { $(&quot;#jqg_&quot;+$.jgrid.jqID(internalProps.id)+&quot;_&quot;+$.jgrid.jqID(row.id), self.grid.fbDiv )[internalProps.useProp ? 'prop': 'attr'](&quot;checked&quot;,false); $(&quot;#&quot;+$.jgrid.jqID(row.id), self.grid.fbDiv).removeClass(&quot;ui-state-highlight&quot;); } } $self.trigger(&quot;rupTableClearHighlightedRowAsSelected&quot;,[$row]); }, /** * Resalta la línea especificada de la tabla. * * @name jQuery.rup_table#highlightRowAsSelected * @function * @param {jQuery} $row - Objeto jQuery que referencia a la línea de la tabla. * @fires jQuery.rup_table#rupTableHighlightRowAsSelected * @example * $(&quot;#idComponente&quot;).rup_table(&quot;highlightRowAsSelected&quot;, $(&quot;#idFila&quot;)); */ highlightRowAsSelected: function($row){ var $self = this, self = $self[0], internalProps = self.p, row = $row[0], froz = internalProps.frozenColumns === true ? internalProps.id + &quot;_frozen&quot; : &quot;&quot;; if($row.length&gt;0 &amp;&amp; !$row.hasClass(&quot;ui-subgrid&quot;) &amp;&amp; !$row.hasClass(&quot;jqgroup&quot;) &amp;&amp; !$row.hasClass('ui-state-disabled')){ $(&quot;#jqg_&quot;+$.jgrid.jqID(internalProps.id)+&quot;_&quot;+$.jgrid.jqID(row.id) )[internalProps.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $row.addClass(&quot;ui-state-highlight&quot;).attr(&quot;aria-selected&quot;,&quot;true&quot;); internalProps.selarrrow.push(row.id); internalProps.selrow = row.id; if(froz) { $(&quot;#jqg_&quot;+$.jgrid.jqID(internalProps.id)+&quot;_&quot;+$.jgrid.jqID(row.id), self.grid.fbDiv )[internalProps.useProp ? 'prop': 'attr'](&quot;checked&quot;,true); $(&quot;#&quot;+$.jgrid.jqID(row.id), self.grid.fbDiv).addClass(&quot;ui-state-highlight&quot;); } $self.trigger(&quot;rupTableHighlightRowAsSelected&quot;,[$row]); } }, /** * Actualiza el valor de los datos que se muestran en la barra de paginación. * * @name jQuery.rup_table#updateDetailPagination * @function * @param {string} currentRowNumArg - Número actual de los registros que se están mostrando. * @param {string} totalRowNumArg - Número total de los registros que se muestran en la tabla. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;updateDetailPagination&quot;, &quot;1-10&quot;, &quot;586&quot; ); */ updateDetailPagination : function(currentRowNumArg, totalRowNumArg){ var $self = this, settings = $self.data(&quot;settings&quot;), tableId = settings.id, currentRowNum, totalRowNum; currentRowNum = (currentRowNumArg!==undefined ? currentRowNumArg : $.proxy(settings.getDetailCurrentRowCount,$self)()); totalRowNum = (totalRowNumArg!==undefined ? totalRowNumArg : $.proxy(settings.getDetailTotalRowCount,$self)()); if (currentRowNum===1){ $(&quot;#first_&quot;+tableId+&quot;, #back_&quot;+tableId, settings.$detailFormDiv).addClass(&quot;ui-state-disabled&quot;); }else{ $(&quot;#first_&quot;+tableId+&quot;, #back_&quot;+tableId, settings.$detailFormDiv).removeClass(&quot;ui-state-disabled&quot;); } if (currentRowNum === totalRowNum){ $(&quot;#forward_&quot;+tableId+&quot;, #last_&quot;+tableId, settings.$detailFormDiv).addClass(&quot;ui-state-disabled&quot;); }else{ $(&quot;#forward_&quot;+tableId+&quot;, #last_&quot;+tableId, settings.$detailFormDiv).removeClass(&quot;ui-state-disabled&quot;); } $(&quot;#rup_maint_selectedElements_&quot;+$self.attr(&quot;id&quot;)).text(jQuery.jgrid.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.defaults.detailForm_pager&quot;),currentRowNum, totalRowNum)); }, /** * Función de callback que se ejecutará desde el método updateSavedData. * * @callback jQuery.rup_validate~onSubmitHandler * @param {object} savedData - Objeto interno que almacena en formato json los datos con los que se han inicializado los campos del formulario. * @example &lt;caption&gt;Envia el formulario cuando este es válido.&lt;/caption&gt; * $(&quot;#idComponente&quot;).rup_table(&quot;updateSavedData&quot;, function(savedData){ * }); */ /** * Permite modificar el objeto interno _savedData que se utiliza en el control de cambios en el modo de edición en formulario y edición en línea. * * @name jQuery.rup_table#updateSavedData * @function * @param {jQuery.rup_table~onUpdateSavedData} arg -Función de callback desde la que se puede modificar el objeto _savedData. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;updateSavedData&quot;, function(savedData){ * }); */ updateSavedData: function(arg){ var $self = this, settings = $self.data(&quot;settings&quot;); if (jQuery.isFunction(arg)){ jQuery.proxy(arg, $self)(rp_ge[settings.id]._savedData); } } }); jQuery.fn.rup_table(&quot;extend&quot;, { /** * Realiza la configuración interna del paginador de acuerdo a los parámetros de configuración indicados en la inicialización del componente. * * @name jQuery.rup_table#configurePager * @function * @param {object} settings - Parámetros de configuración del componente. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;configurePager&quot;, settings); */ configurePager: function(settings){ var $self = this, pagerName, $pagerCenter, pagerLeft, pagerRight; if (settings.pager!==undefined &amp;&amp; settings.pager!==null){ settings.$pager = $((settings.pager.indexOf(&quot;#&quot;)===0?settings.pager:'#'+settings.pager)); pagerName = settings.$pager.attr(&quot;id&quot;); settings.$pager.css('height','auto'); //Posibilitar redimensionar paginador //Añadir clase a cada parte del paginador $pagerLeft = $('#' + pagerName + '_left'); $pagerCenter = $('#' + pagerName + '_center'); $pagerRight = $('#' + pagerName + '_right'); $pagerLeft.addClass(&quot;pager_left&quot;); $pagerCenter.addClass(&quot;pager_center&quot;); $pagerRight.addClass(&quot;pager_right&quot;); //pager_left //********** //Quitar posibles botones del paginador (y dejar la parte izquierda vacía) $pagerLeft.html(&quot;&quot;); //Contador de seleccionados if (settings.multiselect === true){ $pagerLeft.append( $('&lt;div/&gt;').addClass('ui-paging-selected').html(&quot;0 &quot; + jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.selected&quot;))); } // Pager center jQuery(&quot;.pager_center table td&quot;,settings.$pager).addClass('pagControls'); // Evento de control de página máxima jQuery(&quot;.pagControls input.ui-pg-input&quot;, $pagerCenter).on(&quot;change&quot;, function(){ var pageNum = parseInt($(this).val()), totalNum = parseInt($self.rup_table(&quot;getGridParam&quot;,&quot;lastpage&quot;)); if (isNaN(pageNum)===false &amp;&amp; pageNum&gt;totalNum){ $(this).val(totalNum); } }); // Tooltip al combo de selección de número de registros jQuery(&quot;.pagControls select.ui-pg-selbox&quot;, $pagerCenter).attr(&quot;title&quot;,jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.select&quot;)).rup_tooltip(); // Tooltip al input de selección de página jQuery(&quot;.pagControls input.ui-pg-input&quot;, $pagerCenter).attr(&quot;title&quot;,jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.input&quot;)).rup_tooltip(); //Cambiar flechas paginación por literales jQuery('#first_'+ pagerName, $pagerCenter) .html($('&lt;a/&gt;').attr(&quot;href&quot;,&quot;javascript:void(0)&quot;).html(jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.primPag&quot;)).addClass('linkPaginacion')) .removeClass('ui-pg-button'); jQuery('#prev_'+ pagerName, $pagerCenter) .html($('&lt;a/&gt;').attr(&quot;href&quot;,&quot;javascript:void(0)&quot;).html(jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.anterior&quot;)).addClass('linkPaginacion')) .removeClass('ui-pg-button'); jQuery('#next_'+ pagerName, $pagerCenter) .html($('&lt;a/&gt;').attr(&quot;href&quot;,&quot;javascript:void(0)&quot;).html(jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.siguiente&quot;)).addClass('linkPaginacion')) .removeClass('ui-pg-button'); jQuery('#last_'+ pagerName, $pagerCenter) .html($('&lt;a/&gt;').attr(&quot;href&quot;,&quot;javascript:void(0)&quot;).html(jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_grid.pager.ultiPag&quot;)).addClass('linkPaginacion')) .removeClass('ui-pg-button'); } } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** jQuery.fn.rup_table(&quot;extend&quot;, { /** * Método de inicialización del componente. * * @name jQuery.rup_table#_init * @function * @private * @param {object} args - Parámetros de configuración del componente. * @fires jQuery.rup_table#rupTable_coreConfigFinished */ _init : function(args) { if (args.length &gt; 1) { jQuery.rup.errorGestor(jQuery.rup.i18nParse(jQuery.rup.i18n.base,&quot;rup_global.initError&quot;) + $(this).attr(&quot;id&quot;)); }else { var $self = this, settings = {}; /* ************************* * CONFIGURACION * *************************/ var defaultPugins = (jQuery.isArray(args[0].defaultPlugins)?args[0].defaultPlugins:jQuery.fn.rup_table.defaults.defaultPlugins), userPlugins = jQuery.merge([], args[0].usePlugins), configuredPlugins = jQuery.merge(jQuery.merge([], defaultPugins), userPlugins); jQuery.rup_utils.sortArray(configuredPlugins, function(obj1,obj2){ return rup_table.plugins[obj2].loadOrder - rup_table.plugins[obj1].loadOrder; }); /* ********************************************************* * SE PROCESA LAS CONFIGURACION POR DEFECTO DEL CORE * ********************************************************* */ settings = $.extend(true,{}, settings, jQuery.fn.rup_table.plugins.core.defaults); /* ********************************************************* * SE PROCESAN LAS CONFIGURACIONES POR DEFECTO DE LOS PLUGINS * ********************************************************* */ $.each(configuredPlugins, function(index, name){ if (rup_table.plugins[name] !== undefined &amp;&amp; jQuery.fn.rup_table.plugins[name] !== undefined){ settings = $.extend(true,{}, settings, jQuery.fn.rup_table.plugins[name].defaults); } }); // Se sobreescribe la configuración por defecto con la especificada por el usaurio settings = jQuery.extend(true, {}, jQuery.fn.rup_table.defaults, settings, args[0]); /* ********************************************************* * EJECUCION DE LA PRECONFIGURACION DEL CORE * *********************************************************/ $self.rup_table(&quot;preConfigureCore&quot;,settings); /* ********************************************************* * EJECUCION DE FUNCIONES DE PRECONFIGURACION DE LOS PLUGINS * ********************************************************* */ $.each(configuredPlugins, function(index, name){ if (jQuery.isFunction(rup_table.plugins[name].preConfiguration)){ jQuery.proxy(rup_table.plugins[name].preConfiguration, $self)(settings); } }); /* * INVOCACIÓN al plugin subyacente jqGrid */ $self.jqGrid(settings); /* ********************************************************* * EJECUCION DE LA POSTCONFIGURACION DEL CORE * *********************************************************/ $self.rup_table(&quot;postConfigureCore&quot;,settings); /* ********************************************************* * EJECUCION DE FUNCIONES DE POSTCONFIGURACION DE LOS PLUGINS * *********************************************************/ $.each(configuredPlugins, function(index, name){ if (jQuery.isFunction(rup_table.plugins[name].postConfiguration)){ jQuery.proxy(rup_table.plugins[name].postConfiguration, $self)(settings); } }); // Se almacenan los settings medainte el data para ser accesibles en las invocaciones a los métodos públicos. $self.data(&quot;settings&quot;,settings); $self.triggerHandler(&quot;rupTable_coreConfigFinished&quot;); } }, /** * Devuelve el índice de la línea identificada mediante el valor indicado por parámetro. * * @name jQuery.rup_table#_getLineIndex * @function * @private * @param {string} rowId - Identificador del registro. * @return {number} - Índice de la línea. */ _getLineIndex: function(rowId){ var $self = this, settings = $self.data(&quot;settings&quot;), tableghead = settings.id+&quot;ghead_&quot;, count=0, $row, id; if ($self.rup_table(&quot;getGridParam&quot;,&quot;grouping&quot;)===true){ for (var i=0; i&lt;$self[0].rows.length;i++){ $row = jQuery($self[0].rows[i]); id = $row.attr(&quot;id&quot;); if (id !== undefined &amp;&amp; id.indexOf(tableghead)===-1){ count++; if (id===rowId){ return count; } } } }else{ return $self.jqGrid(&quot;getInd&quot;,rowId); } } }); //********************************************************************* // MÉTODOS PARA MANTENER LA RETROCOMPATIBILIDAD CON LA API DEL RUP.GRID //********************************************************************* jQuery.fn.rup_table(&quot;extend&quot;,{ /** * Añade una nueva línea a la tabla. Esta operación no realiza una inserción del registro en el sistema de persistencia, sino que únicamente añade una nueva fila de modo visual. * * @name jQuery.rup_table#addRowData * @function * @param {string} rowid - Identificador del registro. * @param {object} data - Objeto json que contiene los valores de cada columna de la nueva línea. * @param {string} position - fisrt o last. Determina la posición donde se va a insertar el registro. * @param {string} srcrowid -En el caso de indicarse se insertará la nueva línea en la posición relativa al registro que identifica y el valor del parámetro position. * @return {jQuery} - Referencia al propio componente. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;addRowData&quot;, &quot;10&quot;, {campo1:valor1,campo2:valor2}); */ addRowData : function (rowid, data, position, srcrowid) { var $self = $(this); // //Se aade la capa de separacion para diferenciar los nuevos elementos incluidos // if ($(&quot;#&quot; + tableName + &quot; #separadorAadidos&quot;).html() === null) { // $(&quot;#&quot; + tableName + &quot; tr:first-child&quot;).after($(&quot;#&quot; + tableName + &quot; tr:first-child&quot;).clone(false).css(&quot;display&quot;, &quot;none&quot;).css(&quot;height&quot;, &quot;&quot;).attr(&quot;id&quot;, &quot;separadorAadidos&quot;)); // // $.each($(&quot;#&quot; + tableName + &quot; #separadorAadidos td&quot;) , function (index, object) { // $(this).html(&quot;&quot;).attr(&quot;class&quot;, &quot;tdAddSeparator&quot;); // }); // // $(&quot;#&quot; + tableName + &quot; #separadorAadidos&quot;).addClass(&quot;trAddSeparator&quot;); // $(&quot;#&quot; + tableName + &quot; #separadorAadidos&quot;).css(&quot;display&quot;, &quot;&quot;); // } return $self.jqGrid(&quot;addRowData&quot;, rowid, data, position, srcrowid); //Añadimos los estilos de elemento añadido // $(&quot;#&quot; + tableName + &quot; #&quot; + rowid).addClass(&quot;addElement&quot;); //$(&quot;#&quot; + tableName + &quot; #&quot; + rowid + &quot; td&quot;).addClass(&quot;addElementBorder&quot;); }, /** * Elimina de la tabla un registro determinado. El registro no se elimina del sistema de persistencia. Solo se elimina de manera visual. * * @name jQuery.rup_table#delRowData * @function * @param {string} rowid - Identificador del registro. * @return {jQuery} - Referencia al propio componente. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;delRowData&quot;,&quot;10&quot;); */ delRowData : function (rowid) { var $self = $(this); $self.jqGrid(&quot;delRowData&quot;, rowid); return $self; }, /** * Devuelve el identificador de la línea activa. * * @name jQuery.rup_table#getActiveRowId * @function * @return {string} - Identificador de la línea activa. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getActiveRowId&quot;); */ getActiveRowId : function(){ var $self = this, settings = $self.data(&quot;settings&quot;); return jQuery.proxy(settings.getActiveRowId, $self)(); }, /** * Devuelve el índice de la línea activa. * * @name jQuery.rup_table#getActiveLineId * @function * @return {string} - Índice de la línea activa. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getActiveLineId&quot;); */ getActiveLineId : function(){ var $self = this, settings = $self.data(&quot;settings&quot;); return jQuery.proxy(settings.getActiveLineId, $self)(); }, /** * Actualiza los valores de las columnas de un registro determinado. La actualización de loa datos se realiza solo de manera visual. Los nuevos datos no se persisten. * * @name jQuery.rup_table#setRowData * @function * @param {string} rowid - Identificador del registro que se desea actualizar. * @param {object} data - Objeto json que contiene los valores de cada columna de la nueva línea. * @param {string} cssp - En caso de especificarse, se añadirán a la línea las class de estilos aquí indicadas. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;setRowData&quot;, &quot;10&quot;, {campo1:valor1,campo2:valor2}); */ setRowData : function (rowid, data, cssp) { var $self = $(this); $self.jqGrid(&quot;setRowData&quot;, rowid, data, cssp); //Actualizar tooltip de las celdas de la fila jQuery(&quot;td[title]&quot;, $self).each(function(index, elem){ var $cell = jQuery(elem), title = $cell.prop(&quot;title&quot;); $cell.attr({&quot;grid_tooltip&quot;:title, &quot;oldtitle&quot;:title}).removeAttr(&quot;title&quot;); }); }, /** * Devuelve un objeto json con los valores de los campos del registro indicado. * * @name jQuery.rup_table#getRowData * @function * @param {string} rowid - Identificador del registro del que se quieren recuperar los datos. * @return {object} - Objecto json con los valores del registro. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getRowData&quot;, &quot;10&quot;); */ getRowData: function(rowid){ var $self = $(this); return $self.jqGrid(&quot;getRowData&quot;, rowid); }, /** * Devuelve un array con los identificadores de los registros que se muestran actualmente en la página de la tabla. * * @name jQuery.rup_table#getDataIDs * @function * @return {string[]} - Identificadores de lso registros mostrados en la página actual. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getDataIDs&quot;); */ getDataIDs : function () { var $self = $(this); return $self.jqGrid(&quot;getDataIDs&quot;); }, /** * Limpia los registros mostrados en la tabla. * * @name jQuery.rup_table#clearGridData * @function * @param {boolean} clearfooter - En caso de indicarse como true se elimina la información del pié de la tabla. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;clearGridData&quot;, false); */ clearGridData : function (clearfooter) { var $self = $(this); return $self.jqGrid(&quot;clearGridData&quot;, clearfooter); }, /** * Devuelve el objeto colModel del componente jqGrid. * * @name jQuery.rup_table#getColModel * @function * @return {object} - Objeto colModel de la tabla. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getColModel&quot;); */ getColModel : function () {// Función que devuelve el colModel directamente. var $self = $(this); return $self.jqGrid(&quot;getGridParam&quot;, &quot;colModel&quot;); }, /** * Devuelve el valor de la columna de la fila indicada. * * @name jQuery.rup_table#getCol * @function * @param {string} rowid - Identificador de la fila. * @param {string} colName - Nombre de la columna. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getCol&quot;, &quot;10&quot;, &quot;nombre&quot;); */ getCol : function (rowid, colName) { //Función que devuelve el valor de la celda de la fila que se le pasa como paramtero. El colName puede ser o el indice de la columna o el nombre de la misma var $self = $(this); return $self.jqGrid(&quot;getCell&quot;, rowid, colName); }, /** * Devuelve un objeto json que contiene la serialización del formulario. * * @name jQuery.rup_table#getSerializedForm * @function * @param {jQuery} form - Formulario que se desea serializar. * @param {boolean} skipEmpty - En caso de indicarse true se omiten los campos que no contienen valor. * @example * $(&quot;#idComponente&quot;).rup_table(&quot;getSerializedForm&quot;, $(&quot;#idFormulario&quot;), false); */ getSerializedForm: function(form, skipEmpty, delimeter){ return form2object(form instanceof jQuery?form[0]:form, delimeter?delimeter:null, skipEmpty?skipEmpty:false); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* jQuery.fn.rup_table.plugins = {}; jQuery.fn.rup_table.plugins.core = {}; jQuery.fn.rup_table.plugins.core.defaults = { core:{ operations:{}, defaultOperations:{}, showOperations:{}, defaultLoadErrorTitle:$.rup.i18n.base.rup_ajax.errorTitle } }; /** * Función de callback que será ejecutada cuando el usuario realice una acción sobre la operación. * * @callback jQuery.rup_table~onOperation * @param {string} key - Identificador de la operación * @param {object} options - Opciones de configuración de la operación. * @example * callback: function(key, options){ * alert(&quot;Operación 1&quot;); * } */ /** * Función de callback que determina si la operación debe estar habilitada o no. * * @callback jQuery.rup_table~isEnabled * @return {boolean} - Devuelve si la operación debe de estar habilitada o no. * @example * enabled: function(){ * return true; * } */ /** * Mediante esta propiedad se definen las posibles operaciones a realizar sobre los registros mostrados en la tabla. Debido al carácter global de estas operaciones se toman en cuenta por otros componentes (toolbar, menú contextual) a la hora de mostrar sus controles. Las operaciones se definen mediante un objeto json en el cual el nombre de la propiedad será el identificador de la propiedad. * * @typedef {Object} jQuery.rup_table~Operations * @property {string} [name] - Texto a mostrar al usuario a la hora de visualizar la operación. * @property {string} [icon] - Clase CSS correspondiente al icono que se quiere visualizar junto a la operación. * @property {jQuery.rup_table~isEnabled} [enabled] - Función que determina si el botón se debe mostrar habilitado o deshabilitado. Esto se determina devolviendo true/false desde la función de callback aquí indicada. * @property {jQuery.rup_table~onOperation} [callback] - Función de callback que será ejecutada cuando el usuario realice una acción sobre la operación. * @example * core:{ * operations:{ * &quot;operacion1&quot;: { * name: &quot;Operación 1&quot;, * icon: &quot;rup-icon rup-icon-new&quot;, * enabled: function(){ * return true; * }, * callback: function(key, options){ * alert(&quot;Operación 1&quot;); * } * }, * &quot;operacion2&quot;: { * name: &quot;Operación 2&quot;, * icon: &quot;rup-icon rup-icon-new&quot;, * enabled: function(){ * return true; * }, * callback: function(key, options){ * alert(&quot;Operación 1&quot;); * } * } * } * } */ /** * Permite habilitar/deshabilitar las operaciones definidas por defecto por otros módulos. * * @typedef jQuery.rup_table~ShowOperations * @example * core:{ * showOperations:{ * add:false; * clone:false; * } * } */ /** * @description Propiedades de configuración del componente. * @see Para mas información consulte la documentación acerca de las opciones de configuración del componente {@link http://www.trirand.com/jqgridwiki/doku.php|jqGrid}. * * @name jQuery.rup_table#options * @property {boolean} [altRows=true] - Determina si se aplica o no el pijama en las filas de la tabla. * @property {string} [altclass=rupgrid_oddRow] - Estilo que se aplica a las filas impares para mostrar el efecto. * @property {string} [datatype=json] - Formato de dato esperado para representar los registros de la tabla. * @property {string} [height=auto] - Determina la altura de la tabla. * @property {object} [jsonReader={repeatitems: false}] - Parámetros de configuración que determinan el modo en el que se va a procesar el json de retorno del servidor * @property {boolean} [resizable=false] - Determina si la tabla puede ser redimensionada mediante el ratón. * @property {number} [rowNum=10] - Número de registros por página que se van a mostrar en la tabla. * @property {number[]} [rowList=[10,20,30]] - Lista de posibles valores para el número de elementos por página que se van a mostrar en el combo de selección correspondiente. * @property {boolean} [sortable=true] - Determina si se permite variar el orden de las columnas arrastrándolas. * @property {boolean} [viewrecords=true] - Indica si se debe mostrar el rango de elementos que se están visualizando en la tabla. * @property {boolean} [loadOnStartUp=true] - Determina si se debe realizar automáticamente la búsqueda al cargar la página. * @property {string} [multiplePkToken=~] - Separador que se utiliza en los casos en los que la clave primaria sea múltiple. Se creará una columna que contenga un identificador único resultante de la concatenación de las claves primarias realizada mediante el separador aquí indicado. * @property {jQuery.rup_table~Operations} [operations] - Mediante esta propiedad se definen las posibles operaciones a realizar sobre los registros mostrados en la tabla. Debido al carácter global de estas operaciones se toman en cuenta por otros componentes (toolbar, menú contextual) a la hora de mostrar sus controles. Las operaciones se definen mediante un objeto json en el cual el nombre de la propiedad será el identificador de la propiedad. * @property {jQuery.rup_table~ShowOperations} [showOperations] - Permite habilitar/deshabilitar las operaciones definidas por defecto por otros módulos. * @property {number} [startOnPage=1] - Permite especificar el número de página inicial que se mostrará al cargar la página. */ jQuery.fn.rup_table.defaults = { altRows: true, altclass: &quot;rup-grid_oddRow&quot;, datatype: &quot;json&quot;, // Tipo de dato esperado para representar los registros de la tabla (jqGrid) editable: false, // Determina si la tabla permite la edición en línea (rup_table) height: &quot;auto&quot;, // Ajusta la altura de la tabla al contenido (jqGrid) jsonReader : {repeatitems: false}, // Parámetros de configuración que describen la estructura del json esperado (jqGrid) pager: null, resizable: false, // Determina si la tabla puede ser redimensionada mediante el ratón (jqGrid) rowNum:10, // Determina el número de registros que se van a mostrar por página rowList:[10,20,30], // Valores a mostrar en el combo de selección de número de registros por página sortable: true, // Determina si se puede realizar drag&amp;drop con las columnas de la tabla (jqGrid) viewrecords: true, // Muestra el rango de elementos que se están mostrando en la tabla (jqGrid) mtype: &quot;POST&quot;, loadError : function(xhr,st,err){ var $self = $(this), settings = $self.data(&quot;settings&quot;); jQuery.rup_messages(&quot;msgError&quot;, { title: settings.core.defaultLoadErrorTitle, message: xhr.responseText }); }, loadOnStartUp: true, // Callback ejecutado en las peticiones AJAX de la tabla loadBeforeSend: function rup_table_defaults_loadBeforeSend(xhr, settings){ // Se modifica la request para incluir las siguientes cabeceras: // Se añade la cabecera JQGridModel para indicar que la petición ha sido realizada por el componente rup_table xhr.setRequestHeader(&quot;JQGridModel&quot;, &quot;true&quot;); // Se indica que el tipo de contenido enviado en la cabecera es application/jsons xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/json&quot;); }, loadui: &quot;block&quot;, validate:{}, defaultPlugins:[], dataProxy: jQuery.rup_table.proxyAjax, defaultGridInfoCol:{ name: &quot;rupInfoCol&quot;, index: &quot;rupInfoCol&quot;, editable:false, fixed:true, sortable:false, width:16, resizable: false, classes:&quot;rupInfoCol&quot;, search:false, formatter:function(){return &quot;&lt;span class='ui-icon ui-icon-rupInfoCol'/&gt;&quot;;} }, defaultGridMultiplePkCol:{ name: &quot;pkCol&quot;, index: &quot;pkCol&quot;, hidden:true, editable:false, fixed:true, sortable:false, width:25, resizable: false,search:false }, multiplePkToken:&quot;~&quot;, scrollOffset:0, showGridInfoCol:false, tooltipDelay: 500 }; /* ********* */ /* EVENTOS /* ********* */ /** * Evento que se produce al detectarse que el usuario interactua con un elemento externo a la tabla. * * @event jQuery.rup_table#rupTable_checkOutOfGrid * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {jQuery} $originalTarget - Objeto jQuery que referencia el elemento del dom con el que ha interactuado el usuario. * @example * $(&quot;#idComponente&quot;).on(&quot;rupTable_checkOutOfGrid&quot;, function(event, * $originalTarget){ }); */ /** * Este evento se lanza durante el proceso de serialización de la información que va a ser enviada para obtener los registros que se van a mostrar en la tabla. * * @event jQuery.rup_table#rupTable_serializeGridData * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Información serializada que va a ser enviada. Se puede modificar o agregar nuevos campos para completarla. * @example * $(&quot;#idComponente&quot;).on(&quot;rupTable_serializeGridData&quot;, function(event, data){ * }); */ /** * Evento que se lanza antes de que se procese la información recibida del servidor. * * @event jQuery.rup_table#rupTable_beforeProcessing * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Información recibida del servidor. * @property {string} st - Mensaje de status de la petición. * @property {object} xhr - Objeto xhr recibido. * @example * $(&quot;#idComponente&quot;).on(&quot;rupTable_beforeProcessing&quot;, function(event, data, st, * xhr){ }); */ /** * Se produce cuando se elimina el resaltado de un registro de la tabla. * * @event jQuery.rup_table#rupTableClearHighlightedRowAsSelected * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {jQuery} $row - Objeto jQuery que identifica la línea que se ha procesado. * @example * $(&quot;#idComponente&quot;).on(&quot;rupTableClearHighlightedRowAsSelected&quot;, function(event, $row){ }); */ /** * Se produce cuando se añade el resaltado a un registro de la tabla. * * @event jQuery.rup_table#rupTableHighlightRowAsSelected * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {jQuery} $row - Objeto jQuery que identifica la línea que se ha procesado. * @example * $(&quot;#idComponente&quot;).on(&quot;rupTableHighlightedRowAsSelected&quot;, function(event, $row){ }); */ /** * Evento que se lanza después de que el componente haya finalizado con el proceso de configuración e inicialización. * * @event jQuery.rup_table#rupTable_coreConfigFinished * @property {Event} e - Objeto Event correspondiente al evento disparado. * @example * $(&quot;#idComponente&quot;).on(&quot;rupTable_coreConfigFinished&quot;, function(event, $row){ }); */ })(jQuery); × Search results Close "},"rup.tooltip.js.html":{"id":"rup.tooltip.js.html","title":"Source: rup.tooltip.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.tooltip.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Tooltip. * @author EJIE * @version 2.4.10 */ (function ($) { //**************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //**************************************************************************************************************** /** * Se les presenta a los usuarios una barra de botones con diversas funcionalidades relacionadas a elementos de la página. Gracias a este componente se presentan, ordenan y agrupan las distintas funcionalidades gestionadas por las aplicaciones. * * @summary Componente RUP Tooltip. * @namespace jQuery.rup_tooltip * @memberOf jQuery * @tutorial rup_tooltip * @see El componente está basado en el plugin {@link http://qtip2.com/options|qTip2}. Para mas información acerca de las funcionalidades y opciones de configuración pinche {@link http://qtip2.com/options|aquí}. * @example * $(&quot;[title]&quot;).rup_tooltip({}); */ var rup_tooltip = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_tooltip&quot;, rup_tooltip)); //******************************* // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************* $.fn.rup_tooltip(&quot;extend&quot;,{ /** * Muestra el tooltip. * * @name jQuery.rup_tooltip#open * @function * @example * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;open&quot;); */ open: function() { $(this).qtip('show', true); }, /** * Oculta el tooltip. * * @name jQuery.rup_tooltip#close * @function * @example * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;close&quot;); */ close: function(){ $(this).qtip('hide', true); }, /** * Habilita el tooltip. * * @name jQuery.rup_tooltip#enable * @function * @example * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;enable&quot;); */ enable: function() { $(this).qtip('enable', true); }, /** * Deshabilita el tooltip. * * @name jQuery.rup_tooltip#disable * @function * @example * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;disable&quot;); */ disable: function() { $(this).rup_tooltip('close'); $(this).qtip('disable', true); }, /** * Elimina el tooltip. * * @name jQuery.rup_tooltip#destroy * @function * @example * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;destroy&quot;); */ destroy: function() { $(this).rup_tooltip('disable'); $(this).qtip('destroy'); }, /** * Obtiene o establece la configuración del tooltip. * * @name jQuery.rup_tooltip#option * @param {string} option - Nombre de la propiedad que se desea gestionar. * @param {*} [value] - Corresponde al valor de la propiedad en caso de haberse especificado el nombre de la misma en el primér parámetro. * @function * @example * // Obtener el valor de la posición * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;option&quot;, &quot;position&quot;); * // Establecer el valor de la posición * $(&quot;#idTooltip&quot;).rup_tooltip(&quot;option&quot;, &quot;position&quot;, {offset: &quot;15 15&quot;}); */ option: function(option, value){ return $(this).qtip('option', option, value); } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* $.fn.rup_tooltip(&quot;extend&quot;, { _init : function(args){ if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.initError&quot;) + $(this).attr(&quot;id&quot;)); } else { if ($(this).size()&gt;0){//Evitar invocaciones sin objetos (grid) var settings = $.extend({}, $.fn.rup_tooltip.defaults, args[0]), isGrid = this[0].className.indexOf(&quot;rup-grid&quot;) !== -1, openUserEvent; //Identificador de la capa del tooltip if (settings.id === undefined){ settings.id = $(this).attr('id'); } if (isGrid){ var elems = $(this) //Modificar atributo 'title' por 'rup_tooltip' .each(function(index, element) { $.attr(this, 'rup_tooltip', $.attr(this, 'title')); if (element.localName === 'img'){ $(element).parents(&quot;td&quot;).attr(&quot;rup_tooltip&quot;, $(element).attr(&quot;rup_tooltip&quot;)); } }) //Eliminar atributo 'title' .removeAttr('title'); settings = { content : ' ', position: { target: 'event', effect: false }, show : { delay: settings.show.delay }, hide : { delay: 0 //Para que funcione correctamente en las tablas }, events: { show: function(event, api) { var target = $(event.originalEvent.target); if(target.length) { //Recorrer hasta encontrar atributo o ser columna while (target.attr('rup_tooltip') === undefined &amp;&amp; target[0].nodeName !== &quot;TD&quot;){ target = $(target).parent(); } //Correción para datos vacíos api.set('content.text', (target.attr('rup_tooltip') === '')?' ':target.attr('rup_tooltip')); if (target.attr('rup_tooltip') === '' || target.attr('rup_tooltip') === ' '){ target.qtip('destroy'); } //Si es última columna que comience en la izquierda //Obtenemos la columna (puede que el target sea A, IMG, ...) if (target[0].nodeName !== &quot;TD&quot;){ target = $(target).parents(&quot;td&quot;); } //Cambiamos posición tooltip if (target.nextAll(&quot;td:visible&quot;).length==0){ api.set('position.my.x', 'right'); //Última columna } else { api.set('position.my.x', 'left'); //Otra columna } //Cambiamos el objetivo del tooltip (puede que el target sea A, IMG, ...) api.set('position.target',target); } }, render: function(event, api) { if($.rup_utils.aplicatioInPortal()){ $(&quot;div.r01gContainer&quot;).append($(this)); if(!($(&quot;#qtip-overlay&quot;).size() === 0)){ $(&quot;div.r01gContainer&quot;).append($(&quot;#qtip-overlay&quot;)); } } } } }; //Unificar en una capa el TOOLTIP $(this).qtip(settings); } else { var thisPortal; if(($.rup_utils.aplicatioInPortal()) &amp;&amp; (!settings.applyToPortal)){ thisPortal = $(&quot;div.r01gContainer &quot;+ $(this).selector); } else { thisPortal = this; } if (settings.open !== undefined){ settings.events.show = settings.open; } if (settings.close !== undefined){ settings.events.hide = settings.close; } settings.events.render = function(event, api) { if($.rup_utils.aplicatioInPortal()){ $(&quot;div.r01gContainer&quot;).append($(this)); if(!($(&quot;#qtip-overlay&quot;).size() === 0)){ $(&quot;div.r01gContainer&quot;).append($(&quot;#qtip-overlay&quot;)); } // api.set('position.my.x', api.get('position.my.x')); } }; $(thisPortal).qtip(settings); if (settings.disabled){ $(thisPortal).qtip('disable'); } } } } } }); //****************************************************** // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** $.fn.rup_tooltip.defaults = { disabled: false, applyToPortal: false, show:{ delay:0 }, //tooltip position: { my: 'top left', at: 'bottom right', target: 'event', effect: false }, events : {} }; /** * Función que se ejecutará cuando se muestre el tooltip. * * @callback jQuery.rup_tooltip~onOpen * @example * $(&quot;#idTooltip&quot;).rup_tooltip({ * open: function(){ * } * }); */ /** * Función que se ejecutará cuando se oculte el tooltip. * * @callback jQuery.rup_tooltip~onClose * @example * $(&quot;#idTooltip&quot;).rup_tooltip({ * close: function(){ * } * }); */ /** * @description Propiedades de configuración del componente. * @see Para mas información consulte la documentación acerca de las opciones de configuración del plugin {@link http://qtip2.com/options|qTip2}. * * @name jQuery.rup_tooltip#options * @property {boolean} [disabled=false] - booleano que indica si el tooltip está habilitado o no. * @property {boolean} [applyToPortal=false] - Parámetro encargado de determinar si el componente tooltip se aplica, también, al código html adscrito a los portales de la infraestructura de EJIE. El parámetro acepta el valor true, para indicar que se aplique al portal, y el valor false, para indicar que no se aplique al portal. * @property {object} [content] - Configura el texto del tooltip (si no se ha definido en el title). * @property {string} [content.text] - Texto del tooltip. * @property {string} [content.title] - Tooltip en formato diálogo y este parámetro define el título del mismo. * @property {object} [position] - Configura la posición del tooltip y tiene (entre otros) los siguientes parámetros. * @property {string} position.my=top left - Posición en la que es colocado el tooltip a mostrar parámetros. * @property {string} position.at=bottom left - Posición respecto al objeto al que se aplica el tooltip. * @property {string} position.target - Si se quiere definir sobre qué elemento debe aplicarse el tooltip. parámetros. * @property {object} [show] - Configura el modo/evento en el que se despliega el tooltip. * @property {string} show.event=mouseenter - Evento con el que se muestra el tooltip. * @property {object} show.modal - Configura el modo/evento en el que se despliega el tooltip. * @property {object} [hide] - Configura el modo/evento en el que se oculta el tooltip. * @property {object} hide.event=mouseleave - Evento con el que se oculta el tooltip. * @property {jQuery.rup_tooltip~onOpen} [open] - Permite asociar una función que se ejecutará cuando se muestre el tooltip. * @property {jQuery.rup_tooltip~onClose} [close] - Permite asociar una función que se ejecutará cuando se oculte el tooltip. */ })(jQuery); × Search results Close "},"rup.upload.js.html":{"id":"rup.upload.js.html","title":"Source: rup.upload.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.upload.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Upload. * @author EJIE * @version 2.4.10 */ (function ($) { $.widget('blueimpUIX.fileupload', $.blueimpUI.fileupload, { options: { errorMessages: { maxFileSize: $.rup.i18nParse($.rup.i18n.base, &quot;rup_upload.maxFileSizeError&quot;), minFileSize: $.rup.i18nParse($.rup.i18n.base, &quot;rup_upload.minFileSizeError&quot;), acceptFileTypes: $.rup.i18nParse($.rup.i18n.base, &quot;rup_upload.acceptFileTypesError&quot;), maxNumberOfFiles: $.rup.i18nParse($.rup.i18n.base, &quot;rup_upload.maxNumberOfFilesError&quot;) } }, _renderUpload: function (files) { var that = this, options = this.options, tmpl = this._renderUploadTemplate(files), isValidated = this._validate(files); if (!(tmpl instanceof $)) { return $(); } var settings = $.data(this.element[0], &quot;settings&quot;); tmpl.css('display', 'none'); // .slice(1).remove().end().first() removes all but the first // element and selects only the first for the jQuery collection: tmpl.find('.progress div').slice( isValidated ? 1 : 0 ).remove().end().first() .progressbar(); tmpl.find('.start button').slice( this.options.autoUpload || !isValidated ? 0 : 1 ).remove().end().first() .button({ text: true, icons: {primary: 'ui-icon-circle-arrow-e'} }); var cancelButton = tmpl.find('.cancel button').slice(1).remove().end().first() .button({ text: true, icons: {primary: 'ui-icon-cancel'} }); if(settings.submitInForm){ cancelButton.bind(&quot;click&quot;,function(event){ var newFileInput; event.preventDefault(); that.options.fileInput.attr(&quot;value&quot;,&quot;&quot;); newFileInput=that.options.fileInput.clone(true).attr(&quot;value&quot;,&quot;&quot;).insertAfter(that.options.fileInput); that.options.fileInput.remove(); that.options.fileInput=newFileInput; }); } tmpl.find('.preview').each(function (index, node) { that._loadImage( files[index], function (img) { $(img).hide().appendTo(node).fadeIn(); }, { maxWidth: options.previewMaxWidth, maxHeight: options.previewMaxHeight, fileTypes: options.previewFileTypes, canvas: options.previewAsCanvas } ); }); return tmpl; }, _renderDownload: function (files) { var tmpl = this._renderDownloadTemplate(files); if (!(tmpl instanceof $)) { return $(); } tmpl.css('display', 'none'); tmpl.find('.delete button').button({ text: true, icons: {primary: 'ui-icon-trash'} }); tmpl.find('a').each(this._enableDragToDesktop); return tmpl; }, _renderUploadTemplate: function (files) { var that = this, rows = $(); var settings = $.data(this.element[0], &quot;settings&quot;); $.each(files, function (index, file) { file = that._uploadTemplateHelper(file); var row = $( '&lt;tr class=&quot;template-upload&quot;&gt;&lt;td&gt;' + '&lt;div class=&quot;formulario_columna_cnt&quot;&gt;' + '&lt;span class=&quot;izq_float file_icon&quot;&gt;&amp;nbsp;&lt;/span&gt;' + '&lt;div class=&quot;izq_float name&quot;&gt;&lt;b&gt;&lt;/b&gt;&lt;/div&gt;' + '&lt;div class=&quot;formulario_columna_cnt&quot;&gt;' + '&lt;div class=&quot;izq_float type&quot;&gt;&lt;/div&gt;' + '&lt;div class=&quot;izq_float size&quot;&gt;&lt;/div&gt;' + (settings.submitInForm ? '&lt;div class=&quot;izq_float cancel&quot; style&gt;&lt;button&gt;'+$.rup.i18nParse($.rup.i18n.base,&quot;rup_upload.cancelUpload&quot;)+'&lt;/button&gt;&lt;/div&gt;' : '') + '&lt;/div&gt;' + (!settings.submitInForm ? '&lt;div class=&quot;formulario_columna_cnt&quot;&gt;' + (file.error ? '&lt;div class=&quot;izq_float error&quot; &gt;&lt;/div&gt;' : '&lt;div class=&quot;izq_float progress&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;' + '&lt;div class=&quot;izq_float start fileupload-buttonbar ui-button&quot;&gt;&lt;button&gt;'+$.rup.i18nParse($.rup.i18n.base,&quot;rup_upload.startUpload&quot;)+'&lt;/button&gt;&lt;/div&gt;' ) + '&lt;div class=&quot;izq_float cancel&quot;&gt;&lt;button&gt;'+$.rup.i18nParse($.rup.i18n.base,&quot;rup_upload.cancelUpload&quot;)+'&lt;/button&gt;&lt;/div&gt;' + '&lt;/div&gt;':'&lt;div class=&quot;izq_float start fileupload-buttonbar ui-button&quot; style=&quot;display:none&quot;&gt;&lt;button&gt;'+$.rup.i18nParse($.rup.i18n.base,&quot;rup_upload.startUpload&quot;)+'&lt;/button&gt;&lt;/div&gt;') + '&lt;/td&gt;&lt;/tr&gt;'); row.find('.name b').text(file.name); row.find('.size').text(file.sizef); row.find('.type').text(file.type); if (file.error) { row.addClass('ui-state-error'); row.find('.error').text( that.options.errorMessages[file.error] || file.error ); } rows = rows.add(row); }); return rows; }, _renderDownloadTemplate: function (files) { var that = this, rows = $(); $.each(files, function (index, file) { file = that._downloadTemplateHelper(file); var row = $('&lt;tr class=&quot;template-download&quot;&gt;&lt;td&gt;' + (file.error ? '&lt;td class=&quot;file_icon&quot;&gt;&lt;/td&gt;' + '&lt;td class=&quot;name&quot;&gt;&lt;/td&gt;' + '&lt;td class=&quot;size&quot;&gt;&lt;/td&gt;' + '&lt;td class=&quot;error&quot; colspan=&quot;2&quot;&gt;&lt;/td&gt;' : '&lt;div class=&quot;formulario_columna_cnt&quot;&gt;' + '&lt;span class=&quot;izq_float file_icon&quot;&gt;&amp;nbsp;&lt;/span&gt;' + '&lt;div class=&quot;izq_float name&quot;&gt;&lt;a&gt;&lt;/a&gt;&lt;/div&gt;' + '&lt;/div&gt;' + '&lt;div class=&quot;formulario_columna_cnt&quot;&gt;' + '&lt;div class=&quot;izq_float type&quot;&gt;&lt;/div&gt;' + '&lt;div class=&quot;izq_float size&quot;&gt;&lt;/div&gt;' + '&lt;/div&gt;'+ '&lt;div class=&quot;formulario_columna_cnt&quot;&gt;' + '&lt;a&gt;&lt;div class=&quot;izq_float&quot;&gt;'+ '&lt;div class=&quot;file_download&quot; &gt;'+ '&lt;span class=&quot;file_download_icon&quot;&gt;&amp;nbsp;&lt;/span&gt;'+ '&lt;span class=&quot;file_download_text&quot;&gt;'+$.rup.i18nParse($.rup.i18n.base,&quot;rup_upload.openUploaded&quot;)+'&lt;/span&gt;&lt;/div&gt;'+ '&lt;/div&gt;&lt;/a&gt;' + '&lt;div class=&quot;izq_float delete&quot;&gt;&lt;button&gt;'+$.rup.i18nParse($.rup.i18n.base,&quot;rup_upload.deleteUploaded&quot;)+'&lt;/button&gt;&lt;/div&gt;' + '&lt;/div&gt;' ) + '&lt;/td&gt;&lt;/tr&gt;'); row.find('.size').text(file.sizef); row.find('.type').text(file.type); if (file.error) { row.find('.name').text(file.name); row.addClass('ui-state-error'); row.find('.error').text( that.options.errorMessages[file.error] || file.error ); } else { row.find('.name a').text(file.name); if (file.thumbnail_url) { row.find('.preview').append('&lt;a&gt;&lt;img&gt;&lt;/a&gt;') .find('img').prop('src', file.thumbnail_url); row.find('a').prop('target', '_blank'); } row.find('a').prop('href', $.rup_utils.setNoPortalParam(file.url)); row.find('.delete button') .attr('data-type', file.delete_type) .attr('data-url', $.rup_utils.setNoPortalParam(file.delete_url)); } rows = rows.add(row); }); return rows; }, _initFileUploadButtonBar: function () { var fileUploadButtonBar = this.element.find('.fileupload-buttonbar'), filesList = this.element.find('.files'), ns = this.options.namespace; fileUploadButtonBar.find('.start') .button({icons: {primary: 'ui-icon-circle-arrow-e'}}) .bind('click.' + ns, function (e) { e.preventDefault(); filesList.find('.start button').click(); }); fileUploadButtonBar.find('.cancel') .button({icons: {primary: 'ui-icon-cancel'}}) .bind('click.' + ns, function (e) { e.preventDefault(); filesList.find('.cancel button').click(); }); fileUploadButtonBar.find('.delete') .button({icons: {primary: 'ui-icon-trash'}}) .bind('click.' + ns, function (e) { e.preventDefault(); // filesList.find('.delete input:checked') // .siblings('button').click(); filesList.find('.delete button').click(); }); fileUploadButtonBar.find('.toggle') .bind('change.' + ns, function (e) { filesList.find('.delete input').prop( 'checked', $(this).is(':checked') ); }); }, _getAJAXSettings: function (data) { var options = $.extend({}, this.options, data); this._initFormSettings(options); this._initDataSettings(options); return options; } // ,_initProgressListener: function (options) { // var that = this, // xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr(); // // Accesss to the native XHR object is required to add event listeners // // for the upload progress event: // if (options.pif ===null &amp;&amp; xhr.upload) { // //-- fix start -- // $( xhr.upload ).bind( &quot;progress&quot;, function (e) { // that._onProgress(e, options); // }); // options.xhr = function () { // return xhr; // }; // //-- fix end -- // } // } // destroy: function (e, data) { // var that = $(this).data('fileupload'); // if (data.url) { // $.rup_ajax(data) // .success(function () { // that._adjustMaxNumberOfFiles(1); // $(this).fadeOut(function () { // $(this).remove(); // }); // }); // } else { // that._adjustMaxNumberOfFiles(1); // data.context.fadeOut(function () { // $(this).remove(); // }); // } // } }); //********************************************* // ESPECIFICACÍON DE LOS TIPOS BASE DEL PATRÓN //********************************************* //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Permite al usuario seleccionar uno o varios archivos de su equipo y subirlos a la aplicación. * * @summary Componente RUP Upload. * @namespace jQuery.rup_upload * @memberOf jQuery * @tutorial rup_upload * @see El componente está basado en el plugin {@link https://blueimp.github.io/jQuery-File-Upload/|jQuery File Upload}. Para mas información acerca de las funcionalidades y opciones de configuración pinche {@link https://blueimp.github.io/jQuery-File-Upload/|aquí}. * @example * $(&quot;#idUpload&quot;).rup_upload({}); */ var rup_upload = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_upload&quot;, rup_upload)); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** $.fn.rup_upload(&quot;extend&quot;,{ option: function(args){ $(this).fileupload(&quot;option&quot;,args); }, destroy: function(){ $(this).fileupload(&quot;destroy&quot;); }, enable: function(){ $(this).fileupload(&quot;enable&quot;); }, disable: function(){ $(this).fileupload(&quot;disable&quot;); }, add: function(data){ $(this).fileupload(&quot;add&quot;,data); }, send: function(data){ $(this).fileupload(&quot;send&quot;,data); } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** function fileuploadstart () { var widget = $(this), progressElement = $('#fileupload-progressbar').fadeIn(), interval = 500, total = 0, loaded = 0, loadedBefore = 0, progressTimer, progressHandler = function (e, data) { loaded = data.loaded; total = data.total; }, stopHandler = function () { widget .unbind('fileuploadprogressall', progressHandler) .unbind('fileuploadstop', stopHandler); window.clearInterval(progressTimer); progressElement.fadeOut(function () { progressElement.html(''); }); }, formatTime = function (seconds) { var date = new Date(seconds * 1000); return ('0' + date.getUTCHours()).slice(-2) + ':' + ('0' + date.getUTCMinutes()).slice(-2) + ':' + ('0' + date.getUTCSeconds()).slice(-2); }, formatBytes = function (bytes) { if (bytes &gt;= 1000000000) { return (bytes / 1000000000).toFixed(2) + ' GB'; } if (bytes &gt;= 1000000) { return (bytes / 1000000).toFixed(2) + ' MB'; } if (bytes &gt;= 1000) { return (bytes / 1000).toFixed(2) + ' KB'; } return bytes + ' B'; }, formatPercentage = function (floatValue) { return (floatValue * 100).toFixed(2) + ' %'; }, updateProgressElement = function (loaded, total, bps) { progressElement.html( formatBytes(bps) + 'ps | ' + formatTime((total - loaded) / bps) + ' | ' + formatPercentage(loaded / total) + ' | ' + formatBytes(loaded) + ' / ' + formatBytes(total) ); }, intervalHandler = function () { var diff = loaded - loadedBefore; if (!diff) { return; } loadedBefore = loaded; updateProgressElement( loaded, total, diff * (1000 / interval) ); }; widget .bind('fileuploadprogressall', progressHandler) .bind('fileuploadstop', stopHandler); progressTimer = window.setInterval(intervalHandler, interval); } $.fn.rup_upload(&quot;extend&quot;,{ _init : function(args){ var settings = $.extend({}, $.fn.rup_upload.defaults, args[0]), upload=this; // Se configura el uso del PIF if (settings.pif!==null){ var url=&quot;&quot;, // n38UidSesionCookie = $.rup_utils.readCookie(&quot;n38UidSesion&quot;), // n38DominioUidCookie = $.rup_utils.readCookie(&quot;n38DominioUid&quot;), // n38UidSesionGlobal = $.rup_utils.readCookie(&quot;n38UidSesionGlobal&quot;), // n38UidSistemasXLNetS = $.rup_utils.readCookie(&quot;n38UidSistemasXLNetS&quot;), pifSettings = jQuery.extend(true, $.fn.rup_upload.pif.defaults, settings.pif ); // if (pifSettings.base_url===undefined){ // alert(&quot;RUP_UPLOAD - No se ha especificado el valor del parámetro base_url para el uso del PIF.&quot;); // return -1; // } if (pifSettings.userFolder!==true &amp;&amp; pifSettings.folderPath===undefined){ alert(&quot;RUP_UPLOAD - No se ha especificado el valor del parámetro folderPath para el uso del PIF.&quot;); return -1; } jQuery.extend(true, settings,{ formData:{ base_url: settings.url, hadoop_folder_path: pifSettings.folderPath, hadoop_preserve_name: pifSettings.preserveName, y31_ttl: pifSettings.fileTtl, securityToken: pifSettings.securityToken } }); // url += pifSettings.base_url; // Url base del PIF // url += pifSettings._JANO_PUT_SERVLET; // Servlet PUT // url += &quot;/&quot;+n38UidSesionCookie; // Cookie XLNets n38UidSesionCookie // url += &quot;/&quot;+n38DominioUidCookie; // Cookie XLNets n38DominioUidCookie // url += &quot;/&quot;+n38UidSesionGlobal; // Cookie XLNets n38UidSesionGlobal // url += &quot;/&quot;+n38UidSistemasXLNetS; // Cookie XLNets n38UidSistemasXLNetS // Se añaden los parámetros de configuración del PIF a la url // url +=&quot;?hadoop_folder_path=&quot;+pifSettings.folderPath; // Parámetro folderPath // url +=&quot;&amp;hadoop_preserve_name=&quot;+pifSettings.preserveName; // Parámetro preserveName // url +=&quot;&amp;y31_ttl=&quot;+pifSettings.fileTtl; // Parámetro fileTtl // Configruamos la url final // settings.url = url; // settings.xhr = function(){ // // }; } $.data(this[0], &quot;settings&quot;, settings); $(this).fileupload(settings); if (settings.submitInForm){ $(this).rup_upload(&quot;option&quot;,{singleFileUploads:false,maxNumberOfFiles:1,replaceFileInput:false}); } $(this).bind('fileuploadadd', function (e, data) { if(settings.submitInForm){ $(this).find(&quot;.template-upload&quot;).hide(); $(this).find(&quot;.template-upload .cancel button&quot;).unbind(&quot;click&quot;); $(this).find(&quot;.template-upload .cancel button&quot;).click(); } }); $(this).bind('fileuploadsend', function (e, data) { data.url=$.rup_utils.setNoPortalParam(data.url); // if (!$.rup.browser.xhrFileUploadSupport || settings.forceIframeTransport===true){ // data.url = data.url + (data.url.match(&quot;\\\\?&quot;) === null ? &quot;?&quot; : &quot;&amp;&quot;) + &quot;_emulate_iframe_http_status=true&quot;; // } }); }, _private : function(settings){ } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* $.fn.rup_upload.defaults = { label:null, fileInput:null, submitInForm:false, submitFormButton:undefined, pif:null }; $.fn.rup_upload.pif={}; $.fn.rup_upload.pif.defaults ={ fileTtl: 129600, preserveName: false, _JANO_PUT_SERVLET: &quot;/y31ApiJSWAR/Y31JanoServicePutServlet&quot;, securityToken:&quot;app&quot; }; /** * @description Propiedades de configuración del componente. * @see Para mas información consulte la documentación acerca de las opciones de configuración del plugin {@link https://github.com/blueimp/jQuery-File-Upload/wiki/Options|jQuery File Upload}. * * @name jQuery.rup_upload#options * @property {string} [namespace] - Se utiliza para asociar el capturador de eventos del dropZone y del fileInpurt. Por defecto toma el valor del widget (“fileupload”). * @property {jQuery} [dropZone=$(document)] - Indica el objeto jQuery que representa el área de dropZone. Para deshabilitar el soporte drag &amp; drop se deberá indicar el valor null. * @property {jQuery} [fileInput] - Objeto jQuery sobre el cual se monitorizarán los eventos de cambio del mismo. En caso de no especificarse se tomarán los input de tipo file existentes dentro del objeto sobre el que se ha creado el componente upload. Para deshabilitar el capturador de eventos se deberá indicar el valor null. * @property {boolean} [replaceFileInput=true] - Determinar si el campo file es reemplazado por un nuevo objeto a partir de un clone. * @property {string} [paramName] - Indica el nombre del parámetro de la request mediante el cual se enviará la información del fichero. En caso de no especificarse, se tomará el valor de la propiedad name del campo file. En caso de no especificarse dicha propiedad se tomará el valor files[] por defecto. * @property {boolean} [singleFileUploads=true] - Especifica si la subida de ficheros se realizar de manera individual, es decir, si se realiza una petición XHR por cada uno de los ficheros que se deben de enviar. * @property {boolean} [limitMultiFileUploads=true] -Especifica el número de ficheros que pueden ser enviados en una única petición XHR. * @property {boolean} [sequentialUploads=false] - Especifica si el envío de los ficheros se realizan de manera secuencial en vez de manera simultánea. * @property {Integer} [limitConcurrentUploads] - Indica el número máximo de peticiones concurrentes para la subida de ficheros. * @property {boolean} [forceIframeTransport=false] - Determina si se debe forzar el uso de iframe al realizar la subida de ficheros. Esta opción puede ser útil en caso de subida de ficheros entre diferentes dominios. * @property {boolean} [multipart=true] - Indica si la subida de ficheros se realiza como multipart/form-data. * @property {boolean} [recalculateProgress=true] - Por defecto, los envíos de ficheros erróneos o cancelados son excluidos del cálculo del progreso global de subida de ficheros. Para evitar el recálculo del progreso global se deberá de especificar esta opción como false. * @property {object | object[] | function} [formData] - Información adicional que se desea enviar al realizarse la subida de ficheros. El parámetro acepta lo siguiente: &lt;ul&gt;&lt;li&gt;Array de objetos con propiedades&lt;/li&gt;&lt;li&gt;Objeto simple&lt;/li&gt;&lt;li&gt;Función que retorna uno de los tipos de datos especificados anteriormente.&lt;/li&gt;&lt;/ul&gt; */ /***********/ /* EVENTOS */ /***********/ /** * Permite asociar una función que se ejecutará cuando se añada un fichero mediante el componente. * * @event jQuery.rup_upload#fileuploadadd * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadadd&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará cuando se añada un fichero mediante el componente. * * @event jQuery.rup_upload#fileuploadsubmit * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @return {boolean} - Si la función retorna false el envío no se realiza. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadsubmit&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al iniciarse el envío de cada fichero. * * @event jQuery.rup_upload#fileuploadsend * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @return {boolean} - Si la función retorna false el envío no se realiza. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadsend&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al realizarse de manera satisfactoria el envío de los ficheros. * * @event jQuery.rup_upload#fileuploaddone * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploaddone&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al producirse un error en el envío de los ficheros o al abortarse el envío. * * @event jQuery.rup_upload#fileuploadfail * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadfail&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al producirse un envío correcto, erróneo o se aborte. * * @event jQuery.rup_upload#fileuploadalways * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadalways&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al producirse un evento relacionado con el indicador de progreso del envío de ficheros. * * @event jQuery.rup_upload#fileuploadprogress * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadprogress&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al producirse un evento relacionado el indicador de progreso global de envío de ficheros. * * @event jQuery.rup_upload#fileuploadprogressall * @property {Event} e - Objeto Event correspondiente al evento disparado. * @property {object} data - Objeto que contiene la información relativa a la subida de los ficheros. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadprogressall&quot;, function (e, data) { * }); */ /** * Permite asociar una función que se ejecutará al inicio del envío de los ficheros. * * @event jQuery.rup_upload#fileuploadstart * @property {Event} e - Objeto Event correspondiente al evento disparado. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadstart&quot;, function (e) { * }); */ /** * Permite asociar una función que se ejecutará al detenerse el proceso de envío de ficheros. * * @event jQuery.rup_upload#fileuploadstop * @property {Event} e - Objeto Event correspondiente al evento disparado. * @example * $(&quot;#fileupload&quot;).on(&quot;fileuploadstop&quot;, function (e) { * }); */ })(jQuery); × Search results Close "},"rup.utils.js.html":{"id":"rup.utils.js.html","title":"Source: rup.utils.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.utils.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Clase de utilidades para los patrones RUP. * @author EJIE * @version: 2.4.8 */ (function ($) { $.rup_utils = {}; $.rup_utils.arr = []; $.rup_utils.autoGenerateIdNum = 0; /** * Módulo de utilidades comunes a todos los componentes RUP. &lt;br/&gt;&lt;br/&gt; * Implementa métodos para la manipulación de JSON, formularios, formatos... * * @summary Librería de utilidades para los componentes RUP. * @namespace jQuery.rup_utils * @memberOf jQuery */ $.extend($.rup_utils, { /** * Retorna el idioma actual capitalizado. * * El idioma actual se obtiene de la variable $.rup.lang * * @name jQuery.rup_utils#capitalizedLang * @function * @example * // Retorna &quot;Es&quot; para un valor &quot;es&quot; en $.rup.lang. * $.rup_utils.capitalizedLang(); * @returns {string} - Idioma actual capitalizado */ capitalizedLang: function () { if ($.rup.lang == null) { return &quot;&quot;; } return $.rup.lang.charAt(0).toUpperCase() + $.rup.lang.slice(1); }, getJson: function (obj, path) { var ret = $.extend({}, obj), split = path.split(&quot;.&quot;); if (split.length === 1) { return obj[split[0]]; } for (var i = 0; i &lt; split.length; i++) { ret = ret[split[i]]; } return ret }, setJson: function (obj, path, value) { var aux = obj, split = path.split(&quot;.&quot;); if (split.length === 1) { obj[split[0]] = value; } else { for (var i = 0; i &lt; split.length - 1; i++) { aux = aux[split[i]]; } aux[split[split.length - 1]] = value; } }, /** * Transforma un objeto JSON en un array Javascript. * * @name jQuery.rup_utils#jsontoarray * @function * @param {Object} obj - Objeto JSON que se desea transformar en un array. * @returns {Object} - Array JavaScript. * @example * // Transforma un json obj={'prop':'value'} en un array arr['prop'] -&gt; 'value' * var obj={'prop':'value'}; * $.rup_utils.jsontoarray(obj); * @example * // Transforma un json obj={'propA':{'propAA':'value'}} en un array arr['propA.propAA'] -&gt; 'value' * var obj={'propA':{'propAA':'value'}}; * $.rup_utils.jsontoarray(obj); * @example * // Transforma un json obj={'propA':{'propAA':['a','b','c','d']}} en un array arr['propA.propAA[0]'] * var obj={'propA':{'propAA':['a','b','c','d']}}; * $.rup_utils.jsontoarray(obj); */ jsontoarray: function (obj) { var arr = []; function parseJSON(obj, path) { // parsea un json a un array path = path || ''; // iteracion a traves (objects / arrays) if (obj === undefined || obj === null) { // Si no existe un valor para el path indicado se envia '' parseJSON('', path); } else if (obj.constructor == Object) { for (var prop in obj) { //var name = path + (path == '' ? prop : '[' + prop + ']'); var name = path + (path == '' ? prop : '.' + prop); parseJSON(obj[prop], name); } } else if (obj.constructor == Array) { if (obj.length == 0) { parseJSON('[]', path); } else { for (var i = 0; i &lt; obj.length; i++) { var index = '[' + i + ']', name = path + index; parseJSON(obj[i], name); } } } else { // assignment (values) if the element name hasn't yet been defined, create it as a single value if (arr[path] == undefined) { arr[path] = obj; } else if (arr[path].constructor != Array) { // if the element name HAS been defined, but it's a single value, convert to an array and add the new value arr[path] = [arr[path], obj]; } else { // if the element name HAS been defined, and is already an array, push the single value on the end of the stack arr[path].push(obj); } } } parseJSON(obj); return arr; }, /** * Realiza una desanidacion del json pasado (p.e.: {entidad:{propiedad:valor}} --&gt; {'entidad.propiedad':valor}. * * @name jQuery.rup_utils#unnestjson * @function * @param {Object} obj - Objeto JSON que se desea desanidar. * @returns {Object} - Objeto JSON desanidado. * @example * // Transforma un json obj={'propA':{'propAA':'valueAA'}} en un json obj={'propA.propAA':'valueAA'}} * var obj={'propA':{'propAA':'valueAA'}}; * $.rup_utils.unnestjson(obj); */ unnestjson: function (obj) { var array = $.rup_utils.jsontoarray(obj); var json = {}; for (key in array) { if (!$.isFunction(array[key])) { json[key] = array[key]; } } return json; }, /** * Devuelve el objeto del dom existente en la posición indicada. * * @name jQuery.rup_utils#elementFromPoint * @function * @param {number} x - Coordenada x de la posición en la pantalla. * @param {number} y - Coordenada y de la posición en la pantalla. * @param {boolean} [argCheck=true] - Determina si debe de ajustarse en base al scroll realizado en la pantalla . * @returns {Object} - Objeto del DOM correspodiente a la posición indicada. * @example * $.rup_utils.elementFromPoint(120,140); */ elementFromPoint: function (x, y, argCheck) { var isRelative = true, check = argCheck || true; if (!document.elementFromPoint) return null; if (!check) { var sl; if ((sl = $(document).scrollTop()) &gt; 0) { isRelative = (document.elementFromPoint(0, sl + $(window).height() - 1) == null); } else if ((sl = $(document).scrollLeft()) &gt; 0) { isRelative = (document.elementFromPoint(sl + $(window).width() - 1, 0) == null); } check = (sl &gt; 0); } if (!isRelative) { x += $(document).scrollLeft(); y += $(document).scrollTop(); } return document.elementFromPoint(x, y); }, /** * Convierte en mínusculas el primer caracter de la cadena de caracteres pasada como parámetro. * * @name jQuery.rup_utils#firstCharToLowerCase * @function * @param {string} cadena - Cadena de caracteres inicial. * @returns {string} - Cadena de caracteres resultante con su primer caracter convertido a minúsculas. * @example * // Convierte a minúsculas el primer caracter de la cadena &quot;AbCdEfg&quot; -&gt; &quot;abCdEfg&quot; * $.rup_utils.firstCharToLowerCase(&quot;AbCdEfg&quot;); */ firstCharToLowerCase: function (cadena) { return cadena.substring(0, 1).toLowerCase() + cadena.substring(1); }, /** * Devuelve un string que puede ser utilizado como selector de jQuery mediante el id ('#'). El método permite también escapar los caracteres reservados en los selectores de jQuery * * @name jQuery.rup_utils#firstCharToLowerCase * @function * @param {string} cadena - Cadena de caracteres inicial. * @returns {string} - Cadena de caracteres resultante con su primer caracter convertido a minúsculas. * @example * // Convierte a minúsculas el primer caracter de la cadena &quot;AbCdEfg&quot; -&gt; &quot;abCdEfg&quot; * $.rup_utils.firstCharToLowerCase(&quot;AbCdEfg&quot;); */ getJQueryId: function (sid, escaped) { var returnIdSelector; if (typeof sid === &quot;string&quot;) { returnIdSelector = sid; if (escaped === true) { returnIdSelector = String(returnIdSelector).replace(/[!&quot;#$%&amp;'()*+,.\\/:; &lt;=&gt;?@\\[\\\\\\]\\^`{|}~]/g, &quot;\\\\$&amp;&quot;); } return returnIdSelector[0] === &quot;#&quot; ? returnIdSelector : &quot;#&quot; + returnIdSelector; } return null; }, /** * Convierte una cadena querystring en un objeto json. * * @name jQuery.rup_utils#queryStringToJson * @function * @param {string} queryString - Query string a transformar en un objeto json. * @returns {object} - Objeto JSON creado a partir de la query string indicada. * @example * // Obtene un json a partir del query string &quot;keyA=valueA&amp;keyB=valueB&amp;keyC=valueC&quot; -&gt; &quot;{keyA:'valueA', keyB:'valueB', keyC:'valueC'}&quot; * $.rup_utils.queryStringToJson(&quot;keyA=valueA&amp;keyB=valueB&amp;keyC=valueC&quot;); */ queryStringToJson: function (queryString) { function setValue(root, path, value) { if (path.length &gt; 1) { var dir = path.shift(); if (typeof root[dir] == 'undefined') { root[dir] = path[0] == '' ? [] : {}; } arguments.callee(root[dir], path, value); } else { if (root instanceof Array) { root.push(value); } else { root[path] = value; } } }; var nvp = queryString.split('&amp;'), data = {}, pair, name, value, path, first; for (var i = 0; i &lt; nvp.length; i++) { pair = nvp[i].split('='); name = decodeURIComponent(pair[0]); value = decodeURIComponent(pair[1]); path = name.match(/(^[^\\[]+)(\\[.*\\]$)?/); first = path[1]; if (path[2]) { // case of 'array[level1]' || // 'array[level1][level2]' path = path[2].match(/(?=\\[(.*)\\]$)/)[1] .split(']['); } else { // case of 'name' path = []; } path.unshift(first); setValue(data, path, value); } return data; }, populateForm: function (aData, formid) { //rellena un formulario que recibe como segundo parametro con los datos que recibe en el segundo parametro var ruptype, formElem; var tree_data, selectorArray; if (aData) { for (var i in aData) { tree_data = new Array(); formElem = $(&quot;[name='&quot; + i + &quot;']&quot;, formid); if (formElem.length == 0) { selectorArray = i.substr(0, i.indexOf('[')); formElem = $(&quot;[name='&quot; + selectorArray + &quot;']&quot;, formid); } if (formElem.is(&quot;[ruptype]&quot;)) { if (formElem.hasClass(&quot;jstree&quot;)) { for (var a in aData) { if (a.substr(0, a.indexOf('[')) == selectorArray) { tree_data.push(aData[a]); } } formElem[&quot;rup_&quot; + formElem.attr(&quot;ruptype&quot;)](&quot;setRupValue&quot;, tree_data); var $arbol = []; $arbol[selectorArray] = tree_data; formElem.on(&quot;loaded.jstree&quot;, function (event, data) { var selectorArbol = this.id; //$(this).rup_tree(&quot;setRupValue&quot;,$arbol[selectorArbol]); $(this).trigger(&quot;rup_filter_treeLoaded&quot;, $arbol[selectorArbol]); }); } else { // Forma de evitar el EVAL formElem[&quot;rup_&quot; + formElem.attr(&quot;ruptype&quot;)](&quot;setRupValue&quot;, aData[i]); } } else if (formElem.is(&quot;input:radio&quot;) || formElem.is(&quot;input:checkbox&quot;)) { formElem.each(function () { if ($(this).val() == aData[i]) { $(this).attr(&quot;checked&quot;, &quot;checked&quot;); } else { $(this).removeAttr(&quot;checked&quot;); } }); } else if (formElem.is(&quot;select&quot;)) { formElem.val(aData[i]).click(); } else if (formElem.is(&quot;:not(img)&quot;)) { // this is very slow on big table and form. formElem.val(aData[i]); } } } }, //DATE UTILS createDate: function (day, month, year) { return $.datepicker.formatDate($.rup.i18n.base[&quot;rup_date&quot;].dateFormat, new Date(year, month - 1, day)); }, createTime: function (hour, minute, second) { return new Date(null, null, null, hour, minute, second); }, /*! * jQuery CooQuery Plugin v2 * http://cooquery.lenonmarcel.com.br/ * * Copyright 2009, 2010 Lenon Marcel * Dual licensed under the MIT and GPL licenses. * http://www.opensource.org/licenses/mit-license.php * http://www.gnu.org/licenses/gpl.html * * Date: 2010-01-24 (Sun, 24 January 2010) */ //TODO: Documentacion -&gt; http://plugins.jquery.com/project/cooquery setCookie: function (name, value, options) { if (typeof name === 'undefined' || typeof value === 'undefined' || name === null || value === null) { $.rup.errorGestor(&quot;[&quot; + $.rup.i18nParse($.rup.i18n.base, &quot;rup_global.metodError&quot;) + &quot;setCookie] - &quot; + $.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.paramsError&quot;)); return false; } var str = name + '=' + encodeURIComponent(value); if (typeof options !== 'undefined' &amp;&amp; options !== null) { if (options.domain) str += '; domain=' + options.domain; if (options.path) str += '; path=' + options.path; if (options.duration) { var date = new Date(); date.setTime(date.getTime() + options.duration * 24 * 60 * 60 * 1000); str += '; expires=' + date.toGMTString(); } if (options.secure) str += '; secure'; } return (document.cookie = str); }, delCookie: function (name) { if (typeof name === 'undefined' || name === null) { $.rup.errorGestor(&quot;[&quot; + $.rup.i18nParse($.rup.i18n.base, &quot;rup_global.metodError&quot;) + &quot;delCookie] - &quot; + $.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.paramsError&quot;)); return false; } return $.rup_utils.setCookie(name, '', { duration: -1 }); }, readCookie: function (name) { if (typeof name === 'undefined' || name === null) { $.rup.errorGestor(&quot;[&quot; + $.rup.i18nParse($.rup.i18n.base, &quot;rup_global.metodError&quot;) + &quot;readCookie] - &quot; + $.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.paramsError&quot;)); return false; } var value = document.cookie.match('(?:^|;)\\\\s*' + name.replace(/([-.*+?^${}()|[\\]\\/\\\\])/g, '\\\\$1') + '=([^;]*)'); return (value) ? decodeURIComponent(value[1]) : null; }, get: function (name, json) { var cookieValue = null; if (document.cookie &amp;&amp; document.cookie != '') { var cookies = document.cookie.split(';'); for (var i = 0; i &lt; cookies.length; i++) { var cookie = $.trim(cookies[i]); if (cookie.substring(0, name.length + 1) == (name + '=')) { cookieValue = json ? $.JSON.decode(decodeURIComponent(cookie.substring(name.length + 1))) : decodeURIComponent(cookie.substring(name.length + 1)); break; } } } return cookieValue; }, set: function (name, value, options) { options = $.extend({}, options); if (value === null) { value = ''; options.expires = -1; } var expires = ''; if (options.expires &amp;&amp; (typeof options.expires == 'number' || options.expires.toUTCString)) { var date; if (typeof options.expires == 'number') { date = new Date(); date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000)); } else { date = options.expires; } expires = '; expires=' + date.toUTCString(); } value = options.json ? encodeURIComponent($.JSON.encode(value)) : encodeURIComponent(value); var path = options.path ? '; path=' + (options.path) : ''; var domain = options.domain ? '; domain=' + (options.domain) : ''; var secure = options.secure ? '; secure' : ''; document.cookie = [name, '=', value, expires, path, domain, secure].join(''); }, //compare objects function compareObjects: function (x, y) { var objectsAreSame = true; if (Object.keys(x).length !== Object.keys(y).length) { return false; } for (var propertyName in x) { if (typeof x[propertyName] == 'object' &amp;&amp; typeof y[propertyName] == 'object') { objectsAreSame = compareObjects(x[propertyName], y[propertyName]); if (!objectsAreSame) break; } else { if (x[propertyName] !== y[propertyName]) { objectsAreSame = false; break; } } } return objectsAreSame; }, escapeId: function (id) { if (id) { return id.replace(/([ #;&amp;,.+*~\\':&quot;!^$[\\]()=&gt;|\\/@])/g, &quot;\\\\$1&quot;); } return &quot;&quot;; }, selectorId: function (id) { if ((typeof id === &quot;string&quot;) &amp;&amp; (id.substring(0, 1) !== &quot;#&quot;)) { return (&quot;#&quot; + id); } else { return (id); } }, //Genera un identificador aleatorio para un objeto determinado randomIdGenerator: function (selectObject) { var id = &quot;rupRandomLayerId-&quot; + $.rup_utils.autoGenerateIdNum; selectObject.attr(&quot;id&quot;, id).addClass(&quot;rupRandomLayerId&quot;); $.rup_utils.autoGenerateIdNum = $.rup_utils.autoGenerateIdNum + 1; return id; }, //Función encargada de gestionar las url's de las aplicaciones en portal setNoPortalParam: function (url) { if (url !== undefined &amp;&amp; url !== null) { if ($.rup_utils.readCookie(&quot;r01PortalInfo&quot;) !== null &amp;&amp; url.match(&quot;R01HNoPortal&quot;) === null &amp;&amp; (($(&quot;div.r01gContainer&quot;).length &gt; 0)) || ($(&quot;div.r01gApplication&quot;).length &gt; 0)) { return url + (url.match(&quot;\\\\?&quot;) === null ? &quot;?&quot; : &quot;&amp;&quot;) + &quot;R01HNoPortal=true&quot;; } } return url; }, //Función encargada de detectar si la aplicación esta integrada en portal aplicatioInPortal: function () { if (!($.rup_utils.readCookie(&quot;r01PortalInfo&quot;) !== null &amp;&amp; $(&quot;div.r01gContainer&quot;).length &gt; 0)) { return false; } else { return true; } }, //Funcion encargada de pasar las urls relativas a absolutas. //Esta diseñado para terminar con los problemas de comportamientos anómalo de los navegadores en la redirecciones relativas relToAbsUrl: function (url) { var urlPage = $(location); if (typeof url === &quot;string&quot;) { var fChar1 = url.substring(0, 1); var fChar2 = url.substring(1, 2); if ($.url(url).attr('protocol') === undefined || $.url(url).attr('protocol') === &quot;&quot;) { if (fChar1 === &quot;/&quot;) { if (fChar2 === undefined || fChar2 !== &quot;/&quot;) { return (urlPage.attr('protocol') + &quot;//&quot; + urlPage.attr('host') + url); } else { return (urlPage.attr('protocol') + url); } } else if (fChar1 === &quot;.&quot;) { if (fChar2 === undefined) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.relToAbsUrlParamError&quot;) + url + $.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.relToAbsUrlParamErrorEnd&quot;)); return (undefined); } else if (fChar2 === &quot;/&quot;) { var analyzedUrl = $.url(urlPage.attr('href'), true); return (analyzedUrl.attr('base') + analyzedUrl.attr('directory') + url.substring(2, url.length)); } else if (fChar2 === &quot;.&quot;) { var urlPageFragments = urlPage.attr('pathname').split(&quot;/&quot;); var urlPageLength = (urlPageFragments.length) - 2; if ((url.substring(2, 3) !== undefined) &amp;&amp; (url.substring(2, 3) === &quot;/&quot;)) { var urlFragments = url.split(&quot;../&quot;); var urlLength = (urlFragments.length) - 1; if (urlLength &gt;= urlPageLength) { return (urlPage.attr('protocol') + &quot;//&quot; + urlPage.attr('host') + &quot;/&quot; + urlFragments[urlFragments.length - 1]); } else { var cade = &quot;&quot;; for (var i = urlPageLength - urlLength; i &gt; 0; i--) { cade = urlPageFragments[i] + &quot;/&quot; + cade; } return (urlPage.attr('protocol') + &quot;//&quot; + urlPage.attr('host') + &quot;/&quot; + cade + urlFragments[urlFragments.length - 1]); } } else { var urlFragments = url.split(&quot;..&quot;); var urlLength = (urlFragments.length) - 1; if (urlLength &gt;= urlPageLength) { return (urlPage.attr('protocol') + &quot;//&quot; + urlPage.attr('host') + urlFragments[urlFragments.length - 1]); } else { var cade = &quot;&quot;; for (var i = urlPageLength - urlLength; i &gt; 0; i--) { cade = urlPageFragments[i] + &quot;/&quot; + cade; } return (urlPage.attr('protocol') + &quot;//&quot; + urlPage.attr('host') + &quot;/&quot; + cade + urlFragments[urlFragments.length - 1]); } } } else { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.relToAbsUrlParamError&quot;) + url + $.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.relToAbsUrlParamErrorEnd&quot;)); return (undefined); } } else { var analyzedUrl = $.url(urlPage.attr('href'), true); return (analyzedUrl.attr('base') + analyzedUrl.attr('directory') + url); } } else { return (url); } } else { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base, &quot;rup_utils.relToAbsUrlParamFormatError&quot;)); return (undefined); } }, printMsg: function (msg) { var ret = &quot;&quot;; if (typeof msg === &quot;string&quot;) { return msg + &quot;&lt;br/&gt;&quot;; } else if (typeof msg === &quot;object&quot;) { if (jQuery.isArray(msg)) { for (var i = 0; i &lt; msg.length; i++) { ret += $.rup_utils.printMsgAux(msg[i], 1); } return ret; } else { ret += $.rup_utils.printMsgAux(msg, 1); } } return ret; }, printMsgAux: function (msg, nivel) { var ret = &quot;&quot;; if (typeof msg === &quot;string&quot;) { return $(&quot;&lt;span&gt;&quot;).append(msg)[0].outerHTML + &quot;&lt;br/&gt;&quot;; } else if (typeof msg === &quot;object&quot;) { if (jQuery.isArray(msg)) { var ul = $(&quot;&lt;ul&gt;&quot;).addClass(&quot;rup-maint_feedbackUL&quot;); for (var i = 0; i &lt; msg.length; i++) { // if (typeof msg[i]===&quot;string&quot; || (typeof msg[i]===&quot;object&quot; &amp;&amp; !jQuery.isArray(msg))){ if (nivel === 1) { ul.append($(&quot;&lt;li&gt;&quot;).append($.rup_utils.printMsgAux(msg[i], nivel + 1))); } else { ul.append($.rup_utils.printMsgAux(msg[i], nivel + 1)); } } return ret += ul[0].outerHTML; } else { var span = $(&quot;&lt;span&gt;&quot;); if (msg.style !== undefined) { span.addClass(msg.style); } if (msg.label !== undefined) { span.append(msg.label); } return span[0].outerHTML + &quot;&lt;br/&gt;&quot;; } } }, //Función encargada de recuperar todas las variables pasadas por QueryString (en la url) getUrlVars: function () { if ($.rup.getParams === undefined) { var vars = {}, hash; var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&amp;'); for (var i = 0; i &lt; hashes.length; i++) { hash = decodeURIComponent(hashes[i]).split('='); vars[hash[0]] = hash[1]; } $.rup.getParams = vars; } return $.rup.getParams; }, //Función encargada de recuperar una variable especifica de las pasadas por QueryString (en la url) getUrlVar: function (name) { return $.rup_utils.getUrlVars()[name]; }, sortArray: function (array, sortFnc) { function defaultSortFnc(obj1, obj2) { return obj1 - obj2; } function bubbleSort(a, fnc) { var swapped; do { swapped = false; for (var i = 0; i &lt; a.length - 1; i++) { if (fnc(a[i], a[i + 1]) &lt; 0) { var temp = a[i]; a[i] = a[i + 1]; a[i + 1] = temp; swapped = true; } } } while (swapped); } if (!$.isArray(array)) { return undefined; } if ($.isFunction(sortFnc)) { bubbleSort(array, sortFnc); } else { bubbleSort(array, defaultSortFnc); } }, insertSorted: function (array, elem, sortFnc) { function defaultSortFnc(obj1, obj2) { return obj2 - obj1; } if (!$.isArray(array)) { return undefined; } array.push(elem); if ($.isFunction(sortFnc)) { $.rup_utils.sortArray(array, sortFnc); } else { $.rup_utils.sortArray(array, defaultSortFnc); } return $.inArray(elem, array); }, getRupValueAsJson: function (name, value) { var arrTmp, returnArray, dotNotation = false, dotProperty, tmpJson, returnArray = []; if (name) { // Miramos si el name contiene notación dot arrTmp = name.split(&quot;.&quot;); if (arrTmp.length &gt; 1) { dotNotation = true; dotProperty = arrTmp[arrTmp.length - 1]; } else { dotProperty = arrTmp[0]; } if (jQuery.isArray(value)) { //issue [utils] getRupValueAsJson provoca error con los arrays vacíos #24 //https://github.com/UDA-EJIE/udaRUP/issues/24 if (value.length !== 0) { // Devolvemos un array de resultados. for (var i = 0; i &lt; value.length; i++) { tmpJson = {}; if (dotNotation) { tmpJson[dotProperty] = value[i]; returnArray.push(tmpJson) } else { tmpJson[dotProperty] = value[i]; returnArray.push(tmpJson) } } return returnArray; } } else { // Devolvemos un único valor. tmpJson = {}; tmpJson[dotProperty] = value; return tmpJson; } } return null; }, getRupValueWrapped: function (name, value) { var arrTmp, dotNotation = false, dotProperty, wrapObj = {}; if (name) { // Miramos si el name contiene notación dot arrTmp = name.split(&quot;.&quot;); if (arrTmp.length &gt; 1) { dotNotation = true; dotProperty = arrTmp[arrTmp.length - 1]; } else { return value; } wrapObj[dotProperty] = value; return wrapObj; } return null; } }); //Utilidades de los formularios $.fn.serializeToObject = function () { //Para enviar los campos que contienen valor (!= &quot;&quot;) var o = {}, a = this.serializeArrayWithoutNulls(); $.each(a, function () { if (o[this.name]) { if (!o[this.name].push) { o[this.name] = [o[this.name]]; } o[this.name].push(this.value || ''); } else { o[this.name] = this.value; } }); return o; }; $.fn.serializeArrayWithoutNulls = function () { //crea un array con campos de un formulario que tienen valor !=&quot;&quot; return this.map(function () { return this.elements ? jQuery.makeArray(this.elements) : this; }) .filter(function () { return this.name &amp;&amp; !this.disabled &amp;&amp; (this.checked || (/select|textarea/i).test(this.nodeName) || (/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i).test(this.type)); }) .map(function (i, elem) { var val = jQuery(this).val(); if ((jQuery(this).hasClass(&quot;numeric&quot;) || jQuery(this).hasClass(&quot;datepicker&quot;)) /*&amp;&amp; val === &quot;&quot;*/ ) { return { name: elem.name, value: null }; } return val === null || val === &quot;&quot; ? null : jQuery.isArray(val) ? jQuery.map(val, function (val, i) { return { name: elem.name, value: val }; }) : { name: elem.name, value: val }; }).get(); }; $.fn.serializeObject = function () { //Para enviar los campos nulos con null en vez de en blanco var o = {}, a = this.serializeArrayNull(); $.each(a, function () { if (o[this.name]) { if (!o[this.name].push) { o[this.name] = [o[this.name]]; } o[this.name].push(this.value || ''); } else { o[this.name] = this.value; } }); return o; }; $.fn.serializeArrayNull = function () { return this.map(function () { return this.elements ? jQuery.makeArray(this.elements) : this; }) .filter(function () { return this.name &amp;&amp; !this.disabled &amp;&amp; (this.checked || (/select|textarea/i).test(this.nodeName) || (/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i).test(this.type)); }) .map(function (i, elem) { var val = jQuery(this).val(); if ((jQuery(this).hasClass(&quot;numeric&quot;) || jQuery(this).hasClass(&quot;datepicker&quot;)) &amp;&amp; val === &quot;&quot;) { return { name: elem.name, value: null }; } return val === null ? null : jQuery.isArray(val) ? jQuery.map(val, function (val, i) { return { name: elem.name, value: val }; }) : { name: elem.name, value: val }; }).get(); }; jQuery.rup_utils.base64 = { // private property _keyStr: &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;, // public method for encoding encode: function (input) { var output = &quot;&quot;; var chr1, chr2, chr3, enc1, enc2, enc3, enc4; var i = 0; input = jQuery.rup_utils.base64._utf8_encode(input); while (i &lt; input.length) { chr1 = input.charCodeAt(i++); chr2 = input.charCodeAt(i++); chr3 = input.charCodeAt(i++); enc1 = chr1 &gt;&gt; 2; enc2 = ((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4); enc3 = ((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6); enc4 = chr3 &amp; 63; if (isNaN(chr2)) { enc3 = enc4 = 64; } else if (isNaN(chr3)) { enc4 = 64; } output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4); } return output; }, // public method for decoding decode: function (input) { var output = &quot;&quot;; var chr1, chr2, chr3; var enc1, enc2, enc3, enc4; var i = 0; input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, &quot;&quot;); while (i &lt; input.length) { enc1 = this._keyStr.indexOf(input.charAt(i++)); enc2 = this._keyStr.indexOf(input.charAt(i++)); enc3 = this._keyStr.indexOf(input.charAt(i++)); enc4 = this._keyStr.indexOf(input.charAt(i++)); chr1 = (enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4); chr2 = ((enc2 &amp; 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2); chr3 = ((enc3 &amp; 3) &lt;&lt; 6) | enc4; output = output + String.fromCharCode(chr1); if (enc3 != 64) { output = output + String.fromCharCode(chr2); } if (enc4 != 64) { output = output + String.fromCharCode(chr3); } } output = jQuery.rup_utils.base64._utf8_decode(output); return output; }, // private method for UTF-8 encoding _utf8_encode: function (string) { string = string.replace(/\\r\\n/g, &quot;\\n&quot;); var utftext = &quot;&quot;; for (var n = 0; n &lt; string.length; n++) { var c = string.charCodeAt(n); if (c &lt; 128) { utftext += String.fromCharCode(c); } else if ((c &gt; 127) &amp;&amp; (c &lt; 2048)) { utftext += String.fromCharCode((c &gt;&gt; 6) | 192); utftext += String.fromCharCode((c &amp; 63) | 128); } else { utftext += String.fromCharCode((c &gt;&gt; 12) | 224); utftext += String.fromCharCode(((c &gt;&gt; 6) &amp; 63) | 128); utftext += String.fromCharCode((c &amp; 63) | 128); } } return utftext; }, // private method for UTF-8 decoding _utf8_decode: function (utftext) { var string = &quot;&quot;; var i = 0; var c = c1 = c2 = 0; while (i &lt; utftext.length) { c = utftext.charCodeAt(i); if (c &lt; 128) { string += String.fromCharCode(c); i++; } else if ((c &gt; 191) &amp;&amp; (c &lt; 224)) { c2 = utftext.charCodeAt(i + 1); string += String.fromCharCode(((c &amp; 31) &lt;&lt; 6) | (c2 &amp; 63)); i += 2; } else { c2 = utftext.charCodeAt(i + 1); c3 = utftext.charCodeAt(i + 2); string += String.fromCharCode(((c &amp; 15) &lt;&lt; 12) | ((c2 &amp; 63) &lt;&lt; 6) | (c3 &amp; 63)); i += 3; } } return string; } }; })(jQuery); × Search results Close "},"rup.validate.js.html":{"id":"rup.validate.js.html","title":"Source: rup.validate.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.validate.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Validate. * @author EJIE * @version 2.4.10 */ (function ($) { //********************************************* // ESPECIFICACÍON DE LOS TIPOS BASE DEL PATRÓN //********************************************* //***************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //***************************************************************************************************************** /** * Permite al usuario validar los datos introducidos en los campos que se presentan en la aplicación. * * @summary Componente RUP Validate. * @namespace jQuery.rup_validate * @memberOf jQuery * @tutorial rup_validate * @see El componente está basado en el plugin {@link http://jqueryvalidation.org/|jQuery Validation Plugin}. Para mas información acerca de las funcionalidades y opciones de configuración pinche {@link http://jqueryvalidation.org/|aquí}. * @example * var properties={ * rules:{ * &quot;campoObligatorio&quot;:{required:true}, * &quot;dni&quot;:{required:true,dni:true} * } * }; * $(&quot;#formValidaciones&quot;).rup_validate(properties); */ var rup_validate = {}; $.rup_validate ={}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_validate&quot;, rup_validate)); // Se configuran los mensajes idiomaticos. var messages = {}; // Es necesario identificar los mensajes parametrizables. Para ello se buscan los fragmentos de tipo {i} para ser tratados por la funcion format del validador. var regularExpr = new RegExp(&quot;\\\\{\\\\d\\\\}&quot;); $.each($.rup.i18n.base.rup_validate.messages, function(key,value){ if (value.match(regularExpr)!==null){ messages[key]=jQuery.validator.format(value); }else{ messages[key]=value; } }); // Inicializacion de las expresiones regulares var rup_validate_number_regexpr = new RegExp($.rup.i18n.base.rup_validate.regexp.decimal); // Se configruran los mensajes de las reglas de validacion a partir de los definidos en los ficheros idiomaticos. $.extend($.validator.messages, messages); /* * VALIDACIONES */ //sobreescritura jQuery.validator.addMethod(&quot;dni&quot;, function(value, element) { return this.optional(element) || euroNif(value); }); function nif(dni) { if (dni.length === 9) { var numero = dni.substr(0, 8); var ss = typeof numero; var ss2 = typeof dni.substr(dni.length - 1, dni.length); numero = numero % 23; var letra = 'TRWAGMYFPDXBNJZSQVHLCKET'; letra = letra.substring(numero, numero + 1); if (letra != (dni.substr(dni.length - 1, dni.length)).toUpperCase()) { return false; } else { return true; } } else { return false; } } function stripHtml(value) { // remove html tags and space chars return value.replace(/&lt;.[^&lt;&gt;]*?&gt;/g, ' ').replace(/&amp;nbsp;|&amp;#160;/gi, ' ') // remove numbers and punctuation .replace(/[0-9.(),;:!?%#$'&quot;_+=\\/-]*/g,''); } // Dni jQuery.validator.addMethod(&quot;dni&quot;, function(value, element) { return this.optional(element) || nif(value); }); // Numero maximo de palabras jQuery.validator.addMethod(&quot;maxWords&quot;, function(value, element, params) { return this.optional(element) || stripHtml(value).match(/\\b\\w+\\b/g).length &lt; params; }); // Numero minimo de palabras jQuery.validator.addMethod(&quot;minWords&quot;, function(value, element, params) { return this.optional(element) || stripHtml(value).match(/\\b\\w+\\b/g).length &gt;= params; }); // Intervalo de palabras jQuery.validator.addMethod(&quot;rangeWords&quot;, function(value, element, params) { return this.optional(element) || stripHtml(value).match(/\\b\\w+\\b/g).length &gt;= params[0] &amp;&amp; value.match(/bw+b/g).length &lt; params[1]; }); // Letras y caracteres de puntuacion jQuery.validator.addMethod(&quot;letterswithbasicpunc&quot;, function(value, element) { return this.optional(element) || /^[a-z-.,()'\\&quot;\\s]+$/i.test(value); }); // Letras, numeros, espacios o guiones bajos jQuery.validator.addMethod(&quot;alphanumeric&quot;, function(value, element) { return this.optional(element) || /^\\w+$/i.test(value); }); // Solo letras jQuery.validator.addMethod(&quot;lettersonly&quot;, function(value, element) { return this.optional(element) || /^[a-z]+$/i.test(value); }); // Espacios no permitidos jQuery.validator.addMethod(&quot;nowhitespace&quot;, function(value, element) { return this.optional(element) || /^\\S+$/i.test(value); }); // Entero positivo o negativo jQuery.validator.addMethod(&quot;integer&quot;, function(value, element) { return this.optional(element) || /^-?\\d+$/.test(value); }); // Patron jQuery.validator.addMethod(&quot;pattern&quot;, function(value, element, param) { return this.optional(element) || param.test(value); }); // Validacion de campo numerico. Tiene en cuenta el formato dependiendo de la locale jQuery.validator.addMethod(&quot;number&quot;, function(value, element) { var expr = new RegExp($.rup.i18n.base.rup_validate.regexp.decimal); return this.optional(element) || expr.test(value); }); // Validacion de fecha. Tiene en cuanta el formato dependiendo de la locale jQuery.validator.addMethod(&quot;date&quot;, function(value, element, param) { var format; if (typeof param === &quot;boolean&quot;){ if (param===true){ format = $.rup.i18n.base.rup_validate.format.date; }else{ return true; } }else{ format = param; } return this.optional(element) || $.rup_validate.checkDate(format,value); }); //******************************** // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************** $.extend($.rup_validate,{ // Metodo que valida una fecha de acuerdo al formato indicado checkDate : function (format, date) { var daysInFebruary = function(year){ return (((year % 4 === 0) &amp;&amp; ( year % 100 !== 0 || (year % 400 === 0))) ? 29 : 28 ); }, DaysArray = function(n) { for (var i = 1; i &lt;= n; i++) { this[i] = 31; if (i==4 || i==6 || i==9 || i==11) {this[i] = 30;} if (i==2) {this[i] = 29;} } return this; }; var tsp = {}, sep; format = format.toLowerCase(); // Se busca el separador de fecha entre los caracteres &quot;/&quot;,&quot;-&quot;,&quot;.&quot; if(format.indexOf(&quot;/&quot;) != -1) { sep = &quot;/&quot;; } else if(format.indexOf(&quot;-&quot;) != -1) { sep = &quot;-&quot;; } else if(format.indexOf(&quot;.&quot;) != -1) { sep = &quot;.&quot;; } else { sep = &quot;/&quot;; } format = format.split(sep); date = date.split(sep); if (date.length != 3) { return false; } var j=-1,yln, dln=-1, mln=-1; for(var i=0;i&lt;format.length;i++){ var dv = (date[i]===null|| date[i]===&quot;&quot; || isNaN(date[i])) ? 0 : parseInt(date[i],10); tsp[format[i]] = dv; yln = format[i]; if(yln.indexOf(&quot;y&quot;) != -1) { j=i; } if(yln.indexOf(&quot;m&quot;) != -1) { mln=i; } if(yln.indexOf(&quot;d&quot;) != -1) { dln=i; } } if (format[j] == &quot;y&quot; || format[j] == &quot;yyyy&quot;) { yln=4; } else if(format[j] ==&quot;yy&quot;){ yln = 2; } else { yln = -1; } var daysInMonth = DaysArray(12), strDate; if (j === -1) { return false; } else { strDate = tsp[format[j]].toString(); if(yln == 2 &amp;&amp; strDate.length == 1) {yln = 1;} if (strDate.length != yln || (tsp[format[j]]===0 &amp;&amp; date[j]!=&quot;00&quot;)){ return false; } } if(mln === -1) { return false; } else { strDate = tsp[format[mln]].toString(); if (strDate.length&lt;1 || tsp[format[mln]]&lt;1 || tsp[format[mln]]&gt;12){ return false; } } if(dln === -1) { return false; } else { strDate = tsp[format[dln]].toString(); if (strDate.length&lt;1 || tsp[format[dln]]&lt;1 || tsp[format[dln]]&gt;31 || (tsp[format[mln]]==2 &amp;&amp; tsp[format[dln]]&gt;daysInFebruary(tsp[format[j]])) || tsp[format[dln]] &gt; daysInMonth[tsp[format[mln]]]){ return false; } } return true; } }); $.fn.rup_validate(&quot;extend&quot;,{ /** * Se eliminan todos los objetos y eventos credos por el componente. * * @name jQuery.rup_validate#destroy * @example * $(&quot;#formValidaciones&quot;).rup_validate(&quot;destroy&quot;); */ destroy:function(){ var self = this; // Se eliminan los mensajes de error. self.rup_validate(&quot;resetForm&quot;); // Se elimina la informacion almacenada en el objeto. $.removeData(self[0]); // Se eliminan los eventos asociados al objeto. self.unbind(); }, /** * Se eliminan los menssajes de error de las reglas de validacion. * * @name jQuery.rup_validate#resetForm * @example * $(&quot;#formValidaciones&quot;).rup_validate(&quot;resetForm&quot;); */ resetForm:function(){ var self = this, settings = self.data(&quot;settings&quot;); // En caso de mostrarse el feedback de error se oculta. if (settings!=null &amp;&amp; settings.feedback !== undefined &amp;&amp; settings.showErrorsInFeedback){ settings.feedback.rup_feedback(&quot;hide&quot;); } // Se reinician los mensajes de error. self.validate().resetForm(); } }); //******************************** // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************** $.fn.rup_validate(&quot;extend&quot;,{ }); //***************************** // INICIALIZACION DE VARIABLES //***************************** // Propiedades de configuracion predeterminadas para cada una de las posibles parametrizaciones de los errores. var presetSettings = { // Configruacion del componente por defecto defaultPresetSettings:{ showErrors:function(errors){ var self = this, invalid, errorText, feedback, field, errorKey, fieldError, fieldErrorMsg, error, label; // Se comprueba si el parametro que contiene los errores está vacío. En este caso se if (self.currentElements.length===1){ if ($.isEmptyObject(errors)){ delete self.invalid[self.currentElements.attr(&quot;name&quot;)]; } } /* * Mostrar mensaje de error de validaciones en el feedback */ feedback = self.settings.feedback; if (self.settings.showErrorsInFeedback &amp;&amp; feedback!==undefined &amp;&amp; feedback!==null){ errorText = $(&quot;&lt;ul&gt;&quot;).addClass(&quot;rup-maint_feedbackUL&quot;).prepend(self.settings.feedbackErrorConfig.errorMsg); if (jQuery.isEmptyObject(self.invalid)){ feedback.rup_feedback(&quot;close&quot;); }else{ if (self.settings.showFieldErrorsInFeedback){ $.each((!jQuery.isEmptyObject(self.submitted)?self.submitted:self.invalid), function(key,value){ if (self.invalid[key]!==undefined){ field = self.settings.feedbackErrorConfig.getField(self, self.currentForm, key); errorKey = self.settings.feedbackErrorConfig.getFieldName(self, self.currentForm, field); fieldError = self.settings.feedbackErrorConfig.getFieldErrorLabel(self, self.currentForm, field, errorKey); fieldErrorMsg = self.settings.feedbackErrorConfig.getFieldErrorMsg(self, self.currentForm, field, value); fieldError.append(fieldErrorMsg); errorText.append(fieldError); } }); } feedback.rup_feedback(&quot;option&quot;,self.settings.feedbackOptions); feedback.rup_feedback(&quot;set&quot;, errorText, &quot;error&quot;); } } /* * Mostrar detalle de errores en el feedback */ if (self.settings.showFieldErrorAsDefault){ for ( var i = 0; self.errorList[i]; i++ ) { error = self.errorList[i]; if (error.element!==undefined){ label = self.errorsFor( error.element ); if ( label.length ) { label.remove(); } } } } /* En caso de utilizar el tratamiento por defecto del componente de jquery.validate, * no es posible indicarle varios mensajes de error para un campo. * Por ello deberemos concatenar estos mensajes de error en caso de que se de el caso. */ for (var i=0;i&lt;self.errorList.length;i++){ // if (self.settings.showFieldErrorAsDefault){ // self.errorList[i].message=&quot;&quot;; // }else if (self.errorList[i].element===undefined){ alert(&quot;El campo validado no existe en el formulario&quot;); } if ($.isArray(self.errorList[i].message)){ // En caso de que el mensaje de error sea un array de mensajes, se debera de recorrer y concatenar var newMessage=&quot;&quot;; for (var j=0;j&lt;self.errorList[i].message.length;j++){ newMessage+=self.errorList[i].message[j]; if (j!==self.errorList[i].message.length-1){ newMessage+=&quot;, &quot;; } } self.errorList[i].message=newMessage; } } // Se eliminan los etilos de error previos $(&quot;.&quot;+self.settings.errorClass+&quot;:not(.rup-maint_validateIcon)&quot;,self.currentForm).removeClass(self.settings.errorClass); // Se invoca al metodo por defecto del plugin subyacente self.defaultShowErrors(); }, showErrorsInFeedback:function(errors){ }, errorPlacement:function(label,element){ if (element.attr(&quot;ruptype&quot;)==='combo'){ var comboElem = $(&quot;#&quot;+element.attr(&quot;id&quot;)+&quot;-button&quot;); if (comboElem){ label.insertAfter(comboElem); } }else{ label.insertAfter(element); } } }, // Configuracion de las propiedades a aplicar en caso de que se deban mostrar los errores mediante la visualizacion por defecto. showFieldErrorAsDefault:{ errorElement:&quot;img&quot;, errorPlacement: function(error, element) { var errorElem = error.attr(&quot;src&quot;,this.errorImage).addClass(&quot;rup-maint_validateIcon&quot;).html('').rup_tooltip({&quot;applyToPortal&quot;: true}); if (element.attr(&quot;ruptype&quot;)==='combo'){ var comboElem = $(&quot;#&quot;+element.attr(&quot;id&quot;)+&quot;-button&quot;); if (comboElem){ errorElem.insertAfter(comboElem); } }else{ errorElem.insertAfter(element); } } } }; $.fn.rup_validate(&quot;extend&quot;,{ _init : function(args){ var self=this, settings = $.extend(true,{},$.fn.rup_validate.defaults, presetSettings.defaultPresetSettings, args[0]); // settings = $.extend(true, {}, defaultSettings, args[0]); // Anadimos al formulario el class rup_validate para identificarlo como componente formulario. self.addClass(&quot;rup_validate&quot;); // Anadimos el ruptype validate self.attr(&quot;ruptype&quot;,&quot;validate&quot;); /* * Configuracion del componente de validaciones. */ // En caso de que se deban mostrar los errores mediante la visualizacion predeterminada se configuran los presets correspondientes. if (settings.showFieldErrorAsDefault){ settings = $.extend(true,settings,presetSettings.showFieldErrorAsDefault); } settings = $.extend(true, {}, settings, args[0]); // Se realiza la invocacion al plugin jquery.validate self.validate(settings); if (settings.showFieldErrorAsDefault){ self.validate().showLabel = function(element, message){ var label = this.errorsFor( element ); if ( label.length ) { // refresh error/success class label.removeClass( this.settings.validClass ).addClass( this.settings.errorClass ); // check if we have a generated label, replace the message then label.attr(&quot;generated&quot;) &amp;&amp; label.html(message); } else { // create label if (settings.showFieldErrorAsDefault){ label = $(&quot;&lt;&quot; + this.settings.errorElement + &quot;/&gt;&quot;) .attr({&quot;for&quot;: this.idOrName(element), generated: true}) .addClass(this.settings.errorClass) .attr(&quot;title&quot;,message || &quot;&quot;); }else{ label = $(&quot;&lt;&quot; + this.settings.errorElement + &quot;/&gt;&quot;) .attr({&quot;for&quot;: this.idOrName(element), generated: true}) .addClass(this.settings.errorClass) .html(message || &quot;&quot;); } if ( this.settings.wrapper ) { // make sure the element is visible, even in IE // actually showing the wrapped element is handled elsewhere label = label.hide().show().wrap(&quot;&lt;&quot; + this.settings.wrapper + &quot;/&gt;&quot;).parent(); } if ( !this.labelContainer.append(label).length ) this.settings.errorPlacement ? this.settings.errorPlacement(label, $(element) ) : label.insertAfter(element); } if ( !message &amp;&amp; this.settings.success ) { label.text(&quot;&quot;); typeof this.settings.success == &quot;string&quot; ? label.addClass( this.settings.success ) : this.settings.success( label ); } this.toShow = this.toShow.add(label); }; } // Si se ha configurado el componente para que no se realicen validaciones al vuelo de los campos, se eliminan los eventos correspondientes. if (!settings.liveCheckingErrors){ self.unbind(&quot;click&quot;).unbind(&quot;focusin&quot;).unbind(&quot;focusout&quot;).unbind(&quot;keyup&quot;); } // Se captura el evento invalid-form del plugin subyacente para generar un evento propio self.on(&quot;invalid-form.rupValidate_formValidationError&quot;, function(event){ self.off(&quot;invalid-form.rupValidate_formValidationError&quot;); self.triggerHandler(&quot;rupValidate_formValidationError&quot;,[this]); }); // Se almacena la configuracion del componente en el objeto dom para poder recuperarla en sucesivas invocaciones a los metodos del componente. self.data(&quot;settings&quot;, settings); } }); //******************************************************* // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //******************************************************* $.fn.rup_validate.defaults = { ignore:&quot;:hidden[ruptype!='autocomplete'][ruptype!='combo']&quot;, feedbackOptions: {gotoTop: false, fadeSpeed: null, delay: null}, feedbackErrorConfig:{ errorMsg:$.rup.i18nParse($.rup.i18n.base,&quot;rup_maint.validateError&quot;), getField:function(self, form, fieldName){ return $(&quot;[name='&quot; + fieldName+&quot;']&quot;,form); }, getFieldName: function(self, form, field){ var ruptype = field.attr(&quot;ruptype&quot;), labelForName, labelElem, fieldTmp, labelForName, labelForId; fieldTmp = jQuery(field.length&gt;1?field[0]:field); labelForName = fieldTmp.attr(&quot;name&quot;); labelForId = fieldTmp.attr(&quot;id&quot;); if (ruptype!==undefined){ if(ruptype===&quot;combo&quot;){ labelForId = labelForId+&quot;-button&quot;; } if(ruptype===&quot;autocomplete&quot;){ labelForId = labelForId+&quot;_label&quot;; } } labelElem = fieldTmp.parent().find(&quot;label[for='&quot;+labelForName+&quot;']&quot;); if (labelElem.length&gt;0){ return labelElem.text(); } labelElem = fieldTmp.parent().find(&quot;label[for='&quot;+labelForId+&quot;']&quot;); if (labelElem.length&gt;0){ return labelElem.text(); } return fieldTmp.attr(&quot;title&quot;); }, getFieldErrorLabel: function(self, form, field, errorLabel){ return $(&quot;&lt;li&gt;&quot;).append(&quot;&lt;b&gt;&quot; + errorLabel + &quot;:&lt;/b&gt;&quot;); }, getFieldErrorMsg: function(self, form, field, errorMsg){ /* En caso de utilizar el tratamiento por defecto del componente de jquery.validate, * no es posible indicarle varios mensajes de error para un campo. * Por ello deberemos concatenar estos mensajes de error en caso de que se de el caso. */ if ($.isArray(errorMsg)){ // En caso de que el mensaje de error sea un array de mensajes, se debera de recorrer y concatenar var baseUl = $(&quot;&lt;ul&gt;&quot;); for (var i=0;i&lt;errorMsg.length;i++){ baseUl.append($(&quot;&lt;li&gt;&quot;).append(errorMsg[i])); } return baseUl; }else{ return $(&quot;&lt;ul&gt;&quot;).append($(&quot;&lt;li&gt;&quot;).append(errorMsg)); } } }, liveCheckingErrors:false, showErrorsInFeedback:true, showFieldErrorAsDefault:true, showFieldErrorsInFeedback:true, errorImage:$.rup.STATICS+&quot;/rup/basic-theme/images/exclamation.png&quot; }; /** * Función de callback que se ejecutará cuando el formulario sea válido. * * @callback jQuery.rup_validate~onSubmitHandler * @param {Element} form - Referencia al objeto DOM del formulario que está siendo validado. * @example &lt;caption&gt;Envia el formulario cuando este es válido.&lt;/caption&gt; * $(&quot;#idFormulario&quot;).rup_tooltip({ * onSubmitHandler: function(form){ * $(form).ajaxSubmit(); * } * }); * @example &lt;caption&gt;Realizar otras operaciones cuando el formulario es válido.&lt;/caption&gt; * $(&quot;#idFormulario&quot;).rup_tooltip({ * onSubmitHandler: function(form){ // Operaciones extra * $(form).ajaxSubmit(); * } * }); */ /** * Función que se ejecutará cuando el formulario presente errores de validación. * * @callback jQuery.rup_validate~onInvalidHandler * @param {Event} event - Objeto event asociado al evento lanzado. * @param {object} validator - Instancia del validador asociada al formulario actual. * @example * $(&quot;.selector&quot;).validate({ * invalidHandler: function(event, validator) { * // 'this' refers to the form * var errors = validator.numberOfInvalids(); * if (errors) { * var message = errors == 1 * ? 'You missed 1 field. It has been highlighted' * : 'You missed ' + errors + ' fields. They have been highlighted'; * $(&quot;div.error span&quot;).html(message); * $(&quot;div.error&quot;).show(); * } else { * $(&quot;div.error&quot;).hide(); * } * } * }); */ /** * Función que se ejecutará cuando se produzca la validación de los datos permitiendo personalizar los errores de validación. * * @callback jQuery.rup_validate~onShowErrors * @param {Object} errorMap - Pares de clave/valor, donde el key se corresponde con el name del campo del formulario y el value con el mensaje que se va a mostrar para ese campo. * @param {Object[]} errorList - Array de objetos correspondientes a los campos validados. * @param {String} errorList.message - Mensaje que va mostrarse para ese campo. * @param {Element} errorList.element - Objeto del DOM correspondiente a ese campo. * @example * $(&quot;.selector&quot;).validate({ * showErrors: function(errorMap, errorList) { * $(&quot;#summary&quot;).html(&quot;Your form contains &quot; * + this.numberOfInvalids() * + &quot; errors, see details below.&quot;); * this.defaultShowErrors(); * } * }); */ /** * Función de callback que permite personalizar el lugar en el que se posicionarán los mensajes de error. * * @callback jQuery.rup_validate~onErrorPlacement * @param {jQuery} error - Referencia al objeto label que va a ser insertado en el DOM para visualizar los errores. * @param {jQuery} element - Referencia al campo validado. * @example * $(&quot;#myform&quot;).validate({ * errorPlacement: function(error, element) { * error.appendTo( element.parent(&quot;td&quot;).next(&quot;td&quot;) ); * } * }); */ /** * Función de callback para determinar como se debe resaltar los campos inválidos. * * @callback jQuery.rup_validate~onHighlight * @param {jQuery} element - Referencia al campo validado. * @param {String} errorClass - Valor actual del parámetro errorClass. * @param {String} validClass - Valor actual del parámetro validClass. * @example * $(&quot;.selector&quot;).validate({ * highlight: function(element, errorClass, validClass) { * $(element).fadeOut(function() { * $(element).fadeIn(); * }); * } * }); */ /** * Función de callback para determinar como se debe resaltar los campos inválidos. * * @callback jQuery.rup_validate~onUnhighlight * @param {jQuery} element - Referencia al campo validado. * @param {String} errorClass - Valor actual del parámetro errorClass. * @param {String} validClass - Valor actual del parámetro validClass. * @example * $(&quot;.selector&quot;).validate({ * highlight: function(element, errorClass, validClass) { * $(element).addClass(errorClass).removeClass(validClass); * $(element.form).find(&quot;label[for=&quot; + element.id + &quot;]&quot;) * .addClass(errorClass); * }, * unhighlight: function(element, errorClass, validClass) { * $(element).removeClass(errorClass).addClass(validClass); * $(element.form).find(&quot;label[for=&quot; + element.id + &quot;]&quot;) * .removeClass(errorClass); * } * }); */ /** * @description Propiedades de configuración del componente. * @see Para mas información consulte la documentación acerca de las opciones de configuración del plugin {@link http://jqueryvalidation.org/validate/|jQuery Validation Plugin}. * * @name jQuery.rup_validate#options * @property {boolean} [debug=false] - Activa el modo debug. En caso de estar activado el formulario no se envía el formulario y los errores de ejecución que se hayan producido se visualizan en la consola. Requiere Firebug o Firebug lite. * @property {jQuery.rup_validate~onSubmitHandler} [submitHandler] - Método callback utilizado para capturar el evento submit cuando el formulario es válido. Reemplaza el submit por defecto. Es el método utilizado para realizar un submit mediante AJAX después de ser validado. * @property {jQuery.rup_validate~onInvalidHandler} [invalidHandler] - Método callback que se ejecuta cuando un formulario presenta errores de validación. * @property {Selector} [ignore] - Selector jQuery que identifica los elementos del formulario que van a ser ignorados al realizarse las validaciones. * @property {object} [messages] - Utilizado para indicar mensajes propios para las validaciones. Estos se especifican mediante pares de clave/valor. La clave es el nombre del elemento mientras que el valor es el texto que se ha de mostrar en caso de producirse un error en la validación. * @property {object} [groups] - Se utiliza para realizar agrupamientos de mensajes de error. * @property {boolean} [onsubmit=true] - Determina si se valida el formulario al realizarse el submit. Marcar como false para realizar las validaciones mediante el resto de eventos. * @property {boolean} [ofocusout=true] - Determina si se realiza la validación de los campos (excepto los checkbox y radio) al lanzarse los eventos blur. Estas validaciones se realizan únicamente una vez que un campo ha sido marcado como inválido. * @property {boolean} [okeyup=true] - Determina si se realiza la validación de los campos (excepto los checkbox y radio) al lanzarse los eventos keyup. Las validaciones se realizan únicamente una vez que un campo ha sido marcado como inválido. * @property {boolean} [onclick=true] - Determina si se realizan las validaciones de los checkbox y radio al realizar un click sobre los mismos. * @property {boolean} [focusInvalid=true] - Posiciona el foco en el último campo activo o en el primer campo inválido la realizarse la validación de los campos. En caso de encontrarse el foco en un campo al realizarse la validación se mantiene en dicho campo. En caso de no encontrarse el foco en un campo, se posicionará en el primer campo inválido existente. * @property {boolean} [focusCleanup=false] - En caso de activarse, elimina el errorClass correspondiente y oculta los mensajes de error de los campos que reciben el foco. Evitar utilizar esta propiedad en conjunción con focusInvalid. * @property {Selector} [meta] - En caso de utilizar metainformación en los campos que sea utilizada por otros plugins, es posible indicar un identificador para envolver la metadata correspondiente al el componente validate dentro de un objeto propio. * @property {String} [errorClass=error] - Determina el nombre del class que va a aplicarse a los campos que presenten errores de validación. * @property {String} [validClass=valid] - Determina el nombre del class que va a aplicarse a los campos que han sido validados y no presenten errores. * @property {String} [errorElement=label] - Determina el tipo del elemento que va a utilizarse para generar los mensajes de error. * @property {String} [wrapper=window] - Recubre los mensajes de error con el elemento especificado. Util en conjunción la propiedad errorLabelContainer para crear listado de errores. * @property {Selector} [errorLabelContainer] - Determina el objeto contenedor en el que se van a mostrar los mensajes de error. * @property {Selector} [errorContainer] - Determina un contenedor adicional para los mensajes de error. * @property {boolean} [ignoreTitle=false] - Determina si se evita el obtener los mensajes a partir del atributo title. * @property {jQuery.rup_validate~onShowErrors} [showErrors] - Función callback para realizar un tratamiento personalizado de los errores de validación. * @property {jQuery.rup_validate~onErrorPlacement} [errorPlacement] - Función de callback que permite personalizar el lugar en el que se posicionarán los mensajes de error. * @property {jQuery.rup_validate~onHighlight} [highlight] - Función de callback para determinar como se debe resaltar los campos inválidos. * @property {jQuery.rup_validate~onUnhighlight} [unhighlight] - Función de callback para restaurar los cambios realizados por la función indicada en la propiedad highlight. */ /* **********/ /* EVENTOS */ /* **********/ /** * Este evento es lanzado cuando se produce alguna violación entre las reglas de validación especificadas para ser aplicadas sobre los campos del formulario. * * @event jQuery.rup_validate#rupValidate_formValidationError * @property {Event} e - Objeto Event correspondiente al evento disparado. * @example * $(&quot;#idFormulario&quot;).on(&quot;rupValidate_formValidationError&quot;, function(event){ * }); */ })(jQuery); × Search results Close "},"rup.wizard.js.html":{"id":"rup.wizard.js.html","title":"Source: rup.wizard.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: rup.wizard.js /*! * Copyright 2016 E.J.I.E., S.A. * * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»); * Solo podrá usarse esta obra si se respeta la Licencia. * Puede obtenerse una copia de la Licencia en * * http://ec.europa.eu/idabc/eupl.html * * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL», * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas. * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones * que establece la Licencia. */ /** * @fileOverview Implementa el patrón RUP Wizard. * @author EJIE * @version 2.4.10 */ (function ($) { //**************************************************************************************************************** // DEFINICIÓN BASE DEL PATRÓN (definición de la variable privada que contendrá los métodos y la función de jQuery) //**************************************************************************************************************** /** * Permitir guiar al usuario paso a paso a través de un proceso realizando las tareas dentro de un orden señalado. * * @summary Componente RUP Wizard. * @namespace jQuery.rup_wizard * @memberOf jQuery * @tutorial rup_wizard * @example * var properties = {}; * $(&quot;#id_form&quot;).rup_wizard(properties) */ var rup_wizard = {}; //Se configura el arranque de UDA para que alberge el nuevo patrón $.extend($.rup.iniRup, $.rup.rupSelectorObjectConstructor(&quot;rup_wizard&quot;, rup_wizard)); //******************************* // DEFINICIÓN DE MÉTODOS PÚBLICOS //******************************* $.fn.rup_wizard(&quot;extend&quot;,{ /** * Selecciona el paso recibido como parámetro [0..n]. * * @name jQuery.rup_wizard#step * @param {Integer} step - Identificador del paso que se desea seleccionar. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;step&quot;, 1); */ step: function(stepNumber) { //controlar si está deshabilitado if ($(&quot;#stepDesc&quot; + stepNumber).hasClass(&quot;disabled&quot;)){ return false; } var currentId = $(&quot;#steps li.current&quot;).attr(&quot;id&quot;); //Gestionar cabeceras $(&quot;#steps li&quot;).removeClass(&quot;current&quot;); $(&quot;#stepDesc&quot; + stepNumber).addClass(&quot;current&quot;); //Estilo flecha paso anterior $(&quot;#steps li&quot;).removeClass(&quot;visited&quot;); if (stepNumber != 0){ $(&quot;#stepDesc&quot; + (stepNumber-1)).addClass(&quot;visited&quot;); } //Gestionar capas $(&quot;#step&quot; + currentId.substring(8)).hide(); $(&quot;#step&quot; + stepNumber).show(); //Gestionar submitButton if (!this.rup_wizard(&quot;isCurrentStepLast&quot;)){ $(&quot;.rup-wizard_submitButton&quot;).hide(); } else { $(&quot;.rup-wizard_submitButton&quot;).show(); //Mover botón si no es resumen if (!this.rup_wizard(&quot;isCurrentStepSummary&quot;)){ $(&quot;#step&quot; + stepNumber).find(&quot;p[id$='commands']&quot;).append($(&quot;.rup-wizard_submitButton&quot;)); } } }, /** * Selecciona el primer paso del asistente. * * @name jQuery.rup_wizard#first * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;first&quot;); */ first: function(){ this.rup_wizard(&quot;step&quot;,0); }, /** * Selecciona el último paso del asistente. * * @name jQuery.rup_wizard#last * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;last&quot;); */ last: function(){ this.rup_wizard(&quot;step&quot;, $(&quot;#steps&quot;).children().size()-1); }, /** * Devuelve el número del paso actual. * * @name jQuery.rup_wizard#getCurrentStep * @return {Integer} - Número de paso actual. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;getCurrentStep&quot;); */ getCurrentStep: function(){ return parseInt($(&quot;#steps li.current&quot;).attr(&quot;id&quot;).substring(8)); }, /** * Indica si el paso recibido como parámetro es el activo. * * @name jQuery.rup_wizard#isCurrentStep * @param {Integer} step - Número de paso. * @return {boolean} - Devuelve true en caso de que el paso indicado sea el actual y false en caso de que no. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStep&quot;, 2); */ isCurrentStep: function(i){ return (this.rup_wizard(&quot;getCurrentStep&quot;)===i); }, /** * Indica si el paso activo es el primero. * * @name jQuery.rup_wizard#isCurrentStepFirst * @return {boolean} - Devuelve true en caso de que el último paso sea el activo y false en caso de que no. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStepFirst&quot;); */ isCurrentStepFirst: function(){ return this.rup_wizard(&quot;isCurrentStep&quot;,0); }, /** * Indica si el paso activo es el último. * * @name jQuery.rup_wizard#isCurrentStepLast * @return {boolean} - Devuelve true en caso de que el primer paso sea el activo y false en caso de que no. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStepLast&quot;); */ isCurrentStepLast: function(){ return ($(&quot;#steps&quot;).children().size()-1 === this.rup_wizard(&quot;getCurrentStep&quot;)); }, /** * Indica si el paso activo es el resumen. * * @name jQuery.rup_wizard#isCurrentStepSummary * @return {boolean} - Devuelve true en caso de que el paso activo sea el del resumen y false en caso de que no. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStepSummary&quot;); */ isCurrentStepSummary: function(){ return $(&quot;#stepDesc&quot; + this.rup_wizard(&quot;getCurrentStep&quot;)).hasClass(&quot;rup-wizard_summary&quot;); }, /** * Habilita el paso recibido como parámetro. * * @name jQuery.rup_wizard#enableStep * @param {Integer} step - Numero que identifica el paso que deseamos habilitar. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;enableStep&quot;, 2); */ enableStep: function(stepNumber){ $(&quot;#stepDesc&quot; + stepNumber).removeClass(&quot;disabled&quot;); }, /** * Deshabilita el paso recibido como parámetro. * * @name jQuery.rup_wizard#disableStep * @param {Integer} step - Numero que identifica el paso que deseamos deshabilitar. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;disableStep&quot;, 2); */ disableStep: function(stepNumber){ $(&quot;#stepDesc&quot; + stepNumber).addClass(&quot;disabled&quot;); }, /** * Indica si el paso recibido como parámetro está deshabilitado. * * @name jQuery.rup_wizard#isStepDisabled * @param {Integer} step - Numero que identifica el paso que deseamos deshabilitar. * @return {boolean} - Devuelve true si el paso indicado está deshabilitado y false en caso de que no. * @example * $(&quot;#idForm&quot;).rup_wizard(&quot;isStepDisabled&quot;, 2); */ isStepDisabled: function(stepNumber){ return $(&quot;#stepDesc&quot; + stepNumber).hasClass(&quot;disabled&quot;); } }); //******************************* // DEFINICIÓN DE MÉTODOS PRIVADOS //******************************* $.fn.rup_wizard(&quot;extend&quot;, { _init : function(args){ if (args.length &gt; 1) { $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,&quot;rup_global.initError&quot;) + $(this).attr(&quot;id&quot;)); } else { var settings = $.extend({}, $.fn.rup_wizard.defaults, args[0]), rupWizard = this; //referencia this._formToWizard(settings); //Contenedor (UL) $(&quot;#steps&quot;).addClass(&quot;rup-wizard_stepsDescContainer&quot;); //Paso (LI) $(&quot;#steps&quot;).children().each( function(index, element){ $(element) .addClass(&quot;rup-wizard_stepDesc&quot;)//Estilo paso (LI) .click(function (event){ //Click en cabecera para cambio de paso var step = $(this).attr(&quot;id&quot;).substring(8); if (!rupWizard.isStepDisabled(step)){ if (settings.stepFnc[step] !== undefined){ if (settings.stepFnc[step].call() === false){ event.stopImmediatePropagation(); return false; } } $(this).rup_wizard(&quot;step&quot;, step); } }); //Eliminar &quot;Step X&quot; var span = $(element).children(); $(span).text((index+1) + &quot;. &quot; + $(span).text()); $(element).text(&quot;&quot;).append(span); }); //Botones Anterior/Siguiente $(&quot;p[id$='commands'] .prev&quot;) //Estilo .removeClass(&quot;prev&quot;).addClass(&quot;rup-wizard_prev&quot;) //Texto .text($.rup.i18nParse($.rup.i18n.base,&quot;rup_wizard.prev&quot;)) //Evento 'click' .unbind('click').click(function(event){ //Paso anterior rupWizard._gotoPrevStep(rupWizard, settings, event); }); $(&quot;p[id$='commands'] .next&quot;) //Estilo .removeClass(&quot;next&quot;).addClass(&quot;rup-wizard_next&quot;) //Texto .text($.rup.i18nParse($.rup.i18n.base,&quot;rup_wizard.next&quot;)) //Evento 'click' .unbind('click').click(function(event){ //Siguiente paso rupWizard._gotoNextStep(rupWizard, settings, event); }); //Estilo botón submit (sirve de ID) $(&quot;#&quot; + settings.submitButton).addClass(&quot;rup-wizard_submitButton&quot;); if (settings.submitFnc){ $(&quot;#&quot; + settings.submitButton).click(settings.submitFnc); } //Estilos firstStep y finalStep $(&quot;#steps li:first&quot;).addClass(&quot;rup-wizard_firstStepDesc&quot;); $(&quot;#steps li:last&quot;).addClass(&quot;rup-wizard_lastStepDesc&quot;); //Paso de RESUMEN if (settings.summary){ //Cabecera $(&quot;#steps li:last&quot;).removeClass(&quot;rup-wizard_lastStepDesc&quot;); var stepNumber = $(&quot;#steps&quot;).children().size(), stepDesc = $(&quot;&lt;li&gt;&quot;) .attr(&quot;id&quot;, &quot;stepDesc&quot; + stepNumber) .addClass(&quot;rup-wizard_stepDesc rup-wizard_summary rup-wizard_lastStepDesc&quot;) .append(&quot;&lt;a href='#'&gt;&quot;+(stepNumber+1)+&quot;. &quot;+$.rup.i18nParse($.rup.i18n.base,&quot;rup_wizard.summary&quot;)+&quot;&lt;/a&gt;&quot;) .click(function (){ //Paso final $(this).rup_wizard(&quot;step&quot;, $(this).attr(&quot;id&quot;).substring(8)); //Resumen rupWizard._generateSummary(stepNumber, rupWizard, settings); }); $(&quot;#steps&quot;).append(stepDesc); //Capa if (stepNumber &gt; 1){ $(&quot;div[id='step&quot;+(stepNumber-1)+&quot;']&quot;).after(&quot;&lt;div id='step&quot;+stepNumber+&quot;' style='display: none;'/&gt;&quot;); //Añadir botón siguiente anteúltimo paso var nextButton = $(&quot;&lt;a&gt;&quot;) .attr(&quot;id&quot;, &quot;step&quot; + (stepNumber-1) + &quot;Next&quot;) .html($.rup.i18nParse($.rup.i18n.base,&quot;rup_wizard.next&quot;)) .addClass(&quot;rup-wizard_next&quot;) .unbind('click').click(function(event){ //Siguiente paso rupWizard._gotoNextStep(rupWizard, settings, event); //Resumen rupWizard._generateSummary(stepNumber, rupWizard, settings); }); $(&quot;#step&quot; + (stepNumber-1) + &quot;commands&quot;).append(nextButton); } } //Disabled if (settings.disabled !== undefined){ $.each(settings.disabled, function(index, element){ if (typeof element === &quot;number&quot;){ $(this).rup_wizard(&quot;disableStep&quot;, element); } else if (typeof element === &quot;string&quot;){ var begin = parseInt(element.substring (0, element.indexOf(&quot;-&quot;))), end = parseInt(element.substring (element.indexOf(&quot;-&quot;)+1, element.length)); for (var i=begin; i&lt;=end; i++){ $(this).rup_wizard(&quot;disableStep&quot;, i); } } }); } } //Ir al paso inicial this.rup_wizard(&quot;step&quot;,0); }, _gotoNextStep : function(rupWizard, settings, event) { // Obtener paso siguiente var nextStep = parseInt($(&quot;#steps li.current&quot;) .attr(&quot;id&quot;).substring(8)) + 1; // Comprobar que no está deshabilitado (o buscar el // siguiente // habilitado) if (rupWizard.isStepDisabled(nextStep)) { nextStep = $(&quot;#stepDesc&quot; + (nextStep - 1)) .nextAll(&quot;li:not(.disabled)&quot;).first() .attr(&quot;id&quot;); if (nextStep !== undefined) { nextStep = parseInt(nextStep.substring(8)); } else { return false; } // Si fuera necesario, se generar el resumen if (jQuery(&quot;#steps&quot;).children().size() - 1 === nextStep) { rupWizard._generateSummary(nextStep, rupWizard, settings); } } // Invocar f(x) del paso (si existe) if (settings.stepFnc[nextStep] !== undefined) { if ($(&quot;#stepDesc&quot; + nextStep).not( &quot;.rup-wizard_summary&quot;).length &gt; 0) { // Evitar // resumen // (mala // configuracion // desarrollador) if (settings.stepFnc[nextStep].call() === false) { event.stopImmediatePropagation(); return false; } } } // Cambiar de paso $(&quot;#stepDesc&quot; + nextStep).rup_wizard(&quot;step&quot;, nextStep); }, _gotoPrevStep : function (rupWizard, settings, event){ //Obtener paso anterior var prevStep = parseInt($(&quot;#steps li.current&quot;).attr(&quot;id&quot;).substring(8))-1; //Comprobar que no está deshabilitado (o buscar el anterior habilitado) if (rupWizard.isStepDisabled(prevStep)){ prevStep = $(&quot;#stepDesc&quot;+(prevStep+1)).prevAll(&quot;li:not(.disabled)&quot;).first().attr(&quot;id&quot;); if (prevStep !== undefined){ prevStep = parseInt(prevStep.substring(8)); } else { return false; } } //Invocar f(x) del paso (si existe) if (settings.stepFnc[prevStep] !== undefined){ if (settings.stepFnc[prevStep].call() === false){ event.stopImmediatePropagation(); return false; } } //Cambiar de paso $(&quot;#stepDesc&quot;+prevStep).rup_wizard(&quot;step&quot;, prevStep); }, _generateSummary : function (stepNumber, rupWizard, settings){ //controlar si está deshabilitado if ($(&quot;#stepDesc&quot; + stepNumber).hasClass(&quot;disabled&quot;)){ return false; } //Devolver botón submit a su lugar $(&quot;#step&quot; + stepNumber).parent().append($(&quot;.rup-wizard_submitButton&quot;)); /** DEVELOPER SummaryFnc_PRE **/ if (settings.summaryFnc_PRE &amp;&amp; settings.summaryFnc_PRE.call() === false){ return false; } //Reiniciar capa (si hacemos .empty() no funciona accordion la segunda vez) $(&quot;#step&quot;+stepNumber).remove(); $(&quot;div[id='step&quot;+(stepNumber-1)+&quot;']&quot;).after(&quot;&lt;div id='step&quot;+stepNumber+&quot;' style='display: none;'/&gt;&quot;); //Copiar capas anteriores for (var i=0; i&lt;stepNumber; i++){ if (!rupWizard.isStepDisabled(i)){//Comprobar pasos deshabilitados $(&quot;#step&quot;+stepNumber).append($(&quot;#step&quot;+i).children().clone()); } } //Eliminar botones $(&quot;#step&quot;+stepNumber+&quot; p[id$='commands']&quot;).remove(); //Botón anterior $(&quot;div[id='step&quot;+(stepNumber)+&quot;'] fieldset:last&quot;).append(&quot;&lt;p id='step&quot; + stepNumber + &quot;commands'&gt;&lt;/p&gt;&quot;); var prevButton = $(&quot;&lt;a&gt;&quot;) .attr(&quot;id&quot;, &quot;step&quot; + stepNumber + &quot;Prev&quot;) .html($.rup.i18nParse($.rup.i18n.base,&quot;rup_wizard.prev&quot;)) .addClass(&quot;rup-wizard_prev&quot;) .unbind('click').click(function(event){ //Paso anterior rupWizard._gotoPrevStep(rupWizard, settings, event); }); $(&quot;#step&quot; + stepNumber + &quot;commands&quot;).append(prevButton); /** DEVELOPER SummaryFnc_INTER **/ if (settings.summaryFnc_INTER &amp;&amp; settings.summaryFnc_INTER.call() === false){ return false; } //RUP_MULTICOMBO $(&quot;#step&quot;+stepNumber+&quot; .ui-multiselect&quot;).each( function() { var selectObj = $(&quot;#&quot;+$(this).prev().attr('id')); if (selectObj.data(&quot;settings&quot;)!==undefined){ var seleccionados = selectObj.rup_combo(&quot;label&quot;); if (seleccionados.length&gt;0){//Existen elementos seleccionados? if (selectObj.data(&quot;settings&quot;)[&quot;summaryInline&quot;] == undefined){ //Tratamiento por defecto var contenedor = $(&quot;&lt;div /&gt;&quot;).addClass(&quot;rup-wizard_summaryMultivalue&quot;).insertAfter(this); for (var i=0; i&lt;seleccionados.length; i++){ $(settings.labelElement, { text: '- '+ seleccionados[i], &quot;class&quot;:&quot;rup-wizard_summaryValue&quot;}).appendTo(contenedor); $(&quot;&lt;br/&gt;&quot;).appendTo(contenedor); } } else { //Tratamiento en línea $(settings.labelElement, { text: seleccionados.toString().replace(/,/g,&quot;, &quot;), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); } } else{ $(settings.labelElement, { html: &quot;&amp;nbsp;&quot;, &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); } $(this).prev().remove(); $(this).remove(); } }); //Gestionar INPUTS $(&quot;#step&quot;+stepNumber+&quot; input&quot;).each( function() { if (this.type === &quot;text&quot;){ $(settings.labelElement, { text: this.value, &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); } else if (this.type === &quot;password&quot;){ $(settings.labelElement, { text: rupWizard._hidePassword(this.value), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); } else if (this.type === &quot;radio&quot;){ if (this.checked){ $(settings.labelElement, { text: $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).text(), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); $(&quot;#&quot;+this.id).attr(&quot;checked&quot;,&quot;checked&quot;); //Restablecer selección que se pierde al clonar } // if (this.checked){ // $(settings.labelElement, { text: &quot;(*) &quot; + $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).text(), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); // $(&quot;#&quot;+this.id).attr(&quot;checked&quot;,&quot;checked&quot;); //Restablecer selección que se pierde al clonar // } else { // $(settings.labelElement, { text: &quot;( ) &quot; + $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).text(), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); // } $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).remove(); } else if (this.type === &quot;checkbox&quot;){ if (this.checked){ $(settings.labelElement, { text: &quot;[X] &quot; + $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).text(), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); } else { $(settings.labelElement, { text: &quot;[ ] &quot; + $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).text(), &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); } $(&quot;#step&quot;+stepNumber+&quot; label[for='&quot;+this.id+&quot;']&quot;).remove(); } $(this).remove(); }); //Gestionar TEXTAREAS $(&quot;#step&quot;+stepNumber+&quot; textarea&quot;).each( function() { $(settings.textareaElement, { text: $(&quot;#&quot;+$(this).attr(&quot;id&quot;)).val(), &quot;class&quot;:&quot;rup-wizard_summaryParagraph&quot; }).insertAfter(this); $(this).remove(); }); //Gestionar SELECTS $(&quot;#step&quot;+stepNumber+&quot; select:not('.ui-pg-selbox')&quot;).each( function() { $(settings.labelElement, { text: ($(&quot;#&quot;+this.id+&quot; option:selected&quot;).text()!==&quot;&amp;nbsp;&quot;)?$(&quot;#&quot;+this.id+&quot; option:selected&quot;).text():&quot;&quot;, &quot;class&quot;:&quot;rup-wizard_summaryValue&quot; }).insertAfter(this); $(this).remove(); }); //Gestionar LABELS $(&quot;#step&quot;+stepNumber+&quot; label&quot;).each( function() { $(settings.labelSeparatorElement, { html: settings.labelSeparatorText, &quot;class&quot;:&quot;rup-wizard_separator&quot; }).insertAfter(this); $(settings.labelElement, { text: this.innerHTML, &quot;class&quot;:&quot;rup-wizard_summaryLabel&quot; }).insertAfter(this); $(this).remove(); }); //Gestionar componentes RUP //rup_accordion $(&quot;#step&quot;+stepNumber+&quot; .ui-accordion&quot;).each( function() { $(this).attr(&quot;id&quot;, $(this).attr(&quot;id&quot;) + &quot;_summary&quot;); $(this).removeAttr(&quot;class&quot;); $(this).children(&quot;h1&quot;).removeAttr(&quot;class&quot;); $(this).children(&quot;div&quot;).removeAttr(&quot;class&quot;); if ($.isEmptyObject(settings.rupAccordion)){ $(this).rup_accordion(settings.accordion); } else { $(this).rup_accordion(settings.rupAccordion); } }); //rup_combo (multicombo se procesa antes) $(&quot;#step&quot;+stepNumber+&quot; .rup_combo&quot;).each( function() { $(this).remove(); }); //rup_date $(&quot;#step&quot;+stepNumber+&quot; img.ui-datepicker-trigger&quot;).each( function() { $(this).remove(); }); //rup_time $(&quot;#step&quot;+stepNumber+&quot; img.ui-timepicker-trigger&quot;).each( function() { $(this).remove(); }); //rup_tabs var maxLevel = 0; //Control de estilos cuando las pestañas pasan a accordion if (settings.summaryTabs2Accordion){ settings.rupTabsElement = &quot;&lt;a /&gt;&quot;; } $(&quot;#step&quot;+stepNumber+&quot; &gt; fieldset&quot;).children(&quot;.rup-tabs_container&quot;).each( function() { var labelTabs = new Array(), idTabs = new Array(), fieldset = $(this).parent().attr(&quot;accordionable&quot;,true), //Donde se deben anidar las pestañas containerTab = new Array(); //Obtención de valores/ids de pestañas (labelTabs &amp; idTabs) rupWizard._getRupTabs(rupWizard, $(this), labelTabs, idTabs); //Procesar pestañas var tab = null, pointer = $(fieldset); for (var i=0; i&lt;labelTabs.length; i++){ tab = $(settings.rupTabsElement).text(labelTabs[i]); //LABEL pestaña if (idTabs[i].indexOf(&quot;rupRandomLayerId&quot;)!==-1){ //Es pestaña tab = $(tab).wrap(&quot;&lt;div class='IE8_fix'&gt;&quot;); tab = $(tab).parent().append($(this).find(idTabs[i]).html()); $(tab).children(&quot;div&quot;).addClass(&quot;rup-wizard_tabLevel-&quot;+containerTab.length); tab = $(tab).children().unwrap(); } else { //Es contenedor de pestañas tab = $(tab).attr(&quot;tabContainer&quot;,true); tab = $(tab).wrap(&quot;&lt;div class='IE8_fix'&gt;&quot;); tab = $(tab).parent().append($(&quot;&lt;div&gt;&quot;) .attr(&quot;id&quot;,&quot;subtab_&quot;+labelTabs[i]) .attr(&quot;accordionable&quot;,true) .addClass(&quot;rup-wizard_tabContainerLevel-&quot;+containerTab.length) ); tab = $(tab).children().unwrap(); containerTab.push(labelTabs[i]); maxLevel++; $(pointer).append(tab); pointer = $(&quot;#subtab_&quot;+labelTabs[i]); continue; } //Comprobamos si es subelemento if ($(&quot;#&quot;+containerTab[containerTab.length-1]).find(idTabs[i]).length === 0){ //No es subpestaña, se debe mover el puntero de dónde se deba añadir la capa pointer = $(fieldset); do{ containerTab.pop();//Extraer contenedor de pestañas //Comprobar si es subelemento if ($(&quot;#&quot;+containerTab[containerTab.length-1]).find(idTabs[i]).length &gt; 0){ pointer = $(&quot;#subtab_&quot;+containerTab[containerTab.length-1]); break; } else { //Recalcular estilo (valor del nivel) $($(tab).get(1)).removeAttr(&quot;class&quot;).addClass(&quot;rup-wizard_tabLevel-&quot;+containerTab.length); } } while (containerTab.length&gt;0); } //Añadir la capa $(pointer).append(tab); } // rup_table $(&quot;#step&quot;+stepNumber+&quot; .rup-table-container&quot;).each( function() { var $table = $(this); $table.fluidWidth({ fluidBaseLayer:&quot;#&quot;+$table.parent().attr(&quot;id&quot;) }); }); //h1 a /h1 para Pesatañas if (settings.summaryTabs2Accordion){ $(fieldset).find(&quot;a&quot;).each(function(){ if (!$(this).hasClass(&quot;rup-wizard_prev&quot;) &amp;&amp; !$(this).hasClass(&quot;rup-wizard_next&quot;) ){ //Controlar que no sea botón $(this).wrap(&quot;&lt;h1&gt;&quot;); } }); } //Eliminar contenedor $(this).remove(); }); //summaryWithAccordion if (settings.summaryWithAccordion){ //Convertir estructura $(&quot;#step&quot;+stepNumber).find(&quot;legend&quot;).each( function(index, element) { //legend -&gt; h1 a /h1 $(&quot;&lt;a /&gt;&quot;) .text(element.innerHTML) .insertBefore($(element).parent()) .wrap(&quot;&lt;h1 /&gt;&quot;); //fieldset -&gt; div $(element).parent().replaceWith( $(&quot;&lt;div /&gt;&quot;) .attr(&quot;accordionable&quot;, $(element).parent().attr(&quot;accordionable&quot;)===undefined?false:true) .append($(element).parent().children()) ); //remove legend $(element).remove(); }); //convertir en rup-accordion if ($.isEmptyObject(settings.summaryAccordion)){ $(&quot;#step&quot;+stepNumber).rup_accordion(settings.accordion); } else { $(&quot;#step&quot;+stepNumber).rup_accordion(settings.summaryAccordion); } //Botón anterior (sacar de accordion) $(&quot;&lt;fieldset /&gt;&quot;) .attr(&quot;id&quot;, &quot;commands_fieldset&quot;) .append($(&quot;#step&quot;+stepNumber).find(&quot;p[id='step&quot;+(stepNumber)+&quot;commands']&quot;)) .appendTo($(&quot;#step&quot;+stepNumber)); //Espacio para separarlo de los pasos if (settings.summaryWithAccordionSpaceBefore){ $(&quot;#step&quot;+stepNumber).prepend(&quot;&lt;/br&gt;&quot;); } //Espacio para separarlo de los botones if (settings.summaryWithAccordionSpaceAfter){ $(&quot;#commands_fieldset&quot;).prepend(&quot;&lt;/br&gt;&quot;); } } //tabs2Accordion if (settings.summaryTabs2Accordion){ //Eliminar estilos para no accordion for (var i=0; i&lt;=maxLevel; i++){ $(&quot;.rup-wizard_tabLevel-&quot;+i).removeClass(&quot;rup-wizard_tabLevel-&quot;+i); $(&quot;.rup-wizard_tabContainerLevel-&quot;+i).removeClass(&quot;rup-wizard_tabContainerLevel-&quot;+i); } $(&quot;[accordionable=true]&quot;).each( function(index, element) { if (element.nodeName === &quot;FIELDSET&quot;){ var legend = $(element).find(&quot;legend&quot;)[0], buttons = $(element).find(&quot;p[id='step&quot;+(stepNumber)+&quot;commands']&quot;), object = $(&quot;&lt;div /&gt;&quot;) .attr(&quot;accordionable&quot;, $(element).attr(&quot;accordionable&quot;)===undefined?false:true) .append($(element).children()); //Cambiar estructura $(element).replaceWith(object); //Eliminar extras (LEGEND y BOTONES) $(legend).remove(); $(buttons).remove(); //Accordion if ($.isEmptyObject(settings.tabAccordion)){ $(object).rup_accordion(settings.accordion); } else { $(object).rup_accordion(settings.tabAccordion); } //Restablecer extras (LEGEND y BOTONES) $(object).prepend(legend); $(object).append($(&quot;&lt;fieldset /&gt;&quot;).append(buttons)); } else { if ($.isEmptyObject(settings.tabAccordion)){ $(element).rup_accordion(settings.accordion); } else { $(element).rup_accordion(settings.tabAccordion); } } }); } //Eliminar posibles atributos y estilos extra $(&quot;[accordionable]&quot;).removeAttr(&quot;accordionable&quot;); //Mover botón submit $(&quot;#step&quot; + stepNumber).find(&quot;p[id$='commands']&quot;).append($(&quot;.rup-wizard_submitButton&quot;)); //Mostrar paso $(&quot;#step&quot;+stepNumber).show(); /** DEVELOPER SummaryFnc_POST **/ if (settings.summaryFnc_POST){ settings.summaryFnc_POST.call(); } }, _getRupTabs: function(rupWizard, object, labelTabs, idTabs){ //Recorrer los enlaces a pestañas $(object).find(&quot;.rup-tabs_title&quot;).each( function(index, element) { //Comprobar que si el elemento ya existe (subpestaña) por recursividad, se omite if ($.inArray(element.innerHTML, labelTabs) !== -1){ return; } //Obtener ID y LABEL idTabs.push($(element).parent().attr(&quot;href&quot;)); labelTabs.push(element.innerHTML); //Es un contenedor de pestañas (llamada recursiva para pre-procesar los hijos) if (idTabs[idTabs.length-1].substring(1) === labelTabs[labelTabs.length-1]){ rupWizard._getRupTabs(rupWizard, $(&quot;#&quot;+labelTabs[labelTabs.length-1]), labelTabs, idTabs); } }); }, _hidePassword : function (password){ var value = ''; for (var i=0; i&lt;password.length; i++){ value += '*'; } return value; }, /* Created by jankoatwarpspeed.com */ //http://www.jankoatwarpspeed.com/post/2009/09/28/webform-wizard-jquery.aspx //Modificaciones: // - SPAN por A en los pasos para poder navegar con el tabulador _formToWizard : function(options) { options = $.extend({ submitButton: &quot;&quot; }, options); var element = this; var steps = $(element).find(&quot;fieldset&quot;); var count = steps.size(); var submmitButtonName = &quot;#&quot; + options.submitButton; $(submmitButtonName).hide(); // 2 $(element).before(&quot;&lt;ul id='steps'&gt;&lt;/ul&gt;&quot;); steps.each(function(i) { $(this).wrap(&quot;&lt;div id='step&quot; + i + &quot;'&gt;&lt;/div&gt;&quot;); $(this).append(&quot;&lt;p id='step&quot; + i + &quot;commands'&gt;&lt;/p&gt;&quot;); // 2 var name = $(this).find(&quot;legend&quot;).html(); $(&quot;#steps&quot;).append(&quot;&lt;li id='stepDesc&quot; + i + &quot;'&gt;Step &quot; + (i + 1) + &quot;&lt;a href='#'&gt;&quot; + name + &quot;&lt;/a&gt;&lt;/li&gt;&quot;); if (i == 0) { createNextButton(i); selectStep(i); } else if (i == count - 1) { $(&quot;#step&quot; + i).hide(); createPrevButton(i); } else { $(&quot;#step&quot; + i).hide(); createPrevButton(i); createNextButton(i); } }); function createPrevButton(i) { var stepName = &quot;step&quot; + i; $(&quot;#&quot; + stepName + &quot;commands&quot;).append(&quot;&lt;a href='#' id='&quot; + stepName + &quot;Prev' class='prev'&gt;&lt; Back&lt;/a&gt;&quot;); $(&quot;#&quot; + stepName + &quot;Prev&quot;).bind(&quot;click&quot;, function(e) { $(&quot;#&quot; + stepName).hide(); $(&quot;#step&quot; + (i - 1)).show(); $(submmitButtonName).hide(); selectStep(i - 1); }); } function createNextButton(i) { var stepName = &quot;step&quot; + i; $(&quot;#&quot; + stepName + &quot;commands&quot;).append(&quot;&lt;a href='#' id='&quot; + stepName + &quot;Next' class='next'&gt;Next &gt;&lt;/a&gt;&quot;); $(&quot;#&quot; + stepName + &quot;Next&quot;).bind(&quot;click&quot;, function(e) { $(&quot;#&quot; + stepName).hide(); $(&quot;#step&quot; + (i + 1)).show(); if (i + 2 == count) $(submmitButtonName).show(); selectStep(i + 1); }); } function selectStep(i) { $(&quot;#steps li&quot;).removeClass(&quot;current&quot;); $(&quot;#stepDesc&quot; + i).addClass(&quot;current&quot;); } } }); //****************************************************** // DEFINICIÓN DE LA CONFIGURACION POR DEFECTO DEL PATRON //****************************************************** $.fn.rup_wizard.defaults = { summary : true, summaryWithAccordion : false, summaryWithAccordionSpaceBefore : true, summaryWithAccordionSpaceAfter : true, summaryTabs2Accordion : false, stepFnc: {}, //funciones de cada paso accordion: { animated: &quot;bounceslide&quot;, active: false, autoHeight: false, collapsible: true }, rupAccordion: {}, //accordion (config) definidos en el formulario summaryAccordion: {}, //accordion (config) para generar resumen tabAccordion: {}, //accorion (config) para pestañas del resumen rupTabsElement : &quot;&lt;h4 /&gt;&quot;, labelElement : &quot;&lt;span /&gt;&quot;, labelSeparatorElement : &quot;&lt;span /&gt;&quot;, labelSeparatorText : &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;, textareaElement : &quot;&lt;p /&gt;&quot; }; /** * Función de callback que se ejecuta previamente al envío del formulario. * * @callback jQuery.rup_validate~onSubmitFnc * @example * $(&quot;#idForm&quot;).rup_wizard({ * submitFnc: function(){ * } * }); */ /** * Función de callback que se invocará previamente a la generación del paso. * * @callback jQuery.rup_validate~onSummaryFnc_PRE * @return {boolean} - En caso de devolver false no se generaría el resumen. * @example * $(&quot;#idForm&quot;).rup_wizard({ * summaryFnc_PRE: function(){ * } * }); */ /** * Función de callback que se ejecuta una vez ha comenzado la generación del paso resumen. * * @callback jQuery.rup_validate~onSummaryFnc_INTER * @return {boolean} - En caso de devolver false no se continuaría con el procesado del contenido de los pasos * @example * $(&quot;#idForm&quot;).rup_wizard({ * summaryFnc_INTER: function(){ * } * }); */ /** * Función de callback que se invocará una vez se ha generado el paso resumen. * * @callback jQuery.rup_validate~onSummaryFnc_POST * @example * $(&quot;#idForm&quot;).rup_wizard({ * summaryFnc_POST: function(){ * } * }); */ /** * @description Propiedades de configuración del componente. * * @name jQuery.rup_wizard#options * * @property {Selector} submitButton - Identificador del botón de envío del formulario. Sirve para que dicho botón solo se muestre en el último paso del asistente. * @property {jQuery.rup_validate~onSubmitFnc} [submitFnc] - Función que se ejecuta previamente al envío del formulario. * @property {boolean} [summary=true] - Indica si se debe generar o no el paso resumen. Este paso mostrará (como texto plano) los valores seleccionados en los diferentes pasos habilitados. Si un paso se encuentra deshabilitado no se utilizarán sus valores para la generación del resumen. El paso de resumen se genera cuando se navega hacia él. * @property {boolean} [summaryWithAccordion=false] - Indica si el paso resumen debe formatear los diferentes pasos del asistente mediante elementos que usan el componente accordion. * @property {boolean} [summaryWithAccordionSpaceBefore=true] - Indica si cuando se genera un resumen con los diferentes pasos presentados con accordion, se debe dejar un espacio (&lt;/br&gt;) entre el contenido y la barra con los pasos. * @property {boolean} [summaryWithAccordionSpaceAfter=true] - Indica si cuando se genera un resumen con los diferentes pasos presentados con accordion, se debe dejar un espacio (&lt;/br&gt;) entre el contenido y el contenedor de botones (siguiente y enviar). * @property {boolean} [summaryTabs2Accordion=false] - Indica si los componentes rup_tab de los diferentes pasos del wizard se deben convertir en elementos del componente accordion a la hora de generar el paso resumen. * @property {jQuery.rup_validate~onSummaryFnc_PRE} [summaryFnc_PRE] - Función que se invocará previamente a la generación del paso resumen. En caso de devolver false no se generaría el resumen. * @property {jQuery.rup_validate~onSummaryFnc_INTER} [summaryFnc_INTER] -Función que se ejecuta una vez ha comenzado la generación del paso resumen. Se habrá generado la capa contenedora y duplicado el contenido de los pasos anteriores pero sin llegar a procesarse (cambiarse por texto plano). En caso de devolver false no se continuaría con el procesado del contenido de los pasos. * @property {jQuery.rup_validate~onSummaryFnc_POST} [summaryFnc_POST] - Función que se ejecuta una vez se ha generado el paso resumen. * @property {object} [stepFnc] - Objeto json que contiene las diferentes funciones a ejecutar al navegar hacia cada uno de los pasos. En caso de devolver false no se continuaría la navegación hacia dicho paso. La clave de cada elemento será el número del paso y el valor será la función a ejecutar. * @property {Integer[]} [disabled] - Array que indica los pasos a deshabilitar al inicio. En caso de que el elemento del array sea un número (numeric) se deshabilitará dicho paso y en caso de que sea un literal (string) se procesará como un intervalo que deberá definirse como “X-Y”. * @property {object} [accordion] - Define de forma general el funcionamiento del componente rup_accordion en el paso de resumen. * @property {object} [rupAccordion] - Define el funcionamiento del patrón rup_accordion en el resumen (de los objetos rup_accordion existentes en los pasos anteriores). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. * @property {object} [summaryAccordion] - Define el funcionamiento del patrón rup_accordion en el resumen para cada uno de los pasos que lo componen (si configura la generación de resumen y conversión de pasos en accordion). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. * @property {object} [tabAccordion] - Define el funcionamiento del patrón rup_accordion en el resumen, para cada los objetos rup_tab existentes en los pasos anteriores (si configura la generación de resumen y conversión de pestañas en accordion). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. * @property {string} [rupTabsElement=&lt;h4/&gt;] - Define el funcionamiento del patrón rup_accordion en el resumen, para cada los objetos rup_tab existentes en los pasos anteriores (si configura la generación de resumen y conversión de pestañas en accordion). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. * @property {string} [labelElement=&lt;span/&gt;] - Indica el tipo de objeto HTML en el que se convierten los objetos label en el paso de resumen. * @property {string} [labelSeparatorElement=&lt;span/&gt;] - Indica el tipo de objeto HTML que se utilizará para separar los valores de sus correspondientes labels en el paso de resumen. * @property {string} [labelSeparatorText=&amp;nbsp;&amp;nbsp;&amp;nbsp;] - Indica el contenido del objeto HTML que se utilizará para separar los valores de sus correspondientes labels en el paso de resumen. * @property {string} [textareaElement=&lt;p/&gt;] - Indica el tipo de objeto HTML en el que se convierten los objetos textarea en el paso de resumen. */ })(jQuery); × Search results Close "},"core_utils_form2object.js.html":{"id":"core_utils_form2object.js.html","title":"Source: core/utils/form2object.js","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Source: core/utils/form2object.js /** * Copyright (c) 2010 Maxim Vasiliev * * Permission is hereby granted, free of charge, to any person obtaining a copy * of this software and associated documentation files (the &quot;Software&quot;), to deal * in the Software without restriction, including without limitation the rights * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell * copies of the Software, and to permit persons to whom the Software is * furnished to do so, subject to the following conditions: * * The above copyright notice and this permission notice shall be included in * all copies or substantial portions of the Software. * * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN * THE SOFTWARE. * * @author Maxim Vasiliev * Date: 09.09.2010 * Time: 19:02:33 */ (function() { /** * Returns form values represented as Javascript object * &quot;name&quot; attribute defines structure of resulting object * * @param rootNode {Element|String} root form element (or it's id) * @param delimiter {String} structure parts delimiter defaults to '.' * @param skipEmpty {Boolean} should skip empty text values, defaults to true */ window.form2object = function(rootNode, delimiter, skipEmpty) { if (typeof skipEmpty == 'undefined' || skipEmpty == null) skipEmpty = true; if (typeof delimiter == 'undefined' || delimiter == null) delimiter = '.'; rootNode = typeof rootNode == 'string' ? document.getElementById(rootNode) : rootNode; var formValues = getFormValues(rootNode); var result = {}; var arrays = {}; for (var i = 0; i &lt; formValues.length; i++) { var value = formValues[i].value; if (skipEmpty &amp;&amp; value === '') continue; var name = formValues[i].name; if (name){ var nameParts = name.split(delimiter); var currResult = result; for (var j = 0; j &lt; nameParts.length; j++) { var namePart = nameParts[j]; var arrName; if (namePart.indexOf('[]') &gt; -1 &amp;&amp; j == nameParts.length - 1) { arrName = namePart.substr(0, namePart.indexOf('[')); if (!currResult[arrName]) currResult[arrName] = []; currResult[arrName].push(value); } else { if (namePart.indexOf('[') &gt; -1) { arrName = namePart.substr(0, namePart.indexOf('[')); var arrIdx = namePart.replace(/^[a-z]+\\[|\\]$/gi, ''); /* * Because arrIdx in field name can be not zero-based and step can be * other than 1, we can't use them in target array directly. * Instead we're making a hash where key is arrIdx and value is a reference to * added array element */ if (!arrays[arrName]) arrays[arrName] = {}; if (!currResult[arrName]) currResult[arrName] = []; if (j == nameParts.length - 1) { currResult[arrName].push(value); } else { if (!arrays[arrName][arrIdx]) { currResult[arrName].push({}); arrays[arrName][arrIdx] = currResult[arrName][currResult[arrName].length - 1]; } } currResult = arrays[arrName][arrIdx]; } else { if (j &lt; nameParts.length - 1) /* Not the last part of name - means object */ { if (!currResult[namePart]) currResult[namePart] = {}; currResult = currResult[namePart]; } else { currResult[namePart] = value; } } } } } } return result; }; function getFormValues(rootNode) { var result = [], name; var currentNode = rootNode.firstChild; while (currentNode) { if (currentNode.nodeName.match(/INPUT|SELECT|TEXTAREA|HIDDEN/i) || jQuery(currentNode).is(&quot;[ruptype='tree']&quot;)){ var fieldValue = getFieldValue(currentNode); if ((jQuery(currentNode).is(&quot;select&quot;) &amp;&amp; currentNode.multiple) || jQuery(currentNode).is(&quot;[ruptype='tree']&quot;)){ var nameParts = jQuery(currentNode).attr(&quot;name&quot;).split(&quot;.&quot;); name = nameParts.length&gt;1?nameParts.slice(0,nameParts.length-1).join('.'):nameParts[0]; }else{ name = jQuery(currentNode).attr(&quot;name&quot;); } if (fieldValue !== null){ result.push({ name: name, value: fieldValue}); } } else { var subresult = getFormValues(currentNode); result = result.concat(subresult); } currentNode = currentNode.nextSibling; } return result; } function getFieldValue(fieldNode) { var ruptype = jQuery(fieldNode).attr(&quot;ruptype&quot;); if (ruptype){ return jQuery(fieldNode)[&quot;rup_&quot;+ruptype](&quot;getRupValue&quot;); }else{ switch (fieldNode.nodeName) { case 'HIDDEN': case 'INPUT': case 'TEXTAREA': switch (fieldNode.type.toLowerCase()) { case 'radio': case 'checkbox': if (fieldNode.checked) return fieldNode.value; break; case 'button': case 'reset': case 'submit': case 'image': return ''; break; default: return fieldNode.value; break; } break; case 'SELECT': return getSelectedOptionValue(fieldNode); break; default: break; } } return null; } function getSelectedOptionValue(selectNode) { var multiple = selectNode.multiple; if (!multiple) return selectNode.value; var result = []; for (var options = selectNode.getElementsByTagName(&quot;option&quot;), i = 0, l = options.length; i &lt; l; i++) { var nameParts = selectNode.name.split(&quot;.&quot;); nameParts[nameParts.length-1]; // if (options[i].selected) result.push(options[i].value); if (options[i].selected){ var jsonObj = {}; jsonObj[nameParts[nameParts.length-1]] = options[i].value; result.push(jsonObj); } } return result; } /** * @deprecated Use form2object() instead * @param rootNode * @param delimiter */ window.form2json = window.form2object; })(); × Search results Close "},"namespaces.list.html":{"id":"namespaces.list.html","title":"Namespaces","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespaces Namespaces rup_accordion Componente RUP Accordion. rup_autocomplete Componente RUP Autocomplete. rup_button Componente RUP Button. rup_combo Componente RUP Combo. rup_contextMenu Componente RUP ContextMenu. rup_dav Componente RUP Dav. rup_dialog Componente RUP Dialog. rup_form Componente RUP Form. rup_language Componente RUP Language. rup_messages Componente RUP Message. rup_report Componente RUP Report. rup_table Componente RUP Table. rup_tooltip Componente RUP Tooltip. rup_upload Componente RUP Upload. rup_utils Librería de utilidades para los componentes RUP. rup_validate Componente RUP Validate. rup_wizard Componente RUP Wizard. Events rupTable_beforeProcessing Evento que se lanza antes de que se procese la información recibida del servidor. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Información recibida del servidor. st string Mensaje de status de la petición. xhr object Objeto xhr recibido. Source: rup_table/rup.table.core.js, line 1595 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_beforeProcessing&quot;, function(event, data, st, xhr){ }); rupTable_checkOutOfGrid Evento que se produce al detectarse que el usuario interactua con un elemento externo a la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. $originalTarget jQuery Objeto jQuery que referencia el elemento del dom con el que ha interactuado el usuario. Source: rup_table/rup.table.core.js, line 1573 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_checkOutOfGrid&quot;, function(event, $originalTarget){ }); rupTable_coreConfigFinished Evento que se lanza después de que el componente haya finalizado con el proceso de configuración e inicialización. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup_table/rup.table.core.js, line 1628 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_coreConfigFinished&quot;, function(event, $row){ }); rupTable_serializeGridData Este evento se lanza durante el proceso de serialización de la información que va a ser enviada para obtener los registros que se van a mostrar en la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Información serializada que va a ser enviada. Se puede modificar o agregar nuevos campos para completarla. Source: rup_table/rup.table.core.js, line 1584 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_serializeGridData&quot;, function(event, data){ }); rupTableClearHighlightedRowAsSelected Se produce cuando se elimina el resaltado de un registro de la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. $row jQuery Objeto jQuery que identifica la línea que se ha procesado. Source: rup_table/rup.table.core.js, line 1608 Example $(&quot;#idComponente&quot;).on(&quot;rupTableClearHighlightedRowAsSelected&quot;, function(event, $row){ }); rupTableHighlightRowAsSelected Se produce cuando se añade el resaltado a un registro de la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. $row jQuery Objeto jQuery que identifica la línea que se ha procesado. Source: rup_table/rup.table.core.js, line 1618 Example $(&quot;#idComponente&quot;).on(&quot;rupTableHighlightedRowAsSelected&quot;, function(event, $row){ }); fileuploadadd Permite asociar una función que se ejecutará cuando se añada un fichero mediante el componente. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 533 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadadd&quot;, function (e, data) { }); fileuploadalways Permite asociar una función que se ejecutará al producirse un envío correcto, erróneo o se aborte. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 590 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadalways&quot;, function (e, data) { }); fileuploaddone Permite asociar una función que se ejecutará al realizarse de manera satisfactoria el envío de los ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 568 Example $(&quot;#fileupload&quot;).on(&quot;fileuploaddone&quot;, function (e, data) { }); fileuploadfail Permite asociar una función que se ejecutará al producirse un error en el envío de los ficheros o al abortarse el envío. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 579 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadfail&quot;, function (e, data) { }); fileuploadprogress Permite asociar una función que se ejecutará al producirse un evento relacionado con el indicador de progreso del envío de ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 601 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadprogress&quot;, function (e, data) { }); fileuploadprogressall Permite asociar una función que se ejecutará al producirse un evento relacionado el indicador de progreso global de envío de ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 612 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadprogressall&quot;, function (e, data) { }); fileuploadsend Permite asociar una función que se ejecutará al iniciarse el envío de cada fichero. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 556 Returns: Si la función retorna false el envío no se realiza. Type boolean Example $(&quot;#fileupload&quot;).on(&quot;fileuploadsend&quot;, function (e, data) { }); fileuploadstart Permite asociar una función que se ejecutará al inicio del envío de los ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup.upload.js, line 623 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadstart&quot;, function (e) { }); fileuploadstop Permite asociar una función que se ejecutará al detenerse el proceso de envío de ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup.upload.js, line 633 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadstop&quot;, function (e) { }); fileuploadsubmit Permite asociar una función que se ejecutará cuando se añada un fichero mediante el componente. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 544 Returns: Si la función retorna false el envío no se realiza. Type boolean Example $(&quot;#fileupload&quot;).on(&quot;fileuploadsubmit&quot;, function (e, data) { }); rupValidate_formValidationError Este evento es lanzado cuando se produce alguna violación entre las reglas de validación especificadas para ser aplicadas sobre los campos del formulario. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup.validate.js, line 745 Example $(&quot;#idFormulario&quot;).on(&quot;rupValidate_formValidationError&quot;, function(event){ }); × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError UDA - Componentes RUP (Soporte de la rama 2.x)Colección de patrones visuales denominada RUP (Rich UDA Patterns). Entorno de desarrolloPara poder desarrollar los componentes RUP es necesario instalar y configurar las siguientes dependencias en el entorno local: Git: Git es necesario para la instalación de paquetes y dependencias. Node.js: Se utiliza Node para la generación de documentación, iniciar un servidor web para la aplicación de demostración, la ejecución de tests y para generar los ficheros distribuibles. Bower: Para la gestión de ciertas librerías js se emplea Bower como gestor de dependencias. Gulp: Se emplea Gulp como sistema de generación y automatización de tareas. Se deberá de instalar de manera global: $ npm install --global gulp-cliInstalar dependenciasPara instalar las dependencias de Node, ejecutar: $ npm installPara instalar las dependencias de Bower, ejecutar: $ bower installGenerar documentaciónPara generar documentación a partir de los comentarios jsdoc existentes en las fuentes, ejecutar: $ gulp docLa documentación resultante se generará en el directorio doc/ Generar ficheros distribuiblesPara generar los ficheros distribuibles, ejecutar: $ gulp distEl contenido se generará en el directorio dist/ Ejecutar aplicación de demoSe ha implementado una aplicación de demostración en la que es posible ver en funcionamiento los componentes RUP. La aplicación se sirve mediante un servidor Node. Para arrancarlo, ejecutar: $ node server.jsLa aplicación estará accesible bajo la url http://localhost:8080/ Ejecutar testLos test implementados mediante Jasmine se ejecutan con Karma. Para lanzar el proceso, ejecutar: $ karma startEl resultado de los test se genera en test/test_results.html Index rup.accordion.js Implementa el patrón RUP Accordion. Version: 2.4.10 Author: EJIE Source: rup.accordion.js, line 17 Index rup.autocomplete.js Implementa el patrón RUP Autocomplete. Version: 2.4.10 Author: EJIE Source: rup.autocomplete.js, line 17 Index rup.button.js Implementa el patrón RUP Button. Version: 2.4.10 Author: EJIE Source: rup.button.js, line 17 Index rup.combo.js Implementa el patrón RUP Combo. Version: 2.4.10 Author: EJIE Source: rup.combo.js, line 28 Index rup.contextMenu.js Implementa el patrón RUP ContextMenu. Version: 2.4.10 Author: EJIE Source: rup.contextMenu.js, line 17 Index rup.dav.js Implementa el patrón RUP Dav. Version: 2.4.10 Author: EJIE Source: rup.dav.js, line 17 Index rup.dialog.js Implementa el patrón RUP Dialog. Version: 2.4.10 Author: EJIE Source: rup.dialog.js, line 31 Index rup.form.js Implementa el patrón RUP Form. Version: 2.4.10 Author: EJIE Source: rup.form.js, line 17 Index rup.lang.js Implementa el patrón RUP Language. Version: 2.4.10 Author: EJIE Source: rup.lang.js, line 44 Index rup.message.js Implementa el patrón RUP Message. Version: 2.4.10 Author: EJIE Source: rup.message.js, line 17 Index rup.report.js Implementa el patrón RUP Report. Version: 2.4.10 Author: EJIE Source: rup.report.js, line 17 Index rup.tooltip.js Implementa el patrón RUP Tooltip. Version: 2.4.10 Author: EJIE Source: rup.tooltip.js, line 17 Index rup.upload.js Implementa el patrón RUP Upload. Version: 2.4.10 Author: EJIE Source: rup.upload.js, line 17 Index rup.utils.js Clase de utilidades para los patrones RUP. Author: EJIE Source: rup.utils.js, line 17 Index rup.validate.js Implementa el patrón RUP Validate. Version: 2.4.10 Author: EJIE Source: rup.validate.js, line 17 Index rup.wizard.js Implementa el patrón RUP Wizard. Version: 2.4.10 Author: EJIE Source: rup.wizard.js, line 17 Index rup_table/rup.table.core.js Implementa el patrón RUP Table. Version: 2.4.10 Author: EJIE Source: rup_table/rup.table.core.js, line 17 × Search results Close "},"jQuery.rup_accordion.html":{"id":"jQuery.rup_accordion.html","title":"Namespace: rup_accordion","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_accordion rup_accordion Tiene como objetivo presentar un contenido donde conceptos relacionados pueden agruparse (ej. secciones) de manera que el usuario puede mostrar u ocultar información sin perder el contexto del contenido principal. Source: rup.accordion.js, line 28 Tutorials: Tutorial: rup_accordion Example $(&quot;.rup_accordion&quot;).rup_accordion({ animated: &quot;bounceslide&quot;, active: false, autoHeight: false, collapsible: true }); Members defaults Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description validation boolean &lt;optional&gt; true Parámetro de configuración que determina la aplicación de la validación estructural asociada a las necesidades estructurales del Accordion. Source: rup.accordion.js, line 223 Methods activate() Activación programática de la sección especificada por parámetro. Parameters: Type Description number | object | boolean Valor numérico diferente de cero que indique la sección seleccionada o un selector que determine el elemento activado. En caso de tener el collapsible activado, es posible pasar el valor false para que se cierren todas las secciones. Source: rup.accordion.js, line 127 Example // Activar la seción tercera. $(&quot;#idAccordion&quot;).rup_accordion(&quot;activate&quot;, 3); // Activar la seción identificada con el selector seccion3. $(&quot;#idAccordion&quot;).rup_accordion(&quot;activate&quot;, &quot;#seccion3&quot;); // Colapsar todas las secciones. $(&quot;#idAccordion&quot;).rup_accordion(&quot;activate&quot;, false); destroy() Elimina completamente la funcionalidad del Accordion. Como resultado, se devuelven losobjetos html, tal y como estaban, antes de aplicar el componente Accordion. Source: rup.accordion.js, line 54 Example $(&quot;#idAccordion&quot;).rup_accordion(&quot;destroy&quot;); disable() Deshabilita el componente Accordion. Source: rup.accordion.js, line 67 Example $(&quot;#idAccordion&quot;).rup_accordion(&quot;disable&quot;); enable() Habilita el componente Accordion. Source: rup.accordion.js, line 78 Example $(&quot;#idAccordion&quot;).rup_accordion(&quot;enable&quot;); option(opt [, value]) Dependiendo de si se informa un valor asociado a una parámetro o se introduce un json con relaciones variable-valor o no se pasan parámetros asociados a la opción especificada, la función asigna el nuevo valor al parámetro asociado o asigna el nuevo conjunto de valores a los parámetros asociados o devuelve el valor actual del parámetro especificado (actuando como un get), respectivamente.. Parameters: Name Type Argument Description opt String | Object Nombre de la propiedad u objeto con varias propiedades. value * &lt;optional&gt; Valor a asignar a la propiedad especificada por su nombre en el primer parámetro. Source: rup.accordion.js, line 89 Example // Asignar el valor &quot;bounceslide&quot; a la propiedad &quot;animated&quot; $(&quot;#idAccordion&quot;).rup_accordion(&quot;option&quot;, &quot;animated&quot;, &quot;bounceslide&quot;); // Se asignan valores a varias propiedades por medio de un objeto json. $(&quot;#idAccordion&quot;).rup_accordion(&quot;option&quot;,{active: false, collapsible : true}); // Se recupera el valor de la propiedad &quot;animated&quot; $(&quot;#idAccordion&quot;).rup_accordion(&quot;option&quot;, &quot;animated&quot;); resize() La función provoca el reajuste de los height (tamaño vertical) de las distintas secciones del Accordion. La ejecución de esta función solo tiene sentido si la opción fillSpace está activada y el height del contenedor cambia. Deprecated: desde la version 2.5.0. Utilizar en su lugar el método refresh. Source: rup.accordion.js, line 144 Example $(&quot;#idAccordion&quot;).rup_accordion(&quot;resize&quot;); widget() Devuelve el elemento .ui-accordion:. Source: rup.accordion.js, line 115 Returns: Objeto jQuery que contiene el accordion. Type object Example $(&quot;#idAccordion&quot;).rup_accordion(&quot;widget&quot;); × Search results Close "},"jQuery.rup_autocomplete.html":{"id":"jQuery.rup_autocomplete.html","title":"Namespace: rup_autocomplete","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_autocomplete rup_autocomplete Permite al usuario recuperar un elemento de una gran lista de elementos o de varias listas dependientes de forma sencilla y ocupando poco espacio en la interfaz. Source: rup.autocomplete.js, line 28 Tutorials: Tutorial: rup_autocomplete Example $(&quot;#idAutocomplete&quot;).rup_autocomplete({ source : &quot;autocomplete/remote&quot;, sourceParam : {label:&quot;desc&quot;+$.rup_utils.capitalizedLang(), value:&quot;code&quot;} }); Members defaults Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description onLoadError jQuery.rup_autocomplete~onLoadError &lt;optional&gt; Función de callback a ejecutar en caso de que se produzca un error en la petición de obtención de la lista de elementos a mostrar. contains boolean &lt;optional&gt; true Valor que determina si la búsqueda debe ser del tipo “contiene” (se buscarán elementos que contengan en cualquier posición el literal introducido) o del tipo “comienza por” (se buscarán elementos que comiencen por el literal introducido). valueName string &lt;optional&gt; null Determina el valor de la propiedad name del campo que utilizará internamente el componente para almacenar el identificador del elemento seleccionado por el usuario. En caso de no especificarse, se tomará como valor el valor de la propiedad name del elemento sobre el cual se ha definido el componente. labelName string &lt;optional&gt; null Determina el valor de la propiedad name del campo que utilizará internamente el componente para almacenar el texto del elemento seleccionado por el usuario. En caso de no especificarse, se tomará como valor el valor de la propiedad name del elemento sobre el cual se ha definido el componente, añadiéndole el sufijo “_label”. getText boolean &lt;optional&gt; false En caso de ser true el componente devolverá como resultado seleccionado el texto en vez del value del elemento. combobox boolean &lt;optional&gt; false Habilita/deshabilita el modo de funcionamiento combobox. menuMaxHeight number &lt;optional&gt; false Determina la altura máxima que podrá tener la capa del menú desplegable antes de mostrar scroll. menuAppendTo object &lt;optional&gt; null Permite especificar mediante un selector de jQuery el elemento del DOM al que se añadirá el menú desplegable. disabled boolean &lt;optional&gt; false determina si se deshabilita el componente Autocomplete sobre el input al que se aplica. De tal modo que por mucho que se interactué con el elemento no se hará una búsqueda. Source: rup.autocomplete.js, line 872 Methods close() Oculta el autocomplete. Source: rup.autocomplete.js, line 307 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;close&quot;); destroy() Elimina el autocomplete. Source: rup.autocomplete.js, line 125 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;destroy&quot;); disable() Deshabilita el autocomplete. Internamente invoca al método jQuery.rup_autocomplete#off. Source: rup.autocomplete.js, line 182 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;disable&quot;); enable() Habilita el autocomplete. Internamente invoca al método jQuery.rup_autocomplete#on. Source: rup.autocomplete.js, line 207 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;enable&quot;); getRupValue() Método utilizado para obtener el valor del componente. Este método es el utilizado por el resto de componentes RUP para estandarizar la obtención del valor del Autocomplete. Source: rup.autocomplete.js, line 79 Returns: Devuelve el valor actual del componente seleccionado por el usuario. Type string | number Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;getRupValue&quot;); off() Deshabilita el autocomplete (solo la parte de sugerencias, el input sigue habilitado). Source: rup.autocomplete.js, line 144 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;off&quot;); on() Habilita el autocomplete (solo la parte de sugerencias). Source: rup.autocomplete.js, line 163 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;on&quot;); option(optionName [, value], aux) Permite consultar y modificar la configuración del componente. Parameters: Name Type Argument Description optionName string | object Nombre de la propiedad que se desea gestionar o objeto de compuesto de varias propiedades. value * &lt;optional&gt; Corresponde al valor de la propiedad en caso de haberse especificado el nombre de la misma en el primér parámetro. aux * Parámetro extra de confirguración para la propiedad &quot;source&quot;. Source: rup.autocomplete.js, line 232 Example // Establecer una propiedad $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;option&quot;, &quot;minLegth&quot;, 2); // Establecer varias propiedad $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;option&quot;, {minLegth:2, delay:1000}); search(term) Lanza una búsqueda en el autocomplete con el parámetro indicado y el foco va a parar alinput. Parameters: Name Type Description term string Cadena de texto utilizada para realizar la búsqueda. Source: rup.autocomplete.js, line 289 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;search&quot;, &quot;java&quot;); set(value, label) Método utilizado para asignar el valor y el literal al componente. El valor se almacena en el campo hidden creado por el componente. El contenido indicado en la propiedad label se mostrará en el campo input del componente. Parameters: Name Type Description value string | number Valor que se va a almacenar en el campo hidden y que se corresponde con el value seleccionado. label string Texto que se va a mostrar en el campo de texto del componente. Source: rup.autocomplete.js, line 332 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;set&quot;, &quot;48&quot;, &quot;Bizkaia&quot;); setRupValue(param) Método utilizado para asignar el valor al componente. Este método es el utilizado porel resto de componentes RUP para estandarizar la asignación del valor al Autocomplete. Parameters: Name Type Description param string | number Valor que se va a asignar al componente. Source: rup.autocomplete.js, line 92 Example $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;setRupValue&quot;, &quot;Si&quot;); val() Devuelve el valor del autocomplete. Este es el valor que se guarda en el campo oculto antes descrito al final del apartado 7.Para obtener la descripción (dato que se muestra en el input) se invocará a la función estándar de jQuery. Source: rup.autocomplete.js, line 318 Example // Recuperar el valor $(&quot;#idAutocomplete&quot;).rup_autocomplete(&quot;val&quot;); // Recuperar la descripción $(&quot;#idAutocomplete&quot;).val(); Type Definitions onLoadError(xhr, textStatus, errorThrown) Función a ejecutar en caso de producirse un error a la hora de obtener los elementos a mostrar. Parameters: Name Type Description xhr Object Objeto XHR que contiene la respuesta de la petición realizada. textStatus string Texto que identifica el error producido. errorThrown Object Objeto error que contiene las propiedades del error devuelto en la petición. Source: rup.autocomplete.js, line 863 × Search results Close "},"jQuery.rup_button.html":{"id":"jQuery.rup_button.html","title":"Namespace: rup_button","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_button rup_button Presenta un control de interación con el usuario. Se trata de extender los botones estandar del HTML para dotarles de mayores funcionalidades con las que mejorar la usabilidad de la aplicación. Source: rup.button.js, line 28 Tutorials: Tutorial: rup_button Example // Botón por defecto $(&quot;#idButton&quot;).rup_button({}); // Botón desplegable $(&quot;#idButtonDrop&quot;).rup_button({ dropdown:{ dropdownListId:&quot;dropdownHtmlList&quot; } }); Members defaults Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description dropdown boolean | Object &lt;optional&gt; false Determina si el botón va a contar con un menú desplegable de acciones secundarias. En caso de mostrar un desplegable esta propiedad contendrá el objeto de configuración del mismo. Source: rup.button.js, line 295 dropdown_defaults Opciones por defecto del objeto de configuración del menú desplegable asociado al botón. Properties: Name Type Argument Default Description dropdownIcon string &lt;optional&gt; ui-icon-triangle-1-s Clase css correspondiente al icono del control que despliega el menú. Source: rup.button.js, line 306 × Search results Close "},"jQuery.rup_combo.html":{"id":"jQuery.rup_combo.html","title":"Namespace: rup_combo","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_combo rup_combo Permite al usuario recuperar un elemento de una gran lista de elementos o de varias listas dependientes de forma sencilla y ocupando poco espacio en la interfaz. Source: rup.combo.js, line 39 Tutorials: Tutorial: rup_combo Example $(&quot;#idCombo&quot;).rup_combo({ source : &quot;comboSimple/remote&quot;, sourceParam : {label:&quot;desc&quot;+$.rup_utils.capitalizedLang(), value:&quot;code&quot;, style:&quot;css&quot;} }); Members defaults Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description onLoadError jQuery.rup_combo~onLoadError &lt;optional&gt; Función de callback a ejecutar en caso de que se produzca un error en la petición de obtención de la lista de elementos a mostrar. width number &lt;optional&gt; 200 Determina el tamaño del combo. Su valor por defecto es 200 para la selección simple. En el caso de selección múltiple su declaración es obligatoria. blank string &lt;optional&gt; null Se utiliza para declarar un valor independiente de la lógica del negocio. En ocasiones se representa como “Seleccione un elemento. style string &lt;optional&gt; dropdown Tipo de visualización de la lista de opciones del combo. showValue boolean &lt;optional&gt; false Determina si el combo debe mostrar el valor asociado concatenado al literal (sólo selección simple). token string &lt;optional&gt; &quot;|&quot; Define el separador a utilizar cuando se muestra el valor asociado al combo concatenado al literal. multiValueToken string &lt;optional&gt; &quot;##&quot; Define el separador a utilizar en combos enlazados locales. ordered boolean &lt;optional&gt; true Indica si el combo debe ordenarse. orderedByValue boolean &lt;optional&gt; false Indica si el la ordenación del combo debe realizarse por el valor de los elementos en lugar de por el texto. onLoadSuccess jQuery.rup_combo~onLoadSuccess &lt;optional&gt; null Función de callback a ejecutar en el caso de que la petición de carga de datos se haya producido correctamente. loadFromSelect boolean &lt;optional&gt; false Determina si se debe de utilizar los elementos option del elemento html sobre el que se inicializa el componente para inicializar los datos del elemento. multiselect boolean &lt;optional&gt; false Indica si el combo permite la selección múltiple. multiOptgroupIconText boolean &lt;optional&gt; false Indica si se desea que en la selección múltiple con grupos, el nombre del grupo tenga descripción en los iconos para seleccionar/deseleccionar los elementos del grupo. submitAsString boolean &lt;optional&gt; false Indica si el envío de los elementos seleccionados en la selección múltiple se realiza como un literal separados por coma. submitAsJSON boolean &lt;optional&gt; false Indica si el envío de los elementos seleccionados en la selección múltiple se realiza como un array JSON donde el nombre del mapa será el nombre del combo. En el caso de que el nombre contenga notación dot se tomará el último literal. Ej: [{id:1}, {id:2}, …]. readAsString boolean &lt;optional&gt; false Determina si la asignación de un valor inicial se va a realizar a partir de un string con los ids de los elementos separados por comas en vez de un array de json. rowStriping boolean &lt;optional&gt; false Indica si se debe aplicar un estilo diferente a las filas pares e impares para poder distinguirlas mediante un color diferente. typeAhead number &lt;optional&gt; false Especifica en milisegundos el tiempo de espera que toma el componente antes de procesar los eventos de escritura realizados por el usuario. legacyWrapMode number &lt;optional&gt; false Determina si se emplea el método obsoleto a la hora de empaquetar en objetos json los elementos seleccionados. Su propósito es mantener la retrocompatibilidad. Source: rup.combo.js, line 1630 Methods checkAll() Selecciona todos los elementos en el caso de tratarse de un combo multilesección. Source: rup.combo.js, line 156 Example $(&quot;#idCombo&quot;).rup_combo(&quot;checkAll&quot;); clear() Método que limpia el valor seleccionado en el combo. En el caso de selección múltiple los valores seleccionados. Source: rup.combo.js, line 124 Example $(&quot;#idCombo&quot;).rup_combo(&quot;clear&quot;); disable() Deshabilita el combo. Source: rup.combo.js, line 317 Example $(&quot;#idCombo&quot;).rup_combo(&quot;disable&quot;); disableChild() Vacía y deshabilita el combo sobre el que se aplica así como todos los combos que depende de él. Su uso principalmente es interno para las peticiones remotas. Source: rup.combo.js, line 382 Example $(&quot;#idCombo&quot;).rup_combo(&quot;disableChild&quot;); disableOpt(optValue) Deshabilita una opción de un combo multiselección. Parameters: Name Type Description optValue string Value del option que queremos deshabilitar. Source: rup.combo.js, line 403 Example $(&quot;#idCombo&quot;).rup_combo(&quot;disableOpt&quot;, &quot;opt1&quot;); disableOptArr(optValueArr) Deshabilita varias opciones del combo. Las opciones se identifican mediante un array. Parameters: Name Type Description optValueArr Array.&lt;string&gt; Array en el que se indican los values de las opciones a deshabilitar. Source: rup.combo.js, line 449 Example $(&quot;#idCombo&quot;).rup_combo(&quot;disableOptArr&quot;, [&quot;opt1&quot;,&quot;opt2&quot;]); enable() Habilita el combo. Source: rup.combo.js, line 343 Example $(&quot;#idCombo&quot;).rup_combo(&quot;enable&quot;); enableOpt(enableOpt) Habilita una opción de un combo multiselección. Parameters: Name Type Description enableOpt string Value del option que queremos habilitar. Source: rup.combo.js, line 467 Example $(&quot;#idCombo&quot;).rup_combo(&quot;enableOpt&quot;, &quot;opt1&quot;); enableOptArr(optValueArr) Habilita varias opciones del combo. Las opciones se identifican mediante un array. Parameters: Name Type Description optValueArr Array.&lt;string&gt; Array en el que se indican los values de las opciones a habilitar. Source: rup.combo.js, line 505 Example $(&quot;#idCombo&quot;).rup_combo(&quot;enableOptArr&quot;, [&quot;opt1&quot;,&quot;opt2&quot;]); getRupValue() Método utilizado para obtener el valor del componente. Este método es el utilizado por el resto de componentes RUP para estandarizar la obtención del valor del Combo. Source: rup.combo.js, line 61 Returns: Devuelve el valor actual del componente seleccionado por el usuario. Type string | number Example $(&quot;#idCombo&quot;).rup_combo(&quot;getRupValue&quot;); index() Devuelve el índice de la opción seleccionada en el combo (empezando en 0). En el caso de la selección múltiple se devolverá un array. Source: rup.combo.js, line 289 Returns: Índice del elemento o elementos seleccionados. Type number | Array.&lt;number&gt; Example $(&quot;#idCombo&quot;).rup_combo(&quot;index&quot;); isDisabled() Indica si el combo está deshabilitado o no. Parameters: Type Description boolean Devuelve si el combo está deshabilitado o no. Source: rup.combo.js, line 366 Example $(&quot;#idCombo&quot;).rup_combo(&quot;isDisabled&quot;); label() Método que devuelve el label asociado al valor seleccionado en el combo. En el caso de la selección múltiple se devolverá un array. Source: rup.combo.js, line 266 Returns: Texto del elemento o elementos seleccionado. Type string | Array.&lt;string&gt; Example $(&quot;#idCombo&quot;).rup_combo(&quot;label&quot;); order(orderedByValue, orderAsNumber, skipFirst) Ordena alfanumericamente y en orden ascendente el combo sobre el que se aplica. Se invoca por defecto al cargarse los combos a no se que se cambie el valor del atributo ordered en la creación. Parameters: Name Type Description orderedByValue boolean Indica si la búsqueda es por texto (por defecto) o si la búsqueda es por el valor. orderAsNumber boolean Indica si se debe den de ordenar como valores numéricos en vez de alfabéticos. skipFirst boolean Determina si se debe de obviar el primer elemento. Source: rup.combo.js, line 633 Example $(&quot;#idCombo&quot;).rup_combo(&quot;reload&quot;); refresh() Refresca los valores asociados al combo. Source: rup.combo.js, line 523 Example $(&quot;#idCombo&quot;).rup_combo(&quot;refresh&quot;); reload() Realiza una recarga de los combos. Source: rup.combo.js, line 555 Example $(&quot;#idCombo&quot;).rup_combo(&quot;reload&quot;); reset() Realiza una reinicizalización del estado del componente. Source: rup.combo.js, line 142 Example $(&quot;#idCombo&quot;).rup_combo(&quot;reset&quot;); select(param) Selecciona el elemento enviado como parámetro. En caso de ser un numérico se selecciona por la posición (comenzando en 0) y si es un literal se selecciona por el valor. En el caso de selección múltiple el parámetro será un array. Parameters: Name Type Description param string | number | Array.&lt;string&gt; | Array.&lt;number&gt; Parámetro utilzado para determinar los elementos a seleccionar. Source: rup.combo.js, line 174 Example // Simple $(&quot;#idCombo&quot;).rup_combo(&quot;select&quot;, 2); // Multiple $(&quot;#idCombo&quot;).rup_combo(&quot;select&quot;, [0,2]); selectLabel(param) Selecciona el elemento del combo que contiene como texto el indicado. En caso de no existir el texto a buscar el combo no sufrirá cambios En el caso de selección múltiple el parámetro será un array. Parameters: Name Type Description param string | Array.&lt;string&gt; Parámetro utilzado para determinar los elementos a seleccionar. Source: rup.combo.js, line 206 Example // Simple $(&quot;#idCombo&quot;).rup_combo(&quot;selectLabel&quot;, &quot;No&quot;); // Multiple $(&quot;#idCombo&quot;).rup_combo(&quot;selectLabel&quot;, [&quot;No&quot;,&quot;Si&quot;]); setRupValue(param) Método utilizado para asignar el valor al componente. Este método es el utilizado porel resto de componentes RUP para estandarizar la asignación del valor al Combo. Parameters: Name Type Description param string | number Valor que se va a asignar al componente. Source: rup.combo.js, line 101 Example $(&quot;#idCombo&quot;).rup_combo(&quot;setRupValue&quot;, &quot;Si&quot;); value() Método que devuelve el valor seleccionado en el combo. En caso de ser el valor vació, o sin selección, el valor devuelto es el asociado al “blank”. En el caso de la selección múltiple se devolverá un array. Source: rup.combo.js, line 242 Returns: Valor del elemento o elementos seleccionados. Type string | Array.&lt;string&gt; Example $(&quot;#idCombo&quot;).rup_combo(&quot;value&quot;); Type Definitions onLoadError(xhr, textStatus, errorThrown) Función a ejecutar en caso de producirse un error a la hora de obtener los elementos a mostrar. Parameters: Name Type Description xhr Object Objeto XHR que contiene la respuesta de la petición realizada. textStatus string Texto que identifica el error producido. errorThrown Object Objeto error que contiene las propiedades del error devuelto en la petición. Source: rup.combo.js, line 1614 onLoadSuccess(self) Función a ejecutar en caso de producirse un error a la hora de obtener los elementos a mostrar. Parameters: Name Type Description self jQuery Referencia al objeto jQuery del propio combo. Source: rup.combo.js, line 1623 × Search results Close "},"jQuery.rup_contextMenu.html":{"id":"jQuery.rup_contextMenu.html","title":"Namespace: rup_contextMenu","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_contextMenu rup_contextMenu Un menú contextual consta de un menú dentro de una interfaz gráfica que se muestra a partir de una interacción del usuario. El menú contextual muestra una serie de opciones disponibles en el contexto o estado actual de la aplicación. Source: rup.contextMenu.js, line 28 Tutorials: Tutorial: rup_contextMenu Example var properties = { items : { &quot;edit&quot;: {name: &quot;Edit&quot;, icon: &quot;edit&quot;}, &quot;cut&quot;: {name: &quot;Cut&quot;, icon: &quot;cut&quot;}, &quot;copy&quot;: {name: &quot;Copy&quot;, icon: &quot;copy&quot;}, &quot;paste&quot;: {name: &quot;Paste&quot;, icon: &quot;paste&quot;}, &quot;delete&quot;: {name: &quot;Delete&quot;, icon: &quot;delete&quot;}, &quot;sep1&quot;: &quot;---------&quot;, &quot;quit&quot;: {name: &quot;Quit&quot;, icon: &quot;quit&quot;} } }; $('#contextMenu').rup_contextMenu(properties); Members options Propiedades de configuración del componente. Properties: Name Type Argument Default Description items object Objeto que define los elementos que van a mostrarse en el menú contextual. En el siguiente apartado se explicará más en detalle como realizar esta definición. appendTo string &lt;optional&gt; Selector de jQuery que identifica el elemento del DOM a partir del cual se va a añadir el menú contextual generado. trigger string &lt;optional&gt; Determina el evento que va a lanzar la visualización del menú contextual. (&quot;right&quot;,&quot;left&quot;, &quot;hover&quot;, &quot;none&quot;). reposition boolean &lt;optional&gt; Determina si un menú debe ser reposicionado (true) o reconstruido (false) en el caso de que el evento que lanza la visualización del menú contextual se ejecute por segunda vez. delay number &lt;optional&gt; 200 Determina el tiempo de retardo antes de mostrar el menú contextual. Solo se aplica sobre el evento “hover”. autoHide boolean &lt;optional&gt; false Indica si el menú contextual debe de ocultarse automáticamente cuando el cursor del ratón abandona la posición del menú contextual y el elemento que lo lanza. zIndex number &lt;optional&gt; 1 Especifica el desplazamiento de zIndex que se aplica al calculado. className string &lt;optional&gt; Nombres de clases adicionales que se van a aplicar al menú contextual. animation object Determina la animación que se va a aplicar a la hora de mostrar/ocultar el menúcontextual. La configuración es la misma que la que utiliza para realizar la de los métodos show y hide de jQuery. events object &lt;optional&gt; Los eventos show y hide se ejecutan antes de el menú se muestre o se oculte. Mediante esta propiedad es posible indicar funciones de callback para ser ejecutadas en estos casos. Permiten devolver false para evitar continuar con el evento. Properties Name Type Description show jQuery.rup_contextMenu~onShowEvent Función a ejecutar antes de que se muestre el menú. hide jQuery.rup_contextMenu~onHideEvent Función a ejecutar antes de que se oculte el menú. position jQuery.rup_contextMenu~position Función de callback que se ejecuta a partir de los eventos indicados en la propiedad trigger. determinePosition string Determina la posición del menú contextual de acuerdo al elemento disparador. callback jQuery.rup_contextMenu~callback &lt;optional&gt; Esta propiedad permite especificar una función de callback por defecto para aquellos ítems que no hayan especificado una función propia. build jQuery.rup_contextMenu~build &lt;optional&gt; Función de callback que devuelve el objeto de configuración del componente. En caso de especificar una función para la propiedad build la creación del menú no se realiza inicialmente sino que se demora hasta que se ejecuta el evento que lo muestra. showCursor boolean &lt;optional&gt; true Determina si se va a modificar el estilo del puntero del ratón al posicionarse sobre el elemento que dispone de menú contextual. El tipo de puntero se determina mediante la clase CSS context-menu-cursor. msieCursorCss string &lt;optional&gt; &quot;url(&quot;+$.rup.RUP+&quot;/basic-theme/cursors/context-menu.cur),default&quot; Esta propiedad se emplea para poder modificar la apariencia del cursor en Internet Explorer al posicionarse sobre un elemento que dispone de un menú contextual. Esto es debido a que el modo en el que hay que realizar la asignación del nuevo cursor no se puede realizar mediante un class Source: rup.contextMenu.js, line 251 Methods destroy() Elimina el menú contextual. Source: rup.contextMenu.js, line 103 Example $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;destroy&quot;); disable() Deshabilita el menú contextual. El menú no se mostrará aunque se lance el evento asociado. Source: rup.contextMenu.js, line 92 Example $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;disable&quot;); enable() Habilita el menú contextual. El menú se mostrará al lanzarse el evento asociado. Source: rup.contextMenu.js, line 81 Example $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;enable&quot;); hide() Oculta el menú contextual. Source: rup.contextMenu.js, line 70 Example $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;hide&quot;); show() Muestra el menú contextual. Source: rup.contextMenu.js, line 59 Example $(&quot;#contextMenu&quot;).rup_contextMenu(&quot;show&quot;); Type Definitions build($trigger, e) Función de callback que devuelve el objeto de configuración del componente. Parameters: Name Type Description $trigger jQuery Referencia jQuery del objeto disparador del callback. e object Objeto event correspondiente al evento que desencadena el callback. Source: rup.contextMenu.js, line 222 Returns: Objeto de configuración del componente. Type object Example $(&quot;.contextMenu-other&quot;).rup_contextMenu({ trigger: 'none', build: function($trigger, e) { return { callback: function(key, options) { alert(&quot;clicked: &quot; + key); }, items: { &quot;edit&quot;: {name: &quot;Edit&quot;, icon: &quot;edit&quot;}, &quot;cut&quot;: {name: &quot;Cut&quot;, icon: &quot;cut&quot;}, &quot;copy&quot;: {name: &quot;Copy&quot;, icon: &quot;copy&quot;}, &quot;paste&quot;: {name: &quot;Paste&quot;, icon: &quot;paste&quot;}, &quot;delete&quot;: {name: &quot;Delete&quot;, icon: &quot;delete&quot;}, &quot;sep1&quot;: &quot;---------&quot;, &quot;quit&quot;: {name: &quot;Quit&quot;, icon: &quot;quit&quot;} } }; } }); callback(key, options) Esta propiedad permite especificar una función de callback por defecto para aquellos ítems que no hayan especificado una función propia. Parameters: Name Type Description key string Key de la opción seleccionada. options number Opciones de configuración con los que se ha inicializado el componente. Source: rup.contextMenu.js, line 210 Example callback: function(key, options) { alert(&quot;clicked: &quot; + key); } onHideEvent(opt) Función de callback a ejecutar cuando se oculta el menú contextual. Parameters: Name Type Description opt object Opciones de configuración. Source: rup.contextMenu.js, line 193 Returns: En caso de devolver false no se termina ocultando el menú. Type boolean onShowEvent(opt) Función de callback a ejecutar cuando se muestra el menú contextual. Parameters: Name Type Description opt object Opciones de configuración. Source: rup.contextMenu.js, line 185 Returns: En caso de devolver false no se termina mostrando el menú. Type boolean position($menu, x, y) Función de callback a ejecutar a partir de los eventos indicados en la propiedad trigger. Parameters: Name Type Description $menu jQuery Referencia jQuery al objeto propio. x number Coordenada x proporcionada por el evento de mostrar el menú. y number Coordenada y proporcionada por el evento de mostrar el menú. Source: rup.contextMenu.js, line 201 × Search results Close "},"jQuery.rup_dav.html":{"id":"jQuery.rup_dav.html","title":"Namespace: rup_dav","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_dav rup_dav Permite al usuario editar online documentos almacenados en el servidor de aplicaciones. Source: rup.dav.js, line 27 Tutorials: Tutorial: rup_dav Example jQuery.rup_dav.editOnline({ url:&quot;webdavServlet/webdav.doc&quot;, xlnetsAuth:true, downloadOnError:true, alternateDownloadURL:&quot;../upload?fileName=webdav.doc&quot; }); Methods editOnline() TODO Source: rup.dav.js, line 48 × Search results Close "},"jQuery.rup_dialog.html":{"id":"jQuery.rup_dialog.html","title":"Namespace: rup_dialog","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_dialog rup_dialog Permite lanzar un subproceso o un mensaje de confirmación dentro de un proceso principal sin salirse de este. Es una evolución del patrón mensaje. Source: rup.dialog.js, line 73 Tutorials: Tutorial: rup_dialog Example var properties = { type: $.rup.dialog.TEXT, autoOpen: true, modal: true, resizable: true, title: &quot;Título del dialog (text) &quot;, message: &quot;Se esta creando un div con el mensaje puesto por parametro.&quot; }; $(&quot;#selector&quot;).rup_dialog(properties); Members options Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description url string &lt;optional&gt; Url de donde se obtendrá el contenido del diálogo. rupCheckStyle boolean &lt;optional&gt; true Propiedad definida por el componentes base, si está a true se mostraran los mensajes específicos del componente base marcados por la guía de estilos, es decir, que si el desarrollador no cumple con la guisa de estilos o desarrollo el objeto base mostrará los mensajes advirtiendo su incumplimiento, si se pone a false no se mostraran. Esta acción queda bajo la responsabilidad de la aplicación, ya que esta propiedad no debería modificarse. type jQuery.rup~dialog Propiedad que establece el tipo de diálogo a mostrar. ajaxOptions jQuery.rup_dialog~ajaxOptions Establece las todas las propiedades para configurar la petición ajax. showLoading boolean &lt;optional&gt; true Esta propiedad mostrará una capa de cargando datos en los diálogos de tipo Ajax durante la carga del mismo. disabled boolean &lt;optional&gt; false Propiedad que deshabilita o no el diálogo. autoOpen boolean &lt;optional&gt; true Si esta propiedad esta a true el diálogo se abrirá automáticamente cuando se cree, en el caso de que su valor sea false, el diálogo se mantendrá oculto hasta que se invoque a la función “open” (.rup_dialog(“open”)). buttons Object &lt;optional&gt; Define los botones (literales y funciones a las que invocan) que contendrá el diálogo. La propiedad sería de tipo Array. Donde cada elemento del array debe ser un objeto que define las propiedades de cada botón y el tipo del mismo. closeOnEscape boolean &lt;optional&gt; true Especifica si se debe cerrar el diálogo cuando el tenga el foco y el usuario pulse la tecla ESC. dialogClass string Porpiedad que establece el/los estilos que se añadirán al dialogo para dotar al dialogo de estilos diferentes. draggable boolean &lt;optional&gt; true Si su valor es true el diáologo sera dragable pinchando sobre el título. height string | number &lt;optional&gt; auto Establece el alto del diálogoen pixeles. hide string &lt;optional&gt; null Efecto utilizado cuando se cierra el diálogo. maxHeight boolean | number &lt;optional&gt; false Alto máximo en pixeles al que se puede llegar a redimensionar el diálogo. maxWidth boolean | number &lt;optional&gt; false Ancho máximo en pixeles al que se puede llegar a redimensionar el diálogo. minHeight boolean | number &lt;optional&gt; 100 Alto mínimo en pixeles al que se puede llegar a redimensionar el diálogo. minWidth boolean | number &lt;optional&gt; 150 Ancho mínimo en pixeles al que se puede llegar a redimensionar el diálogo. modal boolean &lt;optional&gt; false Si se establece esta propiedad a true el diálogo se abrirá de forma modal, por encima del resto de elementos. position string | Array.&lt;string&gt; | Array.&lt;number&gt; Esta propiedad especifica donde debe mostrarse el diálogo. Sus posibles valores son: Un simple String representando la posición. 'center', 'left', 'right', 'top', 'bottom'. Un array con las coordenadas x, y en pixles (e. [350,100]). Un array con string que representan la posición (e. ['right','top']). resizable boolean &lt;optional&gt; true Si se establece esta propiedad a true el diálogo se redimensionable. show string &lt;optional&gt; Efecto a realizar cuando se abre el diálogo. stack boolean &lt;optional&gt; Establece si el diálogo actual se situa por encima del resto de diálogos que existan en la ventana. title string &lt;optional&gt; Establece el título de la ventana. Puede ser cualquier html válido. width number &lt;optional&gt; 300 Establece el ancho del diálogo en pixeles. z-index number &lt;optional&gt; 1000 Establece el zIndex del diálogo. open jQuery.rup_dialog~onOpen Evento que se lanza cuando se abre el diálogo. close jQuery.rup_dialog~onClose Evento que se lanza a la hora de cerrar el diálogo. beforeClose jQuery.rup_dialog~onBeforeClose Evento que se lanza justo antes de que se cierre el dialogo, si este evento devuelve false se anulará las acción de cierre y el dialogo seguirá abierto. Source: rup.dialog.js, line 592 Methods close() Cierra el dialogo. Source: rup.dialog.js, line 192 Example $(&quot;#selector&quot;).rup_dialog(&quot;close&quot;); createBtnLinks(btn, id) Función que crea los botones como enlaces y se los añade al panel de botones al final de los botones. Parameters: Name Type Description btn object Objeto de definición del botón. id object Identificador del diálogo. Source: rup.dialog.js, line 278 Example $(&quot;#selector&quot;).rup_dialog(&quot;createBtnLinks&quot;, btnObj, &quot;idDialog&quot;); destroy() Borra el dialogo si este estubiera oculto o visible. Source: rup.dialog.js, line 141 Example $(&quot;#selector&quot;).rup_dialog(&quot;destroy&quot;); disable() Función que deshabilita el dialogo sobre el que se aplica. Source: rup.dialog.js, line 153 Example $(&quot;#selector&quot;).rup_dialog(&quot;disable&quot;); enable() Funcion que, en caso de estar desahibilitado, habilita el dialogo sobre el que se aplica. Source: rup.dialog.js, line 165 Example $(&quot;#selector&quot;).rup_dialog(&quot;enable&quot;); getOption(opt) Obtiene la propiedad que recibe como parametro. Parameters: Name Type Description opt string Nombre de la propiedad. Source: rup.dialog.js, line 216 Returns: Valor de la propiedad especificada. Type Object Example $(&quot;#selector&quot;).rup_dialog(&quot;getOption&quot;,&quot;width&quot;); isOpen() Función que devuelve si el dialogo esta abierto o no. Source: rup.dialog.js, line 204 Returns: Determina si el diálogo está abierto o no. Type boolean Example $(&quot;#selector&quot;).rup_dialog(&quot;isOpen&quot;); moveToTop() Funcion encargada de poner por encima de todos los dialogos al dialogo sobre el que se aplica. Puede ser muy util se se tiene mas de un dialog abierto a la vez. Source: rup.dialog.js, line 180 Example $(&quot;#selector&quot;).rup_dialog(&quot;moveToTop&quot;); open() Abre el diálogo y estable el foco en el primer botón. Source: rup.dialog.js, line 102 Example $(&quot;#selector&quot;).rup_dialog(&quot;open&quot;); setOption(opt, value) Establece la propiedad que recibe como parametro. Parameters: Name Type Description opt string Nombre de la propiedad. value object Valor de la propiedad a establecer. Source: rup.dialog.js, line 229 Example $(&quot;#selector&quot;).rup_dialog(&quot;setOption&quot;,&quot;width&quot;, 200); Type Definitions ajaxOptions Propiedades de configuración de la petición Ajax. Type: object Source: rup.dialog.js, line 545 See: jQuery Ajax Settings onBeforeClose(event, ui) Evento que se lanza justo antes de que se cierre el dialogo, si este evento devuelve false se anulará las acción de cierre y el dialogo seguirá abierto Parameters: Name Type Description event Event Fecha seleccionada ui object Objeto de jQueryUI correspondiente a la interfaz del diálogo. Source: rup.dialog.js, line 578 See: jQueryUI Dialog Returns: Si devuelve false se anulará las acción de cierre y el dialogo seguirá abierto. Type boolean Example $(&quot;#idDialog&quot;).rup_dialog({ onBeforeClose: function(event, ui) { ... } }); onClose(event, ui) Evento que se lanza a la hora de cerrar el diálogo. Parameters: Name Type Description event Event Fecha seleccionada ui object Objeto de jQueryUI correspondiente a la interfaz del diálogo. Source: rup.dialog.js, line 565 See: jQueryUI Dialog Example $(&quot;#idDialog&quot;).rup_dialog({ close: function(event, ui) { ... } }); onOpen(event, ui) Evento que se lanza cuando se abre el diálogo. Parameters: Name Type Description event Event Fecha seleccionada ui object Objeto de jQueryUI correspondiente a la interfaz del diálogo. Source: rup.dialog.js, line 552 See: jQueryUI Dialog Example $(&quot;#idDialog&quot;).rup_dialog({ open: function(event, ui) { ... } }); × Search results Close "},"jQuery.rup_form.html":{"id":"jQuery.rup_form.html","title":"Namespace: rup_form","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_form rup_form Permite al usuario introducir datos en una serie de campos para ser enviados al servidor y ser procesados. Source: rup.form.js, line 33 Tutorials: Tutorial: rup.form Example var properties={ // Propiedades de configuración }; $(&quot;#formulario&quot;).rup_form(properties); Members options Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description beforeSerialize jQuery.rup_form~beforeSerialize &lt;optional&gt; null Función de callback que será invocada antes de realizarse la serialización del formulario. Permite la modificación de los datos del formulario antes de que estos sean recuperados para su procesado por el componente. beforeSubmit jQuery.rup_form~beforeSubmit &lt;optional&gt; null Función de callback que será invocada antes de realizarse el envío del formulario. Permite acceder a la información que será enviada al formulario. En caso de retornar false no se realizará en envío. clearForm boolean &lt;optional&gt; null Propiedad booleana que determina si el formulario debe de limpiarse después de realizar el envío. data object &lt;optional&gt; Mediante esta propiedad es posible especificar parámetros extra que sean enviados alservidor. dataType string &lt;optional&gt; Tipo de datos esperados en la respuesta. Los valores posibles son null, xml, json y script. error jQuery.rup_form~error &lt;optional&gt; Función de callback que será invocada cuando se produzca un error. forceSync boolean &lt;optional&gt; false Propiedad booleana. En caso de ser true elimina la corta espera que se produce antes de enviar el formulario cuando se envían ficheros o se utiliza la opción de iframe. La espera se utiliza para permitir al navegador actualizar modificaciones realizadas en el DOM antes de que se realice elenvío de los datos. iframe boolean &lt;optional&gt; false Determina si el formulario debe de ser enviado siempre mediante un iframe. iframeSrc string &lt;optional&gt; Propiedad de texto que deberá ser utlizada siempre en conjunción con la propiedad iframe. Por defecto, about:blank. Por defecto para páginas que utlicen el protocolo https, javascript:false. iframeTarget string &lt;optional&gt; null Identifica el iframe que será utilizado como target en la respuesta en los envíos de ficheros. Por defecto, el componente creará un iframe temporal para capturar la respuesta del envío de ficheros. multimodel boolean | object &lt;optional&gt; false Permite especificar la configuración que se deberá de aplicar a la hora de realizar el envío de varias entidades en la misma petición. La configuración de este parámetro se detalla en el apartado 9.2. replaceTarget boolean &lt;optional&gt; false Opcionalmente se utililiza junto con la opción target. En caso de ser true el elemento identificado en la opción target será reemplazado. En caso de ser false solo su contenido será reemplazado. resetForm boolean &lt;optional&gt; false Propiedad booleana que determina si el formulario debe ser inicializado al realizarse el envío del mismo. semantic bolean &lt;optional&gt; false Propiedad booleana que determina si los campos del formulario deben ser enviado en estricto orden semántico. Por defecto la serialización normal del formulario se realiza en orden semántico exceptuando los campos img. suceess jQuery.rup_form~suceess &lt;optional&gt; Método callback que será invocado cuando se reciba la respuesta del formulario. target string | jQuery | Element &lt;optional&gt; Identifica los elementos de la página que deberán ser actualizados con la respuesta del servidor. El target puede ser indicado mediante un selector de jQuery, un objeto de jQuery o un objeto DOM. type string &lt;optional&gt; Detemina el método con el que se enviará el formulario, GET o POST. Por defecto el valor de la propiedad method indicada en el formulario o GET en caso de no encontrarse. uploadProgress jQuery.rup_form~uploadProgress &lt;optional&gt; null Método que será invocado con información de progreso del envío del formulario (en caso de estar soportado por el navegador). url string &lt;optional&gt; URL a la cual se realizará en envío del formulario. Por defecto el valor indicado en la propiedad action del formulario. useJsonIfPossible boolean &lt;optional&gt; true Mediante este parámetro se especifica al componente que debe de utilizar el formato application/json como prioridad (siempre que sea posible) al realizar el envío del formulario. Source: rup.form.js, line 484 Methods ajaxFormSubmit(options) Realiza la misma función que ajaxSubmit. Se mantiene para asegurar la retrocompatibilidad con versiones anteriores. Parameters: Name Type Description options object Opciones de configuración. Source: rup.form.js, line 57 Example var options = {}; jQuery(&quot;#form&quot;).rup_form(&quot;ajaxFormSubmit&quot;, options); ajaxSubmit(argOptions) Realiza el envío del formulario. La configuración de este método es la misma que la de ajaxForm. Parameters: Name Type Description argOptions object Opciones de configuración. Source: rup.form.js, line 73 Example var options = {}; jQuery(&quot;#form&quot;).rup_form(&quot;ajaxSubmit&quot;, options); clearFields(includeHidden) Limpia los campos especificados mediante el selector de jQuery. Parameters: Name Type Description includeHidden boolean Determina si se deben de limpiar también los elementos hidden que existen en el formulario. Source: rup.form.js, line 237 Returns: Retorna el propio componente. Type jQuery Example // Limpiar los campos del formulario jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;clearFields&quot;); // Limpiar los campos del formulario inlcuyendo los campos hidden jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;clearFields&quot;, true); clearForm(includeHidden) Limpia los elementos del formulario. Parameters: Name Type Description includeHidden boolean Determina si se deben de limpiar también los elementos hidden que existen en el formulario. Source: rup.form.js, line 219 Returns: Retorna el propio componente. Type jQuery Example // Limpiar los campos del formulario jQuery(&quot;#form&quot;).rup_form(&quot;clearForm&quot;); // Limpiar los campos del formulario inlcuyendo los campos hidden jQuery(&quot;#form&quot;).rup_form(&quot;clearForm&quot;, true); configureOptions(settings) Función de inicialización del componente. Es un método de uso interno. No debería de invocarse de manera directa. Parameters: Name Type Description settings object Propiedades de configuración Source: rup.form.js, line 261 destroy() Elimina la configuración realizada por el componente sobre el formulario html. Source: rup.form.js, line 99 Example var options = {}; jQuery(&quot;#form&quot;).rup_form(&quot;destroy&quot;); fieldSerialize() Realiza la serialización de campos del formulario en un query string Source: rup.form.js, line 153 Returns: Retorna una cadena de texto con el formato nombre1=valor1&amp;nombre2=valor2. Type string Example jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;fieldSerialize&quot;); fieldSerialize() Devuelve un array con el valor de los campos indicados. Source: rup.form.js, line 181 Returns: Retorna una cadena de texto con el formato nombre1=valor1&amp;nombre2=valor2. Type Array.&lt;string&gt; Example jQuery(&quot;#form .specialFields&quot;).rup_form(&quot;fieldValue&quot;); formSerialize() Serializa el contenido del formulario en un query string. Source: rup.form.js, line 114 Returns: Retorna una cadena de texto con el formato nombre1=valor1&amp;nombre2=valor2. Type string Example jQuery(&quot;#form&quot;).rup_form(&quot;formSerialize&quot;); formToJson() Realiza la serialización de campos del formulario en un objeto json. Source: rup.form.js, line 141 Returns: Retorna un objeto con el formato {nombre1:valor1, nombre2:valor2…nombreN:valorN}. Type string Example jQuery(&quot;#form&quot;).rup_form(&quot;formToJson&quot;); resetForm() Inicializa el formulario con su estado inicial invocando al método reset nativo. Source: rup.form.js, line 205 Returns: Retorna el propio componente. Type jQuery Example jQuery(&quot;#form&quot;).rup_form(&quot;resetForm&quot;); Type Definitions beforeSerialize($form, options) Función de callback que será invocada antes de realizarse la serialización del formulario. Parameters: Name Type Description $form jQuery Referencia del objeto jQuery del formulario. options object Opciones de configuración con las que se ha inicializado el componente. Source: rup.form.js, line 419 Returns: En caso de devolver false se cancela el envío del formulario. Type boolean Example $(&quot;#form&quot;).rup_form({ beforeSerialize: function($form, options) { ... } }); beforeSubmit(arr, $form, options) Función de callback que será invocada antes de realizarse el envío del formulario. Parameters: Name Type Description arr Array.&lt;object&gt; Array que contiene la información introducida en el formulario. El array tiene el siguiente formato : [ { name: 'username', value: 'jresig' }, { name: 'password', value: 'secret' } ] $form jQuery Referencia del objeto jQuery del formulario. options object Opciones de configuración con las que se ha inicializado el componente. Source: rup.form.js, line 432 Returns: En caso de devolver false se cancela el envío del formulario. Type boolean Example $(&quot;#form&quot;).rup_form({ beforeSubmit: function(arr, $form, options) { ... } }); error() Función de callback que será invocada cuando se produzca un error. Source: rup.form.js, line 446 Example $(&quot;#form&quot;).rup_form({ error: function() { ... } }); suceess(responseText, statusText, xhr, $form) Función de callback que será invocado cuando se reciba la respuesta del formulario. Parameters: Name Type Description responseText string Texto identificador de la respuesta obtenida. statusText string Código de respuesta http. xhr object Objeto xhr con la respuesta enviada del servidor. $form jQuery Referencia jQuery al componente formulario. Source: rup.form.js, line 456 Example $(&quot;#form&quot;).rup_form({ suceess: function(responseText, statusText, xhr, $form) { ... } }); uploadProgress(event, position, total, percentComplete) Función de callback que será invocado cuando se reciba la respuesta del formulario. Parameters: Name Type Description event Event Objeto Event procedente del navegador. position Integer Numero que determina el contenido enviado. total Integer Numero que identifica el total del contenido a enviar. percentComplete Integer Numero que identifica el porcentaje actual completado en el proceso de envío. Source: rup.form.js, line 470 Example $(&quot;#form&quot;).rup_form({ uploadProgress: function(event, position, total, percentComplete) { ... } }); × Search results Close "},"jQuery.rup_language.html":{"id":"jQuery.rup_language.html","title":"Namespace: rup_language","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_language rup_language El componente de idioma esta diseñado para permitir al usuario elegir, de forma intuitiva, el idioma en el que se presenta la aplicación. Source: rup.lang.js, line 51 Tutorials: Tutorial: rup.language Example var properties={ // Propiedades de configuración }; $(&quot;#idlanguage&quot;).rup_language(properties); Members options Opciones por defecto de configuración del componente. Properties: Name Type Argument Description languages object Conjunto de idiomas que serán gestionados con el componente. El listado de los mismos, por configuración general, se gestiona a través de la variable jQuery “$.rup.AVAILABLE_LANGS_ARRAY”. Para mas información, consultar el documento “Anexo-Gestion_idiomatica.doc” de la documentación de UDA. modo string &lt;optional&gt; Determina el tipo de maquetación que utilizara el componente para presentar las diferentes opciones idiomáticas. Si el valor especificado es “portal”, los idiomas se presentaran en un listado horizontal separado por barras (ver ejemplo visual del capítulo/Sección “2. Ejemplo”). En cualquier otro caso, se mostrara el modo por defecto (ver ejemplo visual del capítulo/Sección “2. Ejemplo”). Source: rup.lang.js, line 247 Methods destroy() Elimina el componente. Source: rup.lang.js, line 234 Example $(&quot;#idlanguage&quot;).rup_language(&quot;destroy&quot;); × Search results Close "},"jQuery.rup_messages.html":{"id":"jQuery.rup_messages.html","title":"Namespace: rup_messages","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_messages rup_messages Tiene como objetivo mostrar al usuario de forma homogénea, clara y llamativa, los posibles mensajes que pueden desencadenar las acciones en la aplicación. Estos mensajes predefinidos pueden ser de diferente tipología: error, confirmación, aviso o alerta. Source: rup.message.js, line 27 Tutorials: Tutorial: rup_messages Example $.rup_messages(&quot;msgOK&quot;, { title: &quot;Correcto&quot;, message: &quot;Todo ha ido OK.&quot; }); Members defaults Opciones por defecto de configuración del componente. Properties: Name Type Argument Default Description minHeight Number &lt;optional&gt; 100 Altura mínima con la que se va a mostrar el mensaje. Source: rup.message.js, line 420 Methods msgAlert(properties) Muestra un mensaje de alerta. Parameters: Name Type Description properties Object Objeto de configuración del mensaje de alerta. Properties Name Type Description title String Texto que aparecerá en la barra del titulo del mensaje. message String El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. beforeClose jQuery.rup_messages~beforeCloseCallback Función a ejecutar justo antes de que se cierre la ventana. Source: rup.message.js, line 230 Example // Mostrar un mensaje de aviso. $.rup_messages(&quot;msgAlert&quot;, { title: &quot;Alerta&quot;, message: &quot;Esto es una alerta.&quot; }); msgConfirm(properties) Muestra un mensaje de confirmación. Parameters: Name Type Description properties Object Objeto de configuración del mensaje de error. Properties Name Type Description title String Texto que aparecerá en la barra del titulo del mensaje. message String El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. beforeClose jQuery.rup_messages~beforeCloseCallback Función a ejecutar justo antes de que se cierre la ventana. OKFunction jQuery.rup_messages~OKFunctionCallback Función a ejecutar cuando el usuario pulsa el botón de Aceptar. CANCELFunction jQuery.rup_messages~CANCELFunctionCallback Función a ejecutar cuando el usuario pulsa el enlace de Cancelar. Source: rup.message.js, line 124 Example // funciones de callback. function acceptClicked() { alert(&quot;Ha pulsado aceptar.&quot;); } function cancelClicked() { alert(&quot;Ha pulsado cancelar.&quot;); } // Mostrar un mensaje de error. $.rup_messages(&quot;msgConfirm&quot;, { title: &quot;Confirmación&quot;, message: &quot;¿Está seguro que desea cancelar?&quot;, OKFunction : acceptClicked, CANCELFunction : cancelClicked }); msgError(properties) Muestra un mensaje de error. Parameters: Name Type Description properties Object Objeto de configuración del mensaje de error. Properties Name Type Description title String Función a ejecutar justo antes de que se cierre la ventana. message String El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. beforeClose jQuery.rup_messages~beforeCloseCallback Texto que aparecerá en la barra del titulo del mensaje. Source: rup.message.js, line 77 Example // Mostrar un mensaje de error. $.rup_messages(&quot;msgError&quot;, { title: &quot;Error grave&quot;, message: &quot;&lt;p&gt;Se ha producido un error a la hora de intentar guardar el registro.&lt;br&gt;Consulte con el administrador.&lt;/p&gt;&quot; }); msgOK(properties) Muestra un mensaje de aviso. Parameters: Name Type Description properties Object Objeto de configuración del mensaje de aviso. Properties Name Type Description title String Texto que aparecerá en la barra del titulo del mensaje. message String El mensaje de error que se quiere mostrar. Dicho mensaje se situará a la derecha de la imagen de error. El mensaje puede ser texto plano o contener etiquetas HTML que se reflejarán en el mismo. beforeClose jQuery.rup_messages~beforeCloseCallback Función a ejecutar justo antes de que se cierre la ventana. Source: rup.message.js, line 184 Example // Mostrar un mensaje de aviso. $.rup_messages(&quot;msgOK&quot;, { title: &quot;Correcto&quot;, message: &quot;Todo ha ido OK.&quot; }); Type Definitions beforeCloseCallback(event) Función a ejecutar justo antes de que se cierre la ventana. Parameters: Name Type Description event Object Objeto Event de jQuery. Source: rup.message.js, line 53 CANCELFunctionCallback(event, ui) Función a ejecutar cuando el usuario pulsa el enlace de Cancelar. Parameters: Name Type Description event Object Objeto Event de jQuery. ui Object Objeto de tipo jQueryUi Dialog Source: rup.message.js, line 68 OKFunctionCallback(event, ui) Función a ejecutar cuando el usuario pulsa el botón de Aceptar. Parameters: Name Type Description event Object Objeto Event de jQuery. ui Object Objeto de tipo jQueryUi Dialog. Source: rup.message.js, line 60 × Search results Close "},"jQuery.rup_report.html":{"id":"jQuery.rup_report.html","title":"Namespace: rup_report","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_report rup_report El objetivo principal del componente es mejorar la experiencia del usuario a la hora de generar informes mediante la presentación de diálogos de espera. Source: rup.report.js, line 28 Tutorials: Tutorial: rup.report Example var properties={ // Propiedades de configuración }; $.rup_report(properties); Members options Opciones por defecto de configuración del componente. Source: rup.report.js, line 378 × Search results Close "},"jQuery.rup_table.html":{"id":"jQuery.rup_table.html","title":"Namespace: rup_table","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_table rup_table Se les presenta a los usuarios los datos tabulados para que la información se visualice de manera ágil y rápida, facilitando así su comprensión y manejo. Además, el componente implementa un nuevo patrón definido para facilitar la lógica necesaria en las acciones básicas, denominadas CRUD (create, read, update y delete), sobre una tabla. Source: rup_table/rup.table.core.js, line 28 Example var properties = { url: &quot;../tableUrl&quot;, colNames: [ &quot;id&quot;,&quot;nombre&quot;,&quot;...&quot;] ], colModel: [ {name: &quot;id&quot;, label: &quot;id&quot;}, {name: &quot;nombre&quot;, label: &quot;nombre&quot;}, {name: &quot;...&quot;, label: &quot;...&quot;} ], model:&quot;Usuario&quot;, usePlugins:[ &quot;formEdit&quot;, &quot;feedback&quot;, &quot;toolbar&quot;, &quot;contextMenu&quot;, &quot;fluid&quot;, &quot;filter&quot;, &quot;search&quot; ], primaryKey: &quot;id&quot; }; $(&quot;#table&quot;).rup_table(properties); Members options Propiedades de configuración del componente. Properties: Name Type Argument Default Description altRows boolean &lt;optional&gt; true Determina si se aplica o no el pijama en las filas de la tabla. altclass string &lt;optional&gt; rupgrid_oddRow Estilo que se aplica a las filas impares para mostrar el efecto. datatype string &lt;optional&gt; json Formato de dato esperado para representar los registros de la tabla. height string &lt;optional&gt; auto Determina la altura de la tabla. jsonReader object &lt;optional&gt; {repeatitems: false} Parámetros de configuración que determinan el modo en el que se va a procesar el json de retorno del servidor resizable boolean &lt;optional&gt; false Determina si la tabla puede ser redimensionada mediante el ratón. rowNum number &lt;optional&gt; 10 Número de registros por página que se van a mostrar en la tabla. rowList Array.&lt;number&gt; &lt;optional&gt; [10,20,30] Lista de posibles valores para el número de elementos por página que se van a mostrar en el combo de selección correspondiente. sortable boolean &lt;optional&gt; true Determina si se permite variar el orden de las columnas arrastrándolas. viewrecords boolean &lt;optional&gt; true Indica si se debe mostrar el rango de elementos que se están visualizando en la tabla. loadOnStartUp boolean &lt;optional&gt; true Determina si se debe realizar automáticamente la búsqueda al cargar la página. multiplePkToken string &lt;optional&gt; ~ Separador que se utiliza en los casos en los que la clave primaria sea múltiple. Se creará una columna que contenga un identificador único resultante de la concatenación de las claves primarias realizada mediante el separador aquí indicado. operations jQuery.rup_table~Operations &lt;optional&gt; Mediante esta propiedad se definen las posibles operaciones a realizar sobre los registros mostrados en la tabla. Debido al carácter global de estas operaciones se toman en cuenta por otros componentes (toolbar, menú contextual) a la hora de mostrar sus controles. Las operaciones se definen mediante un objeto json en el cual el nombre de la propiedad será el identificador de la propiedad. showOperations jQuery.rup_table~ShowOperations &lt;optional&gt; Permite habilitar/deshabilitar las operaciones definidas por defecto por otros módulos. startOnPage number &lt;optional&gt; 1 Permite especificar el número de página inicial que se mostrará al cargar la página. Source: rup_table/rup.table.core.js, line 1500 See: Para mas información consulte la documentación acerca de las opciones de configuración del componente jqGrid. Methods addRowData(rowid, data, position, srcrowid) Añade una nueva línea a la tabla. Esta operación no realiza una inserción del registro en el sistema de persistencia, sino que únicamente añade una nueva fila de modo visual. Parameters: Name Type Description rowid string Identificador del registro. data object Objeto json que contiene los valores de cada columna de la nueva línea. position string fisrt o last. Determina la posición donde se va a insertar el registro. srcrowid string En el caso de indicarse se insertará la nueva línea en la posición relativa al registro que identifica y el valor del parámetro position. Source: rup_table/rup.table.core.js, line 1231 Returns: Referencia al propio componente. Type jQuery Example $(&quot;#idComponente&quot;).rup_table(&quot;addRowData&quot;, &quot;10&quot;, {campo1:valor1,campo2:valor2}); clearGridData(clearfooter) Limpia los registros mostrados en la tabla. Parameters: Name Type Description clearfooter boolean En caso de indicarse como true se elimina la información del pié de la tabla. Source: rup_table/rup.table.core.js, line 1358 Example $(&quot;#idComponente&quot;).rup_table(&quot;clearGridData&quot;, false); configurePager(settings) Realiza la configuración interna del paginador de acuerdo a los parámetros de configuración indicados en la inicialización del componente. Parameters: Name Type Description settings object Parámetros de configuración del componente. Source: rup_table/rup.table.core.js, line 1021 Example $(&quot;#idComponente&quot;).rup_table(&quot;configurePager&quot;, settings); delRowData(rowid) Elimina de la tabla un registro determinado. El registro no se elimina del sistema de persistencia. Solo se elimina de manera visual. Parameters: Name Type Description rowid string Identificador del registro. Source: rup_table/rup.table.core.js, line 1262 Returns: Referencia al propio componente. Type jQuery Example $(&quot;#idComponente&quot;).rup_table(&quot;delRowData&quot;,&quot;10&quot;); getActiveLineId() Devuelve el índice de la línea activa. Source: rup_table/rup.table.core.js, line 1293 Returns: Índice de la línea activa. Type string Example $(&quot;#idComponente&quot;).rup_table(&quot;getActiveLineId&quot;); getActiveRowId() Devuelve el identificador de la línea activa. Source: rup_table/rup.table.core.js, line 1279 Returns: Identificador de la línea activa. Type string Example $(&quot;#idComponente&quot;).rup_table(&quot;getActiveRowId&quot;); getCol(rowid, colName) Devuelve el valor de la columna de la fila indicada. Parameters: Name Type Description rowid string Identificador de la fila. colName string Nombre de la columna. Source: rup_table/rup.table.core.js, line 1384 Example $(&quot;#idComponente&quot;).rup_table(&quot;getCol&quot;, &quot;10&quot;, &quot;nombre&quot;); getColModel() Devuelve el objeto colModel del componente jqGrid. Source: rup_table/rup.table.core.js, line 1371 Returns: Objeto colModel de la tabla. Type object Example $(&quot;#idComponente&quot;).rup_table(&quot;getColModel&quot;); getColModel() Devuelve la propiedad colModel del jqGrid. Source: rup_table/rup.table.core.js, line 682 Returns: Propiedad colModel del jqGrid. Type object Example $(&quot;#idComponente&quot;).rup_table(&quot;getColModel&quot;); getDataIDs() Devuelve un array con los identificadores de los registros que se muestran actualmente en la página de la tabla. Source: rup_table/rup.table.core.js, line 1345 Returns: Identificadores de lso registros mostrados en la página actual. Type Array.&lt;string&gt; Example $(&quot;#idComponente&quot;).rup_table(&quot;getDataIDs&quot;); getGridParam(pName) Devuelve el valor del parámetro del grid especificado. Parameters: Name Type Description pName string Nombre del parámetro que se desea obtener. Source: rup_table/rup.table.core.js, line 694 Returns: Valor del parámetro. Type object Example $(&quot;#idComponente&quot;).rup_table(&quot;getGridParam&quot;,&quot;nombreParametro&quot;); getGridParam(options) Permite redimensionar la tabla de acuerdo a los parámetros indicados. Parameters: Name Type Description options object Parámetros para configurar la altura y anchura del redimensionado. Source: rup_table/rup.table.core.js, line 707 Returns: Referencia al propio componente. Type jQuery Example $(&quot;#idComponente&quot;).rup_table(&quot;gridResize&quot;,{}); getPkUrl(rowId) El objetivo de este método es construir una URL mediante la cual se pueda realizar una petición para obtener los datos de un registro concreto.La URL se genera concatenando los valores de las propiedades que forman la primary key del resgistro a la url base especificada en los settings de inicialización. Parameters: Name Type Description rowId string Identificador del registro. Source: rup_table/rup.table.core.js, line 748 Returns: Url para obtener los valores del registro correspondiente. Type string Example $(&quot;#idComponente&quot;).rup_table(&quot;getPkUrl&quot;,&quot;0001&quot;); getRowData(rowid) Devuelve un objeto json con los valores de los campos del registro indicado. Parameters: Name Type Description rowid string Identificador del registro del que se quieren recuperar los datos. Source: rup_table/rup.table.core.js, line 1331 Returns: Objecto json con los valores del registro. Type object Example $(&quot;#idComponente&quot;).rup_table(&quot;getRowData&quot;, &quot;10&quot;); getSelectedLines() Devuelve un array con los índices de las líneas de los registros seleccionados. Source: rup_table/rup.table.core.js, line 734 Returns: Array con los índices de las líneas de los registros seleccionados. Type Array.&lt;number&gt; Example $(&quot;#idComponente&quot;).rup_table(&quot;getSelectedLines&quot;); getSelectedRows() Devuelve un array con los identificadores de los registros seleccionados. Source: rup_table/rup.table.core.js, line 720 Returns: Array con los identificadores de los registros seleccionados. Type Array.&lt;string&gt; Example $(&quot;#idComponente&quot;).rup_table(&quot;getSelectedRows&quot;); getSerializedForm(form, skipEmpty) Devuelve un objeto json que contiene la serialización del formulario. Parameters: Name Type Description form jQuery Formulario que se desea serializar. skipEmpty boolean En caso de indicarse true se omiten los campos que no contienen valor. Source: rup_table/rup.table.core.js, line 1398 Example $(&quot;#idComponente&quot;).rup_table(&quot;getSerializedForm&quot;, $(&quot;#idFormulario&quot;), false); highlightRowAsSelected($row) Resalta la línea especificada de la tabla. Parameters: Name Type Description $row jQuery Objeto jQuery que referencia a la línea de la tabla. Source: rup_table/rup.table.core.js, line 937 Fires: jQuery.rup_table#event:rupTableHighlightRowAsSelected Example $(&quot;#idComponente&quot;).rup_table(&quot;highlightRowAsSelected&quot;, $(&quot;#idFila&quot;)); postConfigureCore(settings) Metodo que realiza la post-configuración del core del componente RUP Table.Este método se ejecuta antes de la post-configuración de los plugins y después de la invocación al componente jqGrid. Parameters: Name Type Description settings object Parámetros de configuración del componente. Source: rup_table/rup.table.core.js, line 601 preConfigureCore(settings) Metodo que realiza la pre-configuración del core del componente RUP Table.Este método se ejecuta antes de la pre-configuración de los plugins y de la invocación al componente jqGrid. Parameters: Name Type Description settings object Parámetros de configuración del componente. Source: rup_table/rup.table.core.js, line 244 Fires: jQuery.rup_table#event:rupTable_checkOutOfGrid jQuery.rup_table#event:rupTable_serializeGridData jQuery.rup_table#event:rupTable_beforeProcessing reloadGrid(async) Lanza la recarga de la tabla. Parameters: Name Type Description async boolean Indica si la llamada debe ser asíncrona o síncrona. Source: rup_table/rup.table.core.js, line 769 Example $(&quot;#idComponente&quot;).rup_table(&quot;reloadGrid&quot;, true); resetForm($form) Resetea el formulario indicado. Parameters: Name Type Description $form jQuery Objeto jQuery que referencia el formulario que se desea resetear. Source: rup_table/rup.table.core.js, line 793 Returns: Referencia al propio objeto. Type jQuery Example $(&quot;#idComponente&quot;).rup_table(&quot;resetForm&quot;, $(&quot;#idFormulario&quot;)); rupTableClearHighlightedRowAsSelected($row) Elimina el resaltado de la línea especificada de la tabla. Parameters: Name Type Description $row jQuery Objeto jQuery que referencia a la línea de la tabla. Source: rup_table/rup.table.core.js, line 912 Fires: jQuery.rup_table#event:rupTableClearHighlightedRowAsSelected Example $(&quot;#idComponente&quot;).rup_table(&quot;clearHighlightedRowAsSelected&quot;, $(&quot;#idFila&quot;)); setGridParam(newParams) Asigna a uno o varios parámetros del grid los valores indicados. Parameters: Name Type Description newParams object Objeto que contiene los parámetros y sus valores. Source: rup_table/rup.table.core.js, line 841 Returns: Referencia al propio objeto. Type jQuery Example $(&quot;#idComponente&quot;).rup_table(&quot;setGridParam&quot;, {param1:value1, param2:value2}); setRowData(rowid, data, cssp) Actualiza los valores de las columnas de un registro determinado. La actualización de loa datos se realiza solo de manera visual. Los nuevos datos no se persisten. Parameters: Name Type Description rowid string Identificador del registro que se desea actualizar. data object Objeto json que contiene los valores de cada columna de la nueva línea. cssp string En caso de especificarse, se añadirán a la línea las class de estilos aquí indicadas. Source: rup_table/rup.table.core.js, line 1307 Example $(&quot;#idComponente&quot;).rup_table(&quot;setRowData&quot;, &quot;10&quot;, {campo1:valor1,campo2:valor2}); setSelection(selectedRows, status) Selecciona o deselecciona los registros indicados. Parameters: Name Type Description selectedRows string | Array.&lt;string&gt; Identificador o array de identificadores de los registros que se desea seleccionar o deseleccionar. status boolean En caso de ser true se seleccionarán los registros indicados. En caso de ser false se deseleccionarán. Source: rup_table/rup.table.core.js, line 855 Example $(&quot;#idComponente&quot;).rup_table(&quot;setSelection&quot;, [&quot;3&quot;,&quot;7&quot;], true); showServerValidationFieldErrors($form, errors) Muestra en los campos del formulario los errores de validación indicados. Parameters: Name Type Description $form jQuery Objeto jQuery que referencia el formulario que se desea resetear. errors object Objeto json que contiene los errores de validación que se han dado para cada campo. Source: rup_table/rup.table.core.js, line 874 Example $(&quot;#idComponente&quot;).rup_table(&quot;showServerValidationFieldErrors &quot;, $(&quot;#idFormulario&quot;), {}); updateDetailPagination(currentRowNumArg, totalRowNumArg) Actualiza el valor de los datos que se muestran en la barra de paginación. Parameters: Name Type Description currentRowNumArg string Número actual de los registros que se están mostrando. totalRowNumArg string Número total de los registros que se muestran en la tabla. Source: rup_table/rup.table.core.js, line 963 Example $(&quot;#idComponente&quot;).rup_table(&quot;updateDetailPagination&quot;, &quot;1-10&quot;, &quot;586&quot; ); updateSavedData(arg) Permite modificar el objeto interno _savedData que se utiliza en el control de cambios en el modo de edición en formulario y edición en línea. Parameters: Name Type Description arg jQuery.rup_table~onUpdateSavedData Función de callback desde la que se puede modificar el objeto _savedData. Source: rup_table/rup.table.core.js, line 1000 Example $(&quot;#idComponente&quot;).rup_table(&quot;updateSavedData&quot;, function(savedData){ }); Type Definitions isEnabled() Función de callback que determina si la operación debe estar habilitada o no. Source: rup_table/rup.table.core.js, line 1441 Returns: Devuelve si la operación debe de estar habilitada o no. Type boolean Example enabled: function(){ return true; } onOperation(key, options) Función de callback que será ejecutada cuando el usuario realice una acción sobre la operación. Parameters: Name Type Description key string Identificador de la operación options object Opciones de configuración de la operación. Source: rup_table/rup.table.core.js, line 1429 Example callback: function(key, options){ alert(&quot;Operación 1&quot;); } Operations Mediante esta propiedad se definen las posibles operaciones a realizar sobre los registros mostrados en la tabla. Debido al carácter global de estas operaciones se toman en cuenta por otros componentes (toolbar, menú contextual) a la hora de mostrar sus controles. Las operaciones se definen mediante un objeto json en el cual el nombre de la propiedad será el identificador de la propiedad. Type: Object Properties: Name Type Argument Description name string &lt;optional&gt; Texto a mostrar al usuario a la hora de visualizar la operación. icon string &lt;optional&gt; Clase CSS correspondiente al icono que se quiere visualizar junto a la operación. enabled jQuery.rup_table~isEnabled &lt;optional&gt; Función que determina si el botón se debe mostrar habilitado o deshabilitado. Esto se determina devolviendo true/false desde la función de callback aquí indicada. callback jQuery.rup_table~onOperation &lt;optional&gt; Función de callback que será ejecutada cuando el usuario realice una acción sobre la operación. Source: rup_table/rup.table.core.js, line 1452 Example core:{ operations:{ &quot;operacion1&quot;: { name: &quot;Operación 1&quot;, icon: &quot;rup-icon rup-icon-new&quot;, enabled: function(){ return true; }, callback: function(key, options){ alert(&quot;Operación 1&quot;); } }, &quot;operacion2&quot;: { name: &quot;Operación 2&quot;, icon: &quot;rup-icon rup-icon-new&quot;, enabled: function(){ return true; }, callback: function(key, options){ alert(&quot;Operación 1&quot;); } } } } ShowOperations Permite habilitar/deshabilitar las operaciones definidas por defecto por otros módulos. Source: rup_table/rup.table.core.js, line 1487 Example core:{ showOperations:{ add:false; clone:false; } } Events rupTable_beforeProcessing Evento que se lanza antes de que se procese la información recibida del servidor. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Información recibida del servidor. st string Mensaje de status de la petición. xhr object Objeto xhr recibido. Source: rup_table/rup.table.core.js, line 1595 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_beforeProcessing&quot;, function(event, data, st, xhr){ }); rupTable_checkOutOfGrid Evento que se produce al detectarse que el usuario interactua con un elemento externo a la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. $originalTarget jQuery Objeto jQuery que referencia el elemento del dom con el que ha interactuado el usuario. Source: rup_table/rup.table.core.js, line 1573 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_checkOutOfGrid&quot;, function(event, $originalTarget){ }); rupTable_coreConfigFinished Evento que se lanza después de que el componente haya finalizado con el proceso de configuración e inicialización. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup_table/rup.table.core.js, line 1628 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_coreConfigFinished&quot;, function(event, $row){ }); rupTable_serializeGridData Este evento se lanza durante el proceso de serialización de la información que va a ser enviada para obtener los registros que se van a mostrar en la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Información serializada que va a ser enviada. Se puede modificar o agregar nuevos campos para completarla. Source: rup_table/rup.table.core.js, line 1584 Example $(&quot;#idComponente&quot;).on(&quot;rupTable_serializeGridData&quot;, function(event, data){ }); rupTableClearHighlightedRowAsSelected Se produce cuando se elimina el resaltado de un registro de la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. $row jQuery Objeto jQuery que identifica la línea que se ha procesado. Source: rup_table/rup.table.core.js, line 1608 Example $(&quot;#idComponente&quot;).on(&quot;rupTableClearHighlightedRowAsSelected&quot;, function(event, $row){ }); rupTableHighlightRowAsSelected Se produce cuando se añade el resaltado a un registro de la tabla. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. $row jQuery Objeto jQuery que identifica la línea que se ha procesado. Source: rup_table/rup.table.core.js, line 1618 Example $(&quot;#idComponente&quot;).on(&quot;rupTableHighlightedRowAsSelected&quot;, function(event, $row){ }); × Search results Close "},"jQuery.rup_tooltip.html":{"id":"jQuery.rup_tooltip.html","title":"Namespace: rup_tooltip","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_tooltip rup_tooltip Se les presenta a los usuarios una barra de botones con diversas funcionalidades relacionadas a elementos de la página. Gracias a este componente se presentan, ordenan y agrupan las distintas funcionalidades gestionadas por las aplicaciones. Source: rup.tooltip.js, line 28 Tutorials: Tutorial: rup_tooltip See: El componente está basado en el plugin qTip2. Para mas información acerca de las funcionalidades y opciones de configuración pinche aquí. Example $(&quot;[title]&quot;).rup_tooltip({}); Members options Propiedades de configuración del componente. Properties: Name Type Argument Default Description disabled boolean &lt;optional&gt; false booleano que indica si el tooltip está habilitado o no. applyToPortal boolean &lt;optional&gt; false Parámetro encargado de determinar si el componente tooltip se aplica, también, al código html adscrito a los portales de la infraestructura de EJIE. El parámetro acepta el valor true, para indicar que se aplique al portal, y el valor false, para indicar que no se aplique al portal. content object &lt;optional&gt; Configura el texto del tooltip (si no se ha definido en el title). Properties Name Type Argument Description text string &lt;optional&gt; Texto del tooltip. title string &lt;optional&gt; Tooltip en formato diálogo y este parámetro define el título del mismo. position object &lt;optional&gt; Configura la posición del tooltip y tiene (entre otros) los siguientes parámetros. Properties Name Type Default Description my string top left - Posición en la que es colocado el tooltip a mostrar parámetros. at string bottom left - Posición respecto al objeto al que se aplica el tooltip. target string Si se quiere definir sobre qué elemento debe aplicarse el tooltip. parámetros. show object &lt;optional&gt; Configura el modo/evento en el que se despliega el tooltip. Properties Name Type Default Description event string mouseenter Evento con el que se muestra el tooltip. modal object Configura el modo/evento en el que se despliega el tooltip. hide object &lt;optional&gt; Configura el modo/evento en el que se oculta el tooltip. Properties Name Type Default Description event object mouseleave Evento con el que se oculta el tooltip. open jQuery.rup_tooltip~onOpen &lt;optional&gt; Permite asociar una función que se ejecutará cuando se muestre el tooltip. close jQuery.rup_tooltip~onClose &lt;optional&gt; Permite asociar una función que se ejecutará cuando se oculte el tooltip. Source: rup.tooltip.js, line 288 See: Para mas información consulte la documentación acerca de las opciones de configuración del plugin qTip2. Methods close() Oculta el tooltip. Source: rup.tooltip.js, line 59 Example $(&quot;#idTooltip&quot;).rup_tooltip(&quot;close&quot;); destroy() Elimina el tooltip. Source: rup.tooltip.js, line 93 Example $(&quot;#idTooltip&quot;).rup_tooltip(&quot;destroy&quot;); disable() Deshabilita el tooltip. Source: rup.tooltip.js, line 81 Example $(&quot;#idTooltip&quot;).rup_tooltip(&quot;disable&quot;); enable() Habilita el tooltip. Source: rup.tooltip.js, line 70 Example $(&quot;#idTooltip&quot;).rup_tooltip(&quot;enable&quot;); open() Muestra el tooltip. Source: rup.tooltip.js, line 48 Example $(&quot;#idTooltip&quot;).rup_tooltip(&quot;open&quot;); option(option [, value]) Obtiene o establece la configuración del tooltip. Parameters: Name Type Argument Description option string Nombre de la propiedad que se desea gestionar. value * &lt;optional&gt; Corresponde al valor de la propiedad en caso de haberse especificado el nombre de la misma en el primér parámetro. Source: rup.tooltip.js, line 105 Example // Obtener el valor de la posición $(&quot;#idTooltip&quot;).rup_tooltip(&quot;option&quot;, &quot;position&quot;); // Establecer el valor de la posición $(&quot;#idTooltip&quot;).rup_tooltip(&quot;option&quot;, &quot;position&quot;, {offset: &quot;15 15&quot;}); Type Definitions onClose() Función que se ejecutará cuando se oculte el tooltip. Source: rup.tooltip.js, line 277 Example $(&quot;#idTooltip&quot;).rup_tooltip({ close: function(){ } }); onOpen() Función que se ejecutará cuando se muestre el tooltip. Source: rup.tooltip.js, line 266 Example $(&quot;#idTooltip&quot;).rup_tooltip({ open: function(){ } }); × Search results Close "},"jQuery.rup_upload.html":{"id":"jQuery.rup_upload.html","title":"Namespace: rup_upload","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_upload rup_upload Permite al usuario seleccionar uno o varios archivos de su equipo y subirlos a la aplicación. Source: rup.upload.js, line 287 Tutorials: Tutorial: rup_upload See: El componente está basado en el plugin jQuery File Upload. Para mas información acerca de las funcionalidades y opciones de configuración pinche aquí. Example $(&quot;#idUpload&quot;).rup_upload({}); Members options Propiedades de configuración del componente. Properties: Name Type Argument Default Description namespace string &lt;optional&gt; Se utiliza para asociar el capturador de eventos del dropZone y del fileInpurt. Por defecto toma el valor del widget (“fileupload”). dropZone jQuery &lt;optional&gt; $(document) Indica el objeto jQuery que representa el área de dropZone. Para deshabilitar el soporte drag &amp; drop se deberá indicar el valor null. fileInput jQuery &lt;optional&gt; Objeto jQuery sobre el cual se monitorizarán los eventos de cambio del mismo. En caso de no especificarse se tomarán los input de tipo file existentes dentro del objeto sobre el que se ha creado el componente upload. Para deshabilitar el capturador de eventos se deberá indicar el valor null. replaceFileInput boolean &lt;optional&gt; true Determinar si el campo file es reemplazado por un nuevo objeto a partir de un clone. paramName string &lt;optional&gt; Indica el nombre del parámetro de la request mediante el cual se enviará la información del fichero. En caso de no especificarse, se tomará el valor de la propiedad name del campo file. En caso de no especificarse dicha propiedad se tomará el valor files[] por defecto. singleFileUploads boolean &lt;optional&gt; true Especifica si la subida de ficheros se realizar de manera individual, es decir, si se realiza una petición XHR por cada uno de los ficheros que se deben de enviar. limitMultiFileUploads boolean &lt;optional&gt; true Especifica el número de ficheros que pueden ser enviados en una única petición XHR. sequentialUploads boolean &lt;optional&gt; false Especifica si el envío de los ficheros se realizan de manera secuencial en vez de manera simultánea. limitConcurrentUploads Integer &lt;optional&gt; Indica el número máximo de peticiones concurrentes para lasubida de ficheros. forceIframeTransport boolean &lt;optional&gt; false Determina si se debe forzar el uso de iframe al realizar la subida de ficheros. Esta opción puede ser útil en caso de subida de ficheros entre diferentes dominios. multipart boolean &lt;optional&gt; true Indica si la subida de ficheros se realiza como multipart/form-data. recalculateProgress boolean &lt;optional&gt; true Por defecto, los envíos de ficheros erróneos o cancelados son excluidos del cálculo del progreso global de subida de ficheros. Para evitar el recálculo del progreso global se deberá de especificar esta opción como false. formData object | Array.&lt;object&gt; | function &lt;optional&gt; Información adicional que se desea enviar al realizarse la subida de ficheros. El parámetro acepta lo siguiente: Array de objetos con propiedadesObjeto simpleFunción que retorna uno de los tipos de datos especificados anteriormente. Source: rup.upload.js, line 507 See: Para mas información consulte la documentación acerca de las opciones de configuración del plugin jQuery File Upload. Events fileuploadadd Permite asociar una función que se ejecutará cuando se añada un fichero mediante el componente. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 533 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadadd&quot;, function (e, data) { }); fileuploadalways Permite asociar una función que se ejecutará al producirse un envío correcto, erróneo o se aborte. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 590 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadalways&quot;, function (e, data) { }); fileuploaddone Permite asociar una función que se ejecutará al realizarse de manera satisfactoria el envío de los ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 568 Example $(&quot;#fileupload&quot;).on(&quot;fileuploaddone&quot;, function (e, data) { }); fileuploadfail Permite asociar una función que se ejecutará al producirse un error en el envío de los ficheros o al abortarse el envío. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 579 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadfail&quot;, function (e, data) { }); fileuploadprogress Permite asociar una función que se ejecutará al producirse un evento relacionado con el indicador de progreso del envío de ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 601 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadprogress&quot;, function (e, data) { }); fileuploadprogressall Permite asociar una función que se ejecutará al producirse un evento relacionado el indicador de progreso global de envío de ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 612 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadprogressall&quot;, function (e, data) { }); fileuploadsend Permite asociar una función que se ejecutará al iniciarse el envío de cada fichero. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 556 Returns: Si la función retorna false el envío no se realiza. Type boolean Example $(&quot;#fileupload&quot;).on(&quot;fileuploadsend&quot;, function (e, data) { }); fileuploadstart Permite asociar una función que se ejecutará al inicio del envío de los ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup.upload.js, line 623 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadstart&quot;, function (e) { }); fileuploadstop Permite asociar una función que se ejecutará al detenerse el proceso de envío de ficheros. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup.upload.js, line 633 Example $(&quot;#fileupload&quot;).on(&quot;fileuploadstop&quot;, function (e) { }); fileuploadsubmit Permite asociar una función que se ejecutará cuando se añada un fichero mediante el componente. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. data object Objeto que contiene la información relativa a la subida de los ficheros. Source: rup.upload.js, line 544 Returns: Si la función retorna false el envío no se realiza. Type boolean Example $(&quot;#fileupload&quot;).on(&quot;fileuploadsubmit&quot;, function (e, data) { }); × Search results Close "},"jQuery.rup_utils.html":{"id":"jQuery.rup_utils.html","title":"Namespace: rup_utils","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_utils rup_utils Módulo de utilidades comunes a todos los componentes RUP. Implementa métodos para la manipulación de JSON, formularios, formatos... Source: rup.utils.js, line 29 Methods capitalizedLang() Retorna el idioma actual capitalizado. El idioma actual se obtiene de la variable $.rup.lang Source: rup.utils.js, line 39 Returns: Idioma actual capitalizado Type string Example // Retorna &quot;Es&quot; para un valor &quot;es&quot; en $.rup.lang. $.rup_utils.capitalizedLang(); elementFromPoint(x, y [, argCheck]) Devuelve el objeto del dom existente en la posición indicada. Parameters: Name Type Argument Default Description x number Coordenada x de la posición en la pantalla. y number Coordenada y de la posición en la pantalla. argCheck boolean &lt;optional&gt; true Determina si debe de ajustarse en base al scroll realizado en la pantalla . Source: rup.utils.js, line 170 Returns: Objeto del DOM correspodiente a la posición indicada. Type Object Example $.rup_utils.elementFromPoint(120,140); firstCharToLowerCase(cadena) Devuelve un string que puede ser utilizado como selector de jQuery mediante el id ('#'). El método permite también escapar los caracteres reservados en los selectores de jQuery Parameters: Name Type Description cadena string Cadena de caracteres inicial. Source: rup.utils.js, line 221 Returns: Cadena de caracteres resultante con su primer caracter convertido a minúsculas. Type string Example // Convierte a minúsculas el primer caracter de la cadena &quot;AbCdEfg&quot; -&gt; &quot;abCdEfg&quot; $.rup_utils.firstCharToLowerCase(&quot;AbCdEfg&quot;); firstCharToLowerCase(cadena) Convierte en mínusculas el primer caracter de la cadena de caracteres pasada como parámetro. Parameters: Name Type Description cadena string Cadena de caracteres inicial. Source: rup.utils.js, line 207 Returns: Cadena de caracteres resultante con su primer caracter convertido a minúsculas. Type string Example // Convierte a minúsculas el primer caracter de la cadena &quot;AbCdEfg&quot; -&gt; &quot;abCdEfg&quot; $.rup_utils.firstCharToLowerCase(&quot;AbCdEfg&quot;); jsontoarray(obj) Transforma un objeto JSON en un array Javascript. Parameters: Name Type Description obj Object Objeto JSON que se desea transformar en un array. Source: rup.utils.js, line 84 Returns: Array JavaScript. Type Object Examples // Transforma un json obj={'prop':'value'} en un array arr['prop'] -&gt; 'value' var obj={'prop':'value'}; $.rup_utils.jsontoarray(obj); // Transforma un json obj={'propA':{'propAA':'value'}} en un array arr['propA.propAA'] -&gt; 'value' var obj={'propA':{'propAA':'value'}}; $.rup_utils.jsontoarray(obj); // Transforma un json obj={'propA':{'propAA':['a','b','c','d']}} en un array arr['propA.propAA[0]'] var obj={'propA':{'propAA':['a','b','c','d']}}; $.rup_utils.jsontoarray(obj); queryStringToJson(queryString) Convierte una cadena querystring en un objeto json. Parameters: Name Type Description queryString string Query string a transformar en un objeto json. Source: rup.utils.js, line 245 Returns: Objeto JSON creado a partir de la query string indicada. Type object Example // Obtene un json a partir del query string &quot;keyA=valueA&amp;keyB=valueB&amp;keyC=valueC&quot; -&gt; &quot;{keyA:'valueA', keyB:'valueB', keyC:'valueC'}&quot; $.rup_utils.queryStringToJson(&quot;keyA=valueA&amp;keyB=valueB&amp;keyC=valueC&quot;); unnestjson(obj) Realiza una desanidacion del json pasado (p.e.: {entidad:{propiedad:valor}} --&gt; {'entidad.propiedad':valor}. Parameters: Name Type Description obj Object Objeto JSON que se desea desanidar. Source: rup.utils.js, line 144 Returns: Objeto JSON desanidado. Type Object Example // Transforma un json obj={'propA':{'propAA':'valueAA'}} en un json obj={'propA.propAA':'valueAA'}} var obj={'propA':{'propAA':'valueAA'}}; $.rup_utils.unnestjson(obj); × Search results Close "},"jQuery.rup_validate.html":{"id":"jQuery.rup_validate.html","title":"Namespace: rup_validate","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_validate rup_validate Permite al usuario validar los datos introducidos en los campos que se presentan en la aplicación. Source: rup.validate.js, line 34 Tutorials: Tutorial: rup_validate See: El componente está basado en el plugin jQuery Validation Plugin. Para mas información acerca de las funcionalidades y opciones de configuración pinche aquí. Example var properties={ rules:{ &quot;campoObligatorio&quot;:{required:true}, &quot;dni&quot;:{required:true,dni:true} } }; $(&quot;#formValidaciones&quot;).rup_validate(properties); Members destroy Se eliminan todos los objetos y eventos credos por el componente. Source: rup.validate.js, line 264 Example $(&quot;#formValidaciones&quot;).rup_validate(&quot;destroy&quot;); options Propiedades de configuración del componente. Properties: Name Type Argument Default Description debug boolean &lt;optional&gt; false Activa el modo debug. En caso de estar activado el formulario no se envía el formulario y los errores de ejecución que se hayan producido se visualizan en la consola. Requiere Firebug o Firebug lite. submitHandler jQuery.rup_validate~onSubmitHandler &lt;optional&gt; Método callback utilizado para capturar el evento submit cuando el formulario es válido. Reemplaza el submit por defecto. Es el método utilizado para realizar un submit mediante AJAX después de ser validado. invalidHandler jQuery.rup_validate~onInvalidHandler &lt;optional&gt; Método callback que se ejecuta cuando un formulario presenta errores de validación. ignore Selector &lt;optional&gt; Selector jQuery que identifica los elementos del formulario que van a ser ignorados al realizarse las validaciones. messages object &lt;optional&gt; Utilizado para indicar mensajes propios para las validaciones. Estos se especifican mediante pares de clave/valor. La clave es el nombre del elemento mientras que el valor es el texto que se ha de mostrar en caso de producirse un error en la validación. groups object &lt;optional&gt; Se utiliza para realizar agrupamientos de mensajes de error. onsubmit boolean &lt;optional&gt; true Determina si se valida el formulario al realizarse el submit. Marcar como false para realizar las validaciones mediante el resto de eventos. ofocusout boolean &lt;optional&gt; true Determina si se realiza la validación de los campos (excepto los checkbox y radio) al lanzarse los eventos blur. Estas validaciones se realizan únicamente una vez que un campo ha sido marcado como inválido. okeyup boolean &lt;optional&gt; true Determina si se realiza la validación de los campos (excepto los checkbox y radio) al lanzarse los eventos keyup. Las validaciones se realizan únicamente una vez que un campo ha sido marcado como inválido. onclick boolean &lt;optional&gt; true Determina si se realizan las validaciones de los checkbox y radio al realizar un click sobre los mismos. focusInvalid boolean &lt;optional&gt; true Posiciona el foco en el último campo activo o en el primer campo inválido la realizarse la validación de los campos. En caso de encontrarse el foco en un campo al realizarse la validación se mantiene en dicho campo. En caso de no encontrarse el foco en un campo, se posicionará en el primer campo inválido existente. focusCleanup boolean &lt;optional&gt; false En caso de activarse, elimina el errorClass correspondiente y oculta los mensajes de error de los campos que reciben el foco. Evitar utilizar esta propiedad en conjunción con focusInvalid. meta Selector &lt;optional&gt; En caso de utilizar metainformación en los campos que sea utilizada por otros plugins, es posible indicar un identificador para envolver la metadata correspondiente al el componente validate dentro de un objeto propio. errorClass String &lt;optional&gt; error Determina el nombre del class que va a aplicarse a los campos que presenten errores de validación. validClass String &lt;optional&gt; valid Determina el nombre del class que va a aplicarse a los campos que han sido validados y no presenten errores. errorElement String &lt;optional&gt; label Determina el tipo del elemento que va a utilizarse para generar los mensajes de error. wrapper String &lt;optional&gt; window Recubre los mensajes de error con el elemento especificado. Util en conjunción la propiedad errorLabelContainer para crear listado de errores. errorLabelContainer Selector &lt;optional&gt; Determina el objeto contenedor en el que se van a mostrar los mensajes de error. errorContainer Selector &lt;optional&gt; Determina un contenedor adicional para los mensajes de error. ignoreTitle boolean &lt;optional&gt; false Determina si se evita el obtener los mensajes a partir del atributo title. showErrors jQuery.rup_validate~onShowErrors &lt;optional&gt; Función callback para realizar un tratamiento personalizado de los errores de validación. errorPlacement jQuery.rup_validate~onErrorPlacement &lt;optional&gt; Función de callback que permite personalizar el lugar en el que se posicionarán los mensajes de error. highlight jQuery.rup_validate~onHighlight &lt;optional&gt; Función de callback para determinar como se debe resaltar los campos inválidos. unhighlight jQuery.rup_validate~onUnhighlight &lt;optional&gt; Función de callback para restaurar los cambios realizados por la función indicada en la propiedad highlight. Source: rup.validate.js, line 709 See: Para mas información consulte la documentación acerca de las opciones de configuración del plugin jQuery Validation Plugin. resetForm Se eliminan los menssajes de error de las reglas de validacion. Source: rup.validate.js, line 281 Example $(&quot;#formValidaciones&quot;).rup_validate(&quot;resetForm&quot;); Type Definitions onErrorPlacement(error, element) Función de callback que permite personalizar el lugar en el que se posicionarán los mensajes de error. Parameters: Name Type Description error jQuery Referencia al objeto label que va a ser insertado en el DOM para visualizar los errores. element jQuery Referencia al campo validado. Source: rup.validate.js, line 655 Example $(&quot;#myform&quot;).validate({ errorPlacement: function(error, element) { error.appendTo( element.parent(&quot;td&quot;).next(&quot;td&quot;) ); } }); onHighlight(element, errorClass, validClass) Función de callback para determinar como se debe resaltar los campos inválidos. Parameters: Name Type Description element jQuery Referencia al campo validado. errorClass String Valor actual del parámetro errorClass. validClass String Valor actual del parámetro validClass. Source: rup.validate.js, line 669 Example $(&quot;.selector&quot;).validate({ highlight: function(element, errorClass, validClass) { $(element).fadeOut(function() { $(element).fadeIn(); }); } }); onInvalidHandler(event, validator) Función que se ejecutará cuando el formulario presente errores de validación. Parameters: Name Type Description event Event Objeto event asociado al evento lanzado. validator object Instancia del validador asociada al formulario actual. Source: rup.validate.js, line 612 Example $(&quot;.selector&quot;).validate({ invalidHandler: function(event, validator) { // 'this' refers to the form var errors = validator.numberOfInvalids(); if (errors) { var message = errors == 1 ? 'You missed 1 field. It has been highlighted' : 'You missed ' + errors + ' fields. They have been highlighted'; $(&quot;div.error span&quot;).html(message); $(&quot;div.error&quot;).show(); } else { $(&quot;div.error&quot;).hide(); } } }); onShowErrors(errorMap, errorList) Función que se ejecutará cuando se produzca la validación de los datos permitiendo personalizar los errores de validación. Parameters: Name Type Description errorMap Object Pares de clave/valor, donde el key se corresponde con el name del campo del formulario y el value con el mensaje que se va a mostrar para ese campo. errorList Array.&lt;Object&gt; Array de objetos correspondientes a los campos validados. Properties Name Type Description message String Mensaje que va mostrarse para ese campo. element Element Objeto del DOM correspondiente a ese campo. Source: rup.validate.js, line 636 Example $(&quot;.selector&quot;).validate({ showErrors: function(errorMap, errorList) { $(&quot;#summary&quot;).html(&quot;Your form contains &quot; + this.numberOfInvalids() + &quot; errors, see details below.&quot;); this.defaultShowErrors(); } }); onSubmitFnc() Función de callback que se ejecuta previamente al envío del formulario. Source: rup.wizard.js, line 867 Example $(&quot;#idForm&quot;).rup_wizard({ submitFnc: function(){ } }); onSubmitHandler(form) Función de callback que se ejecutará cuando el formulario sea válido. Parameters: Name Type Description form Element Referencia al objeto DOM del formulario que está siendo validado. Source: rup.validate.js, line 592 Examples Envia el formulario cuando este es válido. $(&quot;#idFormulario&quot;).rup_tooltip({ onSubmitHandler: function(form){ $(form).ajaxSubmit(); } }); Realizar otras operaciones cuando el formulario es válido. $(&quot;#idFormulario&quot;).rup_tooltip({ onSubmitHandler: function(form){ // Operaciones extra $(form).ajaxSubmit(); } }); onSubmitHandler(savedData) Función de callback que se ejecutará desde el método updateSavedData. Parameters: Name Type Description savedData object Objeto interno que almacena en formato json los datos con los que se han inicializado los campos del formulario. Source: rup_table/rup.table.core.js, line 991 Example Envia el formulario cuando este es válido. $(&quot;#idComponente&quot;).rup_table(&quot;updateSavedData&quot;, function(savedData){ }); onSummaryFnc_INTER() Función de callback que se ejecuta una vez ha comenzado la generación del paso resumen. Source: rup.wizard.js, line 890 Returns: En caso de devolver false no se continuaría con el procesado del contenido de los pasos Type boolean Example $(&quot;#idForm&quot;).rup_wizard({ summaryFnc_INTER: function(){ } }); onSummaryFnc_POST() Función de callback que se invocará una vez se ha generado el paso resumen. Source: rup.wizard.js, line 902 Example $(&quot;#idForm&quot;).rup_wizard({ summaryFnc_POST: function(){ } }); onSummaryFnc_PRE() Función de callback que se invocará previamente a la generación del paso. Source: rup.wizard.js, line 878 Returns: En caso de devolver false no se generaría el resumen. Type boolean Example $(&quot;#idForm&quot;).rup_wizard({ summaryFnc_PRE: function(){ } }); onUnhighlight(element, errorClass, validClass) Función de callback para determinar como se debe resaltar los campos inválidos. Parameters: Name Type Description element jQuery Referencia al campo validado. errorClass String Valor actual del parámetro errorClass. validClass String Valor actual del parámetro validClass. Source: rup.validate.js, line 686 Example $(&quot;.selector&quot;).validate({ highlight: function(element, errorClass, validClass) { $(element).addClass(errorClass).removeClass(validClass); $(element.form).find(&quot;label[for=&quot; + element.id + &quot;]&quot;) .addClass(errorClass); }, unhighlight: function(element, errorClass, validClass) { $(element).removeClass(errorClass).addClass(validClass); $(element.form).find(&quot;label[for=&quot; + element.id + &quot;]&quot;) .removeClass(errorClass); } }); Events rupValidate_formValidationError Este evento es lanzado cuando se produce alguna violación entre las reglas de validación especificadas para ser aplicadas sobre los campos del formulario. Properties: Name Type Description e Event Objeto Event correspondiente al evento disparado. Source: rup.validate.js, line 745 Example $(&quot;#idFormulario&quot;).on(&quot;rupValidate_formValidationError&quot;, function(event){ }); × Search results Close "},"jQuery.rup_wizard.html":{"id":"jQuery.rup_wizard.html","title":"Namespace: rup_wizard","body":" UDA - Rup Namespaces jQuery.rup_accordionjQuery.rup_autocompletejQuery.rup_buttonjQuery.rup_combojQuery.rup_contextMenujQuery.rup_davjQuery.rup_dialogjQuery.rup_formjQuery.rup_languagejQuery.rup_messagesjQuery.rup_reportjQuery.rup_tablejQuery.rup_tooltipjQuery.rup_uploadjQuery.rup_utilsjQuery.rup_validatejQuery.rup_wizard Events jQuery.rup_table#event:rupTable_beforeProcessingjQuery.rup_table#event:rupTable_checkOutOfGridjQuery.rup_table#event:rupTable_coreConfigFinishedjQuery.rup_table#event:rupTable_serializeGridDatajQuery.rup_table#event:rupTableClearHighlightedRowAsSelectedjQuery.rup_table#event:rupTableHighlightRowAsSelectedjQuery.rup_upload#event:fileuploadaddjQuery.rup_upload#event:fileuploadalwaysjQuery.rup_upload#event:fileuploaddonejQuery.rup_upload#event:fileuploadfailjQuery.rup_upload#event:fileuploadprogressjQuery.rup_upload#event:fileuploadprogressalljQuery.rup_upload#event:fileuploadsendjQuery.rup_upload#event:fileuploadstartjQuery.rup_upload#event:fileuploadstopjQuery.rup_upload#event:fileuploadsubmitjQuery.rup_validate#event:rupValidate_formValidationError Namespace: rup_wizard rup_wizard Permitir guiar al usuario paso a paso a través de un proceso realizando las tareas dentro de un orden señalado. Source: rup.wizard.js, line 28 Tutorials: Tutorial: rup_wizard Example var properties = {}; $(&quot;#id_form&quot;).rup_wizard(properties) Members disableStep Deshabilita el paso recibido como parámetro. Source: rup.wizard.js, line 176 Example $(&quot;#idForm&quot;).rup_wizard(&quot;disableStep&quot;, 2); enableStep Habilita el paso recibido como parámetro. Source: rup.wizard.js, line 165 Example $(&quot;#idForm&quot;).rup_wizard(&quot;enableStep&quot;, 2); first Selecciona el primer paso del asistente. Source: rup.wizard.js, line 89 Example $(&quot;#idForm&quot;).rup_wizard(&quot;first&quot;); getCurrentStep Devuelve el número del paso actual. Source: rup.wizard.js, line 109 Example $(&quot;#idForm&quot;).rup_wizard(&quot;getCurrentStep&quot;); isCurrentStep Indica si el paso recibido como parámetro es el activo. Source: rup.wizard.js, line 120 Example $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStep&quot;, 2); isCurrentStepFirst Indica si el paso activo es el primero. Source: rup.wizard.js, line 132 Example $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStepFirst&quot;); isCurrentStepLast Indica si el paso activo es el último. Source: rup.wizard.js, line 143 Example $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStepLast&quot;); isCurrentStepSummary Indica si el paso activo es el resumen. Source: rup.wizard.js, line 154 Example $(&quot;#idForm&quot;).rup_wizard(&quot;isCurrentStepSummary&quot;); isStepDisabled Indica si el paso recibido como parámetro está deshabilitado. Source: rup.wizard.js, line 187 Example $(&quot;#idForm&quot;).rup_wizard(&quot;isStepDisabled&quot;, 2); last Selecciona el último paso del asistente. Source: rup.wizard.js, line 99 Example $(&quot;#idForm&quot;).rup_wizard(&quot;last&quot;); options Propiedades de configuración del componente. Properties: Name Type Argument Default Description submitButton Selector Identificador del botón de envío del formulario. Sirve para que dicho botón solo se muestre en el último paso del asistente. submitFnc jQuery.rup_validate~onSubmitFnc &lt;optional&gt; Función que se ejecuta previamente al envío del formulario. summary boolean &lt;optional&gt; true Indica si se debe generar o no el paso resumen. Este paso mostrará (como texto plano) los valores seleccionados en los diferentes pasos habilitados. Si un paso se encuentra deshabilitado no se utilizarán sus valores para la generación del resumen. El paso de resumen se genera cuando se navega hacia él. summaryWithAccordion boolean &lt;optional&gt; false Indica si el paso resumen debe formatear los diferentes pasos del asistente mediante elementos que usan el componente accordion. summaryWithAccordionSpaceBefore boolean &lt;optional&gt; true Indica si cuando se genera un resumen con los diferentes pasos presentados con accordion, se debe dejar un espacio () entre el contenido y la barra con los pasos. summaryWithAccordionSpaceAfter boolean &lt;optional&gt; true Indica si cuando se genera un resumen con los diferentes pasos presentados con accordion, se debe dejar un espacio () entre el contenido y el contenedor de botones (siguiente y enviar). summaryTabs2Accordion boolean &lt;optional&gt; false Indica si los componentes rup_tab de los diferentes pasos del wizard se deben convertir en elementos del componente accordion a la hora de generar el paso resumen. summaryFnc_PRE jQuery.rup_validate~onSummaryFnc_PRE &lt;optional&gt; Función que se invocará previamente a la generación del paso resumen. En caso de devolver false no se generaría el resumen. summaryFnc_INTER jQuery.rup_validate~onSummaryFnc_INTER &lt;optional&gt; Función que se ejecuta una vez ha comenzado la generación del paso resumen. Se habrá generado la capa contenedora y duplicado el contenido de los pasos anteriores pero sin llegar a procesarse (cambiarse por texto plano). En caso de devolver false no se continuaría con el procesado del contenido de los pasos. summaryFnc_POST jQuery.rup_validate~onSummaryFnc_POST &lt;optional&gt; Función que se ejecuta una vez se ha generado el paso resumen. stepFnc object &lt;optional&gt; Objeto json que contiene las diferentes funciones a ejecutar al navegar hacia cada uno de los pasos. En caso de devolver false no se continuaría la navegación hacia dicho paso. La clave de cada elemento será el número del paso y el valor será la función a ejecutar. disabled Array.&lt;Integer&gt; &lt;optional&gt; Array que indica los pasos a deshabilitar al inicio. En caso de que el elemento del array sea un número (numeric) se deshabilitará dicho paso y en caso de que sea un literal (string) se procesará como un intervalo que deberá definirse como “X-Y”. accordion object &lt;optional&gt; Define de forma general el funcionamiento del componente rup_accordion en el paso de resumen. rupAccordion object &lt;optional&gt; Define el funcionamiento del patrón rup_accordion en el resumen (de los objetos rup_accordion existentes en los pasos anteriores). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. summaryAccordion object &lt;optional&gt; Define el funcionamiento del patrón rup_accordion en el resumen para cada uno de los pasos que lo componen (si configura la generación de resumen y conversión de pasos en accordion). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. tabAccordion object &lt;optional&gt; Define el funcionamiento del patrón rup_accordion en el resumen, para cada los objetos rup_tab existentes en los pasos anteriores (si configura la generación de resumen y conversión de pestañas en accordion). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. rupTabsElement string &lt;optional&gt; &lt;h4/&gt; Define el funcionamiento del patrón rup_accordion en el resumen, para cada los objetos rup_tab existentes en los pasos anteriores (si configura la generación de resumen y conversión de pestañas en accordion). No tiene valor por defecto, por lo que en caso de no definirse se toma el valor del parámetro accordion. labelElement string &lt;optional&gt; &lt;span/&gt; Indica el tipo de objeto HTML en el que se convierten los objetos label en el paso de resumen. labelSeparatorElement string &lt;optional&gt; &lt;span/&gt; Indica el tipo de objeto HTML que se utilizará para separar los valores de sus correspondientes labels en el paso de resumen. labelSeparatorText string &lt;optional&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp; Indica el contenido del objeto HTML que se utilizará para separar los valores de sus correspondientes labels en el paso de resumen. textareaElement string &lt;optional&gt; &lt;p/&gt; Indica el tipo de objeto HTML en el que se convierten los objetos textarea en el paso de resumen. Source: rup.wizard.js, line 913 step Selecciona el paso recibido como parámetro [0..n]. Source: rup.wizard.js, line 48 Example $(&quot;#idForm&quot;).rup_wizard(&quot;step&quot;, 1); × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
